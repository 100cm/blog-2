## 阿里云RDS金融数据库(三节点版) - 性能篇  
           
### 作者            
digoal           
             
### 日期             
2017-07-13         
                      
### 标签      
PostgreSQL , MySQL , 三节点版 , 金融数据库 , Raft , 分布式共享存储版       
      
----      
       
## 背景    
终于到了性能篇，三节点同时满足了企业对数据库的可用性、可靠性的要求，那么性能如何呢？

提到性能测试，我有几点一定要说明一下，很多朋友对性能的理解可能有偏差，那么如何评判性能的好坏呢？

1、首先要明确测试的环境，包括数据库主机（主要包括CPU、内存、网卡，如果你的数据库能用上FPGA、GPU的计算能力，还得算上他们，例如PostgreSQL就可以利用GPU和FPGA进行计算加速。）、数据存储（主要是各个块大小、Queue deep的连续、随机IOPS能力，连续、随机读写带宽）、测试机和数据库主机的网络（带宽和RT），测试机的硬件指标。

2、明确参照物，没有参照物我们无法评判性能的好与坏。例如三节点、两节点、单节点的对比。

3、明确测试的benchmark，例如对于OLTP场景，可以按工业标准TPC-C进行测试。或者用户可以自己建模进行测试。而对于MySQL的测试，大家喜欢用sysbench以及sysbench中自带的那些test case。 

[《数据库界的华山论剑 tpc.org》](../201701/20170125_01.md)  

4、测试中，注意数据库驱动、缓存预热、测试客户端、连接数、测试数据量、测试数据的分布。。。等对测试结果带来的干扰。我曾经就有遇到过有朋友同样的硬件环境，因为各种原因，测试出来的结果大相庭径的。

例如测试客户端，开启了DEBUG日志输出，导致测试TPS下降严重。同样的测试CASE，用JAVA写的和用C写的，测试结果也有一定的差异。

5、数据库、存储、OS、防火墙的优化对测试结果的影响也巨大。如果要对比测试结果，那么环境务必保持一致，包括这些配置。

在考虑到以上因素的情况下，与参照物进行对比（例如pg 9.6和pg 10比较，pg和mysql 比较, 三节点和单节点、2节点的比较等），评判性能的好坏才有价值。
  
## 性能评测case设计
相信大家会比较关心三节点和单节点、双节点的性能对比，为了更加贴近现实场景我们来看看架构的区别。

单节点就不说了，从双节点开始说。

双节点可以部署在同一机房，也可以部署在同城异地机房。

当双节点部署在同城异地机房时，RT一定是打折扣的，所以对于小事务性能一定会下降明显，但是获得的好处是抵御机房级故障。

![pic](20170713_01_pic_001.jpg)

同一机房可以获得良好的RT，但是无法抵御机房级故障，也无法同时做到可用性和可靠性，在满足可用性时，可靠性就必须打折扣（因为不能使用完全同步复制）。

![pic](20170713_01_pic_002.jpg)

对于三节点，部署非常有弹性，我们可以选择同机房+异地机房的部署方法。可以抵御机房级故障，同时还有极好的RT。做到了性能、可靠性兼得。

![pic](20170713_01_pic_003.jpg)

对于三节点，还可以选择3机房的部分方法，牺牲一定的RT，可以抵御城市级灾难。

![pic](20170713_01_pic_004.jpg)

根据以上推理，我们可以有这样的预期，采用双机房的部署方法。

![pic](20170713_01_pic_005.png)



## 三节点 vs 2节点 vs 单节点

## 小事务


## 中级事务


## 节点故障

0丢失



## 系列文章    
[《阿里云RDS金融数据库(三节点版) - 背景篇》](../201707/20170709_02.md)  
   
[《阿里云RDS金融数据库(三节点版) - 理论篇》](../201707/20170710_01.md)  
    
[《阿里云RDS金融数据库(三节点版) - 性能篇》]()    
    
[《阿里云RDS金融数据库(三节点版) - 案例篇》]()    
     
## 阿里云RDS金融数据库(三节点版)  
[阿里云RDS金融数据库 - MySQL三节点版](https://help.aliyun.com/document_detail/51701.htm)      
      
阿里云RDS金融数据库 - PostgreSQL三节点版(敬请期待)      
      
