PostgreSQL research

PostgreSQL 9.4 add ALTER SYSTEM SET command change parameter value persistent

2013-12-23 13:51:42   查看原文>>

9.4 新增的一条命令

alter system set, 


用于设置数据库参数, 执行完后参数不会立刻生效, 同样需要reload. 
但是由于alter system set会把已修改的参数从postgresql.conf参数删除, 并且写入一条新的参数到postgresql.auto.conf文件中, 所以它支持重启后持续生效.

pg94@db-172-16-3-150-> cat postgresql.auto.conf 
# Do not edit this file manually! 
# It will be overwritten by the ALTER SYSTEM command. 

ALTER SYSTEM writes the configuration parameter values to the postgresql.auto.conf file. 
With DEFAULT, it removes a configuration entry from postgresql.auto.conf file. 
The values will be effective after reload of server configuration (SIGHUP) or in next server start based on the type of configuration parameter modified.
This command is not allowed inside transaction block or function.


例如 : 

postgres=# alter system set log_statement=ddl;
ALTER SYSTEM
postgres=# show log_statement;
 log_statement 
---------------
 none
(1 row)
pg94@db-172-16-3-150-> less postgresql.auto.conf 
# Do not edit this file manually! 
# It will be overwritten by ALTER SYSTEM command. 
log_statement = 'ddl'



生效方法有几种 : 

1. select pg_reload_conf()
2. pg_ctl reload
3. kill -s SIGHUP $pid


例如 : 

postgres=# select pg_reload_conf();
 pg_reload_conf 
----------------
 t
(1 row)

postgres=# show log_statement;
 log_statement 
---------------
 ddl
(1 row)


对于必须重启生效的参数, 还是需要重启数据库的

postgres=# alter system set wal_level=hot_standby;
ALTER SYSTEM
postgres=# select pg_reload_conf();
 pg_reload_conf 
----------------
 t
(1 row)

postgres=# show wal_level;
 wal_level 
-----------
 minimal
(1 row)




[参考]
1. http://www.postgresql.org/docs/devel/static/sql-altersystem.html
2. http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=65d6e4cb5c62371dae6c236a7e709d503ae6ddf8
