PostgreSQL research

Brocade Access Gateway Port Group Failover and Failback Test

2010-07-12 11:00:37   查看原文>>

首先对概念搞清楚：
1. 默认PG所有的Nport必须连接到同一个fabirc.
2. 手工PG所有的Nport必须连接到不同的fabric.

测试环境:
server
\|/                        \|/
Edge AG1          Edge AG2
\|/                        \|/
Core AG1          Core AG2
\|/                        \|/
Fabric1 FCSW   Fabric2 FCSW
\|/                        \|/
Storage1-port1  Storage1-port2

在服务器端配置MultiPath(failover模式),不过这个和本次测试无关。只测试一个通道。

PG failover测试: 
断开任意AG交换机的与服务器镜像的NPORT，发生如下情况。
ag --mapshow
N_Port  Configured_F_Ports      Current_F_Ports Failover Failback PG_ID PG_Name
--------------------------------------------------------------------------------
  16    0;8                     None             1       1         0    pg0
  17    1;9                     1                1       1         0    pg0
  18    2;10                    2                1       1         0    pg0
  19    3;11                    3                1       1         0    pg0
  20    4;12                    4                1       1         0    pg0
  21    5;13                    5                1       1         0    pg0
  22    6;14                    0;6              1       1         0    pg0
  23    7;15                    7                1       1         0    pg0
--------------------------------------------------------------------------------
服务器端vmstat输出
 1  2 340576  73976 100576 23023784    0    0     0 215824 1500 1311  0  5 76 19  0
 1  3 340576  72064 100660 23027260    0    0     0 43776 1149 1317  0  1 75 24  0
 0  3 340576  71020 100712 23027888    0    0     0 57708 1164 1267  0  1 75 24  0
 0  4 340576  71240  66252 23059848    0  152     0 340736 1818 1514  0  9 70 21  0
 0  4 340576  72192  66472 23057688    0    0     0 224988 1505 1311  0  6 61 33  0



PG failback测试:
将链路回复，发生如下情况：
ag --mapshow
N_Port  Configured_F_Ports      Current_F_Ports Failover Failback PG_ID PG_Name
--------------------------------------------------------------------------------
  16    0;8                     0                1       1         0    pg0
  17    1;9                     1                1       1         0    pg0
  18    2;10                    2                1       1         0    pg0
  19    3;11                    3                1       1         0    pg0
  20    4;12                    4                1       1         0    pg0
  21    5;13                    5                1       1         0    pg0
  22    6;14                    6                1       1         0    pg0
  23    7;15                    7                1       1         0    pg0
--------------------------------------------------------------------------------
服务器端vmstat输出
 0  6 340576  75152  71416 23051316    0    0     0 231668 1483 1366  0  6 56 38  0
 0  6 340576  70488  71572 23055720    0    0     0 146608 1378 1320  0  4 50 46  0
 0  6 340576  70664  71572 23055896    0    0     0     0 1009 1206  0  0 50 50  0
 2  9 340576  76476  71812 23048960    0    0     0 225128 1560 1587  0  6 59 34  0



经测试Nport的failover和failback在2秒左右可以搞定.
