PostgreSQL research

PostgreSQL Inspection Template DOC

2014-03-05 14:38:42   查看原文>>

作为一名数据库管理员, 周期性的对管理的数据库进行健康检查是很有必要的.
那么PostgreSQL数据库要检查一些什么东西呢?
本文提供了一份PostgreSQL数据库健康检查的模板, 包括每项检查的结果建议项目, 大家可以参阅一下.
WORD文档见附件.
把要检查的内容做成一个脚本来输出会省不少时间.

2014-03-13 新增巡检项, 不体现在网页中, 请查看附件 : 
1. 用户是否存在明文密码, 用户密码过期时间, 查看pg_shadow.
2. disable的触发器, 查看pg_trigger.
3. enable的触发器, 查看pg_trigger.
4. 用户,数据库级别的配置, 查看pg_db_role_setting.
5. 数据库权限以及表空间的权限, 查看pg_database和pg_tablespace
6. 表空间对应的文件系统的剩余空间,
7. 表空间对应的块设备的IO利用率. (sar -d)
8. 未使用绑定变量的SQL检查, 防止SQL注入, 建议全部使用绑定变量. 检查依据exec_simple_query函数均未使用绑定变量.

2014-03-21 修订
1. 系统硬件信息收集 cpu, mem , 大页
2. 大表:连接到各个库进行查询大于10GB的表以及年龄, 加个年龄限制10亿
3. 索引数超过4的表, 加个统计信息update,insert,delete计数限制.
4. 长事务, 加上事务时长显示.
5. 备库和主库配置文件的md5值对比.
6. 垃圾数据, 加一个行数限制.
7. 逻辑错误和建议的内容, 添加报错对应的SQL语句.

健康检查和类似pg_statsinfo这样的插件类似, 其实这些插件也可以来做同样的事情, 只是它们还不够完美, 有些数据并没有输出. 
例如数据库的年龄, 未使用的索引, 序列等.
健康检查和日常的监控程序也不一样, 日常监控有些东西也不方便做, 健康检查可以认为是一个比较全面的数据库体检.
参看 : 
http://blog.163.com/digoal@126/blog/static/1638770402014251114135/
http://blog.163.com/digoal@126/blog/static/163877040201425020982/
http://blog.163.com/digoal@126/blog/static/163877040201412763135184/


PostgreSQL 数据库巡检报告模板

                                                                                                                                                                                                                                                                                                                        ver 0.1

                                                                                                                                                                                                                                                                                                                    digoal.zhou

 



