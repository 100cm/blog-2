<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Oracle Redefine table online will clone and exchange source and intermedia table - 1</h2>
	<h5 id="">2012-09-13 21:25:15&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020128137020132/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">在线重定义表是一个非常好用的功能, 也是一个比较老的话题了.<wbr><div>在Oracle中可以使用DBMS_REDEFINITION包对表进行重定义, 例如把单表重定义成分区表.</div><div>但是在线重定义需要耗费多少空间, 又是否需要move rows呢?</div><div>我个人认为是需要移动行的, 因为每个分区对应一个segemnt, segment是由extents组成, 每个extents又是由连续的block组成.</div><div>因此单表在拆分成分区后, segment势必要变成多个, 而在原始表中一个block里面可能包含了属于多个分区的记录, 那么势必会需要涉及move rows.</div><div>以上是我的个人分析, 那实际上是怎么样的呢?</div><div>先来看一个例子 :&nbsp;</div><div>这个例子错开插入不同大小的ID记录, 确保分区SEGMENT不能连续的拆分BLOCK。</div><div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >oracle@db1-&gt; sqlplus "/ as sysdba"</font></div><div><font size="2"  >SQL*Plus: Release 10.2.0.4.0 - Production on Thu Sep 13 18:57:51 2012</font></div><div><font size="2"  >Copyright (c) 1982, 2007, Oracle. &nbsp;All Rights Reserved.</font></div><div><font size="2"  >Connected to:</font></div><div><font size="2"  >Oracle Database 10g Enterprise Edition Release 10.2.0.4.0 - 64bit Production</font></div><div><font size="2"  >With the Partitioning, OLAP, Data Mining and Real Application Testing options</font></div><p></p></pre></div><div>// 连接到test库</div><div><pre class="prettyprint"  ><p><font size="2"  >SQL&gt; conn test/test</font></p></pre></div><div>// 创建测试表</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; create table test.tbl_redefine_test(id int primary key,info varchar2(64) default 'Hello, I_am_digoal.zhou.', crt_time date default sysdate) tablespace kefu;</font></div><div><font size="2"  >Table created.</font></div><p></p></pre></div><div>查看索引, 将索引改成nologging的, 提高插入的性能</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; select index_name from user_indexes where table_name='TBL_REDEFINE_TEST';</font></div><div><font size="2"  >INDEX_NAME</font></div><div><font size="2"  >------------------------------</font></div><div><font size="2"  >SYS_C0028986</font></div><div><font size="2"  >SQL&gt; alter index SYS_C0028986 nologging;</font></div><div><font size="2"  >Index altered.</font></div><p></p></pre></div><div>// 错开ID的范围插入将近20W条记录.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+200000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+500000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+400000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+100000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+900000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+700000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+300000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+1000000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+600000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+800000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+1200000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+1500000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+1400000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+1100000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+1900000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+1700000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+1300000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+2000000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+1600000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >insert into tbl_redefine_test nologging (id) &nbsp;select rownum+1800000 from dual connect by level &lt; 100000;</font></div><div><font size="2"  >commit;</font></div><p></p></pre></div><div>// 登陆到超级用户准备在线重定义表, 拆成分区表</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; conn / as sysdba</font></div><div><font size="2"  >Connected.</font></div><div><font size="2"  >SQL&gt; set timing on</font></div><p></p></pre></div><div>// 首先查看原始表的起始BLOCK ID以及占用的空间大小<span style="line-height: 22px;"  >53531 , 109051904</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; set pagesize 50000 linesize 190</font></div><div><font size="2"  >SQL&gt; column owner format a16</font></div><div><font size="2"  >SQL&gt; column SEGMENT_NAME format a32</font></div><div><font size="2"  >SQL&gt; select owner,segment_name,partition_name,header_block,bytes,extents,relative_fno from dba_segments where segment_name='TBL_REDEFINE_TEST';</font></div><div><font size="2"  >OWNER &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SEGMENT_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PARTITION_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HEADER_BLOCK &nbsp; &nbsp; &nbsp;BYTES &nbsp; &nbsp;EXTENTS RELATIVE_FNO</font></div><div><font size="2"  >---------------- -------------------------------- ------------------------------ ------------ ---------- ---------- ------------</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;53531 &nbsp;109051904 &nbsp; &nbsp; &nbsp; &nbsp; 84 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><p></p></pre></div><div>// 使用<span style="line-height: 22px;"  >DBMS_REDEFINITION.CAN_REDEF_TABLE检查原始表是否满足在线重定义条件</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; BEGIN</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp;DBMS_REDEFINITION.CAN_REDEF_TABLE('TEST','TBL_REDEFINE_TEST',</font></div><div><font size="2"  >&nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp;DBMS_REDEFINITION.CONS_USE_PK);</font></div><div><font size="2"  >&nbsp; 4 &nbsp;END;</font></div><div><font size="2"  >&nbsp; 5 &nbsp;/</font></div><div><font size="2"  >PL/SQL procedure successfully completed.</font></div><div><font size="2"  >Elapsed: 00:00:00.11</font></div><p></p></pre></div><div>// 创建中间表(分区表)</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; CREATE TABLE test.part_test</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; (id int primary key,info varchar2(64) default 'Hello, I_am_digoal.zhou.', crt_time date default sysdate)</font></div><div><font size="2"  >&nbsp; 3 &nbsp; &nbsp; &nbsp; PARTITION BY RANGE(id)</font></div><div><font size="2"  >&nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; (PARTITION p1 VALUES LESS THAN (300000) TABLESPACE kefu,</font></div><div><font size="2"  >&nbsp; 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PARTITION p2 VALUES LESS THAN (600000) TABLESPACE kefu,</font></div><div><font size="2"  >&nbsp; 6 &nbsp;PARTITION p3 VALUES LESS THAN (900000) TABLESPACE kefu,</font></div><div><font size="2"  >&nbsp; 7 &nbsp;PARTITION p4 VALUES LESS THAN (1200000) TABLESPACE kefu,</font></div><div><font size="2"  >&nbsp; 8 &nbsp;PARTITION p5 VALUES LESS THAN (1500000) TABLESPACE kefu,</font></div><div><font size="2"  >&nbsp; 9 &nbsp;PARTITION p6 VALUES LESS THAN (1800000) TABLESPACE kefu,</font></div><div><font size="2"  >&nbsp;10 &nbsp;PARTITION p7 VALUES LESS THAN (2100000) TABLESPACE kefu</font></div><div><font size="2"  >&nbsp;11 &nbsp;);</font></div><div><font size="2"  >Table created.</font></div><div><font size="2"  >Elapsed: 00:00:00.06</font></div><p></p></pre></div><div>// 在线重定义, 从这次操作的时间上可以看出, 这里应该发生了大量数据的拷贝.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; BEGIN</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp;DBMS_REDEFINITION.START_REDEF_TABLE('TEST', 'TBL_REDEFINE_TEST','PART_TEST',</font></div><div><font size="2"  >&nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp; 'id id, info info, crt_time crt_time',</font></div><div><font size="2"  >&nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dbms_redefinition.cons_use_pk);</font></div><div><font size="2"  >&nbsp; 5 &nbsp;END;</font></div><div><font size="2"  >&nbsp; 6 &nbsp;/</font></div><div><font size="2"  >PL/SQL procedure successfully completed.</font></div><div><font size="2"  >Elapsed: 00:00:07.20</font></div><p></p></pre></div><div>//克隆对象 权限, 约束, 触发器等.</div><div>//This procedure clones the dependent objects of the table being redefined onto the interim table and registers the dependent objects. This procedure does not clone the already registered dependent objects.</div><div>This subprogram is used to clone the dependent objects like grants, triggers, constraints and privileges from the table being redefined to the interim table (which represents the post-redefinition table).</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; DECLARE</font></div><div><font size="2"  >&nbsp; 2 &nbsp;num_errors PLS_INTEGER;</font></div><div><font size="2"  >&nbsp; 3 &nbsp;BEGIN</font></div><div><font size="2"  >&nbsp; 4 &nbsp; &nbsp;DBMS_REDEFINITION.COPY_TABLE_DEPENDENTS('TEST', 'TBL_REDEFINE_TEST','PART_TEST',</font></div><div><font size="2"  >&nbsp; 5 &nbsp; &nbsp; DBMS_REDEFINITION.CONS_ORIG_PARAMS, TRUE, TRUE, TRUE, TRUE, num_errors);</font></div><div><font size="2"  >&nbsp; 6 &nbsp;END;</font></div><div><font size="2"  >&nbsp; 7 &nbsp;/</font></div><div><font size="2"  >PL/SQL procedure successfully completed.</font></div><div><font size="2"  >Elapsed: 00:00:02.49</font></div><p></p></pre></div><div>// 几个报错, 需要忽略, 因为克隆过程会用到重名的约束. 并通过下面的SQL查询是否有其他错误.&nbsp;</div><div>// Note that the ignore_errors argument is set to TRUE for this call. The reason is that the interim table was created with a primary key constraint, and when COPY_TABLE_DEPENDENTS attempts to copy the primary key constraint and index from the original table, errors occurs. You can ignore these errors, but you must run the query shown in the next step to see if there are other errors.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; select object_name, base_table_name, ddl_txt from</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DBA_REDEFINITION_ERRORS;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >OBJECT_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;BASE_TABLE_NAME</font></div><div><font size="2"  >------------------------------ ------------------------------</font></div><div><font size="2"  >DDL_TXT</font></div><div><font size="2"  >--------------------------------------------------------------------------------</font></div><div><font size="2"  >SYS_C0028986 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST</font></div><div><font size="2"  >CREATE UNIQUE INDEX "TEST"."TMP$$_SYS_C00289860" ON "TEST"."PART_TEST" ("ID")</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SYS_C0028986 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST</font></div><div><font size="2"  >ALTER TABLE "TEST"."PART_TEST" ADD CONSTRAINT "TMP$$_SYS_C00289860" PRIMARY KEY</font></div><div><font size="2"  >Elapsed: 00:00:00.02</font></div><p></p></pre></div><div><br></div><div>// 同步中间表数据和原始表的数据</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; BEGIN&nbsp;</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp;DBMS_REDEFINITION.SYNC_INTERIM_TABLE('TEST', 'TBL_REDEFINE_TEST', 'PART_TEST');</font></div><div><font size="2"  >&nbsp; 3 &nbsp;END;</font></div><div><font size="2"  >&nbsp; 4 &nbsp;/</font></div><div><font size="2"  >PL/SQL procedure successfully completed.</font></div><div><font size="2"  >Elapsed: 00:00:00.02</font></div><p></p></pre></div><div><br></div><div>// 这一步前, 可以对中间表进行添加索引等操作, 在完成这个操作后, 原始表将被重定义成中间表的形态, 因此原始表在此步骤会短暂的被锁. This procedure completes the redefinition process. Before this step, you can create new indexes, triggers, grants, and constraints on the interim table. The referential constraints involving the interim table must be disabled. After completing this step, the original table is redefined with the attributes and data of the interim table. The original table is locked briefly during this procedure.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; BEGIN</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp;DBMS_REDEFINITION.FINISH_REDEF_TABLE('TEST', 'TBL_REDEFINE_TEST', 'PART_TEST');</font></div><div><font size="2"  >&nbsp; 3 &nbsp;END;</font></div><div><font size="2"  >&nbsp; 4 &nbsp;/</font></div><div><font size="2"  >PL/SQL procedure successfully completed.</font></div><div><font size="2"  >Elapsed: 00:00:00.46</font></div><p></p></pre></div><div>// 完成后查看, 无重定义错误</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; select object_name, base_table_name, ddl_txt from DBA_REDEFINITION_ERRORS;</font></div><div><font size="2"  >no rows selected</font></div><div><font size="2"  >Elapsed: 00:00:00.00</font></div><p></p></pre></div><div>// 结束后查看<span style="line-height: 22px;"  >原始表的起始BLOCK ID以及占用的空间大小. (显然已经是7个分区了)</span></div><div><span style="line-height: 22px;"  >// 显然已经变成分区表了, 并且他们的BLOCKID都发生了变化, 已经不是原来的</span><span style="line-height: 22px;"  >53531. 而是57755开始的BLOCKID, 跳过了4224个block.</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; set pagesize 50000 linesize 190</font></div><div><font size="2"  >SQL&gt; column owner format a16</font></div><div><font size="2"  >SQL&gt; column SEGMENT_NAME format a32</font></div><div><font size="2"  >SQL&gt; select owner,segment_name,partition_name,header_block,bytes,extents,relative_fno from dba_segments where segment_name='TBL_REDEFINE_TEST';</font></div><div><font size="2"  >OWNER &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SEGMENT_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PARTITION_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HEADER_BLOCK &nbsp; &nbsp; &nbsp;BYTES &nbsp; &nbsp;EXTENTS RELATIVE_FNO</font></div><div><font size="2"  >---------------- -------------------------------- ------------------------------ ------------ ---------- ---------- ------------</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;57755 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;57763 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;57771 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;57779 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;57787 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;57795 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;57803 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >7 rows selected.</font></div><div><font size="2"  >Elapsed: 00:00:00.01</font></div><p></p></pre></div></div><div><br></div><div>再看另一个例子, ID是连续插入的, 如果ORACLE足够智能, 应该可以讲segment里面包含的blocks简单的SPLIT开来. 只需要move少量的rows.</div><div>但是结果还是同上一个例子一样, move了所有的行.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SQL&gt; create table test.tbl_redefine_test(id int primary key,info varchar2(64) default 'Hello, I_am_digoal.zhou.', crt_time date default sysdate) tablespace kefu;</font></div><div><font size="2"  >Table created.</font></div><div><font size="2"  >Elapsed: 00:00:00.02</font></div><div><font size="2"  >SQL&gt; select index_name from user_indexes where table_name='TBL_REDEFINE_TEST';</font></div><div><font size="2"  >INDEX_NAME</font></div><div><font size="2"  >------------------------------</font></div><div><font size="2"  >SYS_C0028988</font></div><div><font size="2"  >Elapsed: 00:00:00.00</font></div><div><font size="2"  >SQL&gt; alter index SYS_C0028988 nologging;</font></div><div><font size="2"  >Index altered.</font></div><div><font size="2"  >Elapsed: 00:00:00.01</font></div><div><font size="2"  >SQL&gt; insert into tbl_redefine_test nologging (id) &nbsp;select rownum from dual connect by level &lt; 2000000;</font></div><div><font size="2"  >1999999 rows created.</font></div><div><font size="2"  >Elapsed: 00:00:08.27</font></div><div><font size="2"  >SQL&gt; commit;</font></div><div><font size="2"  >Commit complete.</font></div><div><font size="2"  >Elapsed: 00:00:00.03</font></div><div><font size="2"  >SQL&gt; conn /as sysdba</font></div><div><font size="2"  >Connected.</font></div><div><font size="2"  >SQL&gt; set timing on</font></div><div><font size="2"  >SQL&gt; set pagesize 50000 linesize 190</font></div><div><font size="2"  >SQL&gt; column owner format a16</font></div><div><font size="2"  >SQL&gt; column SEGMENT_NAME format a32</font></div><div><font size="2"  >SQL&gt; select owner,segment_name,partition_name,header_block,bytes,extents,relative_fno from dba_segments where segment_name='TBL_REDEFINE_TEST';</font></div><div><font size="2"  >OWNER &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SEGMENT_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PARTITION_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HEADER_BLOCK &nbsp; &nbsp; &nbsp;BYTES &nbsp; &nbsp;EXTENTS RELATIVE_FNO</font></div><div><font size="2"  >---------------- -------------------------------- ------------------------------ ------------ ---------- ---------- ------------</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;86811 &nbsp;100663296 &nbsp; &nbsp; &nbsp; &nbsp; 83 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >Elapsed: 00:00:00.01</font></div><div><font size="2"  >SQL&gt; BEGIN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp;DBMS_REDEFINITION.CAN_REDEF_TABLE('TEST','TBL_REDEFINE_TEST',</font></div><div><font size="2"  >&nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp;DBMS_REDEFINITION.CONS_USE_PK); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 4 &nbsp;END; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 5 &nbsp;/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >PL/SQL procedure successfully completed.</font></div><div><font size="2"  >Elapsed: 00:00:00.00</font></div><div><font size="2"  >SQL&gt; CREATE TABLE test.part_test &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp; (id int primary key,info varchar2(64) default 'Hello, I_am_digoal.zhou.', crt_time date default sysdate)</font></div><div><font size="2"  >&nbsp; 3 &nbsp; &nbsp; &nbsp; PARTITION BY RANGE(id) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; (PARTITION p1 VALUES LESS THAN (300000) TABLESPACE kefu, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PARTITION p2 VALUES LESS THAN (600000) TABLESPACE kefu, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 6 &nbsp;PARTITION p3 VALUES LESS THAN (900000) TABLESPACE kefu, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 7 &nbsp;PARTITION p4 VALUES LESS THAN (1200000) TABLESPACE kefu, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 8 &nbsp;PARTITION p5 VALUES LESS THAN (1500000) TABLESPACE kefu, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 9 &nbsp;PARTITION p6 VALUES LESS THAN (1800000) TABLESPACE kefu, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp;10 &nbsp;PARTITION p7 VALUES LESS THAN (2100000) TABLESPACE kefu &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp;11 &nbsp;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >Table created.</font></div><div><font size="2"  >Elapsed: 00:00:00.03</font></div><div><font size="2"  >SQL&gt; BEGIN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp;DBMS_REDEFINITION.START_REDEF_TABLE('TEST', 'TBL_REDEFINE_TEST','PART_TEST', &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp; 'id id, info info, crt_time crt_time', &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dbms_redefinition.cons_use_pk); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 5 &nbsp;END; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 6 &nbsp;/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >PL/SQL procedure successfully completed.</font></div><div><font size="2"  >Elapsed: 00:00:08.08</font></div><div><font size="2"  >SQL&gt; DECLARE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 2 &nbsp;num_errors PLS_INTEGER; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 3 &nbsp;BEGIN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 4 &nbsp; &nbsp;DBMS_REDEFINITION.COPY_TABLE_DEPENDENTS('TEST', 'TBL_REDEFINE_TEST','PART_TEST', &nbsp;</font></div><div><font size="2"  >&nbsp; 5 &nbsp; &nbsp; DBMS_REDEFINITION.CONS_ORIG_PARAMS, TRUE, TRUE, TRUE, TRUE, num_errors); &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 6 &nbsp;END; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 7 &nbsp;/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >PL/SQL procedure successfully completed.</font></div><div><font size="2"  >Elapsed: 00:00:00.14</font></div><div><font size="2"  >SQL&gt; select object_name, base_table_name, ddl_txt from&nbsp;</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DBA_REDEFINITION_ERRORS; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >OBJECT_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;BASE_TABLE_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DDL_TXT</font></div><div><font size="2"  >------------------------------ ------------------------------ --------------------------------------------------------------------------------</font></div><div><font size="2"  >SYS_C0028988 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATE UNIQUE INDEX "TEST"."TMP$$_SYS_C00289880" ON "TEST"."PART_TEST" ("ID")</font></div><div><font size="2"  >SYS_C0028988 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ALTER TABLE "TEST"."PART_TEST" ADD CONSTRAINT "TMP$$_SYS_C00289880" PRIMARY KE</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Y</font></div><div><font size="2"  >Elapsed: 00:00:00.00</font></div><div><font size="2"  >SQL&gt; BEGIN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp;DBMS_REDEFINITION.SYNC_INTERIM_TABLE('TEST', 'TBL_REDEFINE_TEST', 'PART_TEST');&nbsp;</font></div><div><font size="2"  >&nbsp; 3 &nbsp;END; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 4 &nbsp;/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >PL/SQL procedure successfully completed.</font></div><div><font size="2"  >Elapsed: 00:00:00.08</font></div><div><font size="2"  >SQL&gt; BEGIN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; 2 &nbsp; &nbsp;DBMS_REDEFINITION.FINISH_REDEF_TABLE('TEST', 'TBL_REDEFINE_TEST', 'PART_TEST');&nbsp;</font></div><div><font size="2"  >&nbsp; 3 &nbsp;END; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 4 &nbsp;/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >PL/SQL procedure successfully completed.</font></div><div><font size="2"  >Elapsed: 00:00:00.14</font></div><div><font size="2"  >SQL&gt; select object_name, base_table_name, ddl_txt from DBA_REDEFINITION_ERRORS;</font></div><div><font size="2"  >no rows selected</font></div><div><font size="2"  >Elapsed: 00:00:00.00</font></div><div><font size="2"  >SQL&gt; select owner,segment_name,partition_name,header_block,bytes,extents,relative_fno from dba_segments where segment_name='TBL_REDEFINE_TEST';</font></div><div><font size="2"  >OWNER &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SEGMENT_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PARTITION_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HEADER_BLOCK &nbsp; &nbsp; &nbsp;BYTES &nbsp; &nbsp;EXTENTS RELATIVE_FNO</font></div><div><font size="2"  >---------------- -------------------------------- ------------------------------ ------------ ---------- ---------- ------------</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91035 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91043 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91051 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91059 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91067 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91075 &nbsp; 15728640 &nbsp; &nbsp; &nbsp; &nbsp; 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TBL_REDEFINE_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91083 &nbsp; 10485760 &nbsp; &nbsp; &nbsp; &nbsp; 25 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >7 rows selected.</font></div><div><font size="2"  >Elapsed: 00:00:00.01</font></div><div><font size="2"  >SQL&gt; select owner,segment_name,partition_name,header_block,bytes,extents,relative_fno from dba_segments where segment_name='PART_TEST';</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >OWNER &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SEGMENT_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PARTITION_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HEADER_BLOCK &nbsp; &nbsp; &nbsp;BYTES &nbsp; &nbsp;EXTENTS RELATIVE_FNO</font></div><div><font size="2"  >---------------- -------------------------------- ------------------------------ ------------ ---------- ---------- ------------</font></div><div><font size="2"  >TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PART_TEST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;86811 &nbsp;100663296 &nbsp; &nbsp; &nbsp; &nbsp; 83 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"  >Elapsed: 00:00:00.08</font></div><p></p></pre></div></div>
	</div>
</div>
</body>
</html>