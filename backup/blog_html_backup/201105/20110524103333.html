<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">diff corp's HBA and multipath</h2>
	<h5 id="">2011-05-24 10:33:33&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402011424102716598/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>HBA卡：</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >04:00.0 Fibre Channel: QLogic Corp. ISP2432-based 4Gb Fibre Channel to PCI Express HBA (rev 03)</font></div><div><font size="2"  >05:00.0 Fibre Channel: Emulex Corporation Zephyr LightPulse Fibre Channel Host Adapter (rev 02)</font></div><p></p></pre></div><div><br></div><div>驱动:</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >QLogic Fibre Channel HBA Driver: 8.03.01.04.05.05-k</font></div><div><font size="2"  >Emulex LightPulse Fibre Channel SCSI driver 8.2.0.63.3p</font></div><p></p></pre></div><div><br></div><div>multipath.conf配置截取：</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >defaults {</font></div><div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;udev_dir &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /dev</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;polling_interval &nbsp; &nbsp; &nbsp; &nbsp; 10</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;selector &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "round-robin 0"</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;path_grouping_policy &nbsp; &nbsp; failover</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;getuid_callout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "/sbin/scsi_id -g -u -s /block/%n"</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;prio_callout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /bin/true</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;path_checker &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; readsector0</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rr_min_io &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rr_weight &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;priorities</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;failback &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; immediate</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;no_path_retry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fail</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;user_friendly_names &nbsp; &nbsp; &nbsp;yes</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;flush_on_last_del &nbsp; &nbsp; &nbsp; &nbsp;yes</font></div><div><font size="2"  >}</font></div></div><p></p></pre></div><div><br></div><div>运行一段时间后的报错：</div><div>dmesg</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >qla2xxx 0000:04:00.0: scsi(5:0:1): Abort command issued -- 1 60c6500 2002.</font></div><div><font size="2"  >qla2xxx 0000:04:00.0: scsi(5:0:1): Abort command issued -- 1 60c65bf 2002.</font></div><div><font size="2"  >qla2xxx 0000:04:00.0: scsi(5:0:1): Abort command issued -- 1 60c664a 2002.</font></div><div><font size="2"  >qla2xxx 0000:04:00.0: scsi(5:0:1): Abort command issued -- 1 60c66e7 2002.</font></div><div><font size="2"  >qla2xxx 0000:04:00.0: scsi(5:0:1): Abort command issued -- 1 60c679b 2002.</font></div><div><font size="2"  >qla2xxx 0000:04:00.0: scsi(5:0:1): Abort command issued -- 1 60c6883 2002.</font></div><p></p></pre></div><div><br></div><div>其他信息:&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >Server DELL R610</font></div><div><font size="2"  >FCSW Brocade 300</font></div><div><font size="2"  >HP MSA2312FC</font></div><p></p></pre></div><div><br></div><div>报错时，IOSTAT磁盘使用率100,但是实际上rw请求啥都没有.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >avg-cpu: &nbsp;%user &nbsp; %nice %system %iowait &nbsp;%steal &nbsp; %idle</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 13.25 &nbsp; &nbsp;0.00 &nbsp; &nbsp;1.12 &nbsp; 12.50 &nbsp; &nbsp;0.00 &nbsp; 73.12</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >Device: &nbsp; &nbsp; &nbsp; &nbsp; rrqm/s &nbsp; wrqm/s &nbsp; r/s &nbsp; w/s &nbsp; rsec/s &nbsp; wsec/s avgrq-sz avgqu-sz &nbsp; await &nbsp;svctm &nbsp;%util</font></div><div><font size="2"  >sda &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sda1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sda2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sda3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sdb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sdb1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sdb2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sdb3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sdb4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sdd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 1.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 100.10</font></div><div><font size="2"  >sdd1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sdd2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sdd3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >sdd4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 1.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 100.10</font></div><div><font size="2"  >dm-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;26.03 &nbsp; &nbsp;0.00 &nbsp; 0.00 100.10</font></div><div><font size="2"  >dm-1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >dm-2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >dm-3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 &nbsp; 0.00</font></div><div><font size="2"  >dm-4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp;0.00 &nbsp;0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp; 0.00 &nbsp; &nbsp;26.00 &nbsp; &nbsp;0.00 &nbsp; 0.00 100.00</font></div><p></p></pre></div><div><br></div><div>ls存储所在目录没有响应</div><div>数据库没有响应</div><div><br></div><div>收集sosreport再分析一下。</div><div>不过两块HBA不是一个厂商的还是很尴尬.</div><div><br></div><div>原因查明,存储双控，坏了一个控制器，multipath使用RR模式,可能是双控制CACHE方面的问题导致数据损坏,入门存储还是不可靠啊。</div><div><br></div><div><div style="line-height: 22px;"  >【其他】</div><div style="line-height: 22px;"  >可以尝试重新扫描设备 :&nbsp;</div><div style="line-height: 22px;"  ><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >find /sys/class/scsi_host/host*/scan | while read line; do echo - - - &gt; $line; done</span></div><div style="line-height: 22px;"  ><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >参考 :&nbsp;</span></div><div style="line-height: 22px;"  ><a style="line-height: 22px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020130144424699/"  >http://blog.163.com/digoal@126/blog/static/16387704020130144424699/</a></div></div><wbr></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">zhouyu521 - 2012-04-24 23:34:10</h5>
				<div>multipath使用RR模式?什么意思？</div>
			</div>
			<div id="">
				<h5 id="">284466130 - 2011-05-24 16:11:50</h5>
				<div><IMG src="http://b.bst.126.net/common/portrait/face/preview/face8.gif">&nbsp;特么的尴尬</div>
			</div>
	</div>
</div>
</body>
</html>