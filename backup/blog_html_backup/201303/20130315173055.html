<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL binary, csv, text COPY compare</h2>
	<h5 id="">2013-03-15 17:30:55&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013215101136456/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>COPY支持三种格式的导出, 分别为text, csv, binary.</div><div>三种格式的导出以及导入的文件大小以及性能如何呢?&nbsp;</div><div>-- 测试导出时间</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# \timing</font></div><div><font size="2"   >Timing is on.</font></div><div><font size="2"   >postgres=# copy apk_info_agg to '/home/ocz/apk_info_agg.bin' with binary;</font></div><div><font size="2"   >COPY 498788</font></div><div><font size="2"   >Time: 49214.010 ms</font></div><div><font size="2"   >postgres=# copy apk_info_agg to '/home/ocz/apk_info_agg.csv' with csv;</font></div><div><font size="2"   >COPY 498788</font></div><div><font size="2"   >Time: 114874.043 ms</font></div><div><font size="2"   >postgres=# copy apk_info_agg to '/home/ocz/apk_info_agg.text' with (format text);</font></div><div><font size="2"   >COPY 498788</font></div><div><font size="2"   >Time: 112098.540 ms</font></div><p></p></pre></div><div>-- 导出后的文件大小</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >ocz@db-172-16-3-150-&gt; ll|grep apk_info_agg</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 ocz &nbsp;ocz &nbsp;1.5G Mar 15 12:29 apk_info_agg.bin</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 ocz &nbsp;ocz &nbsp;1.4G Mar 15 12:34 apk_info_agg.csv</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 ocz &nbsp;ocz &nbsp;1.3G Mar 15 14:52 apk_info_agg.text</font></div><p></p></pre></div><div>-- 测试导入时间</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# \d apk_info_agg</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Table "public.apk_info_agg"</font></div><div><font size="2"   >&nbsp; &nbsp; Column &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Modifiers&nbsp;</font></div><div><font size="2"   >---------------+-------------------------------+-----------</font></div><div><font size="2"   >&nbsp;dev_id &nbsp; &nbsp; &nbsp; &nbsp;| bigint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| not null</font></div><div><font size="2"   >&nbsp;install_msg &nbsp; | msg[] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;uninstall_msg | msg[] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;upload_time &nbsp; | timestamp without time zone[] |&nbsp;</font></div><div><font size="2"   >&nbsp;other_info &nbsp; &nbsp;| text[] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >postgres=# truncate apk_info_agg;</font></div><div><font size="2"   >TRUNCATE TABLE</font></div><div><font size="2"   >postgres=# \timing</font></div><div><font size="2"   >Timing is on.</font></div><div><font size="2"   >postgres=# copy apk_info_agg from '/home/ocz/apk_info_agg.bin' with binary;</font></div><div><font size="2"   >COPY 498788</font></div><div><font size="2"   >Time: 107669.493 ms</font></div><div><font size="2"   >postgres=# truncate apk_info_agg;</font></div><div><font size="2"   >TRUNCATE TABLE</font></div><div><font size="2"   >Time: 138.692 ms</font></div><div><font size="2"   >postgres=# copy apk_info_agg from '/home/ocz/apk_info_agg.csv' with csv;</font></div><div><font size="2"   >COPY 498788</font></div><div><font size="2"   >Time: 191353.447 ms</font></div><div><font size="2"   >postgres=# truncate apk_info_agg;</font></div><div><font size="2"   >TRUNCATE TABLE</font></div><div><font size="2"   >Time: 143.910 ms</font></div><div><font size="2"   >postgres=# copy apk_info_agg from '/home/ocz/apk_info_agg.text' with (format text);</font></div><div><font size="2"   >COPY 498788</font></div><div><font size="2"   >Time: 185357.975 ms</font></div><p></p></pre></div><div>binary格式导出和导入的速度最快. 但是文件也是最大的(大了1点点).&nbsp;</div><div>但是需要注意binary格式, 并不适合做跨平台的数据迁移(例如x86的迁移到arm, 或者至强机器等不同的CPU架构的服务器上). 也不适合做跨版本的迁移, 例如7.4以前的版本和7.4以后的版本binary的文件格式就不一样.</div><div>具体请参考帮助文档.</div><div><br></div></div><div>【参考】</div><wbr>1.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/sql-copy.html"   >http://www.postgresql.org/docs/9.2/static/sql-copy.html</a></div>
	</div>
</div>
</body>
</html>