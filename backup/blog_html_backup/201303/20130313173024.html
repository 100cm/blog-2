<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.3 JSON function enhanced</h2>
	<h5 id="">2013-03-13 17:30:24&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201321333759270/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>PostgreSQL 9.3 新增了几个JSON类型的函数</div><div>2个类型转换函数 :&nbsp;</div><div>to_json, row_to_json</div><div>1个聚合函数 :&nbsp;</div><div>json_agg</div><div>以及HSTORE扩展模块新增的2个类型转换函数 :&nbsp;</div><div>hstore_to_json, hstore_to_json_loose</div><div>如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# create extension hstore;</font></div><div><font size="2"   >CREATE EXTENSION</font></div></div><div><font size="2"   ><span style="line-height: 19px;"   >-- 加上已有的几个JSON函数, 目前9.3的json相关函数如下.</span></font></div><div><font size="2"   >digoal=# \df *.*json*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of functions</font></div><div><font size="2"   >&nbsp; &nbsp;Schema &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; Name &nbsp; &nbsp; &nbsp; &nbsp; | Result data type | Argument data types &nbsp;| &nbsp;Type &nbsp;</font></div><div><font size="2"   >------------+----------------------+------------------+----------------------+--------</font></div><div><font size="2"   >&nbsp;pg_catalog | array_to_json &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | anyarray &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | array_to_json &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | anyarray, boolean &nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | json_agg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | anyelement &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | agg</font></div><div><font size="2"   >&nbsp;pg_catalog | json_agg_finalfn &nbsp; &nbsp; | json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | internal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | json_agg_transfn &nbsp; &nbsp; | internal &nbsp; &nbsp; &nbsp; &nbsp; | internal, anyelement | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | json_in &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | cstring &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | json_out &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | cstring &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | json_recv &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | internal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | json_send &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| bytea &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | row_to_json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | record &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | row_to_json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | record, boolean &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | to_json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | anyelement &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;public &nbsp; &nbsp; | hstore_to_json &nbsp; &nbsp; &nbsp; | json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | hstore &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;public &nbsp; &nbsp; | hstore_to_json_loose | json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | hstore &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >(14 rows)</font></div><p></p></pre></div></div><div>新增函数的使用举例 :&nbsp;</div><div>to_json :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# select to_json(1);</font></div><div><font size="2"   >&nbsp;to_json&nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;1</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select to_json(true);</font></div><div><font size="2"   >&nbsp;to_json&nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;true</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select to_json('abc');</font></div><div><font size="2"   >ERROR: &nbsp;42804: could not determine polymorphic type because input has type "unknown"</font></div><div><font size="2"   >LOCATION: &nbsp;enforce_generic_type_consistency, parse_coerce.c:1733</font></div><div><font size="2"   >digoal=# select to_json('abc'::text);</font></div><div><font size="2"   >&nbsp;to_json&nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;"abc"</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >digoal=# select to_json('ab:c'::text);</font></div><div><font size="2"   >&nbsp;to_json&nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;"ab:c"</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><br></div><div>row_to_json :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# \d test</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;Table "public.test"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >digoal=# select row_to_json(row(1));</font></div><div><font size="2"   >&nbsp;row_to_json&nbsp;</font></div><div><font size="2"   >-------------</font></div><div><font size="2"   >&nbsp;{"f1":1}</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select row_to_json(row(1,2));</font></div><div><font size="2"   >&nbsp; &nbsp;row_to_json &nbsp;&nbsp;</font></div><div><font size="2"   >-----------------</font></div><div><font size="2"   >&nbsp;{"f1":1,"f2":2}</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select row_to_json(row(1)::test);</font></div><div><font size="2"   >&nbsp;row_to_json&nbsp;</font></div><div><font size="2"   >-------------</font></div><div><font size="2"   >&nbsp;{"id":1}</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div><br></div><div>json_agg :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# select json_agg(i) from generate_series(1,10) i;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; json_agg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------------------------------</font></div><div><font size="2"   >&nbsp;[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >digoal=# select json_agg(md5(i::text)) from generate_series(1,10) i;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;json_agg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;["c4ca4238a0b923820dcc509a6f75849b", "c81e728d9d4c2f636f067f89cc14862c", "eccbc87e4b5ce2fe28308fd9f2a7baf3", "a87ff679a2f3e71d9181a</font></div><div><font size="2"   >67b7542122c", "e4da3b7fbbce2345d7772b0674a318d5", "1679091c5a880faf6fb5e6087eb1b2dc", "8f14e45fceea167a5a36dedd4bea2543", "c9f0f895f</font></div><div><font size="2"   >b98ab9159f51fd0297e236d", "45c48cce2e2d7fbdea1afc51c7c6ad26", "d3d9446802a44259755d38e6d163e820"]</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"   >hstore_to_json :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 19px;"   >digoal=# select hstore_to_json('name=&gt;digoal, address=&gt;hangzhou, age=&gt;30'::hstore);<br>                     hstore_to_json                     <br>--------------------------------------------------------<br> {"age": "30", "name": "digoal", "address": "hangzhou"}<br>(1 row)</span></font></div><p></p></pre></div><div><span style="line-height: 22px;"   >hstore_to_json_loose :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select hstore_to_json_loose('name=&gt;digoal, address=&gt;hangzhou, age=&gt;30'::hstore);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hstore_to_json_loose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------</font></div><div><font size="2"   >&nbsp;{"age": 30, "name": "digoal", "address": "hangzhou"}</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>这两个函数的区别在文章末尾.</div><div><br></div><div>当然对于开发人员来说, 这些函数还太弱了. 所以目前来说很多用到JSON类型的应用需要使用plv8语言来发挥.</div><div><br></div><div><br></div><div><br></div>【参考】<wbr><div>1.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html"   >http://www.postgresql.org/docs/devel/static/functions-json.html</a></div><div>2.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/datatype-json.html"   >http://www.postgresql.org/docs/devel/static/datatype-json.html</a></div><div>3.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-aggregate.html"   >http://www.postgresql.org/docs/devel/static/functions-aggregate.html</a></div><div>4.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/hstore.html"   >http://www.postgresql.org/docs/devel/static/hstore.html</a></div><div>5.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020120182349667/"   >http://blog.163.com/digoal@126/blog/static/16387704020120182349667/</a></div><div>6.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020121150212379/"   >http://blog.163.com/digoal@126/blog/static/16387704020121150212379/</a></div><div>7.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201293082737559/"   >http://blog.163.com/digoal@126/blog/static/163877040201293082737559/</a></div><div>8.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402012112832614918/"   >http://blog.163.com/digoal@126/blog/static/1638770402012112832614918/</a></div><div>9.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020130165241651/"   >http://blog.163.com/digoal@126/blog/static/16387704020130165241651/</a></div><div>10.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=38fb4d978c5bfc377ef979e2595e3472744a3b05"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=38fb4d978c5bfc377ef979e2595e3472744a3b05</a></div><div>11. json.c</div><div>to_json</div><div><pre style="font-family: monospace, fixed; font-size: 9pt; border: 1px solid rgb(196, 207, 229); background-color: rgb(251, 252, 253); padding: 4px 6px; margin: 4px 8px 4px 2px; overflow: auto; word-wrap: break-word; line-height: 15px;"   >01185 <span style="color: rgb(128, 0, 0);"   >/*</span>
<a style="color: rgb(61, 87, 140);" name="l01186" rel="nofollow"   ></a>01186 <span style="color: rgb(128, 0, 0);"   > * SQL function to_json(anyvalue)</span>
<a style="color: rgb(61, 87, 140);" name="l01187" rel="nofollow"   ></a>01187 <span style="color: rgb(128, 0, 0);"   > */</span>
<a style="color: rgb(61, 87, 140);" name="l01188" rel="nofollow"   ></a>01188 <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres_8h.html#a43879eb52e27b2413d7a05056a173ca6"   >Datum</a>
<a style="color: rgb(61, 87, 140);" name="l01189" rel="nofollow"   ></a><a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/json_8h.html#a4dcdc8fcb59ea6c79bd61c083ca1cee0"   >01189</a> <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/json_8c.html#a4dcdc8fcb59ea6c79bd61c083ca1cee0"   >to_json</a>(<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/fmgr_8h.html#adf4dec9b7d23f1b4c68477affde8b7ff"   >PG_FUNCTION_ARGS</a>)
<a style="color: rgb(61, 87, 140);" name="l01190" rel="nofollow"   ></a>01190 {
<a style="color: rgb(61, 87, 140);" name="l01191" rel="nofollow"   ></a>01191     <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres__ext_8h.html#a545a1e974d4c848ee2e2dcfdd503335f"   >Oid</a>         val_type = <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/fmgr_8c.html#ac411070333dcab999bc8dd240ee5c951"   >get_fn_expr_argtype</a>(fcinfo-&gt;flinfo, 0);
<a style="color: rgb(61, 87, 140);" name="l01192" rel="nofollow"   ></a>01192     <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/structStringInfoData.html"   >StringInfo</a>  result;
<a style="color: rgb(61, 87, 140);" name="l01193" rel="nofollow"   ></a>01193     <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres_8h.html#a43879eb52e27b2413d7a05056a173ca6"   >Datum</a>       orig_val,
<a style="color: rgb(61, 87, 140);" name="l01194" rel="nofollow"   ></a>01194                 <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/informix_8c.html#a4ad74c8aecc5ce169f27f5c31c98687d"   >val</a>;
<a style="color: rgb(61, 87, 140);" name="l01195" rel="nofollow"   ></a>01195     <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/parse__coerce_8h.html#a4f0835c9a20515c225aae08df37890ce"   >TYPCATEGORY</a> tcategory;
<a style="color: rgb(61, 87, 140);" name="l01196" rel="nofollow"   ></a>01196     <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres__ext_8h.html#a545a1e974d4c848ee2e2dcfdd503335f"   >Oid</a>         typoutput;
<a style="color: rgb(61, 87, 140);" name="l01197" rel="nofollow"   ></a>01197     <span style="color: rgb(96, 64, 32);"   >bool</span>        typisvarlena;
<a style="color: rgb(61, 87, 140);" name="l01198" rel="nofollow"   ></a>01198     <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres__ext_8h.html#a545a1e974d4c848ee2e2dcfdd503335f"   >Oid</a>         castfunc = InvalidOid;
<a style="color: rgb(61, 87, 140);" name="l01199" rel="nofollow"   ></a>01199 
<a style="color: rgb(61, 87, 140);" name="l01200" rel="nofollow"   ></a>01200     <span style="color: rgb(224, 128, 0);"   >if</span> (val_type == <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres__ext_8h.html#a1a1256f66b711d08dd73f7314e64c52c"   >InvalidOid</a>)
<a style="color: rgb(61, 87, 140);" name="l01201" rel="nofollow"   ></a>01201         <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/elog_8h.html#aa852b6e9d7241f1571e8d482c7381647"   >ereport</a>(<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/elog_8h.html#a8fe83ac76edc595f6b98cd4a4127aed5"   >ERROR</a>,
<a style="color: rgb(61, 87, 140);" name="l01202" rel="nofollow"   ></a>01202                 (<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/ipc__test_8c.html#ab243d4465b39d615088449de076a217d"   >errcode</a>(ERRCODE_INVALID_PARAMETER_VALUE),
<a style="color: rgb(61, 87, 140);" name="l01203" rel="nofollow"   ></a>01203                  <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/ipc__test_8c.html#ac15cbe2e9b7f41f40df622ac31521987"   >errmsg</a>(<span style="color: rgb(0, 32, 128);"   >"could not determine input data type"</span>)));
<a style="color: rgb(61, 87, 140);" name="l01204" rel="nofollow"   ></a>01204 
<a style="color: rgb(61, 87, 140);" name="l01205" rel="nofollow"   ></a>01205 
<a style="color: rgb(61, 87, 140);" name="l01206" rel="nofollow"   ></a>01206     result = <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/stringinfo_8c.html#a3a3a17a6700ec616ad3bb19881c1e886"   >makeStringInfo</a>();
<a style="color: rgb(61, 87, 140);" name="l01207" rel="nofollow"   ></a>01207 
<a style="color: rgb(61, 87, 140);" name="l01208" rel="nofollow"   ></a>01208     orig_val = <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/fmgr_8h.html#a44fe7d608febda77aefb0654f7da41b0"   >PG_ARGISNULL</a>(0) ? (Datum) 0 : <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/fmgr_8h.html#a4d0450700c4358d471a25db19f02ebaf"   >PG_GETARG_DATUM</a>(0);
<a style="color: rgb(61, 87, 140);" name="l01209" rel="nofollow"   ></a>01209 
<a style="color: rgb(61, 87, 140);" name="l01210" rel="nofollow"   ></a>01210     <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/lsyscache_8c.html#a48d637426d06bfdf607eb29da3be558a"   >getTypeOutputInfo</a>(val_type, &amp;typoutput, &amp;typisvarlena);
<a style="color: rgb(61, 87, 140);" name="l01211" rel="nofollow"   ></a>01211 
<a style="color: rgb(61, 87, 140);" name="l01212" rel="nofollow"   ></a>01212     <span style="color: rgb(224, 128, 0);"   >if</span> (val_type &gt; <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/transam_8h.html#ab8a77e4d1af6de0ebc34490ea61f2c91"   >FirstNormalObjectId</a>)
<a style="color: rgb(61, 87, 140);" name="l01213" rel="nofollow"   ></a>01213     {
<a style="color: rgb(61, 87, 140);" name="l01214" rel="nofollow"   ></a>01214         <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/structHeapTupleData.html"   >HeapTuple</a>   tuple;
<a style="color: rgb(61, 87, 140);" name="l01215" rel="nofollow"   ></a>01215         <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/pg__cast_8h.html#ab8730a38b76920ccf8c858d9c0560f51"   >Form_pg_cast</a> castForm;
<a style="color: rgb(61, 87, 140);" name="l01216" rel="nofollow"   ></a>01216 
<a style="color: rgb(61, 87, 140);" name="l01217" rel="nofollow"   ></a>01217         tuple = <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/syscache_8h.html#aa1840b3ca90c0dea0238d157eebb4dab"   >SearchSysCache2</a>(<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/syscache_8h.html#a24be1224f91c19cc5ba525e42c21f0dfa96a4ec7fe5e3dfc8194bb428f87d4ae9"   >CASTSOURCETARGET</a>,
<a style="color: rgb(61, 87, 140);" name="l01218" rel="nofollow"   ></a>01218                                 <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres_8h.html#a85544b92159563e63a0eaf3eb112d9b2"   >ObjectIdGetDatum</a>(val_type),
<a style="color: rgb(61, 87, 140);" name="l01219" rel="nofollow"   ></a>01219                                 <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres_8h.html#a85544b92159563e63a0eaf3eb112d9b2"   >ObjectIdGetDatum</a>(<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/include_2catalog_2pg__type_8h.html#a8cfa8f9439f6f38369da867d8054d6a4"   >JSONOID</a>));
<a style="color: rgb(61, 87, 140);" name="l01220" rel="nofollow"   ></a>01220         <span style="color: rgb(224, 128, 0);"   >if</span> (<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/htup_8h.html#ae2fa6f48d980d867e4d904fb546cc7a4"   >HeapTupleIsValid</a>(tuple))
<a style="color: rgb(61, 87, 140);" name="l01221" rel="nofollow"   ></a>01221         {
<a style="color: rgb(61, 87, 140);" name="l01222" rel="nofollow"   ></a>01222             castForm = (Form_pg_cast) <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/htup__details_8h.html#aab7666469a5e1d5e3622779f16a089ed"   >GETSTRUCT</a>(tuple);
<a style="color: rgb(61, 87, 140);" name="l01223" rel="nofollow"   ></a>01223 
<a style="color: rgb(61, 87, 140);" name="l01224" rel="nofollow"   ></a>01224             <span style="color: rgb(224, 128, 0);"   >if</span> (castForm-&gt;castmethod == <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/pg__cast_8h.html#a4ea8a3d06faae6d188c431e19c6d7cf1a8b4d300ef53c559d6c8dad2418e4134c"   >COERCION_METHOD_FUNCTION</a>)
<a style="color: rgb(61, 87, 140);" name="l01225" rel="nofollow"   ></a>01225                 castfunc = typoutput = castForm-&gt;castfunc;
<a style="color: rgb(61, 87, 140);" name="l01226" rel="nofollow"   ></a>01226 
<a style="color: rgb(61, 87, 140);" name="l01227" rel="nofollow"   ></a>01227             <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/syscache_8c.html#a349ecf3ce2b907438b77ffcee14909ac"   >ReleaseSysCache</a>(tuple);
<a style="color: rgb(61, 87, 140);" name="l01228" rel="nofollow"   ></a>01228         }
<a style="color: rgb(61, 87, 140);" name="l01229" rel="nofollow"   ></a>01229     }
<a style="color: rgb(61, 87, 140);" name="l01230" rel="nofollow"   ></a>01230 
<a style="color: rgb(61, 87, 140);" name="l01231" rel="nofollow"   ></a>01231     <span style="color: rgb(224, 128, 0);"   >if</span> (castfunc != <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres__ext_8h.html#a1a1256f66b711d08dd73f7314e64c52c"   >InvalidOid</a>)
<a style="color: rgb(61, 87, 140);" name="l01232" rel="nofollow"   ></a>01232         tcategory = TYPCATEGORY_JSON_CAST;
<a style="color: rgb(61, 87, 140);" name="l01233" rel="nofollow"   ></a>01233     <span style="color: rgb(224, 128, 0);"   >else</span> <span style="color: rgb(224, 128, 0);"   >if</span> (val_type == <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/include_2catalog_2pg__type_8h.html#a0dfa5334c35cd6667186cd6dc0defcdc"   >RECORDARRAYOID</a>)
<a style="color: rgb(61, 87, 140);" name="l01234" rel="nofollow"   ></a>01234         tcategory = TYPCATEGORY_ARRAY;
<a style="color: rgb(61, 87, 140);" name="l01235" rel="nofollow"   ></a>01235     <span style="color: rgb(224, 128, 0);"   >else</span> <span style="color: rgb(224, 128, 0);"   >if</span> (val_type == <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/include_2catalog_2pg__type_8h.html#a1911d05c5804bc8f7553ba58ad616109"   >RECORDOID</a>)
<a style="color: rgb(61, 87, 140);" name="l01236" rel="nofollow"   ></a>01236         tcategory = TYPCATEGORY_COMPOSITE;
<a style="color: rgb(61, 87, 140);" name="l01237" rel="nofollow"   ></a>01237     <span style="color: rgb(224, 128, 0);"   >else</span> <span style="color: rgb(224, 128, 0);"   >if</span> (val_type == <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/include_2catalog_2pg__type_8h.html#a8cfa8f9439f6f38369da867d8054d6a4"   >JSONOID</a>)
<a style="color: rgb(61, 87, 140);" name="l01238" rel="nofollow"   ></a>01238         tcategory = TYPCATEGORY_JSON;
<a style="color: rgb(61, 87, 140);" name="l01239" rel="nofollow"   ></a>01239     <span style="color: rgb(224, 128, 0);"   >else</span>
<a style="color: rgb(61, 87, 140);" name="l01240" rel="nofollow"   ></a>01240         tcategory = <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/parse__coerce_8c.html#a0ba29045af54c2779cc958132f0cc819"   >TypeCategory</a>(val_type);
<a style="color: rgb(61, 87, 140);" name="l01241" rel="nofollow"   ></a>01241 
<a style="color: rgb(61, 87, 140);" name="l01242" rel="nofollow"   ></a>01242     <span style="color: rgb(128, 0, 0);"   >/*</span>
<a style="color: rgb(61, 87, 140);" name="l01243" rel="nofollow"   ></a>01243 <span style="color: rgb(128, 0, 0);"   >     * If we have a toasted datum, forcibly detoast it here to avoid memory</span>
<a style="color: rgb(61, 87, 140);" name="l01244" rel="nofollow"   ></a>01244 <span style="color: rgb(128, 0, 0);"   >     * leakage inside the type's output routine.</span>
<a style="color: rgb(61, 87, 140);" name="l01245" rel="nofollow"   ></a>01245 <span style="color: rgb(128, 0, 0);"   >     */</span>
<a style="color: rgb(61, 87, 140);" name="l01246" rel="nofollow"   ></a>01246     <span style="color: rgb(224, 128, 0);"   >if</span> (typisvarlena &amp;&amp; orig_val != (<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres_8h.html#a43879eb52e27b2413d7a05056a173ca6"   >Datum</a>) 0)
<a style="color: rgb(61, 87, 140);" name="l01247" rel="nofollow"   ></a>01247         val = <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres_8h.html#af1af46436828db69962409e7b39f7aa8"   >PointerGetDatum</a>(<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/fmgr_8h.html#a86ec70d57108315d7c41a5c8d39346de"   >PG_DETOAST_DATUM</a>(orig_val));
<a style="color: rgb(61, 87, 140);" name="l01248" rel="nofollow"   ></a>01248     <span style="color: rgb(224, 128, 0);"   >else</span>
<a style="color: rgb(61, 87, 140);" name="l01249" rel="nofollow"   ></a>01249         val = orig_val;
<a style="color: rgb(61, 87, 140);" name="l01250" rel="nofollow"   ></a>01250 
<a style="color: rgb(61, 87, 140);" name="l01251" rel="nofollow"   ></a>01251     <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/json_8c.html#adaa097d8f1c58fa0ca5de0cab4ed481f"   >datum_to_json</a>(val, <span style="color: rgb(0, 128, 0);"   >false</span>, result, tcategory, typoutput);
<a style="color: rgb(61, 87, 140);" name="l01252" rel="nofollow"   ></a>01252 
<a style="color: rgb(61, 87, 140);" name="l01253" rel="nofollow"   ></a>01253     <span style="color: rgb(128, 0, 0);"   >/* Clean up detoasted copy, if any */</span>
<a style="color: rgb(61, 87, 140);" name="l01254" rel="nofollow"   ></a>01254     <span style="color: rgb(224, 128, 0);"   >if</span> (val != orig_val)
<a style="color: rgb(61, 87, 140);" name="l01255" rel="nofollow"   ></a>01255         <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/mcxt_8c.html#a4de9741ca04b2f01a82d3de16a1d6bf2"   >pfree</a>(<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/postgres_8h.html#a728d1259d508437d9be53bf0b19c89da"   >DatumGetPointer</a>(val));
<a style="color: rgb(61, 87, 140);" name="l01256" rel="nofollow"   ></a>01256 
<a style="color: rgb(61, 87, 140);" name="l01257" rel="nofollow"   ></a>01257     <a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/fmgr_8h.html#a970208518860d1bee58894f8e6f6900a"   >PG_RETURN_TEXT_P</a>(<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/varlena_8c.html#ac4b9c571018d37d0565661ee87ed8c9a"   >cstring_to_text</a>(result-&gt;<a style="color: rgb(70, 101, 162);" rel="nofollow" href="http://doxygen.postgresql.org/structStringInfoData.html#a6bb235791ec526db9c48bca8de7e909f"   >data</a>));
<a style="color: rgb(61, 87, 140);" name="l01258" rel="nofollow"   ></a>01258 }</pre></div><div>12.&nbsp;</div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; background-color: rgb(224, 236, 239); border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"   ><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><code>hstore_to_json(hstore)</code></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >get&nbsp;<tt>hstore</tt>&nbsp;as a json value</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>hstore_to_json('"a key"=&gt;1, b=&gt;t, c=&gt;null, d=&gt;12345, e=&gt;012345, f=&gt;1.234, g=&gt;2.345e+4')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>{"a key": "1", "b": "t", "c": null, "d": "12345", "e": "012345", "f": "1.234", "g": "2.345e+4"}</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><code>hstore_to_json_loose(hstore)</code></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><tt>json</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >get&nbsp;<tt>hstore</tt>&nbsp;as a json value, but attempting to distinguish numerical and boolean values so they are unquoted in the json</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><tt>hstore_to_json('"a key"=&gt;1, b=&gt;t, c=&gt;null, d=&gt;12345, e=&gt;012345, f=&gt;1.234, g=&gt;2.345e+4')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><tt>{"a key": 1, "b": true, "c": null, "d": 12345, "e": "012345", "f": 1.234, "g": 2.345e+4}</tt></td></tr></table></div><div>13.&nbsp;</div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; background-color: rgb(224, 236, 239); border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"   ><thead><tr><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Function</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Description</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Example</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Example Result</th></tr></thead><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>array_to_json(anyarray [, pretty_bool])</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Returns the array as JSON. A PostgreSQL multidimensional array becomes a JSON array of arrays. Line feeds will be added between dimension 1 elements if&nbsp;<tt>pretty_bool</tt>&nbsp;is true.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>array_to_json('{{1,5},{99,100}}'::int[])</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>[[1,5],[99,100]]</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>row_to_json(record [, pretty_bool])</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Returns the row as JSON. Line feeds will be added between level 1 elements if&nbsp;<tt>pretty_bool</tt>&nbsp;is true.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>row_to_json(row(1,'foo'))</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>{"f1":1,"f2":"foo"}</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>to_json(anyelement)</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Returns the value as JSON. If the data type is not builtin, and there is a cast from the type to json, the cast function will be used to perform the conversion. Otherwise, for any value other than a number, a boolean or NULL, the text representation will be used, escaped and quoted so that it is legal JSON.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>to_json('Fred said "Hi."'</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>"Fred said \"Hi.\""</tt></td></tr></table></div></div>
	</div>
</div>
</body>
</html>