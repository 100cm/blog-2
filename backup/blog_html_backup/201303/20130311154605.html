<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL postmaster.pid removed cause database cann't startup case</h2>
	<h5 id="">2013-03-11 15:46:05&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201321134416413/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>群里一位兄弟因为postmaster.pid文件被删除, 导致数据库无法启动.&nbsp;</div><div>原因是数据库还在, 并且端口被占用, 当然是没有办法起来的.</div><div>下面是模拟这个过程 :&nbsp;</div><div>1. 删除一个已经启动的数据库的postmaster.pid文件</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >ocz@db-172-16-3-150-&gt; rm $PGDATA/postmaster.pid</font></div><div><font size="2"   >rm: remove regular file `/data05/ocz/pg_root/postmaster.pid'? y</font></div><p></p></pre></div></div><div>2. 关闭数据库失败, 由于关闭数据库需要读postmaster.pid文件. 当然后面有方法关闭.</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >ocz@db-172-16-3-150-&gt; pg_ctl stop -m fast</font></div><div><font size="2"   >pg_ctl: PID file "/data05/ocz/pg_root/postmaster.pid" does not exist</font></div><div><font size="2"   >Is server running?</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >3. 启动数据库失败, 因为端口已经被占用</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >ocz@db-172-16-3-150-&gt; pg_ctl start</font></div><div><font size="2"   >server starting</font></div><div><font size="2"   >ocz@db-172-16-3-150-&gt; LOG: &nbsp;XX000: could not bind IPv4 socket: Address already in use</font></div><div><font size="2"   >HINT: &nbsp;Is another postmaster already running on port 9201? If not, wait a few seconds and retry.</font></div><div><font size="2"   >LOCATION: &nbsp;StreamServerPort, pqcomm.c:438</font></div><div><font size="2"   >WARNING: &nbsp;01000: could not create listen socket for "0.0.0.0"</font></div><div><font size="2"   >LOCATION: &nbsp;PostmasterMain, postmaster.c:892</font></div><div><font size="2"   >FATAL: &nbsp;XX000: could not create any TCP/IP sockets</font></div><div><font size="2"   >LOCATION: &nbsp;PostmasterMain, postmaster.c:897</font></div><p></p></pre></div></div><div>4. 查看ipcs可以看到数据库占用的共享内存.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >ocz@db-172-16-3-150-&gt; ipcs</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >------ Shared Memory Segments --------</font></div><div><font size="2"   >key &nbsp; &nbsp; &nbsp; &nbsp;shmid &nbsp; &nbsp; &nbsp;owner &nbsp; &nbsp; &nbsp;perms &nbsp; &nbsp; &nbsp;bytes &nbsp; &nbsp; &nbsp;nattch &nbsp; &nbsp; status &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c6569 10878980 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;8814436352 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >------ Semaphore Arrays --------</font></div><div><font size="2"   >key &nbsp; &nbsp; &nbsp; &nbsp;semid &nbsp; &nbsp; &nbsp;owner &nbsp; &nbsp; &nbsp;perms &nbsp; &nbsp; &nbsp;nsems &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >0x008c6569 47710215 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656a 47742984 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656b 47775753 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656c 47808522 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656d 47841291 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656e 47874060 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656f 47906829 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >------ Message Queues --------</font></div><div><font size="2"   >key &nbsp; &nbsp; &nbsp; &nbsp;msqid &nbsp; &nbsp; &nbsp;owner &nbsp; &nbsp; &nbsp;perms &nbsp; &nbsp; &nbsp;used-bytes &nbsp; messages&nbsp;</font></div><p></p></pre></div><div><br></div><div>5. 实际上使用pg_ctl关闭数据库也是给postmaster进程发信号, 信号本文末尾已经指出.</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >ocz@db-172-16-3-150-&gt; ps -ewf|grep ocz</font></span></div><div><div><font size="2"   >root &nbsp; &nbsp; &nbsp;3022 &nbsp; &nbsp; 1 &nbsp;0 Feb03 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 /home/ocz/postgresql-9.2.1/contrib/postgresqlfs-b5b1a25/postgresqlfs /mnt</font></div><div><font size="2"   >root &nbsp; &nbsp; 24903 24868 &nbsp;0 08:11 pts/1 &nbsp; &nbsp;00:00:00 su - ocz</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;24904 24903 &nbsp;0 08:11 pts/1 &nbsp; &nbsp;00:00:00 -bash</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;24939 24904 &nbsp;0 08:11 pts/1 &nbsp; &nbsp;00:00:00 psql</font></div><div><font size="2"   >root &nbsp; &nbsp; 25608 25580 &nbsp;0 09:24 pts/4 &nbsp; &nbsp;00:00:00 su - ocz</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;25609 25608 &nbsp;0 09:24 pts/4 &nbsp; &nbsp;00:00:00 -bash</font></div><div><font size="2"   >root &nbsp; &nbsp; 28549 28482 &nbsp;0 14:38 pts/5 &nbsp; &nbsp;00:00:00 su - ocz</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;28550 28549 &nbsp;0 14:38 pts/5 &nbsp; &nbsp;00:00:00 -bash</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;29296 &nbsp; &nbsp; 1 &nbsp;0 15:39 pts/5 &nbsp; &nbsp;00:00:00 /home/ocz/pgsql9.2.1/bin/postgres</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;29297 29296 &nbsp;0 15:39 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: logger process &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;29299 29296 &nbsp;0 15:39 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: checkpointer process &nbsp;&nbsp;</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;29300 29296 &nbsp;0 15:39 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: writer process &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;29301 29296 &nbsp;0 15:39 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: wal writer process &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;29302 29296 &nbsp;0 15:39 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: archiver process &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;29303 29296 &nbsp;0 15:39 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: stats collector process &nbsp;&nbsp;</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;29318 28550 &nbsp;0 15:40 pts/5 &nbsp; &nbsp;00:00:00 ps -ewf</font></div><div><font size="2"   >ocz &nbsp; &nbsp; &nbsp;29319 28550 &nbsp;0 15:40 pts/5 &nbsp; &nbsp;00:00:00 grep ocz</font></div></div><p></p></pre></div><div><br></div><div>6. 手动给postmaster进程发关闭信号.</div><div><div><pre class="prettyprint"   ><p><font size="2"   >ocz@db-172-16-3-150-&gt; kill -15 29296</font></p></pre></div><div>关闭后ipcs看不到数据库占用的共享内存区域了</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >ocz@db-172-16-3-150-&gt; ipcs</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >------ Shared Memory Segments --------</font></div><div><font size="2"   >key &nbsp; &nbsp; &nbsp; &nbsp;shmid &nbsp; &nbsp; &nbsp;owner &nbsp; &nbsp; &nbsp;perms &nbsp; &nbsp; &nbsp;bytes &nbsp; &nbsp; &nbsp;nattch &nbsp; &nbsp; status &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >------ Semaphore Arrays --------</font></div><div><font size="2"   >key &nbsp; &nbsp; &nbsp; &nbsp;semid &nbsp; &nbsp; &nbsp;owner &nbsp; &nbsp; &nbsp;perms &nbsp; &nbsp; &nbsp;nsems &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >------ Message Queues --------</font></div><div><font size="2"   >key &nbsp; &nbsp; &nbsp; &nbsp;msqid &nbsp; &nbsp; &nbsp;owner &nbsp; &nbsp; &nbsp;perms &nbsp; &nbsp; &nbsp;used-bytes &nbsp; messages&nbsp;</font></div></div><div></div><p></p></pre></div></div><div>7. 现在启动数据库就可以了</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >ocz@db-172-16-3-150-&gt; pg_ctl start</font></div><div><font size="2"   >server starting</font></div><div><font size="2"   >ocz@db-172-16-3-150-&gt;&nbsp;</font></div><div><font size="2"   >ocz@db-172-16-3-150-&gt; ipcs</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >------ Shared Memory Segments --------</font></div><div><font size="2"   >key &nbsp; &nbsp; &nbsp; &nbsp;shmid &nbsp; &nbsp; &nbsp;owner &nbsp; &nbsp; &nbsp;perms &nbsp; &nbsp; &nbsp;bytes &nbsp; &nbsp; &nbsp;nattch &nbsp; &nbsp; status &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c6569 10911748 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;8814436352 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >------ Semaphore Arrays --------</font></div><div><font size="2"   >key &nbsp; &nbsp; &nbsp; &nbsp;semid &nbsp; &nbsp; &nbsp;owner &nbsp; &nbsp; &nbsp;perms &nbsp; &nbsp; &nbsp;nsems &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >0x008c6569 47939591 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656a 47972360 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656b 48005129 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656c 48037898 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656d 48070667 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656e 48103436 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >0x008c656f 48136205 &nbsp; ocz &nbsp; &nbsp; &nbsp; 600 &nbsp; &nbsp; &nbsp; &nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >------ Message Queues --------</font></div><div><font size="2"   >key &nbsp; &nbsp; &nbsp; &nbsp;msqid &nbsp; &nbsp; &nbsp;owner &nbsp; &nbsp; &nbsp;perms &nbsp; &nbsp; &nbsp;used-bytes &nbsp; messages</font></div><p></p></pre></div><div>8. 启动数据库后除了监听端口以外, 如果是*unix系统还有unix socket的占用 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >srwxrwxrwx &nbsp;1 ocz ocz &nbsp; &nbsp;0 Mar 11 15:41 .s.PGSQL.9201</font></div><div><font size="2"   >-rw------- &nbsp;1 ocz ocz &nbsp; 44 Mar 11 15:41 .s.PGSQL.9201.lock</font></div><p></p></pre></div><div><br></div><div>【参考】</div><div>1. man 7 signal</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Signal &nbsp; &nbsp; Value &nbsp; &nbsp; Action &nbsp; Comment</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGHUP &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; Term &nbsp; &nbsp;Hangup detected on controlling terminal</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;or death of controlling process</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGINT &nbsp; &nbsp; &nbsp; &nbsp;2 &nbsp; &nbsp; &nbsp; Term &nbsp; &nbsp;Interrupt from keyboard</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGQUIT &nbsp; &nbsp; &nbsp; 3 &nbsp; &nbsp; &nbsp; Core &nbsp; &nbsp;Quit from keyboard</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGILL &nbsp; &nbsp; &nbsp; &nbsp;4 &nbsp; &nbsp; &nbsp; Core &nbsp; &nbsp;Illegal Instruction</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGABRT &nbsp; &nbsp; &nbsp; 6 &nbsp; &nbsp; &nbsp; Core &nbsp; &nbsp;Abort signal from abort(3)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGFPE &nbsp; &nbsp; &nbsp; &nbsp;8 &nbsp; &nbsp; &nbsp; Core &nbsp; &nbsp;Floating point exception</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGKILL &nbsp; &nbsp; &nbsp; 9 &nbsp; &nbsp; &nbsp; Term &nbsp; &nbsp;Kill signal</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGSEGV &nbsp; &nbsp; &nbsp;11 &nbsp; &nbsp; &nbsp; Core &nbsp; &nbsp;Invalid memory reference</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGPIPE &nbsp; &nbsp; &nbsp;13 &nbsp; &nbsp; &nbsp; Term &nbsp; &nbsp;Broken pipe: write to pipe with no readers</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGALRM &nbsp; &nbsp; &nbsp;14 &nbsp; &nbsp; &nbsp; Term &nbsp; &nbsp;Timer signal from alarm(2)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGTERM &nbsp; &nbsp; &nbsp;15 &nbsp; &nbsp; &nbsp; Term &nbsp; &nbsp;Termination signal</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGUSR1 &nbsp; 30,10,16 &nbsp; &nbsp;Term &nbsp; &nbsp;User-defined signal 1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGUSR2 &nbsp; 31,12,17 &nbsp; &nbsp;Term &nbsp; &nbsp;User-defined signal 2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGCHLD &nbsp; 20,17,18 &nbsp; &nbsp;Ign &nbsp; &nbsp; Child stopped or terminated</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGCONT &nbsp; 19,18,25 &nbsp; &nbsp;Cont &nbsp; &nbsp;Continue if stopped</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGSTOP &nbsp; 17,19,23 &nbsp; &nbsp;Stop &nbsp; &nbsp;Stop process</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGTSTP &nbsp; 18,20,24 &nbsp; &nbsp;Stop &nbsp; &nbsp;Stop typed at tty</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGTTIN &nbsp; 21,21,26 &nbsp; &nbsp;Stop &nbsp; &nbsp;tty input for background process</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SIGTTOU &nbsp; 22,22,27 &nbsp; &nbsp;Stop &nbsp; &nbsp;tty output for background process</font></div><p></p></pre></div><div><br></div><div>2.&nbsp;src/bin/pg_ctl/pg_ctl.c</div><div>三种关库模式对应信号是SIGTERM, SIGINT, SIGQUIT.</div><div>smart : 需要等待已有连接断开,&nbsp;</div><div>fast : 主动回滚事务, 断开已有连接,&nbsp;</div><div>immediate : 强制关库</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >static void</font></div><div><font size="2"   >set_mode(char *modeopt)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (strcmp(modeopt, "s") == 0 || strcmp(modeopt, "smart") == 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shutdown_mode = SMART_MODE;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sig = SIGTERM;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else if (strcmp(modeopt, "f") == 0 || strcmp(modeopt, "fast") == 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shutdown_mode = FAST_MODE;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sig = SIGINT;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else if (strcmp(modeopt, "i") == 0 || strcmp(modeopt, "immediate") == 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shutdown_mode = IMMEDIATE_MODE;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sig = SIGQUIT;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; write_stderr(_("%s: unrecognized shutdown mode \"%s\"\n"), progname, modeopt);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; do_advice();</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit(1);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >}</font></div><p></p></pre></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL postmaster.pid removed cause database cannt startup case - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>