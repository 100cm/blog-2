<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL software version archive</h2>
	<h5 id="">2014-05-27 9:37:15&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201442792833336/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>在使用PostgreSQL过程中, 会不断的放出补丁, 为了更好的管理生产环境中用到的数据库环境, 我们需要对每个用过的版本做好归档, 以便后续可以有据可查.</div><div>版本归档除了数据库软件本身, 应该还包括它所运行的环境的状态.</div><div>收集依赖库主要是为操作系统补丁做好兼容性预测准备.</div><div>例如.</div><div>我们需要归档的信息如下 :&nbsp;</div><div>PostgreSQL 软件归档模板&nbsp;</div><div><br></div><div>1. 数据库档案</div><div>&nbsp; &nbsp; 基础信息</div><div>&nbsp; &nbsp; 变更信息</div><div><br></div><div>2. 软件归档</div><div>&nbsp; &nbsp; 软件bin</div><div>&nbsp; &nbsp; 源代码</div><div>&nbsp; &nbsp; 生成二进制文件前的基础库文件</div><div><br></div><div>一. 数据库档案</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >编号</font></div><div><font size="2"   >系统说明</font></div><div><font size="2"   >数据库 IP, PORT</font></div><div><font size="2"   >时间</font></div><div><font size="2"   >1. 操作系统版本</font></div><div><font size="2"   >2. 操作系统包列表, 包括版本号</font></div><div><font size="2"   >rpm -qa</font></div><div><font size="2"   >3. 操作系统内核参数</font></div><div><font size="2"   >sysctl -a</font></div><div><font size="2"   >4. 操作系统内核版本</font></div><div><font size="2"   >uname -a</font></div><div><font size="2"   >5. 操作系统内核编译开关</font></div><div><font size="2"   >cat /boot/config-`uname -r`</font></div><div><font size="2"   >6. 数据库软件版本</font></div><div><font size="2"   >PostgreSQL 9.3.3</font></div><div><font size="2"   >7. 数据库编译参数</font></div><div><font size="2"   >取pg_config输出</font></div><div><font size="2"   >BINDIR = /home/pg93/pgsql9.3.3/bin</font></div><div><font size="2"   >DOCDIR = /home/pg93/pgsql9.3.3/share/doc</font></div><div><font size="2"   >HTMLDIR = /home/pg93/pgsql9.3.3/share/doc</font></div><div><font size="2"   >INCLUDEDIR = /home/pg93/pgsql9.3.3/include</font></div><div><font size="2"   >PKGINCLUDEDIR = /home/pg93/pgsql9.3.3/include</font></div><div><font size="2"   >INCLUDEDIR-SERVER = /home/pg93/pgsql9.3.3/include/server</font></div><div><font size="2"   >LIBDIR = /home/pg93/pgsql9.3.3/lib</font></div><div><font size="2"   >PKGLIBDIR = /home/pg93/pgsql9.3.3/lib</font></div><div><font size="2"   >LOCALEDIR = /home/pg93/pgsql9.3.3/share/locale</font></div><div><font size="2"   >MANDIR = /home/pg93/pgsql9.3.3/share/man</font></div><div><font size="2"   >SHAREDIR = /home/pg93/pgsql9.3.3/share</font></div><div><font size="2"   >SYSCONFDIR = /home/pg93/pgsql9.3.3/etc</font></div><div><font size="2"   >PGXS = /home/pg93/pgsql9.3.3/lib/pgxs/src/makefiles/pgxs.mk</font></div><div><font size="2"   >CONFIGURE = '--prefix=/home/pg93/pgsql9.3.3' '--with-pgport=1922' '--with-perl' '--with-tcl' '--with-python' '--with-openssl' '--with-pam' '--without-ldap' '--with-libxml' '--with-libxslt' '--enable-thread-safety' '--with-wal-blocksize=64' '--with-blocksize=32' '--enable-dtrace' '--enable-debug' '--enable-cassert'</font></div><div><font size="2"   >CC = gcc</font></div><div><font size="2"   >CPPFLAGS = -D_GNU_SOURCE -I/usr/include/libxml2</font></div><div><font size="2"   >CFLAGS = -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -g -DLOCK_DEBUG -DBTREE_BUILD_STATS -DWAL_DEBUG -DOPTIMIZER_DEBUG -DGEQO_DEBUG -DCOPY_PARSE_PLAN_TREES -DTRACE_SYNCSCAN</font></div><div><font size="2"   >CFLAGS_SL = -fpic</font></div><div><font size="2"   >LDFLAGS = -L../../../src/common -Wl,--as-needed -Wl,-rpath,'/home/pg93/pgsql9.3.3/lib',--enable-new-dtags</font></div><div><font size="2"   >LDFLAGS_EX =&nbsp;</font></div><div><font size="2"   >LDFLAGS_SL =&nbsp;</font></div><div><font size="2"   >LIBS = -lpgport -lpgcommon -lxslt -lxml2 -lpam -lssl -lcrypto -lz -lreadline -lcrypt -ldl -lm&nbsp;</font></div><div><font size="2"   >VERSION = PostgreSQL 9.3.3</font></div><div><font size="2"   >8. 数据库软件依赖的动态链接库</font></div><div><font size="2"   >cat test.sh</font></div><div><font size="2"   >#!/bin/bash</font></div><div><font size="2"   >PGHOME=$1</font></div><div><font size="2"   >for i in `ldd $PGHOME/bin/*|grep -oP "(/.*) "|sort|uniq`; do</font></div><div><font size="2"   >&nbsp; rpm -qf $i</font></div><div><font size="2"   >done</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >for i in `ldd $PGHOME/lib/*|grep -oP "(/.*) "|sort|uniq`; do</font></div><div><font size="2"   >&nbsp; rpm -qf $i</font></div><div><font size="2"   >done</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# ./test.sh /home/pg93/pgsql9.3.3|sort|uniq</font></div><div><font size="2"   >ldd: warning: you do not have execution permission for `/home/pg93/pgsql9.3.3/lib/libecpg.a'</font></div><div><font size="2"   >ldd: warning: you do not have execution permission for `/home/pg93/pgsql9.3.3/lib/libecpg_compat.a'</font></div><div><font size="2"   >ldd: warning: you do not have execution permission for `/home/pg93/pgsql9.3.3/lib/libpgcommon.a'</font></div><div><font size="2"   >ldd: warning: you do not have execution permission for `/home/pg93/pgsql9.3.3/lib/libpgport.a'</font></div><div><font size="2"   >ldd: warning: you do not have execution permission for `/home/pg93/pgsql9.3.3/lib/libpgtypes.a'</font></div><div><font size="2"   >ldd: warning: you do not have execution permission for `/home/pg93/pgsql9.3.3/lib/libpq.a'</font></div><div><font size="2"   >ldd: /home/pg93/pgsql9.3.3/lib/pgxs: not regular file</font></div><div><font size="2"   >ldd: /home/pg93/pgsql9.3.3/lib/pkgconfig: not regular file</font></div><div><font size="2"   >audit-libs-2.2-2.el6.x86_64</font></div><div><font size="2"   >file /home/pg93/pgsql9.3.3/lib/libecpg.so.6 is not owned by any package</font></div><div><font size="2"   >file /home/pg93/pgsql9.3.3/lib/libpgtypes.so.3 is not owned by any package</font></div><div><font size="2"   >file /home/pg93/pgsql9.3.3/lib/libpq.so.5 is not owned by any package</font></div><div><font size="2"   >file /opt/python2.7.6/lib/libpython2.7.so.1.0 is not owned by any package</font></div><div><font size="2"   >file /opt/scws-1.2.2/lib/libscws.so.1 is not owned by any package</font></div><div><font size="2"   >glibc-2.12-1.132.el6.x86_64</font></div><div><font size="2"   >keyutils-libs-1.4-4.el6.x86_64</font></div><div><font size="2"   >krb5-libs-1.10.3-10.el6_4.6.x86_64</font></div><div><font size="2"   >libcom_err-1.41.12-14.el6_4.2.x86_64</font></div><div><font size="2"   >libselinux-2.0.94-5.3.el6.x86_64</font></div><div><font size="2"   >libxml2-2.7.6-12.el6_4.1.x86_64</font></div><div><font size="2"   >libxslt-1.1.26-2.el6_3.1.x86_64</font></div><div><font size="2"   >ncurses-libs-5.7-3.20090208.el6.x86_64</font></div><div><font size="2"   >nss-softokn-freebl-3.12.9-11.el6.x86_64</font></div><div><font size="2"   >openssl-1.0.1e-16.el6_5.7.x86_64</font></div><div><font size="2"   >pam-1.1.1-13.el6.x86_64</font></div><div><font size="2"   >perl-libs-5.10.1-129.el6.x86_64</font></div><div><font size="2"   >protobuf-c-0.15-2.el6.x86_64</font></div><div><font size="2"   >readline-6.0-4.el6.x86_64</font></div><div><font size="2"   >tcl-8.5.7-6.el6.x86_64</font></div><div><font size="2"   >zlib-1.2.3-29.el6.x86_64</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >9. 数据库第三方插件版本</font></div><div><font size="2"   >pgfincore-a38098e</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >10. 数据库第三方插件编译参数</font></div><div><font size="2"   >无</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >11. 数据库第三方插件依赖的动态链接库</font></div><div><font size="2"   >无</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >12. 数据库定制代码源文件, 补丁文件版本号</font></div><div><font size="2"   >无</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >13. 基于C的数据库函数源码文件版本号</font></div><div><font size="2"   >无</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >14. 使用的第三方语言的软件版本, 例如plpython依赖python的lib库, 需记录python的lib库版本.</font></div><div><font size="2"   >无, 已在PostgreSQL依赖库中反映</font></div><p></p></pre></div><div><br></div><div>二. 软件bin文件归档</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >1. 数据库软件</font></div><div><font size="2"   >2. 第三方插件软件</font></div><div><font size="2"   >3. 定制代码软件(如果已经合并到PostgreSQL软件本体,则此处不需要)</font></div><div><font size="2"   >4. 基于C的数据库函数的动态链接库(如果已经合并到数据库软件则此处不需要)</font></div><p></p></pre></div><div><br></div><div>三. 源代码归档</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >1. 数据库软件源代码</font></div><div><font size="2"   >2. 第三方插件软件源代码</font></div><div><font size="2"   >3. 数据库定制代码的更改前后的源代码</font></div><div><font size="2"   >4. 基于C的数据库函数源代码</font></div><p></p></pre></div><div><br></div><div>四. 生成二进制文件前的基础库文件归档</div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL software version archive - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>