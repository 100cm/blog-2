<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">zpool use 4KiB sector</h2>
	<h5 id="">2014-05-27 16:15:25&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014427495425/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>默认情况下, 创建top-level dev如果不指定扇区大小, 那么使用vdevs中最小的扇区大小作为zpool的扇区大小.</div><div>但是某些设备虽然是4K的扇区, 但是可能内核读到的扇区大小可能是512字节.</div><div>这样的话, 将对影响有比较大的影响, 所以在这种情况下, 创建zpool时可以指定扇区的大小. 添加top-devel时也可以指定扇区的大小, 尽量使用扇区大小一致的设备.</div><div><br></div><div>zpool创建完后不允许修改扇区的大小.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 man8]# zpool set ashift=9 zpp&nbsp;</font></div><div><font size="2"   >cannot set property for 'zpp': property 'ashift' can only be set at creation time</font></div><p></p></pre></div><div><br></div><div>top-level vdev的扇区大小指定.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 man8]# zpool create -o ashift=12 zpp mirror /ssd1/zfs.1 /ssd1/zfs.2</font></div><div><div><font size="2"   >[root@db-172-16-3-150 man8]# zpool get all zpp|grep ashift</font></div><div><font size="2"   >zpp &nbsp; ashift &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; local</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@db-172-16-3-150 man8]# zpool get all zpp</font></div><div><font size="2"   >NAME &nbsp;PROPERTY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VALUE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SOURCE</font></div><div><font size="2"   >zpp &nbsp; size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 95.5M &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zpp &nbsp; capacity &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0% &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >zpp &nbsp; altroot &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zpp &nbsp; health &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >zpp &nbsp; guid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10118330420533444691 &nbsp; default</font></div><div><font size="2"   >zpp &nbsp; version &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zpp &nbsp; bootfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zpp &nbsp; delegation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zpp &nbsp; autoreplace &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zpp &nbsp; cachefile &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zpp &nbsp; failmode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wait &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zpp &nbsp; listsnapshots &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zpp &nbsp; autoexpand &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zpp &nbsp; dedupditto &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zpp &nbsp; dedupratio &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.00x &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zpp &nbsp; free &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 94.9M &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zpp &nbsp; allocated &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;612K &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >zpp &nbsp; readonly &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zpp &nbsp; ashift &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; local</font></div><div><font size="2"   >zpp &nbsp; comment &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zpp &nbsp; expandsize &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zpp &nbsp; freeing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zpp &nbsp; feature@async_destroy &nbsp;enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;local</font></div><div><font size="2"   >zpp &nbsp; feature@empty_bpobj &nbsp; &nbsp;enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;local</font></div><div><font size="2"   >zpp &nbsp; feature@lz4_compress &nbsp; enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;local</font></div></div><p></p></pre></div><div>添加top-level vdev时也可以指定.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-150 zpp]# zpool add -o ashift=10 zpp mirror /ssd1/zfs.5 /ssd1/zfs.6</font></div><div><font size="2"   >[root@db-172-16-3-150 zpp]# dd if=/dev/zero of=./test1 bs=1k count=102400</font></div><div><font size="2"   >102400+0 records in</font></div><div><font size="2"   >102400+0 records out</font></div><div><font size="2"   >104857600 bytes (105 MB) copied, 2.75559 s, 38.1 MB/s</font></div></div><div><div><font size="2"   >[root@db-172-16-3-150 zpp]# zpool list -v zpp</font></div><div><font size="2"   >NAME &nbsp; SIZE &nbsp;ALLOC &nbsp; FREE &nbsp; &nbsp;CAP &nbsp;DEDUP &nbsp;HEALTH &nbsp;ALTROOT</font></div><div><font size="2"   >zpp &nbsp; 286M &nbsp; 204M &nbsp;82.8M &nbsp; &nbsp;71% &nbsp;1.00x &nbsp;ONLINE &nbsp;-</font></div><div><font size="2"   >&nbsp; mirror &nbsp;95.5M &nbsp;78.3M &nbsp;17.2M &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >&nbsp; &nbsp; /ssd1/zfs.1 &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >&nbsp; &nbsp; /ssd1/zfs.2 &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >&nbsp; mirror &nbsp;95.5M &nbsp;81.1M &nbsp;14.4M &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >&nbsp; &nbsp; /ssd1/zfs.3 &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >&nbsp; &nbsp; /ssd1/zfs.4 &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >&nbsp; mirror &nbsp;95.5M &nbsp;44.3M &nbsp;51.2M &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >&nbsp; &nbsp; /ssd1/zfs.5 &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >&nbsp; &nbsp; /ssd1/zfs.6 &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; -</font></div></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1. man zpool</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >The following property can be set at creation time:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;ashift</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Pool &nbsp;sector &nbsp;size exponent, to the power of 2 (internally referred to as "ashift"). I/O operations will be</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;aligned to the specified size boundaries. Additionally, the minimum (disk) write size will be &nbsp;set &nbsp;to &nbsp;the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;specified &nbsp;size, &nbsp;so &nbsp;this &nbsp;represents a space vs. performance trade-off. The typical case for setting this</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;property is when performance is important and the underlying disks use 4KiB sectors but report 512B sectors</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to the OS (for compatibility reasons); in that case, set ashift=12 (which is 1&lt;&lt;12 = 4096).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;For &nbsp;optimal &nbsp;performance, &nbsp;the &nbsp;pool sector size should be greater than or equal to the sector size of the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;underlying disks. Since the property cannot be changed after pool creation, if in a given &nbsp;pool, &nbsp;you &nbsp;ever</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;want to use drives that report 4KiB sectors, you must set ashift=12 at pool creation time.</font></div><p></p></pre></div>2. 其他属性<div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&nbsp; &nbsp;Properties</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Each pool has several properties associated with it. Some properties are read-only statistics while others &nbsp;are</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;configurable and change the behavior of the pool. The following are read-only properties:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;available &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Amount &nbsp;of &nbsp;storage available within the pool. This property can also be referred to by its</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;shortened column name, "avail".</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;capacity &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Percentage of pool space used. This property can also be referred to by its shortened &nbsp;col-</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;umn name, "cap".</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;expandsize &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Amount &nbsp;of &nbsp;uninitialized &nbsp;space within the pool or device that can be used to increase the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;total capacity of the pool. &nbsp;Uninitialized space consists of any space on &nbsp;an &nbsp;EFI &nbsp;labeled</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vdev &nbsp;which &nbsp;has &nbsp;not been brought online (i.e. zpool online -e). &nbsp;This space occurs when a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LUN is dynamically expanded.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;free &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The amount of free space available in the pool.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;freeing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; After a file system or snapshot is destroyed, the space it was using &nbsp;is &nbsp;returned &nbsp;to &nbsp;the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pool &nbsp;asynchronously. &nbsp;freeing &nbsp;is the amount of space remaining to be reclaimed. Over time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;freeing will decrease while free increases.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;health &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The current health of the pool. Health can be "ONLINE", "DEGRADED", "FAULTED", " &nbsp;OFFLINE",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"REMOVED", or "UNAVAIL".</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;guid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;A unique identifier for the pool.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Total size of the storage pool.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;unsupported@feature_Information &nbsp;about unsupported features that are enabled on the pool. See zpool-features(5)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for details.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;used &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Amount of storage space used within the pool.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The space usage properties report actual physical space available to the storage pool. The physical &nbsp;space &nbsp;can</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;be &nbsp;different &nbsp;from the total amount of space that any contained datasets can actually use. The amount of space</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;used in a raidz configuration depends on the characteristics of &nbsp;the &nbsp;data &nbsp;being &nbsp;written. &nbsp;In &nbsp;addition, &nbsp;ZFS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;reserves &nbsp;some &nbsp;space for internal accounting that the zfs(8) command takes into account, but the zpool command</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;does not. For non-full pools of a reasonable size, these effects should be invisible. For small pools, or pools</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;that are close to being completely full, these discrepancies may become more noticeable.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The following property can be set at creation time:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;ashift</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Pool &nbsp;sector &nbsp;size exponent, to the power of 2 (internally referred to as "ashift"). I/O operations will be</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;aligned to the specified size boundaries. Additionally, the minimum (disk) write size will be &nbsp;set &nbsp;to &nbsp;the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;specified &nbsp;size, &nbsp;so &nbsp;this &nbsp;represents a space vs. performance trade-off. The typical case for setting this</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;property is when performance is important and the underlying disks use 4KiB sectors but report 512B sectors</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to the OS (for compatibility reasons); in that case, set ashift=12 (which is 1&lt;&lt;12 = 4096).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;For &nbsp;optimal &nbsp;performance, &nbsp;the &nbsp;pool sector size should be greater than or equal to the sector size of the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;underlying disks. Since the property cannot be changed after pool creation, if in a given &nbsp;pool, &nbsp;you &nbsp;ever</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;want to use drives that report 4KiB sectors, you must set ashift=12 at pool creation time.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The following property can be set at creation time and import time:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;altroot</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Alternate root directory. If set, this directory is prepended to any mount points within the pool. This can</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;be used when examining an unknown pool where the mount points cannot be trusted, or in &nbsp;an &nbsp;alternate &nbsp;boot</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;environment, &nbsp;where the typical paths are not valid. altroot is not a persistent property. It is valid only</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while the system is up. Setting altroot defaults to using cachefile=none, though &nbsp;this &nbsp;may &nbsp;be &nbsp;overridden</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;using an explicit setting.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The following properties can be set at creation time and import time, and later changed with the zpool set com-</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;mand:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;autoexpand=on | off</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Controls automatic pool expansion when the underlying LUN is grown. If set to on, the pool will be &nbsp;resized</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;according &nbsp;to &nbsp;the size of the expanded device. If the device is part of a mirror or raidz then all devices</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;within that mirror/raidz group must be expanded before the new space is made available &nbsp;to &nbsp;the &nbsp;pool. &nbsp;The</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default behavior is off. This property can also be referred to by its shortened column name, expand.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;autoreplace=on | off</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Controls &nbsp;automatic device replacement. If set to "off", device replacement must be initiated by the admin-</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;istrator by using the "zpool replace" command. If set to "on", any new device, found in the &nbsp;same &nbsp;physical</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;location &nbsp;as &nbsp;a &nbsp;device &nbsp;that previously belonged to the pool, is automatically formatted and replaced. The</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default behavior is "off". This property can also be referred to by its shortened column name, "replace".</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;bootfs=pool/dataset</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Identifies the default bootable dataset for the root pool. This property is expected to be &nbsp;set &nbsp;mainly &nbsp;by</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;the installation and upgrade programs.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;cachefile=path | none</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Controls &nbsp;the &nbsp;location &nbsp;of where the pool configuration is cached. Discovering all pools on system startup</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;requires a cached copy of the configuration data that is stored on the root file system. All pools in &nbsp;this</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cache &nbsp;are automatically imported when the system boots. Some environments, such as install and clustering,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;need to cache this information in a different location so that pools are not automatically &nbsp;imported. &nbsp;Set-</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ting &nbsp;this &nbsp;property &nbsp;caches the pool configuration in a different location that can later be imported with</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"zpool import -c". Setting it to the special value "none" creates a temporary pool that &nbsp;is &nbsp;never &nbsp;cached,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;and the special value ’’ (empty string) uses the default location.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Multiple &nbsp;pools &nbsp;can &nbsp;share &nbsp;the &nbsp;same cache file. Because the kernel destroys and recreates this file when</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pools are added and removed, care should be taken when attempting to access this file. When the &nbsp;last &nbsp;pool</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;using a cachefile is exported or destroyed, the file is removed.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;comment=text</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;A &nbsp;text &nbsp;string consisting of printable ASCII characters that will be stored such that it is available even</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if the pool becomes faulted. &nbsp;An administrator can provide additional information about a pool &nbsp;using &nbsp;this</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;property.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;delegation=on | off</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Controls &nbsp;whether &nbsp;a &nbsp;non-privileged user is granted access based on the dataset permissions defined on the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dataset. See zfs(8) for more information on ZFS delegated administration.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;failmode=wait | continue | panic</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Controls the system behavior in the event of catastrophic pool &nbsp;failure. &nbsp;This &nbsp;condition &nbsp;is &nbsp;typically &nbsp;a</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;result of a loss of connectivity to the underlying storage device(s) or a failure of all devices within the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pool. The behavior of such an event is determined as follows:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wait &nbsp; &nbsp; &nbsp; &nbsp;Blocks all I/O access until the device connectivity is recovered and the &nbsp;errors &nbsp;are &nbsp;cleared.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;This is the default behavior.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;continue &nbsp; &nbsp;Returns &nbsp;EIO &nbsp;to &nbsp;any &nbsp;new &nbsp;write I/O requests but allows reads to any of the remaining healthy</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;devices. Any write requests that have yet to be committed to disk would be blocked.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;panic &nbsp; &nbsp; &nbsp; Prints out a message to the console and generates a system crash dump.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;feature@feature_name=enabled</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The value of this property is the current state of feature_name. The only valid &nbsp;value &nbsp;when &nbsp;setting &nbsp;this</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;property &nbsp;is &nbsp;enabled &nbsp;which &nbsp;moves feature_name to the enabled state. See zpool-features(5) for details on</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;feature states.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;listsnaps=on | off</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Controls whether information about snapshots associated with this pool is output when &nbsp;"zfs &nbsp;list" &nbsp;is &nbsp;run</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;without the -t option. The default value is "off".</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;version=version</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The &nbsp;current &nbsp;on-disk version of the pool. This can be increased, but never decreased. The preferred method</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;of updating pools is with the "zpool upgrade" command, though this property can be &nbsp;used &nbsp;when &nbsp;a &nbsp;specific</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;version &nbsp;is needed for backwards compatibility. Once feature flags are enabled on a pool this property will</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;no longer have a value.</font></div></div><p></p></pre></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="zpool use 4KiB sector - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>