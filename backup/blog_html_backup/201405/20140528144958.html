<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">CentOS 6.x Cluster configure Best Practices with ccs command</h2>
	<h5 id="">2014-05-28 14:49:58&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014428985260/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div><span style="line-height: 28px;"   >架构借用一张以前的图片, 当时用的是CentOS 5.x. 其实配置方法和6.x差不多.</span></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201041110156427/"   >http://blog.163.com/digoal@126/blog/static/163877040201041110156427/</a></div><div>这个架构实际上跑了两个服务, 1个数据库, 1个memcached. 分别跑在两台主机上. 互为主备.</div><div>使用共享存储来存放PostgreSQL的数据.</div><div><div><img title="CentOS 6.x Cluster configure with ccs command - 德哥@Digoal - PostgreSQL"   alt="CentOS 6.x Cluster configure with ccs command - 德哥@Digoal - PostgreSQL"   style="margin:0 10px 0 0;"   src="http://img383.ph.126.net/vYPbZenw-J8PStgMTYY81Q==/2414492350224554254.jpg"   ></div>&nbsp;</div><div>本文将讲解一下CentOS 6.x下的共享存储的数据库集群配置.</div><div>简化讲解, 本文的例子只跑1个数据库服务.</div><div>首先安装必要的包 :&nbsp;</div><pre class="prettyprint"   ><p></p><div><font size="2"   >yum install -y cluster rgmanager* cman* lvm2* gfs2* cmirror ccs</font></div><div><div style="line-height: 28px;"   ></div></div><p></p></pre><div><span style="line-height: 28px;"   >关闭这两台主机的高级电源管理服务, 方便fence.</span></div><div><pre class="prettyprint"   ><p></p><div><div style="line-height: 28px;"   ><font size="2"   >chkconfig acpid off</font></div></div><div></div><p></p></pre><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >创建cluster.conf配置文件. 如果配置文件已经存在的话会覆盖掉. 集群名yumdemo.</span></div></div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 ~]# ccs -f /etc/cluster/cluster.conf --createcluster yumdemo</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >添加两台主机.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addnode 192.168.10.146</font></div><div><font size="2"   >Node 192.168.10.146 added.</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addnode 192.168.10.150</font></div><div><font size="2"   >Node 192.168.10.150 added.</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --lsnodes</font></div><div><font size="2"   >192.168.10.146: nodeid=1</font></div><div><font size="2"   >192.168.10.150: nodeid=2</font></div><p></p></pre></div><div>添加完后, 配置文件如下</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="3" name="yumdemo"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.146" nodeid="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.150" nodeid="2"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices/&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div><div>为两台主机添加两个fence方法, 方法名字随意.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addmethod BMC 192.168.10.146</font></div><div><font size="2"   >Method BMC added to 192.168.10.146.</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addmethod BMC 192.168.10.150</font></div><div><font size="2"   >Method BMC added to 192.168.10.150.</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="5" name="yumdemo"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.146" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.150" nodeid="2"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices/&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div><div><br></div><div>设置fence的属性, fail延迟和加入延迟.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --setfencedaemon post_fail_delay=6 post_join_delay=30</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="8" name="yumdemo"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon post_fail_delay="6" post_join_delay="30"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.146" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.150" nodeid="2"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices/&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div><div><br></div><div>本文两台主机的fence设备是服务器的管理卡, 所以我们首先要<span style="line-height: 28px;"   >配置服务器的ipmi接口.</span></div><div><span style="line-height: 28px;"   >一般在bios或WEB中可以配置, 注意开启用户的ipmi功能, 选择适当的角色.&nbsp;</span></div><div><span style="line-height: 28px;"   >例如本文两台联想的服务器, 角色OPERATOR.</span></div><div>测试ipmi管理是否正常</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-150 ~]# fence_ipmilan -a 192.168.9.66 -l user2014 -p abc -o status -L OPERATOR</font></div><div><font size="2"   >Getting status of IPMI:192.168.9.66...Chassis power = On</font></div><div><font size="2"   >Done</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-192-168-10-150 ~]# fence_ipmilan -a 192.168.9.72 -l user -p abc -o status -L OPERATOR</font></div><div><font size="2"   >Getting status of IPMI:192.168.9.72...Chassis power = On</font></div><div><font size="2"   >Done</font></div><p></p></pre></div><div><br></div><div>查看操作系统支持的fence设备, 以及fence设备对应的配置项, 参考本文末尾.</div><div>这里用到的agent为fence_ipmilan</div><div>添加两个fence设备, 对应的用户密码等属性. fence设备的名称注意区分, 分别用于两台主机的fence.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addfencedev fence_146 agent=fence_ipmilan ipaddr=192.168.9.66 login=user2014 passwd=abc privlvl=OPERATOR</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addfencedev fence_150 agent=fence_ipmilan ipaddr=192.168.9.72 login=user passwd=abc privlvl=OPERATOR</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="10" name="yumdemo"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon post_fail_delay="6" post_join_delay="30"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.146" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.150" nodeid="2"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.66" login="user2014" name="fence_146" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.72" login="user" name="fence_150" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div><div><br></div><div>为每台主机添加对应的fence操作, 注意对应的fence设备名, 是上一步添加的fence设备名.</div><div>fence设备的属性见本文末尾. 我们这里使用到的是action=off和action=on, 用于关机和开机.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addfenceinst fence_146 192.168.10.146 BMC action=off</font></div><div><span style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addfenceinst fence_146 192.168.10.146 BMC action=on</font></span></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addfenceinst fence_150 192.168.10.150 BMC action=off</font></div><div><span style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addfenceinst fence_150 192.168.10.150 BMC action=on</font></span></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="12" name="yumdemo"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon post_fail_delay="6" post_join_delay="30"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.146" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_146"/&gt;</font></div><div><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_146"/&gt;</font></span></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.150" nodeid="2"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_150"/&gt;</font></div><div><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_150"/&gt;</font></span></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.66" login="user2014" name="fence_146" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.72" login="user" name="fence_150" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div><div><br></div><div>新建failover域, failover域支持的属性见本文末尾 &nbsp;:&nbsp;</div><div>这里开启了ordered, 但是不开启failback.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addfailoverdomain yumdemo_fd restricted ordered nofailback</font></span></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="13" name="yumdemo"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon post_fail_delay="6" post_join_delay="30"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.146" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_146"/&gt;</font></div><div><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_146"/&gt;</font></span></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.150" nodeid="2"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_150"/&gt;</font></div><div><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_150"/&gt;</font></span></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.66" login="user2014" name="fence_146" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.72" login="user" name="fence_150" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;failoverdomain name="yumdemo_fd" nofailback="1" ordered="1" restricted="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div><div><br></div><div>把两台主机添加到failover域.</div><div>优先级都设置为1.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addfailoverdomainnode yumdemo_fd 192.168.10.146 1</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addfailoverdomainnode yumdemo_fd 192.168.10.150 1</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="15" name="yumdemo"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon post_fail_delay="6" post_join_delay="30"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.146" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_146"/&gt;</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_146"/&gt;</font></span></div></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.150" nodeid="2"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_150"/&gt;</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_150"/&gt;</font></span></div></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.66" login="user2014" name="fence_146" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.72" login="user" name="fence_150" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;failoverdomain name="yumdemo_fd" nofailback="1" ordered="1" restricted="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;failoverdomainnode name="192.168.10.146" priority="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;failoverdomainnode name="192.168.10.150" priority="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/failoverdomain&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div><div><br></div><div>列出系统支持的资源, 以及资源对应的配置项.</div><div>添加虚拟IP资源.</div><div>后面的服务中会用到这里的资源.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addresource ip address=192.168.10.151 monitor_link=1</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="20" name="yumdemo"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon post_fail_delay="6" post_join_delay="30"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.146" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_146"/&gt;</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_146"/&gt;</font></span></div></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.150" nodeid="2"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_150"/&gt;</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_150"/&gt;</font></span></div></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.66" login="user2014" name="fence_146" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.72" login="user" name="fence_150" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;failoverdomain name="yumdemo_fd" nofailback="1" ordered="1" restricted="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;failoverdomainnode name="192.168.10.146" priority="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;failoverdomainnode name="192.168.10.150" priority="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/failoverdomain&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;ip address="192.168.10.151" monitor_link="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/resources&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div><div><br></div><div>添加服务, 服务的属性见本文末尾.</div><div>不使用自动启动. 因为它不需要在两个节点同时启用, 只能在一个节点启用.&nbsp;</div><div>对于共享服务的话, 可以自动启用, 但也要考虑启用顺序, 例如共享卷, 可以考虑自动启用.</div><div><pre class="prettyprint"   ><p><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addservice yumdemo_pg domain=yumdemo_fd autostart=0&nbsp;</font></p></pre></div><div>在上一步添加的服务中, 添加子服务, 即资源. 我们这里把IP资源作为子服务添加到这个服务下.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --addsubservice yumdemo_pg ip ref=192.168.10.151</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="27" name="yumdemo"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon post_fail_delay="6" post_join_delay="30"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.146" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_146"/&gt;</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_146"/&gt;</font></span></div></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.150" nodeid="2"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_150"/&gt;</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_150"/&gt;</font></span></div></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.66" login="user2014" name="fence_146" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.72" login="user" name="fence_150" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;failoverdomain name="yumdemo_fd" nofailback="1" ordered="1" restricted="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;failoverdomainnode name="192.168.10.146" priority="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;failoverdomainnode name="192.168.10.150" priority="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/failoverdomain&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;ip address="192.168.10.151" monitor_link="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/resources&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;service autostart="0" domain="yumdemo_fd" name="yumdemo_pg"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;ip ref="192.168.10.151"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/service&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div><div><br></div><div>设置cluster management的参数. 本文使用2个节点, 所以投票时单节点无法满足超过一半的票数.</div><div>那么需要设置这里的CMAN属性为2节点, 期望票数为1.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --setcman two_node=1 expected_votes=1</font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="2" name="yumdemo"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon post_fail_delay="6" post_join_delay="30"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.146" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_146"/&gt;</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_146"/&gt;</font></span></div></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="192.168.10.150" nodeid="2"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="BMC"&gt;</font></div><div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" name="fence_150"/&gt;</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" name="fence_150"/&gt;</font></span></div></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman expected_votes="1" two_node="1"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.66" login="user2014" name="fence_146" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_ipmilan" ipaddr="192.168.9.72" login="user" name="fence_150" passwd="abc" privlvl="OPERATOR"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;failoverdomain name="yumdemo_fd" nofailback="1" ordered="1" restricted="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;failoverdomainnode name="192.168.10.146" priority="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;failoverdomainnode name="192.168.10.150" priority="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/failoverdomain&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;ip address="192.168.10.151" monitor_link="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/resources&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;service autostart="0" domain="yumdemo_fd" name="yumdemo_pg"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;ip ref="192.168.10.151"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/service&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div><div><br></div><div>开启所有组件的日志</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --setlogging</font></div><div></div><p></p></pre></div><div>把/etc/cluster/cluster.conf拷贝到集群中的另一台主机上.</div><div>确保两台主机可以相互通信, 所以如果开启了iptables 的话, 需要配置一下防火墙.</div><div>然后两个节点同时启动cman服务, 注意是同时, 否则另一个节点会因为加入延迟超时被fence掉.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# service cman start</font></div><div><font size="2"   >Starting cluster:&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;Checking if cluster has been disabled at boot... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Checking Network Manager... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Global setup... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Loading kernel modules... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Mounting configfs... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Starting cman... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Waiting for quorum... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Starting fenced... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Starting dlm_controld... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Tuning DLM kernel config... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Starting gfs_controld... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Unfencing self... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Joining fence domain... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-192-168-10-150 ~]# service cman start</font></div><div><font size="2"   >Starting cluster:&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;Checking if cluster has been disabled at boot... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Checking Network Manager... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Global setup... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Loading kernel modules... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Mounting configfs... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Starting cman... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Waiting for quorum... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Starting fenced... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Starting dlm_controld... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Tuning DLM kernel config... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Starting gfs_controld... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Unfencing self... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >&nbsp; &nbsp;Joining fence domain... [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >[root@db-192-168-10-150 ~]# service rgmanager start</font></div><div><font size="2"   >Starting Cluster Service Manager: [ &nbsp;OK &nbsp;]</font></div><p></p></pre></div><div><br></div><div>2个节点都启动资源管理服务</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# service rgmanager start</font></div><div><font size="2"   >Starting Cluster Service Manager: [ &nbsp;OK &nbsp;]</font></div><p></p></pre></div><div>查看集群状态</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# clustat</font></div><div><font size="2"   >Cluster Status for yumdemo @ Wed May 28 10:18:16 2014</font></div><div><font size="2"   >Member Status: Quorate</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp;Member Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ID &nbsp; Status</font></div><div><font size="2"   >&nbsp;------ ---- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---- ------</font></div><div><font size="2"   >&nbsp;192.168.10.146 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 Online, Local, rgmanager</font></div><div><font size="2"   >&nbsp;192.168.10.150 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 Online, rgmanager</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp;Service Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Owner (Last) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; State &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;------- ---- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----- ------ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----- &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;service:yumdemo_pg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (none) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; disabled &nbsp; &nbsp; &nbsp;</font></div><p></p></pre></div><div>使用clusvcadm启动服务.</div><div>我们这里的服务yumdemo_pg中只包含了1个虚拟IP地址资源.</div><div>所以启动后, 这个虚拟IP就跑在某台主机上了.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# clusvcadm -e yumdemo_pg</font></div><div><font size="2"   >Local machine trying to enable service:yumdemo_pg...Success</font></div><div><font size="2"   >service:yumdemo_pg is now running on 192.168.10.146</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ping 192.168.10.151</font></div><div><font size="2"   >PING 192.168.10.151 (192.168.10.151) 56(84) bytes of data.</font></div><div><font size="2"   >64 bytes from 192.168.10.151: icmp_seq=1 ttl=64 time=0.077 ms</font></div><div><font size="2"   >64 bytes from 192.168.10.151: icmp_seq=2 ttl=64 time=0.032 ms</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >切换测试, 把主节点的</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 ~]# ifdown eth0</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >查看另一台主机的日志</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-150 ~]# tail -f -n 1 /var/log/messages</font></div><div><font size="2"   >May 28 13:31:30 db-192-168-10-150 rgmanager[2534]: State change: 192.168.10.146 UP</font></div><div><font size="2"   >May 28 13:33:31 db-192-168-10-150 corosync[2272]: &nbsp; [TOTEM ] A processor failed, forming new configuration.</font></div><div><font size="2"   >May 28 13:33:33 db-192-168-10-150 corosync[2272]: &nbsp; [QUORUM] Members[1]: 2</font></div><div><font size="2"   >May 28 13:33:33 db-192-168-10-150 corosync[2272]: &nbsp; [TOTEM ] A processor joined or left the membership and a new membership was formed.</font></div><div><font size="2"   >May 28 13:33:33 db-192-168-10-150 rgmanager[2534]: State change: 192.168.10.146 DOWN</font></div><div><font size="2"   >May 28 13:33:33 db-192-168-10-150 corosync[2272]: &nbsp; [CPG &nbsp; ] chosen downlist: sender r(0) ip(192.168.10.150) ; members(old:2 left:1)</font></div><div><font size="2"   >May 28 13:33:33 db-192-168-10-150 kernel: dlm: closing connection to node 1</font></div><div><font size="2"   >May 28 13:33:33 db-192-168-10-150 corosync[2272]: &nbsp; [MAIN &nbsp;] Completed service synchronization, ready to provide service.</font></div><div><font size="2"   >May 28 13:33:39 db-192-168-10-150 fenced[2327]: fencing node 192.168.10.146</font></div><div><font size="2"   >May 28 13:33:54 db-192-168-10-150 fenced[2327]: fence 192.168.10.146 success</font></div><div><font size="2"   >May 28 13:33:55 db-192-168-10-150 rgmanager[2534]: Taking over service service:yumdemo_pg from down member 192.168.10.146</font></div><div><font size="2"   >May 28 13:33:55 db-192-168-10-150 rgmanager[3479]: [ip] Adding IPv4 address 192.168.10.151/24 to eth0</font></div><div><font size="2"   >May 28 13:33:58 db-192-168-10-150 rgmanager[2534]: Service service:yumdemo_pg started</font></div><p></p></pre></div><div>fence成功后, 服务yumdemo_pg 切换到这台主机了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-150 ~]# clustat</font></div><div><font size="2"   >Cluster Status for yumdemo @ Wed May 28 10:22:37 2014</font></div><div><font size="2"   >Member Status: Quorate</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp;Member Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ID &nbsp; Status</font></div><div><font size="2"   >&nbsp;------ ---- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---- ------</font></div><div><font size="2"   >&nbsp;192.168.10.146 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 Offline</font></div><div><font size="2"   >&nbsp;192.168.10.150 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 Online, Local, rgmanager</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp;Service Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Owner (Last) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; State &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;------- ---- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----- ------ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----- &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;service:yumdemo_pg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.10.150 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;started</font></div><p></p></pre></div><div>我们这个例子的fence包含了关机和开机操作, 所以一段时间后可以看到被fence掉的主机重启了.</div><div>重启后, 我们需要做的是把它的cman和rgmanager服务开启来.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >service cman start</font></div><div><font size="2"   >service rgmanager start</font></div><p></p></pre></div><div>然后看这个集群的状态</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-150 ~]# clustat</font></div><div style="line-height: 28px;"   ><font size="2"   >Cluster Status for yumdemo @ Wed May 28 10:29:42 2014</font></div><div style="line-height: 28px;"   ><font size="2"   >Member Status: Quorate</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;Member Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ID &nbsp; Status</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;------ ---- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---- ------</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;192.168.10.146 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 Online</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;192.168.10.150 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 Online, Local, rgmanager</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;Service Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Owner (Last) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; State &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;------- ---- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----- ------ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----- &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;service:yumdemo_pg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.10.150 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;started</font></div><p></p></pre></div></div><div>到这里, 简单的HA就搭建完成了.</div><div>后面我们还要做的是把逻辑卷的管理, 文件系统的管理, 数据库的管理等加到HA的资源和服务中来.</div><div>让rgmanager来管理这些资源, 达到HA的目的.</div><div>下一篇文章再详细介绍.</div><div><br></div><div><div style="line-height: 28px;"   >例如, 如果集群文件系统基于逻辑卷的话, 那么需要配置lvm.conf</div><div><a target="_blank" rel="nofollow" href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Cluster_Administration/ap-ha-halvm-CA.html"   >https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Cluster_Administration/ap-ha-halvm-CA.html</a></div><div><br></div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   ># vi /etc/lvm/lvm.conf&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >locking_type = 3</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >chkconfig clvmd on</font></div><div style="line-height: 28px;"   ><font size="2"   >service clvmd restart</font></div><div style="line-height: 28px;"   ><font size="2"   ><br></font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-150 ~]# pvcreate /dev/sdb</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Physical volume "/dev/sdb" successfully created</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-150 ~]# pvcreate /dev/sdc</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Physical volume "/dev/sdc" successfully created</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-150 ~]# pvcreate /dev/sdd</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Physical volume "/dev/sdd" successfully created</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-150 ~]# pvcreate /dev/sde</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Physical volume "/dev/sde" successfully created</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-150 ~]# pvcreate /dev/sdf</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Physical volume "/dev/sdf" successfully created</font></div></div><div style="line-height: 28px;"   ><font size="2"   ><br></font></div><div style="line-height: 28px;"   ><font size="2"   >vgcreate</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; [-c|--clustered {y|n}]&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-150 ~]# vgcreate -cy vgdata01 /dev/sd[b-f]</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Clustered volume group "vgdata01" successfully created</font></div></div><p></p></pre></div><div style="line-height: 28px;"   ><br></div></div><div style="line-height: 28px;"   >如果要把脚本作为资源的话, 需要的配置如下 :&nbsp;</div><div style="line-height: 28px;"   >注意脚本的调用规格必须和LSB兼容, 例如test.sh start|stop|restart|status|reload</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --lsserviceopts script</font></div><div><font size="2"   >script - LSB-compliant init script as a clustered resource.</font></div><div><font size="2"   >&nbsp; Required Options:</font></div><div><font size="2"   >&nbsp; &nbsp; name: Name</font></div><div><font size="2"   >&nbsp; &nbsp; file: Path to script</font></div><div><font size="2"   >&nbsp; Optional Options:</font></div><div><font size="2"   >&nbsp; &nbsp; service_name: Inherit the service name.</font></div><div><font size="2"   >&nbsp; &nbsp; __independent_subtree: Treat this and all children as an independent subtree.</font></div><div><font size="2"   >&nbsp; &nbsp; __enforce_timeouts: Consider a timeout for operations as fatal.</font></div><div><font size="2"   >&nbsp; &nbsp; __max_failures: Maximum number of failures before returning a failure to a status check.</font></div><div><font size="2"   >&nbsp; &nbsp; __failure_expire_time: Amount of time before a failure is forgotten.</font></div><div><font size="2"   >&nbsp; &nbsp; __max_restarts: Maximum number restarts for an independent subtree before giving up.</font></div><div><font size="2"   >&nbsp; &nbsp; __restart_expire_time: Amount of time before a failure is forgotten for an independent subtree.</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >[参考]</span></div></div><wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://access.redhat.com/site/documentation/en-US/"   >https://access.redhat.com/site/documentation/en-US/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Cluster_Administration/index.html"   >https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Cluster_Administration/index.html</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Cluster_Administration/ap-ha-halvm-CA.html"   >https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Cluster_Administration/ap-ha-halvm-CA.html</a></div><div>4.&nbsp;<span style="line-height: 28px;"   >man ccs</span></div><div style="line-height: 28px;"   >5. man ipmitool</div><div style="line-height: 28px;"   >6. man cluster.conf</div><div style="line-height: 28px;"   >7. 查看操作系统支持的fence设备和对应的配置项.</div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --lsfenceopts</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_apc - Fence agent for APC over telnet/ssh</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_apc_snmp - Fence agent for APC over SNMP</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_bladecenter - Fence agent for IBM BladeCenter</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_bladecenter_snmp - Fence agent for IBM BladeCenter over SNMP</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_brocade - Fence agent for Brocade over telnet</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_cisco_mds - Fence agent for Cisco MDS</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_cisco_ucs - Fence agent for Cisco UCS</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_drac - fencing agent for Dell Remote Access Card</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_drac5 - Fence agent for Dell DRAC CMC/5</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_eaton_snmp - Fence agent for Eaton over SNMP</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_egenera - I/O Fencing agent for the Egenera BladeFrame</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_eps - Fence agent for ePowerSwitch</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_hpblade - Fence agent for HP BladeSystem</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_ibmblade - Fence agent for IBM BladeCenter over SNMP</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_idrac - Fence agent for IPMI over LAN</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_ifmib - Fence agent for IF MIB</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_ilo - Fence agent for HP iLO</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_ilo2 - Fence agent for HP iLO</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_ilo3 - Fence agent for IPMI over LAN</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_ilo4 - Fence agent for IPMI over LAN</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_ilo_mp - Fence agent for HP iLO MP</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_imm - Fence agent for IPMI over LAN</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_intelmodular - Fence agent for Intel Modular</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_ipdu - Fence agent for iPDU over SNMP</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_ipmilan - Fence agent for IPMI over LAN</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_kdump - Fence agent for use with kdump</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_pcmk - Helper that presents a RHCS-style interface to stonith-ng for CMAN based clusters</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_rhevm - Fence agent for RHEV-M REST API</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_rsa - Fence agent for IBM RSA</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_rsb - I/O Fencing agent for Fujitsu-Siemens RSB</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_sanbox2 - Fence agent for QLogic SANBox2 FC switches</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_sanlock - Fence agent for watchdog and shared storage</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_scsi - fence agent for SCSI-3 persistent reservations</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_virsh - Fence agent for virsh</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_virt - Fence agent for virtual machines</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_vmware - Fence agent for VMWare</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_vmware_soap - Fence agent for VMWare over SOAP API</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_wti - Fence agent for WTI</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_xvm - Fence agent for virtual machines</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --lsfenceopts fence_ipmilan</font></div><div style="line-height: 28px;"   ><font size="2"   >fence_ipmilan - Fence agent for IPMI over LAN</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Required Options:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Optional Options:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; option: No description available</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; auth: IPMI Lan Auth type (md5, password, or none)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; ipaddr: IPMI Lan IP to talk to</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; passwd: Password (if required) to control power on IPMI device</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; passwd_script: Script to retrieve password (if required)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; lanplus: Use Lanplus to improve security of connection</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; login: Username/Login (if required) to control power on IPMI device</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; action: Operation to perform. Valid operations: on, off, reboot, status, list, diag, monitor or metadata</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; timeout: Timeout (sec) for IPMI operation</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; cipher: Ciphersuite to use (same as ipmitool -C parameter)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; method: Method to fence (onoff or cycle)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; power_wait: Wait X seconds after on/off operation</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; delay: Wait X seconds before fencing is started</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; privlvl: Privilege level on IPMI device</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; verbose: Verbose mode</font></div><p></p></pre></div><div style="line-height: 28px;"   >8. failover域属性</div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >A failover domain is &nbsp;a named subset of cluster nodes &nbsp;that are eligible to run a cluster service in the</font></div><div style="line-height: 28px;"   ><font size="2"   >event of a node failure. &nbsp;A failover domain can have the following characteristics :</font></div><div style="line-height: 28px;"   ><font size="2"   >Unrestricted ― Allows &nbsp;you to specify that a subset of members &nbsp;are preferred, &nbsp;but that a cluster</font></div><div style="line-height: 28px;"   ><font size="2"   >service as signed to this &nbsp;domain can run on any available member.</font></div><div style="line-height: 28px;"   ><font size="2"   >Restricted ― Allows &nbsp;you to restrict the members &nbsp;that can run a particular cluster service. &nbsp;If none of</font></div><div style="line-height: 28px;"   ><font size="2"   >the members &nbsp;in a restricted failover domain are available, &nbsp;the cluster service cannot be started</font></div><div style="line-height: 28px;"   ><font size="2"   >(either manually or by the cluster software).</font></div><div style="line-height: 28px;"   ><font size="2"   >Unordered ― When a clus ter s ervice is &nbsp;as signed to an unordered failover domain, &nbsp;the member on</font></div><div style="line-height: 28px;"   ><font size="2"   >which the cluster service runs &nbsp;is &nbsp;chosen from the available failover domain members &nbsp;with no priority</font></div><div style="line-height: 28px;"   ><font size="2"   >ordering.</font></div><div style="line-height: 28px;"   ><font size="2"   >Ordered ― Allows &nbsp;you to specify a preference order among the members &nbsp;of a failover domain. &nbsp;The</font></div><div style="line-height: 28px;"   ><font size="2"   >member at the top of the list is &nbsp;the most preferred, &nbsp;followed by the second member in the list, &nbsp;and so</font></div><div style="line-height: 28px;"   ><font size="2"   >on.</font></div><div style="line-height: 28px;"   ><font size="2"   >Failback ― Allows &nbsp;you to specify whether a s ervice in the failover domain should fail back to the node</font></div><div style="line-height: 28px;"   ><font size="2"   >that it was &nbsp;originally running on before that node failed. &nbsp;Configuring this &nbsp;characteristic is &nbsp;useful in</font></div><div style="line-height: 28px;"   ><font size="2"   >circumstances &nbsp;where a node repeatedly fails &nbsp;and is &nbsp;part of an ordered failover domain. &nbsp;In that</font></div><div style="line-height: 28px;"   ><font size="2"   >circumstance, &nbsp;if a node is &nbsp;the preferred node in a failover domain, &nbsp;it is &nbsp;possible for a service to fail</font></div><div style="line-height: 28px;"   ><font size="2"   >over and fail back repeatedly between the preferred node and another node, &nbsp;causing severe impact</font></div><div style="line-height: 28px;"   ><font size="2"   >on performance.</font></div><p></p></pre></div><div style="line-height: 28px;"   >9. 操作系统支持的资源, 以及资源对应的配置选项.</div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --lsserviceopts</font></div><div style="line-height: 28px;"   ><font size="2"   >service - Defines a service (resource group).</font></div><div style="line-height: 28px;"   ><font size="2"   >ASEHAagent - Sybase ASE Failover Instance</font></div><div style="line-height: 28px;"   ><font size="2"   >SAPDatabase - Manages any SAP database (based on Oracle, MaxDB, or DB2)</font></div><div style="line-height: 28px;"   ><font size="2"   >SAPInstance - SAP instance resource agent</font></div><div style="line-height: 28px;"   ><font size="2"   >apache - Defines an Apache web server</font></div><div style="line-height: 28px;"   ><font size="2"   >clusterfs - Defines a cluster file system mount.</font></div><div style="line-height: 28px;"   ><font size="2"   >fs - Defines a file system mount.</font></div><div style="line-height: 28px;"   ><font size="2"   >ip - This is an IP address.</font></div><div style="line-height: 28px;"   ><font size="2"   >lvm - LVM Failover script</font></div><div style="line-height: 28px;"   ><font size="2"   >mysql - Defines a MySQL database server</font></div><div style="line-height: 28px;"   ><font size="2"   >named - Defines an instance of named server</font></div><div style="line-height: 28px;"   ><font size="2"   >netfs - Defines an NFS/CIFS file system mount.</font></div><div style="line-height: 28px;"   ><font size="2"   >nfsclient - Defines an NFS client.</font></div><div style="line-height: 28px;"   ><font size="2"   >nfsexport - This defines an NFS export.</font></div><div style="line-height: 28px;"   ><font size="2"   >nfsserver - This defines an NFS server resource.</font></div><div style="line-height: 28px;"   ><font size="2"   >openldap - Defines an Open LDAP server</font></div><div style="line-height: 28px;"   ><font size="2"   >oracledb - Oracle 10g/11g Failover Instance</font></div><div style="line-height: 28px;"   ><font size="2"   >orainstance - Oracle 10g Failover Instance</font></div><div style="line-height: 28px;"   ><font size="2"   >oralistener - Oracle 10g Listener Instance</font></div><div style="line-height: 28px;"   ><font size="2"   >postgres-8 - Defines a PostgreSQL server</font></div><div style="line-height: 28px;"   ><font size="2"   >samba - Dynamic smbd/nmbd resource agent</font></div><div style="line-height: 28px;"   ><font size="2"   >script - LSB-compliant init script as a clustered resource.</font></div><div style="line-height: 28px;"   ><font size="2"   >tomcat-6 - Defines a Tomcat server</font></div><div style="line-height: 28px;"   ><font size="2"   >vm - Defines a Virtual Machine</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --lsserviceopts ip</font></div><div style="line-height: 28px;"   ><font size="2"   >ip - This is an IP address.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Required Options:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; address: IP Address</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Optional Options:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; family: Family</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; monitor_link: Monitor NIC Link</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; nfslock: Enable NFS lock workarounds</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; sleeptime: Amount of time (seconds) to sleep.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; disable_rdisc: Disable updating of routing using RDISC protocol</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; prefer_interface: Network interface</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __independent_subtree: Treat this and all children as an independent subtree.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __enforce_timeouts: Consider a timeout for operations as fatal.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __max_failures: Maximum number of failures before returning a failure to a status check.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __failure_expire_time: Amount of time before a failure is forgotten.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __max_restarts: Maximum number restarts for an independent subtree before giving up.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __restart_expire_time: Amount of time before a failure is forgotten for an independent subtree.</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --lsserviceopts fs</font></div><div style="line-height: 28px;"   ><font size="2"   >fs - Defines a file system mount.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Required Options:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; name: File System Name</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; mountpoint: Mount Point</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; device: Device or Label</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Optional Options:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; fstype: File system type</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; force_unmount: Force Unmount</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; quick_status: Quick/brief status checks.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; self_fence: Seppuku Unmount</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; nfslock: Enable NFS lock workarounds</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; nfsrestart: Enable NFS daemon and lockd workaround</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; fsid: NFS File system ID</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; force_fsck: Force fsck support</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; options: Mount Options</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; use_findmnt: Utilize findmnt to detect if and where filesystems are mounted</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __independent_subtree: Treat this and all children as an independent subtree.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __enforce_timeouts: Consider a timeout for operations as fatal.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __max_failures: Maximum number of failures before returning a failure to a status check.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __failure_expire_time: Amount of time before a failure is forgotten.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __max_restarts: Maximum number restarts for an independent subtree before giving up.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __restart_expire_time: Amount of time before a failure is forgotten for an independent subtree.</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-146 yum.repos.d]# ccs -f /etc/cluster/cluster.conf --lsserviceopts lvm</font></div><div style="line-height: 28px;"   ><font size="2"   >lvm - LVM Failover script</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Required Options:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; name: Name</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; vg_name: Volume group name</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; Optional Options:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; lv_name: Logical Volume name (optional).</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; self_fence: Fence the node if it is not able to clean up LVM tags</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; nfslock: Enable NFS lock workarounds</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __independent_subtree: Treat this and all children as an independent subtree.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __enforce_timeouts: Consider a timeout for operations as fatal.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __max_failures: Maximum number of failures before returning a failure to a status check.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __failure_expire_time: Amount of time before a failure is forgotten.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __max_restarts: Maximum number restarts for an independent subtree before giving up.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; __restart_expire_time: Amount of time before a failure is forgotten for an independent subtree.</font></div><p></p></pre></div><div style="line-height: 28px;"   >10. 服务的属性</div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >When you add a service to the clus ter configuration, &nbsp;you configure the following attributes :</font></div><div style="line-height: 28px;"   ><font size="2"   >autostart ― Specifies &nbsp;whether to autos tart the s ervice when the clus ter starts . &nbsp;Use " 1" &nbsp;to</font></div><div style="line-height: 28px;"   ><font size="2"   >enable and " 0 " &nbsp;to disable; &nbsp;the default is &nbsp;enabled.</font></div><div style="line-height: 28px;"   ><font size="2"   >domain ― Specifies &nbsp;a failover domain (if required).</font></div><div style="line-height: 28px;"   ><font size="2"   >exclusive ― Specifies &nbsp;a policy wherein the s ervice only runs &nbsp;on nodes &nbsp;that have no other</font></div><div style="line-height: 28px;"   ><font size="2"   >services &nbsp;running on them.</font></div><div style="line-height: 28px;"   ><font size="2"   >recovery ― Specifies &nbsp;a recovery policy for the s ervice. &nbsp;T he options &nbsp;are to relocate, &nbsp;res tart,</font></div><div style="line-height: 28px;"   ><font size="2"   >disable, &nbsp;or restart-disable the s ervice. &nbsp;T he res tart recovery policy indicates &nbsp;that the s ys tem</font></div><div style="line-height: 28px;"   ><font size="2"   >should attempt to res tart the failed s ervice before trying to relocate the s ervice to another</font></div><div style="line-height: 28px;"   ><font size="2"   >node. &nbsp;T he relocate policy indicates &nbsp;that the s ys tem s hould try to res tart the s ervice in a</font></div><div style="line-height: 28px;"   ><font size="2"   >different node. &nbsp;T he dis able policy indicates &nbsp;that the s ys tem s hould dis able the res ource group</font></div><div style="line-height: 28px;"   ><font size="2"   >if any component fails . &nbsp;T he restart-disable policy indicates &nbsp;that the system should attempt to</font></div><div style="line-height: 28px;"   ><font size="2"   >res tart the s ervice in place if it fails , &nbsp;but if res tarting the s ervice fails &nbsp;the s ervice will be</font></div><div style="line-height: 28px;"   ><font size="2"   >dis abled ins tead of being moved to another hos t in the cluster.</font></div><div style="line-height: 28px;"   ><font size="2"   >If you s elect Restart &nbsp;or Restart - Disable &nbsp;as &nbsp;the recovery policy for the s ervice, &nbsp;you can</font></div><div style="line-height: 28px;"   ><font size="2"   >specify the maximum number of res tart failures &nbsp;before relocating or dis abling the s ervice, &nbsp;and</font></div><div style="line-height: 28px;"   ><font size="2"   >you can s pecify the length of time in s econds &nbsp;after which to forget a restart.</font></div><p></p></pre></div><div style="line-height: 28px;"   >11. 配置多播地址, 可选. 如果不配置, 多播地址从集群ID中运算出来.</div><div style="line-height: 28px;"   >所以我们需要在同一个多播域中使用不同的集群名来区分多播地址.</div><div style="line-height: 28px;"   >多播是用于集群中的心跳检测的.</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >If you do not specify a multicast address &nbsp;in the cluster configuration file, &nbsp;the Red Hat High Availability</font></span></div><div style="line-height: 28px;"   ><font size="2"   >Add-On software creates &nbsp;one based on the cluster ID. &nbsp;It generates &nbsp;the lower 16 bits &nbsp;of the address &nbsp;and</font></div><div style="line-height: 28px;"   ><font size="2"   >appends &nbsp;them to the upper portion of the address &nbsp;according to whether the IP protocol is &nbsp;IPv4 &nbsp;or IPv6:</font></div><div style="line-height: 28px;"   ><font size="2"   >For IPv4 &nbsp;― The address &nbsp;formed is &nbsp;239.192. &nbsp;plus &nbsp;the lower 16 bits &nbsp;generated by Red Hat High</font></div><div style="line-height: 28px;"   ><font size="2"   >Availability Add-On software.</font></div><div style="line-height: 28px;"   ><font size="2"   >For IPv6 ― The addres s &nbsp;formed is &nbsp;FF15: : &nbsp;plus &nbsp;the lower 16 bits &nbsp;generated by Red Hat High</font></div><div style="line-height: 28px;"   ><font size="2"   >Availability Add-On software.</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >The cluster ID is &nbsp;a unique identifier that cman generates &nbsp;for each cluster. &nbsp;To view the cluster ID,</font></div><div style="line-height: 28px;"   ><font size="2"   >run the cman_tool status command on a cluster node.</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-10-146 ~]# cman_tool status</font></div><div style="line-height: 28px;"   ><font size="2"   >Version: 6.2.0</font></div><div style="line-height: 28px;"   ><font size="2"   >Config Version: 6</font></div><div style="line-height: 28px;"   ><font size="2"   >Cluster Name: yumdemo</font></div><div style="line-height: 28px;"   ><font size="2"   >Cluster Id: 57130</font></div><div style="line-height: 28px;"   ><font size="2"   >Cluster Member: Yes</font></div><div style="line-height: 28px;"   ><font size="2"   >Cluster Generation: 20</font></div><div style="line-height: 28px;"   ><font size="2"   >Membership state: Cluster-Member</font></div><div style="line-height: 28px;"   ><font size="2"   >Nodes: 1</font></div><div style="line-height: 28px;"   ><font size="2"   >Expected votes: 1</font></div><div style="line-height: 28px;"   ><font size="2"   >Total votes: 1</font></div><div style="line-height: 28px;"   ><font size="2"   >Node votes: 1</font></div><div style="line-height: 28px;"   ><font size="2"   >Quorum: 1 &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >Active subsystems: 8</font></div><div style="line-height: 28px;"   ><font size="2"   >Flags: 2node&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >Ports Bound: 0 177 &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >Node name: 192.168.10.146</font></div><div style="line-height: 28px;"   ><font size="2"   >Node ID: 1</font></div><div style="line-height: 28px;"   ><font size="2"   >Multicast addresses: 239.192.223.10&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >Node addresses: 192.168.10.146&nbsp;</font></div><p></p></pre></div><div style="line-height: 28px;"   >12. cluster配置文件有一个版本号, 每次修改配置文件后, 如果要使配置文件在重启cman后生效必须把版本号加1.&nbsp;</div><div style="line-height: 28px;"   >同时必须确保集群中的所有服务器的cluster.conf文件内容一致, 版本号一致.</div><div style="line-height: 28px;"   >13.&nbsp;/usr/share/cluster/cluster.rng 包含了详细的cluster.conf文件的说明.</div><div style="line-height: 28px;"   ><br></div></div></div></div></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="CentOS 6.x Cluster configure with ccs command - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>