<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Block dev with Partition Table: gpt cann't used to lvm</h2>
	<h5 id="">2014-05-04 14:37:57&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014442371599/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="line-height: 28px;"   >在给一台服务器创建pv的时候, 有些块设备正常, 但是有些块设备报这样的错.</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># pvcreate /dev/sdb</font></div><div><font size="2"   >&nbsp; Physical volume "/dev/sdb" successfully created</font></div></div><div><div><font size="2"   ># pvcreate /dev/sdc</font></div><div><font size="2"   >&nbsp; Device /dev/sdc not found (or ignored by filtering).</font></div></div><p></p></pre></div><div>查看/etc/lvm/lvm.conf没有类似的过滤.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># grep filter /etc/lvm/lvm.conf</font></div><div><font size="2"   >&nbsp; &nbsp; # A filter that tells LVM2 to only use a restricted set of devices.</font></div><div><font size="2"   >&nbsp; &nbsp; # The filter consists of an array of regular expressions. &nbsp;These</font></div><div><font size="2"   >&nbsp; &nbsp; # Don't have more than one filter line active at once: only one gets used.</font></div><div><font size="2"   >&nbsp; &nbsp; filter = [ "a/.*/" ]</font></div><div><font size="2"   >&nbsp; &nbsp; # filter = [ "r|/dev/cdrom|" ]</font></div><div><font size="2"   >&nbsp; &nbsp; # filter = [ "a/loop/", "r/.*/" ]</font></div><div><font size="2"   >&nbsp; &nbsp; # filter =[ "a|loop|", "r|/dev/hdc|", "a|/dev/ide|", "r|.*|" ]</font></div><div><font size="2"   >&nbsp; &nbsp; # filter = [ "a|^/dev/hda8$|", "r/.*/" ]</font></div><div><font size="2"   >&nbsp; &nbsp; # Since "filter" is often overridden from command line, it is not suitable</font></div><div><font size="2"   >&nbsp; &nbsp; # for system-wide device filtering (udev rules, lvmetad). To hide devices</font></div><div><font size="2"   >&nbsp; &nbsp; # global_filter. The syntax is the same as for normal "filter"</font></div><div><font size="2"   >&nbsp; &nbsp; # above. Devices that fail the global_filter are not even opened by LVM.</font></div><div><font size="2"   >&nbsp; &nbsp; # global_filter = []</font></div><div><font size="2"   >&nbsp; &nbsp; # The results of the filtering are cached on disk to avoid</font></div><div><font size="2"   >&nbsp; &nbsp; # mlock_filter = [ "locale/locale-archive", "gconv/gconv-modules.cache" ]</font></div><p></p></pre></div><div>原因在这两个块设备的分区表上面, 因为lvm不支持gpt分区表, 所以无法创建PV.</div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># parted -l</font></div><div><font size="2"   >Model: DELL PERC H710 (scsi)</font></div><div><font size="2"   >Disk /dev/sda: 299GB</font></div><div><font size="2"   >Sector size (logical/physical): 512B/512B</font></div><div><font size="2"   >Partition Table: msdos</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Number &nbsp;Start &nbsp; End &nbsp; &nbsp; Size &nbsp; &nbsp;Type &nbsp; &nbsp; File system &nbsp; &nbsp; Flags</font></div><div><font size="2"   >&nbsp;1 &nbsp; &nbsp; &nbsp;1049kB &nbsp;34.4GB &nbsp;34.4GB &nbsp;primary &nbsp;ext4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;boot</font></div><div><font size="2"   >&nbsp;2 &nbsp; &nbsp; &nbsp;34.4GB &nbsp;43.0GB &nbsp;8590MB &nbsp;primary &nbsp;linux-swap(v1)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Model: DELL PERC H710 (scsi)</font></div><div><font size="2"   >Disk /dev/sdb: 4000GB</font></div><div><font size="2"   >Sector size (logical/physical): 512B/512B</font></div><div><font size="2"   >Partition Table: msdos</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Number &nbsp;Start &nbsp;End &nbsp;Size &nbsp;Type &nbsp;File system &nbsp;Flags</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Model: DELL PERC H710 (scsi)</font></div><div><font size="2"   >Disk /dev/sdc: 4000GB</font></div><div><font size="2"   >Sector size (logical/physical): 512B/512B</font></div><div><font size="2"   >Partition Table: gpt</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Number &nbsp;Start &nbsp;End &nbsp;Size &nbsp;File system &nbsp;Name &nbsp;Flags</font></div><p></p></pre></div><div>清除分区表, 重新创建恢复正常.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># dd if=/dev/zero of=/dev/sdb bs=1k count=1024</font></div><div><font size="2"   ># dd if=/dev/zero of=/dev/sdc bs=1k count=1024</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   ># pvcreate /dev/sdb</font></div><div><font size="2"   >&nbsp; Physical volume "/dev/sdb" successfully created</font></div><div><font size="2"   ># pvcreate /dev/sdc</font></div><div><font size="2"   >&nbsp; Physical volume "/dev/sdc" successfully created</font></div><div><font size="2"   ># pvcreate /dev/sdd</font></div><div><font size="2"   >&nbsp; Physical volume "/dev/sdd" successfully created</font></div><div><font size="2"   ># pvcreate /dev/sde</font></div><div><font size="2"   >&nbsp; Physical volume "/dev/sde" successfully created</font></div><div><font size="2"   ># pvcreate /dev/sdf</font></div><div><font size="2"   >&nbsp; Physical volume "/dev/sdf" successfully created</font></div><div><font size="2"   ># pvcreate /dev/sdg</font></div><div><font size="2"   >&nbsp; Physical volume "/dev/sdg" successfully created</font></div><div><font size="2"   ># pvcreate /dev/sdh</font></div><div><font size="2"   >&nbsp; Device /dev/sdh not found (or ignored by filtering).</font></div><div><font size="2"   ># pvscan</font></div><div><font size="2"   >&nbsp; PV /dev/sdb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lvm2 [3.64 TiB]</font></div><div><font size="2"   >&nbsp; PV /dev/sdc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lvm2 [3.64 TiB]</font></div><div><font size="2"   >&nbsp; PV /dev/sdd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lvm2 [3.64 TiB]</font></div><div><font size="2"   >&nbsp; PV /dev/sde &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lvm2 [3.64 TiB]</font></div><div><font size="2"   >&nbsp; PV /dev/sdf &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lvm2 [3.64 TiB]</font></div><div><font size="2"   >&nbsp; PV /dev/sdg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lvm2 [3.64 TiB]</font></div><div><font size="2"   >&nbsp; Total: 6 [21.83 TiB] / in use: 0 [0 &nbsp; ] / in no VG: 6 [21.83 TiB]</font></div><div><font size="2"   ># vgcreate vgdata01 /dev/sdb /dev/sdc /dev/sdd /dev/sde /dev/sdf /dev/sdg</font></div><div><font size="2"   >&nbsp; Volume group "vgdata01" successfully created</font></div><div><font size="2"   ># lvcreate -l 100%VG -n lv01 vgdata01</font></div><div><font size="2"   >&nbsp; Logical volume "lv01" created</font></div><div><font size="2"   ># lvscan</font></div><div><font size="2"   >&nbsp; ACTIVE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'/dev/vgdata01/lv01' [21.83 TiB] inherit</font></div><div><font size="2"   ># mkfs.xfs /dev/vgdata01/lv01&nbsp;</font></div><div><font size="2"   >meta-data=/dev/vgdata01/lv01 &nbsp; &nbsp; isize=256 &nbsp; &nbsp;agcount=22, agsize=268435455 blks</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sectsz=512 &nbsp; attr=2, projid32bit=0</font></div><div><font size="2"   >data &nbsp; &nbsp; = &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bsize=4096 &nbsp; blocks=5859698688, imaxpct=5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sunit=0 &nbsp; &nbsp; &nbsp;swidth=0 blks</font></div><div><font size="2"   >naming &nbsp; =version 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bsize=4096 &nbsp; ascii-ci=0</font></div><div><font size="2"   >log &nbsp; &nbsp; &nbsp;=internal log &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bsize=4096 &nbsp; blocks=521728, version=2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sectsz=512 &nbsp; sunit=0 blks, lazy-count=1</font></div><div><font size="2"   >realtime =none &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extsz=4096 &nbsp; blocks=0, rtextents=0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># vi /etc/fstab&nbsp;</font></div><div><font size="2"   >/dev/mapper/vgdata01-lv01 &nbsp;/data01 &nbsp;xfs &nbsp;defaults,noatime,nodiratime 0 0&nbsp;</font></div><div><font size="2"   ># mkdir /data01</font></div><div><font size="2"   ># mount -a</font></div><div><font size="2"   ># df -h</font></div><div><font size="2"   >Filesystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size &nbsp;Used Avail Use% Mounted on</font></div><div><font size="2"   >/dev/sda1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 32G &nbsp;3.2G &nbsp; 27G &nbsp;11% /</font></div><div><font size="2"   >tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16G &nbsp; &nbsp; 0 &nbsp; 16G &nbsp; 0% /dev/shm</font></div><div><font size="2"   >/dev/mapper/vgdata01-lv01 &nbsp; 22T &nbsp; 33M &nbsp; 22T &nbsp; 1% /data01</font></div></div><p></p></pre></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Block dev with Partition Table: gpt cannt used to lvm - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>