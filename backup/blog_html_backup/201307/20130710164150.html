<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL string match frequence count like Oracle 11g regexp_count function</h2>
	<h5 id="">2013-07-10 16:41:50&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201361044150284/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>一位仓库的同事问到的关于如何在PostgreSQL中统计一个字符串中某些字符的出现次数.</div><div>在Oracle 11g中有一个函数叫做regext_count可以实现这个目的, 在PostgreSQL中目前还没有系统函数支持这个功能.</div><div>不过可以借助plpgsql来实现简单的字符串统计, 不适用规则表达式字符串统计.</div><div>如下 :&nbsp;</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >do language plpgsql $$</font></div><div><font size="2"   >declare</font></div><div><font size="2"   >&nbsp; str text;</font></div><div><font size="2"   >&nbsp; str_len int;</font></div><div><font size="2"   >&nbsp; search text;</font></div><div><font size="2"   >&nbsp; search_len int;</font></div><div><font size="2"   >&nbsp; i int;</font></div><div><font size="2"   >begin</font></div><div><font size="2"   >&nbsp; str := 'test i am digoal test';</font></div><div><font size="2"   >&nbsp; str_len := length(str);</font></div><div><font size="2"   >&nbsp; search := 'te';</font></div><div><font size="2"   >&nbsp; search_len := length(search);</font></div><div><font size="2"   >&nbsp; i := 0;</font></div><div><font size="2"   >&nbsp; for x in 1..str_len-search_len+1 loop</font></div><div><font size="2"   >&nbsp; &nbsp; if substr(str, x, search_len) = search then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; i := i+1;</font></div><div><font size="2"   >&nbsp; &nbsp; end if;</font></div><div><font size="2"   >&nbsp; end loop;</font></div><div><font size="2"   >&nbsp; raise notice '%', i;</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >$$;</font></div><p></p></pre></div><div><br></div><div>转换成函数如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create or replace function regexp_count(str text,search text) returns int as $$</font></div><div><font size="2"   >declare</font></div><div><font size="2"   >&nbsp; str_len int;</font></div><div><font size="2"   >&nbsp; search_len int;</font></div><div><font size="2"   >&nbsp; i int;</font></div><div><font size="2"   >begin</font></div><div><font size="2"   >&nbsp; str_len := length(str);</font></div><div><font size="2"   >&nbsp; search_len := length(search);</font></div><div><font size="2"   >&nbsp; i := 0;</font></div><div><font size="2"   >&nbsp; for x in 1..str_len-search_len+1 loop</font></div><div><font size="2"   >&nbsp; &nbsp; if substr(str, x, search_len) = search then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; i := i+1;</font></div><div><font size="2"   >&nbsp; &nbsp; end if;</font></div><div><font size="2"   >&nbsp; end loop;</font></div><div><font size="2"   >&nbsp; return i;</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >$$ language plpgsql strict;</font></div><p></p></pre></div></div><div><br></div><div>测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select * from regexp_count('i am digoal test test', 'test');</font></div><div><font size="2"   >&nbsp;regexp_count&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 0.151 ms</font></div><div><font size="2"   >postgres=&gt; select * from regexp_count('i am digoal aaa', 'aa');<br> regexp_count <br>--------------<br>            2<br>(1 row)</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 22px;"   >[参考]</span></div><wbr><div>1.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/functions135.htm"   >http://docs.oracle.com/cd/B28359_01/server.111/b28286/functions135.htm</a></div>2.&nbsp;<a rel="nofollow" href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/ap_posix.htm#g693775"   >http://docs.oracle.com/cd/B28359_01/server.111/b28286/ap_posix.htm#g693775</a></div>
	</div>
</div>
</body>
</html>