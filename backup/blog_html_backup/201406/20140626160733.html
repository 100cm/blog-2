<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">ZFS fsync IOPS performance in FreeBSD</h2>
	<h5 id="">2014-06-26 16:07:33&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020145264116819/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>我在上一篇文章讲了一下ZFS的性能优化.</div><div>文章提到在Linux (CentOS 6.5 x64)中, ZFS的fsync调用性能不佳的问题, 完全不如ext4, 于是在同一台主机, 我安装了FreeBSD 10 x64. 使用同样的硬件测试一下fsync的性能.</div><div>PostgreSQL的安装参考</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201451181344545/"   >http://blog.163.com/digoal@126/blog/static/163877040201451181344545/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201451282121414/"   >http://blog.163.com/digoal@126/blog/static/163877040201451282121414/</a></div><div>首先查看块设备, 这里使用12块4 TB的SATA盘.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># gpart list -a</font></div><div><font size="2"   >Geom name: mfid[1-12]</font></div><p></p></pre></div><div>创建zpool,&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># zpool create zp1 mfid1 mfid2 mfid3 mfid4 mfid5 mfid6 mfid7 mfid8 mfid9 mfid10 mfid11 mfid12</font></div><div><div><font size="2"   ># zpool get all zp1</font></div><div><font size="2"   >NAME &nbsp;PROPERTY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VALUE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SOURCE</font></div><div><font size="2"   >zp1 &nbsp; size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 43.5T &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1 &nbsp; capacity &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0% &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >zp1 &nbsp; altroot &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; health &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >zp1 &nbsp; guid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8490038421326880416 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; version &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; bootfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; delegation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1 &nbsp; autoreplace &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; cachefile &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; failmode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wait &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1 &nbsp; listsnapshots &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; autoexpand &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; dedupditto &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; dedupratio &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.00x &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1 &nbsp; free &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 43.5T &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1 &nbsp; allocated &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;285K &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >zp1 &nbsp; readonly &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1 &nbsp; comment &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; expandsize &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1 &nbsp; freeing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1 &nbsp; feature@async_destroy &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;local</font></div><div><font size="2"   >zp1 &nbsp; feature@empty_bpobj &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;active &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; local</font></div><div><font size="2"   >zp1 &nbsp; feature@lz4_compress &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;local</font></div><div><font size="2"   >zp1 &nbsp; feature@multi_vdev_crash_dump &nbsp;enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;local</font></div></div><p></p></pre></div><div>创建zfs</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># zfs create -o mountpoint=/data01 -o atime=off zp1/data01</font></div><div><div><font size="2"   ># zfs get all zp1/data01</font></div><div><font size="2"   >NAME &nbsp; &nbsp; &nbsp; &nbsp;PROPERTY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SOURCE</font></div><div><font size="2"   >zp1/data01 &nbsp;type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;filesystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >zp1/data01 &nbsp;creation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thu Jun 26 23:52 2014 &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;used &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32K &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;available &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 42.8T &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;referenced &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32K &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;compressratio &nbsp; &nbsp; &nbsp; &nbsp; 1.00x &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;mounted &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;quota &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; none &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;reservation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; none &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;recordsize &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;128K &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;mountpoint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/data01 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;local</font></div><div><font size="2"   >zp1/data01 &nbsp;sharenfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;checksum &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;compression &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;atime &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;local</font></div><div><font size="2"   >zp1/data01 &nbsp;devices &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;exec &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;setuid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;readonly &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;jailed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;snapdir &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hidden &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;aclmode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; discard &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;aclinherit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;restricted &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;canmount &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;xattr &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;temporary</font></div><div><font size="2"   >zp1/data01 &nbsp;copies &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;version &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;utf8only &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;normalization &nbsp; &nbsp; &nbsp; &nbsp; none &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >zp1/data01 &nbsp;casesensitivity &nbsp; &nbsp; &nbsp; sensitive &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;vscan &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;nbmand &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;sharesmb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;refquota &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;none &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;refreservation &nbsp; &nbsp; &nbsp; &nbsp;none &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default</font></div><div><font size="2"   >zp1/data01 &nbsp;primarycache &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;secondarycache &nbsp; &nbsp; &nbsp; &nbsp;all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;usedbysnapshots &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;usedbydataset &nbsp; &nbsp; &nbsp; &nbsp; 32K &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;usedbychildren &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;usedbyrefreservation &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;logbias &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latency &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;dedup &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default</font></div><div><font size="2"   >zp1/data01 &nbsp;mlslabel &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</font></div><div><font size="2"   >zp1/data01 &nbsp;sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;disabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; local</font></div><div><font size="2"   >zp1/data01 &nbsp;refcompressratio &nbsp; &nbsp; &nbsp;1.00x &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;written &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 32K &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;logicalused &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16K &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div><div><font size="2"   >zp1/data01 &nbsp;logicalreferenced &nbsp; &nbsp; 16K &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-</font></div></div><p></p></pre></div><div>测试fsync, 相比Linux有很大的提升, 基本达到了块设备的瓶颈.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># /opt/pgsql9.3.4/bin/pg_test_fsync -f /data01/1</font></div><div><font size="2"   >5 seconds per test</font></div><div><font size="2"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using one 8kB write:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6676.001 ops/sec &nbsp; &nbsp; 150 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6087.783 ops/sec &nbsp; &nbsp; 164 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using two 8kB writes:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4750.841 ops/sec &nbsp; &nbsp; 210 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3065.099 ops/sec &nbsp; &nbsp; 326 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare open_sync with different write sizes:</font></div><div><font size="2"   >(This is designed to compare the cost of writing 16kB</font></div><div><font size="2"   >in different write open_sync sizes.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; &nbsp;4965.249 ops/sec &nbsp; &nbsp; 201 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp; 3039.074 ops/sec &nbsp; &nbsp; 329 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp; 1598.735 ops/sec &nbsp; &nbsp; 625 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp; 1326.517 ops/sec &nbsp; &nbsp; 754 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp;620.992 ops/sec &nbsp; &nbsp;1610 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font size="2"   >(If the times are similar, fsync() can sync data written</font></div><div><font size="2"   >on a different descriptor.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5422.742 ops/sec &nbsp; &nbsp; 184 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5552.278 ops/sec &nbsp; &nbsp; 180 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Non-Sync'ed 8kB writes:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 67460.621 ops/sec &nbsp; &nbsp; &nbsp;15 usecs/op</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   ># zpool iostat -v 1</font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;capacity &nbsp; &nbsp; operations &nbsp; &nbsp;bandwidth</font></div><div><font size="2"   >pool &nbsp; &nbsp; &nbsp; &nbsp;alloc &nbsp; free &nbsp; read &nbsp;write &nbsp; read &nbsp;write</font></div><div><font size="2"   >---------- &nbsp;----- &nbsp;----- &nbsp;----- &nbsp;----- &nbsp;----- &nbsp;-----</font></div><div><font size="2"   >zp1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;747M &nbsp;43.5T &nbsp; &nbsp; &nbsp;0 &nbsp;7.31K &nbsp; &nbsp; &nbsp;0 &nbsp;39.1M</font></div><div><font size="2"   >&nbsp; mfid1 &nbsp; &nbsp; 62.8M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;638 &nbsp; &nbsp; &nbsp;0 &nbsp;3.27M</font></div><div><font size="2"   >&nbsp; mfid2 &nbsp; &nbsp; 61.9M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;615 &nbsp; &nbsp; &nbsp;0 &nbsp;3.23M</font></div><div><font size="2"   >&nbsp; mfid3 &nbsp; &nbsp; 62.8M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;615 &nbsp; &nbsp; &nbsp;0 &nbsp;3.23M</font></div><div><font size="2"   >&nbsp; mfid4 &nbsp; &nbsp; 62.0M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;615 &nbsp; &nbsp; &nbsp;0 &nbsp;3.23M</font></div><div><font size="2"   >&nbsp; mfid5 &nbsp; &nbsp; 62.9M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;616 &nbsp; &nbsp; &nbsp;0 &nbsp;3.24M</font></div><div><font size="2"   >&nbsp; mfid6 &nbsp; &nbsp; 62.0M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;616 &nbsp; &nbsp; &nbsp;0 &nbsp;3.24M</font></div><div><font size="2"   >&nbsp; mfid7 &nbsp; &nbsp; 62.9M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;620 &nbsp; &nbsp; &nbsp;0 &nbsp;3.24M</font></div><div><font size="2"   >&nbsp; mfid8 &nbsp; &nbsp; 61.6M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;620 &nbsp; &nbsp; &nbsp;0 &nbsp;3.24M</font></div><div><font size="2"   >&nbsp; mfid9 &nbsp; &nbsp; 62.2M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;619 &nbsp; &nbsp; &nbsp;0 &nbsp;3.23M</font></div><div><font size="2"   >&nbsp; mfid10 &nbsp; &nbsp;61.8M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;615 &nbsp; &nbsp; &nbsp;0 &nbsp;3.23M</font></div><div><font size="2"   >&nbsp; mfid11 &nbsp; &nbsp;62.2M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;648 &nbsp; &nbsp; &nbsp;0 &nbsp;3.41M</font></div><div><font size="2"   >&nbsp; mfid12 &nbsp; &nbsp;62.1M &nbsp;3.62T &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;650 &nbsp; &nbsp; &nbsp;0 &nbsp;3.29M</font></div><div><font size="2"   >---------- &nbsp;----- &nbsp;----- &nbsp;----- &nbsp;----- &nbsp;----- &nbsp;-----</font></div><div><font size="2"   >zroot &nbsp; &nbsp; &nbsp; 2.69G &nbsp; 273G &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; mfid0p3 &nbsp; 2.69G &nbsp; 273G &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >---------- &nbsp;----- &nbsp;----- &nbsp;----- &nbsp;----- &nbsp;----- &nbsp;-----</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   ># iostat -x 1</font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extended device statistics &nbsp;</font></div><div><font size="2"   >device &nbsp; &nbsp; r/s &nbsp; w/s &nbsp; &nbsp;kr/s &nbsp; &nbsp;kw/s qlen svc_t &nbsp;%b &nbsp;</font></div><div><font size="2"   >mfid0 &nbsp; &nbsp; &nbsp;0.0 &nbsp; 0.0 &nbsp; &nbsp; 0.0 &nbsp; &nbsp; 0.0 &nbsp; &nbsp;0 &nbsp; 0.0 &nbsp; 0&nbsp;</font></div><div><font size="2"   >mfid1 &nbsp; &nbsp; &nbsp;0.0 416.6 &nbsp; &nbsp; 0.0 &nbsp;7468.5 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 2&nbsp;</font></div><div><font size="2"   >mfid2 &nbsp; &nbsp; &nbsp;0.0 416.6 &nbsp; &nbsp; 0.0 &nbsp;7468.5 &nbsp; &nbsp;0 &nbsp; 0.0 &nbsp; 2&nbsp;</font></div><div><font size="2"   >mfid3 &nbsp; &nbsp; &nbsp;0.0 429.6 &nbsp; &nbsp; 0.0 &nbsp;7480.0 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 2&nbsp;</font></div><div><font size="2"   >mfid4 &nbsp; &nbsp; &nbsp;0.0 433.6 &nbsp; &nbsp; 0.0 &nbsp;7484.0 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 3&nbsp;</font></div><div><font size="2"   >mfid5 &nbsp; &nbsp; &nbsp;0.0 433.6 &nbsp; &nbsp; 0.0 &nbsp;7495.9 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 2&nbsp;</font></div><div><font size="2"   >mfid6 &nbsp; &nbsp; &nbsp;0.0 421.6 &nbsp; &nbsp; 0.0 &nbsp;7484.5 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 3&nbsp;</font></div><div><font size="2"   >mfid7 &nbsp; &nbsp; &nbsp;0.0 417.6 &nbsp; &nbsp; 0.0 &nbsp;7488.5 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 3&nbsp;</font></div><div><font size="2"   >mfid8 &nbsp; &nbsp; &nbsp;0.0 438.6 &nbsp; &nbsp; 0.0 &nbsp;7638.3 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 2&nbsp;</font></div><div><font size="2"   >mfid9 &nbsp; &nbsp; &nbsp;0.0 437.6 &nbsp; &nbsp; 0.0 &nbsp;7510.4 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 2&nbsp;</font></div><div><font size="2"   >mfid10 &nbsp; &nbsp; 0.0 428.6 &nbsp; &nbsp; 0.0 &nbsp;7494.4 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 4&nbsp;</font></div><div><font size="2"   >mfid11 &nbsp; &nbsp; 0.0 416.6 &nbsp; &nbsp; 0.0 &nbsp;7468.5 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 2&nbsp;</font></div><div><font size="2"   >mfid12 &nbsp; &nbsp; 0.0 416.6 &nbsp; &nbsp; 0.0 &nbsp;7468.5 &nbsp; &nbsp;0 &nbsp; 0.1 &nbsp; 2</font></div></div><p></p></pre></div><div><br></div><div>disable sync的情形, FreeBSD和Linux下差不多.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># zfs set sync=disabled zp1/data01</font></div><div><div><font size="2"   ># /opt/pgsql9.3.4/bin/pg_test_fsync -f /data01/1</font></div><div><font size="2"   >5 seconds per test</font></div><div><font size="2"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using one 8kB write:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 115687.300 ops/sec &nbsp; &nbsp; &nbsp; 9 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 126789.698 ops/sec &nbsp; &nbsp; &nbsp; 8 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using two 8kB writes:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 65027.801 ops/sec &nbsp; &nbsp; &nbsp;15 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 60239.232 ops/sec &nbsp; &nbsp; &nbsp;17 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare open_sync with different write sizes:</font></div><div><font size="2"   >(This is designed to compare the cost of writing 16kB</font></div><div><font size="2"   >in different write open_sync sizes.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; 115246.114 ops/sec &nbsp; &nbsp; &nbsp; 9 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp;63999.355 ops/sec &nbsp; &nbsp; &nbsp;16 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp;33661.426 ops/sec &nbsp; &nbsp; &nbsp;30 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp;18960.527 ops/sec &nbsp; &nbsp; &nbsp;53 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; 8251.087 ops/sec &nbsp; &nbsp; 121 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font size="2"   >(If the times are similar, fsync() can sync data written</font></div><div><font size="2"   >on a different descriptor.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 47380.701 ops/sec &nbsp; &nbsp; &nbsp;21 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 50214.128 ops/sec &nbsp; &nbsp; &nbsp;20 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Non-Sync'ed 8kB writes:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 78263.057 ops/sec &nbsp; &nbsp; &nbsp;13 usecs/op</font></div></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014526992910/"   >http://blog.163.com/digoal@126/blog/static/1638770402014526992910/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201451181344545/"   >http://blog.163.com/digoal@126/blog/static/163877040201451181344545/</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201451282121414/"   >http://blog.163.com/digoal@126/blog/static/163877040201451282121414/</a></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="ZFS fsync IOPS performance in FreeBSD - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>