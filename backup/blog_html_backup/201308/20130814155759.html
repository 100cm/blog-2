<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL SystemTap on Linux - 1</h2>
	<h5 id="">2013-08-14 15:57:59&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020137140265557/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 支持动态跟踪, 可以通过dtrace或者systemtap工具统计相关探针的信息.</div><div>安装systemtap</div><pre class="prettyprint"   ><p></p><div><font size="2"   >yum install systemtap kernel-debuginfo kernel-devel</font></div><div></div><p></p></pre><div><span style="line-height: 22px;"   >将安装以下包</span></div><div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >systemtap-devel-1.8-6.el5</font></div><div style="line-height: 22px;"   ><font size="2"   >systemtap-client-1.8-6.el5</font></div></div><div style="line-height: 22px;"   ><font size="2"   >systemtap-runtime-1.8-6.el5</font></div><p></p></pre></div></div></div><div style="line-height: 22px;"   >后面将使用的stap命令</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# rpm -qf /usr/bin/stap</font></div><div><font size="2"   >systemtap-devel-1.8-6.el5</font></div><div><font size="2"   >systemtap-client-1.8-6.el5</font></div><p></p></pre></div><div><br></div><div>检查stap是否正常</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# stap&nbsp;</font></div><div><font size="2"   >stap: /usr/lib64/libelf.so.1: version `ELFUTILS_1.5' not found (required by stap)</font></div><div><font size="2"   >stap: /usr/lib64/libdw.so.1: version `ELFUTILS_0.148' not found (required by stap)</font></div><div><font size="2"   >stap: /usr/lib64/libdw.so.1: version `ELFUTILS_0.138' not found (required by stap)</font></div><div><font size="2"   >stap: /usr/lib64/libdw.so.1: version `ELFUTILS_0.142' not found (required by stap)</font></div><div><font size="2"   >stap: /usr/lib64/libdw.so.1: version `ELFUTILS_0.143' not found (required by stap)</font></div><div><font size="2"   >stap: /usr/lib64/libdw.so.1: version `ELFUTILS_0.149' not found (required by stap)</font></div><p></p></pre></div><div>这个错误的原因是库文件版本不正确, 用来老版本, 使用eu-readelf查看stap文件的两个环境变量, 如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >[root@db-172-16-3-39 ~]# eu-readelf -d /usr/bin/stap|grep -E "RPATH|RUNPATH"</font></span></div><div><div><font size="2"   >&nbsp; RPATH &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Library rpath: [/usr/lib64/systemtap]</font></div><div><font size="2"   >&nbsp; RUNPATH &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Library runpath: [/usr/lib64/systemtap]</font></div></div><p></p></pre></div><div>将路径加入到LD_LIBRARY_PATH中.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# export LD_LIBRARY_PATH=/usr/lib64/systemtap:$LD_LIBRARY_PATH</font></div><div></div><p></p></pre><div><span style="line-height: 22px;"   >stap现在正常了</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# stap&nbsp;</font></div><div><font size="2"   >A script must be specified.</font></div><div><font size="2"   >Systemtap translator/driver (version 1.8/0.152 non-git sources)</font></div><div><font size="2"   >Copyright (C) 2005-2012 Red Hat, Inc. and others</font></div><div><font size="2"   >This is free software; see the source for copying conditions.</font></div><div><font size="2"   >enabled features: AVAHI LIBRPM LIBSQLITE3 NSS BOOST_SHARED_PTR TR1_UNORDERED_MAP NLS</font></div><div><font size="2"   >Usage: stap [options] FILE &nbsp; &nbsp; &nbsp; &nbsp; Run script in file.</font></div><div><font size="2"   >&nbsp; &nbsp;or: stap [options] - &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Run script on stdin.</font></div><div><font size="2"   >&nbsp; &nbsp;or: stap [options] -e SCRIPT &nbsp; &nbsp;Run given script.</font></div><div><font size="2"   >&nbsp; &nbsp;or: stap [options] -l PROBE &nbsp; &nbsp; List matching probes.</font></div><div><font size="2"   >&nbsp; &nbsp;or: stap [options] -L PROBE &nbsp; &nbsp; List matching probes and local variables.</font></div><p></p></pre></div></div><div>测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-39 pg94]# vi tps.d&nbsp;</font></div><div><font size="2"   >probe begin</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; printf("hello\n")</font></div><div><font size="2"   >&nbsp; exit()</font></div><div><font size="2"   >}</font></div></div><div><div><font size="2"   >[root@db-172-16-3-39 pg94]# stap tps.d&nbsp;</font></div><div><font size="2"   >Checking "/lib/modules/2.6.18-274.el5/build/.config" failed with error: No such file or directory</font></div><div><font size="2"   >Incorrect version or missing kernel-devel package, use: yum install kernel-devel-2.6.18-274.el5.x86_64&nbsp;</font></div></div><p></p></pre></div><div>这个错误是由于未安装当前正在运行的kernel对应的kernel-devel包.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-39 pg94]# rpm -qa|grep kernel</font></div><div><font size="2"   >kernel-headers-2.6.18-274.el5</font></div><div><font size="2"   >kernel-xen-devel-2.6.18-274.el5</font></div><div><font size="2"   >kernel-xen-2.6.18-274.el5</font></div><div><font size="2"   >kernel-2.6.18-274.el5</font></div></div><div><div><font size="2"   >[root@db-172-16-3-39 ~]# uname -a</font></div><div><font size="2"   >Linux db-172-16-3-39.sky-mobi.com 2.6.18-274.el5 #1 SMP Fri Jul 22 04:43:29 EDT 2011 x86_64 x86_64 x86_64 GNU/Linux</font></div></div><p></p></pre></div><div><br></div><div>安装对应的kernel-devel版本.</div><pre class="prettyprint"   ><p></p><div><font size="2"   >yum install kernel-devel-2.6.18-274.el5.x86_64</font></div><div></div><p></p></pre><div><span style="line-height: 22px;"   >如果yum源中没有这个版本的kernel-devel包, 可以去安装光盘中找一找.</span></div><div>或者同时更新内核版本至新版本.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp;yum install -y kernel.x86_64&nbsp;kernel-devel.x86_64</font></div><div><div><font size="2"   >Package kernel-2.6.18-348.12.1.el5.x86_64 already installed and latest version</font></div><div><font size="2"   >Package kernel-devel-2.6.18-348.12.1.el5.x86_64 already installed and latest version</font></div></div><div><font size="2"   >vi /boot/grub/grub.conf</font></div><div><div><font size="2"   >default=0</font></div><div><font size="2"   >timeout=5</font></div><div><font size="2"   >splashimage=(hd0,0)/boot/grub/splash.xpm.gz</font></div><div><font size="2"   >hiddenmenu</font></div><div><font size="2"   >title CentOS (2.6.18-348.12.1.el5)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; root (hd0,0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; kernel /boot/vmlinuz-2.6.18-348.12.1.el5 ro root=LABEL=/ rhgb quiet</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; initrd /boot/initrd-2.6.18-348.12.1.el5.img</font></div></div><p></p></pre></div><div>重启服务器</div><div>现在stap工作正常了 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 19px;"   >[root@db-172-16-3-39 postgresql-5e3e8e4]# stap -ve 'probe begin { log("hello world") exit() }'<br>Pass 1: parsed user script and 85 library script(s) using 146788virt/23676res/3000shr/21384data kb, in 170usr/0sys/173real ms.<br>Pass 2: analyzed script: 1 probe(s), 2 function(s), 0 embed(s), 0 global(s) using 147316virt/24396res/3224shr/21912data kb, in 10usr/0sys/6real ms.<br>Pass 3: using cached /root/.systemtap/cache/3b/stap_3b2eaec778ce9832b394535505dde575_838.c<br>Pass 4: using cached /root/.systemtap/cache/3b/stap_3b2eaec778ce9832b394535505dde575_838.ko<br>Pass 5: starting run.<br>hello world<br>Pass 5: run completed in 0usr/20sys/306real ms.</span></font></div><p></p></pre></div><div>stap调试好后, 就可以用来跟踪postgresql了.</div><div>PostgreSQL编译时必须开启dtrace支持. 开启dtrace后, 数据库将启用代码中的探针或跟踪点.</div><div>PostgreSQL内建探针参考如下 :&nbsp;</div><div>src/backend/utils/probes.d</div><div><a rel="nofollow" href="http://www.postgresql.org/docs/devel/static/dynamic-trace.html"   >http://www.postgresql.org/docs/devel/static/dynamic-trace.html</a></div><div>检查你的PostgreSQL是否开启了dtrace支持, 如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg94@db-172-16-3-39-&gt; pg_config --configure</font></div><div><font size="2"   >'--prefix=/home/pg94/pgsql9.4devel' '--with-pgport=2999' '--with-perl' '--with-tcl' '--with-python' '--with-openssl' '--with-pam' '--without-ldap' '--with-libxml' '--with-libxslt' '--enable-thread-safety' '--with-wal-blocksize=16' '--enable-dtrace'</font></div><p></p></pre></div><div>如果没有--enable-dtrace, 那么需要重新编译一下你的PostgreSQL软件.</div><div><br></div><div>stap测试脚本1.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 pg94]# cat postgresql-query.stp&nbsp;</font></div><div><font size="2"   >global query_time, query_summary</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe process("/home/pg94/pgsql9.4devel/bin/postgres").mark("query__start") {</font></div><div><font size="2"   >&nbsp; query_time[tid(), $arg1] = gettimeofday_us();</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe process("/home/pg94/pgsql9.4devel/bin/postgres").mark("query__done") {</font></div><div><font size="2"   >&nbsp; p = tid()</font></div><div><font size="2"   >&nbsp; t = query_time[p, $arg1]; delete query_time[p, $arg1]</font></div><div><font size="2"   >&nbsp; if (t) {</font></div><div><font size="2"   >&nbsp; &nbsp; query_summary[p] &lt;&lt;&lt; (gettimeofday_us() - t);</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe end {</font></div><div><font size="2"   >&nbsp; printf("\ntid count min(us) avg(us) max(us)\n");</font></div><div><font size="2"   >&nbsp; foreach (p in query_summary) {</font></div><div><font size="2"   >&nbsp; &nbsp; printf("%d %d %d %d %d\n", p, @count(query_summary[p]),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;@min(query_summary[p]), @avg(query_summary[p]), @max(query_summary[p]));</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >}</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >执行stap :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >[root@db-172-16-3-39 pg94]# stap postgresql-query.stp&nbsp;</font></span></div><div></div><p></p></pre></div><div>执行以下SQL :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 pg94]# stap postgresql-query.stp&nbsp;</font></div><div><div><font size="2"   >digoal=# begin;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >digoal=# select * from test for update;</font></div><div><font size="2"   >&nbsp;id&nbsp;</font></div><div><font size="2"   >----</font></div><div><font size="2"   >&nbsp; 1</font></div><div><font size="2"   >&nbsp; 2</font></div><div><font size="2"   >&nbsp; 3</font></div><div><font size="2"   >&nbsp; 4</font></div><div><font size="2"   >&nbsp; 5</font></div><div><font size="2"   >&nbsp; 6</font></div><div><font size="2"   >&nbsp; 7</font></div><div><font size="2"   >&nbsp; 8</font></div><div><font size="2"   >&nbsp; 9</font></div><div><font size="2"   >&nbsp;10</font></div><div><font size="2"   >(10 rows)</font></div><div><font size="2"   >digoal=# end;</font></div><div><font size="2"   >COMMIT</font></div><div><font size="2"   >digoal=# select txid_current();</font></div><div><font size="2"   >&nbsp;txid_current&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; 5969062</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>结束stap, 输出 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 pg94]# stap postgresql-query.stp&nbsp;</font></div><div><font size="2"   >按键Ctrl+C, 输出 :&nbsp;</font></div><div><div><font size="2"   >tid count min(us) avg(us) max(us)</font></div><div><font size="2"   >17112 4 46 3794 14885</font></div></div><p></p></pre></div><div><div>这个tid对应PostgreSQL background process</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-39 pg94]# ps -ewf|grep 17112</font></div><div><font size="2"   >pg94 &nbsp; &nbsp; 17112 17005 &nbsp;0 15:15 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: postgres digoal [local] idle</font></div></div><div><div><font size="2"   >digoal=# select pg_backend_pid();</font></div><div><font size="2"   >&nbsp;pg_backend_pid&nbsp;</font></div><div><font size="2"   >----------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 17112</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div></div><div><br></div><div>[小结]</div><div>1. 安装systemtap注意 :&nbsp;</div><div>-- 需要安装kernel相关, 并且版本要一致, 启动的kernel版本也要一致 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >kernel</font></div><div><font size="2"   >kernel-debuginfo</font></div><div><font size="2"   >kernel-devel</font></div><p></p></pre></div><div>kernel-debuginfo的安装要用到debug源.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 pg94]# cd /etc/yum.repos.d/</font></div><div><font size="2"   >[root@db-172-16-3-39 yum.repos.d]# ll</font></div><div><font size="2"   >total 36</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1926 Aug 29 &nbsp;2011 CentOS-Base.repo</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;631 Aug 29 &nbsp;2011 CentOS-Debuginfo.repo</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;626 Aug 29 &nbsp;2011 CentOS-Media.repo</font></div><div><font size="2"   >-rw-r--r-- 1 root root 5390 Aug 29 &nbsp;2011 CentOS-Vault.repo</font></div><div><font size="2"   >[root@db-172-16-3-39 yum.repos.d]# cat CentOS-Debuginfo.repo&nbsp;</font></div><div><font size="2"   ># CentOS-Base.repo</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># The mirror system uses the connecting IP address of the client and the</font></div><div><font size="2"   ># update status of each mirror to pick mirrors that are updated to and</font></div><div><font size="2"   ># geographically close to the client. &nbsp;You should use this for CentOS updates</font></div><div><font size="2"   ># unless you are manually picking other mirrors.</font></div><div><font size="2"   >#</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># All debug packages from all the various CentOS-5 releases</font></div><div><font size="2"   ># are merged into a single repo, split by BaseArch</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># Note: packages in the debuginfo repo are currently not signed</font></div><div><font size="2"   >#</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[debug]</font></div><div><font size="2"   >name=CentOS-5 - Debuginfo</font></div><div><font size="2"   >baseurl=http://debuginfo.centos.org/5/$basearch/</font></div><div><font size="2"   >gpgcheck=0</font></div><div><font size="2"   >gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-5</font></div><div><font size="2"   >enabled=0</font></div><p></p></pre></div><div>这里用到的源名为debug.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >yum --enablerepo=debug list kernel-debuginfo</font></div><div><font size="2"   >yum --enablerepo=debug install kernel-debuginfo</font></div></pre></div><div><span style="line-height: 22px;"   >安装细节参考此文 :&nbsp;</span></div><div><a rel="nofollow" href="http://pic.dhe.ibm.com/infocenter/lnxinfo/v3r0m0/topic/liaai.systemTap/liaaisystap_pdf.pdf"   >http://pic.dhe.ibm.com/infocenter/lnxinfo/v3r0m0/topic/liaai.systemTap/liaaisystap_pdf.pdf</a></div><div><br></div><div>2. postgresql编译时必须加上--enable-dtrace参数, 否则stap时会出现类似以下错误.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 pg93]# stap test.stp&nbsp;</font></div><div><font size="2"   >semantic error: while resolving probe point: identifier 'process' at test.stp:3:7</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; source: probe process("/opt/pgsql9.3beta2/bin/postgres").mark("lock__wait__start")</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >semantic error: no match</font></div><div><font size="2"   >semantic error: while resolving probe point: identifier 'process' at :8:7</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; source: probe process("/opt/pgsql9.3beta2/bin/postgres").mark("lock__wait__done")</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >semantic error: while resolving probe point: identifier 'process' at :17:7</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; source: probe process("/opt/pgsql9.3beta2/bin/postgres").mark("lwlock__wait__start")</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >semantic error: while resolving probe point: identifier 'process' at :22:7</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; source: probe process("/opt/pgsql9.3beta2/bin/postgres").mark("lwlock__wait__done")</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >semantic error: while resolving probe point: identifier 'process' at :32:7</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; source: probe process("/opt/pgsql9.3beta2/bin/postgres").mark("lwlock__condacquire__fail")</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Pass 2: analysis failed. &nbsp;Try again with another '--vp 01' option.</font></div><p></p></pre></div><div>3. 允许stap需要root权限, 或者将用户加入stapdev或者stapsys, 以及stapusr组.</div><div>如果普通用户不加入这两个组, 执行stap将报错 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-39-&gt; stap -ve 'probe begin { log("hello world") exit() }'</font></div><div><font size="2"   >You are trying to run systemtap as a normal user.</font></div><div><font size="2"   >You should either be root, or be part of the group "stapusr" and possibly one of the groups "stapsys" or "stapdev".</font></div><div><font size="2"   >Systemtap translator/driver (version 1.8/0.152 non-git sources)</font></div><p></p></pre></div><div>加完组后正常</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># usermod -G stapdev,stapusr pg94</font></div><div><div><font size="2"   >pg94@db-172-16-3-39-&gt; stap -ve 'probe begin { log("hello world") exit() }'</font></div><div><font size="2"   >Pass 1: parsed user script and 85 library script(s) using 148892virt/23772res/3068shr/21396data kb, in 160usr/10sys/172real ms.</font></div><div><font size="2"   >Pass 2: analyzed script: 1 probe(s), 2 function(s), 0 embed(s), 0 global(s) using 149420virt/24492res/3292shr/21924data kb, in 10usr/0sys/6real ms.</font></div><div><font size="2"   >Pass 3: translated to C into "/tmp/stapcqtmUe/stap_758dbd41826239e5e3211a815f6bfc58_838_src.c" using 149420virt/24760res/3540shr/21924data kb, in 0usr/0sys/0real ms.</font></div><div><font size="2"   >Pass 4: compiled C into "stap_758dbd41826239e5e3211a815f6bfc58_838.ko" in 910usr/110sys/1028real ms.</font></div><div><font size="2"   >Pass 5: starting run.</font></div><div><font size="2"   >hello world</font></div><div><font size="2"   >Pass 5: run completed in 10usr/20sys/307real ms.</font></div></div><p></p></pre></div><div>本文就介绍到这里, 下次将介绍如何使用postgresql的探针.</div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://pgfoundry.org/projects/dtrace/"   >http://pgfoundry.org/projects/dtrace/</a></div><div>2.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.fosslc.org/drupal/content/probing-postgresql-dtrace-and-systemtap"   >http://www.fosslc.org/drupal/content/probing-postgresql-dtrace-and-systemtap</a></div><div>3.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/dynamic-trace.html"   >http://www.postgresql.org/docs/devel/static/dynamic-trace.html</a></div><div>4.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/install-procedure.html"   >http://www.postgresql.org/docs/devel/static/install-procedure.html</a></div><div>5.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.ppurl.com/2011/05/dtrace-dynamic-tracing-in-oracle-solaris-mac-os-x-and-freebsd.html"   >http://www.ppurl.com/2011/05/dtrace-dynamic-tracing-in-oracle-solaris-mac-os-x-and-freebsd.html</a></div><div>6.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.emm.usp.br/downloads/pg/PG_perf_bootcamp.pdf"   >http://www.emm.usp.br/downloads/pg/PG_perf_bootcamp.pdf</a></div><div>7.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="https://wiki.postgresql.org/wiki/DTrace"   >https://wiki.postgresql.org/wiki/DTrace</a></div><div>8.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.ppurl.com/?s=systemtap"   >http://www.ppurl.com/?s=systemtap</a></div><div>9.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.ibm.com/developerworks/cn/linux/l-systemtap/"   >http://www.ibm.com/developerworks/cn/linux/l-systemtap/</a></div><div>10.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://sourceware.org/systemtap/wiki/HomePage"   >http://sourceware.org/systemtap/wiki/HomePage</a></div><div>11.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://fruli.krunch.be/~krunch/systemtap-osdcfr-20101010.pdf"   >http://fruli.krunch.be/~krunch/systemtap-osdcfr-20101010.pdf</a></div><div>12.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://blog.endpoint.com/2009/05/postgresql-with-systemtap.html"   >http://blog.endpoint.com/2009/05/postgresql-with-systemtap.html</a></div><div>13.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="https://www.evernote.com/shard/s48/sh/1ccb0466-79b7-4090-9a5d-9371358ac54d/b8434e3e3b3130ce72422b9ae067e7b9"   >https://www.evernote.com/shard/s48/sh/1ccb0466-79b7-4090-9a5d-9371358ac54d/b8434e3e3b3130ce72422b9ae067e7b9</a></div><div>14.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://pic.dhe.ibm.com/infocenter/lnxinfo/v3r0m0/topic/liaai.systemTap/liaaisystap_pdf.pdf"   >http://pic.dhe.ibm.com/infocenter/lnxinfo/v3r0m0/topic/liaai.systemTap/liaaisystap_pdf.pdf</a></div><div>15.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://linux.chinaunix.net/techdoc/develop/2008/12/28/1055546.shtml"   >http://linux.chinaunix.net/techdoc/develop/2008/12/28/1055546.shtml</a></div><div>16.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://os.51cto.com/art/201305/395819.htm"   >http://os.51cto.com/art/201305/395819.htm</a></div>17.&nbsp;<a rel="nofollow" href="https://access.redhat.com/site/documentation/Red_Hat_Enterprise_Linux/?locale=en-US"   >https://access.redhat.com/site/documentation/Red_Hat_Enterprise_Linux/?locale=en-US</a></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">alexsunchenchen - 2014-04-10 22:01:23</h5>
				<div>视频看到第五章了~~~路过路过~</div>
			</div>
	</div>
</div>
</body>
</html>