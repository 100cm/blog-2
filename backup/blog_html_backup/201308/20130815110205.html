<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL pending patch : supports SQL:2011 Feature T111, "Updatable joins, unions and columns"</h2>
	<h5 id="">2013-08-15 11:02:05&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020137151053460/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>目前PostgreSQL updatable view只支持简单视图的更新.&nbsp;</div><div>对于非简单视图, 例如带join的视图, 带非基表列的视图, 无法支持自动dml.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# create view v1 as select id from t1 where id&gt;100;</font></div><div><font size="2"   >CREATE VIEW</font></div><div><font size="2"   >digoal=# insert into v1 values (1);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# select * from v1;</font></div><div><font size="2"   >&nbsp;id&nbsp;</font></div><div><font size="2"   >----</font></div><div><font size="2"   >(0 rows)</font></div><div><font size="2"   >digoal=# select * from t1;</font></div><div><font size="2"   >&nbsp;id | info | crt_time&nbsp;</font></div><div><font size="2"   >----+------+----------</font></div><div><font size="2"   >&nbsp; 1 | &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >以下就不行了</font></div><div><div><font size="2"   >digoal=# create view v2 as select id,upper(info) from t1 where id&gt;100;</font></div><div><font size="2"   >CREATE VIEW</font></div><div><font size="2"   >digoal=# insert into v2(id) values (2);</font></div><div><font size="2"   >ERROR: &nbsp;cannot insert into view "v2"</font></div><div><font size="2"   >DETAIL: &nbsp;Views that return columns that are not columns of their base relation are not automatically updatable.</font></div><div><font size="2"   >HINT: &nbsp;To make the view insertable, provide an unconditional ON INSERT DO INSTEAD rule or an INSTEAD OF INSERT trigger.</font></div></div><p></p></pre></div><div>SQL2011标准中T111, 对于以上视图也是可以更新的, 即base 表的原始列.</div><div>PostgreSQL在打补丁后, 支持包含非base表列的视图的dml操作 .</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# create view v3 as select ctid,cmin,cmax,xmin,xmax,tableoid,* from t1;</font></div><div><font size="2"   >CREATE VIEW</font></div></div><div><div><font size="2"   >digoal=# insert into v3(id,info,crt_time) values (1,'test',now());</font></div><div><font size="2"   >INSERT 0 1</font></div></div><div><div><font size="2"   >digoal=# select * from v3;</font></div><div><font size="2"   >&nbsp;ctid &nbsp;| cmin | cmax | &nbsp;xmin &nbsp; | xmax | tableoid | id | info | &nbsp; &nbsp; &nbsp; &nbsp; crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >-------+------+------+---------+------+----------+----+------+---------------------------</font></div><div><font size="2"   >&nbsp;(0,1) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 5969068 | &nbsp; &nbsp;0 | &nbsp; &nbsp;16421 | &nbsp;1 | test | 2013-08-15 10:19:41.53373</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >digoal=# create view v5 as select id,upper(info) from t1;</font></div><div><font size="2"   >CREATE VIEW</font></div></div><div><div><font size="2"   >digoal=# insert into v5(id) values (101) returning *;</font></div><div><font size="2"   >&nbsp;id &nbsp;| upper&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp;101 |&nbsp;</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >INSERT 0 1</font></div></div><p></p></pre></div><div>其他详细的SQL测试见本文末尾.</div><div><br></div><div>Oracle12C版本也支持这个特性.</div><div><b style="color: rgb(34, 34, 34); font-family: Tahoma, sans-serif; font-size: small; line-height: normal;"   >Oracle? Database SQL Language Reference</b><b style="color: rgb(34, 34, 34); font-family: Tahoma, sans-serif; font-size: small;"   >&nbsp;<span style="line-height: normal;"   >12</span><i style="line-height: normal;"   >c</i><span style="line-height: normal;"   >&nbsp;Release 1 (12.1)</span></b></div><div><h1 style="font-size: 21px; line-height: normal; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); width: 910px; color: rgb(34, 34, 34); font-family: Tahoma, sans-serif;"   >Oracle Support for Optional Features of SQL/Foundation:2011</h1></div><div><table title="Oracle Support for Optional Features of SQL/Foundation:2011"   summary="Column 1 contains the SQL:2008 optional feature identifier and its descrption and column 2 describes the Oracle Database support of the feature."   dir="ltr"   border="1"   width="100%"   frame="hsides"   rules="rows"   cellpadding="3"   cellspacing="0"   style="font-size: small; max-width: 70em; color: rgb(34, 34, 34); font-family: Tahoma, sans-serif; line-height: 19px;"   ><tbody><tr align="left"   valign="top"   ><td align="left"   id="r120c1-t3"   headers="r1c1-t3"   style="vertical-align: top;"   ><p style="margin-top: 0px; margin-bottom: 0px; max-width: 70em;"   >T111, Updatable joins, unions and columns</p></td><td align="left"   headers="r120c1-t3 r1c2-t3"   style="vertical-align: top;"   ><p style="margin-top: 0px; margin-bottom: 0px; max-width: 70em;"   >Oracle's updatable join views are similar to the standard's updatable join capabilities. Unlike the standard, Oracle does not require an updatable join view to display the strong candidate key in the&nbsp;<code style="font-size: 12px;"   >SELECT</code>&nbsp;list. Although an updatable join view might have more than one key-preserved table, only one of them may be modified using an&nbsp;<code style="font-size: 12px;"   >UPDATE</code>&nbsp;or&nbsp;<code style="font-size: 12px;"   >DELETE</code>, unlike the standard, which modifies all key-preserved tables of an updatable join.</p></td></tr></table></div><div><br></div><div>PostgreSQL 9.4 devel打补丁的方法如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-39 soft_bak]# cd postgresql-5e3e8e4</font></div><div><font size="2"   >[root@db-172-16-3-39 postgresql-5e3e8e4]# wget http://www.postgresql.org/message-id/attachment/29837/updatable-view-cols.v1.patch</font></div></div><div><div><font size="2"   >[root@db-172-16-3-39 postgresql-5e3e8e4]# patch -p1 &lt; ./updatable-view-cols.v1.patch&nbsp;</font></div><div><font size="2"   >patching file src/backend/commands/tablecmds.c</font></div><div><font size="2"   >patching file src/backend/commands/view.c</font></div><div><font size="2"   >patching file src/backend/rewrite/rewriteHandler.c</font></div><div><font size="2"   >patching file src/backend/utils/adt/misc.c</font></div><div><font size="2"   >patching file src/include/rewrite/rewriteHandler.h</font></div><div><font size="2"   >patching file src/test/regress/expected/updatable_views.out</font></div><div><font size="2"   >patching file src/test/regress/sql/updatable_views.sql</font></div><div><font size="2"   >[root@db-172-16-3-39 postgresql-5e3e8e4]# gmake &amp;&amp; gmake install</font></div></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/message-id/flat/CAEZATCULXejsZVq3PvG8RJReyXwdPoZU_Myr6H2DWW5=ioR=NA@mail.gmail.com#CAEZATCULXejsZVq3PvG8RJReyXwdPoZU_Myr6H2DWW5=ioR=NA@mail.gmail.com"   >http://www.postgresql.org/message-id/flat/CAEZATCULXejsZVq3PvG8RJReyXwdPoZU_Myr6H2DWW5=ioR=NA@mail.gmail.com#CAEZATCULXejsZVq3PvG8RJReyXwdPoZU_Myr6H2DWW5=ioR=NA@mail.gmail.com</a></div><div>2. 详细的测试SQL, 包含哪些视图支持更新.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >*** a/src/test/regress/sql/updatable_views.sql</font></div><div><font size="2"   >--- b/src/test/regress/sql/updatable_views.sql</font></div><div><font size="2"   >***************</font></div><div><font size="2"   >*** 2,8 ****</font></div><div><font size="2"   >&nbsp; -- UPDATABLE VIEWS</font></div><div><font size="2"   >&nbsp; --</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >! -- check that non-updatable views are rejected with useful error messages</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; CREATE TABLE base_tbl (a int PRIMARY KEY, b text DEFAULT 'Unspecified');</font></div><div><font size="2"   >&nbsp; INSERT INTO base_tbl SELECT i, 'Row ' || i FROM generate_series(-2, 2) g(i);</font></div><div><font size="2"   >--- 2,9 ----</font></div><div><font size="2"   >&nbsp; -- UPDATABLE VIEWS</font></div><div><font size="2"   >&nbsp; --</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >! -- check that non-updatable views and columns are rejected with useful error</font></div><div><font size="2"   >! -- messages</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; CREATE TABLE base_tbl (a int PRIMARY KEY, b text DEFAULT 'Unspecified');</font></div><div><font size="2"   >&nbsp; INSERT INTO base_tbl SELECT i, 'Row ' || i FROM generate_series(-2, 2) g(i);</font></div><div><font size="2"   >*************** CREATE VIEW ro_view10 AS SELECT 1 AS a;</font></div><div><font size="2"   >*** 20,50 ****</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view11 AS SELECT b1.a, b2.b FROM base_tbl b1, base_tbl b2; -- Multiple base relations</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view12 AS SELECT * FROM generate_series(1, 10) AS g(a); -- SRF in rangetable</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view13 AS SELECT a, b FROM (SELECT * FROM base_tbl) AS t; -- Subselect in rangetable</font></div><div><font size="2"   >! CREATE VIEW ro_view14 AS SELECT ctid FROM base_tbl; -- System columns not supported</font></div><div><font size="2"   >! CREATE VIEW ro_view15 AS SELECT a, upper(b) FROM base_tbl; -- Expression/function in targetlist</font></div><div><font size="2"   >! CREATE VIEW ro_view16 AS SELECT a, b, a AS aa FROM base_tbl; -- Repeated column</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view17 AS SELECT * FROM ro_view1; -- Base relation not updatable</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view18 WITH (security_barrier = true)</font></div><div><font size="2"   >&nbsp; &nbsp; AS SELECT * FROM base_tbl; -- Security barrier views not updatable</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view19 AS SELECT * FROM (VALUES(1)) AS tmp(a); -- VALUES in rangetable</font></div><div><font size="2"   >&nbsp; CREATE SEQUENCE seq;</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view20 AS SELECT * FROM seq; -- View based on a sequence</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; SELECT table_name, is_insertable_into</font></div><div><font size="2"   >&nbsp; &nbsp; FROM information_schema.tables</font></div><div><font size="2"   >! &nbsp;WHERE table_name LIKE 'ro_view%'</font></div><div><font size="2"   >&nbsp; &nbsp;ORDER BY table_name;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; SELECT table_name, is_updatable, is_insertable_into</font></div><div><font size="2"   >&nbsp; &nbsp; FROM information_schema.views</font></div><div><font size="2"   >! &nbsp;WHERE table_name LIKE 'ro_view%'</font></div><div><font size="2"   >&nbsp; &nbsp;ORDER BY table_name;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; SELECT table_name, column_name, is_updatable</font></div><div><font size="2"   >&nbsp; &nbsp; FROM information_schema.columns</font></div><div><font size="2"   >! &nbsp;WHERE table_name LIKE 'ro_view%'</font></div><div><font size="2"   >&nbsp; &nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; DELETE FROM ro_view1;</font></div><div><font size="2"   >&nbsp; DELETE FROM ro_view2;</font></div><div><font size="2"   >&nbsp; DELETE FROM ro_view3;</font></div><div><font size="2"   >--- 21,53 ----</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view11 AS SELECT b1.a, b2.b FROM base_tbl b1, base_tbl b2; -- Multiple base relations</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view12 AS SELECT * FROM generate_series(1, 10) AS g(a); -- SRF in rangetable</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view13 AS SELECT a, b FROM (SELECT * FROM base_tbl) AS t; -- Subselect in rangetable</font></div><div><font size="2"   >! CREATE VIEW rw_view14 AS SELECT ctid, a, b FROM base_tbl; -- System columns may be part of an updatable view</font></div><div><font size="2"   >! CREATE VIEW rw_view15 AS SELECT a, upper(b) FROM base_tbl; -- Expression/function may be part of an updatable view</font></div><div><font size="2"   >! CREATE VIEW rw_view16 AS SELECT a, b, a AS aa FROM base_tbl; -- Repeated column may be part of an updatable view</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view17 AS SELECT * FROM ro_view1; -- Base relation not updatable</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view18 WITH (security_barrier = true)</font></div><div><font size="2"   >&nbsp; &nbsp; AS SELECT * FROM base_tbl; -- Security barrier views not updatable</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view19 AS SELECT * FROM (VALUES(1)) AS tmp(a); -- VALUES in rangetable</font></div><div><font size="2"   >&nbsp; CREATE SEQUENCE seq;</font></div><div><font size="2"   >&nbsp; CREATE VIEW ro_view20 AS SELECT * FROM seq; -- View based on a sequence</font></div><div><font size="2"   >+ CREATE VIEW ro_view21 AS SELECT a, b, generate_series(1, a) g FROM base_tbl; -- SRF in targetlist not supported</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; SELECT table_name, is_insertable_into</font></div><div><font size="2"   >&nbsp; &nbsp; FROM information_schema.tables</font></div><div><font size="2"   >! &nbsp;WHERE table_name LIKE E'r_\_view%'</font></div><div><font size="2"   >&nbsp; &nbsp;ORDER BY table_name;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; SELECT table_name, is_updatable, is_insertable_into</font></div><div><font size="2"   >&nbsp; &nbsp; FROM information_schema.views</font></div><div><font size="2"   >! &nbsp;WHERE table_name LIKE E'r_\_view%'</font></div><div><font size="2"   >&nbsp; &nbsp;ORDER BY table_name;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; SELECT table_name, column_name, is_updatable</font></div><div><font size="2"   >&nbsp; &nbsp; FROM information_schema.columns</font></div><div><font size="2"   >! &nbsp;WHERE table_name LIKE E'r_\_view%'</font></div><div><font size="2"   >&nbsp; &nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >+ -- Read-only views</font></div><div><font size="2"   >&nbsp; DELETE FROM ro_view1;</font></div><div><font size="2"   >&nbsp; DELETE FROM ro_view2;</font></div><div><font size="2"   >&nbsp; DELETE FROM ro_view3;</font></div><div><font size="2"   >*************** UPDATE ro_view10 SET a=a+1;</font></div><div><font size="2"   >*** 58,70 ****</font></div><div><font size="2"   >&nbsp; UPDATE ro_view11 SET a=a+1;</font></div><div><font size="2"   >&nbsp; UPDATE ro_view12 SET a=a+1;</font></div><div><font size="2"   >&nbsp; INSERT INTO ro_view13 VALUES (3, 'Row 3');</font></div><div><font size="2"   >! INSERT INTO ro_view14 VALUES (null);</font></div><div><font size="2"   >! INSERT INTO ro_view15 VALUES (3, 'ROW 3');</font></div><div><font size="2"   >! INSERT INTO ro_view16 VALUES (3, 'Row 3', 3);</font></div><div><font size="2"   >&nbsp; INSERT INTO ro_view17 VALUES (3, 'ROW 3');</font></div><div><font size="2"   >&nbsp; INSERT INTO ro_view18 VALUES (3, 'ROW 3');</font></div><div><font size="2"   >&nbsp; DELETE FROM ro_view19;</font></div><div><font size="2"   >&nbsp; UPDATE ro_view20 SET max_value=1000;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"   >&nbsp; DROP VIEW ro_view10, ro_view12, ro_view19;</font></div><div><font size="2"   >--- 61,96 ----</font></div><div><font size="2"   >&nbsp; UPDATE ro_view11 SET a=a+1;</font></div><div><font size="2"   >&nbsp; UPDATE ro_view12 SET a=a+1;</font></div><div><font size="2"   >&nbsp; INSERT INTO ro_view13 VALUES (3, 'Row 3');</font></div><div><font size="2"   >! -- Partially updatable view</font></div><div><font size="2"   >! INSERT INTO rw_view14 VALUES (null, 3, 'Row 3'); -- should fail</font></div><div><font size="2"   >! INSERT INTO rw_view14 (a, b) VALUES (3, 'Row 3'); -- should be OK</font></div><div><font size="2"   >! UPDATE rw_view14 SET ctid=null WHERE a=3; -- should fail</font></div><div><font size="2"   >! UPDATE rw_view14 SET b='ROW 3' WHERE a=3; -- should be OK</font></div><div><font size="2"   >! SELECT * FROM base_tbl;</font></div><div><font size="2"   >! DELETE FROM rw_view14 WHERE a=3; -- should be OK</font></div><div><font size="2"   >! -- Partially updatable view</font></div><div><font size="2"   >! INSERT INTO rw_view15 VALUES (3, 'ROW 3'); -- should fail</font></div><div><font size="2"   >! INSERT INTO rw_view15 (a) VALUES (3); -- should be OK</font></div><div><font size="2"   >! ALTER VIEW rw_view15 ALTER COLUMN upper SET DEFAULT 'NOT SET';</font></div><div><font size="2"   >! INSERT INTO rw_view15 (a) VALUES (4); -- should fail</font></div><div><font size="2"   >! UPDATE rw_view15 SET upper='ROW 3' WHERE a=3; -- should fail</font></div><div><font size="2"   >! UPDATE rw_view15 SET upper=DEFAULT WHERE a=3; -- should fail</font></div><div><font size="2"   >! UPDATE rw_view15 SET a=4 WHERE a=3; -- should be OK</font></div><div><font size="2"   >! SELECT * FROM base_tbl;</font></div><div><font size="2"   >! DELETE FROM rw_view15 WHERE a=4; -- should be OK</font></div><div><font size="2"   >! -- Partially updatable view</font></div><div><font size="2"   >! INSERT INTO rw_view16 VALUES (3, 'Row 3', 3); -- should fail</font></div><div><font size="2"   >! INSERT INTO rw_view16 (a, b) VALUES (3, 'Row 3'); -- should be OK</font></div><div><font size="2"   >! UPDATE rw_view16 SET a=3, aa=-3 WHERE a=3; -- should fail</font></div><div><font size="2"   >! UPDATE rw_view16 SET aa=-3 WHERE a=3; -- should be OK</font></div><div><font size="2"   >! SELECT * FROM base_tbl;</font></div><div><font size="2"   >! DELETE FROM rw_view16 WHERE a=-3; -- should be OK</font></div><div><font size="2"   >! -- Read-only views</font></div><div><font size="2"   >&nbsp; INSERT INTO ro_view17 VALUES (3, 'ROW 3');</font></div><div><font size="2"   >&nbsp; INSERT INTO ro_view18 VALUES (3, 'ROW 3');</font></div><div><font size="2"   >&nbsp; DELETE FROM ro_view19;</font></div><div><font size="2"   >&nbsp; UPDATE ro_view20 SET max_value=1000;</font></div><div><font size="2"   >+ UPDATE ro_view21 SET b=upper(b);</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"   >&nbsp; DROP VIEW ro_view10, ro_view12, ro_view19;</font></div><div><font size="2"   >*************** SELECT * FROM rw_view1;</font></div><div><font size="2"   >*** 510,515 ****</font></div><div><font size="2"   >--- 536,603 ----</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >+ -- views with updatable and non-updatable columns</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ CREATE TABLE base_tbl(a float);</font></div><div><font size="2"   >+ INSERT INTO base_tbl SELECT i/10.0 FROM generate_series(1,10) g(i);</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ CREATE VIEW rw_view1 AS</font></div><div><font size="2"   >+ &nbsp; SELECT ctid, sin(a) s, a, cos(a) c</font></div><div><font size="2"   >+ &nbsp; FROM base_tbl</font></div><div><font size="2"   >+ &nbsp; WHERE a != 0</font></div><div><font size="2"   >+ &nbsp; ORDER BY abs(a);</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ INSERT INTO rw_view1 VALUES (null, null, 1.1, null); -- should fail</font></div><div><font size="2"   >+ INSERT INTO rw_view1 (s, c, a) VALUES (null, null, 1.1); -- should fail</font></div><div><font size="2"   >+ INSERT INTO rw_view1 (a) VALUES (1.1) RETURNING a, s, c; -- OK</font></div><div><font size="2"   >+ UPDATE rw_view1 SET s = s WHERE a = 1.1; -- should fail</font></div><div><font size="2"   >+ UPDATE rw_view1 SET a = 1.05 WHERE a = 1.1 RETURNING s; -- OK</font></div><div><font size="2"   >+ DELETE FROM rw_view1 WHERE a = 1.05; -- OK</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ CREATE VIEW rw_view2 AS</font></div><div><font size="2"   >+ &nbsp; SELECT s, c, s/c t, a base_a, ctid</font></div><div><font size="2"   >+ &nbsp; FROM rw_view1;</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ INSERT INTO rw_view2 VALUES (null, null, null, 1.1, null); -- should fail</font></div><div><font size="2"   >+ INSERT INTO rw_view2(s, c, base_a) VALUES (null, null, 1.1); -- should fail</font></div><div><font size="2"   >+ INSERT INTO rw_view2(base_a) VALUES (1.1) RETURNING t; -- OK</font></div><div><font size="2"   >+ UPDATE rw_view2 SET s = s WHERE base_a = 1.1; -- should fail</font></div><div><font size="2"   >+ UPDATE rw_view2 SET t = t WHERE base_a = 1.1; -- should fail</font></div><div><font size="2"   >+ UPDATE rw_view2 SET base_a = 1.05 WHERE base_a = 1.1; -- OK</font></div><div><font size="2"   >+ DELETE FROM rw_view2 WHERE base_a = 1.05 RETURNING base_a, s, c, t; -- OK</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ CREATE VIEW rw_view3 AS</font></div><div><font size="2"   >+ &nbsp; SELECT s, c, s/c t, ctid</font></div><div><font size="2"   >+ &nbsp; FROM rw_view1;</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ INSERT INTO rw_view3 VALUES (null, null, null, null); -- should fail</font></div><div><font size="2"   >+ INSERT INTO rw_view3(s) VALUES (null); -- should fail</font></div><div><font size="2"   >+ UPDATE rw_view3 SET s = s; -- should fail</font></div><div><font size="2"   >+ DELETE FROM rw_view3 WHERE s = sin(0.1); -- should be OK</font></div><div><font size="2"   >+ SELECT * FROM base_tbl ORDER BY a;</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ SELECT table_name, is_insertable_into</font></div><div><font size="2"   >+ &nbsp; FROM information_schema.tables</font></div><div><font size="2"   >+ &nbsp;WHERE table_name LIKE E'r_\_view%'</font></div><div><font size="2"   >+ &nbsp;ORDER BY table_name;</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ SELECT table_name, is_updatable, is_insertable_into</font></div><div><font size="2"   >+ &nbsp; FROM information_schema.views</font></div><div><font size="2"   >+ &nbsp;WHERE table_name LIKE E'r_\_view%'</font></div><div><font size="2"   >+ &nbsp;ORDER BY table_name;</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ SELECT table_name, column_name, is_updatable</font></div><div><font size="2"   >+ &nbsp; FROM information_schema.columns</font></div><div><font size="2"   >+ &nbsp;WHERE table_name LIKE E'r_\_view%'</font></div><div><font size="2"   >+ &nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ SELECT events &amp; 4 != 0 AS upd,</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;events &amp; 8 != 0 AS ins,</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;events &amp; 16 != 0 AS del</font></div><div><font size="2"   >+ &nbsp; FROM pg_catalog.pg_relation_is_updatable('rw_view3'::regclass, false) t(events);</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >+ DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"   >+&nbsp;</font></div><div><font size="2"   >&nbsp; -- inheritance tests</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; CREATE TABLE base_tbl_parent (a int);</font></div><p></p></pre></div></div>
	</div>
</div>
</body>
</html>