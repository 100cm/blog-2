<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Postgis long lat geometry distance search tuning using gist knn function</h2>
	<h5 id="">2013-08-06 23:08:42&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020137610534650/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>空间数据中对临近点的检索使用非常常见, 例如以经纬度为坐标点, 检索离这个点1公里范围内的其他点的信息.</div><div>最近有网友问到这样的问题.</div><div>本文将以Postgis为例, 举一个简单的例子, 利用gist 索引加速检索.</div><div>测试表 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create table cust_jw</font></div><div><font size="2"   >(</font></div><div><font size="2"   >&nbsp;dz varchar(300),</font></div><div><font size="2"   >&nbsp;jwd geometry</font></div><div><font size="2"   >);</font></div><p></p></pre></div><div>测试数据, 取自经纬度信息网站.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >insert into cust_jw values ('杭州', ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163));</font></div><div><font size="2"   >insert into cust_jw values ('北京', ST_Transform(ST_GeomFromText('POINT(116.46 39.92)', 4326), 2163));</font></div><div><font size="2"   >insert into cust_jw values ('南京', ST_Transform(ST_GeomFromText('POINT(118.78 32.04)', 4326), 2163));</font></div><div><font size="2"   >insert into cust_jw values ('南宁', ST_Transform(ST_GeomFromText('POINT(108.33 22.84)', 4326), 2163));</font></div><div><font size="2"   >insert into cust_jw values ('贵阳', ST_Transform(ST_GeomFromText('POINT(106.71 26.57)', 4326), 2163));</font></div><div><font size="2"   >insert into cust_jw values ('南昌', ST_Transform(ST_GeomFromText('POINT(115.89 28.68)', 4326), 2163));</font></div><div><font size="2"   >insert into cust_jw values ('余杭', ST_Transform(ST_GeomFromText('POINT(120.3 30.43)', 4326), 2163));</font></div><p></p></pre></div><div>创建gist索引 :&nbsp;</div><pre class="prettyprint"   ><p></p><div><font size="2"   >create index idx_cust_jw_1 on cust_jw using gist(jwd);</font></div><div></div><p></p></pre><div><span style="line-height: 22px;"   >这个索引方法支持包含&lt;-&gt;两个几何类型的距离排序和&amp;&amp;两个几何类型相交.</span></div><div>详见pg_amop , pg_am, pg_operator, pg_opfamily等系统表.</div><div><br></div><div>以下SQL查出北京到杭州的直线距离, 单位米 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SELECT ST_Distance(</font></div><div><font size="2"   >ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163),</font></div><div><font size="2"   >ST_Transform(ST_GeomFromText('POINT(116.46 39.92)', 4326), 2163)</font></div><div><font size="2"   >);</font></div><div><font size="2"   >&nbsp; &nbsp;st_distance &nbsp; &nbsp;</font></div><div><font size="2"   >------------------</font></div><div><font size="2"   >&nbsp;1256521.71432098</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>以下SQL 查出表中距离<span style="line-height: 22px;"   >ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163)这个点20公里的坐标.</span></div><div><span style="line-height: 22px;"   >函数使用方法参考postgis手册.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select *,ST_Distance(jwd, ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163)) from cust_jw where jwd &amp;&amp; ST_Buffer(ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163), 20000, 10);</font></div><div><font size="2"   >&nbsp; dz &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jwd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; st_distance &nbsp; &nbsp;</font></div><div><font size="2"   >------+----------------------------------------------------+------------------</font></div><div><font size="2"   >&nbsp;杭州 | 0101000020730800004C94087D5D4F54C173AA7759E8FB5D41 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;余杭 | 0101000020730800000E6E5A20494854C121FC688DA9EF5D41 | 14483.9823187612</font></div><div><font size="2"   >(2 rows)</font></div><div><font size="2"   >Time: 1.335 ms</font></div><p></p></pre></div><div>前面已经说了, 这个索引访问方法支持&amp;&amp;操作符, &lt;-&gt;操作符.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# explain select *,ST_Distance(jwd, ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163)) from cust_jw where jwd &amp;&amp; ST_Buffer(ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163), 20000, 10); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >---------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Index Scan using idx_cust_jw_1 on cust_jw &nbsp;(cost=0.14..3.41 rows=1 width=548)</font></div><div><font size="2"   >&nbsp; &nbsp;Index Cond: (jwd &amp;&amp; '01030000207308000001000000290000004C94087DD53B54C173AA7759E8FB5D411122F50B133C54C154295A2DDAF85D41D751B134CA</font></div><div><font size="2"   >3C54C1F4F2B643DFF55D41B6BBAE74F63D54C10FB6A0650AF35D41CDDC4767903F54C1D331586C6DF05D4124855AF48D4154C14B9BC9D018EE5D41AC1BE98FE24354</font></div><div><font size="2"   >C1F4F2B6431BEC5D41E89F31897F4654C1DDD11D5181EA5D41CDDC4767544954C1FE67201155E95D412D13EB504F4C54C1383864E89DE85D414C94087D5D4F54C173</font></div><div><font size="2"   >AA775960E85D416B1526A96B5254C1383864E89DE85D41CB4BC992665554C1FE67201155E95D41B088DF703B5854C1DDD11D5181EA5D41EC0C286AD85A54C1F4F2B6</font></div><div><font size="2"   >431BEC5D4174A3B6052D5D54C14B9BC9D018EE5D41CB4BC9922A5F54C1D331586C6DF05D41E26C6285C46054C10FB6A0650AF35D41C1D65FC5F06154C1F4F2B643DF</font></div><div><font size="2"   >F55D4187061CEEA76254C154295A2DDAF85D414C94087DE56254C173AA7759E8FB5D4187061CEEA76254C1922B9585F6FE5D41C1D65FC5F06154C1F261386FF1015E</font></div><div><font size="2"   >41E26C6285C46054C1D79E4E4DC6045E41CB4BC9922A5F54C11323974663075E4174A3B6052D5D54C19BB925E2B7095E41EC0C286AD85A54C1F261386FB50B5E41B0</font></div><div><font size="2"   >88DF703B5854C10983D1614F0D5E41CB4BC992665554C1E8ECCEA17B0E5E416B1526A96B5254C1AE1C8BCA320F5E414C94087D5D4F54C173AA7759700F5E412D13EB</font></div><div><font size="2"   >504F4C54C1AE1C8BCA320F5E41CDDC4767544954C1E8ECCEA17B0E5E41E89F31897F4654C10983D1614F0D5E41AC1BE98FE24354C1F261386FB50B5E4124855AF48D</font></div><div><font size="2"   >4154C19BB925E2B7095E41CDDC4767903F54C11323974663075E41B6BBAE74F63D54C1D79E4E4DC6045E41D751B134CA3C54C1F261386FF1015E411122F50B133C54</font></div><div><font size="2"   >C1922B9585F6FE5D414C94087DD53B54C173AA7759E8FB5D41'::geometry)</font></div><div><font size="2"   >(2 rows)</font></div><div><font size="2"   >Time: 1.218 ms</font></div><p></p></pre></div><div><br></div><div>以下SQL 按距离排序.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select *,ST_Distance(jwd, ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163)) from cust_jw order by jwd &lt;-&gt; ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163);</font></div><div><font size="2"   >&nbsp; dz &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jwd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; st_distance &nbsp; &nbsp;</font></div><div><font size="2"   >------+----------------------------------------------------+------------------</font></div><div><font size="2"   >&nbsp;杭州 | 0101000020730800004C94087D5D4F54C173AA7759E8FB5D41 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;余杭 | 0101000020730800000E6E5A20494854C121FC688DA9EF5D41 | 14483.9823187612</font></div><div><font size="2"   >&nbsp;南京 | 0101000020730800000FFE5AD1D62653C16F4F972A10635E41 | 321491.591341196</font></div><div><font size="2"   >&nbsp;南昌 | 010100002073080000B2744BA1FE5253C10975D1494AA25F41 | 503843.306221247</font></div><div><font size="2"   >&nbsp;北京 | 0101000020730800006EBBB0F1AB0E4FC17207C71D44525E41 | 1256521.71432098</font></div><div><font size="2"   >&nbsp;南宁 | 01010000207308000030806B3882F451C18E3F38DCBB686141 | &nbsp;1409624.7420143</font></div><div><font size="2"   >&nbsp;贵阳 | 01010000207308000082EA89026EE14FC1D6A3AD6E9E786141 | 1732521.31784296</font></div><div><font size="2"   >(7 rows)</font></div><div><font size="2"   >Time: 0.598 ms</font></div><p></p></pre></div><div><br></div><div>通过以下方法强制排序走索引 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# set enable_seqscan=off;</font></div><div><font size="2"   >SET</font></div><div><font size="2"   >Time: 0.109 ms</font></div><div><font size="2"   >digoal=# explain select *,ST_Distance(jwd, ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163)) from cust_jw order by jwd &lt;-&gt; ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Index Scan using idx_cust_jw_1 on cust_jw &nbsp;(cost=0.14..54.44 rows=140 width=548)</font></div><div><font size="2"   >&nbsp; &nbsp;Order By: (jwd &lt;-&gt; '0101000020730800004C94087D5D4F54C173AA7759E8FB5D41'::geometry)</font></div><div><font size="2"   >(2 rows)</font></div><p></p></pre></div><div><br></div><div>以下为进一步的优化, 如果点比较密集的话, 这种方法比较好.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select * from (select *,ST_Distance(jwd, ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163)) AS dist from cust_jw order by jwd &lt;-&gt; ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163) limit 1000) t where dist&lt;15000;</font></div><div><font size="2"   >&nbsp; dz &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jwd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; dist &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------+----------------------------------------------------+------------------</font></div><div><font size="2"   >&nbsp;杭州 | 0101000020730800004C94087D5D4F54C173AA7759E8FB5D41 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;余杭 | 0101000020730800000E6E5A20494854C121FC688DA9EF5D41 | 14483.9823187612</font></div><div><font size="2"   >(2 rows)</font></div><div><font size="2"   >Time: 0.634 ms</font></div><p></p></pre></div><div><br></div></div><div>进一步优化, 使用游标, 可以将数据扫描降到极限. (前提是for循环中的sql order by使用了索引)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# do language plpgsql $$</font></div><div><font size="2"   >declare</font></div><div><font size="2"   >&nbsp; v_rec record;</font></div><div><font size="2"   >&nbsp; v_limit int := 1000;</font></div><div><font size="2"   >begin</font></div><div><font size="2"   >&nbsp;&nbsp;set enable_seqscan=off; &nbsp;-- 强制索引, 因为扫描行数够就退出.</font></div><div><font size="2"   >&nbsp; for v_rec in select *,ST_Distance(jwd, ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163)) AS dist from cust_jw order by jwd &lt;-&gt; ST_Transform(ST_GeomFromText('POINT(120.19 30.26)', 4326), 2163) loop</font></div><div><font size="2"   >&nbsp; &nbsp; if v_limit &lt;=0 then&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; raise notice '已经取足数据';</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; return;</font></div><div><font size="2"   >&nbsp; &nbsp; end if;</font></div><div><font size="2"   >&nbsp; &nbsp; if v_rec.dist &gt; 20000 then&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; raise notice '满足条件的点已输出完毕';</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; return;</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; raise notice 'do someting, v_rec:%', v_rec;</font></div><div><font size="2"   >&nbsp; &nbsp; end if;</font></div><div><font size="2"   >&nbsp; &nbsp;&nbsp;<span style="line-height: 22px;"   >v_limit := v_limit -1;</span></font></div><div><font size="2"   >&nbsp; end loop;</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >$$;</font></div><div><font size="2"   >NOTICE: &nbsp;do someting, v_rec:(杭州,0101000020730800004C94087D5D4F54C173AA7759E8FB5D41,0)</font></div><div><font size="2"   >NOTICE: &nbsp;do someting, v_rec:(余杭,0101000020730800000E6E5A20494854C121FC688DA9EF5D41,14483.9823187612)</font></div><div><font size="2"   >NOTICE: &nbsp;满足条件的点已输出完毕</font></div><div><font size="2"   >DO</font></div><p></p></pre></div><div>使用这种方法最多扫描比需求结果多1行.</div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.ximizi.com/jingweidu.php"   >http://www.ximizi.com/jingweidu.php</a></div><div>2.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://postgis.net/docs/manual-2.0/ST_Distance_Sphere.html"   >http://postgis.net/docs/manual-2.0/ST_Distance_Sphere.html</a></div><div>3.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://postgis.net/docs/manual-2.0/ST_Buffer.html"   >http://postgis.net/docs/manual-2.0/ST_Buffer.html</a></div><div>4.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://postgis.net/docs/manual-2.0/ST_Transform.html"   >http://postgis.net/docs/manual-2.0/ST_Transform.html</a></div><div>5.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://postgis.net/docs/manual-2.0/ST_GeomFromText.html"   >http://postgis.net/docs/manual-2.0/ST_GeomFromText.html</a></div><div>6.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://postgis.net/docs/manual-2.0/geometry_distance_centroid.html"   >http://postgis.net/docs/manual-2.0/geometry_distance_centroid.html</a></div></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">cevincheung - 2015-01-18 1:24:57</h5>
				<div>感谢，帮了我大忙了！</div>
			</div>
	</div>
</div>
</body>
</html>