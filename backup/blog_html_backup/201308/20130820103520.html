<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">[转]hstore vs. JSON - Which to use in Postgres</h2>
	<h5 id="">2013-08-20 10:35:20&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013720103520967/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">原文 :&nbsp;<div><a rel="nofollow" href="http://www.craigkerstiens.com/2013/07/03/hstore-vs-json/"   >http://www.craigkerstiens.com/2013/07/03/hstore-vs-json/</a></div><div>如果你想从mongoDB转到PostgreSQL中来, 那么是继续使用json类型还是有别的选择呢?譬如hstore, 看看本文在结合应用思考一下.</div><div><br><p style="margin-top: 0px; margin-bottom: 1.5em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >Commonly when talking with people about Postgres there comes a question, is hstore or JSON better. Which do I use and in what cases. Well first, if you’re not familiar check out some previous material on them:</p><ul style="margin-top: 0px; margin-bottom: 1.5em; margin-left: 1.3em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; list-style-position: initial; list-style-image: initial; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   ><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;"   ><a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(117, 21, 144); -webkit-transition: color 0.3s; transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/hstore.html"   >hstore on PostgresGuide</a></li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;"   ><a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(117, 21, 144); -webkit-transition: color 0.3s; transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/hstore.html"   >hstore in Postgres docs</a></li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;"   ><a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(117, 21, 144); -webkit-transition: color 0.3s; transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;" rel="nofollow" href="http://www.craigkerstiens.com/2012/06/11/schemaless-django/"   >hstore with Django</a></li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;"   ><a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(117, 21, 144); -webkit-transition: color 0.3s; transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;" rel="nofollow" href="http://wiki.postgresql.org/wiki/What's_new_in_PostgreSQL_9.2#JSON_datatype"   >JSON datatype</a></li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;"   ><a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(117, 21, 144); -webkit-transition: color 0.3s; transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;" rel="nofollow" href="https://postgres.heroku.com/blog/past/2013/6/5/javascript_in_your_postgres/"   >JavaScript support in Postgres</a></li></ul><p style="margin-top: 0px; margin-bottom: 1.5em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >If you’re already up to date with both of them, but still wondering which to use lets dig in.</p><h3 style="margin: 0px 0px 1em; padding: 0px; border: 0px; font-family: 'Helvetica Neue', 'PT Serif', Georgia, Arial, sans-serif; font-size: 1.3em; line-height: 21.59375px; vertical-align: baseline; text-rendering: optimizelegibility; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >hstore</h3><p style="margin-top: 0px; margin-bottom: 1.5em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >hstore is a key value store directly within your database. Its been a common favorite of mine and has been for some time. hstore gives you flexibility when working with your schema, as you don’t have to define models ahead of time. Though its two big limitations are that 1. it only deals with text and 2. its not a full document store meaning you can’t nest objects.</p><p style="margin-top: 0px; margin-bottom: 1.5em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >Though major benefits of hstore include the ability to index on it, robust support for various operators, and of course the obvious of flexibility with your data. Some of the basic operators available include:</p><p style="margin-top: 0px; margin-bottom: 1.5em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >Return the value from column<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 0.8em; font-style: inherit; font-variant: inherit; line-height: 1.5em; vertical-align: baseline; display: inline-block; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em;"   >foo</code>&nbsp;for key&nbsp;<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 0.8em; font-style: inherit; font-variant: inherit; line-height: 1.5em; vertical-align: baseline; display: inline-block; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em;"   >bar</code>:</p><pre style="margin-top: 0px; margin-bottom: 2.1em; padding: 0.8em 1em; border: 1px solid rgb(231, 222, 195); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 13px; line-height: 1.45em; vertical-align: baseline; -webkit-box-shadow: rgba(0, 0, 0, 0.0588235) 0px 0px 10px; box-shadow: rgba(0, 0, 0, 0.0588235) 0px 0px 10px; background-color: rgb(253, 246, 227); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; color: rgb(88, 110, 117); overflow: auto; background-position: 0% 0%;"   ><code style="margin: 0px; padding: 0px; border: 0px; font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;"   >foo-&gt;"bar"
</code></pre><p style="margin-top: 0px; margin-bottom: 1.5em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >Does the specified column&nbsp;<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 0.8em; font-style: inherit; font-variant: inherit; line-height: 1.5em; vertical-align: baseline; display: inline-block; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em;"   >foo</code>&nbsp;contain a key&nbsp;<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 0.8em; font-style: inherit; font-variant: inherit; line-height: 1.5em; vertical-align: baseline; display: inline-block; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em;"   >bar</code>:</p><pre style="margin-top: 0px; margin-bottom: 2.1em; padding: 0.8em 1em; border: 1px solid rgb(231, 222, 195); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 13px; line-height: 1.45em; vertical-align: baseline; -webkit-box-shadow: rgba(0, 0, 0, 0.0588235) 0px 0px 10px; box-shadow: rgba(0, 0, 0, 0.0588235) 0px 0px 10px; background-color: rgb(253, 246, 227); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; color: rgb(88, 110, 117); overflow: auto; background-position: 0% 0%;"   ><code style="margin: 0px; padding: 0px; border: 0px; font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;"   >foo?"bar"
</code></pre><p style="margin-top: 0px; margin-bottom: 1.5em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >Does the specified column&nbsp;<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 0.8em; font-style: inherit; font-variant: inherit; line-height: 1.5em; vertical-align: baseline; display: inline-block; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em;"   >foo</code>&nbsp;contain a value of&nbsp;<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 0.8em; font-style: inherit; font-variant: inherit; line-height: 1.5em; vertical-align: baseline; display: inline-block; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em;"   >baz</code>&nbsp;for key&nbsp;<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 0.8em; font-style: inherit; font-variant: inherit; line-height: 1.5em; vertical-align: baseline; display: inline-block; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em;"   >bar</code>:</p><pre style="margin-top: 0px; margin-bottom: 2.1em; padding: 0.8em 1em; border: 1px solid rgb(231, 222, 195); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 13px; line-height: 1.45em; vertical-align: baseline; -webkit-box-shadow: rgba(0, 0, 0, 0.0588235) 0px 0px 10px; box-shadow: rgba(0, 0, 0, 0.0588235) 0px 0px 10px; background-color: rgb(253, 246, 227); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; color: rgb(88, 110, 117); overflow: auto; background-position: 0% 0%;"   ><code style="margin: 0px; padding: 0px; border: 0px; font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;"   >foo@&gt;"bar-&gt;baz"
</code></pre><p style="margin-top: 0px; margin-bottom: 1.5em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >Perhaps one of the best parts of hstore is that you can index on it. In particular Postgres&nbsp;<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 0.8em; font-style: inherit; font-variant: inherit; line-height: 1.5em; vertical-align: baseline; display: inline-block; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em;"   >gin</code>and&nbsp;<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace; font-size: 0.8em; font-style: inherit; font-variant: inherit; line-height: 1.5em; vertical-align: baseline; display: inline-block; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em;"   >gist</code>&nbsp;indexes allow you to index all keys and values within an hstore. A talk by&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(117, 21, 144); -webkit-transition: color 0.3s; transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;" rel="nofollow" href="http://www.twitter.com/XoF"   >Christophe Pettus</a>&nbsp;of PgExperts actually highlights some&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(117, 21, 144); -webkit-transition: color 0.3s; transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;" rel="nofollow" href="http://thebuild.com/presentations/pg-as-nosql-pgday-fosdem-2013.pdf"   >performance details of hstore with indexes</a>. To give away the big punchline in several cases hstore with gin/gist beats mongodb in performance.</p><h3 style="margin: 0px 0px 1em; padding: 0px; border: 0px; font-family: 'Helvetica Neue', 'PT Serif', Georgia, Arial, sans-serif; font-size: 1.3em; line-height: 21.59375px; vertical-align: baseline; text-rendering: optimizelegibility; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >json</h3><p style="margin-top: 0px; margin-bottom: 1.5em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >JSON in contrast to hstore is a full document datatype. In addition to nesting objects you have support for more than just text (read numbers). As you insert JSON into Postgres it will automatically ensure its valid JSON and error if its well not. JSON gets a lot better come Postgres 9.3 as well with&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(117, 21, 144); -webkit-transition: color 0.3s; transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html"   >some built in operators</a>. Though if you need more functionality in it today you should look at&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(117, 21, 144); -webkit-transition: color 0.3s; transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;" rel="nofollow" href="https://code.google.com/p/plv8js/wiki/PLV8"   >PLV8</a>.</p><h3 style="margin: 0px 0px 1em; padding: 0px; border: 0px; font-family: 'Helvetica Neue', 'PT Serif', Georgia, Arial, sans-serif; font-size: 1.3em; line-height: 21.59375px; vertical-align: baseline; text-rendering: optimizelegibility; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >Which to Use</h3><p style="margin-top: 0px; margin-bottom: 1.5em; border: 0px; font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif; line-height: 21.59375px; vertical-align: baseline; color: rgb(34, 34, 34); background-color: rgb(248, 248, 248);"   >So which do you actually want to use in your application? If you’re already using JSON and simply want to store it in your database then the JSON datatype is often the correct pick. However, if you’re just looking for flexibility with your data model then hstore is likely the path you want to take. hstore will give you much of the flexibility you want as well as a good ability to query your data in a performant manner. Of course much of this starts to change in Postgres 9.3.</p><wbr></div></div>
	</div>
</div>
</body>
</html>