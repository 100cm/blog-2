<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Londiste3 Install</h2>
	<h5 id="">2012-05-29 16:56:32&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201242945632912/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>Skytools是一个比较成熟的套件, 包含了pgq, Londiste, wal-manager三大组件.</div><div>其中pgq由providers,ticker,consumers组成, provider push events to queue, consumer read events from queue.</div><div>ticker则负责把batch queue里面的events.&nbsp;</div><div>londiste则是基于pgq的一个PostgreSQL数据库复制套件.</div><div>与流复制不同之处在于它是基于pgq的, 需要触发器支持, 复制的最小单位是表. 它不要求复制的数据库版本一致, 也不要求CPU架构一致. 因此适用范围更广. Londiste3 支持级联复制.</div><div>下面先介绍一下Londiste3的安装, 以后再逐步深入.</div><div>Build和Runtime的依赖包.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >=== Build dependencies ===</font></div><div><font size="2"   >&nbsp; postgresql libpq-dev postgresql-server-dev</font></div><div><font size="2"   >&nbsp; python python-dev</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >=== Runtime dependencies ===</font></div><div><font size="2"   >&nbsp; python &nbsp;psycopg2 &nbsp;rsync</font></div><p></p></pre></div><div><br></div><div>1. 安装Python</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >tar -jxvf Python-2.7.3.tar.bz2</font></div><div><font size="2"   >cd Python-2.7.3</font></div><div><font size="2"   >./configure --prefix=/opt/python2.7.3</font></div><div><font size="2"   >make</font></div><div><font size="2"   >make install</font></div><p></p></pre></div><div>将python lib目录加入ld.so.conf, 或者使用PYTHONPATH环境变量, 否则python在使用时会报lib缺失.</div><div>vi /etc/ld.so.conf, 添加以下行</div><div>/opt/python2.7.3/lib</div><div>执行ldconfig 刷新ld. 然后再执行ldconfig -p就能看到新安装的python的lib库了.</div><div>修改环境变量</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi ~/.bash_profile</font></div><div><font size="2"   >export MANPATH=/opt/python2.7.3/share/man:$MANPATH</font></div><div><font size="2"   >export PATH=/opt/python2.7.3/bin:$PATH</font></div><div><font size="2"   >export PYTHONPATH=/opt/python2.7.3/lib:$PYTHONPATH</font></div><p></p></pre></div><div><br></div><div>应用环境变量</div><div><pre class="prettyprint"   ><p><font size="2"   >. ~/.bash_profile</font></p></pre></div></div><div><br></div><div>查看python位置是否正确</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >which python</font></div><div><font size="2"   >/opt/python2.7.3/bin/python</font></div><p></p></pre></div><div><br></div><div>2. 安装PostgreSQL</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >tar -jxvf flex-2.5.35.tar.bz2</font></div><div><font size="2"   >cd&nbsp;flex-2.5.35</font></div><div><font size="2"   >./configure &amp;&amp; make &amp;&amp; make install</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >tar -jxvf&nbsp;postgresql-9.1.3.tar.bz2</font></div><div><font size="2"   >cd&nbsp;postgresql-9.1.3</font></div><div><font size="2"   >./configure --prefix=/opt/pgsql --with-pgport=1921 --with-perl --with-python --with-openssl --with-pam --without-ldap --with-libxml --with-libxslt --enable-thread-safety --with-wal-blocksize=16</font></div><div><font size="2"   >make world</font></div><div><font size="2"   >sudo make install-world</font></div><p></p></pre></div><div><br></div><div>3. 安装psycopg2</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >tar -zxvf psycopg2-2.4.5.tar.gz</font></div><div><font size="2"   >cd psycopg2-2.4.5</font></div><div><font size="2"   >python setup.py build_ext --pg-config /opt/pgsql/bin/pg_config build</font></div><div><font size="2"   >python setup.py build_ext --pg-config /opt/pgsql/bin/pg_config install</font></div><p></p></pre></div><div><br></div><div>4. 安装skytools</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >tar -zxvf skytools-3.0.2.tar.gz</font></div><div><font size="2"   >cd skytools-3.0.2</font></div><div><font size="2"   >./configure --prefix=/opt/skytools3.0.2 --with-pgconfig=/opt/pgsql/bin/pg_config</font></div><div><font size="2"   >make</font></div><div><font size="2"   >make install</font></div><p></p></pre></div><div><br></div><div>5. 测试londiste3</div><div><span style="line-height: 22px;"   >查看安装完后python的位置是否正确</span> </div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@digoal ~]# head -n 1 /opt/skytools3.0.2/bin/londiste3&nbsp;</font></div><div><font size="2"   >#!/opt/python2.7.3/bin/python</font></div><p></p></pre></div><div><br></div><div>在需要使用skytools的操作系统用户下, 修改相应的环境变量</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi ~/.bash_profile</font></div><div><font size="2"   >export PATH=/opt/skytools3.0.2/bin:/opt/pgsql/bin:$PATH</font></div><div><font size="2"   >export PYTHONPATH=/opt/skytools3.0.2/lib/python2.7/site-packages:$PYTHONPATH</font></div><div><font size="2"   >export LD_LIBRARY_PATH=/opt/pgsql/lib:$LD_LIBRARY_PATH</font></div><p></p></pre></div><div>应用环境变量</div><div><pre class="prettyprint"   ><p><font size="2"   >. ~/.bash_profile</font></p></pre></div></div><div>测试londiste3是否可以正常调用</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@digoal ~]# londiste3 -V</font></div><div><font size="2"   >londiste3, Skytools version 3.0.2</font></div><p></p></pre></div><div>表示正常.</div><div><br></div><div>如果报python的相关错误, 对症解决, 例如import *** 错误,可能要安装缺少的python api. 并且加入到<span style="line-height: 22px;"   >PYTHONPATH路径中.</span></div><div><span style="line-height: 22px;"   ><br></span></div><div><span style="line-height: 22px;"   >【补充】</span></div><div>1. 在第4步骤后面新增一步, 可以解决python import报错的问题.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >cd&nbsp;skytools-3.0.2</font></div><div><font size="2"   >python&nbsp;setup_pkgloader.py build</font></div><div><font size="2"   >python&nbsp;setup_pkgloader.py install</font></div><div><font size="2"   >python&nbsp;setup_skytools.py build</font></div><div><font size="2"   >python&nbsp;setup_skytools.py install</font></div><p></p></pre></div><div>2. 如果skytools是从git下载的, 还需要安装一些依赖包</div><div>yum install -y&nbsp;autoconf automake asciidoc xmlto libtool</div><div><br></div><div>【参考】</div><div><div><a target="_blank" rel="nofollow" href="http://pypi.python.org/packages/source/p/psycopg2/psycopg2-2.4.5.tar.gz"   >http://pypi.python.org/packages/source/p/psycopg2/psycopg2-2.4.5.tar.gz</a></div><div><a target="_blank" rel="nofollow" href="http://www.python.org/ftp/python/2.7.3/Python-2.7.3.tar.bz2"   >http://www.python.org/ftp/python/2.7.3/Python-2.7.3.tar.bz2</a></div></div><div><a rel="nofollow" href="http://skytools.projects.postgresql.org/skytools-3.0/"   >http://skytools.projects.postgresql.org/skytools-3.0/</a> </div><a rel="nofollow" href="http://skytools.projects.pgfoundry.org/pgq"   >http://skytools.projects.pgfoundry.org/pgq</a><div><a target="_blank" rel="nofollow" href="http://skytools.projects.pgfoundry.org/doc"   >http://skytools.projects.pgfoundry.org/doc</a></div><div><a target="_blank" rel="nofollow" href="http://skytools.projects.pgfoundry.org/api"   >http://skytools.projects.pgfoundry.org/api</a></div><a rel="nofollow" href="https://github.com/markokr/skytools"   >https://github.com/markokr/skytools</a></div>
	</div>
</div>
</body>
</html>