<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">keepalived Transition & Entering {MASTER|BACKUP|FAULT} STATE & first priority affect by track interface|script</h2>
	<h5 id="">2014-08-25 15:41:36&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201472531649584/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div style="line-height: 28px;"   >本例主要说明1个问题, 当使用脚本或接口的动态优先级调整时, 什么时候优先级会生效.</div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >路由器进入状态后, 动态优先级才会被调整, 没有进入状态前的track都不会影响优先级.</div></div><div>用两个例子来说明问题.</div><div>并且初始状态为MASTER和BACKUP, track的先后是有差别的.</div><div>如果初始状态时MASTER, 那么是先执行track(此时的脚本调用结果不影响路由器优先级), 然后Transition to MASTER STATE.&nbsp;</div><div>如果初始状态是BACKUP, 那么是先Entering to BACKUP STATE, 然后执行脚本<span style="line-height: 28px;"   >(此时的脚本调用结果会影响路由器优先级)</span><span style="line-height: 28px;"   >.</span></div><div><br></div><div>例子1 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >route A : BACKUP, priority=99, track_script+3 weight,&nbsp;!nopreempt</font></div><div><font size="2"   >route B : MASTER,&nbsp;<span style="line-height: 28px;"   >priority=100, track_script+3 weight,&nbsp;</span>!nopreempt</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >先启动A,&nbsp;</span></div><div>keepalived -f /opt/keepalived/etc/keepalived/keepalived.conf -D</div><div><span style="line-height: 28px;"   >日志 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived[25763]: Starting Keepalived v1.2.13 (08/19,2014)</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived[25764]: Starting Healthcheck child process, pid=25765</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived[25764]: Starting VRRP child process, pid=25766</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: Netlink reflector reports IP 192.168.173.203 added</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: Netlink reflector reports IP 192.168.173.156 added</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: Netlink reflector reports IP fe80::f6ce:46ff:fe86:4234 added</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: Registering Kernel netlink reflector</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_healthcheckers[25765]: Netlink reflector reports IP 192.168.173.203 added</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_healthcheckers[25765]: Netlink reflector reports IP 192.168.173.156 added</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: Registering Kernel netlink command channel</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_healthcheckers[25765]: Netlink reflector reports IP fe80::f6ce:46ff:fe86:4234 added</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: Registering gratuitous ARP shared channel</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_healthcheckers[25765]: Registering Kernel netlink reflector</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_healthcheckers[25765]: Registering Kernel netlink command channel</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_healthcheckers[25765]: Opening file '/opt/keepalived/etc/keepalived/keepalived.conf'.</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: Opening file '/opt/keepalived/etc/keepalived/keepalived.conf'.</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_healthcheckers[25765]: Configuration is using : 7942 Bytes</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: Configuration is using : 69324 Bytes</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: Using LinkWatch kernel netlink reflector...</font></div><div><font size="2"   >注意用词Entering, 是进入BACKUP状态, 而不是向BACKUP状态转变.</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: VRRP_Instance(vi_1) Entering BACKUP STATE</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: VRRP sockpool: [ifindex(2), proto(112), unicast(1), fd(10,11)]</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_healthcheckers[25765]: Using LinkWatch kernel netlink reflector...</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: VRRP_Script(nag) succeeded</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: VRRP_Script(zero) succeeded</font></div><div><font size="2"   >Aug 25 15:21:35 192_168_173_203 Keepalived_vrrp[25766]: VRRP_Script(pos) succeeded</font></div><div><font size="2"   ><span style="line-height: 21px;"   >优先级99+3=102</span></font></div><div><font size="2"   >Aug 25 15:21:39 192_168_173_203 Keepalived_vrrp[25766]: VRRP_Instance(vi_1) Transition to MASTER STATE</font></div><div><font size="2"   >Aug 25 15:21:40 192_168_173_203 Keepalived_vrrp[25766]: VRRP_Instance(vi_1) Entering MASTER STATE</font></div><div><font size="2"   >Aug 25 15:21:40 192_168_173_203 Keepalived_vrrp[25766]: VRRP_Instance(vi_1) setting protocol VIPs.</font></div><div><font size="2"   >Aug 25 15:21:40 192_168_173_203 Keepalived_vrrp[25766]: VRRP_Instance(vi_1) Sending gratuitous ARPs on eth0 for 172.16.173.100</font></div><div><font size="2"   >Aug 25 15:21:40 192_168_173_203 Keepalived_healthcheckers[25765]: Netlink reflector reports IP 172.16.173.100 added</font></div><p></p></pre></div><div>再启动B,&nbsp;</div><div>keepalived -f /opt/keepalived/etc/keepalived/keepalived.conf -D</div><div>日志 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived[8192]: Starting Keepalived v1.2.13 (08/19,2014)</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived[8193]: Starting Healthcheck child process, pid=8194</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived[8193]: Starting VRRP child process, pid=8196</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: Netlink reflector reports IP 192.168.173.204 added</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: Netlink reflector reports IP fe80::f6ce:46ff:fe85:15fc added</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: Registering Kernel netlink reflector</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_healthcheckers[8194]: Netlink reflector reports IP 192.168.173.204 added</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_healthcheckers[8194]: Netlink reflector reports IP fe80::f6ce:46ff:fe85:15fc added</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: Registering Kernel netlink command channel</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: Registering gratuitous ARP shared channel</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_healthcheckers[8194]: Registering Kernel netlink reflector</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_healthcheckers[8194]: Registering Kernel netlink command channel</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_healthcheckers[8194]: Opening file '/opt/keepalived/etc/keepalived/keepalived.conf'.</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: Opening file '/opt/keepalived/etc/keepalived/keepalived.conf'.</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_healthcheckers[8194]: Configuration is using : 7944 Bytes</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: Configuration is using : 69326 Bytes</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: Using LinkWatch kernel netlink reflector...</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: VRRP sockpool: [ifindex(2), proto(112), unicast(1), fd(10,11)]</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_healthcheckers[8194]: Using LinkWatch kernel netlink reflector...</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Script(pos) succeeded</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Script(zero) succeeded</font></div><div><font size="2"   >Aug 25 15:26:27 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Script(nag) succeeded</font></div><div><font size="2"   >注意用词Transition, 表示现在还不是master, 像master角色转换而已. 转换过程要干些什么, 参考rfc2338.</font></div><div><font size="2"   >Aug 25 15:26:28 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Instance(vi_1) Transition to MASTER STATE</font></div><div><font size="2"   >Aug 25 15:26:28 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Instance(vi_1) Received higher prio advert</font></div><div><span style="line-height: 28px;"   ><font size="2"   >第一次竞选MASTER失败, 说明现在track script虽然执行成功了, 但是没有动态变更优先级, 目前优先级还是100</font></span></div><div><font size="2"   >Aug 25 15:26:28 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Instance(vi_1) Entering BACKUP STATE</font></div><div><font size="2"   >第二次竞选成功, 说明已动态变更优先级. 目前优先级100+3=103</font></div><div><font size="2"   >Aug 25 15:26:29 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Instance(vi_1) forcing a new MASTER election</font></div><div><font size="2"   >Aug 25 15:26:29 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Instance(vi_1) forcing a new MASTER election</font></div><div><font size="2"   >Aug 25 15:26:30 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Instance(vi_1) Transition to MASTER STATE</font></div><div><font size="2"   >Aug 25 15:26:31 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Instance(vi_1) Entering MASTER STATE</font></div><div><font size="2"   >Aug 25 15:26:31 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Instance(vi_1) setting protocol VIPs.</font></div><div><font size="2"   >Aug 25 15:26:31 192_168_173_204 Keepalived_vrrp[8196]: VRRP_Instance(vi_1) Sending gratuitous ARPs on eth0 for 172.16.173.100</font></div><div><font size="2"   >Aug 25 15:26:31 192_168_173_204 Keepalived_healthcheckers[8194]: Netlink reflector reports IP 172.16.173.100 added</font></div><p></p></pre></div><div><br></div><div>例子2 :&nbsp;</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >route A : BACKUP, priority=100, track_script+3 weight,&nbsp;!nopreempt</font></div><div style="line-height: 28px;"   ><font size="2"   >route B : MASTER,&nbsp;<span style="line-height: 28px;"   >priority=99, track_script+3 weight,&nbsp;</span>!nopreempt</font></div><p></p></pre></div></div><div style="line-height: 28px;"   >先启动B,&nbsp;</div><div>keepalived -f /opt/keepalived/etc/keepalived/keepalived.conf -D</div><div style="line-height: 28px;"   >日志如下 :&nbsp;</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived[10659]: Starting Keepalived v1.2.13 (08/19,2014)</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived[10660]: Starting Healthcheck child process, pid=10661</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived[10660]: Starting VRRP child process, pid=10663</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: Netlink reflector reports IP 192.168.173.204 added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: Netlink reflector reports IP fe80::f6ce:46ff:fe85:15fc added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: Registering Kernel netlink reflector</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_healthcheckers[10661]: Netlink reflector reports IP 192.168.173.204 added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: Registering Kernel netlink command channel</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_healthcheckers[10661]: Netlink reflector reports IP fe80::f6ce:46ff:fe85:15fc added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: Registering gratuitous ARP shared channel</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_healthcheckers[10661]: Registering Kernel netlink reflector</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_healthcheckers[10661]: Registering Kernel netlink command channel</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_healthcheckers[10661]: Opening file '/opt/keepalived/etc/keepalived/keepalived.conf'.</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: Opening file '/opt/keepalived/etc/keepalived/keepalived.conf'.</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_healthcheckers[10661]: Configuration is using : 7942 Bytes</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: Configuration is using : 69324 Bytes</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: Using LinkWatch kernel netlink reflector...</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: VRRP sockpool: [ifindex(2), proto(112), unicast(1), fd(10,11)]</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_healthcheckers[10661]: Using LinkWatch kernel netlink reflector...</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: VRRP_Script(pos) succeeded</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: VRRP_Script(nag) succeeded</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:12 192_168_173_204 Keepalived_vrrp[10663]: VRRP_Script(zero) succeeded</font></div><div style="line-height: 28px;"   ><font size="2"   >现在的优先级是99</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:13 192_168_173_204 Keepalived_vrrp[10663]: VRRP_Instance(vi_1) Transition to MASTER STATE</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:14 192_168_173_204 Keepalived_vrrp[10663]: VRRP_Instance(vi_1) Entering MASTER STATE</font></div><div style="line-height: 28px;"   ><font size="2"   >现在的优先级是99+3=102</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:14 192_168_173_204 Keepalived_vrrp[10663]: VRRP_Instance(vi_1) setting protocol VIPs.</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:14 192_168_173_204 Keepalived_vrrp[10663]: VRRP_Instance(vi_1) Sending gratuitous ARPs on eth0 for 172.16.173.100</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:31:14 192_168_173_204 Keepalived_healthcheckers[10661]: Netlink reflector reports IP 172.16.173.100 added</font></div><p></p></pre></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >然后启动A,&nbsp;</div><div>keepalived -f /opt/keepalived/etc/keepalived/keepalived.conf -D</div><div style="line-height: 28px;"   >日志如下 :&nbsp;</div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived[8306]: Starting Keepalived v1.2.13 (08/19,2014)</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived[8307]: Starting Healthcheck child process, pid=8308</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived[8307]: Starting VRRP child process, pid=8309</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: Netlink reflector reports IP 192.168.173.203 added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: Netlink reflector reports IP 192.168.173.156 added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: Netlink reflector reports IP fe80::f6ce:46ff:fe86:4234 added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: Registering Kernel netlink reflector</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_healthcheckers[8308]: Netlink reflector reports IP 192.168.173.203 added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: Registering Kernel netlink command channel</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_healthcheckers[8308]: Netlink reflector reports IP 192.168.173.156 added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: Registering gratuitous ARP shared channel</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_healthcheckers[8308]: Netlink reflector reports IP fe80::f6ce:46ff:fe86:4234 added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_healthcheckers[8308]: Registering Kernel netlink reflector</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_healthcheckers[8308]: Registering Kernel netlink command channel</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_healthcheckers[8308]: Opening file '/opt/keepalived/etc/keepalived/keepalived.conf'.</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: Opening file '/opt/keepalived/etc/keepalived/keepalived.conf'.</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_healthcheckers[8308]: Configuration is using : 7944 Bytes</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: Configuration is using : 69326 Bytes</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: Using LinkWatch kernel netlink reflector...</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: VRRP_Instance(vi_1) Entering BACKUP STATE</font></div><div style="line-height: 28px;"   ><font size="2"   >注意现在的状态是进入BACKUP STATE, </font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: VRRP sockpool: [ifindex(2), proto(112), unicast(1), fd(10,11)]</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_healthcheckers[8308]: Using LinkWatch kernel netlink reflector...</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: VRRP_Script(pos) succeeded</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: VRRP_Script(nag) succeeded</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:11 192_168_173_203 Keepalived_vrrp[8309]: VRRP_Script(zero) succeeded</font></div><div style="line-height: 28px;"   ><font size="2"   >第一次竞选MASTER成功, 说明Entering后, 脚本执行完后, 动态调整了priority. 现在的优先级是100+3=103</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:12 192_168_173_203 Keepalived_vrrp[8309]: VRRP_Instance(vi_1) forcing a new MASTER election</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:12 192_168_173_203 Keepalived_vrrp[8309]: VRRP_Instance(vi_1) forcing a new MASTER election</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:13 192_168_173_203 Keepalived_vrrp[8309]: VRRP_Instance(vi_1) Transition to MASTER STATE</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:14 192_168_173_203 Keepalived_vrrp[8309]: VRRP_Instance(vi_1) Entering MASTER STATE</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:14 192_168_173_203 Keepalived_vrrp[8309]: VRRP_Instance(vi_1) setting protocol VIPs.</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:14 192_168_173_203 Keepalived_healthcheckers[8308]: Netlink reflector reports IP 172.16.173.100 added</font></div><div style="line-height: 28px;"   ><font size="2"   >Aug 25 15:32:14 192_168_173_203 Keepalived_vrrp[8309]: VRRP_Instance(vi_1) Sending gratuitous ARPs on eth0 for 172.16.173.100</font></div><p></p></pre></div></div></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >路由器进入状态后, 动态优先级才会被调整. 没有进入状态前的track都不会影响优先级.</div><div><br></div>[参考]<wbr><div>1. keepalived src</div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.ietf.org/rfc/rfc2338.txt"   >http://www.ietf.org/rfc/rfc2338.txt</a></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="keepalived Transition  Entering {MASTER|BACKUP|FAULT} STATE  first priority affect by track interface|script - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>