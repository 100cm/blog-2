<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">JBD Journaling block device</h2>
	<h5 id="">2014-08-29 6:05:03&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020147296454118/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   ><b>在看man mount, ext4章节关于barrier的讲解时有提到JBD.</b></p><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   ><b>这里摘录一下wikipedia的解释.</b></p><p style="margin-top: 0.5em; margin-bottom: 0.5em; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   ><b>JBD在Linux内核中是负责记录块设备日志的, 某些文件系统会使用JBD以及它的事务特性来确保文件系统在操作系统异常DOWN机后可恢复到一致性的状态.</b></p><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   ><b><br></b></p><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   ><b>JBD</b>, or&nbsp;<b>journaling block device</b>, is a generic block device journaling layer in the&nbsp;<a title="Linux kernel" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Linux_kernel"   >Linux kernel</a>&nbsp;written by Stephen C. Tweedie from&nbsp;<a title="Red Hat" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Red_Hat"   >Red Hat</a>.</p><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   ></p><div id="toc"   style="border: 1px solid rgb(170, 170, 170); padding: 7px; font-size: 13px; display: table; zoom: 1; color: rgb(37, 37, 37); font-family: sans-serif; background-color: rgb(249, 249, 249);"   ><div id="toctitle"   style="direction: ltr; text-align: center;"   ><h2 style="color: black; margin: 1em 0px 0.25em; overflow: hidden; padding: 0px; border: none; font-size: 13px; display: inline; line-height: 1.3; background: none;"   >Contents</h2>&nbsp;<span style="-webkit-user-select: none;"   >&nbsp;[<a id="togglelink" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#"   >hide</a>]&nbsp;</span></div><ul style="line-height: 1.6; list-style-type: none; margin-top: 0.3em; margin-bottom: 0.3em; margin-left: 0px; list-style-image: none;"   ><li style="margin-bottom: 0.1em;"   ><a style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#Overview"   ><span>1</span>&nbsp;<span>Overview</span></a></li><li style="margin-bottom: 0.1em;"   ><a style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#JBD_structures"   ><span>2</span>&nbsp;<span>JBD structures</span></a><ul style="line-height: 1.6; list-style-type: none; margin-top: 0px; margin-bottom: 0px; margin-left: 2em; list-style-image: none;"   ><li style="margin-bottom: 0.1em;"   ><a style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#Atomic_handle"   ><span>2.1</span>&nbsp;<span>Atomic handle</span></a></li><li style="margin-bottom: 0.1em;"   ><a style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#Transaction"   ><span>2.2</span>&nbsp;<span>Transaction</span></a></li></ul></li><li style="margin-bottom: 0.1em;"   ><a style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#Recovery"   ><span>3</span>&nbsp;<span>Recovery</span></a></li><li style="margin-bottom: 0.1em;"   ><a style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#Sources"   ><span>4</span>&nbsp;<span>Sources</span></a></li></ul></div><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   ></p><h2 style="font-weight: normal; margin: 1em 0px 0.25em; overflow: hidden; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: 'Linux Libertine', Georgia, Times, serif; line-height: 1.3; background-image: none; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><span id="Overview"   >Overview</span><span style="-webkit-user-select: none; font-size: small; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block; white-space: nowrap; unicode-bidi: -webkit-isolate; font-family: sans-serif;"   ><span style="margin-right: 0px; color: rgb(85, 85, 85); margin-left: 0px;"   >[</span><a title="Edit section: Overview" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Journaling_block_device&amp;action=edit&amp;section=1"   >edit</a><span style="margin-left: 0px; color: rgb(85, 85, 85); margin-right: 0px;"   >]</span></span></h2><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   >The Journaling Block Device (JBD) provides a filesystem-independent interface for filesystem journaling.&nbsp;<a title="Ext3" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Ext3"   >ext3</a>,&nbsp;<a title="Ext4" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Ext4"   >ext4</a>&nbsp;and&nbsp;<a title="OCFS2" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/OCFS2"   >OCFS2</a>&nbsp;are known to use JBD.&nbsp;<a title="OCFS2" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/OCFS2"   >OCFS2</a>starting from linux 2.6.28<sup id="cite_ref-1"   style="line-height: 1; unicode-bidi: -webkit-isolate;"   ><a style="text-decoration: none; color: rgb(11, 0, 128); white-space: nowrap; background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#cite_note-1"   >[1]</a></sup>&nbsp;and&nbsp;<a title="Ext4" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Ext4"   >ext4</a>&nbsp;use a fork of JBD called&nbsp;<i>JBD2</i>.<sup id="cite_ref-2"   style="line-height: 1; unicode-bidi: -webkit-isolate;"   ><a style="text-decoration: none; color: rgb(11, 0, 128); white-space: nowrap; background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#cite_note-2"   >[2]</a></sup></p><h2 style="font-weight: normal; margin: 1em 0px 0.25em; overflow: hidden; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: 'Linux Libertine', Georgia, Times, serif; line-height: 1.3; background-image: none; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><span id="JBD_structures"   >JBD structures</span><span style="-webkit-user-select: none; font-size: small; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block; white-space: nowrap; unicode-bidi: -webkit-isolate; font-family: sans-serif;"   ><span style="margin-right: 0px; color: rgb(85, 85, 85); margin-left: 0px;"   >[</span><a title="Edit section: JBD structures" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Journaling_block_device&amp;action=edit&amp;section=2"   >edit</a><span style="margin-left: 0px; color: rgb(85, 85, 85); margin-right: 0px;"   >]</span></span></h2><h3 style="margin: 0.3em 0px 0px; overflow: hidden; padding-top: 0.5em; padding-bottom: 0px; border-bottom-style: none; line-height: 1.6; font-family: sans-serif; background-image: none; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><span id="Atomic_handle"   >Atomic handle</span><span style="-webkit-user-select: none; font-size: small; font-weight: normal; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block; white-space: nowrap; unicode-bidi: -webkit-isolate;"   ><span style="margin-right: 0px; color: rgb(85, 85, 85); margin-left: 0px;"   >[</span><a title="Edit section: Atomic handle" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Journaling_block_device&amp;action=edit&amp;section=3"   >edit</a><span style="margin-left: 0px; color: rgb(85, 85, 85); margin-right: 0px;"   >]</span></span></h3><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   >An atomic handle as basically a collection of all the low-level changes that occur during a single high-level atomic update to the file system. The atomic handle guarantees that the high-level update either happens or not, because the actual changes to the file system are flushed only after logging the atomic handle in the journal.</p><h3 style="margin: 0.3em 0px 0px; overflow: hidden; padding-top: 0.5em; padding-bottom: 0px; border-bottom-style: none; line-height: 1.6; font-family: sans-serif; background-image: none; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><span id="Transaction"   >Transaction</span><span style="-webkit-user-select: none; font-size: small; font-weight: normal; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block; white-space: nowrap; unicode-bidi: -webkit-isolate;"   ><span style="margin-right: 0px; color: rgb(85, 85, 85); margin-left: 0px;"   >[</span><a title="Edit section: Transaction" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Journaling_block_device&amp;action=edit&amp;section=4"   >edit</a><span style="margin-left: 0px; color: rgb(85, 85, 85); margin-right: 0px;"   >]</span></span></h3><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   >For the sake of efficiency and performance, JBD groups several atomic handles into a single transaction, which is written to the journal after a fixed amount of time elapses or there is no free space left on the journal to fit it.</p><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   >The transaction has several states:</p><ul style="line-height: 22.399999618530273px; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   ><li style="margin-bottom: 0.1em;"   >Running - it means that the transaction is still live and can accept more handles</li><li style="margin-bottom: 0.1em;"   >Locked - not accepting new handles, but the existing ones are still unfinished</li><li style="margin-bottom: 0.1em;"   >Flush - the transaction is complete and is being written to the journal</li><li style="margin-bottom: 0.1em;"   >Commit - the transaction is written to the journal and now the changes are being applied to the file system</li><li style="margin-bottom: 0.1em;"   >Finished - the transaction has been fully written to the journal and the block device. It can be deleted from the journal.</li></ul><h2 style="font-weight: normal; margin: 1em 0px 0.25em; overflow: hidden; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: 'Linux Libertine', Georgia, Times, serif; line-height: 1.3; background-image: none; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><span id="Recovery"   >Recovery</span><span style="-webkit-user-select: none; font-size: small; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block; white-space: nowrap; unicode-bidi: -webkit-isolate; font-family: sans-serif;"   ><span style="margin-right: 0px; color: rgb(85, 85, 85); margin-left: 0px;"   >[</span><a title="Edit section: Recovery" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Journaling_block_device&amp;action=edit&amp;section=5"   >edit</a><span style="margin-left: 0px; color: rgb(85, 85, 85); margin-right: 0px;"   >]</span></span></h2><p style="margin-top: 0.5em; margin-bottom: 0.5em; line-height: 22.399999618530273px; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   >Based on the transaction states, the JBD is able to determine which transactions need to be replayed (or reapplied) to the file system.</p><h2 style="font-weight: normal; margin: 1em 0px 0.25em; overflow: hidden; padding: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: 'Linux Libertine', Georgia, Times, serif; line-height: 1.3; background-image: none; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><span id="Sources"   >Sources</span><span style="-webkit-user-select: none; font-size: small; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block; white-space: nowrap; unicode-bidi: -webkit-isolate; font-family: sans-serif;"   ><span style="margin-right: 0px; color: rgb(85, 85, 85); margin-left: 0px;"   >[</span><a title="Edit section: Sources" style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Journaling_block_device&amp;action=edit&amp;section=6"   >edit</a><span style="margin-left: 0px; color: rgb(85, 85, 85); margin-right: 0px;"   >]</span></span></h2><ul style="line-height: 22.399999618530273px; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em; color: rgb(37, 37, 37); font-family: sans-serif; font-size: 14px;"   ><li style="margin-bottom: 0.1em;"   ><a rel="nofollow" href="http://kerneltrap.org/node/6741"   >Linux: The Journaling Block Device</a>&nbsp;(Kedar Sovani,&nbsp;<i>KernelTrap</i>, June 20, 2006)</li><li style="margin-bottom: 0.1em;"   >Linux kernel v2.6.19.1 source</li></ul><div style="font-size: 13px; margin-bottom: 0.5em; color: rgb(37, 37, 37); font-family: sans-serif; list-style-type: decimal;"   ><ol style="line-height: 1.6; margin-top: 0.3em; margin-bottom: 0.5em; margin-left: 3.2em; list-style-image: none; list-style-type: inherit;"   ><li id="cite_note-1"   style="margin-bottom: 0.1em;"   ><span style="-webkit-user-select: none;"   ><b><a style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#cite_ref-1"   ><span style="top: -99999px; clip: rect(1px 1px 1px 1px); overflow: hidden;position:inherit; padding: 0px !important; border: 0px !important; height: 1px !important; width: 1px !important; -webkit-user-select: none;"   >Jump up</span>^</a></b></span>&nbsp;<span><a rel="nofollow" href="http://kernelnewbies.org/Linux_2_6_28#head-b683bcf44853cccbff4b09bda272169272c22ae6"   >http://kernelnewbies.org/Linux_2_6_28#head-b683bcf44853cccbff4b09bda272169272c22ae6</a></span></li><li id="cite_note-2"   style="margin-bottom: 0.1em;"   ><span style="-webkit-user-select: none;"   ><b><a style="text-decoration: none; color: rgb(11, 0, 128); background: none;" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device#cite_ref-2"   ><span style="top: -99999px; clip: rect(1px 1px 1px 1px); overflow: hidden;position:inherit; padding: 0px !important; border: 0px !important; height: 1px !important; width: 1px !important; -webkit-user-select: none;"   >Jump up</span>^</a></b></span>&nbsp;<span>Mingming Cao (9 August 2006).&nbsp;<a rel="nofollow" href="https://lkml.org/lkml/2006/8/9/434"   >"Forking ext4 filesystem and JBD2"</a>. Linux kernel mailing list.</span></li></ol></div></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/Journaling_block_device"   >http://en.wikipedia.org/wiki/Journaling_block_device</a></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="JBD Journaling block device - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>