<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">OpenvSwitch readme & faq</h2>
	<h5 id="">2014-08-01 10:57:32&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020147194247869/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>[原文]</div><div><a target="_blank" rel="nofollow" href="http://blog.csdn.net/majieyue/article/details/7888400"   >http://blog.csdn.net/majieyue/article/details/7888400</a></div><div><br></div><div>1 什么是OpenvSwitch</div><div>OpenvSwitch，简称OVS是一个虚拟交换软件，主要用于虚拟机VM环境，作为一个虚拟交换机，支持Xen/XenServer, KVM, and VirtualBox多种虚拟化技术。</div><div><br></div><div>在这种某一台机器的虚拟化的环境中，一个虚拟交换机（vswitch）主要有两个作用：传递虚拟机VM之间的流量，以及实现VM和外界网络的通信。</div><div><br></div><div>整个OVS代码用C写的。目前有以下功能：</div><div><br></div><div>Standard 802.1Q VLAN model with trunk and access ports</div><div>NIC bonding with or without LACP on upstream switch</div><div>NetFlow, sFlow(R), and mirroring for increased visibility</div><div>QoS (Quality of Service) configuration, plus policing</div><div>GRE, GRE over IPSEC, VXLAN, and LISP tunneling</div><div>802.1ag connectivity fault management</div><div>OpenFlow 1.0 plus numerous extensions</div><div>Transactional configuration database with C and Python bindings</div><div>High-performance forwarding using a Linux kernel module</div><div><br></div><div>2 OpenvSwitch的组成</div><div>ovs-vswitchd：守护程序，实现交换功能，和Linux内核兼容模块一起，实现基于流的交换flow-based switching。</div><div>ovsdb-server：轻量级的数据库服务，主要保存了整个OVS的配置信息，包括接口啊，交换内容，VLAN啊等等。ovs-vswitchd会根据数据库中的配置信息工作。</div><div>ovs-dpctl：一个工具，用来配置交换机内核模块，可以控制转发规则。</div><div>ovs-vsctl：主要是获取或者更改ovs-vswitchd的配置信息，此工具操作的时候会更新ovsdb-server中的数据库。</div><div>ovs-appctl：主要是向OVS守护进程发送命令的，一般用不上。</div><div>ovsdbmonitor：GUI工具来显示ovsdb-server中数据信息。</div><div>ovs-controller：一个简单的OpenFlow控制器</div><div>ovs-ofctl：用来控制OVS作为OpenFlow交换机工作时候的流表内容。</div><div><br></div><div>3 OpenvSwitch和其他vswitch</div><div>这里其他的vswitch,包括VMware vNetwork distributed switch以及思科的Cisco Nexus 1000V。</div><div><br></div><div>VMware vNetwork distributed switch以及思科的Cisco Nexus 1000V这种虚拟交换机提供的是一个集中式的控制方式，。而OVS则是一个独立的vswitch，他运行在每个实现虚拟化的物理机器上，并提供远程管理。OVS提供了两种在虚拟化环境中远程管理的协议：一个是OpenFlow,通过流表来管理交换机的行为，一个是OVSDB management protocol，用来暴露sietch的port状态。</div><div><br></div><div><br></div><div>(二)-概念及工作流程1</div><div><br></div><div>1 vswitch、Bridge、Datapath</div><div>&nbsp;</div><div><br></div><div>在网络中，交换机和桥都是同一个概念，OVS实现了一个虚拟机的以太交换机，换句话说，OVS也就是实现了一个以太桥。那么，在OVS中，给一个交换机，或者说一个桥，用了一个专业的名词，叫做DataPath！</div><div><br></div><div>要了解，OVS如何工作，首先需要知道桥的概念。</div><div><br></div><div>网桥也叫做桥接器，连接两个局域网的设备，网桥工作在数据链路层，将两个LAN连接，根据MAC地址来转发帧，可以看成一个“低层的路由器”（路由器工作在网络层，根据IP地质进行转发）。</div><div><br></div><div>1.1 网桥的工作原理</div><div><br></div><div>网桥处理包遵循以下几条规则：</div><div><br></div><div>在一个接口上接收到的包不会再往那个接口上发送此包。</div><div>每个接收到的包都要学习其源MAC地址。</div><div>如果数据包是多播或者广播包（通过2层MAC地址确定）则要向接收端口以外的所有端口转发，如果上层协议感兴趣，则还会递交上层处理。</div><div>如果数据包的地址不能再CAM表中找到，则向接收端口以外的其他端口转发。</div><div>如果CAM表中能找到，则转发给相应端口，如果发送和接收都是统一端口，则不发送。</div><div>注意，网桥是以混杂模式工作的。关于网桥更多，请查阅相关资料。</div><div><br></div><div>2 OVS中的bridge</div><div>上面，说到，一个桥就是一个交换机。在OVS中，</div><div><br></div><div>ovs-vsctl add-br brname(br-int)</div><div><br></div><div>root@Compute2:~# ifconfig</div><div>&nbsp; &nbsp; &nbsp; br-int &nbsp; &nbsp;Link encap:EthernetHWaddr1a:09:56:ea:0b:49 &nbsp;</div><div>&nbsp; &nbsp; &nbsp; inet6 addr: fe80::1809:56ff:feea:b49/64Scope:Link</div><div>&nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500Metric:1</div><div>&nbsp; &nbsp; &nbsp; RX packets:1584 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; TX packets:6 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</div><div>&nbsp; &nbsp; &nbsp; RX bytes:316502(316.5 KB) &nbsp;TX bytes:468(468.0 B)</div><div>当我们创建了一个交换机（网桥）以后，此时网络功能不受影响，但是会产生一个虚拟网卡，名字就是brname，之所以会产生一个虚拟网卡，是为了实现接下来的网桥（交换机）功能。有了这个交换机以后，我还需要为这个交换机增加端口(port)，一个端口，就是一个物理网卡，当网卡加入到这个交换机之后，其工作方式就和普通交换机的一个端口的工作方式类似了。</div><div><br></div><div>ovs-vsctl add-port brname port</div><div>这里要特别注意，网卡加入网桥以后，要按照网桥的工作标准工作，那么加入的一个端口就必须是以混杂模式工作，工作在链路层，处理2层的帧，所以这个port就不需要配置IP了。（你没见过哪个交换的端口有IP的吧）</div><div>注意这个port是实际存在的port, 也就是ifconfig -a或ip link能看到的端口 , 例如 :&nbsp;</div><div><div>[root@db-172-16-3-150 ~]# ifconfig -a</div><div>bond0 &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:00:00:00:00:00 &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MASTER MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</div><div><br></div><div>bond1 &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:00:00:00:00:00 &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MASTER MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</div><div><br></div><div>bond2 &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:00:00:00:00:00 &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MASTER MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</div><div><br></div><div>bond3 &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:00:00:00:00:00 &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MASTER MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</div><div><br></div><div>bond4 &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:00:00:00:00:00 &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MASTER MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</div><div><br></div><div>br0 &nbsp; &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:22:19:60:77:8F &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:172.16.3.150 &nbsp;Bcast:172.16.3.255 &nbsp;Mask:255.255.255.0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::222:19ff:fe60:778f/64 Scope:Link</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:45547 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:31036 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:7848640 (7.4 MiB) &nbsp;TX bytes:3286303 (3.1 MiB)</div><div><br></div><div>em1 &nbsp; &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:22:19:60:77:8F &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::222:19ff:fe60:778f/64 Scope:Link</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:28583 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:20748 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:5273472 (5.0 MiB) &nbsp;TX bytes:2133925 (2.0 MiB)</div><div><br></div><div>em2 &nbsp; &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:22:19:60:77:91 &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</div><div><br></div><div>em3 &nbsp; &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:22:19:60:77:93 &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</div><div><br></div><div>em4 &nbsp; &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:22:19:60:77:95 &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</div><div><br></div><div>lo &nbsp; &nbsp; &nbsp; &nbsp;Link encap:Local Loopback &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1 &nbsp;Mask:255.0.0.0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: ::1/128 Scope:Host</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING &nbsp;MTU:16436 &nbsp;Metric:1</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:14685 errors:0 dropped:0 overruns:0 frame:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:14685 errors:0 dropped:0 overruns:0 carrier:0</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:3881472 (3.7 MiB) &nbsp;TX bytes:3881472 (3.7 MiB)</div><div><br></div><div>[root@db-172-16-3-150 ~]# ip link</div><div>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN&nbsp;</div><div>&nbsp; &nbsp; link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</div><div>2: em1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</div><div>&nbsp; &nbsp; link/ether 00:22:19:60:77:8f brd ff:ff:ff:ff:ff:ff</div><div>3: em2: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN qlen 1000</div><div>&nbsp; &nbsp; link/ether 00:22:19:60:77:91 brd ff:ff:ff:ff:ff:ff</div><div>4: em3: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN qlen 1000</div><div>&nbsp; &nbsp; link/ether 00:22:19:60:77:93 brd ff:ff:ff:ff:ff:ff</div><div>5: em4: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN qlen 1000</div><div>&nbsp; &nbsp; link/ether 00:22:19:60:77:95 brd ff:ff:ff:ff:ff:ff</div><div>9: bond0: &lt;BROADCAST,MULTICAST,MASTER&gt; mtu 1500 qdisc noop state DOWN&nbsp;</div><div>&nbsp; &nbsp; link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff</div><div>10: bond4: &lt;BROADCAST,MULTICAST,MASTER&gt; mtu 1500 qdisc noop state DOWN&nbsp;</div><div>&nbsp; &nbsp; link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff</div><div>11: bond1: &lt;BROADCAST,MULTICAST,MASTER&gt; mtu 1500 qdisc noop state DOWN&nbsp;</div><div>&nbsp; &nbsp; link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff</div><div>12: bond2: &lt;BROADCAST,MULTICAST,MASTER&gt; mtu 1500 qdisc noop state DOWN&nbsp;</div><div>&nbsp; &nbsp; link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff</div><div>13: bond3: &lt;BROADCAST,MULTICAST,MASTER&gt; mtu 1500 qdisc noop state DOWN&nbsp;</div><div>&nbsp; &nbsp; link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff</div><div>15: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN&nbsp;</div><div>&nbsp; &nbsp; link/ether 00:22:19:60:77:8f brd ff:ff:ff:ff:ff:ff</div></div><div>以上是实际存在的, 当使用KVM虚拟机时, 指定bridge后, 会自动帮你创建虚拟口, 这些虚拟口也可以被ovs控制, 例如打TAG. 建立VLAN.&nbsp;</div><div><br></div><div>那么接下来你可能会问，通常的交换机不都是有一个管理接口，可以telnet到交换机上进行配置吧，那么在OVS中创建的虚拟交换机有木有这种呢，有的！上面既然创建交换机brname的时候产生了一个虚拟网口brname,那么，你给这个虚拟网卡配置了IP以后，就相当于给交换机的管理接口配置了IP，此时一个正常的虚拟交换机就搞定了。</div><div><br></div><div>ip address add 192.168.1.1/24 dev brname</div><div>最后，我们来看看一个br的具体信息：</div><div><br></div><div><div>[root@db-172-16-3-150 ~]# ovs-vsctl show</div><div>d267062e-d7ed-45e1-9de7-71d058127c1b</div><div>&nbsp; &nbsp; Bridge "br0"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Port "em1"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interface "em1"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Port "br0"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interface "br0"</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; type: internal</div><div>&nbsp; &nbsp; ovs_version: "1.9.3"</div></div><div><br></div><div>首先，这里显示了一个名为br0的桥（交换机），这个交换机有两个接口,一个是em1，一个是br0 (type: internal)，上面说到，创建桥的时候会创建一个和桥名字一样的接口，并自动作为该桥的一个端口，那么这个虚拟接口的作用，一方面是可以作为交换机的管理端口，另一方面也是基于这个虚拟接口，实现了桥的功能。</div><div><br></div><div>OpenvSwitch完全使用手册(二)-概念及工作流程2</div><div><br></div><div>这一部分我以一个简单的例子，说明在虚拟化环境中OpenvSwitch的典型工作流程。</div><div><br></div><div>前面已经说到，OVS主要是用来在虚拟化环境中。虚拟机之间一个虚拟机和外网之间的通信所用，如下是一个典型的结构图：</div><div><br></div><div>那么，通常情况下的工作流程如下：</div><div><div><img title="OpenvSwitch readme  faq - 德哥@Digoal - PostgreSQL research"   alt="OpenvSwitch readme  faq - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/jc2N_6Ifr0nY9uUjOYijfA==/6599292979169088374.png"   ></div>(instance指虚拟机.)</div><div>1 VM实例instance产生一个数据包并发送至实例内的虚拟网络接口VNIC，图中就是instance中的eth0.</div><div>2 这个数据包会传送到物理节点上的VNIC接口，如图就是vnet1接口。</div><div>3 数据包从vnet NIC出来，到达桥（虚拟交换机）br100上.</div><div>4 数据包经过交换机的处理，从物理节点上的物理接口发出，如图中物理节点上的eth0.</div><div>5 数据包从eth0出去的时候，是按照物理节点上的路由以及默认网关操作的，这个时候该数据包其实已经不受你的控制了。</div></div><div>一般L2 switch连接eth0的这个口是一个trunk口, 因为虚拟机对应的VNET往往会设置VLAN TAG, 可以通过对虚拟机对应的vnet打VALN TAG来控制虚拟机的网络广播域. 如果跑多个虚拟机的话, 多个虚拟机对应的vnet可以设置不同的vlan tag, 那么这些虚拟机的包从eth0(4)出去的时候, 会带上TAG标记. 这样也就必须是trunk口才行.</div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=FAQ;hb=HEAD"   >http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=FAQ;hb=HEAD</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=README;hb=HEAD"   >http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=README;hb=HEAD</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://openvswitch.org/support/config-cookbooks/vlan-configuration-cookbook/"   >http://openvswitch.org/support/config-cookbooks/vlan-configuration-cookbook/</a></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="OpenvSwitch readme  faq - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>