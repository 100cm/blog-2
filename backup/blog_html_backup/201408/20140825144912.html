<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">About PostgreSQL's --enable-debug & --enable-dtrace</h2>
	<h5 id="">2014-08-25 14:49:12&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201472524527391/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>enable-dtrace开启后, 允许用户使用systemtap 跟踪PostgreSQL内置的探针, 参考</div><div><a target="_blank" rel="nofollow" href="http://blog.163.com/digoal@126/blog/#m=0&amp;t=1&amp;c=fks_084068084086080075085082085095085080082075083081086071084"   >http://blog.163.com/digoal@126/blog/#m=0&amp;t=1&amp;c=fks_084068084086080075085082085095085080082075083081086071084</a></div><div><a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/dynamic-trace.html"   >http://www.postgresql.org/docs/9.3/static/dynamic-trace.html</a></div><div>而开启enable-debug的话, 允许跟踪PostgreSQL内的所有C函数.&nbsp;</div><div>在编译时指定enable-debug相当于设置CFLAGS 的-g开关. 同时关闭-O开关.</div><div>其他软件要开启debug, 允许systemtap进行跟踪的话, 与此类似.</div><div><br></div><div>gcc -g开关含义如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp;Options for Debugging Your Program or GCC</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;GCC has various special options that are used for debugging either your program or GCC:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-g &nbsp;Produce debugging information in the operating system’s native format (stabs, COFF, XCOFF, or DWARF 2).</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;GDB can work with this debugging information.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;On most systems that use stabs format, -g enables use of extra debugging information that only GDB can use;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;this extra information makes debugging work better in GDB but will probably make other debuggers crash or</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;refuse to read the program. &nbsp;If you want to control for certain whether to generate the extra information,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;use -gstabs+, -gstabs, -gxcoff+, -gxcoff, or -gvms (see below).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;GCC allows you to use -g with -O. &nbsp;The shortcuts taken by optimized code may occasionally produce</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;surprising results: some variables you declared may not exist at all; flow of control may briefly move</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;where you did not expect it; some statements may not be executed because they compute constant results or</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;their values were already at hand; some statements may execute in different places because they were moved</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;out of loops. &nbsp;// gcc文档告诉我们-g不要和-O一同使用</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Nevertheless it proves possible to debug optimized output. &nbsp;This makes it reasonable to use the optimizer</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for programs that might have bugs.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The following options are useful when GCC is generated with the capability for more than one debugging</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;format.</font></div><p></p></pre></div><div><br></div><div>[参考]</div><div>1. man gcc</div><div>2.&nbsp;src/template/linux</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; if test "$enable_debug" != yes; then</font></div><div><font size="2"   >&nbsp; &nbsp; CFLAGS="$CFLAGS -O" &nbsp; &nbsp; &nbsp; &nbsp; # any optimization breaks debug</font></div><div><font size="2"   >&nbsp; fi</font></div><p></p></pre></div><div>3. configure</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&nbsp; # if the user selected debug mode, don't use -O</font></div><div><font size="2"   >&nbsp; if test "$enable_debug" != yes; then</font></div><div><font size="2"   >&nbsp; &nbsp; CFLAGS="-O"</font></div><div><font size="2"   >&nbsp; fi</font></div></div><div><font size="2"   >...</font></div><div><div><font size="2"   >if test "$enable_debug" = yes &amp;&amp; test "$ac_cv_prog_cc_g" = yes; then</font></div><div><font size="2"   >&nbsp; CFLAGS="$CFLAGS -g"</font></div><div><font size="2"   >fi</font></div></div><p></p></pre></div><div>4. configure</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># Check whether --enable-dtrace was given.</font></div><div><font size="2"   >if test "${enable_dtrace+set}" = set; then</font></div><div><font size="2"   >&nbsp; enableval=$enable_dtrace;</font></div><div><font size="2"   >&nbsp; case $enableval in</font></div><div><font size="2"   >&nbsp; &nbsp; yes)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; for ac_prog in dtrace</font></div><div><font size="2"   >do</font></div><div><font size="2"   >&nbsp; # Extract the first word of "$ac_prog", so it can be a program name with args.</font></div><div><font size="2"   >set dummy $ac_prog; ac_word=$2</font></div><div><font size="2"   >{ $as_echo "$as_me:$LINENO: checking for $ac_word" &gt;&amp;5</font></div><div><font size="2"   >$as_echo_n "checking for $ac_word... " &gt;&amp;6; }</font></div><div><font size="2"   >if test "${ac_cv_prog_DTRACE+set}" = set; then</font></div><div><font size="2"   >&nbsp; $as_echo_n "(cached) " &gt;&amp;6</font></div><div><font size="2"   >else</font></div><div><font size="2"   >&nbsp; if test -n "$DTRACE"; then</font></div><div><font size="2"   >&nbsp; ac_cv_prog_DTRACE="$DTRACE" # Let the user override the test.</font></div><div><font size="2"   >else</font></div><div><font size="2"   >as_save_IFS=$IFS; IFS=$PATH_SEPARATOR</font></div><div><font size="2"   >for as_dir in $PATH</font></div><div><font size="2"   >do</font></div><div><font size="2"   >&nbsp; IFS=$as_save_IFS</font></div><div><font size="2"   >&nbsp; test -z "$as_dir" &amp;&amp; as_dir=.</font></div><div><font size="2"   >&nbsp; for ac_exec_ext in '' $ac_executable_extensions; do</font></div><div><font size="2"   >&nbsp; if { test -f "$as_dir/$ac_word$ac_exec_ext" &amp;&amp; $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then</font></div><div><font size="2"   >&nbsp; &nbsp; ac_cv_prog_DTRACE="$ac_prog"</font></div><div><font size="2"   >&nbsp; &nbsp; $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" &gt;&amp;5</font></div><div><font size="2"   >&nbsp; &nbsp; break 2</font></div><div><font size="2"   >&nbsp; fi</font></div><div><font size="2"   >done</font></div><div><font size="2"   >done</font></div><div><font size="2"   >IFS=$as_save_IFS</font></div><p></p></pre></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="About PostgreSQLs --enable-debug  --enable-dtrace - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>