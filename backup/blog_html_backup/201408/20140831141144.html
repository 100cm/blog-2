<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL xlog flush & O_DIRECT flag</h2>
	<h5 id="">2014-08-31 14:11:44&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201473114132543/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>PostgreSQL支持几种xlog的flush到磁盘的方法.</div><div>如配置文件 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >#wal_sync_method = fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# the default is the first option</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # &nbsp; supported by the operating system:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # &nbsp; open_datasync</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # &nbsp; fdatasync (default on Linux)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # &nbsp; fsync</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # &nbsp; fsync_writethrough</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # &nbsp; open_sync</font></div><p></p></pre></div><div><br></div><div>其中open_sync和open_datasync是使用O_DIRECT flag的, 会绕过系统缓存, 直接写到块设备(但是不能绕过块设备本身的缓存或RAID卡的缓存, 这里需要注意).</div><div>怎么验证是否使用了directIO呢? 可以使用lsof来验证, 注意FILE-FLAG列, 包含DIR则属于directIO.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># lsof +f gG | grep pgdata</font></div><div><span style="line-height: 28px;"   ><font size="2"   >COMMAND &nbsp; &nbsp; PID &nbsp; &nbsp; &nbsp;USER &nbsp; FD &nbsp; &nbsp; &nbsp;TYPE &nbsp; &nbsp; &nbsp; &nbsp; FILE-FLAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DEVICE SIZE/OFF &nbsp; &nbsp; &nbsp; NODE NAME</font></span></div><div><font size="2"   >postgres &nbsp;21400 &nbsp;postgres &nbsp; &nbsp;6u &nbsp; &nbsp; &nbsp;REG &nbsp; &nbsp; RW,SYN,DIR,LG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8,33 16777216 &nbsp; &nbsp;4980777 /data02/pgdata/pg_root/pg_xlog/0000000100000004000000D4</font></div><p></p></pre></div><div>例如postgresql 打开这个XLOG文件时, 包含4个flag:&nbsp;</div><div><span style="line-height: 28px;"   >RW,SYN,DIR,LG</span></div><div>通过man &nbsp;lsof查看 这几个flag的含义如下 :&nbsp;</div><div># man lsof</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;FILE-FLAG &nbsp;when &nbsp;g &nbsp;or &nbsp;G has been specified to +f, this field contains the contents of the f_flag[s] member of</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the kernel file structure and the kernel’s per-process open file flags (if &nbsp;available); &nbsp;‘G’ &nbsp;causes</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; them &nbsp;to &nbsp;be &nbsp;displayed &nbsp;in &nbsp;hexadecimal; &nbsp;‘g’, as short-hand names; two lists may be displayed with</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; entries separated by commas, the lists separated by a semicolon (‘;’); the first &nbsp;list &nbsp;may &nbsp;contain</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; short-hand names for f_flag[s] values from the following table:</font></div></div><div><font size="2"   >.....</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DIR &nbsp; &nbsp; &nbsp; direct</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SYN &nbsp; &nbsp; &nbsp; file integrity while writing</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RW &nbsp; &nbsp; &nbsp; &nbsp;read and write access</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LG &nbsp; &nbsp; &nbsp; &nbsp;large file</font></div><div><font size="2"   >.......</font></div><p></p></pre></div><div><br></div><div><br></div><div>参数配置对应的fsync方法如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* GUC support</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >const struct config_enum_entry sync_method_options[] = {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {"fsync", SYNC_METHOD_FSYNC, false},</font></div><div><font size="2"   >#ifdef HAVE_FSYNC_WRITETHROUGH</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {"fsync_writethrough", SYNC_METHOD_FSYNC_WRITETHROUGH, false},</font></div><div><font size="2"   >#endif</font></div><div><font size="2"   >#ifdef HAVE_FDATASYNC</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {"fdatasync", SYNC_METHOD_FDATASYNC, false},</font></div><div><font size="2"   >#endif</font></div><div><font size="2"   >#ifdef OPEN_SYNC_FLAG</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {"open_sync", SYNC_METHOD_OPEN, false},</font></div><div><font size="2"   >#endif</font></div><div><font size="2"   >#ifdef OPEN_DATASYNC_FLAG</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {"open_datasync", SYNC_METHOD_OPEN_DSYNC, false},</font></div><div><font size="2"   >#endif</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {NULL, 0, false}</font></div><div><font size="2"   >};</font></div><p></p></pre></div></div><div><br></div><div>通过<span style="line-height: 28px;"   >issue_xlog_fsync</span><span style="line-height: 28px;"   >这个函数来完成指定XLOG文件打开的文件描述符的flush. &nbsp;不同的方法对应调用不同的flush函数.</span></div><div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >/*</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* Issue appropriate kind of fsync (if any) for an XLOG output file.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;*</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* 'fd' is a file descriptor for the XLOG file to be fsync'd.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* 'log' and 'seg' are for error reporting purposes.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;*/</font></div><div style="line-height: 28px;"   ><font size="2"   >void</font></div><div style="line-height: 28px;"   ><font size="2"   >issue_xlog_fsync(int fd, XLogSegNo segno)</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; switch (sync_method)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case SYNC_METHOD_FSYNC:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (pg_fsync_no_writethrough(fd) != 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(PANIC,</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode_for_file_access(),</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errmsg("could not fsync log file %s: %m",</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XLogFileNameP(ThisTimeLineID, segno))));</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</font></div><div style="line-height: 28px;"   ><font size="2"   >#ifdef HAVE_FSYNC_WRITETHROUGH</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case SYNC_METHOD_FSYNC_WRITETHROUGH:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (pg_fsync_writethrough(fd) != 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(PANIC,</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode_for_file_access(),</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errmsg("could not fsync write-through log file %s: %m",</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;XLogFileNameP(ThisTimeLineID, segno))));</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >#ifdef HAVE_FDATASYNC</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case SYNC_METHOD_FDATASYNC:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (pg_fdatasync(fd) != 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(PANIC,</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode_for_file_access(),</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errmsg("could not fdatasync log file %s: %m",</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XLogFileNameP(ThisTimeLineID, segno))));</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case SYNC_METHOD_OPEN: &nbsp; &nbsp;// 注意这两个flush方法, 不需要调用flush函数, 因为使用了O_DIRECT, 不会写缓存, 所以也不需要FLUSH操作.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case SYNC_METHOD_OPEN_DSYNC:</font></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* write synced it already */</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(PANIC, "unrecognized wal_sync_method: %d", sync_method);</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div style="line-height: 28px;"   ><font size="2"   >}</font></div></div><p></p></pre></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >这些flush函数的定义如下 :&nbsp;</div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >/*</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* pg_fsync --- do fsync with or without writethrough</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;*/</font></div><div style="line-height: 28px;"   ><font size="2"   >int</font></div><div style="line-height: 28px;"   ><font size="2"   >pg_fsync(int fd)</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* #if is to skip the sync_method test if there's no need for it */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined(HAVE_FSYNC_WRITETHROUGH) &amp;&amp; !defined(FSYNC_WRITETHROUGH_IS_FSYNC)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (sync_method == SYNC_METHOD_FSYNC_WRITETHROUGH)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return pg_fsync_writethrough(fd);</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return pg_fsync_no_writethrough(fd);</font></div><div style="line-height: 28px;"   ><font size="2"   >}</font></div><div style="line-height: 28px;"   ><font size="2"   ><br></font></div><div style="line-height: 28px;"   ><font size="2"   >/*</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* pg_fsync_no_writethrough --- same as fsync except does nothing if</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;enableFsync is off</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;*/</font></div><div style="line-height: 28px;"   ><font size="2"   >int</font></div><div style="line-height: 28px;"   ><font size="2"   >pg_fsync_no_writethrough(int fd)</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (enableFsync)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return fsync(fd);</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0;</font></div><div style="line-height: 28px;"   ><font size="2"   >}</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/*</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* pg_fsync_writethrough</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;*/</font></div><div style="line-height: 28px;"   ><font size="2"   >int</font></div><div style="line-height: 28px;"   ><font size="2"   >pg_fsync_writethrough(int fd)</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (enableFsync)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div style="line-height: 28px;"   ><font size="2"   >#ifdef WIN32</font></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return _commit(fd);</font></div><div style="line-height: 28px;"   ><font size="2"   >#elif defined(F_FULLFSYNC)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return (fcntl(fd, F_FULLFSYNC, 0) == -1) ? -1 : 0;</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errno = ENOSYS;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -1;</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0;</font></div><div style="line-height: 28px;"   ><font size="2"   >}</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/*</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* pg_fdatasync --- same as fdatasync except does nothing if enableFsync is off</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;*</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* Not all platforms have fdatasync; treat as fsync if not available.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;*/</font></div><div style="line-height: 28px;"   ><font size="2"   >int</font></div><div style="line-height: 28px;"   ><font size="2"   >pg_fdatasync(int fd)</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (enableFsync)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div style="line-height: 28px;"   ><font size="2"   >#ifdef HAVE_FDATASYNC</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return fdatasync(fd);</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return fsync(fd);</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0;</font></div><div style="line-height: 28px;"   ><font size="2"   >}</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/*</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* pg_flush_data --- advise OS that the data described won't be needed soon</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;*</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* Not all platforms have sync_file_range or posix_fadvise; treat as no-op</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* if not available. &nbsp;Also, treat as no-op if enableFsync is off; this is</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* because the call isn't free, and some platforms such as Linux will actually</font></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >&nbsp;* block the requestor until the write is scheduled.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;*/</font></div><div style="line-height: 28px;"   ><font size="2"   >int</font></div><div style="line-height: 28px;"   ><font size="2"   >pg_flush_data(int fd, off_t offset, off_t amount)</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (enableFsync)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined(HAVE_SYNC_FILE_RANGE)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return sync_file_range(fd, offset, amount, SYNC_FILE_RANGE_WRITE);</font></div><div style="line-height: 28px;"   ><font size="2"   >#elif defined(USE_POSIX_FADVISE) &amp;&amp; defined(POSIX_FADV_DONTNEED)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return posix_fadvise(fd, offset, amount, POSIX_FADV_DONTNEED);</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return 0;</font></div><div style="line-height: 28px;"   ><font size="2"   >}</font></div></div><p></p></pre></div></div></div></div></div><div><br></div><div><br></div><div>通过以下<span style="line-height: 28px;"   >BasicOpenFile</span><span style="line-height: 28px;"   >&nbsp;</span><span style="line-height: 28px;"   >函数来打开一个XLOG文件, 其实这个函数就是open函数的一个封装,&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* BasicOpenFile --- same as open(2) except can free other FDs if needed</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* This is exported for use by places that really want a plain kernel FD,</font></div><div><font size="2"   >&nbsp;* but need to be proof against running out of FDs. &nbsp;Once an FD has been</font></div><div><font size="2"   >&nbsp;* successfully returned, it is the caller's responsibility to ensure that</font></div><div><font size="2"   >&nbsp;* it will not be leaked on ereport()! &nbsp;Most users should *not* call this</font></div><div><font size="2"   >&nbsp;* routine directly, but instead use the VFD abstraction level, which</font></div><div><font size="2"   >&nbsp;* provides protection against descriptor leaks as well as management of</font></div><div><font size="2"   >&nbsp;* files that need to be open for more than a short period of time.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Ideally this should be the *only* direct call of open() in the backend.</font></div><div><font size="2"   >&nbsp;* In practice, the postmaster calls open() directly, and there are some</font></div><div><font size="2"   >&nbsp;* direct open() calls done early in backend startup. &nbsp;Those are OK since</font></div><div><font size="2"   >&nbsp;* this module wouldn't have any open files to close at that point anyway.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >int</font></div><div><font size="2"   >BasicOpenFile(FileName fileName, int fileFlags, int fileMode)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fd;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >tryAgain:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fd = open(fileName, fileFlags, fileMode);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (fd &gt;= 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return fd; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* success! */</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (errno == EMFILE || errno == ENFILE)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; save_errno = errno;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(LOG,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode(ERRCODE_INSUFFICIENT_RESOURCES),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errmsg("out of file descriptors: %m; release and retry")));</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errno = 0;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (ReleaseLruFile())</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto tryAgain;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errno = save_errno;</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return -1; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* failure */</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div><div><br></div><div>在打开XLOG文件时, 使用get_sync_bit来获得打开文件的FLAG, 例如是否需要O_DIRECT. 只有open_datasync和open_sync需要O_DIRECT,&nbsp;</div><div>同时需要注意, 当配置了归档以及流复制时, 因为接收到XLOG后需要立即读出来APPLY, 所以为了提高效率, 这种情况不会开启O_DIRECT. 因为O_DIRECT写到硬盘了, 在缓存中没有, 影响接下来的读的效率.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* Is WAL-logging necessary for archival or log-shipping, or can we skip</font></div><div><font size="2"   >&nbsp;* WAL-logging if we fsync() the data before committing instead?</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >#define XLogIsNeeded() (wal_level &gt;= WAL_LEVEL_ARCHIVE)</font></div><p></p></pre></div><div><pre class="prettyprint"   ><p><font size="2"   >include/miscadmin.h:#define AmWalReceiverProcess() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(MyAuxProcType == WalReceiverProcess)</font></p></pre></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* Return the (possible) sync flag used for opening a file, depending on the</font></div><div><font size="2"   >&nbsp;* value of the GUC wal_sync_method.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >static int</font></div><div><font size="2"   >get_sync_bit(int method)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; o_direct_flag = 0;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* If fsync is disabled, never open in sync mode */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (!enableFsync)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* Optimize writes by bypassing kernel cache with O_DIRECT when using</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* O_SYNC/O_FSYNC and O_DSYNC. &nbsp;But only if archiving and streaming are</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* disabled, otherwise the archive command or walsender process will read</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* the WAL soon after writing it, which is guaranteed to cause a physical</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* read if we bypassed the kernel cache. We also skip the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* posix_fadvise(POSIX_FADV_DONTNEED) call in XLogFileClose() for the same</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* reason.  // 代码中并没有看到sender进程可以设置o_direct_flag=0的情况. 难道是解释有问题? </font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* Never use O_DIRECT in walreceiver process for similar reasons; the WAL</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* written by walreceiver is normally read by the startup process soon</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* after its written. Also, walreceiver performs unaligned writes, which</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* don't work with O_DIRECT, so it is required for correctness too.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (!XLogIsNeeded() &amp;&amp; !AmWalReceiverProcess())  // 判断是否开启归档, 并且是否是receiver进程.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; o_direct_flag = PG_O_DIRECT;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; switch (method)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* enum values for all sync options are defined even if they are</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* not supported on the current platform. &nbsp;But if not, they are</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* not included in the enum option array, and therefore will never</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* be seen here.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case SYNC_METHOD_FSYNC:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case SYNC_METHOD_FSYNC_WRITETHROUGH:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case SYNC_METHOD_FDATASYNC:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0;</font></div><div><font size="2"   >#ifdef OPEN_SYNC_FLAG</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case SYNC_METHOD_OPEN:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return OPEN_SYNC_FLAG | o_direct_flag;</font></div><div><font size="2"   >#endif</font></div><div><font size="2"   >#ifdef OPEN_DATASYNC_FLAG</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case SYNC_METHOD_OPEN_DSYNC:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return OPEN_DATASYNC_FLAG | o_direct_flag;</font></div><div><font size="2"   >#endif</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* can't happen (unless we are out of sync with option array) */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, "unrecognized wal_sync_method: %d", method);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* silence warning */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div><div><br></div><div>[参考]</div><div>1. man open</div><div>2. xlog.c, fd.c, ...</div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL xlog flush  O_DIRECT flag - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>