<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">blockdev --setra read ahead performance</h2>
	<h5 id="">2013-11-26 8:39:38&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201310268364617/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="line-height: 28px;"   >以下CentOS 6.4 x64上的测试结果,</span></div><div>硬盘OCZ RevoDrive3 X2 240G</div><div>读取94393左右个数据块,&nbsp;</div><div>在read ahead=256(默认)情况下的时间为2376毫秒左右. (当然还有除掉cpu tuples operator的时间, 这里不额外叙述, 只是表面read ahead的影响.)</div><div>在<span style="line-height: 28px;"   >read ahead=0时,&nbsp;</span>时间为18773毫秒左右.</div><div><span style="line-height: 28px;"   >在</span><span style="line-height: 28px;"   >read ahead=512时,&nbsp;</span><span style="line-height: 28px;"   >时间为</span>2115<span style="line-height: 28px;"   >毫秒左右.</span></div><div><span style="line-height: 28px;"   >在</span><span style="line-height: 28px;"   >read ahead=1024时,&nbsp;</span><span style="line-height: 28px;"   >时间为</span><span style="line-height: 28px;"   >2082</span><span style="line-height: 28px;"   >毫秒左右.</span></div><div><span style="line-height: 28px;"   >一般情况下, 默认的设置256就差不多了, 无需多调.</span></div><div><span style="line-height: 28px;"   ><br></span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >每次查询前清理OS CACHE.</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   ><div>[root@db-172-16-3-150 ~]# sync</div><div>[root@db-172-16-3-150 ~]# &nbsp;echo 3 &gt; /proc/sys/vm/drop_caches</div><div><br></div></font></span></div><div><font size="2"   >设置块设备read ahead</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# blockdev --setra 512 /dev/sdb<br>[root@db-172-16-3-150 ~]# blockdev --setra 1024 /dev/sdb</font></div><div><font size="2"   >...</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >----</font></div><div><font size="2"   >&nbsp;Seq Scan on postgres.tbl_cost_align &nbsp;(cost=0.00..195393.00 rows=10100000 width=45) (actual time=2.742..2115.588 rows=10100000 loops</font></div><div><font size="2"   >=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared hit=256 read=94137</font></div><div><font size="2"   >&nbsp;Total runtime: 3148.863 ms</font></div><div><font size="2"   >(4 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >-- 清理OS CACHE</font></div><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >----</font></div><div><font size="2"   >&nbsp;Seq Scan on postgres.tbl_cost_align &nbsp;(cost=0.00..195393.00 rows=10100000 width=45) (actual time=2.502..2082.989 rows=10100000 loops</font></div><div><font size="2"   >=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared hit=288 read=94105</font></div><div><font size="2"   >&nbsp;Total runtime: 3103.415 ms</font></div><div><font size="2"   >(4 rows)</font></div></div><div><font size="2"   ><br></font></div><div><span style="line-height: 28px;"   ><font size="2"   >-- 清理OS CACHE</font></span></div><div><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >-----</font></div><div><font size="2"   >&nbsp;Seq Scan on postgres.tbl_cost_align &nbsp;(cost=0.00..195393.00 rows=10100000 width=45) (actual time=0.652..18773.211 rows=10100000 loop</font></div><div><font size="2"   >s=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared read=94393</font></div><div><font size="2"   >&nbsp;Total runtime: 19824.287 ms</font></div><div><font size="2"   >(4 rows)</font></div></div><div><font size="2"   >...</font></div><p></p></pre></div><div><br></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" rel="nofollow" href="http://unix.stackexchange.com/questions/71364/persistent-blockdev-setra-read-ahead-setting"   >http://unix.stackexchange.com/questions/71364/persistent-blockdev-setra-read-ahead-setting</a></div><div>2. man blockdev</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >BLOCKDEV(8) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;BLOCKDEV(8)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >NAME</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;blockdev - call block device ioctls from the command line</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SYNOPSIS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;blockdev [options] commands devices</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;blockdev --report [devices]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >DESCRIPTION</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The utility blockdev allows one to call block device ioctls from the command line.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >OPTIONS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-V &nbsp; &nbsp; Print version and exit.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-q &nbsp; &nbsp; Be quiet.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-v &nbsp; &nbsp; Be verbose.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--report</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Print a report for devices. &nbsp;Note that the partition StartSec is in 512-byte sectors.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >COMMANDS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--setro</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set read-only.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--setrw</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set read-write.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--getro</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Get read-only. Print 1 if the device is read-only, 0 otherwise.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--getss</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Print sectorsize in bytes - usually 512.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--getbsz</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Print blocksize in bytes.</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--setbsz N</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set blocksize to N bytes.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--getsize</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Print device size in sectors (BLKGETSIZE). Deprecated in favor of the --getsz option.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--getsize64</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Print device size in bytes (BLKGETSIZE64)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--getsz</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Get size in 512-byte sectors (BLKGETSIZE64 / 512).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--setra N</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set readahead to N 512-byte sectors.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--getra</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Print readahead (in 512-byte sectors).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--setfra N</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set filesystem readahead (same like --setra on 2.6 kernels).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--getfra</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Get filesystem readahead.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--flushbufs</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Flush buffers.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--rereadpt</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reread partition table.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >AUTHOR</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;blockdev was written by Andries E. Brouwer.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >AVAILABILITY</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The &nbsp; blockdev &nbsp; command &nbsp; is &nbsp; part &nbsp;of &nbsp;the &nbsp;util-linux-ng &nbsp;package &nbsp;and &nbsp;is &nbsp;available &nbsp;from &nbsp;ftp://ftp.ker-</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;nel.org/pub/linux/utils/util-linux-ng/.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Jun 2007 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;BLOCKDEV(8)</font></div></div><p></p></pre></div></div>
	</div>
</div>
</body>
</html>