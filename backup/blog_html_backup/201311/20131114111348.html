<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Systemtap examples, Network - 4 Monitoring TCP Packets</h2>
	<h5 id="">2013-11-14 11:13:48&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020131014104256627/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>例子来自<span style="line-height: 28px;"   >tcpdumplike.stp</span>脚本, 当tcp.receive事件触发后, 取出类似tcpdump输出的源ip, 目的ip, 源端口, 目的端口, 以及6个tcp包的控制比特位信息.</div><div>tcp.receive alias实际上包含2个内核函数, 分别代表ipv4和ipv6.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><span style="font-family: 'lucida Grande', Verdana; line-height: 23px;"   ><font size="2"   >kernel.function("tcp_v4_rcv")</font></span></div><div><div style="line-height: 24px; font-family: 'lucida Grande', Verdana;"   ><font size="2"   >kernel.function("tcp_v6_rcv")!,&nbsp;<span style="line-height: 24px;"   >module("ipv6").function("tcp_v6_rcv")</span></font></div></div><div style="line-height: 24px; font-family: 'lucida Grande', Verdana;"   ><font size="2"   ><span style="line-height: 24px;"   >// !表示有限匹配</span><span style="line-height: 24px;"   >kernel.function("tcp_v6_rcv"), 匹配后下面的module就不触发了.</span></font></div><p></p></pre></div><div><span style="font-family: 'lucida Grande', Verdana; font-size: 14px; line-height: 23px;"   ><br></span></div><div>脚本内容以及注解</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 network]# cd /usr/share/systemtap/testsuite/systemtap.examples/network</font></div><div><div><font size="2"   >[root@db-172-16-3-150 network]# cat tcpdumplike.stp</font></div><div><font size="2"   >#!/usr/bin/stap</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >// A TCP dump like example</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe begin, timer.s(1) {</font></div><div><font size="2"   >&nbsp; printf("-----------------------------------------------------------------\n")</font></div><div><font size="2"   >&nbsp; printf(" &nbsp; &nbsp; &nbsp; Source IP &nbsp; &nbsp; &nbsp; &nbsp; Dest IP &nbsp;SPort &nbsp;DPort &nbsp;U &nbsp;A &nbsp;P &nbsp;R &nbsp;S &nbsp;F \n")</font></div><div><font size="2"   >&nbsp; printf("-----------------------------------------------------------------\n")</font></div><div><font size="2"   >}</font></div><div><font size="2"   >// stap脚本开始, 并且以后每秒输出一次头信息. 方便阅读.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe tcp.receive {</font></div><div><font size="2"   >&nbsp; printf(" %15s %15s &nbsp;%5d &nbsp;%5d &nbsp;%d &nbsp;%d &nbsp;%d &nbsp;%d &nbsp;%d &nbsp;%d\n",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;saddr, daddr, sport, dport, urg, ack, psh, rst, syn, fin)</font></div><div><font size="2"   >}</font></div></div><div><font size="2"   >// 跟踪tcp.receive事件, 事件出发时, 输出</font></div><div><font size="2"   >// saddr 源IP</font></div><div><font size="2"   >// daddr 目的IP</font></div><div><font size="2"   >// sport 源端口</font></div><div><font size="2"   >// dport 目的端口</font></div><div><font size="2"   >// urg, ack, psh, rst syn, fin 6个tcp包的控制比特位信息</font></div><p></p></pre></div><div><br></div><div>执行输出举例</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 network]# stap ./tcpdumplike.stp&nbsp;</font></div><div><font size="2"   >-----------------------------------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Source IP &nbsp; &nbsp; &nbsp; &nbsp; Dest IP &nbsp;SPort &nbsp;DPort &nbsp;U &nbsp;A &nbsp;P &nbsp;R &nbsp;S &nbsp;F&nbsp;</font></div><div><font size="2"   >-----------------------------------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;172.16.8.31 &nbsp; &nbsp;172.16.3.150 &nbsp;51167 &nbsp; &nbsp; 22 &nbsp;0 &nbsp;1 &nbsp;0 &nbsp;0 &nbsp;0 &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;172.16.8.31 &nbsp; &nbsp;172.16.3.150 &nbsp;54223 &nbsp; &nbsp; 22 &nbsp;0 &nbsp;1 &nbsp;1 &nbsp;0 &nbsp;0 &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;172.16.8.31 &nbsp; &nbsp;172.16.3.150 &nbsp;54223 &nbsp; &nbsp; 22 &nbsp;0 &nbsp;1 &nbsp;1 &nbsp;0 &nbsp;0 &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;172.16.8.31 &nbsp; &nbsp;172.16.3.150 &nbsp;54223 &nbsp; &nbsp; 22 &nbsp;0 &nbsp;1 &nbsp;0 &nbsp;0 &nbsp;0 &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;172.16.8.31 &nbsp; &nbsp;172.16.3.150 &nbsp;51167 &nbsp; &nbsp; 22 &nbsp;0 &nbsp;1 &nbsp;1 &nbsp;0 &nbsp;0 &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;172.16.3.40 &nbsp; &nbsp;172.16.3.150 &nbsp;51927 &nbsp; 9000 &nbsp;0 &nbsp;0 &nbsp;0 &nbsp;0 &nbsp;1 &nbsp;0</font></div><p></p></pre></div><div>最后一行的A=0, S=1, 表示这个包是从172.16.3.40发过来的建立三次握手的第一个包.</div><div>U=1的话, 表示重要的包, 接收到后不要放到缓冲区, 直接处理.</div><div><br></div><div>本文用到的tcp.receive probe alias原型.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/usr/share/systemtap/tapset/tcp.stp</font></div><div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >/**</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* probe tcp.receive - Called when a TCP packet is received</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @name: Name of the probe point</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @iphdr: IP header address</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @protocol: Packet protocol from driver</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @family: IP address family</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @saddr: A string representing the source IP address</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @daddr: A string representing the destination IP address</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @sport: TCP source port</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @dport: TCP destination port</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @urg: TCP URG flag</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @ack: TCP ACK flag</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @psh: TCP PSH flag</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @rst: TCP RST flag</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @syn: TCP SYN flag</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;* @fin: TCP FIN flag</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp;*/</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >probe tcp.receive = tcp.ipv4.receive, tcp.ipv6.receive</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >{</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >}</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >// tcp.receive包含ipv4和ipv6的alias.</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   ><br></span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >probe tcp.ipv4.receive = kernel.function("tcp_v4_rcv")</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >{</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; name = "tcp.ipv4.receive"</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; iphdr = __get_skb_iphdr($skb)</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; # If we're here, by definition we're doing AF_INET, not AF_INET6.</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; family = %{ /* pure */ AF_INET %}</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; saddr = format_ipaddr(__ip_skb_saddr(iphdr), %{ /* pure */ AF_INET %})</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; daddr = format_ipaddr(__ip_skb_daddr(iphdr), %{ /* pure */ AF_INET %})</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; protocol = __ip_skb_proto(iphdr)</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   ><br></span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; tcphdr = __get_skb_tcphdr($skb)</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; dport = __tcp_skb_dport(tcphdr)</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; sport = __tcp_skb_sport(tcphdr)</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; urg = __tcp_skb_urg(tcphdr)</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; ack = __tcp_skb_ack(tcphdr)</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; psh = __tcp_skb_psh(tcphdr)</span></font></div><div><font face="lucida Grande, Verdana"   size="2"   ><span style="line-height: 23px;"   >&nbsp; &nbsp; &nbsp; &nbsp; rst = __tcp_skb_rst(tcphdr)</span></font></div></div><div><font face="lucida Grande, Verdana"   size="2"   ><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; syn = __tcp_skb_syn(tcphdr)</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; fin = __tcp_skb_fin(tcphdr)</div><div style="line-height: 24px;"   >}</div><div style="line-height: 24px;"   ><br></div><div style="line-height: 24px;"   >probe tcp.ipv6.receive = kernel.function("tcp_v6_rcv")!,</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; module("ipv6").function("tcp_v6_rcv")</div><div style="line-height: 24px;"   >{</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; name = "tcp.ipv6.receive"</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; iphdr = __get_skb_iphdr(@defined($skb) ? $skb : kernel_pointer($pskb))</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; # If we're here, by definition we're doing AF_INET6, not AF_INET.</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; family = %{ /* pure */ AF_INET6 %}</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; saddr = format_ipaddr(&amp;@cast(iphdr, "ipv6hdr")-&gt;saddr,</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %{ /* pure */ AF_INET6 %})</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; daddr = format_ipaddr(&amp;@cast(iphdr, "ipv6hdr")-&gt;daddr,</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %{ /* pure */ AF_INET6 %})</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; # If we're here, by definition we're doing IPPROTO_TCP. &nbsp;There</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; # isn't a protocol field in 'struct ipv6hdr'. &nbsp;There is one in</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; # 'struct sk_buff', but that protocol field is an Ethernet</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; # Procol ID (ETH_P_*), not an IP protocol ID (IPPROTO_*).</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; protocol = %{ /* pure */ IPPROTO_TCP %}</div><div style="line-height: 24px;"   ><br></div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; tcphdr = __get_skb_tcphdr(@defined($skb) ? $skb : kernel_pointer($pskb))</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; dport = __tcp_skb_dport(tcphdr)</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; sport = __tcp_skb_sport(tcphdr)</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; urg = __tcp_skb_urg(tcphdr)</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; ack = __tcp_skb_ack(tcphdr)</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; psh = __tcp_skb_psh(tcphdr)</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; rst = __tcp_skb_rst(tcphdr)</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; syn = __tcp_skb_syn(tcphdr)</div><div style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; fin = __tcp_skb_fin(tcphdr)</div><div style="line-height: 24px;"   >}</div><div style="line-height: 24px;"   >// 一些tcp常用的函数</div><div><div><span style="line-height: 24px;"   >//</span></div><div><span style="line-height: 24px;"   >//Definitions of the TCP protocol sk_state field listed below.</span></div><div><span style="line-height: 24px;"   >//</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_ESTABLISHED = 1, &nbsp; Normal data transfer</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_SYN_SENT &nbsp; = 2, &nbsp; App. has started to open a connection</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_SYN_RECV &nbsp; = 3, &nbsp; A connection request has arrived; wait for ACK</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_FIN_WAIT1 &nbsp;= 4, &nbsp; App. has said it is finished</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_FIN_WAIT2 &nbsp;= 5, &nbsp; The other side has agreed to close</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_TIME_WAIT &nbsp;= 6, &nbsp; Wait for all packets to die off</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_CLOSE &nbsp; &nbsp; &nbsp;= 7, &nbsp; No connection is active or pending&nbsp;</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_CLOSE_WAIT = 8, &nbsp; The other side has initiated a release</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_LAST_ACK &nbsp; = 9, &nbsp; Last ACK, wait for all packets to die off</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_LISTEN &nbsp; &nbsp; = 10, &nbsp;Waiting for incoming call</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_CLOSING &nbsp; &nbsp;= 11, &nbsp;Both sides have tried to close simultaneously</span></div><div><span style="line-height: 24px;"   >// &nbsp; &nbsp; TCP_MAX_STATES = 12 &nbsp; Max states number</span></div><div><span style="line-height: 24px;"   >//&nbsp;</span></div><div><span style="line-height: 24px;"   >function tcp_ts_get_info_state:long(sock:long)</span></div><div><span style="line-height: 24px;"   >%{ /* pure */</span></div><div><span style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; struct sock *sk = (struct sock *)(long) STAP_ARG_sock;</span></div><div><span style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; STAP_RETVALUE = (int64_t) kread(&amp;(sk-&gt;sk_state));</span></div><div><span style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; CATCH_DEREF_FAULT();</span></div><div><span style="line-height: 24px;"   >%}</span></div><div><span style="line-height: 24px;"   ><br></span></div><div><span style="line-height: 24px;"   >/* return the TCP destination port for a given sock */</span></div><div><span style="line-height: 24px;"   >function __tcp_sock_dport:long (sock:long)</span></div><div><span style="line-height: 24px;"   >{</span></div><div><span style="line-height: 24px;"   >&nbsp; &nbsp; return (@defined(@cast(sock, "inet_sock")-&gt;inet_dport)</span></div><div><span style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? @cast(sock, "inet_sock")-&gt;inet_dport # kernel &gt;= 2.6.33</span></div><div><span style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : (@defined(@cast(sock, "inet_sock")-&gt;dport)</span></div><div><span style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;? @cast(sock, "inet_sock", "kernel")-&gt;dport # kernel &gt;= 2.6.11</span></div><div><span style="line-height: 24px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: @cast(sock, "inet_sock", "kernel&lt;net/ip.h&gt;")-&gt;inet-&gt;dport))</span></div><div><span style="line-height: 24px;"   >}</span></div></div><div><span style="line-height: 24px;"   >// 内嵌了C代码, 为了取出sock的值.</span></div></font></div><p></p></pre></div><div><br></div><div>TCP 包头信息</div><div><pre class="prettyprint"   ><p></p><p style="font-family: Simsun; line-height: normal;"   ><font size="2"   >TCP Header Format</font></p><p style="font-family: Simsun; line-height: normal;"   ></p><pre style="line-height: normal;"   ><font size="2"   >                                    
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Source Port          |       Destination Port        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Sequence Number                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Acknowledgment Number                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Data |           |U|A|P|R|S|F|                               |
   | Offset| Reserved  |R|C|S|S|Y|I|            Window             |
   |       |           |G|K|H|T|N|N|                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Checksum            |         Urgent Pointer        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Options                    |    Padding    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             data                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                            TCP Header Format

          Note that one tick mark represents one bit position.

                               Figure 3.</font></pre><p></p></pre></div><div>控制比特信息 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><p style="font-family: Simsun; line-height: normal;"   ><font size="2"   >Control Bits: 6 bits (from left to right):</font></p><p style="font-family: Simsun; line-height: normal;"   ></p><pre style="line-height: normal;"   ><font size="2"   >    URG:  Urgent Pointer field significant
    ACK:  Acknowledgment field significant
    PSH:  Push Function
    RST:  Reset the connection
    SYN:  Synchronize sequence numbers
    FIN:  No more data from sender</font></pre><p></p></pre></div><div><br></div><div>[参考]</div><div>1. /usr/share/systemtap/testsuite/systemtap.examples</div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://sourceware.org/systemtap/SystemTap_Beginners_Guide/useful-systemtap-scripts.html"   >https://sourceware.org/systemtap/SystemTap_Beginners_Guide/useful-systemtap-scripts.html</a></div><div>3. systemtap-testsuite</div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://sourceware.org/systemtap/examples/"   >https://sourceware.org/systemtap/examples/</a></div><div>5. /usr/share/systemtap/testsuite/systemtap.examples/index.txt</div><div>6. /usr/share/systemtap/testsuite/systemtap.examples/keyword-index.txt</div><div>7. /usr/share/systemtap/tapset</div><div>8.&nbsp;<a style="line-height: 28px;" href="http://blog.163.com/digoal@126/blog/static/1638770402013811957335/"   >http://blog.163.com/digoal@126/blog/static/1638770402013811957335/</a></div><div>9.&nbsp;<a style="line-height: 28px;" rel="nofollow" href="http://www.freesoft.org/CIE/Course/Section4/8.htm"   >http://www.freesoft.org/CIE/Course/Section4/8.htm</a></div><wbr></div>
	</div>
</div>
</body>
</html>