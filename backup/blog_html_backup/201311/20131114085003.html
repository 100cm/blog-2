<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Systemtap examples, Network - 1 Network Profiling</h2>
	<h5 id="">2013-11-14 8:50:03&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013101323634164/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="line-height: 28px;"   >systemtap-testsuite包收集了大量的stp脚本, 可直接用于跟踪以下分类的内容 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >= AUDIT =</font></div><div><font size="2"   >= AUTOFS =</font></div><div><font size="2"   >= BACKTRACE =</font></div><div><font size="2"   >= CALLGRAPH =</font></div><div><font size="2"   >= CPU =</font></div><div><font size="2"   >= DEVICE =</font></div><div><font size="2"   >= DISK =</font></div><div><span style="line-height: 28px;"   ><font size="2"   >= FILE =</font></span></div><div><font size="2"   >= FILESYSTEM =</font></div><div><font size="2"   >= FORMAT =</font></div><div><font size="2"   >= FUNCTION =</font></div><div><font size="2"   >= FUTEX =</font></div><div><font size="2"   >= INTERRUPT =</font></div><div><font size="2"   >= IO =</font></div><div><font size="2"   >= KVM =</font></div><div><font size="2"   >= LIMITS =</font></div><div><font size="2"   >= LOCKING =</font></div><div><font size="2"   >= MEMORY =</font></div><div><font size="2"   >= MONITORING =</font></div><div><span style="line-height: 28px;"   ><font size="2"   >= NANOSLEEP =</font></span></div><div><font size="2"   >= NETWORK =</font></div><div><font size="2"   >= NFS =</font></div><div><font size="2"   >= NUMA =</font></div><div><font size="2"   >= PROCESS =</font></div><div><font size="2"   >= PROFILING =</font></div><div><font size="2"   >= QEMU =</font></div><div><font size="2"   >= SCHEDULER =</font></div><div><font size="2"   >= SCSI =</font></div><div><font size="2"   >= SECURITY =</font></div><div><font size="2"   >= SIGNALS =</font></div><div><font size="2"   >= SIMPLE =</font></div><div><font size="2"   >= SLAB =</font></div><div><font size="2"   >= SOCKET =</font></div><div><font size="2"   >= STATISTICS =</font></div><div><font size="2"   >= SYSCALL =</font></div><div><font size="2"   >= TCP =</font></div><div><font size="2"   >= THREAD =</font></div><div><font size="2"   >= TIME =</font></div><div><font size="2"   >= TRACE =</font></div><div><font size="2"   >= TRACEPOINT =</font></div><div><font size="2"   >= TRAFFIC =</font></div><div><font size="2"   >= TTY =</font></div><div><font size="2"   >= UTILIZATION =</font></div><div><font size="2"   >= VIRTUALIZATION =</font></div><div><font size="2"   >= WATCHDOG =</font></div><div><font size="2"   >= WATCHPOINT =</font></div><p></p></pre></div><div>以上分类取自<span style="line-height: 28px;"   >/usr/share/systemtap/testsuite/systemtap.examples/</span><span style="line-height: 28px;"   >keyword-index.txt</span></div><div><span style="line-height: 28px;"   >对应这些例子的讲解, 除了直接去</span><span style="line-height: 28px;"   >/usr/share/systemtap/testsuite/systemtap.examples目录取之外, 也可以去以下地址</span><span style="line-height: 28px;"   >查看, 都很方便.</span></div><div><a style="line-height: 28px;" rel="nofollow" href="https://sourceware.org/systemtap/examples/"   >https://sourceware.org/systemtap/examples/</a></div><div><br></div><div>接下来我挑选一些例子来讲解. (取材自SystemTap_Beginners_Guide)</div><div>第一个例子来自nettop.stp脚本, 统计各网络接口上网络收发情况, 按照收发包个数(注意不是收发字节)排序, 输出pid, uid, dev, 传输字节数, 接收字节数, command 信息.</div><div><span style="line-height: 28px;"   >nettop.stp&nbsp;</span><span style="line-height: 28px;"   >脚本内容以及注解</span></div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 network]# cd /usr/share/systemtap/testsuite/systemtap.examples/network</font></div><div><font size="2"   >[root@db-172-16-3-150 network]# cat nettop.stp&nbsp;</font></div><div><font size="2"   >#!/usr/bin/stap</font></div><div><font size="2"   >// 指定脚本解释器命令, 如果安装位置不在/usr/bin/stap, 可以修改这行, 或者使用stap nettop.stp执行.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >global ifxmit, ifrecv</font></div><div><font size="2"   >global ifmerged</font></div><div><font size="2"   >// 定义3个全局变量, 分别用于存储传输,接收,以及合并数组;</font></div><div><font size="2"   >// 传输和接收数组中存储统计信息;</font></div><div><font size="2"   >// 合并数组存储网络接口上按照<span style="line-height: 28px;"   >pid(), dev_name, execname(), uid()维度</span><span style="line-height: 28px;"   >累加的传输和接收包个数.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe netdev.transmit</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; ifxmit[pid(), dev_name, execname(), uid()] &lt;&lt;&lt; length</font></div><div><font size="2"   >}</font></div><div><font size="2"   >// netdev.transmit 探针, 网络设备传输buffer时触发.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe netdev.receive</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; ifrecv[pid(), dev_name, execname(), uid()] &lt;&lt;&lt; length</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><span style="line-height: 28px;"   >// netdev.</span><span style="line-height: 28px;"   >receive&nbsp;</span><span style="line-height: 28px;"   >探针, 从网络设备接收数据时触发.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >function print_activity()</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; printf("%5s %5s %-7s %7s %7s %7s %7s %-15s\n",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"PID", "UID", "DEV", "XMIT_PK", "RECV_PK",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"XMIT_KB", "RECV_KB", "COMMAND")</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; foreach ([pid, dev, exec, uid] in ifrecv) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ifmerged[pid, dev, exec, uid] += @count(ifrecv[pid,dev,exec,uid]);</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; foreach ([pid, dev, exec, uid] in ifxmit) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ifmerged[pid, dev, exec, uid] += @count(ifxmit[pid,dev,exec,uid]);</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; foreach ([pid, dev, exec, uid] in ifmerged-) {</font></div><div><font size="2"   >&nbsp; &nbsp; n_xmit = @count(ifxmit[pid, dev, exec, uid])</font></div><div><font size="2"   >&nbsp; &nbsp; n_recv = @count(ifrecv[pid, dev, exec, uid])</font></div><div><font size="2"   >&nbsp; &nbsp; printf("%5d %5d %-7s %7d %7d %7d %7d %-15s\n",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pid, uid, dev, n_xmit, n_recv,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n_xmit ? @sum(ifxmit[pid, dev, exec, uid])/1024 : 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n_recv ? @sum(ifrecv[pid, dev, exec, uid])/1024 : 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exec)</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >// 输出: pid, uid, 网络接口, 传输包数, 接收包数, 传输KB, 接收KB, command.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; print("\n")</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; delete ifxmit</font></div><div><font size="2"   >&nbsp; delete ifrecv</font></div><div><font size="2"   >&nbsp; delete ifmerged</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><span style="line-height: 28px;"   >//&nbsp;</span><span style="line-height: 28px;"   >print_activity 函数, 按照pid,dev,exec,uid维度, 根据网络接收和传输包数倒序输出.</span></font></div><div><font size="2"   ><span style="line-height: 28px;"   >//&nbsp;</span><span style="line-height: 28px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n_xmit ? @sum(ifxmit[pid, dev, exec, uid])/1024 : 0,</span></font></div><div style="line-height: 28px;"   ><font size="2"   >// &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n_recv ? @sum(ifrecv[pid, dev, exec, uid])/1024 : 0,</font></div><div style="line-height: 28px;"   ><font size="2"   >// &nbsp;表示传输和接收的KB数.</font></div><div style="line-height: 28px;"   ><font size="2"   ><span style="line-height: 28px;"   >// print_activity</span><span style="line-height: 28px;"   >&nbsp;函数的末尾清除三个全局变量的值. 下次调用时重新输出上一次输出以来的统计信息.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe timer.ms(5000), end, error</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; print_activity()</font></div><div><font size="2"   >}</font></div><div><font size="2"   >// 每5秒调用一次<span style="line-height: 28px;"   >print_activity</span><span style="line-height: 28px;"   >&nbsp;.</span></font></div><p></p></pre></div><div><br></div><div>执行输出举例</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 network]# stap ./nettop.stp&nbsp;</font></div><div><font size="2"   >&nbsp; PID &nbsp; UID DEV &nbsp; &nbsp; XMIT_PK RECV_PK XMIT_KB RECV_KB COMMAND &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 0 &nbsp; &nbsp; 0 em1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5 &nbsp; &nbsp; &nbsp;24 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 1 swapper &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; PID &nbsp; UID DEV &nbsp; &nbsp; XMIT_PK RECV_PK XMIT_KB RECV_KB COMMAND &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 0 &nbsp; &nbsp; 0 em1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6 &nbsp; &nbsp; &nbsp;26 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 2 swapper &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >25178 &nbsp; &nbsp; 0 em1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 0 sshd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; PID &nbsp; UID DEV &nbsp; &nbsp; XMIT_PK RECV_PK XMIT_KB RECV_KB COMMAND &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 0 &nbsp; &nbsp; 0 em1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5 &nbsp; &nbsp; &nbsp;32 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 2 swapper &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >25525 &nbsp; 500 lo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; 0 postgres &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >25178 &nbsp; &nbsp; 0 em1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 0 sshd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;7015 &nbsp; 500 lo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 0 postgres &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; PID &nbsp; UID DEV &nbsp; &nbsp; XMIT_PK RECV_PK XMIT_KB RECV_KB COMMAND &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 0 &nbsp; &nbsp; 0 em1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6 &nbsp; &nbsp; &nbsp;30 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 1 swapper &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >25178 &nbsp; &nbsp; 0 em1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 0 sshd&nbsp;</font></div><p></p></pre></div></div><div><br></div><div>本文用到的2个probe alias原型.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >/**</font></div><div><font size="2"   >&nbsp;* probe netdev.transmit - Network device transmitting buffer</font></div><div><font size="2"   >&nbsp;* @dev_name: The name of the device. e.g: eth0, ath1.</font></div><div><font size="2"   >&nbsp;* @length: The length of the transmit buffer.</font></div><div><font size="2"   >&nbsp;* @protocol: The protocol of this packet(defined in include/linux/if_ether.h).</font></div><div><font size="2"   >&nbsp;* @truesize: The size of the data to be transmitted.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >// Queue a buffer for transmission to a network device</font></div><div><font size="2"   >probe netdev.transmit</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; = &nbsp;kernel.function("dev_queue_xmit")</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; dev_name = kernel_string($skb-&gt;dev-&gt;name)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; length = $skb-&gt;len</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; protocol = $skb-&gt;protocol</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; truesize = $skb-&gt;truesize</font></div><div><font size="2"   >}</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >/**</font></div><div><font size="2"   >&nbsp;* probe netdev.receive - Data received from network device.</font></div><div><font size="2"   >&nbsp;* @dev_name: The name of the device. e.g: eth0, ath1.</font></div><div><font size="2"   >&nbsp;* @length: The length of the receiving buffer.</font></div><div><font size="2"   >&nbsp;* @protocol: Protocol of received packet.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >/// &nbsp; &nbsp;&lt;varlistentry&gt;&lt;term&gt;protocol&lt;/term&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &lt;listitem&gt;&lt;para&gt;The possible values of protocol could be:</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;table frame='all'&gt;&lt;title&gt;Protocol Values&lt;/title&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;tgroup cols='2' align='left' colsep='1' rowsep='1'&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;colspec colname='Value'/&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;colspec colname='Protocol'/&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;thead&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;Value(Hex)&lt;/entry&gt;&lt;entry&gt;Protocol&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;/thead&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;tbody&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;0001&lt;/entry&gt;&lt;entry&gt;802.3&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;0002&lt;/entry&gt;&lt;entry&gt;AX.25&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;0004&lt;/entry&gt;&lt;entry&gt;802.2&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;0005&lt;/entry&gt;&lt;entry&gt;SNAP&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;0009&lt;/entry&gt;&lt;entry&gt;Localtalk&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;0800&lt;/entry&gt;&lt;entry&gt;IP&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;0805&lt;/entry&gt;&lt;entry&gt;X.25&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;0806&lt;/entry&gt;&lt;entry&gt;ARP&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;8035&lt;/entry&gt;&lt;entry&gt;RARP&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;8100&lt;/entry&gt;&lt;entry&gt;802.1Q VLAN&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;8137&lt;/entry&gt;&lt;entry&gt;IPX&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;row&gt;&lt;entry&gt;86DD&lt;/entry&gt;&lt;entry&gt;IPv6&lt;/entry&gt;&lt;/row&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;/tbody&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;/tgroup&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &lt;/table&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &lt;/para&gt;&lt;/listitem&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp;&lt;/varlistentry&gt;</font></div><div><font size="2"   >///</font></div><div><font size="2"   >/// &nbsp; &nbsp;&lt;varlistentry&gt;&lt;term&gt;truesize&lt;/term&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &lt;listitem&gt;&lt;para&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The size of the received data.</font></div></div><div><div><font size="2"   >/// &nbsp; &nbsp; &nbsp; &lt;/para&gt;&lt;/listitem&gt;</font></div><div><font size="2"   >/// &nbsp; &nbsp;&lt;/varlistentry&gt;</font></div><div><font size="2"   >///</font></div><div><font size="2"   >/// &nbsp;&lt;/variablelist&gt;</font></div><div><font size="2"   >///&lt;/para&gt;</font></div><div><font size="2"   >// Main device receive routine, be called when packet arrives on network device</font></div><div><font size="2"   >probe netdev.receive</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; = &nbsp;kernel.function("netif_receive_skb")</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; dev_name = kernel_string($skb-&gt;dev-&gt;name)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; length = $skb-&gt;len</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; protocol = $skb-&gt;protocol</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; truesize = $skb-&gt;truesize</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;/usr/share/systemtap/testsuite/systemtap.examples</div><div>2.&nbsp;<a style="line-height: 28px;" rel="nofollow" href="https://sourceware.org/systemtap/SystemTap_Beginners_Guide/useful-systemtap-scripts.html"   >https://sourceware.org/systemtap/SystemTap_Beginners_Guide/useful-systemtap-scripts.html</a></div><div>3.&nbsp;systemtap-testsuite</div>4.&nbsp;<a rel="nofollow" href="https://sourceware.org/systemtap/examples/"   >https://sourceware.org/systemtap/examples/</a><div>5.&nbsp;/usr/share/systemtap/testsuite/systemtap.examples/index.txt</div><div>6.&nbsp;<span style="line-height: 28px;"   >/usr/share/systemtap/testsuite/systemtap.examples/</span><span style="line-height: 28px;"   >keyword-index.txt</span></div>7.&nbsp;/usr/share/systemtap/tapset</div>
	</div>
</div>
</body>
</html>