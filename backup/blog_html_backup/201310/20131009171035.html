<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Systemtap Statistics (aggregates) Data Type</h2>
	<h5 id="">2013-10-09 17:10:35&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020139925734415/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div><div style="line-height: 28px;"   >统计类型在以前写的几篇BLOG进行过述过.&nbsp;</div><div style="line-height: 28px;"   >可参考 :&nbsp;</div><div style="line-height: 28px;"   ><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><a style="line-height: 28px; text-decoration: none; color: rgb(85, 108, 136);" href="http://blog.163.com/digoal@126/blog/static/16387704020138310438924/"   >http://blog.163.com/digoal@126/blog/static/16387704020138310438924/</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><a style="line-height: 28px; text-decoration: none; color: rgb(85, 108, 136);" href="http://blog.163.com/digoal@126/blog/static/16387704020138333731979/"   >http://blog.163.com/digoal@126/blog/static/16387704020138333731979/</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><a style="line-height: 28px; text-decoration: none; color: rgb(85, 108, 136);" href="http://blog.163.com/digoal@126/blog/static/16387704020138392759478/"   >http://blog.163.com/digoal@126/blog/static/16387704020138392759478/</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >本文可作为一个补充.</div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><br></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >统计|聚合类型存储数字类型的统计流信息, 聚合类型只有1个操作符, &lt;&lt;&lt;, 用以向统计类型中添加基础数据.&nbsp;</div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >统计类型数据的展现可以通过几个函数来实现, 例如统计类型变量中包含多少个基础数据, 这些基础数据的最大值, 最小值, 平均值, 求和等.</div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >统计类型变量必须声明为全局变量, 统计类型可以存储在普通的全局变量或者数组的元素中.&nbsp;</div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >例如 :&nbsp;</div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >global var;</font></div><div style="line-height: 28px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >global arr;</font></div><div style="line-height: 28px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >var &lt;&lt;&lt; pid();</font></div><div style="line-height: 28px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >arr[1] &lt;&lt;&lt; pid();</font></div><p></p></pre></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >统计变量操作不需要exclusive lock, 所以操作起来比较快.</div></div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Aggregate instances are used to collect statistics on numerical values,&nbsp;</font></div><div><font size="2"   >it is important to accumulate new data quickly and in large volume.&nbsp;</font></div><div><font size="2"   >These instances operate without exclusive locks, and store only aggregated stream statistics.&nbsp;</font></div><div><font size="2"   >Aggregates make sense only for global variables.&nbsp;</font></div><div><font size="2"   >They are stored individually or as elements of an associative array.&nbsp;</font></div><div><font size="2"   >For information about wrapping associative arrays with statistics elements,&nbsp;</font></div><p></p></pre></div><div>使用数组元素来存储统计类型时, 由于数组元素的个数在声明数组时固定了, 超出的话可以通过覆盖最早的元素值(wrap)来避免错误.参考wrap部分 :&nbsp;</div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402013999511424/"   >http://blog.163.com/digoal@126/blog/static/1638770402013999511424/</a></div><div><br></div><div>8.1 The aggregation (&lt; &lt; &lt;) operator</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >The aggregation operator is ``&lt; &lt; &lt;'', and its effect is similar to an assignment or a C++ output streaming operation.&nbsp;</font></div><div><font size="2"   >The left operand specifies a scalar or array-index l-value, which must be declared global.&nbsp;</font></div><div><font size="2"   >The right operand is a numeric expression.&nbsp;</font></div><div><font size="2"   >The meaning is intuitive: add the given number as a sample to the set of numbers to compute their statistics.&nbsp;</font></div><div><font size="2"   >The specific list of statistics to gather is given separately by the extraction functions.&nbsp;</font></div><div><font size="2"   >The following is an example.</font></div><div><font size="2"   >a &lt;&lt;&lt; delta_timestamp</font></div><div><font size="2"   >writes[execname()] &lt;&lt;&lt; count</font></div><p></p></pre></div><div>统计类型仅支持1个操作符 &lt;&lt;&lt; , 即往统计类型变量中增加采样数据(或叫基础数据).</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >a &lt;&lt;&lt; delta_timestamp</font></div><div style="line-height: 28px;"   ><font size="2"   >writes[execname()] &lt;&lt;&lt; count</font></div><p></p></pre></div></div><div><br></div><div>从统计类型变量中得到统计信息的函数如下 :&nbsp;</div><div>8.2 Extraction functions</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >For each instance of a distinct extraction function operating on a given identifier, the translator computes a set of statistics.&nbsp;</font></div><div><font size="2"   >With each execution of an extraction function, the aggregation is computed for that moment across all processors.&nbsp;</font></div><div><font size="2"   >The first argument of each function is the same style of l-value as used on the left side of the aggregation operation.</font></div><p></p></pre></div><div>从统计类型中得到整型采样统计, 如采样数据的个数, 求和, 最小值, 最大值, 平均值.</div><div>8.3 Integer extractors</div><div><pre class="prettyprint"   ><p><font size="2"   >The following functions provide methods to extract information about aggregate.</font></p></pre></div><div>统计类型变量中包含多少个采样数据 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >8.3.1 @count(s)</font></div><div><font size="2"   >This statement returns the number of samples accumulated in aggregate s.</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >统计类型变量的采样数据求和 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >8.3.2 @sum(s)</font></div><div><font size="2"   >This statement returns the total sum of all samples in aggregate s.</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >统计类型变量的采样数据的最小值 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >8.3.3 @min(s)</font></div><div><font size="2"   >This statement returns the minimum of all samples in aggregate s.</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >统计类型变量的采样数据的最大值 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >8.3.4 @max(s)</font></div><div><font size="2"   >This statement returns the maximum of all samples in aggregate s.</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >统计类型变量的采样数据的平均值 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >8.3.5 @avg(s)</font></div><div><font size="2"   >This statement returns the average value of all samples in aggregate s.</font></div><p></p></pre></div><div>举例 :&nbsp;</div><div>因为stap脚本语言中数字类型只支持整型, 所以在输出中没有小数.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# stap -D MAXACTION=199999999 -e 'global stat; probe begin {for(i=0;i&lt;990000000;i++) stat &lt;&lt;&lt; i; printd("/",@count(stat),@max(stat),@min(stat),@avg(stat),@sum(stat),"\n"); exit()}'</font></div><div><font size="2"   >990000000/989999999/0/494999999/490049999505000000/</font></div><p></p></pre></div><div><br></div><div><div style="line-height: 28px;"   >从统计类型中得到柱状采样分布的函数 :&nbsp;</div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >8.4 Histogram extractors</font></div><div><font size="2"   >The following functions provide methods to extract histogram information.</font></div><div><font size="2"   >Printing a histogram with the print family of functions renders a histogram object as a tabular "ASCII art" bar chart.</font></div><p></p></pre></div><div>有两个函数可以输出采样值分布的柱状图.</div><div>第一个是@hist_linear函数.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >8.4.1 @hist_linear</font></div><div><font size="2"   >The statement @hist_linear(v,L,H,W) represents a linear histogram of aggregate v,&nbsp;</font></div><div><font size="2"   >where L and H represent the lower and upper end of a range of values ,</font></div><div><font size="2"   >W represents the width (or size) of each bucket within the range.&nbsp;</font></div><div><font size="2"   >The low and high values can be negative, but the overall difference (high minus low) must be positive.&nbsp;</font></div><div><font size="2"   >The width parameter must also be positive.</font></div><p></p></pre></div><div>语法 &nbsp;:&nbsp;</div><div><span style="line-height: 28px;"   >@hist_linear(v,L,H,W)</span></div><div><span style="line-height: 28px;"   >v 代表统计类型变量.</span></div><div><span style="line-height: 28px;"   >L代表采样数据输出柱状图的小值边界.</span></div><div><span style="line-height: 28px;"   >H代表</span><span style="line-height: 28px;"   >采样数据的</span><span style="line-height: 28px;"   >大值边界.</span></div><div><span style="line-height: 28px;"   >W是bucket的大小.</span></div><div><span style="line-height: 28px;"   >例如 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# stap -e 'global s; probe begin {for(i=-100;i&lt;100;i++) s&lt;&lt;&lt;i; println(@hist_linear(s, 0, 1000, 20)); exit()}'</font></div><div><font size="2"   >value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 100  小于0的采样数据有100个</font></div><div><font size="2"   >&nbsp; &nbsp; 0 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20  &gt;=0 &amp;&amp; &lt;20 的采样数据有20个.</font></div><div><font size="2"   >&nbsp; &nbsp;20 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20  ...以此类推</font></div><div><font size="2"   >&nbsp; &nbsp;40 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; &nbsp;60 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; &nbsp;80 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 100 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0  &gt;=100 &amp;&amp; &lt;120 的采样数据有0个</font></div><div><font size="2"   >&nbsp; 120 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0  &gt;=120 &amp;&amp; &lt;140 的采样数据有0个</font></div><div><font size="2"   >... 后面的数据都是0个, hist_linear把他们去掉不输出了. 采样数据在bucket中为空的话, 怎样去掉规则见下面的解释.</font></div><p></p></pre></div><div>空的bucket没有必要输出, 在中间部分的空bucket 前后各取<span style="line-height: 28px;"   >HIST_ELISION个, 中间的去掉以~符号代替之. 首尾的只留</span><span style="line-height: 28px;"   >HIST_ELISION个, 其余的去掉. 上面的例子出现的空bucket是在尾部, 所以保留2个, 其余的去掉.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >In the output, a range of consecutive empty buckets may be replaced with a tilde (~) character.&nbsp;</font></div><div><font size="2"   >This can be controlled on the command line with -D HIST_ELISION=&lt; num&gt; , where &lt; num&gt; specifies how many empty buckets at the top and bottom of the range to print.&nbsp;</font></div><div><font size="2"   >The default is 2. A &lt; num&gt; of 0 removes all empty buckets.&nbsp;</font></div><div><font size="2"   >A negative &lt; num&gt; disables removal. &nbsp;-- 负的<span style="line-height: 28px;"   >HIST_ELISION表示不移除任何空的bucket(仅限于出现在中间部分的空bucket).</span></font></div><p></p></pre></div><div>例如 :&nbsp;</div><div>中间部分的空bucket以~代替 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# stap -D HIST_ELISION=2 -e 'global s; probe begin {for(i=-100;i&lt;100;i++) s&lt;&lt;&lt;i; for(i=300;i&lt;400;i++) s&lt;&lt;&lt;i; print(@hist_linear(s, 0, 1000, 20)); exit()}'</font></div><div><font size="2"   >value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 100</font></div><div><font size="2"   >&nbsp; &nbsp; 0 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; &nbsp;20 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; &nbsp;40 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; &nbsp;60 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; &nbsp;80 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 100 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 120 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; ~</font></div><div><font size="2"   >&nbsp; 260 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 280 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 300 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 320 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 340 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 360 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 380 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 400 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 420 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >HIST_ELISION不管多少末尾部分的空bucket还是一样会去掉 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# stap -D HIST_ELISION=-1 -e 'global s; probe begin {for(i=-100;i&lt;100;i++) s&lt;&lt;&lt;i; for(i=300;i&lt;400;i++) s&lt;&lt;&lt;i; print(@hist_linear(s, 0, 1000, 20)); exit()}'</font></div><div><font size="2"   >value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 100</font></div><div><font size="2"   >&nbsp; &nbsp; 0 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; &nbsp;20 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; &nbsp;40 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; &nbsp;60 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; &nbsp;80 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 100 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 120 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 140 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 160 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 180 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 200 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 220 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 240 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 260 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 280 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 300 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 320 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 340 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 360 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 380 |@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20</font></div><div><font size="2"   >&nbsp; 400 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 420 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><p></p></pre></div><div>以下为书上的例子 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >For example, if you specify -D HIST_ELISION=3 and the histogram has 10 consecutive empty buckets, the first 3 and last 3 empty buckets will be printed and the middle 4 empty buckets will be represented by a tilde (~).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The following is an example.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >global reads</font></div><div><font size="2"   >probe netdev.receive {</font></div><div><font size="2"   >&nbsp; &nbsp; reads &lt;&lt;&lt; length</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe end {</font></div><div><font size="2"   >&nbsp; &nbsp; print(@hist_linear(reads, 0, 10240, 200))</font></div><div><font size="2"   >}</font></div><div><font size="2"   >This generates the following output.</font></div><div><font size="2"   >value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp; 0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 1650</font></div><div><font size="2"   >&nbsp; 200 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8</font></div><div><font size="2"   >&nbsp; 400 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; 600 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; ~</font></div><div><font size="2"   >&nbsp;1000 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;1200 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;1400 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >&nbsp;1600 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;1800 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >This shows that 1650 network reads were of a size between 0 and 199 bytes,&nbsp;</font></div><div><font size="2"   >8 reads were between 200 and 399 bytes,&nbsp;</font></div><div><font size="2"   >1 read was between 1200 and 1399 bytes.&nbsp;</font></div><div><font size="2"   >The tilde (~) character indicates the bucket for 800 to 999 bytes was removed because it was empty.&nbsp;</font></div><div><font size="2"   >Empty buckets for 2000 bytes and larger were also removed because they were empty.</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >第二个是@hist_log函数.&nbsp;</span></div><div><span style="line-height: 28px;"   >和@hist_linear类似, 只是W是2^n.</span></div><div>8.4.2 @hist_log</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >The statement @hist_log(v) represents a base-2 logarithmic histogram. Empty buckets are replaced with a tilde (~) character in the same way as @hist_linear() (see above).</font></div><div><font size="2"   >The following is an example.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >global reads</font></div><div><font size="2"   >probe netdev.receive {</font></div><div><font size="2"   >&nbsp; &nbsp; reads &lt;&lt;&lt; length</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe end {</font></div><div><font size="2"   >&nbsp; &nbsp; print(@hist_log(reads))</font></div><div><font size="2"   >}</font></div><div><font size="2"   >This generates the following output.</font></div><div><font size="2"   >value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp; 8 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp;16 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp;32 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;254</font></div><div><font size="2"   >&nbsp; &nbsp;64 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3</font></div><div><font size="2"   >&nbsp; 128 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2</font></div><div><font size="2"   >&nbsp; 256 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2</font></div><div><font size="2"   >&nbsp; 512 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4</font></div><div><font size="2"   >&nbsp;1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 16689</font></div><div><font size="2"   >&nbsp;2048 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;4096 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><p></p></pre></div><div>例子 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# stap -D HIST_ELISION=-1 -e 'global s; probe begin {for(i=-100;i&lt;100;i++) s&lt;&lt;&lt;i; for(i=300;i&lt;400;i++) s&lt;&lt;&lt;i; print(@hist_log(s)); exit()}'</font></div><div><font size="2"   >value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp;-256 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;-128 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; -64 |@@@@@@@@@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;37</font></div><div><font size="2"   >&nbsp; -32 |@@@@@@@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32</font></div><div><font size="2"   >&nbsp; -16 |@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16</font></div><div><font size="2"   >&nbsp; &nbsp;-8 |@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8</font></div><div><font size="2"   >&nbsp; &nbsp;-4 |@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4</font></div><div><font size="2"   >&nbsp; &nbsp;-2 |@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2</font></div><div><font size="2"   >&nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp; &nbsp; 2 |@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2</font></div><div><font size="2"   >&nbsp; &nbsp; 4 |@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4</font></div><div><font size="2"   >&nbsp; &nbsp; 8 |@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8</font></div><div><font size="2"   >&nbsp; &nbsp;16 |@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16</font></div><div><font size="2"   >&nbsp; &nbsp;32 |@@@@@@@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32</font></div><div><font size="2"   >&nbsp; &nbsp;64 |@@@@@@@@@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;36</font></div><div><font size="2"   >&nbsp; 128 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; 256 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 100</font></div><div><font size="2"   >&nbsp; 512 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;1024 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><p></p></pre></div><div><br></div><div>8.5 Deletion</div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >The delete statement applied to an aggregate variable will reset it to the initial empty state.</font></div></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >详见 :&nbsp;</span></div></div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402013997490563/"   >http://blog.163.com/digoal@126/blog/static/1638770402013997490563/</a></div><div>例子 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# stap --vp 00001 -D HIST_ELISION=-1 -e 'global s; probe begin {for(i=-100;i&lt;100;i++) s&lt;&lt;&lt;i; for(i=300;i&lt;400;i++) s&lt;&lt;&lt;i; println("before delete cnt: ",@count(s)); delete s; println("after delete cnt: ",@count(s)); exit()}'</font></div><div><font size="2"   >Pass 5: starting run.</font></div><div><font size="2"   >before delete cnt: 300</font></div><div><font size="2"   >after delete cnt: 0</font></div><div><font size="2"   >Pass 5: run completed in 10usr/30sys/306real ms.</font></div><p></p></pre></div><div>使用delete清除统计类型变量后, 显然采样数据个数为0.</div><div><br></div>[参考<span style="line-height: 28px;"   >]</span><div><wbr></div><div><span style="line-height: 28px;"   >1.&nbsp;</span><a style="line-height: 28px;" rel="nofollow" href="https://sourceware.org/systemtap/langref/Statistics_aggregates.html"   >https://sourceware.org/systemtap/langref/Statistics_aggregates.html</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020138310438924/"   >http://blog.163.com/digoal@126/blog/static/16387704020138310438924/</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >3.&nbsp;<a style="font-family: Arial, Helvetica, sans-serif; line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020138333731979/"   >http://blog.163.com/digoal@126/blog/static/16387704020138333731979/</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >4.&nbsp;<a style="font-family: Arial, Helvetica, sans-serif; line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020138392759478/"   >http://blog.163.com/digoal@126/blog/static/16387704020138392759478/</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >5.&nbsp;<a style="font-family: Arial, Helvetica, sans-serif; line-height: 28px;" href="http://blog.163.com/digoal@126/blog/static/1638770402013997490563/"   >http://blog.163.com/digoal@126/blog/static/1638770402013997490563/</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >6.&nbsp;<a style="font-family: Arial, Helvetica, sans-serif; line-height: 28px;" rel="nofollow" href="https://sourceware.org/systemtap/tapsets/API-netdev-receive.html"   >https://sourceware.org/systemtap/tapsets/API-netdev-receive.html</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><br></div></div>
	</div>
</div>
</body>
</html>