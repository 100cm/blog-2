<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">create docker image 1 -  use other images</h2>
	<h5 id="">2014-10-23 13:36:58&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014923112924656/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>本文主要讲一下创建image的方法之一, 从已有的image创建image.</div><div><br></div><div>测试环境 :&nbsp;</div><div>CentOS 6.5 x64</div><div>安装参考</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201482910531328/"   >http://blog.163.com/digoal@126/blog/static/163877040201482910531328/</a></div><div>第一次启动docker服务前, 最好在独立分区或存储中创建一个目录存放docker的images和containers等信息.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># mkdir /data01/docker</font></div><div><font size="2"   ># ln -s /data01/docker /var/lib/</font></div><p></p></pre></div><div>启动docker服务</div><pre class="prettyprint"   ><p></p><div><font size="2"   ># service docker start</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >服务启动后可以看到启动了相应的虚拟网桥, 并创建了相应的nat表信息.</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@150 ~]# ifconfig</font></div><div><font size="2"   >docker0 &nbsp; Link encap:Ethernet &nbsp;HWaddr 66:B7:CF:A7:21:F4 &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:172.17.42.1 &nbsp;Bcast:0.0.0.0 &nbsp;Mask:255.255.0.0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::64b7:cfff:fea7:21f4/64 Scope:Link</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:6 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:468 (468.0 b)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@150 ~]# brctl show</font></div><div><font size="2"   >bridge name &nbsp; &nbsp; bridge id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STP enabled &nbsp; &nbsp; interfaces</font></div><div><font size="2"   >docker0 &nbsp; &nbsp; &nbsp; &nbsp; 8000.000000000000 &nbsp; &nbsp; &nbsp; no</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@150 ~]# iptables-save</font></div><div><font size="2"   ># Generated by iptables-save v1.4.7 on Thu Oct 23 11:36:28 2014</font></div><div><font size="2"   >*nat</font></div><div><font size="2"   >:PREROUTING ACCEPT [4253:466930]</font></div><div><font size="2"   >:POSTROUTING ACCEPT [286:15293]</font></div><div><font size="2"   >:OUTPUT ACCEPT [286:15293]</font></div><div><font size="2"   >:DOCKER - [0:0]</font></div><div><font size="2"   >-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER&nbsp;</font></div><div><font size="2"   >-A POSTROUTING -s 172.17.0.0/16 ! -d 172.17.0.0/16 -j MASQUERADE&nbsp;</font></div><div><font size="2"   >-A POSTROUTING -s 172.17.0.0/16 ! -d 172.17.0.0/16 -j MASQUERADE&nbsp;</font></div><div><font size="2"   >-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER&nbsp;</font></div><div><font size="2"   >COMMIT</font></div><div><font size="2"   ># Completed on Thu Oct 23 11:36:28 2014</font></div><div><font size="2"   ># Generated by iptables-save v1.4.7 on Thu Oct 23 11:36:28 2014</font></div></div><p></p></pre></div><div><br></div><div>接下来从docker hub下载一个image, 作为我们创建image的基础image.</div><wbr><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@150 ~]# docker search centos</font></div><div><font size="2"   >NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DESCRIPTION &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STARS &nbsp; &nbsp; OFFICIAL &nbsp; AUTOMATED</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The official build of CentOS. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 540 &nbsp; &nbsp; &nbsp; [OK] &nbsp;&nbsp;</font></div></div><div><font size="2"   >[root@150 ~]# docker pull centos</font></div><div><div><font size="2"   >[root@150 ~]# docker images</font></div><div><font size="2"   >REPOSITORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VIRTUAL SIZE</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 504a65221a38 &nbsp; &nbsp; &nbsp; &nbsp;3 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 467.1 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 68edf809afe7 &nbsp; &nbsp; &nbsp; &nbsp;3 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 212.7 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 87e5b6b3ccc1 &nbsp; &nbsp; &nbsp; &nbsp;3 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 224 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;87e5b6b3ccc1 &nbsp; &nbsp; &nbsp; &nbsp;3 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 224 MB</font></div></div><p></p></pre></div><div><br></div><div>我这里使用centos:centos6来启动container, 并安装postgresql.</div><div>安装完postgresql后, 保存为(或创建)一个新的image.</div><div>启动一个container, 并连接到终端, 因为要出外网下载一些软件, 所以--net="host"启动.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# docker run -t -i --net="host" centos:centos6 /bin/bash</font></div><div><font size="2"   >bash-4.1# ping 202.101.172.35</font></div><div><font size="2"   >PING 202.101.172.35 (202.101.172.35) 56(84) bytes of data.</font></div><div><font size="2"   >64 bytes from 202.101.172.35: icmp_seq=1 ttl=58 time=2.32 ms</font></div><div><font size="2"   >64 bytes from 202.101.172.35: icmp_seq=2 ttl=58 time=2.31 ms</font></div><p></p></pre></div><div>在container中下载postgresql软件</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >bash-4.1# yum -y install glib2 lrzsz sysstat e4fsprogs xfsprogs ntp readline-devel zlib zlib-devel openssl openssl-devel pam-devel libxml2-devel libxslt-devel python-devel tcl-devel gcc make smartmontools flex bison perl perl-devel perl-ExtUtils* OpenIPMI-tools openldap openldap-devel wget tar bzip2</font></span></div><div><div><font size="2"   >bash-4.1# df -h</font></div><div><font size="2"   >Filesystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Size &nbsp;Used Avail Use% Mounted on</font></div><div><font size="2"   >rootfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9.9G &nbsp;586M &nbsp;8.8G &nbsp; 7% /</font></div><div><font size="2"   >/dev/mapper/docker-8:33-3407874-9241bc14e46b6e4a674e51e71bc524a69e01eba8e3dc6303c56c8b9d91197b89</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 9.9G &nbsp;586M &nbsp;8.8G &nbsp; 7% /</font></div><div><font size="2"   >tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;48G &nbsp; &nbsp; 0 &nbsp; 48G &nbsp; 0% /dev</font></div><div><font size="2"   >shm &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;64M &nbsp; &nbsp; 0 &nbsp; 64M &nbsp; 0% /dev/shm</font></div><div><font size="2"   >/dev/sdc1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 221G &nbsp;154G &nbsp; 56G &nbsp;74% /.dockerinit</font></div><div><font size="2"   >/dev/sda1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;39G &nbsp;4.3G &nbsp; 34G &nbsp;12% /etc/resolv.conf</font></div><div><font size="2"   >/dev/sdc1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 221G &nbsp;154G &nbsp; 56G &nbsp;74% /etc/hostname</font></div><div><font size="2"   >/dev/sdc1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 221G &nbsp;154G &nbsp; 56G &nbsp;74% /etc/hosts</font></div><div><font size="2"   >tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;48G &nbsp; &nbsp; 0 &nbsp; 48G &nbsp; 0% /proc/kcore</font></div><div><font size="2"   >bash-4.1# cd /opt/ &nbsp;</font></div><div><font size="2"   >bash-4.1# mkdir soft_bak</font></div></div><div><span style="line-height: 28px;"   ><font size="2"   >bash-4.1# cd soft_bak</font></span></div><div><font size="2"   >bash-4.1#&nbsp;wget http://ftp.postgresql.org/pub/source/v9.3.5/postgresql-9.3.5.tar.bz2</font></div><div><font size="2"   >bash-4.1# tar -jxvf&nbsp;<span style="line-height: 28px;"   >postgresql-9.3.5.tar.bz2</span></font></div><div><font size="2"   >bash-4.1# cd postgresql-9.3.5</font></div><div><font size="2"   >bash-4.1# ./configure --prefix=/opt/pgsql9.3.5 --with-pgport=5432 --with-perl --with-tcl --with-python --with-openssl --with-pam --with-ldap --with-libxml --with-libxslt --enable-thread-safety</font></div><div><font size="2"   >bash-4.1# gmake world</font></div><div><font size="2"   >bash-4.1# gmake install-world</font></div><div><font size="2"   >bash-4.1# ln -s /opt/pgsql9.3.5 /opt/pgsql</font></div><div><div><font size="2"   >bash-4.1# useradd postgres</font></div><div><font size="2"   >bash-4.1# su - postgres</font></div></div><div><font size="2"   >[postgres@150 ~]$ vi .bash_profile&nbsp;</font></div><div><div><font size="2"   >export PS1="$USER@`/bin/hostname -s`-&gt; "</font></div><div><font size="2"   >export PGPORT=5432</font></div><div><font size="2"   >export PGDATA=/home/postgres/pgdata/pg_root</font></div><div><font size="2"   >export LANG=en_US.utf8</font></div><div><font size="2"   >export PGHOME=/opt/pgsql</font></div><div><font size="2"   >export LD_LIBRARY_PATH=$PGHOME/lib:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib:$LD_LIBRARY_PATH</font></div><div><font size="2"   >export DATE=`date +"%Y%m%d%H%M"`</font></div><div><font size="2"   >export PATH=$PGHOME/bin:$PATH:.</font></div><div><font size="2"   >export MANPATH=$PGHOME/share/man:$MANPATH</font></div><div><font size="2"   >export PGUSER=postgres</font></div><div><font size="2"   >export PGHOST=$PGDATA</font></div><div><font size="2"   >alias rm='rm -i'</font></div><div><font size="2"   >alias ll='ls -lh'</font></div><div><font size="2"   >export PGDATABASE=postgres</font></div></div><div><div><font size="2"   >[postgres@150 ~]$ exit</font></div><div><font size="2"   >logout</font></div><div><font size="2"   >bash-4.1# su - postgres</font></div><div><font size="2"   >postgres@150-&gt;&nbsp;</font></div></div><div><font size="2"   >初始化</font></div><div><font size="2"   >postgres@150-&gt; initdb -D $PGDATA -E UTF8 --locale=C -U postgres -W</font></div><div><div><font size="2"   >postgres@150-&gt; cd $PGDATA</font></div><div><font size="2"   >postgres@150-&gt; vi pg_hba.conf&nbsp;</font></div></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div><div><font size="2"   >postgres@150-&gt; vi postgresql.conf&nbsp;</font></div><div><div><font size="2"   >listen_addresses = '0.0.0.0' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# what IP address(es) to listen on;</font></div><div><font size="2"   >max_connections = 100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >unix_socket_directories = '.' &nbsp; # comma-separated list of directories</font></div><div><font size="2"   >tcp_keepalives_idle = 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPIDLE, in seconds;</font></div><div><font size="2"   >tcp_keepalives_interval = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPINTVL, in seconds;</font></div><div><font size="2"   >tcp_keepalives_count = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # TCP_KEEPCNT;</font></div><div><font size="2"   >shared_buffers = 128MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# min 128kB</font></div><div><font size="2"   >vacuum_cost_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 0-100 milliseconds</font></div><div><font size="2"   >vacuum_cost_limit = 10000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 credits</font></div><div><font size="2"   >bgwriter_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 10-10000ms between rounds</font></div><div><font size="2"   >synchronous_commit = off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# synchronization level;</font></div><div><font size="2"   >checkpoint_segments = 32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# in logfile segments, min 1, 16MB each</font></div><div><font size="2"   >log_destination = 'csvlog' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Valid values are combinations of</font></div><div><font size="2"   >logging_collector = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Enable capturing of stderr and csvlog</font></div><div><font size="2"   >log_truncate_on_rotation = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # If on, an existing log file with the</font></div><div><font size="2"   >log_checkpoints = on</font></div><div><font size="2"   >log_connections = on</font></div><div><font size="2"   >log_disconnections = on</font></div><div><font size="2"   >log_error_verbosity = verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # terse, default, or verbose messages</font></div><div><font size="2"   >log_timezone = 'GB'</font></div><div><font size="2"   >log_autovacuum_min_duration = 0 # -1 disables, 0 logs all actions and</font></div><div><font size="2"   >datestyle = 'iso, mdy'</font></div><div><font size="2"   >timezone = 'GB'</font></div><div><font size="2"   >lc_messages = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for system error message</font></div><div><font size="2"   >lc_monetary = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for monetary formatting</font></div><div><font size="2"   >lc_numeric = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# locale for number formatting</font></div><div><font size="2"   >lc_time = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for time formatting</font></div><div><font size="2"   >default_text_search_config = 'pg_catalog.english'</font></div></div><div><div><font size="2"   >bash-4.1# exit</font></div><div><font size="2"   >exit</font></div></div><p></p></pre></div><div><div><br></div><div><span style="line-height: 28px;"   >&nbsp;</span></div></div><div>制作image</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 28px;"   ><font size="2"   >[root@150 ~]# docker ps -a</font></div><div style="line-height: 28px;"   ><font size="2"   >CONTAINER ID &nbsp; &nbsp; &nbsp; &nbsp;IMAGE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMMAND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STATUS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PORTS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NAMES</font></div><div style="line-height: 28px;"   ><font size="2"   >9241bc14e46b &nbsp; &nbsp; &nbsp; &nbsp;centos:centos6 &nbsp; &nbsp; &nbsp;/bin/bash &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; About an hour ago &nbsp; Exited (0) 3 seconds ago &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clever_mclean &nbsp;</font></div></div><div><div><font size="2"   >[root@150 ~]# docker commit -m="Add postgresql by digoal based on centos:centos6." -a="Digoal Zhou" 9241bc14e46b digoal/pg:9.3.5</font></div><div><font size="2"   >b8a933b7f4d749d547be2b91cf4aaaf4a9d20b89d71c7a8aa73351e22c789afe</font></div></div><div><div><font size="2"   >[root@150 ~]# docker images</font></div><div><font size="2"   >REPOSITORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VIRTUAL SIZE</font></div><div><font size="2"   >digoal/pg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 9.3.5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b8a933b7f4d7 &nbsp; &nbsp; &nbsp; &nbsp;24 seconds ago &nbsp; &nbsp; &nbsp;646.5 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 504a65221a38 &nbsp; &nbsp; &nbsp; &nbsp;3 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 467.1 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 68edf809afe7 &nbsp; &nbsp; &nbsp; &nbsp;3 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 212.7 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 87e5b6b3ccc1 &nbsp; &nbsp; &nbsp; &nbsp;3 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 224 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;87e5b6b3ccc1 &nbsp; &nbsp; &nbsp; &nbsp;3 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 224 MB</font></div></div><p></p></pre></div></div><div><br></div><div>使用刚才制作的image, 启动container</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# docker run -t -i -P --net="host" digoal/pg:9.3.5 /bin/bash</font></div><div><font size="2"   >bash-4.1# su - postgres</font></div><div><font size="2"   >postgres@150-&gt; pg_ctl start</font></div><div><font size="2"   >server starting</font></div><div><font size="2"   >postgres@150-&gt; LOG: &nbsp;00000: redirecting log output to logging collector process</font></div><div><font size="2"   >HINT: &nbsp;Future log output will appear in directory "pg_log".</font></div><div><font size="2"   >LOCATION: &nbsp;SysLogger_Start, syslogger.c:638</font></div><p></p></pre></div><div><br></div><div>在另一个会话可以看到 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# docker ps</font></div><div><font size="2"   >CONTAINER ID &nbsp; &nbsp; &nbsp; &nbsp;IMAGE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMMAND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STATUS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PORTS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NAMES</font></div><div><font size="2"   >56b7e3e8ba0e &nbsp; &nbsp; &nbsp; &nbsp;digoal/pg:9.3.5 &nbsp; &nbsp; /bin/bash &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 26 seconds ago &nbsp; &nbsp; &nbsp;Up 25 seconds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hopeful_blackwell &nbsp;</font></div><p></p></pre></div><div><br></div><div>端口没有映射出来, 因为centos:centos6这个image没有启用网络.</div><div>所以如果需要网络的话需要使用Dockerfile来制作image.</div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://docs.docker.com/userguide/dockerimages/"   >http://docs.docker.com/userguide/dockerimages/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201482910531328/"   >http://blog.163.com/digoal@126/blog/static/163877040201482910531328/</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="create docker image 1 -  use other images - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>