<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">python function args diff between mutable object and immutable object</h2>
	<h5 id="">2014-10-16 10:04:42&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020149155448390/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div><div>python 函数参数使用注意, 在调用函数时, 传入的参数是值的reference, 而不是值的拷贝.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >The actual parameters (arguments) to a function call are introduced in the local symbol table of the called function when it is called; thus, arguments are passed using call by value (where the value is always an object reference, not the value of the object). [1] When a function calls another function, a new local symbol table is created for that call.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Footnotes</font></div><div><font size="2"   >[1]<span>	</span>Actually, call by object reference would be a better description, since if a mutable object is passed, the caller will see any changes the callee makes to it (items inserted into a list).</font></div><p></p></pre></div></div><div><br></div><div>在使用参数默认值时, 也需要注意这一点, 因为初始化值仅仅在创建函数时评估一次默认值.</div><div><pre class="prettyprint"   ><p><font size="2"   >Important warning: The default value is evaluated only once. This makes a difference when the default is a mutable object such as a list, dictionary, or instances of most classes.&nbsp;</font></p></pre></div><div>所以immutable对象和mutable对象是有差别的.</div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt;&gt;&gt; def f1(a, L=[]):</font></div><div><font size="2"   >... &nbsp; L.append(a)</font></div><div><font size="2"   >... &nbsp; return L</font></div><div><font size="2"   >...&nbsp;</font></div><div><font size="2"   >&gt;&gt;&gt; f1(1)</font></div><div><font size="2"   >[1]</font></div><div><font size="2"   >&gt;&gt;&gt; f1(2)</font></div><div><font size="2"   >[1, 2]</font></div><p></p></pre></div></div><div>上面这个例子可以看到L=[]默认值只初始化一次. 并且list是mutable值, 所以会反映出它的变化.</div><div><br></div><div>如果初始值是immutable类型的, 那么它的值不会变化, 所以可以通过以下方法来防止以上问题.</div><div>注意L依旧只初始化一次, 因为它是immutable对象, 所以一直都是None的.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt;&gt;&gt; def f(a, L=None):</font></div><div><font size="2"   >... &nbsp; if L is None:</font></div><div><font size="2"   >... &nbsp; &nbsp; L = []</font></div><div><font size="2"   >... &nbsp; L.append(a)</font></div><div><font size="2"   >... &nbsp; return L</font></div><div><font size="2"   >...&nbsp;</font></div><div><font size="2"   >&gt;&gt;&gt; f(1)</font></div><div><font size="2"   >[1]</font></div><div><font size="2"   >&gt;&gt;&gt; f(2)</font></div><div><font size="2"   >[2]</font></div><div><font size="2"   >&gt;&gt;&gt; f(3)</font></div><div><font size="2"   >[3]</font></div><p></p></pre></div><div><br></div><div>使用其他immutable类型也一样可以解决这个问题, 例如int类型.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt;&gt;&gt; def f2(a, L=1):</font></div><div><font size="2"   >... &nbsp; if L == 1:</font></div><div><font size="2"   >... &nbsp; &nbsp; L = []</font></div><div><font size="2"   >... &nbsp; L.append(a)</font></div><div><font size="2"   >... &nbsp; return L</font></div><div><font size="2"   >...&nbsp;</font></div><div><font size="2"   >&gt;&gt;&gt; f2(1)</font></div><div><font size="2"   >[1]</font></div><div><font size="2"   >&gt;&gt;&gt; f2(2)</font></div><div><font size="2"   >[2]</font></div><div><font size="2"   >&gt;&gt;&gt; f2(3)</font></div><div><font size="2"   >[3]</font></div><p></p></pre></div><div><br></div><div>下面我们定义一个mutable 类型, 以该类型传递给f, f1, f2函数, 我们发现, 所有的函数都会对l的值进行修改.</div><div>这也印证了python手册里说的, 函数参数传递的是reference.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&gt;&gt;&gt; l=[100]</font></div><div><font size="2"   >&gt;&gt;&gt; f(1,l)</font></div><div><font size="2"   >[100, 1]</font></div><div><font size="2"   >&gt;&gt;&gt; f(1,l)</font></div><div><font size="2"   >[100, 1, 1]</font></div><div><font size="2"   >&gt;&gt;&gt; f(1,l)</font></div><div><font size="2"   >[100, 1, 1, 1]</font></div><div><font size="2"   >&gt;&gt;&gt; print(l)</font></div><div><font size="2"   >[100, 1, 1, 1]</font></div><div><font size="2"   >&gt;&gt;&gt; f2(1,l)</font></div><div><font size="2"   >[100, 1, 1, 1, 1]</font></div><div><font size="2"   >&gt;&gt;&gt; f2(1,l)</font></div><div><font size="2"   >[100, 1, 1, 1, 1, 1]</font></div><div><font size="2"   >&gt;&gt;&gt; f2(3,l)</font></div><div><font size="2"   >[100, 1, 1, 1, 1, 1, 3]</font></div><div><font size="2"   >&gt;&gt;&gt; f2(4,l)</font></div><div><font size="2"   >[100, 1, 1, 1, 1, 1, 3, 4]</font></div><div><font size="2"   >&gt;&gt;&gt; print(l)</font></div><div><font size="2"   >[100, 1, 1, 1, 1, 1, 3, 4]</font></div></div><div><div><font size="2"   >&gt;&gt;&gt; f1(4,l)</font></div><div><font size="2"   >[100, 1, 1, 1, 1, 1, 3, 4, 4]</font></div><div><font size="2"   >&gt;&gt;&gt; print(l)</font></div><div><font size="2"   >[100, 1, 1, 1, 1, 1, 3, 4, 4]</font></div></div><p></p></pre></div><div><br></div><wbr><div><br></div>[参考]<div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://docs.python.org/3.3/tutorial/controlflow.html#more-on-defining-functions"   >https://docs.python.org/3.3/tutorial/controlflow.html#more-on-defining-functions</a></div><div><h3 style="font-family: 'Lucida Grande', Arial, sans-serif; font-weight: normal; color: rgb(26, 26, 26); border: 0px; margin: 0px; padding: 0.3em 0px; font-size: 22px; line-height: normal;"   >4.7.1. Default Argument Values<a title="Permalink to this headline" style="color: rgb(48, 48, 111); text-decoration: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;" rel="nofollow" href="https://docs.python.org/3.3/tutorial/controlflow.html#default-argument-values"   ></a></h3><p style="text-align: justify; line-height: 22.3999996185303px; color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif;"   >The most useful form is to specify a default value for one or more arguments. This creates a function that can be called with fewer arguments than it is defined to allow. For example:</p><div style="color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif; line-height: normal;position:inherit;"   ><div style="background: rgb(238, 255, 204);"   ><pre style="overflow-x: auto; overflow-y: hidden; padding: 5px; color: rgb(51, 51, 51); line-height: 18.5279998779297px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"   ><span style="color: rgb(0, 112, 32); font-weight: bold;"   >def</span> <span style="color: rgb(6, 40, 126);"   >ask_ok</span><span>(</span><span>prompt</span><span>,</span> <span>retries</span><span style="color: rgb(102, 102, 102);"   >=</span><span style="color: rgb(32, 128, 80);"   >4</span><span>,</span> <span>complaint</span><span style="color: rgb(102, 102, 102);"   >=</span><span style="color: rgb(64, 112, 160);"   >'Yes or no, please!'</span><span>):</span>
    <span style="color: rgb(0, 112, 32); font-weight: bold;"   >while</span> <span style="color: rgb(0, 112, 32); font-weight: bold;"   >True</span><span>:</span>
        <span>ok</span> <span style="color: rgb(102, 102, 102);"   >=</span> <span style="color: rgb(0, 112, 32);"   >input</span><span>(</span><span>prompt</span><span>)</span>
        <span style="color: rgb(0, 112, 32); font-weight: bold;"   >if</span> <span>ok</span> <span style="color: rgb(0, 112, 32); font-weight: bold;"   >in</span> <span>(</span><span style="color: rgb(64, 112, 160);"   >'y'</span><span>,</span> <span style="color: rgb(64, 112, 160);"   >'ye'</span><span>,</span> <span style="color: rgb(64, 112, 160);"   >'yes'</span><span>):</span>
            <span style="color: rgb(0, 112, 32); font-weight: bold;"   >return</span> <span style="color: rgb(0, 112, 32); font-weight: bold;"   >True</span>
        <span style="color: rgb(0, 112, 32); font-weight: bold;"   >if</span> <span>ok</span> <span style="color: rgb(0, 112, 32); font-weight: bold;"   >in</span> <span>(</span><span style="color: rgb(64, 112, 160);"   >'n'</span><span>,</span> <span style="color: rgb(64, 112, 160);"   >'no'</span><span>,</span> <span style="color: rgb(64, 112, 160);"   >'nop'</span><span>,</span> <span style="color: rgb(64, 112, 160);"   >'nope'</span><span>):</span>
            <span style="color: rgb(0, 112, 32); font-weight: bold;"   >return</span> <span style="color: rgb(0, 112, 32); font-weight: bold;"   >False</span>
        <span>retries</span> <span style="color: rgb(102, 102, 102);"   >=</span> <span>retries</span> <span style="color: rgb(102, 102, 102);"   >-</span> <span style="color: rgb(32, 128, 80);"   >1</span>
        <span style="color: rgb(0, 112, 32); font-weight: bold;"   >if</span> <span>retries</span> <span style="color: rgb(102, 102, 102);"   >&lt;</span> <span style="color: rgb(32, 128, 80);"   >0</span><span>:</span>
            <span style="color: rgb(0, 112, 32); font-weight: bold;"   >raise</span> <span style="color: rgb(0, 112, 32);"   >IOError</span><span>(</span><span style="color: rgb(64, 112, 160);"   >'uncooperative user'</span><span>)</span>
        <span style="color: rgb(0, 112, 32);"   >print</span><span>(</span><span>complaint</span><span>)</span>
</pre></div></div><p style="text-align: justify; line-height: 22.3999996185303px; color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif;"   >This function can be called in several ways:</p><ul style="color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif; line-height: normal;"   ><li style="text-align: justify; line-height: 20.7999992370605px;"   >giving only the mandatory argument:&nbsp;<tt style="padding: 0px 1px; font-size: 15px; font-family: monospace, sans-serif; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(236, 240, 243);"   ><span>ask_ok('Do</span>&nbsp;<span>you</span>&nbsp;<span>really</span>&nbsp;<span>want</span>&nbsp;<span>to</span>&nbsp;<span>quit?')</span></tt></li><li style="text-align: justify; line-height: 20.7999992370605px;"   >giving one of the optional arguments:&nbsp;<tt style="padding: 0px 1px; font-size: 15px; font-family: monospace, sans-serif; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(236, 240, 243);"   ><span>ask_ok('OK</span>&nbsp;<span>to</span>&nbsp;<span>overwrite</span>&nbsp;<span>the</span>&nbsp;<span>file?',</span>&nbsp;<span>2)</span></tt></li><li style="text-align: justify; line-height: 20.7999992370605px;"   >or even giving all arguments:&nbsp;<tt style="padding: 0px 1px; font-size: 15px; font-family: monospace, sans-serif; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(236, 240, 243);"   ><span>ask_ok('OK</span>&nbsp;<span>to</span>&nbsp;<span>overwrite</span>&nbsp;<span>the</span>&nbsp;<span>file?',</span>&nbsp;<span>2,</span>&nbsp;<span>'Come</span>&nbsp;<span>on,</span>&nbsp;<span>only</span>&nbsp;<span>yes</span>&nbsp;<span>or</span>&nbsp;<span>no!')</span></tt></li></ul><p style="text-align: justify; line-height: 22.3999996185303px; color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif;"   >This example also introduces the&nbsp;<a style="color: rgb(48, 48, 111); text-decoration: none;" rel="nofollow" href="https://docs.python.org/3.3/reference/expressions.html#in"   ><tt style="padding: 0px 1px; font-size: 15px; font-family: monospace, sans-serif; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: transparent;"   ><span>in</span></tt></a>&nbsp;keyword. This tests whether or not a sequence contains a certain value.</p><p style="text-align: justify; line-height: 22.3999996185303px; color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif;"   >The default values are evaluated at the point of function definition in the&nbsp;<em>defining</em>&nbsp;scope, so that</p><div style="color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif; line-height: normal;position:inherit;"   ><div style="background: rgb(238, 255, 204);"   ><pre style="overflow-x: auto; overflow-y: hidden; padding: 5px; color: rgb(51, 51, 51); line-height: 18.5279998779297px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"   ><span>i</span> <span style="color: rgb(102, 102, 102);"   >=</span> <span style="color: rgb(32, 128, 80);"   >5</span>

<span style="color: rgb(0, 112, 32); font-weight: bold;"   >def</span> <span style="color: rgb(6, 40, 126);"   >f</span><span>(</span><span>arg</span><span style="color: rgb(102, 102, 102);"   >=</span><span>i</span><span>):</span>
    <span style="color: rgb(0, 112, 32);"   >print</span><span>(</span><span>arg</span><span>)</span>

<span>i</span> <span style="color: rgb(102, 102, 102);"   >=</span> <span style="color: rgb(32, 128, 80);"   >6</span>
<span>f</span><span>()</span>
</pre></div></div><p style="text-align: justify; line-height: 22.3999996185303px; color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif;"   >will print&nbsp;<tt style="padding: 0px 1px; font-size: 15px; font-family: monospace, sans-serif; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgb(236, 240, 243);"   ><span>5</span></tt>.</p><p style="text-align: justify; line-height: 22.3999996185303px; color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif;"   ><strong>Important warning:</strong>&nbsp;The default value is evaluated only once. This makes a difference when the default is a mutable object such as a list, dictionary, or instances of most classes. For example, the following function accumulates the arguments passed to it on subsequent calls:</p><div style="color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif; line-height: normal;position:inherit;"   ><div style="background: rgb(238, 255, 204);"   ><pre style="overflow-x: auto; overflow-y: hidden; padding: 5px; color: rgb(51, 51, 51); line-height: 18.5279998779297px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"   ><span style="color: rgb(0, 112, 32); font-weight: bold;"   >def</span> <span style="color: rgb(6, 40, 126);"   >f</span><span>(</span><span>a</span><span>,</span> <span>L</span><span style="color: rgb(102, 102, 102);"   >=</span><span>[]):</span>
    <span>L</span><span style="color: rgb(102, 102, 102);"   >.</span><span>append</span><span>(</span><span>a</span><span>)</span>
    <span style="color: rgb(0, 112, 32); font-weight: bold;"   >return</span> <span>L</span>

<span style="color: rgb(0, 112, 32);"   >print</span><span>(</span><span>f</span><span>(</span><span style="color: rgb(32, 128, 80);"   >1</span><span>))</span>
<span style="color: rgb(0, 112, 32);"   >print</span><span>(</span><span>f</span><span>(</span><span style="color: rgb(32, 128, 80);"   >2</span><span>))</span>
<span style="color: rgb(0, 112, 32);"   >print</span><span>(</span><span>f</span><span>(</span><span style="color: rgb(32, 128, 80);"   >3</span><span>))</span>
</pre></div></div><p style="text-align: justify; line-height: 22.3999996185303px; color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif;"   >This will print</p><div style="color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif; line-height: normal;position:inherit;"   ><div style="background: rgb(238, 255, 204);"   ><pre style="overflow-x: auto; overflow-y: hidden; padding: 5px; color: rgb(51, 51, 51); line-height: 18.5279998779297px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"   ><span>[</span><span style="color: rgb(32, 128, 80);"   >1</span><span>]</span>
<span>[</span><span style="color: rgb(32, 128, 80);"   >1</span><span>,</span> <span style="color: rgb(32, 128, 80);"   >2</span><span>]</span>
<span>[</span><span style="color: rgb(32, 128, 80);"   >1</span><span>,</span> <span style="color: rgb(32, 128, 80);"   >2</span><span>,</span> <span style="color: rgb(32, 128, 80);"   >3</span><span>]</span>
</pre></div></div><p style="text-align: justify; line-height: 22.3999996185303px; color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif;"   >If you don’t want the default to be shared between subsequent calls, you can write the function like this instead:</p><div style="color: rgb(34, 34, 34); font-family: 'Lucida Grande', Arial, sans-serif; line-height: normal;position:inherit;"   ><div style="background: rgb(238, 255, 204);"   ><pre style="overflow-x: auto; overflow-y: hidden; padding: 5px; color: rgb(51, 51, 51); line-height: 18.5279998779297px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"   ><span style="color: rgb(0, 112, 32); font-weight: bold;"   >def</span> <span style="color: rgb(6, 40, 126);"   >f</span><span>(</span><span>a</span><span>,</span> <span>L</span><span style="color: rgb(102, 102, 102);"   >=</span><span style="color: rgb(0, 112, 32); font-weight: bold;"   >None</span><span>):</span>
    <span style="color: rgb(0, 112, 32); font-weight: bold;"   >if</span> <span>L</span> <span style="color: rgb(0, 112, 32); font-weight: bold;"   >is</span> <span style="color: rgb(0, 112, 32); font-weight: bold;"   >None</span><span>:</span>
        <span>L</span> <span style="color: rgb(102, 102, 102);"   >=</span> <span>[]</span>
    <span>L</span><span style="color: rgb(102, 102, 102);"   >.</span><span>append</span><span>(</span><span>a</span><span>)</span>
    <span style="color: rgb(0, 112, 32); font-weight: bold;"   >return</span> <span>L</span></pre></div></div></div><div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="2014年10月15日 - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a><br></div></div>
	</div>
</div>
</body>
</html>