<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Docker Container Linking</h2>
	<h5 id="">2014-10-27 11:32:41&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201492710339762/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>前面有一篇关于docker 通过DNAT将container的端口映射出来的效率问题.</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201492315242694/"   >http://blog.163.com/digoal@126/blog/static/163877040201492315242694/</a></div><div><span style="line-height: 28px;"   >本文将讲一下container之间的通讯方法, 除了使用-p或-P将端口映射出来, 还可以使用--link, 连接多个container.</span></div><div>(--link 其实也是通过IP通讯的(通过虚拟网桥管理, 或者使用openvswitch), 只是docker会自动维护一些变量和主机名, 方便使用者使用)</div><div><br></div><div>以一个例子来讲解 :&nbsp;</div><div><br></div><div>首先启动一个container, 注意我们这里没有使用--name指定名字. 也没有使用-p或-P做DNAT映射.</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ~]# docker run -d postgres:9.3.5</font></div><div><font size="2"   >64366c42153653adf595242b1f36dca189ea671aed24a3d642bf104a49b7359d</font></div><div><font size="2"   >[root@db-172-16-3-221 ~]# docker ps</font></div><div><font size="2"   >CONTAINER ID &nbsp; &nbsp; &nbsp; &nbsp;IMAGE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMMAND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STATUS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PORTS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NAMES</font></div><div><font size="2"   >64366c421536 &nbsp; &nbsp; &nbsp; &nbsp;postgres:9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/docker-entrypoint.s &nbsp; 2 seconds ago &nbsp; &nbsp; &nbsp; Up 1 seconds &nbsp; &nbsp; &nbsp; &nbsp;5432/tcp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dreamy_ptolemy&nbsp;</font></div><p></p></pre></div><div>查看这个container的网络 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ~]# docker inspect 64366c421536</font></div><div><font size="2"   >[{</font></div><div><font size="2"   >&nbsp; &nbsp; "Args": [</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "postgres"</font></div><div><font size="2"   >&nbsp; &nbsp; ],</font></div><div><font size="2"   >&nbsp; &nbsp; "Config": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "AttachStderr": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "AttachStdin": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "AttachStdout": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Cmd": [</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "postgres"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ],</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "CpuShares": 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Cpuset": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Domainname": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Entrypoint": [</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "/docker-entrypoint.sh"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ],</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Env": [</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "PATH=/usr/lib/postgresql/9.3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "LANG=en_US.utf8",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "PG_MAJOR=9.3",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "PG_VERSION=9.3.5-1.pgdg70+1",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "PGDATA=/var/lib/postgresql/data"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ],</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "ExposedPorts": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "5432/tcp": {}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Hostname": "64366c421536",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Image": "postgres:9.3.5",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Memory": 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "MemorySwap": 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "NetworkDisabled": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "OnBuild": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "OpenStdin": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "PortSpecs": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "StdinOnce": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Tty": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "User": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Volumes": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "/var/lib/postgresql/data": {}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "WorkingDir": ""</font></div><div><font size="2"   >&nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; "Created": "2014-10-27T02:26:37.738875408Z",</font></div><div><font size="2"   >&nbsp; &nbsp; "Driver": "devicemapper",</font></div><div><font size="2"   >&nbsp; &nbsp; "ExecDriver": "native-0.2",</font></div><div><font size="2"   >&nbsp; &nbsp; "HostConfig": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Binds": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "ContainerIDFile": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Dns": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "DnsSearch": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Links": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "LxcConf": [],</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "NetworkMode": "bridge",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "PortBindings": {},</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Privileged": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "PublishAllPorts": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "VolumesFrom": null</font></div><div><font size="2"   >&nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; "HostnamePath": "/var/lib/docker/containers/64366c42153653adf595242b1f36dca189ea671aed24a3d642bf104a49b7359d/hostname",</font></div><div><font size="2"   >&nbsp; &nbsp; "HostsPath": "/var/lib/docker/containers/64366c42153653adf595242b1f36dca189ea671aed24a3d642bf104a49b7359d/hosts",</font></div><div><font size="2"   >&nbsp; &nbsp; "Id": "64366c42153653adf595242b1f36dca189ea671aed24a3d642bf104a49b7359d",</font></div><div><font size="2"   >&nbsp; &nbsp; "Image": "935836384c524aafc0ac1c05246002c9c93343f0b4283a34e77a5f92f97f9a7c",</font></div><div><font size="2"   >&nbsp; &nbsp; "MountLabel": "",</font></div><div><font size="2"   >&nbsp; &nbsp; "Name": "/dreamy_ptolemy",</font></div><div><font size="2"   >&nbsp; &nbsp; "NetworkSettings": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Bridge": "docker0",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Gateway": "172.17.42.1",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "IPAddress": "172.17.0.13",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "IPPrefixLen": 16,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "PortMapping": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Ports": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "5432/tcp": null</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; "Path": "/docker-entrypoint.sh",</font></div><div><font size="2"   >&nbsp; &nbsp; "ProcessLabel": "",</font></div><div><font size="2"   >&nbsp; &nbsp; "ResolvConfPath": "/etc/resolv.conf",</font></div><div><font size="2"   >&nbsp; &nbsp; "State": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "ExitCode": 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "FinishedAt": "0001-01-01T00:00:00Z",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Paused": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Pid": 8584,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Running": true,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "StartedAt": "2014-10-27T02:26:38.525831218Z"</font></div><div><font size="2"   >&nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; "Volumes": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "/var/lib/postgresql/data": "/var/lib/docker/vfs/dir/52a3cbd99e3462e1fd8593d086d82bd86afa94c435ec0bc141872f7f5507144a"</font></div><div><font size="2"   >&nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; "VolumesRW": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "/var/lib/postgresql/data": true</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   >}</font></div><p></p></pre></div></div><div><br></div><div>在宿主机通过网络可以连接到container.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-221 ~]# ping 172.17.0.13</font></div><div><font size="2"   >PING 172.17.0.13 (172.17.0.13) 56(84) bytes of data.</font></div><div><font size="2"   >64 bytes from 172.17.0.13: icmp_seq=1 ttl=64 time=1.10 ms</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@db-172-16-3-221 ~]# telnet 172.17.0.13 5432</font></div><div><font size="2"   >Trying 172.17.0.13...</font></div><div><font size="2"   >Connected to 172.17.0.13.</font></div><div><font size="2"   >Escape character is '^]'.</font></div><div><font size="2"   >quit</font></div><div><font size="2"   >Connection closed by foreign host.</font></div></div><p></p></pre></div><div><br></div><div>接下来启动另一个container, 使用--link来建立链接. 格式 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >--link 源container_name:源container_alias</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@db-172-16-3-221 ~]# docker run -t -i --link dreamy_ptolemy:db1 postgres:9.3.5 /bin/bash</font></div><div><font size="2"   >root@3e76ddd8025c:/# ping 172.17.0.13</font></div><div><font size="2"   >PING 172.17.0.13 (172.17.0.13): 48 data bytes</font></div><div><font size="2"   >56 bytes from 172.17.0.13: icmp_seq=0 ttl=64 time=1.428 ms</font></div></div><p></p></pre></div><div><br></div><div>在建立完连接后, 在当前的container可以看到两个变化,&nbsp;</div><div>1. /etc/hosts</div><div>2. env</div><div><br></div><div>1. 自动在/etc/hosts中建立源container的条目, 主机名即alias.</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >172.17.0.13 &nbsp; &nbsp; db1</font></span></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >root@3e76ddd8025c:/# cat /etc/hosts</font></div><div><font size="2"   >172.17.0.14 &nbsp; &nbsp; 3e76ddd8025c</font></div><div><font size="2"   >127.0.0.1 &nbsp; &nbsp; &nbsp; localhost</font></div><div><font size="2"   >::1 &nbsp; &nbsp; localhost ip6-localhost ip6-loopback</font></div><div><font size="2"   >fe00::0 ip6-localnet</font></div><div><font size="2"   >ff00::0 ip6-mcastprefix</font></div><div><font size="2"   >ff02::1 ip6-allnodes</font></div><div><font size="2"   >ff02::2 ip6-allrouters</font></div><div><font size="2"   >172.17.0.13 &nbsp; &nbsp; db1</font></div></div><p></p></pre></div><div><div><br></div><div>2. 另外会自动创建环境变量 :&nbsp;</div><div>以alias_开头的一些环境变量 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&lt;name&gt;_PORT_&lt;port&gt;_&lt;protocol&gt; will contain a URL reference to the port. Where &lt;name&gt; is the alias name specified in the --link parameter (e.g. webdb), &lt;port&gt; is the port number being exposed, and &lt;protocol&gt; is either TCP or UDP. The format of the URL will be: &lt;protocol&gt;://&lt;container_ip_address&gt;:&lt;port&gt; (e.g. tcp://172.17.0.82:8080). This URL will then be split into the following 3 environment variables for convinience:</font></div><div><font size="2"   >&lt;name&gt;_PORT_&lt;port&gt;_&lt;protocol&gt;_ADDR will contain just the IP address from the URL (e.g. WEBDB_PORT_8080_TCP_ADDR=172.17.0.82).</font></div><div><font size="2"   >&lt;name&gt;_PORT_&lt;port&gt;_&lt;protocol&gt;_PORT will contain just the port number from the URL (e.g. WEBDB_PORT_8080_TCP_PORT=8080).</font></div><div><font size="2"   >&lt;name&gt;_PORT_&lt;port&gt;_&lt;protocol&gt;_PROTO will contain just the protocol from the URL (e.g. WEBDB_PORT_8080_TCP_PROTO=tcp).</font></div><p></p></pre></div><div>例如 :&nbsp;</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >DB1_NAME=/nostalgic_mclean/db1</font></span></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >DB1_PORT=tcp://172.17.0.13:5432</font></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >DB1_PORT_5432_TCP=tcp://172.17.0.13:5432</font></span></div></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >DB1_PORT_5432_TCP_PROTO=tcp</font></span></div><div style="line-height: 28px;"   ><font size="2"   >DB1_PORT_5432_TCP_ADDR=172.17.0.13</font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >DB1_PORT_5432_TCP_PORT=5432</font></div></div></div></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >DB1_ENV_PGDATA=/var/lib/postgresql/data</font></span></div><div style="line-height: 28px;"   ><font size="2"   >DB1_ENV_LANG=en_US.utf8</font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >DB1_ENV_PG_VERSION=9.3.5-1.pgdg70+1</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >DB1_ENV_PG_MAJOR=9.3</font></span></div></div><p></p></pre></div><div style="line-height: 28px;"   ><br></div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@3e76ddd8025c:/# env</font></div><div><font size="2"   >HOSTNAME=3e76ddd8025c</font></div><div><font size="2"   >DB1_ENV_PG_VERSION=9.3.5-1.pgdg70+1</font></div><div><font size="2"   >TERM=xterm</font></div><div><font size="2"   >DB1_ENV_PG_MAJOR=9.3</font></div><div><font size="2"   >DB1_PORT_5432_TCP_PORT=5432</font></div><div><font size="2"   >PG_MAJOR=9.3</font></div><div><font size="2"   >DB1_PORT_5432_TCP=tcp://172.17.0.13:5432</font></div><div><font size="2"   >DB1_PORT_5432_TCP_ADDR=172.17.0.13</font></div><div><font size="2"   >PATH=/usr/lib/postgresql/9.3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</font></div><div><font size="2"   >DB1_ENV_PGDATA=/var/lib/postgresql/data</font></div><div><font size="2"   >DB1_ENV_LANG=en_US.utf8</font></div><div><font size="2"   >PWD=/</font></div><div><font size="2"   >LANG=en_US.utf8</font></div><div><font size="2"   >HOME=/</font></div><div><font size="2"   >SHLVL=1</font></div><div><font size="2"   >PG_VERSION=9.3.5-1.pgdg70+1</font></div><div><font size="2"   >DB1_PORT=tcp://172.17.0.13:5432</font></div><div><font size="2"   >PGDATA=/var/lib/postgresql/data</font></div><div><font size="2"   >DB1_PORT_5432_TCP_PROTO=tcp</font></div><div><font size="2"   >DB1_NAME=/nostalgic_mclean/db1</font></div><div><font size="2"   >_=/usr/bin/env</font></div><p></p></pre></div><div><br></div><div>其实--link主要的好处是维护了一个unique alias, 在container中连其他container, 使用alias即可, 而不需要知道IP是多少.</div><div>例如 : ping --link指定的alias即可.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >root@3e76ddd8025c:/# ping db1</font></div><div><font size="2"   >PING db1 (172.17.0.13): 48 data bytes</font></div><div><font size="2"   >56 bytes from 172.17.0.13: icmp_seq=0 ttl=64 time=0.069 ms</font></div><div><font size="2"   >56 bytes from 172.17.0.13: icmp_seq=1 ttl=64 time=0.076 ms</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >root@3e76ddd8025c:/# psql -h db1 -p 5432 -U postgres postgres</font></div><div><font size="2"   >psql (9.3.5)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >postgres=# \q</font></div></div><p></p></pre></div></div><div>测试一下在一个container中使用pgbench测试另一个container的数据库.</div><div>和在宿主机测试效率差不多.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@3e76ddd8025c:/# echo "select 1;" &gt;./test.sql</font></div><div><font size="2"   >root@3e76ddd8025c:/# pgbench -M prepared -n -r -f ./test.sql -h db1 -p 5432 -U postgres -c 16 -j 4 -T 30 postgres</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 16</font></div><div><font size="2"   >number of threads: 4</font></div><div><font size="2"   >duration: 30 s</font></div><div><font size="2"   >number of transactions actually processed: 4528033</font></div><div><font size="2"   >tps = 150932.697607 (including connections establishing)</font></div><div><font size="2"   >tps = 151004.884662 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.104734 &nbsp; &nbsp; &nbsp; &nbsp;select 1;</font></div><p></p></pre></div><div><br></div><div>查看当前宿主机的iptables条目.</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ~]# iptables-save</font></div><div><font size="2"   ># Generated by iptables-save v1.4.7 on Mon Oct 27 10:45:13 2014</font></div><div><font size="2"   >*filter</font></div><div><font size="2"   >:INPUT ACCEPT [0:0]</font></div><div><font size="2"   >:FORWARD ACCEPT [0:0]</font></div><div><font size="2"   >:OUTPUT ACCEPT [1683:453100]</font></div><div><font size="2"   >-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A INPUT -p icmp -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A INPUT -i lo -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A INPUT -s 192.168.0.0/16 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A INPUT -s 10.0.0.0/8 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A INPUT -s 172.16.0.0/16 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A INPUT -j REJECT --reject-with icmp-host-prohibited&nbsp;</font></div><div><font size="2"   >-A FORWARD -s 172.17.0.13/32 -d 172.17.0.14/32 -i docker0 -o docker0 -p tcp -m tcp --sport 5432 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A FORWARD -s 172.17.0.14/32 -d 172.17.0.13/32 -i docker0 -o docker0 -p tcp -m tcp --dport 5432 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A FORWARD -i docker0 ! -o docker0 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A FORWARD -i docker0 -o docker0 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A FORWARD -i docker0 ! -o docker0 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A FORWARD -i docker0 -o docker0 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A FORWARD -j REJECT --reject-with icmp-host-prohibited&nbsp;</font></div><div><font size="2"   >COMMIT</font></div><div><font size="2"   ># Completed on Mon Oct 27 10:45:13 2014</font></div><div><font size="2"   ># Generated by iptables-save v1.4.7 on Mon Oct 27 10:45:13 2014</font></div><div><font size="2"   >*nat</font></div><div><font size="2"   >:PREROUTING ACCEPT [543:173998]</font></div><div><font size="2"   >:POSTROUTING ACCEPT [472:24624]</font></div><div><font size="2"   >:OUTPUT ACCEPT [276:14384]</font></div><div><font size="2"   >:DOCKER - [0:0]</font></div><div><font size="2"   >-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER&nbsp;</font></div><div><font size="2"   >-A POSTROUTING -s 172.17.0.0/16 ! -d 172.17.0.0/16 -j MASQUERADE&nbsp;</font></div><div><font size="2"   >-A POSTROUTING -s 172.17.0.0/16 ! -d 172.17.0.0/16 -j MASQUERADE&nbsp;</font></div><div><font size="2"   >-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER&nbsp;</font></div><div><font size="2"   >COMMIT</font></div><div><font size="2"   ># Completed on Mon Oct 27 10:45:13 2014</font></div><p></p></pre></div><div><br></div><div>网桥信息 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ~]# brctl show</font></div><div><font size="2"   >bridge name &nbsp; &nbsp; bridge id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STP enabled &nbsp; &nbsp; interfaces</font></div><div><font size="2"   >docker0 &nbsp; &nbsp; &nbsp; &nbsp; 8000.12551bd59cad &nbsp; &nbsp; &nbsp; no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;veth6cb1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vetha6e7</font></div><p></p></pre></div></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://docs.docker.com/userguide/dockerlinks/"   >https://docs.docker.com/userguide/dockerlinks/</a></div><div>2. man docker-run</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-P, &nbsp;-publish-all=true|false When set to true publish all exposed ports to the host interfaces. &nbsp;The default is</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;false. &nbsp;If the operator uses -P (or -p) then Docker will make the exposed port accessible on the host &nbsp;and &nbsp;the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;ports &nbsp;will be available to any client that can reach the host. &nbsp;To find the map between the host ports and the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;exposed ports, use docker port.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-p, -publish=[] Publish a container's port to the host (format: ip:hostPort:containerPort | ip::containerPort |</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;hostPort:containerPort) (use docker port to see the actual mapping)</font></div><p></p></pre></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201492315242694/"   >http://blog.163.com/digoal@126/blog/static/163877040201492315242694/</a></div><div><br></div><div><a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Docker Container Linking - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a><br></div></div>
	</div>
</div>
</body>
</html>