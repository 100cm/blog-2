<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Linux I/O Scheduler</h2>
	<h5 id="">2011-10-24 8:35:37&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201192483154563/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>RHEL 支持的I/O调度算法:</div><div><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  >deadline - Deadline I/O scheduler<br style="line-height: 23px;"  >as - Anticipatory I/O scheduler<br style="line-height: 23px;"  >cfq - Complete Fair Queuing scheduler<br style="line-height: 23px;"  >noop - Noop I/O scheduler</span></div><div><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  >查看当前的设备使用的调度算法:</span></div><div><div style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  >[root@db-digoal ~]# cat /sys/block/sdb/queue/scheduler&nbsp;</div><div style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  >noop anticipatory [deadline] cfq&nbsp;</div><div style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  >表示当前使用的deadline.</div><div style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  >红帽RHEL5默认使用cfq算法，但是这个算法可能会引发一些BUG。如</div><div style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  ><div>INFO: task pdflush:502 blocked for more than 120 seconds.</div><div>"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</div><div>pdflush &nbsp; &nbsp; &nbsp; D ffff81000100baa0 &nbsp; &nbsp; 0 &nbsp; 502 &nbsp; &nbsp;235 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 504 &nbsp; 501 (L-TLB)</div><div>&nbsp;ffff81033f69f740 0000000000000046 000000105f5d63c0 0000000000011200</div><div>&nbsp;ffff81063ab7ff40 000000000000000a ffff81063fb867e0 ffff81010b7d2100</div><div>&nbsp;000583692242e050 000000000000abd2 ffff81063fb869c8 0000000300000001</div><div>Call Trace:</div><div>&nbsp;[&lt;ffffffff8848e782&gt;] :jbd2:do_get_write_access+0x204/0x404</div><div>&nbsp;[&lt;ffffffff800a28e2&gt;] wake_bit_function+0x0/0x23</div><div>&nbsp;[&lt;ffffffff8848e9a4&gt;] :jbd2:jbd2_journal_get_write_access+0x22/0x33</div><div>&nbsp;[&lt;ffffffff884c20d0&gt;] :ext4:__ext4_journal_get_write_access+0x45/0x55</div><div>&nbsp;[&lt;ffffffff884c943e&gt;] :ext4:ext4_mb_mark_diskspace_used+0xb8/0x3ed</div><div>&nbsp;[&lt;ffffffff884c4e64&gt;] :ext4:ext4_mb_use_preallocated+0x1a6/0x1c7</div><div>&nbsp;[&lt;ffffffff884c99a5&gt;] :ext4:ext4_mb_new_blocks+0x232/0x485</div><div>&nbsp;[&lt;ffffffff884c1c19&gt;] :ext4:ext4_ext_get_blocks+0x12d4/0x161f</div><div>&nbsp;[&lt;ffffffff8824d15b&gt;] :dm_mod:__split_bio+0x398/0x3b0</div><div>&nbsp;[&lt;ffffffff80017b93&gt;] cache_grow+0x35a/0x3c1</div><div>&nbsp;[&lt;ffffffff80022214&gt;] __up_read+0x19/0x7f</div><div>&nbsp;[&lt;ffffffff800232bb&gt;] mempool_alloc+0x31/0xe7</div><div>&nbsp;[&lt;ffffffff884ace97&gt;] :ext4:ext4_get_blocks+0x11b/0x1cf</div><div>&nbsp;[&lt;ffffffff884ad057&gt;] :ext4:mpage_da_map_blocks+0xaf/0x667</div><div>&nbsp;[&lt;ffffffff80048015&gt;] pagevec_lookup_tag+0x1a/0x21</div><div>&nbsp;[&lt;ffffffff800f6130&gt;] write_cache_pages+0x164/0x332</div><div>&nbsp;[&lt;ffffffff884af066&gt;] :ext4:__mpage_da_writepage+0x0/0x162</div><div>&nbsp;[&lt;ffffffff80047ff2&gt;] __pagevec_release+0x19/0x22</div><div>&nbsp;[&lt;ffffffff800ddd4e&gt;] __cache_alloc_node+0x9d/0xd2</div><div>&nbsp;[&lt;ffffffff884b08ba&gt;] :ext4:ext4_da_writepages+0x334/0x4fc</div><div>&nbsp;[&lt;ffffffff8005ac1d&gt;] do_writepages+0x20/0x2f</div><div>&nbsp;[&lt;ffffffff8002fc9d&gt;] __writeback_single_inode+0x19e/0x318</div><div>&nbsp;[&lt;ffffffff80020fd6&gt;] sync_sb_inodes+0x1b5/0x26f</div><div>&nbsp;[&lt;ffffffff800a269c&gt;] keventd_create_kthread+0x0/0xc4</div><div>&nbsp;[&lt;ffffffff80051147&gt;] writeback_inodes+0x82/0xd8</div><div>&nbsp;[&lt;ffffffff800cbb98&gt;] wb_kupdate+0xd4/0x14e</div><div>&nbsp;[&lt;ffffffff80056632&gt;] pdflush+0x0/0x1fb</div><div>&nbsp;[&lt;ffffffff80056783&gt;] pdflush+0x151/0x1fb</div><div>&nbsp;[&lt;ffffffff800cbac4&gt;] wb_kupdate+0x0/0x14e</div><div>&nbsp;[&lt;ffffffff80032974&gt;] kthread+0xfe/0x132</div><div>&nbsp;[&lt;ffffffff8005dfb1&gt;] child_rip+0xa/0x11</div><div>&nbsp;[&lt;ffffffff800a269c&gt;] keventd_create_kthread+0x0/0xc4</div><div>&nbsp;[&lt;ffffffff80032876&gt;] kthread+0x0/0x132</div><div>&nbsp;[&lt;ffffffff8005dfa7&gt;] child_rip+0x0/0x11</div></div><div style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  ><br></div><div style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  >红帽也没有给出很好的解决办法，如果不幸遇到这个BUG的话，可以考虑修改一下I/O调度算法。</div><div style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  >修改如下 :&nbsp;</div><div style="color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, 宋体, sans-serif; font-size: 13px; line-height: 23px;"  >[root@db-digoal ~]#&nbsp;vi /boot/grub/grub.conf</div><div><font color="#333333"  face="Verdana, Arial, Helvetica, 宋体, sans-serif"  size="2"  ><span style="line-height: 20px;"  >kernel /boot/vmlinuz-2.6.18-238.el5 ro root=LABEL=/ rhgb quiet elevator=deadline</span></font></div></div><div><font color="#333333"  face="Verdana, Arial, Helvetica, 宋体, sans-serif"  size="2"  ><span style="line-height: 20px;"  >重启系统。</span></font></div><div><font color="#333333"  face="Verdana, Arial, Helvetica, 宋体, sans-serif"  size="2"  ><span style="line-height: 20px;"  >重启后查看是否修改正确 :&nbsp;</span></font></div><div><font color="#333333"  face="Verdana, Arial, Helvetica, 宋体, sans-serif"  ><span style="font-size: 13px; line-height: 23px;"  >[root@db-digoal ~]#&nbsp;</span><span style="font-size: small; line-height: 20px;"  >dmesg|grep&nbsp;<span style="font-size: 13px; line-height: 23px;"  >scheduler</span></span></font></div><div><font color="#333333"  face="Verdana, Arial, Helvetica, 宋体, sans-serif"  ><span style="line-height: 20px; font-size: small;"  >io scheduler deadline registered (default)</span><span style="font-size: small; line-height: 20px;"  ><div><br></div><div>【参考】</div><div><a rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=605444"  >https://bugzilla.redhat.com/show_bug.cgi?id=605444</a></div><div><a rel="nofollow" href="http://bugs.centos.org/view.php?id=4515"  >http://bugs.centos.org/view.php?id=4515</a></div><div><br></div><div><br></div></span></font></div></div>
	</div>
</div>
</body>
</html>