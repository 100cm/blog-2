<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.0.3 bug? database's age less then max(relAGE) , and stream standby diff with master</h2>
	<h5 id="">2014-12-24 11:38:02&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020141124112632981/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">在9.0.3版本遇到一个疑似BUG. 但是没有办法重现, 记录一下.<div><br></div><div>已提交BUG, 等待回复.<br><div>环境, 流复制.</div><div>主: PostgreSQL 9.0.3</div><div>备: PostgreSQL 9.0.3</div><div><br></div><div>查询到某个表的数据在主节点和备节点不一致.</div><div>主节点有27条记录</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >digoal=&gt; select * from xxxx where xxx =618;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; id &nbsp;| xxx | xxx | &nbsp; &nbsp; &nbsp; create_time &nbsp; &nbsp; &nbsp; | sort_order | push_end_time | push_start_time | hot&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >------+-------------+--------------+-------------------------+------------+---------------+-----------------+-----</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6711 | &nbsp; &nbsp; &nbsp; &nbsp; 261 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.866 | &nbsp; &nbsp; &nbsp; &nbsp; 22 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6712 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;37 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.881 | &nbsp; &nbsp; &nbsp; &nbsp; 21 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6713 | &nbsp; &nbsp; &nbsp; &nbsp; 210 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.898 | &nbsp; &nbsp; &nbsp; &nbsp; 20 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6714 | &nbsp; &nbsp; &nbsp; &nbsp; 222 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.913 | &nbsp; &nbsp; &nbsp; &nbsp; 19 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6715 | &nbsp; &nbsp; &nbsp; &nbsp; 190 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.929 | &nbsp; &nbsp; &nbsp; &nbsp; 18 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6716 | &nbsp; &nbsp; &nbsp; &nbsp; 184 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.944 | &nbsp; &nbsp; &nbsp; &nbsp; 17 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6717 | &nbsp; &nbsp; &nbsp; &nbsp; 182 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.959 | &nbsp; &nbsp; &nbsp; &nbsp; 16 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6718 | &nbsp; &nbsp; &nbsp; &nbsp; 157 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.977 | &nbsp; &nbsp; &nbsp; &nbsp; 15 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6719 | &nbsp; &nbsp; &nbsp; &nbsp; 293 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.995 | &nbsp; &nbsp; &nbsp; &nbsp; 14 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6721 | &nbsp; &nbsp; &nbsp; &nbsp; 297 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.027 | &nbsp; &nbsp; &nbsp; &nbsp; 12 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6722 | &nbsp; &nbsp; &nbsp; &nbsp; 171 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.044 | &nbsp; &nbsp; &nbsp; &nbsp; 11 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6723 | &nbsp; &nbsp; &nbsp; &nbsp; 243 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.065 | &nbsp; &nbsp; &nbsp; &nbsp; 10 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6724 | &nbsp; &nbsp; &nbsp; &nbsp; 318 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.08 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6725 | &nbsp; &nbsp; &nbsp; &nbsp; 232 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.096 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6726 | &nbsp; &nbsp; &nbsp; &nbsp; 254 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.112 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6727 | &nbsp; &nbsp; &nbsp; &nbsp; 307 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.126 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6728 | &nbsp; &nbsp; &nbsp; &nbsp; 181 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.143 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6729 | &nbsp; &nbsp; &nbsp; &nbsp; 294 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.158 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6730 | &nbsp; &nbsp; &nbsp; &nbsp; 327 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.175 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6731 | &nbsp; &nbsp; &nbsp; &nbsp; 309 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.19 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6706 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;50 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.779 | &nbsp; &nbsp; &nbsp; &nbsp; 23 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6705 | &nbsp; &nbsp; &nbsp; &nbsp; 281 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.761 | &nbsp; &nbsp; &nbsp; &nbsp; 29 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6707 | &nbsp; &nbsp; &nbsp; &nbsp; 300 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.797 | &nbsp; &nbsp; &nbsp; &nbsp; 28 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6709 | &nbsp; &nbsp; &nbsp; &nbsp; 204 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.831 | &nbsp; &nbsp; &nbsp; &nbsp; 25 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6710 | &nbsp; &nbsp; &nbsp; &nbsp; 308 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.851 | &nbsp; &nbsp; &nbsp; &nbsp; 24 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6708 | &nbsp; &nbsp; &nbsp; &nbsp; 195 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:19.813 | &nbsp; &nbsp; &nbsp; &nbsp; 27 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;6720 | &nbsp; &nbsp; &nbsp; &nbsp; 229 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;618 | 2014-12-16 16:42:20.01 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 26 | 24:00 &nbsp; &nbsp; &nbsp; &nbsp; | 00:00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >(27 rows)</font></div><p></p></pre></div></div><div style="line-height: 28px;"   >备节点有62条记录</div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >digoal=&gt; select cmin,cmax,xmin,xmax,ctid,id from xxxx where xxx =618;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;cmin | cmax | &nbsp; &nbsp;xmin &nbsp; &nbsp;| xmax | &nbsp; ctid &nbsp; | &nbsp;id &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >------+------+------------+------+----------+------</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 342 | &nbsp;342 | 2582467777 | &nbsp; &nbsp;0 | (23,58) &nbsp;| 6475</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 343 | &nbsp;343 | 2582467777 | &nbsp; &nbsp;0 | (23,59) &nbsp;| 6476</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 344 | &nbsp;344 | 2582467777 | &nbsp; &nbsp;0 | (23,60) &nbsp;| 6477</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 345 | &nbsp;345 | 2582467777 | &nbsp; &nbsp;0 | (23,61) &nbsp;| 6478</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 346 | &nbsp;346 | 2582467777 | &nbsp; &nbsp;0 | (23,62) &nbsp;| 6479</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 347 | &nbsp;347 | 2582467777 | &nbsp; &nbsp;0 | (23,63) &nbsp;| 6480</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 348 | &nbsp;348 | 2582467777 | &nbsp; &nbsp;0 | (23,64) &nbsp;| 6481</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 349 | &nbsp;349 | 2582467777 | &nbsp; &nbsp;0 | (23,65) &nbsp;| 6482</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 350 | &nbsp;350 | 2582467777 | &nbsp; &nbsp;0 | (23,66) &nbsp;| 6483</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 351 | &nbsp;351 | 2582467777 | &nbsp; &nbsp;0 | (23,67) &nbsp;| 6484</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 352 | &nbsp;352 | 2582467777 | &nbsp; &nbsp;0 | (23,68) &nbsp;| 6485</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 353 | &nbsp;353 | 2582467777 | &nbsp; &nbsp;0 | (23,69) &nbsp;| 6486</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 354 | &nbsp;354 | 2582467777 | &nbsp; &nbsp;0 | (23,70) &nbsp;| 6487</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 355 | &nbsp;355 | 2582467777 | &nbsp; &nbsp;0 | (23,71) &nbsp;| 6488</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 356 | &nbsp;356 | 2582467777 | &nbsp; &nbsp;0 | (23,72) &nbsp;| 6489</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 357 | &nbsp;357 | 2582467777 | &nbsp; &nbsp;0 | (23,73) &nbsp;| 6490</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 358 | &nbsp;358 | 2582467777 | &nbsp; &nbsp;0 | (23,75) &nbsp;| 6491</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 359 | &nbsp;359 | 2582467777 | &nbsp; &nbsp;0 | (23,76) &nbsp;| 6492</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 360 | &nbsp;360 | 2582467777 | &nbsp; &nbsp;0 | (23,77) &nbsp;| 6493</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 361 | &nbsp;361 | 2582467777 | &nbsp; &nbsp;0 | (23,79) &nbsp;| 6494</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 362 | &nbsp;362 | 2582467777 | &nbsp; &nbsp;0 | (23,80) &nbsp;| 6495</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 363 | &nbsp;363 | 2582467777 | &nbsp; &nbsp;0 | (23,81) &nbsp;| 6496</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 364 | &nbsp;364 | 2582467777 | &nbsp; &nbsp;0 | (23,82) &nbsp;| 6497</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 365 | &nbsp;365 | 2582467777 | &nbsp; &nbsp;0 | (23,83) &nbsp;| 6498</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 366 | &nbsp;366 | 2582467777 | &nbsp; &nbsp;0 | (23,84) &nbsp;| 6499</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 367 | &nbsp;367 | 2582467777 | &nbsp; &nbsp;0 | (23,85) &nbsp;| 6500</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 368 | &nbsp;368 | 2582467777 | &nbsp; &nbsp;0 | (23,86) &nbsp;| 6501</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 369 | &nbsp;369 | 2582467777 | &nbsp; &nbsp;0 | (23,87) &nbsp;| 6502</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 370 | &nbsp;370 | 2582467777 | &nbsp; &nbsp;0 | (23,88) &nbsp;| 6503</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 371 | &nbsp;371 | 2582467777 | &nbsp; &nbsp;0 | (23,89) &nbsp;| 6504</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 372 | &nbsp;372 | 2582467777 | &nbsp; &nbsp;0 | (23,90) &nbsp;| 6505</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 373 | &nbsp;373 | 2582467777 | &nbsp; &nbsp;0 | (23,91) &nbsp;| 6506</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 374 | &nbsp;374 | 2582467777 | &nbsp; &nbsp;0 | (23,92) &nbsp;| 6507</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 375 | &nbsp;375 | 2582467777 | &nbsp; &nbsp;0 | (23,94) &nbsp;| 6508</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 376 | &nbsp;376 | 2582467777 | &nbsp; &nbsp;0 | (23,95) &nbsp;| 6509</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 250 | &nbsp;250 | 2907809296 | &nbsp; &nbsp;0 | (28,37) &nbsp;| 6711</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 251 | &nbsp;251 | 2907809296 | &nbsp; &nbsp;0 | (28,38) &nbsp;| 6712</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 252 | &nbsp;252 | 2907809296 | &nbsp; &nbsp;0 | (28,39) &nbsp;| 6713</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 253 | &nbsp;253 | 2907809296 | &nbsp; &nbsp;0 | (28,40) &nbsp;| 6714</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 254 | &nbsp;254 | 2907809296 | &nbsp; &nbsp;0 | (28,41) &nbsp;| 6715</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 255 | &nbsp;255 | 2907809296 | &nbsp; &nbsp;0 | (28,42) &nbsp;| 6716</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 256 | &nbsp;256 | 2907809296 | &nbsp; &nbsp;0 | (28,43) &nbsp;| 6717</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 257 | &nbsp;257 | 2907809296 | &nbsp; &nbsp;0 | (28,44) &nbsp;| 6718</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 258 | &nbsp;258 | 2907809296 | &nbsp; &nbsp;0 | (28,47) &nbsp;| 6719</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 260 | &nbsp;260 | 2907809296 | &nbsp; &nbsp;0 | (28,49) &nbsp;| 6721</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 261 | &nbsp;261 | 2907809296 | &nbsp; &nbsp;0 | (28,54) &nbsp;| 6722</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 262 | &nbsp;262 | 2907809296 | &nbsp; &nbsp;0 | (28,55) &nbsp;| 6723</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 263 | &nbsp;263 | 2907809296 | &nbsp; &nbsp;0 | (28,56) &nbsp;| 6724</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 264 | &nbsp;264 | 2907809296 | &nbsp; &nbsp;0 | (28,57) &nbsp;| 6725</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 265 | &nbsp;265 | 2907809296 | &nbsp; &nbsp;0 | (28,58) &nbsp;| 6726</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 266 | &nbsp;266 | 2907809296 | &nbsp; &nbsp;0 | (28,59) &nbsp;| 6727</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 267 | &nbsp;267 | 2907809296 | &nbsp; &nbsp;0 | (28,60) &nbsp;| 6728</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 268 | &nbsp;268 | 2907809296 | &nbsp; &nbsp;0 | (28,61) &nbsp;| 6729</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 269 | &nbsp;269 | 2907809296 | &nbsp; &nbsp;0 | (28,62) &nbsp;| 6730</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; 270 | &nbsp;270 | 2907809296 | &nbsp; &nbsp;0 | (28,63) &nbsp;| 6731</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; 1 | &nbsp; &nbsp;1 | 2957409441 | &nbsp; &nbsp;0 | (28,102) | 6706</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; 0 | &nbsp; &nbsp;0 | 2957411736 | &nbsp; &nbsp;0 | (28,103) | 6705</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; 0 | &nbsp; &nbsp;0 | 2957411736 | &nbsp; &nbsp;0 | (28,104) | 6707</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; 0 | &nbsp; &nbsp;0 | 2957409441 | &nbsp; &nbsp;0 | (28,106) | 6709</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; 0 | &nbsp; &nbsp;0 | 2957409441 | &nbsp; &nbsp;0 | (28,107) | 6710</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; 0 | &nbsp; &nbsp;0 | 2957411736 | &nbsp; &nbsp;0 | (28,108) | 6708</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; 1 | &nbsp; &nbsp;1 | 2957411736 | &nbsp; &nbsp;0 | (28,109) | 6720</font></div><div style="line-height: 28px;"   ><font size="2"   >(62 rows)</font></div><p></p></pre></div><div style="line-height: 28px;"   >可以看到, 出现差异的记录在standby查询到它的xmin是<span style="line-height: 28px;"   >2582467777, 这部分数据在主节点应该是不可见的, (但是我在主节点没有使用page inspect这个插件去查看, 有时间应该看看的)</span></div><div style="line-height: 28px;"   ><br></div></div><div>首选排查备节点的XLOG replay位置和主节点的XLOG产生位置是否一致或接近.</div><div>备节点</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >postgres=# select pg_last_xlog_replay_location();</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;pg_last_xlog_replay_location&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >------------------------------</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;1521/95AF7FE8</font></div><div style="line-height: 28px;"   ><font size="2"   >(1 row)</font></div><p></p></pre></div><div style="line-height: 28px;"   >主节点</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >postgres=# select pg_current_xlog_location();</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;pg_current_xlog_location&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >--------------------------</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;1521/95B4E000</font></div><div style="line-height: 28px;"   ><font size="2"   >(1 row)</font></div><p></p></pre></div></div><div style="line-height: 28px;"   >基本可以认为是一致的, 因为手工查询切换也有时间差.</div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >控制文件</div><div style="line-height: 28px;"   >备</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >pg_control version number: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;903</font></div><div style="line-height: 28px;"   ><font size="2"   >Catalog version number: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 201008051</font></div><div style="line-height: 28px;"   ><font size="2"   >Database system identifier: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5574478509073467071</font></div><div style="line-height: 28px;"   ><font size="2"   >Database cluster state: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in archive recovery</font></div><div style="line-height: 28px;"   ><font size="2"   >pg_control last modified: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wed 24 Dec 2014 10:55:30 AM CST</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint location: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1521/861BBA10</font></div><div style="line-height: 28px;"   ><font size="2"   >Prior checkpoint location: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1521/7C8EF3C0</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's REDO location: &nbsp; &nbsp;1521/81884898</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's TimeLineID: &nbsp; &nbsp; &nbsp; 3</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's NextXID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2/3295971686</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's NextOID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;168863593</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's NextMultiXactId: &nbsp;1</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's NextMultiOffset: &nbsp;0</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's oldestXID: &nbsp; &nbsp; &nbsp; &nbsp;1809653736</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's oldestXID's DB: &nbsp; 164408906</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's oldestActiveXID: &nbsp;3295733772</font></div><div style="line-height: 28px;"   ><font size="2"   >Time of latest checkpoint: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Wed 24 Dec 2014 10:50:10 AM CST</font></div><div style="line-height: 28px;"   ><font size="2"   >Minimum recovery ending location: &nbsp; &nbsp; 1521/92FAD1B8</font></div><div style="line-height: 28px;"   ><font size="2"   >Backup start location: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0/0</font></div><div style="line-height: 28px;"   ><font size="2"   >Current wal_level setting: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hot_standby</font></div><div style="line-height: 28px;"   ><font size="2"   >Current max_connections setting: &nbsp; &nbsp; &nbsp;2000</font></div><div style="line-height: 28px;"   ><font size="2"   >Current max_prepared_xacts setting: &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >Current max_locks_per_xact setting: &nbsp; 64</font></div><div style="line-height: 28px;"   ><font size="2"   >Maximum data alignment: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8</font></div><div style="line-height: 28px;"   ><font size="2"   >Database block size: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8192</font></div><div style="line-height: 28px;"   ><font size="2"   >Blocks per segment of large relation: 1048576</font></div><div style="line-height: 28px;"   ><font size="2"   >WAL block size: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8192</font></div><div style="line-height: 28px;"   ><font size="2"   >Bytes per WAL segment: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;67108864</font></div><div style="line-height: 28px;"   ><font size="2"   >Maximum length of identifiers: &nbsp; &nbsp; &nbsp; &nbsp;64</font></div><div style="line-height: 28px;"   ><font size="2"   >Maximum columns in an index: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32</font></div><div style="line-height: 28px;"   ><font size="2"   >Maximum size of a TOAST chunk: &nbsp; &nbsp; &nbsp; &nbsp;1996</font></div><div style="line-height: 28px;"   ><font size="2"   >Date/time type storage: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 64-bit integers</font></div><div style="line-height: 28px;"   ><font size="2"   >Float4 argument passing: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;by value</font></div><div style="line-height: 28px;"   ><font size="2"   >Float8 argument passing: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;by value</font></div><p></p></pre></div><div style="line-height: 28px;"   >主</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >pg_control version number: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;903</font></div><div style="line-height: 28px;"   ><font size="2"   >Catalog version number: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 201008051</font></div><div style="line-height: 28px;"   ><font size="2"   >Database system identifier: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5574478509073467071</font></div><div style="line-height: 28px;"   ><font size="2"   >Database cluster state: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in production</font></div><div style="line-height: 28px;"   ><font size="2"   >pg_control last modified: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wed 24 Dec 2014 10:57:33 AM CST</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint location: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1521/8FEA1380</font></div><div style="line-height: 28px;"   ><font size="2"   >Prior checkpoint location: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1521/861BBA10</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's REDO location: &nbsp; &nbsp;1521/8AC9C518</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's TimeLineID: &nbsp; &nbsp; &nbsp; 3</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's NextXID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2/3295971686</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's NextOID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;168863593</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's NextMultiXactId: &nbsp;1</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's NextMultiOffset: &nbsp;0</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's oldestXID: &nbsp; &nbsp; &nbsp; &nbsp;1809653736</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's oldestXID's DB: &nbsp; 164408906</font></div><div style="line-height: 28px;"   ><font size="2"   >Latest checkpoint's oldestActiveXID: &nbsp;3295733772</font></div><div style="line-height: 28px;"   ><font size="2"   >Time of latest checkpoint: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Wed 24 Dec 2014 10:55:10 AM CST</font></div><div style="line-height: 28px;"   ><font size="2"   >Minimum recovery ending location: &nbsp; &nbsp; 0/0</font></div><div style="line-height: 28px;"   ><font size="2"   >Backup start location: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0/0</font></div><div style="line-height: 28px;"   ><font size="2"   >Current wal_level setting: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hot_standby</font></div><div style="line-height: 28px;"   ><font size="2"   >Current max_connections setting: &nbsp; &nbsp; &nbsp;2000</font></div><div style="line-height: 28px;"   ><font size="2"   >Current max_prepared_xacts setting: &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >Current max_locks_per_xact setting: &nbsp; 64</font></div><div style="line-height: 28px;"   ><font size="2"   >Maximum data alignment: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8</font></div><div style="line-height: 28px;"   ><font size="2"   >Database block size: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8192</font></div><div style="line-height: 28px;"   ><font size="2"   >Blocks per segment of large relation: 1048576</font></div><div style="line-height: 28px;"   ><font size="2"   >WAL block size: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8192</font></div><div style="line-height: 28px;"   ><font size="2"   >Bytes per WAL segment: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;67108864</font></div><div style="line-height: 28px;"   ><font size="2"   >Maximum length of identifiers: &nbsp; &nbsp; &nbsp; &nbsp;64</font></div><div style="line-height: 28px;"   ><font size="2"   >Maximum columns in an index: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32</font></div><div style="line-height: 28px;"   ><font size="2"   >Maximum size of a TOAST chunk: &nbsp; &nbsp; &nbsp; &nbsp;1996</font></div><div style="line-height: 28px;"   ><font size="2"   >Date/time type storage: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 64-bit integers</font></div><div style="line-height: 28px;"   ><font size="2"   >Float4 argument passing: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;by value</font></div><div style="line-height: 28px;"   ><font size="2"   >Float8 argument passing: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;by value</font></div><p></p></pre></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >注意 :&nbsp;</div><div>Latest checkpoint's NextXID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2/3298037243</div></div></div><div>说明当前已分配事务需要加上2*(2^32)</div><div><br></div><div>从年龄上看, 貌似不是年龄引起的可见和不可见问题.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select age(xid '2582467777');</font></div><div><font size="2"   >&nbsp; &nbsp; age &nbsp; &nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp;718481212</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select age(xid '2907809296');</font></div><div><font size="2"   >&nbsp; &nbsp; age &nbsp; &nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp;393147505</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >数据库中不停的有事务在处理, 所以年龄会增大, 实际上使用age技术年龄时, 加不加2*2^32结果应该是一样的.</font></div><div><font size="2"   >postgres=# select age(xid '11497743888'),age(xid '2907809296');<br>    age    |    age    <br>-----------+-----------<br> 393400832 | 393400832<br>(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select 2*(2^32)+2582467777;<br>  ?column?   <br>-------------<br> 11172402369<br>(1 row)<br><br>postgres=# select 2*(2^32)+2907809296;<br>  ?column?   <br>-------------<br> 11497743888<br>(1 row)<br><br>postgres=# select age(xid '11172402369');<br>    age    <br>-----------<br> 718638085<br>(1 row)<br><br>postgres=# select age(xid '11497743888');<br>    age    <br>-----------<br> 393304764<br>(1 row)</font></div><p></p></pre></div><div><br></div><div>然后确保这个表没有任何变更.&nbsp;</div><div>没有其他理由说明主备节点的数据可以不一致, 那么就是BUG了.</div><div><br></div><div>接下来主库查询到年龄信息异常. 数据库统计信息表的年龄小于数据库内pg_class中记录的对象的实际年龄.</div><div>正常情况下, 数据库的年龄应该等于数据库中最大年龄的对象的年龄.</div><div>但是这里显然不正常.</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select max(age(datfrozenxid)) from pg_database ;</font></div><div><font size="2"   >&nbsp; &nbsp; max &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------</font></div><div><font size="2"   >&nbsp;1486750538</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; select max(age(relfrozenxid)) from pg_class ;</font></div><div><font size="2"   >&nbsp; &nbsp; max &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------</font></div><div><font size="2"   >&nbsp;2147483647</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div><br></div><div>对这个表做一次vacuum full后, 主备节点数据一致, 恢复正常.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; vacuum full xxxx ;</font></div><div><font size="2"   >VACUUM</font></div><p></p></pre></div><div><br></div><div>数据库vacuum配置 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >#vacuum_freeze_min_age = 50000000</font></div><div><font size="2"   >vacuum_freeze_table_age = 1100000000</font></div><div><font size="2"   >autovacuum_freeze_max_age = 1500000000</font></div><p></p></pre></div><div><br></div><div>接下来要做的是手工执行一些vacuum freeze.</div><div><p></p><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; vacuumdb -a -F -z</font></div><div></div><p></p></pre></div><div><font size="2"   ><br></font></div><div><font size="3"   >[参考]</font></div><div><font size="3"   >PostgreSQL 9.0.3</font></div><div><font size="3"   >src/backend/utils/adt/xid.c</font></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;xid_age &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - compute age of an XID (relative to current xact)</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >Datum</font></div><div><font size="2"   >xid_age(PG_FUNCTION_ARGS)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TransactionId xid = PG_GETARG_TRANSACTIONID(0);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TransactionId now = GetTopTransactionId();</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* Permanent XIDs are always infinitely old */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (!TransactionIdIsNormal(xid))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_INT32(INT_MAX);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_INT32((int32) (now - xid));</font></div><div><font size="2"   >}</font></div><p></p></pre></div><div><font size="3"   >src/backend/access/transam/xact.c</font></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;GetTopTransactionId</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* This will return the XID of the main transaction, assigning one if</font></div><div><font size="2"   >&nbsp;* it's not yet set. &nbsp;Be careful to call this only inside a valid xact.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >TransactionId</font></div><div><font size="2"   >GetTopTransactionId(void)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (!TransactionIdIsValid(TopTransactionStateData.transactionId))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AssignTransactionId(&amp;TopTransactionStateData);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return TopTransactionStateData.transactionId;</font></div><div><font size="2"   >}</font></div><p></p></pre></div><div><font size="2"   ><br></font></div><div></div><p></p></div></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL 9.0.3 bug? databases age less then max(relAGE) , and stream standby diff with master - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a><br></div></div>
	</div>
</div>
</body>
</html>