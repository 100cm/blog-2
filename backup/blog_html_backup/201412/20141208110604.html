<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Ceph cluster configure introduce - 1</h2>
	<h5 id="">2014-12-08 11:06:04&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014118103927428/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>ceph存储集群运行需要osd和mon模块, 如果要使用对象存储, 需要添加radosgw模块, 如果需要使用ceph 文件系统需要添加mds模块.</div><div>这些模块在启动时, 需要读取配置文件, ceph所有类型的daemon配置文件统一放在一个配置文件中, 配置文件的顺序如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >The default Ceph configuration file locations in sequential order include:</font></div><div><font size="2"   >$CEPH_CONF (i.e., the path following the $CEPH_CONF environment variable)</font></div><div><font size="2"   >-c path/path (i.e., the -c command line argument)</font></div><div><font size="2"   >/etc/ceph/ceph.conf</font></div><div><font size="2"   >~/.ceph/config</font></div><div><font size="2"   >./ceph.conf (i.e., in the current working directory)</font></div><p></p></pre></div><div>以上配置文件ceph.conf指集群名为ceph的配置文件, 如果集群名为其他如openstack, 那么配置文件名为openstack.conf.</div><div><br></div><div>在配置文件中未配置的参数, CEPH在头文件中定义了一些默认值, &nbsp;默认值在如下文件中定义 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >ceph/src/common/config_opts.h</font></div><font size="2"   ><wbr></font><div></div><p></p></pre></div><div>Ceph存储集群的配置包含哪些内容呢? 大致如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Cluster Identity &nbsp;(uuid)</font></div><div><font size="2"   >Authentication settings &nbsp;认证</font></div><div><font size="2"   >Cluster membership</font></div><div><font size="2"   >Host names</font></div><div><font size="2"   >Host addresses</font></div><div><font size="2"   >Paths to keyrings &nbsp;KEY文件路径</font></div><div><font size="2"   >Paths to journals &nbsp; osd journal路径</font></div><div><font size="2"   >Paths to data &nbsp; DATA路径</font></div><div><font size="2"   >Other runtime options</font></div><p></p></pre></div><div><br></div><div>配置文件注释, ;或#开头. 例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># &lt;--A number (#) sign precedes a comment.</font></div><div><font size="2"   >; A comment may be anything.</font></div><div><font size="2"   ># Comments always follow a semi-colon (;) or a pound (#) on each line.</font></div><div><font size="2"   ># The end of the line terminates a comment.</font></div><div><font size="2"   ># We recommend that you provide comments in your configuration file(s).</font></div><p></p></pre></div><div><br></div><div>前面说了, 所有的ceph存储集群daemon使用同一个配置文件, 那么要区分不同daemon的配置, 使用section来区分.</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >全局配置, 一般用于配置公共项, 可以被其他章节的配置覆盖.</font></div><div><div><font size="2"   >[global]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:<span>	</span>Settings under [global] affect all daemons in a Ceph Storage Cluster.</font></div><div><font size="2"   >Example:<span>	</span>auth supported = cephx</font></div><div><font size="2"   >object storage devices daemon配置</font></div><div><font size="2"   >[osd]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:<span>	</span>Settings under [osd] affect all ceph-osd daemons in the Ceph Storage Cluster, and override the same setting in [global].</font></div><div><font size="2"   >Example:<span>	</span>osd journal size = 1000</font></div><div><font size="2"   >monitor daemon配置&nbsp;</font></div><div><font size="2"   >[mon]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:<span>	</span>Settings under [mon] affect all ceph-mon daemons in the Ceph Storage Cluster, and override the same setting in [global].</font></div><div><font size="2"   >Example:<span>	</span>mon addr = 10.0.0.101:6789</font></div><div><span style="line-height: 28px;"   ><font size="2"   >metadata storage daemon配置&nbsp;</font></span></div><div><font size="2"   >[mds]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:<span>	</span>Settings under [mds] affect all ceph-mds daemons in the Ceph Storage Cluster, and override the same setting in [global].</font></div><div><font size="2"   >Example:<span>	</span>host = myserver01</font></div><div><font size="2"   >客户端配置</font></div><div><font size="2"   >[client]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:<span>	</span>Settings under [client] affect all Ceph Clients (e.g., mounted Ceph Filesystems, mounted Ceph Block Devices, etc.).</font></div><div><font size="2"   >Example:<span>	</span>log file = /var/log/ceph/radosgw.log</font></div></div><p></p></pre></div><div><br></div><div>针对daemon还支持不同的instance使用不同的配置, 例如一台机器启动了多个osd daemon, 可以对每个daemon配置不同的参数.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >You may specify settings for particular instances of a daemon. You may specify an instance by entering its type, delimited by a period (.) and by the instance ID. The instance ID for a Ceph OSD Daemon is always numeric, but it may be alphanumeric for Ceph Monitors and Ceph Metadata Servers.</font></div><div><div><font size="2"   >[osd.1]</font></div><div><font size="2"   ># settings affect osd.1 only.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[mon.a]</font></div><div><font size="2"   ># settings affect mon.a only.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[mds.b]</font></div><div><font size="2"   ># settings affect mds.b only.</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   ># osd instance id必须是数字, mon和mds的instance可以是数字字母.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># 客户端配置同样支持不同的客户端使用不同的配置.</font></div><div><div><font size="2"   >[client.radosgw.instance-name]</font></div><div><font size="2"   ># settings affect client.radosgw.instance-name only.</font></div></div><p></p></pre></div><div><br></div><div>优先级</div><div>全局 配置&lt;daemon 配置&lt;daemon.process 配置</div><div>优先级高的配置将覆盖优先级低的配置.</div><div><br></div><div>配置文件中可以使用的变量, 包括集群名, daemon类型, instance id, 主机名, daemon_instance_id组合. :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Metavariables simplify Ceph Storage Cluster configuration dramatically. When a metavariable is set in a configuration value, Ceph expands the metavariable into a concrete value. Metavariables are very powerful when used within the [global], [osd], [mon], [mds] or [client] sections of your configuration file. Ceph metavariables are similar to Bash shell expansion.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Ceph supports the following metavariables:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >$cluster</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:<span>	</span>Expands to the Ceph Storage Cluster name. Useful when running multiple Ceph Storage Clusters on the same hardware.</font></div><div><font size="2"   >Example:<span>	</span>/etc/ceph/$cluster.keyring</font></div><div><font size="2"   >Default:<span>	</span>ceph</font></div><div><font size="2"   >$type</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:<span>	</span>Expands to one of mds, osd, or mon, depending on the type of the instant daemon.</font></div><div><font size="2"   >Example:<span>	</span>/var/lib/ceph/$type</font></div><div><font size="2"   >$id</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:<span>	</span>Expands to the daemon identifier. For osd.0, this would be 0; for mds.a, it would be a.</font></div><div><font size="2"   >Example:<span>	</span>/var/lib/ceph/$type/$cluster-$id</font></div><div><font size="2"   >$host</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:<span>	</span>Expands to the host name of the instant daemon.</font></div><div><font size="2"   >$name</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:<span>	</span>Expands to $type.$id.</font></div><div><font size="2"   >Example:<span>	</span>/var/run/ceph/$cluster-$name.asok</font></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://ceph.com/docs/master/rados/configuration/ceph-conf/"   >http://ceph.com/docs/master/rados/configuration/ceph-conf/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201411441918267/"   >http://blog.163.com/digoal@126/blog/static/163877040201411441918267/<br></a><span style="line-height: 28px;"   >
</span><a style="line-height: 28px;" rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Ceph cluster configure introduce - 1 - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div></div>
	</div>
</div>
</body>
</html>