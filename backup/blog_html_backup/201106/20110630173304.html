<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">EMC avamar test note - 1</h2>
	<h5 id="">2011-06-30 17:33:04&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201153051056870/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">avamar server 便携版本是一个vmware的虚拟机，rhel4操作系统作为avamar server的载体，可能定制化了一些EMC自己的东西 .&nbsp;<wbr><div><br></div><div>测试安装环境：</div><div>1. Server : DELL R610 至强 2.0Ghz 8核,8GB MEM,500GB硬盘，开启CPU虚拟化.</div><div>2. OS : Windows 2008 R2 64位</div><div>3. VMWARE ISO ： avamar-kickstart-rhel4.8-64-0031</div><div>4. 安装包 : v5.0.4.30-customer_unified-v5.0.106.28</div><div>5. 手册 : Avamar 5.0 Lab Guide 1.2-Final</div><div><br></div><div>安装完虚拟机之后，需要根据手册安装avamar server ,&nbsp;配置avamar server的主机名，域名，IP，等信息。</div><div>之后avamar server服务器上会多出一个WEB SERVICE，可以用来管理avamar server.</div><div>默认 :&nbsp;</div><div>USER : MCUser</div><div>PWD : MCUser1</div><div><br></div><div>在备份之前，首先要注册备份机，方法是在备份机上安装agent，并且修改/etc/hosts，执行注册（将客户机的信息注册到avamar server）。</div><div><br></div><div>管理客户机需要登录avamar server web service ，需要在/etc/hosts或windows里面增加一个条目，用于解析avamar server的地址</div><div>管理客户机可以选择安装avamar GUI , 以便管理.</div><div>管理可以通过</div><div>1. http://avamar_server_host</div><div><div><div><img title="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  alt="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img.ph.126.net/0D3EUukZzv9gslwj1Yga1g==/3211629484270508178.jpg"  ></div>&nbsp;</div>&nbsp;</div><div>2. http://avamar_server_host/em</div><div><div><img title="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  alt="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img.ph.126.net/mNmT8ijYCJAMvmSZNl_SFg==/3337730273836065700.jpg"  ></div>&nbsp;</div><div>3. 客户机avamar GUI</div><div><div><div><img title="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  alt="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img.ph.126.net/wuD7w_DVlgHVJ2LGlx3p6w==/3361092696903378284.jpg"  ></div><div><div><img title="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  alt="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img.ph.126.net/TKT2oTetNAJgflzQ4rIqCw==/3407536068060678914.jpg"  ></div>&nbsp;</div>&nbsp;</div></div><div>进行管理.</div><div><br></div><div>avamar server后台使用的是postgresql数据库。一共起了两个集群，端口分别是5555和5556， emdb和mcdb.</div><div><div>mcdb=# \dt</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of relations</div><div>&nbsp;Schema | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Type &nbsp;| Owner&nbsp;</div><div>--------+-------------------------+-------+-------</div><div>&nbsp;public | activities &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | activity_errors &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | activity_types &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | audits &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | axion_systems &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | change_id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | cl_msg_cache &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | cl_plugins &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | clients &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | compatibility &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | datasets &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ds_commands &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | ds_excludes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | ds_includes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | ds_targets &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_catalog &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_catalog_ext &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_counter &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_cus_body &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | ev_cus_cc_list &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_cus_codes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_cus_prof &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | ev_cus_prof_params &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_cus_rpt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_cus_snmp_contact &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | ev_cus_syslog_contact &nbsp; | table | admin</div><div>&nbsp;public | ev_cus_to_list &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_data_entry_type &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_pending &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_sys_prof &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | ev_unack &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | events &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | gcstatus &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | gr_members &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | group_proxy_mapping &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | groups &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | hfscheck_failures &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | log_parse_info &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | mgmt_client &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | plugin_can_restore &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | plugin_catalog &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | plugin_depends_upon &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | plugin_flag_groups &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | plugin_flag_pulldown &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | plugin_flags &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | plugin_options &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | plugin_state &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | property_value &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | proxy_client &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | proxy_datastore_mapping | table | admin</div><div>&nbsp;public | repl_activities &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | repl_backups &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | report_filter &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | reports &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | retention_policies &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | sc_recur &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | schedules &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | snapshot &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | snapup_history &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | sv_dpn_stats &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | sv_elog_cache &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | sv_node_space &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | sv_node_util &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | vm_client &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | vm_datastore &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>(65 rows)</div></div><div><br></div><div><div>emdb=# \dt</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of relations</div><div>&nbsp;Schema | &nbsp; &nbsp; &nbsp; &nbsp;Name &nbsp; &nbsp; &nbsp; &nbsp; | Type &nbsp;| Owner&nbsp;</div><div>--------+---------------------+-------+-------</div><div>&nbsp;public | activities &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | activity_errors &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | axion_server &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | checkpoints &nbsp; &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | compatibility &nbsp; &nbsp; &nbsp; | table | admin</div><div>&nbsp;public | dpn_info &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | emaxion_system &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_catalog &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_catalog_ext &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_unack &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | ev_unack_count &nbsp; &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | hfscheck_failures &nbsp; | table | admin</div><div>&nbsp;public | replication_info &nbsp; &nbsp;| table | admin</div><div>&nbsp;public | status_descriptions | table | admin</div><div>(14 rows)</div></div><div><br></div><div>下面是通过DBvisualizer产生的ER视图:</div><div><div><img title="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  alt="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img.ph.126.net/YDM1WpOupJCZi2eFCC9j8g==/2394226151917623422.jpg"  ></div>&nbsp;<div><img title="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  alt="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img.ph.126.net/eeST8g-a_O_H6kuSNl7gAg==/3374040545832000493.jpg"  ></div>&nbsp;</div><div><br></div><div><br></div><div>由于avamar 采用的是源端去重技术，因此在效率上非常高。</div><div>avamar 带 DB2 ORACLE的备份插件，所以备份起来比较方便。但是对于PostgreSQL,需要自己写脚本，然后调用mccli来备份。</div><div>下面是一些简单的测试:</div><div><br></div><div><div><img title="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  alt="EMC avamar test note - 1 - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img767.ph.126.net/51Si7BKhEB5cKF2gGBjgcg==/4903012619323167677.jpg"  ></div>&nbsp;</div><div><br></div><div>还原的时候出了点小问题，还原的SIZE与原始目录有差异。EMC的回复：</div><div><p><span style="COLOR: #1f497d; FONT-SIZE: 11pt;"  lang="EN-US"  >This  is because of sparse file. For sure the data backup &amp; restored is  identical.</span></p> <p><span style="COLOR: #1f497d; FONT-SIZE: 11pt;"  lang="EN-US"  >du  commands will report the block size used for the object but not the actual file  size.</span></p> <p><span style="COLOR: #1f497d; FONT-SIZE: 11pt;"  lang="EN-US"  >A  sparse file is a file with empty space, or gaps, left open for future addition  of data. </span></p> <p><span style="COLOR: #1f497d; FONT-SIZE: 11pt;"  lang="EN-US"  >If  the empty spaces are filled with the ASCII null character and the spaces are  large enough, the file will be sparse, and disk blocks will not be allocated to  it.</span></p> <p><span style="COLOR: #1f497d; FONT-SIZE: 11pt;"  lang="EN-US"  > </span></p> <p><span style="COLOR: #1f497d; FONT-SIZE: 11pt;"  lang="EN-US"  ><a rel="nofollow" href="http://bugs.avamar.com/show_bug.cgi?id=5971"  >http://bugs.avamar.com/show_bug.cgi?id=5971</a></span></p> <p><span style="COLOR: #1f497d; FONT-SIZE: 11pt;"  lang="EN-US"  > </span></p> <p><span style="COLOR: #1f497d; FONT-SIZE: 11pt;"  lang="EN-US"  >By  default --restore-sparse-threshold=128 meaning that only regions larger than  128K bytes will be considered sparse.  Smaller regions will be written as  sequences of zeros.</span></p></div></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">star的幸福 - 2011-09-23 9:19:48</h5>
				<div>德哥啊，我从网上下载了<span class="Apple-style-span"  style=""  >&nbsp;avamar-kickstart-rhel4.8-64-0031和v5.0.4.30-customer_unified-v5.0.106.28两个包，但是没有相关的安装手册。是不是先启动avamar-kickstart，然后再在上面安装customer？现在的问题是不知道avamar-kickstart的用户名和密码啊。请您赐教。哈哈<img src="http://b.bst.126.net/common/portrait/face/preview/face6.gif"  ><br></span><div><span class="Apple-style-span"  style=""  ><br></span></div><div><span class="Apple-style-span"  style=""  >http://taotao1240.blog.51cto.com/</span></div></div>
			</div>
			<div id="">
				<h5 id="">fov222 - 2011-08-10 17:26:27</h5>
				<div>德哥老师，再次打扰。HP BL460C刀片的VC模块上的UPLINK端口号比如说port1,port2与刀片的网卡NIC1,NIC2 有默认的对应关系吗？我在VC上配置一个网络net1 绑定port1为上行口，然后配置给刀片1，是不是就是刀片的一号网卡从port1上走了？麻烦您解答一下 &nbsp;3Q</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 fov222 - 2011-08-10 17:26:27</h5>
				<div style="width:600px;">HI,看看刀片的说明书吧,我没配过这个,怕对你造成误导.</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">fov222 回复 德哥@Digoal - 2011-08-10 17:26:27</h5>
				<div style="width:600px;"><img src="http://b.bst.126.net/style/common/htmlEditor/portrait/face/preview/face0.gif">&nbsp; 好 &nbsp;谢谢 。</div>
			</div>
	</div>
</div>
</body>
</html>