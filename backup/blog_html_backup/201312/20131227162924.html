<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Lua 函数用法和它的"诡异"之处</h2>
	<h5 id="">2013-12-27 16:29:24&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013112733934891/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">Lua 函数调用时, 需要带括号(对于单个参数的函数,某些值不需要用括号, 如字符串, 表).&nbsp;<div>但是注意return是可以带括号也可以不带括号的.</div><div><div>这里重点说到括号, 因为括号和返回多值的函数关系很大, 也就是"诡异"的地方, 后面会举例.</div><div><br></div><div>函数可以作为一个语句执行, 那有点类似一个过程语言, 执行完的函数结果被抛弃掉.</div><div>例如 :&nbsp;</div><div>print("abc") -- 这作为一个语句执行.</div><div>函数也可以在一个表达式中执行, 那么结果会被返回, 对于多值函数需要注意返回的值的个数.</div><div>例如 :</div><div>i = math.sin(123) &nbsp;-- 这里的math.sin函数在表达式中, 所以结果返回.</div><div><br></div><div>函数调用必须带括号, 除了单个参数的函数, 并且参数类型为字符串, 表构造器时, 可以不带括号.</div><div>例如:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; print {1,2,3}</font></div><div><font size="2"   >table: 0x9465c0</font></div><div><div><font size="2"   >&gt; print [====[</font></div><div><font size="2"   >&gt;&gt; hellp</font></div><div><font size="2"   >&gt;&gt; nihao</font></div><div><font size="2"   >&gt;&gt; ]]</font></div><div><font size="2"   >&gt;&gt; ]====]</font></div><div><font size="2"   >hellp</font></div><div><font size="2"   >nihao</font></div><div><font size="2"   >]]</font></div></div><div><div><font size="2"   >&gt; print "hello"</font></div><div><font size="2"   >hello</font></div></div><div><div><font size="2"   >&gt; print {}</font></div><div><font size="2"   >table: 0x946d10</font></div></div><p></p></pre></div><div><br></div><div>函数的结构</div><div>包含函数名, 参数, 函数体几个部分.</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >function add(a)</font></div><div><font size="2"   >&nbsp; local sum = 0</font></div><div><font size="2"   >&nbsp; for i = 1, #a do</font></div><div><font size="2"   >&nbsp; &nbsp; sum = sum + a[i]</font></div><div><font size="2"   >&nbsp; end</font></div><div><font size="2"   >&nbsp; return sum</font></div><div><font size="2"   >end</font></div><p></p></pre></div><div>函数的参数, 和本地变量类似, 调用函数时为值传递的方式. 在函数中修改这个变量对传入的变量没有影响.&nbsp;</div><div>同时, 函数调用时允许传入的参数个数和函数定义的个数不一致的情况.</div><div>例如</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >function f (a,b)</font></div><div><font size="2"   >&nbsp; print(a,b)</font></div><div><font size="2"   >end</font></div><p></p></pre></div><div>可以这么调用 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; function f(a,b)</font></div><div><font size="2"   >&gt;&gt; &nbsp; print(a,b)</font></div><div><font size="2"   >&gt;&gt; end</font></div><div><font size="2"   >&gt; f() &nbsp;-- a,b都为nil</font></div><div><font size="2"   >nil &nbsp; &nbsp; nil</font></div><div><font size="2"   >&gt; f(1) &nbsp;-- a=1, b=nil</font></div><div><font size="2"   >1 &nbsp; &nbsp; &nbsp; nil</font></div><div><font size="2"   >&gt; f(2)</font></div><div><font size="2"   >2 &nbsp; &nbsp; &nbsp; nil</font></div><div><font size="2"   >&gt; f(1,2,3) &nbsp;-- a=1, b=2, 3抛弃</font></div><div><font size="2"   >1 &nbsp; &nbsp; &nbsp; 2</font></div><div><font size="2"   >&gt; f(1,2)</font></div><div><font size="2"   >1 &nbsp; &nbsp; &nbsp; 2</font></div><p></p></pre></div><div>如果函数参数缺失的情况下, 可以给它默认值, 我现在还不清楚是不是可以在函数定义时指定, 如果不能的话就这么这么搞了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >function f(a,b)</font></div><div><font size="2"   >&nbsp; if a == nil then a = 1 end</font></div><div><font size="2"   >&nbsp; if b == nil then b = 1 end</font></div><div><font size="2"   >&nbsp; print(a,b)</font></div><div><font size="2"   >end</font></div><p></p></pre></div><div>为什么不用 a= a or 1呢? 因为当传入的是boolean值时, false的话, false or 1也变1了.</div><div>这个是Lua的一种逻辑判断值的取值问题. 例如</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >a or b &nbsp;-- 当a = nil或false时, a or b这个逻辑判断表达式的值就是b, 当a不为false或者nil时, 那么这个表达式的值就是a.</font></div><div><div><font size="2"   >&gt; print(false or 1)</font></div><div><font size="2"   >1</font></div><div><font size="2"   >&gt; print(0 or false)</font></div><div><font size="2"   >0</font></div><div><font size="2"   >&gt; print(0 or "hello")</font></div><div><font size="2"   >0</font></div><div><font size="2"   >&gt; print(nil or "hello")</font></div><div><font size="2"   >hello</font></div><div><font size="2"   >&gt; print(false or "hello")</font></div><div><font size="2"   >hello</font></div></div><p></p></pre></div><div>a and b 则当a为真(不为false或nil)时, 表达式的结果等于b, 如果a为真, 则表达式的结果为a.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; print(1 and false)</font></div><div><font size="2"   >false</font></div><div><font size="2"   >&gt; print(1 and nil)</font></div><div><font size="2"   >nil</font></div><div><font size="2"   >&gt; print(1 and 2)</font></div><div><font size="2"   >2</font></div><div><font size="2"   >&gt; print(false and "hello")</font></div><div><font size="2"   >false</font></div><div><font size="2"   >&gt; print(nil and "hello")</font></div><div><font size="2"   >nil</font></div><p></p></pre></div><div><br></div><div>Lua支持一个函数返回多个值, 但是返回多个值时, 有多少个值传递, 或者被抛弃, 和用法有关, 比较诡异的地方来了.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&gt; print(string.find("hello","llo"))</font></div><div><font size="2"   >3 &nbsp; &nbsp; &nbsp; 5</font></div></div><div><span style="line-height: 28px;"   ><font size="2"   >string.find("hello","llo")函数返回2个值, 第一个值为匹配到的字符串的开始位置, 第二个值为结束位置.</font></span></div><p></p></pre></div><div>但是, 当多值函数后面再有表达式时, 多值函数就只返回第一个值, 后面的值被抛弃.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; print(string.find("hello","llo"), "hell") &nbsp;-- 这样的话<span style="line-height: 28px;"   >string.find("hello","llo")只返回了第一个结果3. 5被抛弃了.</span></font></div><div><font size="2"   >3 &nbsp; &nbsp; &nbsp; hell</font></div><p></p></pre></div><div>在赋值时也一样</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; a,b = string.find("hello","llo")</font></div><div><font size="2"   >&gt; print(a,b)</font></div><div><font size="2"   >3 &nbsp; &nbsp; &nbsp; 5</font></div><div><font size="2"   >&gt; a,b = string.find("hello","llo"), "he"</font></div><div><font size="2"   >&gt; print(a,b)</font></div><div><font size="2"   >3 &nbsp; &nbsp; &nbsp; he</font></div><p></p></pre></div><div>还有一种情况, 如果要强制使用仅仅返回1个结果的话, 在函数外加括号就可以. 这就是文章开头提到的括号用法.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&gt; a=(string.find("hello","llo"))</font></div><div><font size="2"   >&gt; print(a)</font></div><div><font size="2"   >3</font></div><div><font size="2"   >&gt; a=string.find("hello","llo")</font></div><div><font size="2"   >&gt; print(a)</font></div><div><font size="2"   >3</font></div></div><div><div><font size="2"   >&gt; print(string.find("hello","llo"))</font></div><div><font size="2"   >3 &nbsp; &nbsp; &nbsp; 5</font></div><div><font size="2"   >&gt; print((string.find("hello","llo")))  -- 多值函数用括号包一层, 返回第一个结果值. 而不是整个list</font></div><div><font size="2"   >3</font></div></div><p></p></pre></div><div><br></div><div>多值函数例子 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; function max(a)</font></div><div><font size="2"   >&nbsp; local mi = 1 -- index</font></div><div><font size="2"   >&nbsp; local m = a[mi]</font></div><div><font size="2"   >&nbsp; for i=1,#a do</font></div><div><font size="2"   >&nbsp; &nbsp; if a[i] &gt; m then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; mi = i; m = a[i]</font></div><div><font size="2"   >&nbsp; &nbsp; end</font></div><div><font size="2"   >&nbsp; end</font></div><div><font size="2"   >&nbsp; return m, mi</font></div><div><font size="2"   >end</font></div><div><font size="2"   >&gt; print(max({1,2,3,4,5}))</font></div><div><font size="2"   >5 &nbsp; &nbsp; &nbsp; 5</font></div><div><font size="2"   >&gt; print(max({1,2,3,4,5,100}))</font></div><div><font size="2"   >100 &nbsp; &nbsp; 6</font></div><p></p></pre></div><div><br></div><div>比较容易记住Lua的多值返回函数的诡异的例子 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&gt; function foo0() end</font></div><div><font size="2"   >&gt; function foo1() return "a" end</font></div><div><font size="2"   >&gt; function foo2() return "a", "b" end</font></div><div><font size="2"   >&gt; x,y = foo2()</font></div><div><font size="2"   >&gt; print(x,y)</font></div><div><font size="2"   >a &nbsp; &nbsp; &nbsp; b</font></div><div><font size="2"   >&gt; x = foo2()</font></div><div><font size="2"   >&gt; print(x)</font></div><div><font size="2"   >a</font></div><div><font size="2"   >&gt; x,y,z = 10,foo2() &nbsp;<span style="line-height: 28px;"   >&nbsp;-- 在这里, 也要注意, 后面有值的情况下, 多值函数都只取一个值. 没有值的话, 全取.</span></font></div><div><font size="2"   >&gt; print(x,y,z)</font></div><div><font size="2"   >10 &nbsp; &nbsp; &nbsp;a &nbsp; &nbsp; &nbsp; b</font></div><div><font size="2"   >&gt; x,y = foo0()</font></div><div><font size="2"   >&gt; print(x,y)</font></div><div><font size="2"   >nil &nbsp; &nbsp; nil</font></div><div><font size="2"   >&gt; x,y = foo1()</font></div><div><font size="2"   >&gt; print(x,y)</font></div><div><font size="2"   >a &nbsp; &nbsp; &nbsp; nil</font></div><div><font size="2"   >&gt; x,y,z = foo2()</font></div><div><font size="2"   >&gt; print(x,y,z)</font></div><div><font size="2"   >a &nbsp; &nbsp; &nbsp; b &nbsp; &nbsp; &nbsp; nil</font></div><div><font size="2"   >&gt; x,y = foo2(), "hello" &nbsp;<span style="line-height: 28px;"   >&nbsp;-- 在这里, 也要注意, 后面有值的情况下, 多值函数都只取一个值.</span></font></div><div><font size="2"   >&gt; print(x,y)</font></div><div><font size="2"   >a &nbsp; &nbsp; &nbsp; hello</font></div><div><font size="2"   >&gt; x,y = foo0(), "hello", "nihao"</font></div><div><font size="2"   >&gt; print(x,y)</font></div><div><font size="2"   >nil &nbsp; &nbsp; hello</font></div><div><font size="2"   >&gt; t = {foo0(), foo2(), 4} &nbsp;-- 在这里, 也要注意, 后面有值的情况下, 多值函数都只取一个值.</font></div><div><font size="2"   >&gt; print(t)</font></div><div><font size="2"   >table: 0x9515c0</font></div><div><font size="2"   >&gt; for i = 1,#t do</font></div><div><font size="2"   >&gt;&gt; print(t[i])</font></div><div><font size="2"   >&gt;&gt; i = i+1</font></div><div><font size="2"   >&gt;&gt; end</font></div><div><font size="2"   >nil</font></div><div><font size="2"   >a</font></div><div><font size="2"   >4</font></div></div><div><div><font size="2"   >&gt; t = {foo0(), foo2()}</font></div><div><font size="2"   >&gt; for i = 1,#t do &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >print(t[i])</font></div><div><font size="2"   >i = i+1</font></div><div><font size="2"   >end</font></div><div><font size="2"   >nil</font></div><div><font size="2"   >a</font></div><div><font size="2"   >b</font></div></div><div><div><font size="2"   >&gt; print(foo2(),1) &nbsp;<span style="line-height: 28px;"   >&nbsp;-- 在这里, 也要注意, 后面有值的情况下, 多值函数都只取一个值.</span></font></div><div><font size="2"   >a &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >&gt; print(foo2())</font></div><div><font size="2"   >a &nbsp; &nbsp; &nbsp; b</font></div></div><p></p></pre></div><div><br></div><div><br><wbr><div><br></div><div><br></div></div></div></div>
	</div>
</div>
</body>
</html>