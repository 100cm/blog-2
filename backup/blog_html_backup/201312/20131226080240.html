<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">lua计算"序列型table"数据类型元素个数的"诡异"</h2>
	<h5 id="">2013-12-26 8:02:40&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201311267554161/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>序列型的table指没有气泡的一串list, 如a[1],a[2],...a[10]是一个长度为10的序列型表, 那么#a=10.</div><div>但是如果a[1],a[3],a[10]这样存储的话#a=1; 因为出现了气泡.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; c={}</font></div><div><font size="2"   >&gt; c[1]=10</font></div><div><font size="2"   >&gt; c[3]=1</font></div><div><font size="2"   >&gt; = #c</font></div><div><font size="2"   >1</font></div><p></p></pre></div><div>#a表示的是序列型的表数据类型的长度.&nbsp;</div><div>因此不难解释以下.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; d={}</font></div><div><font size="2"   >&gt; d[2]=10</font></div><div><font size="2"   >&gt; = #d</font></div><div><font size="2"   >0</font></div><p></p></pre></div><div>因为序列型的表的index协定是从1开始计数的.</div><div><br></div><wbr>lua在计算table数据类型存储的元素个数时比较"诡异".<wbr><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; a = {1,2;"hello","nihao";4,5}</font></div><div><font size="2"   >&gt; = #a</font></div><div><font size="2"   >6</font></div><p></p></pre></div><div>这个表有6个元素可以理解. 接下来这个元素就变成4个了. 貌似没有记录中间两个, 因为他们的下标用法和"数组"型的表不太一样.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&gt; a = {1,2;x="hello",y="nihao";4,5}</font></div><div><font size="2"   >&gt; return &nbsp;#a</font></div><div><font size="2"   >4</font></div></div><div><div><font size="2"   >&gt; return a[1]</font></div><div><font size="2"   >1</font></div><div><font size="2"   >&gt; return a[4]</font></div><div><font size="2"   >5</font></div></div><div><div><font size="2"   >&gt; return a["x"]</font></div><div><font size="2"   >hello</font></div><div><font size="2"   >&gt; return a.y</font></div><div><font size="2"   >nihao</font></div></div><p></p></pre></div><div>另外还有需要注意的是, 当元素中有nil值时, 也不会记录进去.</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; a = {}</font></div><div><font size="2"   >&gt; a[100] = "hello"</font></div><div><font size="2"   >&gt; = #a</font></div><div><font size="2"   >0</font></div><p></p></pre></div><div>为什么显示元素个数为0, 因为a[1]没有值. 我估计lua计算元素个数时从a[1]开始一个一个去检索, 直至a[n]=nil, 那么元素个数就是n-1.</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; = a[1]</font></div><div><font size="2"   >nil</font></div><div><font size="2"   >&gt; a[1] = "nihao"</font></div><div><font size="2"   >&gt; = #a</font></div><div><font size="2"   >1</font></div><p></p></pre></div><div>所以这种类型的表元素显示为0, 因为它的a[1]=nil</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&gt; a = {x=1, y=2}</font></div><div><font size="2"   >&gt; = #a</font></div><div><font size="2"   >0</font></div></div><div><div><font size="2"   >&gt; = a[1]</font></div><div><font size="2"   >nil</font></div></div><p></p></pre></div><div>但是更诡异的是, 以下怎么理解呢? 是不是因为它是初始化时指定的表呢, 所以可以显示出6个元素?</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; a = {1,2,nil,nil,3,4}</font></div><div><font size="2"   >&gt; = #a</font></div><div><font size="2"   >6</font></div><p></p></pre></div><div>那么未初始化, 而后定义的表就不会显示6个元素, 例如</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; a = {}</font></div><div><font size="2"   >&gt; a[1] = 1</font></div><div><font size="2"   >&gt; a[2] = 2</font></div><div><font size="2"   >&gt; a[3] = nil</font></div><div><font size="2"   >&gt; a[4] = nil</font></div><div><font size="2"   >&gt; a[5] = 3</font></div><div><font size="2"   >&gt; a[6] = 4</font></div><div><font size="2"   >&gt; = #a</font></div><div><font size="2"   >2</font></div><p></p></pre></div><div>以上表lua显示只有2个元素.</div><div>乖乖, 为什么这样初始化的表, 元素个数又变成2了, 相比<span style="line-height: 28px;"   >{1,2,nil,nil,3,4},&nbsp;</span><span style="line-height: 28px;"   >只是末尾多了几个nil呀,</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; a = {1,2,nil,nil,3,4,nil,nil,nil}</font></div><div><font size="2"   >&gt; = #a</font></div><div><font size="2"   >2</font></div><div><font size="2"   >&gt; a = {1,2,nil,nil,3,4,nil}</font></div><div><font size="2"   >&gt; return &nbsp;#a</font></div><div><font size="2"   >2</font></div><p></p></pre></div>另外一位哥们也写过一篇关于这种诡异的BLOG<div><a target="_blank" rel="nofollow" href="http://blog.csdn.net/dssdss123/article/details/12676329"   >http://blog.csdn.net/dssdss123/article/details/12676329</a></div><div>意见就是不要随意在lua的table中使用nil.</div></div>
	</div>
</div>
</body>
</html>