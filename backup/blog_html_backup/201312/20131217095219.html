<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL SERIALIZABLE ISOLATION LEVEL introduce</h2>
	<h5 id="">2013-12-17 9:52:19&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013111795219541/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>Serializable 隔离级别</div><div>目标是模拟serializable的隔离级别事务的提交顺序转换为串行的执行顺序.&nbsp;</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Start session a serializable</font></div><div><font size="2"   >Start session b serializable</font></div><div><font size="2"   >Session a SQL …</font></div><div><font size="2"   >Session b SQL …</font></div><div><font size="2"   >Session a|b SQL …&nbsp;</font></div><div><font size="2"   >…. Session a|b SQL …&nbsp;</font></div><div><font size="2"   >Commit b</font></div><div><font size="2"   >Commit a</font></div><p></p></pre></div><div>这个场景模拟成 &nbsp;:&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Start session b&nbsp;</font></div><div><font size="2"   >Sql …</font></div><div><font size="2"   >Commit b</font></div><div><font size="2"   >Start session a</font></div><div><font size="2"   >Sql … &nbsp;如果会话a读过的数据在B中被变更, 那么a会话将提交失败.</font></div><div><font size="2"   >Commit a</font></div><p></p></pre></div><div><br></div><div><div>PostgreSQL 串行事务隔离级别的实现, 通过对扫描过的数据加载预锁来实现(内存中的一种弱冲突锁, 只在事务结束时判断是否有数据依赖性的冲突)</div><div>因为涉及到扫描的数据, 所以这种锁和执行计划有关.</div><div><br></div><div>例如</div><div>Select * from tbl where a=1;</div><div>如果没有索引, 那么是全表扫描, 需要扫描所有的数据块.</div><div>加载的预锁是表级别的预锁. (那么期间如果其他串行事务对这个表有任何变更, 包括插入,删除,更新等. 并且先提交的话.)</div><div>这个会话结束的时候会发现预加锁的数据被其他串行事务变更了, 所以会提交失败.</div><div><br></div><div>如果a上有索引的话, 执行计划走索引的情况下, 扫描的数据包括行和索引页.</div><div>那么加载的预锁包含行和索引页.</div><div>这种情况仅当其他串行事务在此期间变更了相对应的行或者是索引页才会在结束时发生冲突.</div></div><div><br></div><div><br></div><div>例子1</div><div>全表扫描, 表级预锁</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >会话A :&nbsp;</font></div><div><font size="2"   >digoal=# select pg_backend_pid();</font></div><div><font size="2"   >-[ RECORD 1 ]--+------</font></div><div><font size="2"   >pg_backend_pid | 12186</font></div><div><font size="2"   >会话B :&nbsp;</font></div><div><font size="2"   >digoal=# select pg_backend_pid();</font></div><div><font size="2"   >-[ RECORD 1 ]--+------</font></div><div><font size="2"   >pg_backend_pid | 12222</font></div><div><font size="2"   >会话A :&nbsp;</font></div><div><font size="2"   >digoal=# truncate iso_test ;</font></div><div><font size="2"   >TRUNCATE TABLE</font></div><div><font size="2"   >digoal=# insert into iso_test select generate_series(1,100000);</font></div><div><font size="2"   >INSERT 0 100000</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# begin ISOLATION LEVEL SERIALIZABLE;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >digoal=# select sum(id) from iso_test where id=100;</font></div><div><font size="2"   >-[ RECORD 1 ]</font></div><div><font size="2"   >sum | 100</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >会话 C :&nbsp;</font></div><div><font size="2"   >digoal=# select relation::regclass,* from pg_locks where pid in (12186,12222);</font></div><div><font size="2"   >&nbsp;relation | &nbsp;locktype &nbsp;| database | relation | page | tuple | virtualxid | transactionid | classid | objid | objsubid | virtualtrans</font></div><div><font size="2"   >action | &nbsp;pid &nbsp;| &nbsp; &nbsp; &nbsp;mode &nbsp; &nbsp; &nbsp; | granted | fastpath&nbsp;</font></div><div><font size="2"   >----------+------------+----------+----------+------+-------+------------+---------------+---------+-------+----------+-------------</font></div><div><font size="2"   >-------+-------+-----------------+---------+----------</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993 &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;| 12186 | AccessShareLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 1/157993 &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993 &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;| 12186 | ExclusiveLock &nbsp; | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993 &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;| 12186 | SIReadLock &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >(3 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >会话 B :&nbsp;</font></div><div><font size="2"   >digoal=# begin ISOLATION LEVEL SERIALIZABLE;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >digoal=# select sum(id) from iso_test where id=10;</font></div><div><font size="2"   >-[ RECORD 1 ]</font></div><div><font size="2"   >sum | 10</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >会话 C :&nbsp;</font></div><div><font size="2"   >digoal=# select relation::regclass,* from pg_locks where pid in (12186,12222);</font></div><div><font size="2"   >&nbsp;relation | &nbsp;locktype &nbsp;| database | relation | page | tuple | virtualxid | transactionid | classid | objid | objsubid | virtualtrans</font></div><div><font size="2"   >action | &nbsp;pid &nbsp;| &nbsp; &nbsp; &nbsp;mode &nbsp; &nbsp; &nbsp; | granted | fastpath&nbsp;</font></div><div><font size="2"   >----------+------------+----------+----------+------+-------+------------+---------------+---------+-------+----------+-------------</font></div><div><font size="2"   >-------+-------+-----------------+---------+----------</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993 &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;| 12186 | AccessShareLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 1/157993 &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993 &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;| 12186 | ExclusiveLock &nbsp; | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312 &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;| 12222 | AccessShareLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 2/6433312 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312 &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;| 12222 | ExclusiveLock &nbsp; | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993 &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;| 12186 | SIReadLock &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312 &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;| 12222 | SIReadLock &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >(6 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >会话 A :&nbsp;</font></div><div><font size="2"   >digoal=# insert into iso_test values (1,'test');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >会话 B :&nbsp;</font></div><div><font size="2"   >digoal=# insert into iso_test values (2,'test');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >会话 C :&nbsp;</font></div><div><font size="2"   >digoal=# select relation::regclass,* from pg_locks where pid in (12186,12222);</font></div><div><font size="2"   >&nbsp;relation | &nbsp; locktype &nbsp; &nbsp;| database | relation | page | tuple | virtualxid | transactionid | classid | objid | objsubid | virtualtr</font></div><div><font size="2"   >ansaction | &nbsp;pid &nbsp;| &nbsp; &nbsp; &nbsp; mode &nbsp; &nbsp; &nbsp; | granted | fastpath&nbsp;</font></div><div><font size="2"   >----------+---------------+----------+----------+------+-------+------------+---------------+---------+-------+----------+----------</font></div><div><font size="2"   >----------+-------+------------------+---------+----------</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | RowExclusiveLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 1/157993 &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12222 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12222 | RowExclusiveLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 2/6433312 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12222 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | transactionid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 316732564 | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | transactionid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 316732565 | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12222 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12222 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >(10 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >会话 A :</font></div><div><font size="2"   >digoal=# commit;</font></div><div><font size="2"   >COMMIT</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >会话 C :&nbsp;</font></div><div><font size="2"   >digoal=# select relation::regclass,* from pg_locks where pid in (12186,12222);</font></div><div><font size="2"   >&nbsp;relation | &nbsp; locktype &nbsp; &nbsp;| database | relation | page | tuple | virtualxid | transactionid | classid | objid | objsubid | virtualtr</font></div><div><font size="2"   >ansaction | &nbsp;pid &nbsp;| &nbsp; &nbsp; &nbsp; mode &nbsp; &nbsp; &nbsp; | granted | fastpath&nbsp;</font></div><div><font size="2"   >----------+---------------+----------+----------+------+-------+------------+---------------+---------+-------+----------+----------</font></div><div><font size="2"   >----------+-------+------------------+---------+----------</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12222 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12222 | RowExclusiveLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 2/6433312 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12222 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | transactionid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 316732565 | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12222 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/157993&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;iso_test | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433312</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12222 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >(6 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >会话 B :&nbsp;</font></div><div><font size="2"   >digoal=# commit;</font></div><div><font size="2"   >ERROR: &nbsp;could not serialize access due to read/write dependencies among transactions</font></div><div><font size="2"   >DETAIL: &nbsp;Reason code: Canceled on identification as a pivot, during commit attempt.</font></div><div><font size="2"   >HINT: &nbsp;The transaction might succeed if retried.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >会话 C :&nbsp;</font></div><div><font size="2"   >digoal=# select relation::regclass,* from pg_locks where pid in (12186,12222);</font></div><div><font size="2"   >&nbsp;relation | locktype | database | relation | page | tuple | virtualxid | transactionid | classid | objid | objsubid | virtualtransac</font></div><div><font size="2"   >tion | pid | mode | granted | fastpath&nbsp;</font></div><div><font size="2"   >----------+----------+----------+----------+------+-------+------------+---------------+---------+-------+----------+---------------</font></div><div><font size="2"   >-----+-----+------+---------+----------</font></div><div><font size="2"   >(0 rows)</font></div><p></p></pre></div><div><br></div><div>例子2</div><div>行锁和索引页锁, 并且索引页为同一页的情况. 同样发生冲突.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >同样的场景, 加索引测试 :&nbsp;</font></div><div><font size="2"   >digoal=# create index idx_iso_test_1 on iso_test (id);</font></div><div><font size="2"   >CREATE INDEX</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# begin ISOLATION LEVEL SERIALIZABLE;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >digoal=# select sum(id) from iso_test where id=100;</font></div><div><font size="2"   >-[ RECORD 1 ]</font></div><div><font size="2"   >sum | 100</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select relation::regclass,* from pg_locks where pid in (12186,12222);</font></div><div><font size="2"   >&nbsp; &nbsp; relation &nbsp; &nbsp;| &nbsp;locktype &nbsp;| database | relation | page | tuple | virtualxid | transactionid | classid | objid | objsubid | virtua</font></div><div><font size="2"   >ltransaction | &nbsp;pid &nbsp;| &nbsp; &nbsp; &nbsp;mode &nbsp; &nbsp; &nbsp; | granted | fastpath&nbsp;</font></div><div><font size="2"   >----------------+------------+----------+----------+------+-------+------------+---------------+---------+-------+----------+-------</font></div><div><font size="2"   >-------------+-------+-----------------+---------+----------</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1579</font></div><div><font size="2"   >96 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | AccessShareLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1579</font></div><div><font size="2"   >96 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | AccessShareLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 1/157996 &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1579</font></div><div><font size="2"   >96 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | ExclusiveLock &nbsp; | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | tuple &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp;0 | &nbsp; 100 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1579</font></div><div><font size="2"   >96 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | SIReadLock &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | page &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1579</font></div><div><font size="2"   >96 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | SIReadLock &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# begin ISOLATION LEVEL SERIALIZABLE;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >digoal=# select sum(id) from iso_test where id=10;</font></div><div><font size="2"   >-[ RECORD 1 ]</font></div><div><font size="2"   >sum | 10</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select relation::regclass,* from pg_locks where pid in (12186,12222);</font></div><div><font size="2"   >&nbsp; &nbsp; relation &nbsp; &nbsp;| &nbsp;locktype &nbsp;| database | relation | page | tuple | virtualxid | transactionid | classid | objid | objsubid | virtua</font></div><div><font size="2"   >ltransaction | &nbsp;pid &nbsp;| &nbsp; &nbsp; &nbsp;mode &nbsp; &nbsp; &nbsp; | granted | fastpath&nbsp;</font></div><div><font size="2"   >----------------+------------+----------+----------+------+-------+------------+---------------+---------+-------+----------+-------</font></div><div><font size="2"   >-------------+-------+-----------------+---------+----------</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1579</font></div><div><font size="2"   >96 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | AccessShareLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1579</font></div><div><font size="2"   >96 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | AccessShareLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 1/157996 &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1579</font></div><div><font size="2"   >96 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | ExclusiveLock &nbsp; | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433</font></div><div><font size="2"   >314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | AccessShareLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | relation &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433</font></div><div><font size="2"   >314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | AccessShareLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 2/6433314 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433</font></div><div><font size="2"   >314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | ExclusiveLock &nbsp; | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | tuple &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp;0 | &nbsp; 100 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1579</font></div><div><font size="2"   >96 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | SIReadLock &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | tuple &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp;0 | &nbsp; &nbsp;10 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433</font></div><div><font size="2"   >314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | SIReadLock &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | page &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1579</font></div><div><font size="2"   >96 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | SIReadLock &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | page &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433</font></div><div><font size="2"   >314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | SIReadLock &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >(10 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# insert into iso_test values (1,'test');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select relation::regclass,* from pg_locks where pid in (12186,12222);</font></div><div><font size="2"   >&nbsp; &nbsp; relation &nbsp; &nbsp;| &nbsp; locktype &nbsp; &nbsp;| database | relation | page | tuple | virtualxid | transactionid | classid | objid | objsubid | vir</font></div><div><font size="2"   >tualtransaction | &nbsp;pid &nbsp;| &nbsp; &nbsp; &nbsp; mode &nbsp; &nbsp; &nbsp; | granted | fastpath&nbsp;</font></div><div><font size="2"   >----------------+---------------+----------+----------+------+-------+------------+---------------+---------+-------+----------+----</font></div><div><font size="2"   >----------------+-------+------------------+---------+----------</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | RowExclusiveLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 1/157996 &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 2/6433314 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | transactionid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 316732567 | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | tuple &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp;0 | &nbsp; 100 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | tuple &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp;0 | &nbsp; &nbsp;10 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | page &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | page &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >(12 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# insert into iso_test values (2,'test');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select relation::regclass,* from pg_locks where pid in (12186,12222);</font></div><div><font size="2"   >&nbsp; &nbsp; relation &nbsp; &nbsp;| &nbsp; locktype &nbsp; &nbsp;| database | relation | page | tuple | virtualxid | transactionid | classid | objid | objsubid | vir</font></div><div><font size="2"   >tualtransaction | &nbsp;pid &nbsp;| &nbsp; &nbsp; &nbsp; mode &nbsp; &nbsp; &nbsp; | granted | fastpath&nbsp;</font></div><div><font size="2"   >----------------+---------------+----------+----------+------+-------+------------+---------------+---------+-------+----------+----</font></div><div><font size="2"   >----------------+-------+------------------+---------+----------</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | RowExclusiveLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 1/157996 &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | AccessShareLock &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | relation &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | RowExclusiveLock | t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | virtualxid &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | 2/6433314 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | transactionid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 316732567 | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | transactionid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 316732568 | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | ExclusiveLock &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | tuple &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp;0 | &nbsp; 100 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;iso_test &nbsp; &nbsp; &nbsp; | tuple &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;92992 | &nbsp; &nbsp;0 | &nbsp; &nbsp;10 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | page &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1/1</font></div><div><font size="2"   >57996 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 12186 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | page &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6</font></div><div><font size="2"   >433314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | SIReadLock &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >(14 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# commit;</font></div><div><font size="2"   >COMMIT</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# commit;</font></div><div><font size="2"   >ERROR: &nbsp;could not serialize access due to read/write dependencies among transactions</font></div><div><font size="2"   >DETAIL: &nbsp;Reason code: Canceled on identification as a pivot, during commit attempt.</font></div><div><font size="2"   >HINT: &nbsp;The transaction might succeed if retried.</font></div><div><font size="2"   >索引页用了同一个, 并且被插入语句更新了. 所以发生了冲突</font></div><p></p></pre></div><div><br></div><div>例子3</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >行数和索引页锁, 但是索引页为不同的页面</font></div><div><div><font size="2"   >如果其中一个插入的值不在1号索引页则没有问题, 例如</font></div><div><br></div><div><font size="2"   >digoal=# begin ISOLATION LEVEL SERIALIZABLE;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >digoal=# select sum(id) from iso_test where id=100;</font></div><div><font size="2"   >-[ RECORD 1 ]</font></div><div><font size="2"   >sum | 100</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# insert into iso_test values (1,'test');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# commit;</font></div><div><font size="2"   >COMMIT</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# begin ISOLATION LEVEL SERIALIZABLE;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >digoal=# select sum(id) from iso_test where id=10;</font></div><div><font size="2"   >-[ RECORD 1 ]</font></div><div><font size="2"   >sum | 10</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# insert into iso_test values (200000,'test');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# commit;</font></div><div><font size="2"   >COMMIT</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >(200000,'test') 这个索引页不在1号</font></div><div><font size="2"   >&nbsp;idx_iso_test_1 | page &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp;16384 | &nbsp; &nbsp;93017 | &nbsp;275 | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2/6433</font></div><div><font size="2"   >316 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12222 | SIReadLock &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; | f</font></div></div><p></p></pre></div><div><div><br></div><div>参考 :&nbsp;</div></div><div><a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/transaction-iso.html"   >http://www.postgresql.org/docs/9.3/static/transaction-iso.html</a></div><div><a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/runtime-config-developer.html"   >http://www.postgresql.org/docs/9.3/static/runtime-config-developer.html</a></div><div><br></div><div><br></div><wbr></div>
	</div>
</div>
</body>
</html>