<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">在PostgreSQL中用线性回归分析linear regression做预测 - 例子1</h2>
	<h5 id="">2015-03-04 17:37:07&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020152452827897/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>本文是一个简单的一元线性回归的例子, 需要了解相关理论知识可参考 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201523112651593/"   >http://blog.163.com/digoal@126/blog/static/163877040201523112651593/</a></div><div><br></div><div>数据来自股票的收盘价.</div><div>如果要做多元分析, 请自行增加维度(例如大盘指数,成交量,最低,最高价,价格区间等等都可以那里做回归计算), 计算期望值.</div><div><br></div><div>例子如下 :&nbsp;</div><div>按实际顺序录入test, 如时间从小到大, ID从小到大, 最终目标是用前一个值预测下一个值</div><div>第一条记录是最老的值, 最后一条记录是最新的值, 不要搞反了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create table test(id int, cnt numeric);</font></div><div></div><p></p></pre></div><div>-- 以下是网友提供的阿里巴巴的收盘价数据</div><div>-- 格式 date,close,volume,open,high,low</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi ali.txt</font></div><div><font size="2"   >2015/3/3,81.58,39173430,82.95,83.25,80.03</font></div><div><font size="2"   >2015/3/2,84,11175870,85,85.02,83.75</font></div><div><font size="2"   >2015/2/27,85.12,8362081,85.95,86.56,85</font></div><div><font size="2"   >2015/2/26,85.37,8758019,86.92,87.16,85.2</font></div><div><font size="2"   >2015/2/25,86.19,13592080,84.38,86.83,84.36</font></div><div><font size="2"   >2015/2/24,84.69,15817560,85.53,85.53,83.88</font></div><div><font size="2"   >2015/2/23,85.47,9352529,86.51,86.68,85.25</font></div><div><font size="2"   >2015/2/20,86.64,7805009,87.25,87.29,86.38</font></div><div><font size="2"   >2015/2/19,86.89,7568275,86.81,87.87,86.71</font></div><div><font size="2"   >2015/2/18,86.74,7415961,87.1,87.43,86.5</font></div><div><font size="2"   >2015/2/17,86.85,15133130,88.78,88.99,86.7</font></div><div><font size="2"   >2015/2/13,89.05,14587390,88.2,89.3,87.65</font></div><div><font size="2"   >2015/2/12,87.1,15143910,85.6,88.3,85.55</font></div><div><font size="2"   >2015/2/11,86,12281340,87.58,87.7,85.82</font></div><div><font size="2"   >2015/2/10,87.26,12026260,87.01,87.47,86.52</font></div><div><font size="2"   >2015/2/9,86,12088070,85.83,86.75,85.47</font></div><div><font size="2"   >2015/2/6,85.68,17597490,87.11,87.4,85.42</font></div><div><font size="2"   >2015/2/5,87,28867570,89.58,89.84,86.1</font></div><div><font size="2"   >2015/2/4,90,14599400,90.99,91.88,89.48</font></div><div><font size="2"   >2015/2/3,90.61,13475970,91.65,91.65,89.9</font></div><div><font size="2"   >2015/2/2,90.13,18845140,91.13,91.66,88.61</font></div><div><font size="2"   >2015/1/30,89.08,36747370,89.6,92,88.11</font></div><div><font size="2"   >2015/1/29,89.81,76430640,90.53,90.74,87.36</font></div><div><font size="2"   >2015/1/28,98.45,42012700,100.3,101.49,97.79</font></div><div><font size="2"   >2015/1/27,102.94,15591560,102.89,103.57,100.58</font></div><div><font size="2"   >2015/1/26,103.99,10656340,104.4,105.13,103.33</font></div><div><font size="2"   >2015/1/23,103.11,9860504,104.02,105.2,103.02</font></div><div><font size="2"   >2015/1/22,104,11400180,104.6,104.92,103.1</font></div><div><font size="2"   >2015/1/21,103.29,15141470,100.75,103.86,100.32</font></div><div><font size="2"   >2015/1/20,100.04,12049470,98.3,100.21,97.59</font></div><div><font size="2"   >2015/1/16,96.89,13313120,96.09,97.8,95.52</font></div><div><font size="2"   >2015/1/15,96.31,18182200,99.67,100.14,96.02</font></div><div><font size="2"   >2015/1/14,99.58,17785990,99.28,100.18,98.06</font></div><div><font size="2"   >2015/1/13,100.77,11275790,102.59,102.85,100.01</font></div><div><font size="2"   >2015/1/12,101.62,7946740,103.2,103.36,101.21</font></div><div><font size="2"   >2015/1/9,103.02,10193410,105.24,105.3,102.89</font></div><div><font size="2"   >2015/1/8,105.03,12904640,102.95,105.3399,102.68</font></div><div><font size="2"   >2015/1/7,102.13,11000010,104.59,104.74,102.03</font></div><div><font size="2"   >2015/1/6,103.32,15662710,101.25,103.85,100.11</font></div><div><font size="2"   >2015/1/5,101,18313750,102.76,103.02,99.9</font></div><div><font size="2"   >2015/1/2,103.6,12286400,104.24,104.72,102.52</font></div><div><font size="2"   >2014/12/31,103.94,10254350,106.46,106.47,103.69</font></div><div><font size="2"   >2014/12/30,105.75,10185890,105.64,106.71,105.13</font></div><div><font size="2"   >2014/12/29,105.98,8059191,105.95,107.66,105.64</font></div><div><font size="2"   >2014/12/26,105.95,6523956,105.99,106.94,105.5</font></div><div><font size="2"   >2014/12/24,105.95,5870358,105.68,107.21,105.6</font></div><div><font size="2"   >2014/12/23,105.52,19077270,108.3,108.47,103.88</font></div><div><font size="2"   >2014/12/22,108.77,12985130,110.63,110.98,108.53</font></div><div><font size="2"   >2014/12/19,110.65,14785340,109.93,110.65,108.04</font></div><div><font size="2"   >2014/12/18,109.25,22749890,110.58,111.2,108.26</font></div><div><font size="2"   >2014/12/17,109.02,17242940,107.11,109.19,106.28</font></div><div><font size="2"   >2014/12/16,105.77,21655360,103.75,107.68,103.7</font></div><div><font size="2"   >2014/12/15,104.7,16476750,106.39,107.77,103.7</font></div><div><font size="2"   >2014/12/12,105.11,14504050,104.7,107.45,104.179</font></div><div><font size="2"   >2014/12/11,104.97,15658440,104.44,106.84,104.29</font></div><div><font size="2"   >2014/12/10,103.88,18398440,107.09,107.38,103.51</font></div><div><font size="2"   >2014/12/9,107.48,24805130,102.27,107.95,101.2</font></div><div><font size="2"   >2014/12/8,105.07,19166550,105.97,107.4,104.2101</font></div><div><font size="2"   >2014/12/5,107.9,12125090,109.6,110.35,107.76</font></div><div><font size="2"   >2014/12/4,109.17,10790400,110.1,110.5,108.91</font></div><div><font size="2"   >2014/12/3,110.64,16164860,110.4,111.68,108.798</font></div><p></p></pre></div><div><br></div><div>-- &nbsp;导入数据库</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create table tmp(c1 text,c2 numeric,c3 numeric,c4 numeric,c5 numeric,c6 numeric);</font></div><div><font size="2"   >copy tmp from '/home/postgres/ali.txt' with (format csv);</font></div><p></p></pre></div><div><br></div><div>-- &nbsp;调换一下顺序</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >insert into test select row_number() over(order by ctid desc), c2 from tmp;</font></div><div></div><p></p></pre></div><div>-- 校验函数</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >CREATE OR REPLACE FUNCTION public.check_predict(<br>IN ov integer,   --  校验哪条记录<br>OUT rv numeric,  --  真实值<br>OUT pv numeric,  --  预测值<br>OUT dev numeric, --  误差<br>OUT zv numeric,  --  自变量<br>OUT v_slope numeric, --  斜率<br>OUT v_inter numeric, --  截距<br>OUT v_r2  numeric  --  相关性<br>)<br> RETURNS record<br> LANGUAGE plpgsql<br>AS $function$<br>declare <br>  r2_1 numeric := 0; -- 相关性<br>  r2_2 numeric := 0; -- 最大相关性<br>  var int;           --  样本起点<br>  inter_1 numeric;  --  截距<br>  slope_1 numeric;  --  斜率<br>  inter_2 numeric;  --  最大相关性截距<br>  slope_2 numeric;  --  最大相关性斜率<br>  realv numeric;    --  真实数据<br>  predicv numeric;  --  预测数据<br>  offset_var int := ov;   -- 倒数第?个值的预测值, 不停迭代, 最后计算所有的实际值和预测值的corr, 选择最佳相关?<br>  v_cnt int8 := 0;<br>  v_lmt int := 90;  --  使用的最大样本集, 影响预测准确度<br>  v_min int := 5;   --  使用的最小样本数, 影响预测准确度<br>  zcnt numeric := 0;    --  自变量<br>begin<br>  select count(*) into v_cnt from test;<br><br>  --  自变量 t1<br>  --  因变量 t2<br><br>  --  筛选最大相关度的样本数, 并记录下储斜率, 截距.<br>  for i in 0..v_lmt <br>  loop<br>    with t1 as (select row_number() over(order by id desc) as rn,* from (select id,lag(cnt,1) over(order by id) as zbl_cnt,cnt from test order by id desc offset offset_var limit v_lmt+v_min) t<br>                where t.zbl_cnt is not null<br>	       )<br>      select regr_intercept(t1.cnt,t1.zbl_cnt), regr_slope(t1.cnt,t1.zbl_cnt), regr_r2(t1.cnt,t1.zbl_cnt) <br>        into inter_1,slope_1,r2_1<br>      from t1<br>      where t1.rn&lt;=i+v_min;<br>    <br>    if r2_1&gt;r2_2 then <br>      inter_2 := inter_1;<br>      slope_2 := slope_1;<br>      r2_2 := r2_1;<br>      var := i+v_min;<br>    end if;<br>  end loop;<br><br>  raise notice 'offset:%, 最大相关度样本数:%, 截距%, 斜率%, 相关性%', offset_var, var, round(inter_2,4), round(slope_2,4), round(r2_2,4);<br>  select slope_2*cnt+inter_2, cnt into predicv,zcnt from test order by id desc offset offset_var limit 1;<br>  <br>  --  offset_var=0的自变量, 表示最近一个值, 所以真实值还不存在, 那么realv=NULL<br>  if  offset_var=0 then<br>    realv := NULL;<br>  else<br>    select cnt into realv from test order by id desc offset offset_var-1 limit 1;<br>  end if;<br><br>  raise notice '自变量%, 真实数据%, 预测数据%, 本次预测偏差%%%', zcnt, realv, round(predicv,2), abs(1-round(predicv/realv,4))*100;<br><br>  rv := realv;<br>  pv := round(predicv,2);<br>  dev := abs(1-round(predicv/realv,4));<br>  zv  := zcnt;<br>  v_slope := slope_2;<br>  v_inter := inter_2;<br>  v_r2 := r2_2;<br><br>  return;<br>end;<br>$function$;</span></font></div><p></p></pre></div><div><br></div><div>-- &nbsp;预测结果偏差较大, 看dev这列显示偏差</div><div>(如果你的数据包含今天的收盘价格的数据的话, 第一行就是预测的明天的收盘价格)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select (check_predict(i)).* from generate_series(0,50) t(i);</font></div><div><div><font size="2"   >&nbsp; &nbsp;rv &nbsp; | &nbsp; pv &nbsp; | &nbsp;dev &nbsp; | &nbsp; zv &nbsp; | &nbsp; &nbsp; &nbsp;v_slope &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;v_inter &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;v_r2 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >--------+--------+--------+--------+--------------------+--------------------+--------------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; | &nbsp;81.50 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;81.58 | &nbsp;0.930196213911424 | &nbsp; 5.61421408650552 | &nbsp;0.461071168376043</font></div><div><font size="2"   >&nbsp; 81.58 | &nbsp;84.90 | 0.0407 | &nbsp; &nbsp; 84 | &nbsp;0.560745221248429 | &nbsp; 37.8015394128117 | &nbsp; 0.23571694348864</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;84 | &nbsp;85.84 | 0.0219 | &nbsp;85.12 | &nbsp;0.416036492272315 | &nbsp; &nbsp;50.428211921701 | &nbsp;0.160707728559778</font></div><div><font size="2"   >&nbsp; 85.12 | &nbsp;86.06 | 0.0110 | &nbsp;85.37 | &nbsp; 0.31332110091768 | &nbsp; 59.3087633551948 | 0.0916611831863153</font></div><div><font size="2"   >&nbsp; 85.37 | &nbsp;86.40 | 0.0121 | &nbsp;86.19 | &nbsp;0.223065327998904 | &nbsp; 67.1752208792373 | 0.0892441401437571</font></div><div><font size="2"   >&nbsp; 86.19 | &nbsp;85.51 | 0.0078 | &nbsp;84.69 | &nbsp;0.509756185614852 | &nbsp; &nbsp;42.343562005006 | &nbsp;0.338718526733452</font></div><div><font size="2"   >&nbsp; 84.69 | &nbsp;85.97 | 0.0151 | &nbsp;85.47 | &nbsp; 0.60492702580558 | &nbsp; 34.2628366224153 | &nbsp;0.408610576552954</font></div><div><font size="2"   >&nbsp; 85.47 | &nbsp;86.86 | 0.0163 | &nbsp;86.64 | &nbsp;0.641095276611868 | &nbsp; 31.3167837973076 | &nbsp;0.422562923551744</font></div><div><font size="2"   >&nbsp; 86.64 | &nbsp;87.06 | 0.0049 | &nbsp;86.89 | &nbsp; &nbsp;0.6396258966744 | &nbsp; 31.4865883689919 | &nbsp;0.442022365274712</font></div><div><font size="2"   >&nbsp; 86.89 | &nbsp;87.31 | 0.0048 | &nbsp;86.74 | &nbsp;0.314176461801723 | &nbsp; 60.0558838893752 | &nbsp;0.345972028763493</font></div><div><font size="2"   >&nbsp; 86.74 | &nbsp;87.07 | 0.0038 | &nbsp;86.85 | &nbsp;0.556953610508981 | &nbsp; 38.6967242480077 | &nbsp;0.709038352162874</font></div><div><font size="2"   >&nbsp; 86.85 | &nbsp;88.54 | 0.0194 | &nbsp;89.05 | &nbsp; 0.71646536311035 | &nbsp; 24.7355217235248 | &nbsp;0.806474667992637</font></div><div><font size="2"   >&nbsp; 89.05 | &nbsp;86.82 | 0.0250 | &nbsp; 87.1 | &nbsp;0.828893551212771 | &nbsp; 14.6233989516049 | &nbsp;0.843205122436764</font></div><div><font size="2"   >&nbsp; &nbsp;87.1 | &nbsp;85.63 | 0.0169 | &nbsp; &nbsp; 86 | &nbsp;0.876681721784925 | &nbsp; 10.2362647858593 | &nbsp;0.868757340937373</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;86 | &nbsp;86.79 | 0.0092 | &nbsp;87.26 | &nbsp;0.907607969680494 | &nbsp; 7.59324024469571 | &nbsp;0.872354617595825</font></div><div><font size="2"   >&nbsp; 87.26 | &nbsp;85.35 | 0.0219 | &nbsp; &nbsp; 86 | &nbsp;0.963046324742614 | &nbsp; 2.52920153372814 | &nbsp;0.854052902081886</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;86 | &nbsp;85.04 | 0.0111 | &nbsp;85.68 | &nbsp;0.984857752501153 | &nbsp;0.658717160003272 | &nbsp;0.818153667442131</font></div><div><font size="2"   >&nbsp; 85.68 | &nbsp;86.65 | 0.0113 | &nbsp; &nbsp; 87 | &nbsp;0.968673034113725 | &nbsp; &nbsp;2.3751701572406 | &nbsp;0.782575372168168</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;87 | &nbsp;90.00 | 0.0345 | &nbsp; &nbsp; 90 | &nbsp;0.910991684444145 | &nbsp; 8.01456054235934 | &nbsp;0.742602997511869</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;90 | &nbsp;90.69 | 0.0076 | &nbsp;90.61 | &nbsp;0.897821640533335 | &nbsp; 9.33440206466203 | &nbsp;0.713122343798605</font></div><div><font size="2"   >&nbsp; 90.61 | &nbsp;90.13 | 0.0053 | &nbsp;90.13 | &nbsp;0.909958318693295 | &nbsp; 8.11836657246885 | &nbsp;0.676080976394243</font></div><div><font size="2"   >&nbsp; 90.13 | &nbsp;88.54 | 0.0177 | &nbsp;89.08 | &nbsp;0.959429536023691 | &nbsp; 3.07240205281187 | &nbsp;0.608007093767562</font></div><div><font size="2"   >&nbsp; 89.08 | &nbsp;89.76 | 0.0076 | &nbsp;89.81 | &nbsp; 0.91029848144619 | &nbsp; 8.00500306348446 | &nbsp;0.404654669040077</font></div><div><font size="2"   >&nbsp; 89.81 | &nbsp;99.27 | 0.1054 | &nbsp;98.45 | &nbsp;0.657207082561843 | &nbsp; 34.5727385355619 | &nbsp;0.393214748683796</font></div><div><font size="2"   >&nbsp; 98.45 | 102.53 | 0.0415 | 102.94 | &nbsp;0.704409588700779 | &nbsp; 30.0196224514047 | &nbsp;0.502462865561183</font></div><div><font size="2"   >&nbsp;102.94 | 103.45 | 0.0049 | 103.99 | &nbsp;0.703297557503838 | &nbsp; 30.3100075437914 | &nbsp; 0.46367875870034</font></div><div><font size="2"   >&nbsp;103.99 | 102.47 | 0.0147 | 103.11 | &nbsp; 0.62837962126522 | &nbsp; 37.6738507164757 | &nbsp;0.403487822887036</font></div><div><font size="2"   >&nbsp;103.11 | 103.10 | 0.0001 | &nbsp; &nbsp;104 | &nbsp;0.643348564991283 | &nbsp; 36.1926878205066 | &nbsp;0.412471976813411</font></div><div><font size="2"   >&nbsp; &nbsp; 104 | 102.47 | 0.0147 | 103.29 | &nbsp;0.609715827989882 | &nbsp; 39.4938840550046 | &nbsp;0.434204693264911</font></div><div><font size="2"   >&nbsp;103.29 | 100.19 | 0.0300 | 100.04 | &nbsp;0.714689142171646 | &nbsp; 28.6965783703781 | &nbsp;0.579882468389968</font></div><div><font size="2"   >&nbsp;100.04 | &nbsp;96.87 | 0.0317 | &nbsp;96.89 | &nbsp;0.891706172449747 | &nbsp; 10.4761802869589 | &nbsp;0.673676693300631</font></div><div><font size="2"   >&nbsp; 96.89 | &nbsp;95.65 | 0.0128 | &nbsp;96.31 | &nbsp;0.996480964507578 | -0.324693104249417 | &nbsp;0.614510491219348</font></div><div><font size="2"   >&nbsp; 96.31 | &nbsp;99.98 | 0.0381 | &nbsp;99.58 | &nbsp;0.805484441868333 | &nbsp; 19.7717089277751 | &nbsp;0.512838450280928</font></div><div><font size="2"   >&nbsp; 99.58 | 101.72 | 0.0215 | 100.77 | &nbsp;0.580782945386486 | &nbsp; 43.1942330487114 | &nbsp;0.411626746536197</font></div><div><font size="2"   >&nbsp;100.77 | 102.31 | 0.0153 | 101.62 | &nbsp; 0.60960923807431 | &nbsp; 40.3630398853694 | &nbsp;0.534574960836081</font></div><div><font size="2"   >&nbsp;101.62 | 103.28 | 0.0163 | 103.02 | &nbsp;0.715901485259652 | &nbsp; 29.5241464649391 | &nbsp;0.578753862361246</font></div><div><font size="2"   >&nbsp;103.02 | 104.93 | 0.0185 | 105.03 | &nbsp;0.755513345311285 | &nbsp; 25.5752266330287 | &nbsp;0.637919333414959</font></div><div><font size="2"   >&nbsp;105.03 | 102.17 | 0.0272 | 102.13 | &nbsp; 0.85397742981656 | &nbsp; 14.9562551932185 | &nbsp;0.706505426646503</font></div><div><font size="2"   >&nbsp;102.13 | 103.39 | 0.0123 | 103.32 | &nbsp;0.816331012523094 | &nbsp; 19.0456461040167 | &nbsp;0.678069331200632</font></div><div><font size="2"   >&nbsp;103.32 | &nbsp;97.81 | 0.0533 | &nbsp; &nbsp;101 | &nbsp; 1.59944623063686 | &nbsp;-63.7322919498157 | &nbsp;0.754678672545085</font></div><div><font size="2"   >&nbsp; &nbsp; 101 | 103.53 | 0.0251 | &nbsp;103.6 | &nbsp;0.863779780883968 | &nbsp; 14.0441886225418 | &nbsp;0.661109144730258</font></div><div><font size="2"   >&nbsp; 103.6 | 103.94 | 0.0033 | 103.94 | &nbsp;0.838387460079692 | &nbsp; 16.7970520107185 | &nbsp;0.577059699997509</font></div><div><font size="2"   >&nbsp;103.94 | 105.92 | 0.0191 | 105.75 | -0.133229605047718 | &nbsp; 120.010159783732 | &nbsp;0.804055392782976</font></div><div><font size="2"   >&nbsp;105.75 | 105.93 | 0.0017 | 105.98 | -0.145112549418295 | &nbsp; 121.311379359051 | &nbsp;0.969009451994014</font></div><div><font size="2"   >&nbsp;105.98 | 105.95 | 0.0003 | 105.95 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; 105.949999994131 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >&nbsp;105.95 | 105.89 | 0.0005 | 105.95 | &nbsp;-0.13230769230761 | &nbsp; 119.911107692316 | &nbsp; 0.99999999999768</font></div><div><font size="2"   >&nbsp;105.95 | &nbsp;99.90 | 0.0571 | 105.52 | &nbsp; 1.72872340425854 | &nbsp;-82.5132446808904 | &nbsp; 1.00000000000077</font></div><div><font size="2"   >&nbsp;105.52 | 111.29 | 0.0547 | 108.77 | &nbsp;-1.34285714286032 | &nbsp; 257.357142857695 | &nbsp; 1.00000000000725</font></div><div><font size="2"   >&nbsp;108.77 | 119.17 | 0.0956 | 110.65 | &nbsp; 6.08695652160159 | &nbsp;-554.349999972815 | &nbsp; 1.00000000000081</font></div><div><font size="2"   >&nbsp;110.65 | 109.27 | 0.0125 | 109.25 | 0.0707692307696992 | &nbsp; &nbsp;101.53473846147 | &nbsp;0.999999999967684</font></div><div><font size="2"   >&nbsp;109.25 | 118.89 | 0.0883 | 109.02 | &nbsp; 3.03738317759831 | &nbsp;-212.244018694157 | &nbsp; 1.00000000001163</font></div><div><font size="2"   >(51 rows)</font></div></div><p></p></pre></div><div><br></div><div>贵州茅台的结果</div><div>预测偏差还比较理想(可能有些股票受到的外界因素影响较大, 有些比较小, 因为本文没有引入多元分析, 就这样吧)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select (check_predict(i)).* from generate_series(0,50) t(i);</font></div><div><font size="2"   >&nbsp; &nbsp;rv &nbsp; | &nbsp; pv &nbsp; | &nbsp;dev &nbsp; | &nbsp; zv &nbsp; | &nbsp; &nbsp; &nbsp;v_slope &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;v_inter &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; v_r2 &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >--------+--------+--------+--------+-------------------+-------------------+-------------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; | 155.68 | &nbsp; &nbsp; &nbsp; &nbsp;| 154.75 | 0.749327368763041 | &nbsp;39.7193487454018 | 0.443299946747894</font></div><div><font size="2"   >&nbsp;154.75 | 156.33 | 0.0102 | 155.00 | 0.658983381690956 | &nbsp;54.1888692212598 | &nbsp;0.31605703462515</font></div><div><font size="2"   >&nbsp;155.00 | 158.61 | 0.0233 | 157.81 | 0.505691375378367 | &nbsp;78.8096738403756 | 0.240429553874766</font></div><div><font size="2"   >&nbsp;157.81 | 159.35 | 0.0097 | 159.02 | 0.471362121189687 | &nbsp;84.3914502631931 | &nbsp;0.23632158869318</font></div><div><font size="2"   >&nbsp;159.02 | 159.89 | 0.0055 | 159.87 | 0.502631474677655 | &nbsp;79.5350129389031 | 0.262084379639135</font></div><div><font size="2"   >&nbsp;159.87 | 160.46 | 0.0037 | 161.00 | 0.486478989379233 | &nbsp;82.1377272523488 | &nbsp;0.29236983925612</font></div><div><font size="2"   >&nbsp;161.00 | 161.73 | 0.0045 | 162.74 | 0.592859008065614 | &nbsp;65.2441140525351 | &nbsp;0.38051931752417</font></div><div><font size="2"   >&nbsp;162.74 | 161.22 | 0.0094 | 162.33 | 0.522125410976863 | &nbsp;76.4612098979163 | 0.450724600316921</font></div><div><font size="2"   >&nbsp;162.33 | 161.07 | 0.0078 | 161.50 | 0.670999115633002 | &nbsp;52.7013374696206 | 0.535249445391989</font></div><div><font size="2"   >&nbsp;161.50 | 160.77 | 0.0045 | 160.92 | &nbsp;0.72782591656929 | &nbsp;43.6501486130006 | 0.574758659704234</font></div><div><font size="2"   >&nbsp;160.92 | 156.66 | 0.0264 | 156.49 | 0.885275616598876 | &nbsp;18.1277330183775 | 0.655113491671201</font></div><div><font size="2"   >&nbsp;156.49 | 157.82 | 0.0085 | 156.70 | 0.757494701869893 | &nbsp; &nbsp;39.12388483696 | 0.495319263616962</font></div><div><font size="2"   >&nbsp;156.70 | 161.18 | 0.0286 | 160.71 | 0.725555251667536 | &nbsp;44.5773888438119 | 0.584398418586498</font></div><div><font size="2"   >&nbsp;160.71 | 160.13 | 0.0036 | 159.25 | 0.718340613774721 | &nbsp;45.7320036637828 | 0.626975960572309</font></div><div><font size="2"   >&nbsp;159.25 | 158.92 | 0.0021 | 158.02 | 0.776715149169011 | &nbsp;36.1819821709587 | 0.676670415905896</font></div><div><font size="2"   >&nbsp;158.02 | 159.06 | 0.0066 | 158.47 | 0.812642712296025 | &nbsp;30.2825991865648 | 0.679920408166994</font></div><div><font size="2"   >&nbsp;158.47 | 160.77 | 0.0145 | 160.50 | 0.824536957368669 | &nbsp;28.4277502764865 | 0.708045226118134</font></div><div><font size="2"   >&nbsp;160.50 | 161.95 | 0.0090 | 161.90 | 0.843561194042496 | &nbsp;25.3766280000652 | 0.722573245190375</font></div><div><font size="2"   >&nbsp;161.90 | 161.51 | 0.0024 | 161.49 | 0.847987413256958 | &nbsp;24.5663395825434 | 0.721633674185219</font></div><div><font size="2"   >&nbsp;161.49 | 163.60 | 0.0131 | 163.87 | 0.870581601947346 | &nbsp;20.9406294921026 | 0.725206713695765</font></div><div><font size="2"   >&nbsp;163.87 | 163.51 | 0.0022 | 163.70 | 0.833749346623708 | &nbsp;27.0240967784583 | 0.670383837164832</font></div><div><font size="2"   >&nbsp;163.70 | 168.62 | 0.0301 | 167.65 | &nbsp;1.05254359115864 | -7.83507005049674 | 0.735574587910647</font></div><div><font size="2"   >&nbsp;167.65 | 165.25 | 0.0143 | 165.70 | 0.883481284376093 | &nbsp;18.8595907684336 | 0.566222610315986</font></div><div><font size="2"   >&nbsp;165.70 | 163.61 | 0.0126 | 164.70 | 0.760665237060595 | &nbsp;38.3314388491422 | 0.437037290387292</font></div><div><font size="2"   >&nbsp;164.70 | 161.46 | 0.0197 | 162.58 | &nbsp;0.63926420779486 | &nbsp;57.5312362089702 | 0.386820980329109</font></div><div><font size="2"   >&nbsp;162.58 | 158.80 | 0.0232 | 158.81 | 0.717636038072266 | &nbsp;44.8353807921515 | 0.569066830110592</font></div><div><font size="2"   >&nbsp;158.81 | 158.34 | 0.0030 | 158.20 | 0.761022139545313 | &nbsp;37.9453143278904 | 0.597076723252649</font></div><div><font size="2"   >&nbsp;158.20 | 156.01 | 0.0138 | 156.00 | 0.890859569629593 | &nbsp;17.0349264413836 | 0.660262576219616</font></div><div><font size="2"   >&nbsp;156.00 | 155.91 | 0.0006 | 156.00 | 0.928603251444626 | &nbsp; 11.051262047026 | 0.569697453056979</font></div><div><font size="2"   >&nbsp;156.00 | 158.28 | 0.0146 | 157.72 | 0.723658951735034 | &nbsp;44.1435343246399 | &nbsp;0.44078135697188</font></div><div><font size="2"   >&nbsp;157.72 | 159.30 | 0.0100 | 158.50 | 0.593435970103012 | &nbsp;65.2440679649604 | 0.394699579585899</font></div><div><font size="2"   >&nbsp;158.50 | 159.91 | 0.0089 | 159.27 | 0.632807705774723 | &nbsp;59.1184436985211 | 0.387382904311161</font></div><div><font size="2"   >&nbsp;159.27 | 160.63 | 0.0085 | 160.00 | 0.604419927649386 | &nbsp;63.9233718732132 | 0.330175855885006</font></div><div><font size="2"   >&nbsp;160.00 | 162.13 | 0.0133 | 162.00 | 0.479607769753778 | &nbsp;84.4368575468047 | 0.257868311166715</font></div><div><font size="2"   >&nbsp;162.00 | 159.99 | 0.0124 | 158.74 | 0.624745284091551 | &nbsp;60.8132213491609 | 0.426844197393141</font></div><div><font size="2"   >&nbsp;158.74 | 160.57 | 0.0115 | 159.75 | &nbsp; 0.6106793906001 | &nbsp;63.0161876923878 | 0.337283942825567</font></div><div><font size="2"   >&nbsp;159.75 | 161.95 | 0.0138 | 162.00 | 0.453875422780405 | &nbsp;88.4214116897916 | 0.235385451808691</font></div><div><font size="2"   >&nbsp;162.00 | 162.13 | 0.0008 | 162.20 | 0.514218487026421 | &nbsp;78.7230165782795 | 0.291003288858034</font></div><div><font size="2"   >&nbsp;162.20 | 162.09 | 0.0007 | 162.02 | 0.556324729871488 | &nbsp;71.9532675373276 | 0.326799171637252</font></div><div><font size="2"   >&nbsp;162.02 | 162.16 | 0.0009 | 162.04 | 0.579222185293716 | &nbsp;68.3028288619664 | 0.344557168377077</font></div><div><font size="2"   >&nbsp;162.04 | 162.16 | 0.0007 | 161.81 | 0.556599549002475 | &nbsp;72.0969606318282 | 0.307924224254188</font></div><div><font size="2"   >&nbsp;161.81 | 162.66 | 0.0052 | 162.48 | 0.500693143269678 | &nbsp; 81.305630489949 | 0.298678253677398</font></div><div><font size="2"   >&nbsp;162.48 | 162.22 | 0.0016 | 161.96 | 0.568957052943135 | &nbsp;70.0759551450734 | 0.346462148633283</font></div><div><font size="2"   >&nbsp;161.96 | 162.89 | 0.0057 | 163.10 | &nbsp;0.39281014679101 | &nbsp;98.8215502236369 | 0.340803249529129</font></div><div><font size="2"   >&nbsp;163.10 | 164.15 | 0.0065 | 164.80 | 0.640630057919025 | &nbsp;58.5763291969098 | 0.536313525971144</font></div><div><font size="2"   >&nbsp;164.80 | 163.63 | 0.0071 | 164.00 | &nbsp; 0.7153108267714 | &nbsp;46.3161409479079 | 0.611327694763799</font></div><div><font size="2"   >&nbsp;164.00 | 162.73 | 0.0078 | 163.00 | 0.671618352789207 | &nbsp;53.2545511273858 | 0.679718050633678</font></div><div><font size="2"   >&nbsp;163.00 | 160.66 | 0.0144 | 160.17 | 0.646714009825995 | &nbsp;57.0713176290233 | 0.804063835532055</font></div><div><font size="2"   >&nbsp;160.17 | 159.11 | 0.0066 | 158.29 | 0.769358075679891 | &nbsp;37.3298385738639 | 0.848976826898375</font></div><div><font size="2"   >&nbsp;158.29 | 161.29 | 0.0190 | 160.74 | 0.845694258048787 | &nbsp;25.3560723887127 | 0.887140705169265</font></div><div><font size="2"   >&nbsp;160.74 | 165.13 | 0.0273 | 164.30 | 0.928055617122675 | &nbsp;12.6470087942632 | 0.910309053795291</font></div><div><font size="2"   >(51 rows)</font></div><p></p></pre></div><div><br></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="在PostgreSQL中用线性回归分析linear regression做预测 - 例子 - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>