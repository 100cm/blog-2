<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">INSTALL PL/R in PostgreSQL</h2>
	<h5 id="">2015-03-06 11:40:13&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020152610576813/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>PL/R在CentOS 6.x + PostgreSQL 9.4.1的安装, 相当方便.</div><div><br></div><div>首先安装R</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum localinstall --nogpgcheck https://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</font></div><div><font size="2"   ># yum install R</font></div><div><font size="2"   ># rpm -qa|grep R</font></div><div><font size="2"   >ORBit2-devel-2.14.17-5.el6.x86_64</font></div><div><font size="2"   >R-core-devel-3.1.2-1.el6.x86_64</font></div><div><font size="2"   >ORBit2-2.14.17-5.el6.x86_64</font></div><div><font size="2"   >libRmath-3.1.2-1.el6.x86_64</font></div><div><font size="2"   >R-devel-3.1.2-1.el6.x86_64</font></div><div><font size="2"   >perl-URI-1.40-2.el6.noarch</font></div><div><font size="2"   >perl-Compress-Raw-Zlib-2.021-136.el6_6.1.x86_64</font></div><div><font size="2"   >libRmath-devel-3.1.2-1.el6.x86_64</font></div><div><font size="2"   >R-core-3.1.2-1.el6.x86_64</font></div><div><font size="2"   >R-java-3.1.2-1.el6.x86_64</font></div><div><font size="2"   >R-3.1.2-1.el6.x86_64</font></div><div><font size="2"   >R-java-devel-3.1.2-1.el6.x86_64</font></div><p></p></pre></div><div>安装pl/r时需要用到R的LIB库, 如果没有的话, 请安装R-DEVEL, 如果你是编译安装的R, 编译参数请加上<span style="line-height: 28px;"   >--enable-R-shlib</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># ldconfig -p|grep R</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libRlapack.so (libc6,x86-64) =&gt; /usr/lib64/R/lib/libRlapack.so</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libRblas.so (libc6,x86-64) =&gt; /usr/lib64/R/lib/libRblas.so</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libR.so (libc6,x86-64) =&gt; /usr/lib64/R/lib/libR.so</font></div><div><font size="2"   >#&nbsp;</font></div><p></p></pre></div><div><br></div><div>下载plr源码包</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># wget http://www.joeconway.com/plr/plr-8.3.0.16.tar.gz</font></div><div><font size="2"   ># tar -zxvf plr-8.3.0.16.tar.gz</font></div><div><font size="2"   ># export PATH=/opt/pgsql9.4.1/bin:$PATH</font></div><div><font size="2"   ># which pg_config</font></div><div><font size="2"   >/opt/pgsql9.4.1/bin/pg_config</font></div><p></p></pre></div><div>将plr目录拷贝到postgresql源码包的contrib下.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># mv plr /opt/soft_bak/postgresql-9.4.1/contrib/</font></div><div><font size="2"   ># cd /opt/soft_bak/postgresql-9.4.1/contrib/plr/</font></div><div><font size="2"   >[plr ~]# gmake clean</font></div><div><font size="2"   >[plr ~]# gmake</font></div><div><font size="2"   >[plr ~]# gmake install</font></div><p></p></pre></div><div><br></div><div>在PostgreSQL数据库中创建extension.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># su - postgres</font></div><div><font size="2"   >&gt; psql</font></div><div><font size="2"   >psql (9.4.1)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >postgres=# create extension plr;</font></div><div><font size="2"   >CREATE EXTENSION</font></div><div><div><font size="2"   >postgres=# select * from pg_language ;</font></div><div><font size="2"   >&nbsp;lanname &nbsp;| lanowner | lanispl | lanpltrusted | lanplcallfoid | laninline | lanvalidator | lanacl&nbsp;</font></div><div><font size="2"   >----------+----------+---------+--------------+---------------+-----------+--------------+--------</font></div><div><font size="2"   >&nbsp;internal | &nbsp; &nbsp; &nbsp; 10 | f &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 2246 |&nbsp;</font></div><div><font size="2"   >&nbsp;c &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; 10 | f &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 2247 |&nbsp;</font></div><div><font size="2"   >&nbsp;sql &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; 10 | f &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 2248 |&nbsp;</font></div><div><font size="2"   >&nbsp;plpgsql &nbsp;| &nbsp; &nbsp; &nbsp; 10 | t &nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 12672 | &nbsp; &nbsp; 12673 | &nbsp; &nbsp; &nbsp; &nbsp;12674 |&nbsp;</font></div><div><font size="2"   >&nbsp;plr &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; 10 | t &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 16769 | &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >(5 rows)</font></div></div><p></p></pre></div><div>从上面可以看到plr不是一个受信任语言, 只有超级用户可以创建它的函数, 需要执行的话, 可以赋予给普通用户执行.</div><div><br></div><div>使用注意</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >Notes:</font></div><div><font size="2"   >&nbsp; &nbsp; - R headers are required. Download and install R prior to building</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; PL/R.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; - R must have been built with the --enable-R-shlib option when it was</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; configured, in order for the libR shared object library to be available.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; - R_HOME must be defined in the environment of the user under which</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; PostgreSQL is started, before the postmaster is started. Otherwise</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; PL/R will refuse to load.</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >Tip: If a language is installed into template1, all subsequently created databases will have the language installed automatically.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Tip: In addition to the documentation, the plr.out.* files in plr/expected are a good source of usage examples.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Tip: R headers are required. Download and install R prior to building PL/R. R must have been built with the --enable-R-shlib option when it was configured, in order for the libR shared object library to be available.</font></div></div><p></p></pre></div><div><div><br></div><div>注意把R的lib库放到搜索路径中, CentOS可修改/etc/ld.so.conf, 执行ldconfig刷新.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Tip: Additionally, libR must be findable by your runtime linker. On Linux, this involves adding an entry in /etc/ld.so.conf for the location of libR (typically $R_HOME/bin or $R_HOME/lib), and then running ldconfig. Refer to man ldconfig or its equivalent for your system.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Tip: R_HOME must be defined in the environment of the user under which PostgreSQL is started, before the postmaster is started. Otherwise PL/R will refuse to load. See plr_environ(), which allows examination of the environment available to the PostgreSQL postmaster process.</font></div><p></p></pre></div></div><div><br></div><div>获取环境变量</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select plr_environ();</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;plr_environ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;(MANPATH,/opt/pgsql/share/man:)</font></div><div><font size="2"   >&nbsp;(HOSTNAME,db-172-16-3-150.sky-mobi.com)</font></div><div><font size="2"   >&nbsp;(TERM,vt100)</font></div><div><font size="2"   >&nbsp;(SHELL,/bin/bash)</font></div><div><font size="2"   >&nbsp;(HISTSIZE,1000)</font></div><div><font size="2"   >&nbsp;(PG_GRANDPARENT_PID,23733)</font></div><div><font size="2"   >&nbsp;(QTDIR,/usr/lib64/qt-3.3)</font></div><div><font size="2"   >&nbsp;(QTINC,/usr/lib64/qt-3.3/include)</font></div><div><font size="2"   >&nbsp;(USER,postgres)</font></div><div><font size="2"   >&nbsp;(LS_COLORS,rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=3</font></div><div><font size="2"   >0;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;</font></div><div><font size="2"   >31:*.txz=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lz=01;31:*.xz=01;31:*.bz2=01;31:*.tbz=01;31:*.tbz2=01;31:*.bz</font></div><div><font size="2"   >=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=0</font></div><div><font size="2"   >1;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff</font></div><div><font size="2"   >=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.o</font></div><div><font size="2"   >gm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.f</font></div><div><font size="2"   >lc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv</font></div><div><font size="2"   >=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mp</font></div><div><font size="2"   >c=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:)</font></div><div><font size="2"   >&nbsp;(PGPORT,1921)</font></div><div><font size="2"   >&nbsp;(LD_LIBRARY_PATH,/opt/pgsql/lib:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib:)</font></div><div><font size="2"   >&nbsp;(PGDATABASE,postgres)</font></div><div><font size="2"   >&nbsp;(DATE,201503061109)</font></div><div><font size="2"   >&nbsp;(PATH,/opt/pgsql/bin:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/postgres/bin:.)</font></div><div><font size="2"   >&nbsp;(MAIL,/var/spool/mail/postgres)</font></div><div><font size="2"   >&nbsp;(_,/opt/pgsql9.4.1/bin/postgres)</font></div><div><font size="2"   >&nbsp;(PWD,/home/postgres)</font></div><div><font size="2"   >&nbsp;(LANG,en_US.utf8)</font></div><div><font size="2"   >&nbsp;(MODULEPATH,/usr/share/Modules/modulefiles:/etc/modulefiles)</font></div><div><font size="2"   >&nbsp;(PGHOST,/data02/pgdata/pg_root)</font></div><div><font size="2"   >&nbsp;(LOADEDMODULES,"")</font></div><div><font size="2"   >&nbsp;(PGSYSCONFDIR,/opt/pgsql9.4.1/etc)</font></div><div><font size="2"   >&nbsp;(PGHOME,/opt/pgsql)</font></div><div><font size="2"   >&nbsp;(HISTCONTROL,ignoredups)</font></div><div><font size="2"   >&nbsp;(HOME,/home/postgres)</font></div><div><font size="2"   >&nbsp;(SHLVL,2)</font></div><div><font size="2"   >&nbsp;(LOGNAME,postgres)</font></div><div><font size="2"   >&nbsp;(CVS_RSH,ssh)</font></div><div><font size="2"   >&nbsp;(QTLIB,/usr/lib64/qt-3.3/lib)</font></div><div><font size="2"   >&nbsp;(MODULESHOME,/usr/share/Modules)</font></div><div><font size="2"   >&nbsp;(LESSOPEN,"||/usr/bin/lesspipe.sh %s")</font></div><div><font size="2"   >&nbsp;(PGDATA,/data02/pgdata/pg_root)</font></div><div><font size="2"   >&nbsp;(G_BROKEN_FILENAMES,1)</font></div><div><font size="2"   >&nbsp;("BASH_FUNC_module()","() { &nbsp;eval `/usr/bin/modulecmd bash $*` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp;}")</font></div><div><font size="2"   >&nbsp;(LC_COLLATE,C)</font></div><div><font size="2"   >&nbsp;(LC_CTYPE,C)</font></div><div><font size="2"   >&nbsp;(LC_MESSAGES,C)</font></div><div><font size="2"   >&nbsp;(LC_MONETARY,C)</font></div><div><font size="2"   >&nbsp;(LC_NUMERIC,C)</font></div><div><font size="2"   >&nbsp;(LC_TIME,C)</font></div><div><font size="2"   >(41 rows)</font></div><p></p></pre></div><div><br></div><div>使用举例 :&nbsp;</div><div>最强大实用的部分还是聚合和窗口.</div><div>plr目前不支持在线代码执行.</div><div><div>postgres=# do language plr $$</div><div>postgres$# $$;</div><div>ERROR: &nbsp;language "plr" does not support inline code execution</div></div><div>所以还是老实创建函数吧.</div><div>还有一种特殊的用法, 当PG函数名和R本身提供的函数名一致时, 可以投射过去, 例如R有一个标准方差的函数sd().</div><div>可以通过这种方法来创建一个PG函数, 例如, 函数体内不需要任何内容 创建一个参数为数组的函数sd, _float8是数组类型的真实名称, float8[]也行.</div><div>返回标准差</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># create or replace function sd(_float8) returns float as '' language 'plr';</font></div><div><div><font size="2"   ># select round(sd('{1.23,1.31,1.42,1.27}'::_float8)::numeric,8);</font></div><div><font size="2"   >&nbsp; &nbsp;round &nbsp; &nbsp;</font></div><div><font size="2"   >------------</font></div><div><font size="2"   >&nbsp;0.08180261</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>Greenplum下安装参考</div></div><div><a target="_blank" rel="nofollow" href="http://gpdb.docs.pivotal.io/4340/index.html#ref_guide/pl_r.html"   >http://gpdb.docs.pivotal.io/4340/index.html#ref_guide/pl_r.html</a></div><div><br></div><div>[参考]</div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://www.joeconway.com/plr/doc/plr-install.html"   >http://www.joeconway.com/plr/doc/plr-install.html</a><br><wbr><div>2.&nbsp;<a target="_blank" rel="nofollow" href="http://www.joeconway.com/plr/"   >http://www.joeconway.com/plr/</a></div><div>3.&nbsp;<a target="_blank" rel="nofollow" href="https://github.com/jconway/plr"   >https://github.com/jconway/plr</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://cran.r-project.org/"   >http://cran.r-project.org/</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.joeconway.com/plr/doc/index.html"   >http://www.joeconway.com/plr/doc/index.html</a></div><div>6.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://faculty.washington.edu/tlumley/Rcourse/"   >http://faculty.washington.edu/tlumley/Rcourse/</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="INSTALL PL/R in PostgreSQL - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>