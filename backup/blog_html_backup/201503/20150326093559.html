<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.5 plpgsql add ASSERT statement for bug detect</h2>
	<h5 id="">2015-03-26 9:35:59&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201522693559872/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 9.5 添加了一个plpgsql支持的语法, 可以用于检测BUG,&nbsp;</div><div>ASSERT condition [, message];</div><div>如果没有BUG的情况下, condition表达式应该返回TRUE, 如果返回FALSE或NULL视为BUG并抛出异常.</div><div>例如我们在一个函数中处理帐务逻辑, 可以使用ASSERT来检查用户帐户的钱是否为正数, 如果为负数则返回FALSE并抛出异常. &nbsp;例如 :&nbsp;</div><div>ASSERT v_amount &gt;= 0;</div><div><br></div><div>详见 :&nbsp;</div><div><a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/plpgsql-errors-and-messages.html"   >http://www.postgresql.org/docs/devel/static/plpgsql-errors-and-messages.html</a></div><div><h2 style="margin: 2ex 0em 1.2em; color: rgb(102, 102, 102); font-family: verdana, sans-serif; line-height: normal; font-size: 1.2em !important;"   ><a id="PLPGSQL-STATEMENTS-ASSERT" name="PLPGSQL-STATEMENTS-ASSERT" rel="nofollow"   >40.8.2. Checking Assertions</a></h2><p style="font-size: 12.1599998474121px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >The&nbsp;<tt>ASSERT</tt>&nbsp;statement is a convenient shorthand for inserting debugging checks into&nbsp;<span>PL/pgSQL</span>&nbsp;functions.</p><pre style="font-size: 1em; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 1px solid rgb(207, 207, 207); padding: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow: auto; border-radius: 8px; line-height: normal; background-color: rgb(247, 247, 247);"   >ASSERT <tt style="font-weight: bold; font-style: italic; font-size: 1em;"   >condition</tt> [<span> , <tt style="font-weight: bold; font-style: italic; font-size: 1em;"   >message</tt> </span>];
</pre><p style="font-size: 12.1599998474121px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >The&nbsp;<tt style="font-weight: bold; font-style: italic;"   >condition</tt>&nbsp;is a boolean expression that is expected to always evaluate to TRUE; if it does, the&nbsp;<tt>ASSERT</tt>&nbsp;statement does nothing further. If the result is FALSE or NULL, then an<tt>ASSERT_FAILURE</tt>&nbsp;exception is raised. (If an error occurs while evaluating the&nbsp;<tt style="font-weight: bold; font-style: italic;"   >condition</tt>, it is reported as a normal error.)</p><p style="font-size: 12.1599998474121px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >If the optional&nbsp;<tt style="font-weight: bold; font-style: italic;"   >message</tt>&nbsp;is provided, it is an expression whose result (if not null) replaces the default error message text&nbsp;<span>"assertion failed"</span>, should the&nbsp;<tt style="font-weight: bold; font-style: italic;"   >condition</tt>&nbsp;fail. The&nbsp;<tt style="font-weight: bold; font-style: italic;"   >message</tt>&nbsp;expression is not evaluated in the normal case where the assertion succeeds.</p><p style="font-size: 12.1599998474121px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >Testing of assertions can be enabled or disabled via the configuration parameter&nbsp;<tt>plpgsql.check_asserts</tt>, which takes a boolean value; the default is&nbsp;<tt>on</tt>. If this parameter is&nbsp;<tt>off</tt>&nbsp;then&nbsp;<tt>ASSERT</tt>statements do nothing.</p><p style="font-size: 12.1599998474121px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >Note that&nbsp;<tt>ASSERT</tt>&nbsp;is meant for detecting program bugs, not for reporting ordinary error conditions. Use the&nbsp;<tt>RAISE</tt>&nbsp;statement, described above, for that.</p></div><div>代码 &nbsp;:&nbsp;</div><div><a target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=a4847fc3ef139ba9a8ffebb6ffa06ee72078ffa2"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=a4847fc3ef139ba9a8ffebb6ffa06ee72078ffa2</a></div><div><br></div><div>开启assert需要配置postgresql.conf参数 :&nbsp;</div><div>plpgsql.check_asserts &nbsp;= &nbsp;on</div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL 9.5 plpgsql add ASSERT statement for bug detect - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>