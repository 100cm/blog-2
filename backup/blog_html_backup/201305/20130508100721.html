<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.3 Allow a directory of configuration files to be processed</h2>
	<h5 id="">2013-05-08 10:07:21&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020134894315216/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>Allow a directory of configuration files to be processed (Magnus Hagander, Greg Smith, Selena Deckelmann)</div><div>Such a directory is specified with include_dir in the server configuration file.</div></div><div><br></div><div>PostgreSQL 9.2 :&nbsp;</div><div>已包含如下配置 :&nbsp;</div><div>1. include, 支持相对路径和绝对路径, 如果文件不存在这报错</div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >vi postgresql.conf</font></div><div style="line-height: 22px;"   ><font size="2"   ># 注意test.conf文件不存在</font></div><div style="line-height: 22px;"   ><font size="2"   >include 'test.conf'</font></div><p></p></pre></div><div style="line-height: 22px;"   >-- 加载失败. 报错退出</div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >pg92@db-172-16-3-33-&gt; pg_ctl stop -m fast</font></div><div style="line-height: 22px;"   ><font size="2"   >waiting for server to shut down.... done</font></div><div style="line-height: 22px;"   ><font size="2"   >server stopped</font></div><div style="line-height: 22px;"   ><font size="2"   >pg92@db-172-16-3-33-&gt; pg_ctl start</font></div><div style="line-height: 22px;"   ><font size="2"   >server starting</font></div><div style="line-height: 22px;"   ><font size="2"   >pg92@db-172-16-3-33-&gt; LOG: &nbsp;could not open configuration file "/pgdata1919/test.conf": No such file or directory</font></div><div style="line-height: 22px;"   ><font size="2"   >FATAL: &nbsp;configuration file "/pgdata1919/postgresql.conf" contains errors</font></div><p></p></pre></div><div style="line-height: 22px;"   ><br></div></div></div><div>2. include_if_exists 与include类似, 只是文件不存在时不会报错.</div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 22px;"   ><font size="2"   >vi postgresql.conf</font></div><div style="line-height: 22px;"   ><font size="2"   ># 注意test.conf文件不存在</font></div></div><div><div><font size="2"   >include_if_exists 'test.conf'</font></div></div><p></p></pre></div></div><div><div>-- 加载失败, 但是不会报错. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-33-&gt; pg_ctl start</font></div><div><font size="2"   >server starting</font></div><div><font size="2"   >pg92@db-172-16-3-33-&gt; LOG: &nbsp;skipping missing configuration file "/pgdata1919/test.conf"</font></div><p></p></pre></div></div><div><br></div><div><span style="line-height: 22px;"   >PostgreSQL 9.3 新增include_dir的支持 :&nbsp;</span></div><div>include_dir, 支持绝对路径和相对路径</div><div><pre class="prettyprint"   ><p><font size="2"   >Within that directory, only non-directory files whose names end with the suffix .conf will be included. File names that start with the . character are also excluded, to prevent mistakes as they are hidden on some platforms. Multiple files within an include directory are processed in filename order. The filenames are ordered by C locale rules, ie. numbers before letters, and uppercase letters before lowercase ones.</font></p></pre></div><div><span style="line-height: 22px;"   >目录中有多个配置文件时, 加载顺序和文件名有关. 数字,大写,小写. C locale顺序.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >cd $PGDATA</font></div><div><font size="2"   >mkdir test</font></div><div><font size="2"   >chmod 700 test</font></div><div><font size="2"   >vi postgresql.conf</font></div><div><font size="2"   >commit_delay=10</font></div><div><font size="2"   ># 末尾添加</font></div><div><font size="2"   >include_dir 'test'</font></div><div><font size="2"   >cd test</font></div><div><font size="2"   >vi 1.conf</font></div><div><font size="2"   >commit_delay=20</font></div><div><font size="2"   >vi 2.conf</font></div><div><span style="line-height: 22px;"   ><font size="2"   >commit_delay=30</font></span></div><div><font size="2"   >pg_ctl start</font></div><div><font size="2"   >psql</font></div><div><div><font size="2"   >digoal=# show commit_delay;</font></div><div><font size="2"   >&nbsp;commit_delay&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp;30</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><br></div><div>把include_dir='test' 放到postgresql.conf中commit_delay的前面.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg_ctl resetart -m fast</font></div><div><font size="2"   >重启数据库.</font></div><div><font size="2"   >psql</font></div><div><div><font size="2"   >digoal=# show commit_delay;</font></div><div><font size="2"   >&nbsp;commit_delay&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp;10</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>postgresql.conf中include或者include_dir的位置就是这些配置的插入点.</div><div><br></div><div>在postgresql.conf中配置2个commit_delay,&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi postgresql.conf</font></div><div><font size="2"   >include 'test'</font></div><div><font size="2"   >commit_delay=10</font></div><div><font size="2"   >commit_delay=100</font></div><div><font size="2"   >pg_ctl restart -m fast</font></div><div><font size="2"   >psql</font></div><div><div><font size="2"   >digoal=# show commit_delay;</font></div><div><font size="2"   >&nbsp;commit_delay&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp;100</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>包含重名参数时, 以最后一个为准.</div><div><br></div><div><span style="line-height: 22px;"   >[参考]</span></div><wbr><div>1.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=6d09b2105fb5fa6e6245e7b024bfbe465b1041ee"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=6d09b2105fb5fa6e6245e7b024bfbe465b1041ee</a></div><div>2.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=2a0c81a12c7e6c5ac1557b0f1f4a581f23fd4ca7"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=2a0c81a12c7e6c5ac1557b0f1f4a581f23fd4ca7</a></div><div>3.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/config-setting.html#CONFIG-INCLUDES"   >http://www.postgresql.org/docs/devel/static/config-setting.html#CONFIG-INCLUDES</a></div></div>
	</div>
</div>
</body>
</html>