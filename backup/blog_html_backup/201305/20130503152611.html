<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL notreal-time insert-only count(*) performance tuning case - 8</h2>
	<h5 id="">2013-05-03 15:26:11&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020134311144755/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">前面以及写了7篇关于count(*)准实时和实时统计的案例, 有基于触发器的, 有基于xid单线程取数据的.<div>本文的优化方法与londiste的ticket有点类似, 即数据切片.</div><div>将log表切分为多段, 这样的话如果分析线程串行处理速度跟不上的话, 可以并行处理. 有效的解决了<span style="line-height: 22px;"   >基于xid单线程取数据的性能问题.</span></div><div>具体的场景就不介绍了, 前面7篇按顺序读下来就知道了.</div><div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><div style="line-height: 25px;"   >1.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201331252945440/"   >http://blog.163.com/digoal@126/blog/static/163877040201331252945440/</a></div><div style="line-height: 25px;"   >2.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020133151402415/"   >http://blog.163.com/digoal@126/blog/static/16387704020133151402415/</a></div><div style="line-height: 25px;"   >3.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020133155179877/"   >http://blog.163.com/digoal@126/blog/static/16387704020133155179877/</a></div><div style="line-height: 25px;"   >4.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020133156636579/"   >http://blog.163.com/digoal@126/blog/static/16387704020133156636579/</a></div><div style="line-height: 25px;"   >5.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020133218305242/"   >http://blog.163.com/digoal@126/blog/static/16387704020133218305242/</a></div><div style="line-height: 25px;"   >6.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020133224161563/"   >http://blog.163.com/digoal@126/blog/static/16387704020133224161563/</a></div></div><span style="line-height: 22px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >7.&nbsp;</span><a style="line-height: 22px; text-decoration: none; color: rgb(85, 108, 136); font-family: Arial, Helvetica, simsun, u5b8bu4f53;" href="http://blog.163.com/digoal@126/blog/static/16387704020133271134563/"   >http://blog.163.com/digoal@126/blog/static/16387704020133271134563/</a><br>这里只介绍切片函数和取数据函数.<wbr></div><div><div>-- # 测试表 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create table log&nbsp;</font></div><div><font size="2"   >(</font></div><div><font size="2"   >&nbsp; id serial primary key,&nbsp;</font></div><div><font size="2"   >&nbsp; xid int8 default txid_current() not null,&nbsp;</font></div><div><font size="2"   >&nbsp; c1 int not null,&nbsp;</font></div><div><font size="2"   >&nbsp; c2 int not null,&nbsp;</font></div><div><font size="2"   >&nbsp; c3 int not null,&nbsp;</font></div><div><font size="2"   >&nbsp; c4 text not null,&nbsp;</font></div><div><font size="2"   >&nbsp; crt_time timestamp default now()</font></div><div><font size="2"   >);</font></div><div><font size="2"   >create index idx_log_1 on log(xid);</font></div><p></p></pre></div></div><div><br></div><div>-- 切片表</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create table log_ticket(&nbsp;</font></div><div><font size="2"   >&nbsp; id serial8 primary key,&nbsp;</font></div><div><font size="2"   >&nbsp; split_xid int8 not null default txid_current(), -- 切片时的xid, 取数据的事务的xid必须大于该xid</font></div><div><font size="2"   >&nbsp; split_time timestamp not null default now(),&nbsp;</font></div><div><font size="2"   >&nbsp; log_xid_le int8 not null,&nbsp;</font></div><div><font size="2"   >&nbsp; log_xid_st int8 not null,&nbsp;</font></div><div><font size="2"   >&nbsp; log_xip int8[],&nbsp;</font></div><div><font size="2"   >&nbsp; xid_readed boolean not null default false,&nbsp;</font></div><div><font size="2"   >&nbsp; xip_readed boolean not null default false</font></div><div><font size="2"   >);</font></div><p></p></pre></div><div><br></div><div>-- 切片函数</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create or replace function log_spilt(</font></div><div><font size="2"   >&nbsp; i_timeout_sec int, -- 上次切片以来超出多少秒, 则新增切片</font></div><div><font size="2"   >&nbsp; i_limit int &nbsp;-- 上次切片以来超出多少条, 则新增切片</font></div><div><font size="2"   >) returns void as $$</font></div><div><font size="2"   >declare</font></div><div><font size="2"   >&nbsp; v_advisory_xact_lock int8 := null; &nbsp;-- 串行处理锁.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; v_xid_snap txid_snapshot := null; &nbsp;-- 当前事务状态快照</font></div><div><font size="2"   >&nbsp; v_xmin int8 := null; &nbsp;-- 当前事务状态快照中未完成的最小事务</font></div><div><font size="2"   >&nbsp; v_xmax int8 := null; &nbsp;-- 当前事务状态快照中未分配的最小事务</font></div><div><font size="2"   >&nbsp; v_xip int8[] := null; &nbsp;-- 当前事务状态快照中未完成的事务数组</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; v_log_xid_le int8 := null; &nbsp;-- 大于等于该xid</font></div><div><font size="2"   >&nbsp; v_log_xid_st int8 := null; &nbsp;-- 小于该xid</font></div><div><font size="2"   >&nbsp; v_split_time timestamp := null; &nbsp;-- 上次切片时间</font></div><div><font size="2"   >&nbsp; v_cnt int := null; &nbsp;-- 从上次切片后有多少条log被插入了</font></div><div><font size="2"   >&nbsp; v_log_xip int8[] := null; &nbsp;-- 记录切片数据段内未完成的xid</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >begin</font></div><div><font size="2"   >&nbsp; -- 判断i_timeout_sec, i_limit</font></div><div><font size="2"   >&nbsp; if ( i_timeout_sec&lt;=0 or i_limit &lt;=0 ) then</font></div><div><font size="2"   >&nbsp; &nbsp; raise notice 'please ensure i_timeout_sec &gt; 0 and i_limit &gt; 0 .';</font></div><div><font size="2"   >&nbsp; &nbsp; return;</font></div><div><font size="2"   >&nbsp; end if;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; -- 串行处理, 如果不能获得锁则直接退出. 确保v_advisory_xact_lock全局唯一.</font></div><div><font size="2"   >&nbsp; v_advisory_xact_lock := 1;</font></div><div><font size="2"   >&nbsp; if not pg_try_advisory_xact_lock(v_advisory_xact_lock) then</font></div><div><font size="2"   >&nbsp; &nbsp; raise notice 'Another function is calling, this call will exit.';</font></div><div><font size="2"   >&nbsp; &nbsp; return;</font></div><div><font size="2"   >&nbsp; end if;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; -- 生成 xid snapshot 数据.</font></div><div><font size="2"   >&nbsp; v_xid_snap := txid_current_snapshot();</font></div><div><font size="2"   >&nbsp; v_xmin := txid_snapshot_xmin(v_xid_snap);</font></div><div><font size="2"   >&nbsp; v_xmax := txid_snapshot_xmax(v_xid_snap);</font></div><div><font size="2"   >&nbsp; select array_agg(t) into v_xip from txid_snapshot_xip(v_xid_snap) g(t);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; perform 1 from log_ticket limit 1;</font></div><div><font size="2"   >&nbsp; if found then</font></div><div><font size="2"   >&nbsp; &nbsp; select log_xid_st,split_time into v_log_xid_le,v_split_time from log_ticket order by split_xid desc limit 1;</font></div><div><font size="2"   >&nbsp; &nbsp; select count(*),(max(xid)+1) into v_cnt,v_log_xid_st from (select xid from log where xid &gt;= v_log_xid_le and xid &lt; v_xmax order by xid limit i_limit) t;</font></div><div><font size="2"   >&nbsp; &nbsp; if ( ((now()-v_split_time) &gt;= i_timeout_sec::text::interval or v_cnt&gt;=i_limit) and v_cnt&gt;=1 ) then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; select array_agg(i) into v_log_xip from unnest(v_xip) i where i&gt;=v_log_xid_le and i&lt;v_log_xid_st;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; insert into log_ticket(log_xid_le,log_xid_st,log_xip,xip_readed)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; values (v_log_xid_le,v_log_xid_st,v_log_xip,case when v_log_xip is null then true else false end);</font></div><div><font size="2"   >    else<br>      raise notice '不满足split条件';</font></div><div><font size="2"   >&nbsp; &nbsp; end if;</font></div><div><font size="2"   >&nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; select count(*),min(xid),(max(xid)+1) into v_cnt,v_log_xid_le,v_log_xid_st from (select xid from log where xid &lt; v_xmax order by xid limit i_limit) t;</font></div><div><font size="2"   >&nbsp; &nbsp; if ( v_cnt&gt;=i_limit ) then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; select array_agg(i) into v_log_xip from unnest(v_xip) i where i&gt;=v_log_xid_le and i&lt;v_log_xid_st;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; insert into log_ticket(log_xid_le,log_xid_st,log_xip,xip_readed)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; values (v_log_xid_le,v_log_xid_st,v_log_xip,case when v_log_xip is null then true else false end);</font></div><div><font size="2"   >    else<br>      raise notice '不满足split条件';</font></div><div><font size="2"   >&nbsp; &nbsp; end if;</font></div><div><font size="2"   >&nbsp; end if;</font></div><div><font size="2"   >return;</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >$$ language plpgsql strict;</font></div><p></p></pre></div><div><br></div><div>-- 取数据函数</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create or replace function get_log(i_mod int, i_mod_rem int) returns log[] as $$</font></div><div><font size="2"   >declare</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; v_xid_now int8 := null;</font></div><div><font size="2"   >&nbsp; v_log_ticket_pk int8 := null;</font></div><div><font size="2"   >&nbsp; v_log_xid_le int8 := null;</font></div><div><font size="2"   >&nbsp; v_log_xid_st int8 := null;</font></div><div><font size="2"   >&nbsp; v_log_xip int8[] := null;</font></div><div><font size="2"   >&nbsp; v_xid_readed boolean := null;</font></div><div><font size="2"   >&nbsp; v_xip_readed boolean := null;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; v_xid_snap txid_snapshot := null; &nbsp;-- 当前事务状态快照</font></div><div><font size="2"   >&nbsp; v_xip int8[] := null; &nbsp;-- 当前事务状态快照中未完成的事务数组</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; v_log1 log[] := null;</font></div><div><font size="2"   >&nbsp; v_log2 log[] := null;</font></div><div><font size="2"   >&nbsp; v_result log[] := null; &nbsp;-- 结果</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >begin</font></div><div><font size="2"   >&nbsp; -- mod约束</font></div><div><font size="2"   >&nbsp; if (not i_mod&gt;0) or (not (i_mod_rem&gt;=0 and i_mod_rem&lt;i_mod)) then</font></div><div><font size="2"   >&nbsp; &nbsp; raise notice 'please ensure i_mod&gt;0 and 0&lt;=i_mod_rem&lt;i_mod .';</font></div><div><font size="2"   >&nbsp; &nbsp; return null;</font></div><div><font size="2"   >&nbsp; end if;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; v_xid_now := txid_current();</font></div><div><font size="2"   >&nbsp; -- 生成 xid snapshot 数据.</font></div><div><font size="2"   >&nbsp; v_xid_snap := txid_current_snapshot();</font></div><div><font size="2"   >&nbsp; select array_agg(t) into v_xip from txid_snapshot_xip(v_xid_snap) g(t);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; select id,log_xid_le,log_xid_st,log_xip,xid_readed,xip_readed</font></div><div><font size="2"   >&nbsp; &nbsp; into v_log_ticket_pk,v_log_xid_le,v_log_xid_st,v_log_xip,v_xid_readed,v_xip_readed&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; from log_ticket&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; where split_xid&lt;v_xid_now&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; and (not xid_readed or not xip_readed)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; and mod(id,i_mod)=i_mod_rem&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; limit 1&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; for update;</font></div><div><font size="2"   >&nbsp; if found then</font></div><div><font size="2"   >&nbsp; &nbsp; if not v_xid_readed then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; select array_agg(log) into v_log1 from log where xid&gt;=v_log_xid_le and xid&lt;v_log_xid_st and (not (xid = any(v_log_xip)) or v_log_xip is null);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; v_xid_readed := true;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; v_result := v_log1;</font></div><div><font size="2"   >&nbsp; &nbsp; end if;</font></div><div><font size="2"   >&nbsp; &nbsp; if (not v_xip_readed) and v_log_xip is not null then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; perform 1 from unnest(v_xip) i where i = any(v_log_xip);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if (not found) or v_xip is null then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; select array_agg(log) into v_log2 from log where xid = any(v_log_xip);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; v_xip_readed := true;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; v_result := array_cat(v_result,v_log2);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; end if;</font></div><div><font size="2"   >&nbsp; &nbsp; end if;</font></div><div><font size="2"   >&nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; raise notice 'no data in log_ticket with i_mod=% and i_mod_rem=%.', i_mod, i_mod_rem;</font></div><div><font size="2"   >&nbsp; &nbsp; return null;</font></div><div><font size="2"   >&nbsp; end if;</font></div><div><font size="2"   >&nbsp; update log_ticket set xid_readed=v_xid_readed,xip_readed=v_xip_readed where id=v_log_ticket_pk;</font></div><div><font size="2"   >&nbsp; return v_result;</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >$$ language plpgsql strict;</font></div><p></p></pre></div><div><br></div><div>[测试]</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; cat ins.sql</font></div><div><font size="2"   >begin;</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >begin;</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >rollback;</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><div><font size="2"   >insert into log (c1,c2,c3,c4) values(round(random()*10),1,2,3);</font></div><p></p></pre></div><div>-- pgbench</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; pgbench -M prepared -f ./ins.sql -r -n -h $PGDATA -U postgres -T 60 -c 32 -j 2</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 32</font></div><div><font size="2"   >number of threads: 2</font></div><div><font size="2"   >duration: 60 s</font></div><div><font size="2"   >number of transactions actually processed: 84781</font></div><div><font size="2"   >tps = 1411.655384 (including connections establishing)</font></div><div><font size="2"   >tps = 1412.958688 (excluding connections establishing)</font></div><p></p></pre></div><div>-- pgbench测试过程中执行select log_spilt(1,100000);</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# select log_spilt(1,10000);</font></div><div><font size="2"   >&nbsp;log_spilt&nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp;</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select log_spilt(1,10000);</font></div><div><font size="2"   >&nbsp;log_spilt&nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp;</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >digoal=# select log_spilt(1,1000000000);</font></div><div><font size="2"   >&nbsp;log_spilt&nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp;</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select log_spilt(1,100000);</font></div><div><font size="2"   >&nbsp;log_spilt&nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp;</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >... 略</font></div><div><div><font size="2"   ><span style="line-height: 22px;"   >digoal</span>=# select log_spilt(1,100000000);</font></div><div><font size="2"   >&nbsp;log_spilt&nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp;</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>-- 确保所有数据都写入log_ticket了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 22px;"   >digoal</span>=# select min(log_xid_le),max(log_xid_st) from log_ticket;</font></div><div><font size="2"   >&nbsp; &nbsp; min &nbsp; &nbsp;| &nbsp; &nbsp;max &nbsp; &nbsp;</font></div><div><font size="2"   >-----------+-----------</font></div><div><font size="2"   >&nbsp;505354161 | 506624142</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><span style="line-height: 22px;"   >digoal</span>=# select min(xid),max(xid) from log;</font></div><div><font size="2"   >&nbsp; &nbsp; min &nbsp; &nbsp;| &nbsp; &nbsp;max &nbsp; &nbsp;</font></div><div><font size="2"   >-----------+-----------</font></div><div><font size="2"   >&nbsp;505354161 | 506624141</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div><br></div><div>查询log_ticket</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select * from log_ticket;</font></div><div><font size="2"   >&nbsp;id | split_xid | &nbsp; &nbsp; &nbsp; &nbsp; split_time &nbsp; &nbsp; &nbsp; &nbsp; | log_xid_le | log_xid_st | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;log_xip &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| xid_readed | xip_readed&nbsp;</font></div><div><font size="2"   >----+-----------+----------------------------+------------+------------+------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >---------------------------------------------------------------------------------+------------+------------</font></div><div><font size="2"   >&nbsp;26 | 506284999 | 2013-05-03 15:05:53.963654 | &nbsp;505354161 | &nbsp;505356093 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;27 | 506285000 | 2013-05-03 15:05:54.887422 | &nbsp;505356093 | &nbsp;505358092 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;28 | 506285001 | 2013-05-03 15:05:55.369707 | &nbsp;505358092 | &nbsp;505360095 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;29 | 506285002 | 2013-05-03 15:05:55.757843 | &nbsp;505360095 | &nbsp;505362101 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;30 | 506285003 | 2013-05-03 15:05:56.132186 | &nbsp;505362101 | &nbsp;505364103 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;31 | 506285004 | 2013-05-03 15:05:56.487359 | &nbsp;505364103 | &nbsp;505366103 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;32 | 506285005 | 2013-05-03 15:05:56.921683 | &nbsp;505366103 | &nbsp;505368098 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;33 | 506285006 | 2013-05-03 15:05:57.220986 | &nbsp;505368098 | &nbsp;505370109 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;34 | 506285007 | 2013-05-03 15:05:57.624854 | &nbsp;505370109 | &nbsp;505372109 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;35 | 506285008 | 2013-05-03 15:05:58.055403 | &nbsp;505372109 | &nbsp;505374113 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;36 | 506315377 | 2013-05-03 15:07:22.414773 | &nbsp;505374113 | &nbsp;505376115 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;37 | 506320066 | 2013-05-03 15:07:23.147482 | &nbsp;505376115 | &nbsp;505378109 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;38 | 506409173 | 2013-05-03 15:07:36.081153 | &nbsp;505378109 | &nbsp;506384559 | {506384464,506384481,506384492,506384503,506384507,50638450</font></div><div><font size="2"   >9,506384517,506384521,506384522,506384523,506384525,506384529,506384534,506384535,506384537,506384538,506384539,506384541,506384542,</font></div><div><font size="2"   >506384543,506384546,506384548,506384552,506384553,506384554,506384556,506384557} | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f</font></div><div><font size="2"   >&nbsp;39 | 506423332 | 2013-05-03 15:07:43.592782 | &nbsp;506384559 | &nbsp;506404567 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;40 | 506427897 | 2013-05-03 15:07:44.306657 | &nbsp;506404567 | &nbsp;506424564 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;41 | 506434174 | 2013-05-03 15:07:45.330145 | &nbsp;506424564 | &nbsp;506433989 | {506433901,506433908,506433928,506433934,506433937,50643393</font></div><div><font size="2"   >8,506433940,506433941,506433946,506433947,506433954,506433955,506433956,506433957,506433958,506433960,506433962,506433964,506433965,</font></div><div><font size="2"   >506433968,506433971,506433974,506433976,506433980,506433985} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f</font></div><div><font size="2"   >&nbsp;42 | 506442222 | 2013-05-03 15:07:46.573332 | &nbsp;506433989 | &nbsp;506442067 | {506441993,506442005,506442008,506442012,506442015,50644201</font></div><div><font size="2"   >6,506442024,506442032,506442033,506442034,506442037,506442039,506442040,506442041,506442042,506442043,506442045,506442047,506442048,</font></div><div><font size="2"   >506442051,506442052,506442053,506442055,506442059,506442062,506442064,506442065} | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f</font></div><div><font size="2"   >&nbsp;43 | 506467572 | 2013-05-03 15:07:50.910016 | &nbsp;506442067 | &nbsp;506462070 | NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t</font></div><div><font size="2"   >&nbsp;44 | 506473021 | 2013-05-03 15:07:51.998294 | &nbsp;506462070 | &nbsp;506472808 | {506472727,506472747,506472751,506472763,506472764,50647276</font></div><div><font size="2"   >7,506472773,506472774,506472775,506472777,506472778,506472779,506472780,506472781,506472782,506472794,506472796,506472799,506472800,</font></div><div><font size="2"   >506472801,506472802,506472803,506472804} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f</font></div><div><font size="2"   >(19 rows)</font></div><p></p></pre></div><div>-- pgbench过程中同时执行get_log</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# select count(*) from unnest(get_log(2,0));</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp;10000</font></div><div><font size="2"   >(1 row)</font></div></div><div><div style="line-height: 22px;"   ><font size="2"   >digoal=# select count(*) from unnest(get_log(2,1));</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;count&nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >-------</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;10000</font></div><div style="line-height: 22px;"   ><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>...</div><div>直到所有线程都报</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# select count(*) from unnest(get_log(2,0));</font></div><div><font size="2"   >NOTICE: &nbsp;no data in log_ticket with i_mod=2 and i_mod_rem=0.</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >digoal=# select count(*) from unnest(get_log(2,1));</font></div><div><font size="2"   >NOTICE: &nbsp;no data in log_ticket with i_mod=2 and i_mod_rem=1.</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>略</div><div>-- 把所有的get_log结果相加看看是否等于count(*) from log;</div><div>验证结果正确.</div><div>此处略.</div><div><br></div><div>[其他]</div><div>1. 如果觉得取数据的函数不太通用, 可以改成返回log_ticket的游标. 程序尽管自己去取.</div><div><br></div><div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><span style="line-height: 25px;"   >[参考]</span><div style="line-height: 25px;"   ><div style="line-height: 25px;"   >为方便大家查询, 汇总PostgreSQL实时和非实时数据统计的案例分析文章系列 - 如下 :&nbsp;</div><div style="line-height: 25px;"   >1.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201331252945440/"   >http://blog.163.com/digoal@126/blog/static/163877040201331252945440/</a></div><div style="line-height: 25px;"   >2.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020133151402415/"   >http://blog.163.com/digoal@126/blog/static/16387704020133151402415/</a></div><div style="line-height: 25px;"   >3.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020133155179877/"   >http://blog.163.com/digoal@126/blog/static/16387704020133155179877/</a></div><div style="line-height: 25px;"   >4.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020133156636579/"   >http://blog.163.com/digoal@126/blog/static/16387704020133156636579/</a></div><div style="line-height: 25px;"   >5.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020133218305242/"   >http://blog.163.com/digoal@126/blog/static/16387704020133218305242/</a></div><div style="line-height: 25px;"   >6.&nbsp;<a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020133224161563/"   >http://blog.163.com/digoal@126/blog/static/16387704020133224161563/</a></div></div></div><wbr style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><span style="line-height: 22px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >7.&nbsp;</span><a style="line-height: 22px; text-decoration: none; color: rgb(85, 108, 136); font-family: Arial, Helvetica, simsun, u5b8bu4f53;" href="http://blog.163.com/digoal@126/blog/static/16387704020133271134563/"   >http://blog.163.com/digoal@126/blog/static/16387704020133271134563/</a></div>8.&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020134311144755/"   >http://blog.163.com/digoal@126/blog/static/16387704020134311144755/</a></div>
	</div>
</div>
</body>
</html>