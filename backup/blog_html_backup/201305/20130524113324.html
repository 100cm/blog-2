<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL inherits child table columns drop by parent table column, child talbe's must attislocal is false</h2>
	<h5 id="">2013-05-24 11:33:24&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013424113324797/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>早上francs在维护一个生产库时遇到的一个问题, 因业务需要删除一个表的字段, 为了维护方便直接删主表, 会自动删除<span style="line-height: 22px;"   >子表的对应字段.</span></div><div><span style="line-height: 22px;"   >但实际操作时发现子表的对应字段未被删除.</span></div><div>那么是什么原因呢? 往下看.</div><div><br></div><div>首先创建2个测试表 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create table a(id int);</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=# create table b(like a including all) inherits(a);</font></div><div><font size="2"   >NOTICE: &nbsp;merging column "id" with inherited definition</font></div><div><font size="2"   >CREATE TABLE</font></div><p></p></pre></div><div>查看主表列属性</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select attrelid::regclass,attname,attisdropped,attislocal,attinhcount from pg_attribute where attrelid='a'::regclass;</font></div><div><font size="2"   >&nbsp;attrelid | attname &nbsp;| attisdropped | attislocal | attinhcount&nbsp;</font></div><div><font size="2"   >----------+----------+--------------+------------+-------------</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| tableoid | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| cmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| xmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| cmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| xmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| ctid &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| id &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >(7 rows)</font></div><p></p></pre></div><div>注意b表的id字段, attislocal=true. 也就是本地字段,&nbsp;</div><div>attinhcount&gt;0, 这是因为它继承自a表.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select attrelid::regclass,attname,attisdropped,attislocal,attinhcount from pg_attribute where attrelid='b'::regclass;</font></div><div><font size="2"   >&nbsp;attrelid | attname &nbsp;| attisdropped | attislocal | attinhcount&nbsp;</font></div><div><font size="2"   >----------+----------+--------------+------------+-------------</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| tableoid | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| cmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| xmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| cmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| xmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| ctid &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| id &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >(7 rows)</font></div><p></p></pre></div><div># 在主表上添加1个c1字段.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# alter table a add column c1 int;</font></div><div><font size="2"   >ALTER TABLE</font></div><div><font size="2"   >digoal=# select attrelid::regclass,attname,attisdropped,attislocal,attinhcount from pg_attribute where attrelid='a'::regclass;</font></div><div><font size="2"   >&nbsp;attrelid | attname &nbsp;| attisdropped | attislocal | attinhcount&nbsp;</font></div><div><font size="2"   >----------+----------+--------------+------------+-------------</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| tableoid | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| cmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| xmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| cmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| xmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| ctid &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| id &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| c1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >(8 rows)</font></div><p></p></pre></div><div># 继承表会自动增加这个字段, 同时这个字段的attislocal=false, 说明它是从主表创建的.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select attrelid::regclass,attname,attisdropped,attislocal,attinhcount from pg_attribute where attrelid='b'::regclass;</font></div><div><font size="2"   >&nbsp;attrelid | attname &nbsp;| attisdropped | attislocal | attinhcount&nbsp;</font></div><div><font size="2"   >----------+----------+--------------+------------+-------------</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| tableoid | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| cmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| xmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| cmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| xmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| ctid &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| id &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| c1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >(8 rows)</font></div><p></p></pre></div><div># 问题的原因找到了, attislocal=false的字段受到主表的控制. 可以被主表删除.</div><div># attislocal=true的字段不受主表控制. 不可以被主表删除.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# alter table a drop column id;</font></div><div><font size="2"   >ALTER TABLE</font></div><div><font size="2"   >digoal=# \d a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Table "public.a"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >Number of child tables: 1 (Use \d+ to list them.)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# \d b</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Table "public.b"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >Inherits: a</font></div><p></p></pre></div><div><br></div><div># 即使使用cascade也不会删除子表的local column.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# alter table a add column id int;</font></div><div><font size="2"   >NOTICE: &nbsp;merging definition of column "id" for child "b"</font></div><div><font size="2"   >ALTER TABLE</font></div><div><font size="2"   >digoal=# alter table a drop column id cascade;</font></div><div><font size="2"   >ALTER TABLE</font></div><div><font size="2"   >digoal=# \d a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Table "public.a"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >Number of child tables: 1 (Use \d+ to list them.)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# \d b</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Table "public.b"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >Inherits: a</font></div><p></p></pre></div><div><br></div><div># 更新pg_attribute.attislocal=false后, 通过主表就可以删除子表的对应列了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# update pg_attribute set attislocal=false where attrelid='b'::regclass and attname='id';</font></div><div><font size="2"   >UPDATE 1</font></div><div><font size="2"   >digoal=# select attrelid::regclass,attname,attisdropped,attislocal,attinhcount from pg_attribute where attrelid='b'::regclass;</font></div><div><font size="2"   >&nbsp;attrelid | attname &nbsp;| attisdropped | attislocal | attinhcount&nbsp;</font></div><div><font size="2"   >----------+----------+--------------+------------+-------------</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| tableoid | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| cmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| xmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| cmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| xmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| ctid &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| id &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| c1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >(8 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# alter table a drop column id;</font></div><div><font size="2"   >ALTER TABLE</font></div><div><font size="2"   >digoal=# \d a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Table "public.a"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >Number of child tables: 1 (Use \d+ to list them.)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# \d b</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Table "public.b"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >Inherits: a</font></div><p></p></pre></div><div><br></div><div># 通过父表新建的列, 所有子表上的attislocal都标记为false.</div><div># 所以可以通过父表来管理.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# alter table a add column id int;</font></div><div><font size="2"   >ALTER TABLE</font></div><div><font size="2"   >digoal=# \d a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Table "public.a"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >Number of child tables: 1 (Use \d+ to list them.)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# \d b</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Table "public.b"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >Inherits: a</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select attrelid::regclass,attname,attisdropped,attislocal,attinhcount from pg_attribute where attrelid='a'::regclass;</font></div><div><font size="2"   >&nbsp;attrelid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; attname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| attisdropped | attislocal | attinhcount&nbsp;</font></div><div><font size="2"   >----------+------------------------------+--------------+------------+-------------</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| tableoid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| cmax &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| xmax &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| cmin &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| xmin &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| ctid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| ........pg.dropped.1........ | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| c1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| ........pg.dropped.3........ | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| ........pg.dropped.4........ | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;a &nbsp; &nbsp; &nbsp; &nbsp;| id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >(11 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select attrelid::regclass,attname,attisdropped,attislocal,attinhcount from pg_attribute where attrelid='b'::regclass;</font></div><div><font size="2"   >&nbsp;attrelid | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; attname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| attisdropped | attislocal | attinhcount&nbsp;</font></div><div><font size="2"   >----------+------------------------------+--------------+------------+-------------</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| tableoid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| cmax &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| xmax &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| cmin &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| xmin &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| ctid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| ........pg.dropped.1........ | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| c1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;b &nbsp; &nbsp; &nbsp; &nbsp;| id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >(9 rows)</font></div><p></p></pre></div><div><br></div><div># 使用继承建表, 缺陷是无法继承约束,存储结构,索引等.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create index idx_a_1 on a(id);</font></div><div><font size="2"   >CREATE INDEX</font></div><div><font size="2"   >digoal=# create table c() inherits(a);</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=# \d a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Table "public.a"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >Indexes:</font></div><div><font size="2"   >&nbsp; &nbsp; "idx_a_1" btree (id)</font></div><div><font size="2"   >Number of child tables: 2 (Use \d+ to list them.)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# \d c</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Table "public.c"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   >Inherits: a</font></div><p></p></pre></div><div># 但是这样建立的表, 所有字段都不是本地的. 便于管理</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select attrelid::regclass,attname,attisdropped,attislocal,attinhcount from pg_attribute where attrelid='c'::regclass;</font></div><div><font size="2"   >&nbsp;attrelid | attname &nbsp;| attisdropped | attislocal | attinhcount&nbsp;</font></div><div><font size="2"   >----------+----------+--------------+------------+-------------</font></div><div><font size="2"   >&nbsp;c &nbsp; &nbsp; &nbsp; &nbsp;| tableoid | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;c &nbsp; &nbsp; &nbsp; &nbsp;| cmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;c &nbsp; &nbsp; &nbsp; &nbsp;| xmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;c &nbsp; &nbsp; &nbsp; &nbsp;| cmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;c &nbsp; &nbsp; &nbsp; &nbsp;| xmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;c &nbsp; &nbsp; &nbsp; &nbsp;| ctid &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;c &nbsp; &nbsp; &nbsp; &nbsp;| c1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;c &nbsp; &nbsp; &nbsp; &nbsp;| id &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >(8 rows)</font></div><p></p></pre></div><div><br></div><div># 使用like的话, 属性可以继承, 但是列都是本地的.&nbsp;</div><div># 所以建议使用like建子表, 同时建立好后, 更新这些列的attislocal=false</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create table d(like a including all) inherits(a);</font></div><div><font size="2"   >NOTICE: &nbsp;merging column "c1" with inherited definition</font></div><div><font size="2"   >NOTICE: &nbsp;merging column "id" with inherited definition</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=# select attrelid::regclass,attname,attisdropped,attislocal,attinhcount from pg_attribute where attrelid='d'::regclass;</font></div><div><font size="2"   >&nbsp;attrelid | attname &nbsp;| attisdropped | attislocal | attinhcount&nbsp;</font></div><div><font size="2"   >----------+----------+--------------+------------+-------------</font></div><div><font size="2"   >&nbsp;d &nbsp; &nbsp; &nbsp; &nbsp;| tableoid | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;d &nbsp; &nbsp; &nbsp; &nbsp;| cmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;d &nbsp; &nbsp; &nbsp; &nbsp;| xmax &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;d &nbsp; &nbsp; &nbsp; &nbsp;| cmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;d &nbsp; &nbsp; &nbsp; &nbsp;| xmin &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;d &nbsp; &nbsp; &nbsp; &nbsp;| ctid &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;d &nbsp; &nbsp; &nbsp; &nbsp;| c1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;d &nbsp; &nbsp; &nbsp; &nbsp;| id &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >(8 rows)</font></div><div><font size="2"   >digoal=# update pg_attribute set attislocal=false where attrelid='d'::regclass and attinhcount&gt;0;</font></div><div><font size="2"   >UPDATE 2</font></div><p></p></pre></div><div><br></div><div># 尽管attislocal=true, 但是改字段类型是会被继承的.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# alter table a alter column id type int8;</font></div><div><font size="2"   >ALTER TABLE</font></div><div><font size="2"   >digoal=# \d a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Table "public.a"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp;| Modifiers&nbsp;</font></div><div><font size="2"   >--------+--------+-----------</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | bigint |&nbsp;</font></div><div><font size="2"   >Number of child tables: 1 (Use \d+ to list them.)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# \d b</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Table "public.b"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp;| Modifiers&nbsp;</font></div><div><font size="2"   >--------+--------+-----------</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | bigint |&nbsp;</font></div><div><font size="2"   >Inherits: a</font></div><div></div><p></p></pre></div><div># attislocal=true, 改字段名也是可以的</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# alter table a rename column id to id1;</font></div><div><font size="2"   >ALTER TABLE</font></div><div><font size="2"   >digoal=# \d a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Table "public.a"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp;| Modifiers&nbsp;</font></div><div><font size="2"   >--------+--------+-----------</font></div><div><font size="2"   >&nbsp;id1 &nbsp; &nbsp;| bigint |&nbsp;</font></div><div><font size="2"   >Number of child tables: 1 (Use \d+ to list them.)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# \d b</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Table "public.b"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp;| Modifiers&nbsp;</font></div><div><font size="2"   >--------+--------+-----------</font></div><div><font size="2"   >&nbsp;id1 &nbsp; &nbsp;| bigint |&nbsp;</font></div><div><font size="2"   >Inherits: a</font></div><p></p></pre></div><div># 如果子表的attinhcount&gt;0, 说明这个字段继承自父表, 所以直接在子表上不能删除</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# alter table b drop column id1;</font></div><div><font size="2"   >ERROR: &nbsp;cannot drop inherited column "id1"</font></div><div><font size="2"   >digoal=# alter table b drop column c1;</font></div><div><font size="2"   >ERROR: &nbsp;cannot drop inherited column "c1"</font></div><p></p></pre></div><div><br></div><div>[小结]</div><div>1. 新建子表建议还是使用如下方法 :&nbsp;</div><pre class="prettyprint"   ><p></p><div><font size="2"   >create table child_name(like parent_name including all) inherits(parent_name);</font></div><div></div><p></p></pre><div><span style="line-height: 22px;"   >只是在新建完子表后, &nbsp;修改一下子表对应的attislocal=false.</span></div><div>这样做既能保证约束,存储属性,索引都继承过来, 同时还能保证管理的便利性.</div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/catalog-pg-attribute.html"   >http://www.postgresql.org/docs/9.3/static/catalog-pg-attribute.html</a></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >attislocal	bool	 	This column is defined locally in the relation. Note that a column can be locally defined and inherited simultaneously.</font></div><div><font size="2"   >attinhcount	int4	 	The number of direct ancestors this column has. A column with a nonzero number of ancestors cannot be dropped nor renamed.</font></div><p></p></pre></div><div><br></div><wbr></div>
	</div>
</div>
</body>
</html>