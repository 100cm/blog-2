<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL SQL Injection Attack Mitigation</h2>
	<h5 id="">2013-05-21 15:46:28&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201342184212205/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="line-height: 22px;"   >SQL注入攻击指利用应用程序数据库接口漏洞进行攻击.</span></div><div><span style="line-height: 22px;"   ><br></span></div><div><span style="line-height: 22px;"   >典型的SQL注入攻击图 :&nbsp;</span></div><div><div><img title="PostgreSQL SQL Injection Attack Mitigation - 德哥@Digoal - PostgreSQL"   alt="PostgreSQL SQL Injection Attack Mitigation - 德哥@Digoal - PostgreSQL"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/EO8XbfuRhFtr3nHAJqXoLA==/1886163819038175663.png"   ></div>&nbsp;</div><div>SQL注入举例 :&nbsp;</div><div>1. 利用字符串未过滤逃逸字符的漏洞.</div><div><pre class="prettyprint"   ><p><font size="2"   >statement = "SELECT * FROM users WHERE name = '" + userName + "';"</font></p></pre></div><div>这个SQL, 可以在userName这里注入攻击.</div><div><pre class="prettyprint"   ><p><font size="2"   >userName : &nbsp;' or '1'='1</font></p></pre></div><div>那么整条sql就变成 :&nbsp;</div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >SELECT * FROM users WHERE name = '' or '1'='1';</font></span></div><div></div><p></p></pre><div><span style="line-height: 22px;"   >或者使用注释, 如果后面还有条件的话可以将后面的条件全部注释掉, 适用范围更广.</span></div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p><font size="2"   >' or '1'='1' -- '</font></p></pre></div><div style="line-height: 22px;"   >那么SQL语句变成 :&nbsp;</div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >SELECT * FROM users WHERE name = '' OR '1'='1' -- ';</font></div></div><div></div><p></p></pre><div><span style="line-height: 22px;"   >使用以上方法后可以得到users表的所有数据.</span></div></div><div>如果是一个update语句, 那么可以将所有用户信息更新掉. 危险性较大.</div><div><br></div><div>甚至可以执行其他破坏性更大的SQL.</div><div>例如 :&nbsp;</div><pre class="prettyprint"   ><p></p><div><font size="2"   >a';DROP TABLE users; SELECT * FROM userinfo WHERE 't' = 't</font></div><div></div><p></p></pre><div><span style="line-height: 22px;"   >那么SQL变成 :&nbsp;</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   >SELECT * FROM users WHERE name = 'a';DROP TABLE users; SELECT * FROM userinfo WHERE 't' = 't';</font></div><div></div><p></p></pre><div><span style="line-height: 22px;"   >这样将会drop users表, 同时将userinfo表的信息全部查出.</span></div><div><br></div><div>2. 利用类型处理漏洞.</div><div>例如 :&nbsp;</div><pre class="prettyprint"   ><p></p><div><font size="2"   >statement := "SELECT * FROM userinfo WHERE id = " + a_variable + ";"</font></div><div></div><p></p></pre><div><span style="line-height: 22px;"   >a_variable应该是int类型, 但是如果没有强类型机制的话, 攻击者就可以利用这个漏洞进行SQL注入.</span></div><div>如果a_variable等于1;DROP TABLE users</div><div>那么SQL变成 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SELECT * FROM userinfo WHERE id=1;DROP TABLE users;</font></div><div></div><p></p></pre></div><div>3. 使用以上方法还可以获取数据库版本, 根据版本漏洞进行攻击.</div><div>例如 :&nbsp;</div><div><div>注入</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >select version();</font></div><div></div><p></p></pre></div></div><div><br></div><div>规避举例 :&nbsp;</div><div>1. 使用绑定变量</div><div>使用绑定变量后, 语句模板将提前提交给数据库, 例如</div><div><span style="font-family: monospace, Courier; font-size: 13px; line-height: 19.1875px; background-color: rgb(249, 249, 249);"   >INSERT INTO PRODUCT (name, price) VALUES (?,&nbsp;?)</span></div><div><font face="monospace, Courier"   size="2"   ><span style="line-height: 19.1875px;"   >数据库收到模板后, 解析,编译,执行sql优化器并保存结果.</span></font></div><div><font face="monospace, Courier"   size="2"   ><span style="line-height: 19.1875px;"   >对于PostgreSQL来说, 每个会话保持各自的sql优化结构. 但是并不一定每次都是有固定的执行计划, 因此不同的传入变量并不会影响执行计划的正确性. 参考.</span></font></div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402012112452432251/"   >http://blog.163.com/digoal@126/blog/static/1638770402012112452432251/</a></div><div><span style="font-family: monospace, Courier; font-size: 13px; line-height: 19.1875px; background-color: rgb(249, 249, 249);"   >后续应用程序将变量值传递或者(bind)给数据库.</span></div><div><span style="font-family: monospace, Courier; font-size: 13px; line-height: 19.1875px; background-color: rgb(249, 249, 249);"   >因为SQL解析已经提前处理, 因此能规避SQL注入攻击.</span></div><div><br></div><div>以下截取自wiki :&nbsp;</div><div><h3 style="background-image: none; margin: 0px 0px 0.3em; overflow: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-style: none; font-size: 17px; font-family: sans-serif; line-height: 19.1875px;"   ><span id="Java_JDBC"   >Java JDBC</span>&nbsp;<span style="-webkit-user-select: none; font-size: small; font-weight: normal; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block;"   >[<a title="Edit section: Java JDBC" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Prepared_statement&amp;action=edit&amp;section=3"   >edit</a>]</span></h3><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.1875px; font-family: sans-serif; font-size: 13px;"   >This example uses&nbsp;<a title="Java (programming language)" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/Java_(programming_language)"   >Java</a>&nbsp;and the&nbsp;<a title="Java Database Connectivity" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/Java_Database_Connectivity"   >JDBC</a>&nbsp;API:</p><div dir="ltr"   style="direction: ltr; font-family: monospace, Courier; padding: 1em; border: 1px dashed rgb(47, 111, 171); background-color: rgb(249, 249, 249); line-height: 1.1em; font-size: 13px;"   ><div style="line-height: normal; font-family: monospace;"   ><pre style="font-family: monospace, monospace; padding: 0px; border: 0px none white; line-height: 1.2em; font-size: 1em; margin-top: 0px; margin-bottom: 0px; background-image: none; vertical-align: top;"   >java.<span style="color: rgb(0, 102, 51);"   >sql</span>.<span style="color: rgb(0, 51, 153);"   >PreparedStatement</span> stmt <span style="color: rgb(51, 153, 51);"   >=</span> connection.<span style="color: rgb(0, 102, 51);"   >prepareStatement</span><span style="color: rgb(0, 153, 0);"   >(</span>
               <span style="color: rgb(0, 0, 255);"   >"SELECT * FROM users WHERE USERNAME = ? AND ROOM = ?"</span><span style="color: rgb(0, 153, 0);"   >)</span><span style="color: rgb(51, 153, 51);"   >;</span>
stmt.<span style="color: rgb(0, 102, 51);"   >setString</span><span style="color: rgb(0, 153, 0);"   >(</span><span style="color: rgb(204, 102, 204);"   >1</span>, username<span style="color: rgb(0, 153, 0);"   >)</span><span style="color: rgb(51, 153, 51);"   >;</span>
stmt.<span style="color: rgb(0, 102, 51);"   >setInt</span><span style="color: rgb(0, 153, 0);"   >(</span><span style="color: rgb(204, 102, 204);"   >2</span>, roomNumber<span style="color: rgb(0, 153, 0);"   >)</span><span style="color: rgb(51, 153, 51);"   >;</span>
stmt.<span style="color: rgb(0, 102, 51);"   >executeQuery</span><span style="color: rgb(0, 153, 0);"   >(</span><span style="color: rgb(0, 153, 0);"   >)</span><span style="color: rgb(51, 153, 51);"   >;</span>
</pre></div></div><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.1875px; font-family: sans-serif; font-size: 13px;"   >Java&nbsp;<code style="font-family: monospace, Courier; background-color: rgb(249, 249, 249);"   >PreparedStatement</code>&nbsp;provides "setters" (<code style="font-family: monospace, Courier; background-color: rgb(249, 249, 249);"   >setInt(int), setString(String), setDouble(double),</code>&nbsp;etc.) for all major built-in data types.</p><h3 style="background-image: none; margin: 0px 0px 0.3em; overflow: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-style: none; font-size: 17px; font-family: sans-serif; line-height: 19.1875px;"   ><span id="PHP_PDO"   >PHP PDO</span>&nbsp;<span style="-webkit-user-select: none; font-size: small; font-weight: normal; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block;"   >[<a title="Edit section: PHP PDO" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Prepared_statement&amp;action=edit&amp;section=4"   >edit</a>]</span></h3><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.1875px; font-family: sans-serif; font-size: 13px;"   >This example uses&nbsp;<a title="PHP" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/PHP"   >PHP</a>&nbsp;and&nbsp;<a title="PHP Data Objects" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" class="mw-redirect" rel="nofollow" href="http://en.wikipedia.org/wiki/PHP_Data_Objects"   >PHP Data Objects</a>&nbsp;(PDO):</p><div dir="ltr"   style="direction: ltr; font-family: monospace, Courier; padding: 1em; border: 1px dashed rgb(47, 111, 171); background-color: rgb(249, 249, 249); line-height: 1.1em; font-size: 13px;"   ><div style="line-height: normal; font-family: monospace;"   ><pre style="font-family: monospace, monospace; padding: 0px; border: 0px none white; line-height: 1.2em; font-size: 1em; margin-top: 0px; margin-bottom: 0px; background-image: none; vertical-align: top;"   ><span style="color: rgb(0, 0, 136);"   >$stmt</span> <span style="color: rgb(51, 153, 51);"   >=</span> <span style="color: rgb(0, 0, 136);"   >$dbh</span><span style="color: rgb(51, 153, 51);"   >-&gt;</span><span style="color: rgb(0, 64, 0);"   >prepare</span><span style="color: rgb(0, 153, 0);"   >(</span><span style="color: rgb(0, 0, 255);"   >"SELECT * FROM users WHERE USERNAME = ? AND PASSWORD = ?"</span><span style="color: rgb(0, 153, 0);"   >)</span><span style="color: rgb(51, 153, 51);"   >;</span>
<span style="color: rgb(0, 0, 136);"   >$stmt</span><span style="color: rgb(51, 153, 51);"   >-&gt;</span><span style="color: rgb(0, 64, 0);"   >execute</span><span style="color: rgb(0, 153, 0);"   >(</span><span style="color: rgb(153, 0, 0);"   >array</span><span style="color: rgb(0, 153, 0);"   >(</span><span style="color: rgb(0, 0, 136);"   >$username</span><span style="color: rgb(51, 153, 51);"   >,</span> <span style="color: rgb(0, 0, 136);"   >$password</span><span style="color: rgb(0, 153, 0);"   >)</span><span style="color: rgb(0, 153, 0);"   >)</span><span style="color: rgb(51, 153, 51);"   >;</span>
</pre></div></div><h3 style="background-image: none; margin: 0px 0px 0.3em; overflow: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-style: none; font-size: 17px; font-family: sans-serif; line-height: 19.1875px;"   ><span id="PERL_DBI"   >PERL DBI</span>&nbsp;<span style="-webkit-user-select: none; font-size: small; font-weight: normal; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block;"   >[<a title="Edit section: PERL DBI" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Prepared_statement&amp;action=edit&amp;section=5"   >edit</a>]</span></h3><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.1875px; font-family: sans-serif; font-size: 13px;"   >This example uses&nbsp;<a title="Perl" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/Perl"   >Perl</a>&nbsp;and&nbsp;<a title="Perl DBI" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/Perl_DBI"   >DBI</a>:</p><div dir="ltr"   style="direction: ltr; font-family: monospace, Courier; padding: 1em; border: 1px dashed rgb(47, 111, 171); background-color: rgb(249, 249, 249); line-height: 1.1em; font-size: 13px;"   ><div style="line-height: normal; font-family: monospace;"   ><pre style="font-family: monospace, monospace; padding: 0px; border: 0px none white; line-height: 1.2em; font-size: 1em; margin-top: 0px; margin-bottom: 0px; background-image: none; vertical-align: top;"   ><span style="color: rgb(177, 177, 0);"   >my</span> <span style="color: rgb(0, 0, 255);"   >$stmt</span> <span style="color: rgb(51, 153, 51);"   >=</span> <span style="color: rgb(0, 0, 255);"   >$dbh</span><span style="color: rgb(51, 153, 51);"   >-&gt;</span><span style="color: rgb(0, 102, 0);"   >prepare</span><span style="color: rgb(0, 153, 0);"   >(</span><span style="color: rgb(255, 0, 0);"   >'SELECT * FROM users WHERE USERNAME = ? AND PASSWORD = ?'</span><span style="color: rgb(0, 153, 0);"   >)</span><span style="color: rgb(51, 153, 51);"   >;</span>
<span style="color: rgb(0, 0, 255);"   >$stmt</span><span style="color: rgb(51, 153, 51);"   >-&gt;</span><span style="color: rgb(0, 102, 0);"   >execute</span><span style="color: rgb(0, 153, 0);"   >(</span><span style="color: rgb(0, 0, 255);"   >$username</span><span style="color: rgb(51, 153, 51);"   >,</span> <span style="color: rgb(0, 0, 255);"   >$password</span><span style="color: rgb(0, 153, 0);"   >)</span><span style="color: rgb(51, 153, 51);"   >;</span>
</pre></div></div><h3 style="background-image: none; margin: 0px 0px 0.3em; overflow: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-style: none; font-size: 17px; font-family: sans-serif; line-height: 19.1875px;"   ><span id="C.23_ADO.NET"   >C# ADO.NET</span>&nbsp;<span style="-webkit-user-select: none; font-size: small; font-weight: normal; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block;"   >[<a title="Edit section: C# ADO.NET" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Prepared_statement&amp;action=edit&amp;section=6"   >edit</a>]</span></h3><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.1875px; font-family: sans-serif; font-size: 13px;"   >This example uses&nbsp;<a title="C Sharp (programming language)" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/C_Sharp_(programming_language)"   >C#</a>&nbsp;and&nbsp;<a title="ADO.NET" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/ADO.NET"   >ADO.NET</a>:</p><div dir="ltr"   style="direction: ltr; font-family: monospace, Courier; padding: 1em; border: 1px dashed rgb(47, 111, 171); background-color: rgb(249, 249, 249); line-height: 1.1em; font-size: 13px;"   ><div style="line-height: normal; font-family: monospace;"   ><pre style="font-family: monospace, monospace; padding: 0px; border: 0px none white; line-height: 1.2em; font-size: 1em; margin-top: 0px; margin-bottom: 0px; background-image: none; vertical-align: top;"   ><span style="color: rgb(6, 0, 255); font-weight: bold;"   >using</span> <span style="color: rgb(0, 128, 0);"   >(</span>SqlCommand command <span style="color: rgb(0, 128, 0);"   >=</span> connection<span style="color: rgb(0, 128, 0);"   >.</span><span style="color: rgb(0, 0, 255);"   >CreateCommand</span><span style="color: rgb(0, 128, 0);"   >(</span><span style="color: rgb(0, 128, 0);"   >)</span><span style="color: rgb(0, 128, 0);"   >)</span>
<span style="color: rgb(0, 128, 0);"   >{</span>
    command<span style="color: rgb(0, 128, 0);"   >.</span><span style="color: rgb(0, 0, 255);"   >CommandText</span> <span style="color: rgb(0, 128, 0);"   >=</span> <span style="color: rgb(102, 102, 102);"   >"SELECT * FROM users WHERE USERNAME = @username AND ROOM = @room"</span><span style="color: rgb(0, 128, 0);"   >;</span>
 
    command<span style="color: rgb(0, 128, 0);"   >.</span><span style="color: rgb(0, 0, 255);"   >Parameters</span><span style="color: rgb(0, 128, 0);"   >.</span><span style="color: rgb(0, 0, 255);"   >AddWithValue</span><span style="color: rgb(0, 128, 0);"   >(</span><span style="color: rgb(102, 102, 102);"   >"@username"</span>, username<span style="color: rgb(0, 128, 0);"   >)</span><span style="color: rgb(0, 128, 0);"   >;</span>
    command<span style="color: rgb(0, 128, 0);"   >.</span><span style="color: rgb(0, 0, 255);"   >Parameters</span><span style="color: rgb(0, 128, 0);"   >.</span><span style="color: rgb(0, 0, 255);"   >AddWithValue</span><span style="color: rgb(0, 128, 0);"   >(</span><span style="color: rgb(102, 102, 102);"   >"@room"</span>, room<span style="color: rgb(0, 128, 0);"   >)</span><span style="color: rgb(0, 128, 0);"   >;</span>
 
    <span style="color: rgb(6, 0, 255); font-weight: bold;"   >using</span> <span style="color: rgb(0, 128, 0);"   >(</span>SqlDataReader dataReader <span style="color: rgb(0, 128, 0);"   >=</span> command<span style="color: rgb(0, 128, 0);"   >.</span><span style="color: rgb(0, 0, 255);"   >ExecuteReader</span><span style="color: rgb(0, 128, 0);"   >(</span><span style="color: rgb(0, 128, 0);"   >)</span><span style="color: rgb(0, 128, 0);"   >)</span>
    <span style="color: rgb(0, 128, 0);"   >{</span>
        <span style="color: rgb(0, 128, 128); font-style: italic;"   >// ...</span>
    <span style="color: rgb(0, 128, 0);"   >}</span>
<span style="color: rgb(0, 128, 0);"   >}</span>
</pre></div></div><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.1875px; font-family: sans-serif; font-size: 13px;"   >ADO.NET&nbsp;<code style="font-family: monospace, Courier; background-color: rgb(249, 249, 249);"   >SqlCommand</code>&nbsp;will accept any type for the&nbsp;<code style="font-family: monospace, Courier; background-color: rgb(249, 249, 249);"   >value</code>&nbsp;parameter of&nbsp;<code style="font-family: monospace, Courier; background-color: rgb(249, 249, 249);"   >AddWithValue</code>, and type conversion occurs automatically.</p><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.1875px; font-family: sans-serif; font-size: 13px;"   >Note the use of "named parameters" (i.e. "@username") rather than "?" - this allows you to use a parameter multiple times and in any arbitrary order within the query command text.</p><h3 style="background-image: none; margin: 0px 0px 0.3em; overflow: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-style: none; font-size: 17px; font-family: sans-serif; line-height: 19.1875px;"   ><span id="Python_DB-API"   >Python DB-API</span>&nbsp;<span style="-webkit-user-select: none; font-size: small; font-weight: normal; margin-left: 1em; vertical-align: baseline; line-height: 1em; display: inline-block;"   >[<a title="Edit section: Python DB-API" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/w/index.php?title=Prepared_statement&amp;action=edit&amp;section=7"   >edit</a>]</span></h3><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.1875px; font-family: sans-serif; font-size: 13px;"   >This example uses&nbsp;<a title="Python (programming language)" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/Python_(programming_language)"   >Python</a>&nbsp;DB-API with&nbsp;<a title="SQLite" style="text-decoration: none; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/SQLite"   >SQLite</a>&nbsp;and&nbsp;<code style="font-family: monospace, Courier; background-color: rgb(249, 249, 249);"   >paramstyle='qmark'</code>:</p><div dir="ltr"   style="direction: ltr; font-family: monospace, Courier; padding: 1em; border: 1px dashed rgb(47, 111, 171); background-color: rgb(249, 249, 249); line-height: 1.1em; font-size: 13px;"   ><div style="line-height: normal; font-family: monospace;"   ><pre style="font-family: monospace, monospace; padding: 0px; border: 0px none white; line-height: 1.2em; font-size: 1em; margin-top: 0px; margin-bottom: 0px; background-image: none; vertical-align: top;"   ><span style="color: rgb(255, 119, 0); font-weight: bold;"   >import</span> sqlite3
conn <span style="color: rgb(102, 204, 102);"   >=</span> sqlite3.<span>connect</span><span>(</span><span style="color: rgb(72, 61, 139);"   >':memory:'</span><span>)</span>
c <span style="color: rgb(102, 204, 102);"   >=</span> conn.<span>cursor</span><span>(</span><span>)</span>
 
_users <span style="color: rgb(102, 204, 102);"   >=</span> <span>[</span><span>(</span><span style="color: rgb(72, 61, 139);"   >'A'</span><span style="color: rgb(102, 204, 102);"   >,</span> <span style="color: rgb(72, 61, 139);"   >'red'</span><span>)</span><span style="color: rgb(102, 204, 102);"   >,</span>
          <span>(</span><span style="color: rgb(72, 61, 139);"   >'B'</span><span style="color: rgb(102, 204, 102);"   >,</span> <span style="color: rgb(72, 61, 139);"   >'green'</span><span>)</span><span style="color: rgb(102, 204, 102);"   >,</span>
          <span>(</span><span style="color: rgb(72, 61, 139);"   >'C'</span><span style="color: rgb(102, 204, 102);"   >,</span> <span style="color: rgb(72, 61, 139);"   >'blue'</span><span>)</span><span>]</span>
c.<span>executemany</span><span>(</span><span style="color: rgb(72, 61, 139);"   >'INSERT INTO users VALUES (?,?)'</span><span style="color: rgb(102, 204, 102);"   >,</span> _users<span>)</span>
 
params <span style="color: rgb(102, 204, 102);"   >=</span> <span>(</span><span style="color: rgb(72, 61, 139);"   >'B'</span><span style="color: rgb(102, 204, 102);"   >,</span> <span style="color: rgb(72, 61, 139);"   >'green'</span><span>)</span>
c.<span>execute</span><span>(</span><span style="color: rgb(72, 61, 139);"   >'SELECT * FROM users WHERE username=? AND room=?'</span><span style="color: rgb(102, 204, 102);"   >,</span> params<span>)</span>
c.<span>fetchone</span><span>(</span><span>)</span></pre></div></div></div><div><br></div><div>2. 字符逃逸</div><div>php参考 :&nbsp;</div><div><a rel="nofollow" href="http://php.net/manual/en/function.pg-escape-string.php"   >http://php.net/manual/en/function.pg-escape-string.php</a></div><div>使用pg_escape_string函数将字符串中的特殊字符转义, 因此不会带来前面的问题.</div><div>例如 将1个单引号转成2个单引号.&nbsp;</div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201342185210972/"   >http://blog.163.com/digoal@126/blog/static/163877040201342185210972/</a></div><div><br></div><div>3. 强制类型</div><div>对于变量本应该是int类型的, 就不允许输入字符类型.</div><div><br></div><div>4. 数据库权限控制</div><div>把业务程序性用户的权限收到最小, 满足业务需求即可.</div><div><br></div><div>[其他]</div><div>1. 平时做好归档的备份以及基础备份很重要, 即使真的被攻击了, 也可以恢复到被攻击前的时间点, 将数据挽回.</div><div>2. 对于重要的表, 最好所有的DML, DDL都要进行跟踪记录. 例如使用触发器跟踪变更.</div><div>参考 :&nbsp;</div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201252575529358/"   >http://blog.163.com/digoal@126/blog/static/163877040201252575529358/</a></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://en.wikipedia.org/wiki/Sql_injection"   >http://en.wikipedia.org/wiki/Sql_injection</a></div><div>2.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/1638770402012910234402/"   >http://blog.163.com/digoal@126/blog/static/1638770402012910234402/</a></div><div>3.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-string.html"   >http://www.postgresql.org/docs/devel/static/functions-string.html</a></div><div>4.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://php.net/manual/en/function.pg-escape-string.php"   >http://php.net/manual/en/function.pg-escape-string.php</a></div><div>5.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/runtime-config-compatible.html"   >http://www.postgresql.org/docs/9.3/static/runtime-config-compatible.html</a></div><div>6.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/163877040201342185210972/"   >http://blog.163.com/digoal@126/blog/static/163877040201342185210972/</a></div><div>7.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://en.wikipedia.org/wiki/Prepared_statement"   >http://en.wikipedia.org/wiki/Prepared_statement</a></div><div>8.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://en.wikipedia.org/wiki/Object-relational_mapping"   >http://en.wikipedia.org/wiki/Object-relational_mapping</a></div><div>9.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://en.wikipedia.org/wiki/Query_optimization"   >http://en.wikipedia.org/wiki/Query_optimization</a></div><div>10.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/1638770402012112452432251/"   >http://blog.163.com/digoal@126/blog/static/1638770402012112452432251/</a></div></div>
	</div>
</div>
</body>
</html>