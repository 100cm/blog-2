<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.3 Add API for 64-bit large object access</h2>
	<h5 id="">2013-05-10 11:16:40&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201341082422954/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Increase the maximum length of large objects from 2GB to 4TB (Nozomi Anzai, Yugo Nagata)</font></div><div><font size="2"   >This change includes new libpq and server-side 64-bit-capable large object access functions.</font></div><div><div><font size="2"   >Add API for 64-bit large object access. &nbsp;Now users can access up to</font></div><div><font size="2"   >4TB large objects (standard 8KB BLCKSZ case). &nbsp;For this purpose new</font></div><div><font size="2"   >libpq API lo_lseek64, lo_tell64 and lo_truncate64 are added. &nbsp;Also</font></div><div><font size="2"   >corresponding new backend functions lo_lseek64, lo_tell64 and</font></div><div><font size="2"   >lo_truncate64 are added. inv_api.c is changed to handle 64-bit</font></div><div><font size="2"   >offsets.</font></div><div><font size="2"   >Patch contributed by Nozomi Anzai (backend side) and Yugo Nagata</font></div><div><font size="2"   >(frontend side, docs, regression tests and example program). Reviewed</font></div><div><font size="2"   >by Kohei Kaigai. Committed by Tatsuo Ishii with minor editings.</font></div></div><p></p></pre></div><div>PostgreSQL 9.3 新增了64位的大对象访问接口函数如下 :&nbsp;</div><div>src/interfaces/libpq/fe-lobj.c</div><div><span style="line-height: 22px;"   >lo_lseek64, lo_tell64 and lo_truncate64.</span></div><div><span style="line-height: 22px;"   ><br></span></div><div><span style="line-height: 22px;"   >同时新增了服务端64位函数.</span></div><div>src/backend/libpq/be-fsstubs.c</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# \df *.*lo_*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List of functions</font></div><div><font size="2"   >&nbsp; &nbsp;Schema &nbsp; | &nbsp; &nbsp; Name &nbsp; &nbsp; &nbsp;| Result data type | &nbsp; &nbsp;Argument data types &nbsp; &nbsp;| &nbsp;Type &nbsp;</font></div><div><font size="2"   >------------+---------------+------------------+---------------------------+--------</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_close &nbsp; &nbsp; &nbsp;| integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_creat &nbsp; &nbsp; &nbsp;| oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_create &nbsp; &nbsp; | oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_export &nbsp; &nbsp; | integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| oid, text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_import &nbsp; &nbsp; | oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_import &nbsp; &nbsp; | oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| text, oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_lseek &nbsp; &nbsp; &nbsp;| integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| integer, integer, integer | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_lseek64 &nbsp; &nbsp;| bigint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | integer, bigint, integer &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_open &nbsp; &nbsp; &nbsp; | integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| oid, integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_tell &nbsp; &nbsp; &nbsp; | integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_tell64 &nbsp; &nbsp; | bigint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_truncate &nbsp; | integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| integer, integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_truncate64 | integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| integer, bigint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;pg_catalog | lo_unlink &nbsp; &nbsp; | integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >(14 rows)</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >大对象的服务端使用可参考 :&nbsp;</span></div><div><div style="line-height: 22px;"   >2.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/16387704020130931040444/"   >http://blog.163.com/digoal@126/blog/static/16387704020130931040444/</a></div><div style="line-height: 22px;"   >3.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/1638770402013264951552/"   >http://blog.163.com/digoal@126/blog/static/1638770402013264951552/</a></div></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=461ef73f0977c95c9452680495bc161618db9227"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=461ef73f0977c95c9452680495bc161618db9227</a></div><div>2.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/16387704020130931040444/"   >http://blog.163.com/digoal@126/blog/static/16387704020130931040444/</a></div><div>3.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/1638770402013264951552/"   >http://blog.163.com/digoal@126/blog/static/1638770402013264951552/</a></div><div>4.&nbsp;</div><div><div>16 files changed:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >doc/src/sgml/lobj.sgml<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/backend/libpq/be-fsstubs.c<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/backend/storage/large_object/inv_api.c<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/backend/utils/errcodes.txt<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/include/catalog/pg_proc.h<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/include/libpq/be-fsstubs.h<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/include/postgres_ext.h<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/include/storage/large_object.h<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/interfaces/libpq/exports.txt<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/interfaces/libpq/fe-lobj.c<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/interfaces/libpq/libpq-fe.h<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/interfaces/libpq/libpq-int.h<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/test/examples/Makefile<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/test/examples/testlo64.c<span>	</span>[new file with mode: 0644]<span>	</span>blob</font></div><div><font size="2"   >src/test/regress/input/largeobject.source<span>		</span>diff | blob | blame | history</font></div><div><font size="2"   >src/test/regress/output/largeobject.source<span>		</span>diff | blob | blame | history</font></div><p></p></pre></div></div><div>5.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/lo-interfaces.html"   >http://www.postgresql.org/docs/devel/static/lo-interfaces.html</a></div><wbr></div>
	</div>
</div>
</body>
</html>