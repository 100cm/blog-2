<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">xlogdump for PostgreSQL 9.2 9.1 9.0 8.4 8.3</h2>
	<h5 id="">2013-05-17 13:13:31&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020134171456746/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="line-height: 22px;"   >PostgreSQL 9.3 新增了pg_xlogdump的模块, 可以dump xlog中的内容.</span></div><div>如果你的系统是PostgreSQL 9.2以及以下的版本, 那么可以考虑使用xlogdump这个开源软件.</div><div>它支持9.x, 8.3, 8.4, 同样可以达到dump xlog的目的.</div><div><br></div><div>下载地址 :&nbsp;</div><div><a target="_blank" rel="nofollow" href="https://github.com/snaga/xlogdump"   >https://github.com/snaga/xlogdump</a></div><div><br></div><div>以PostgreSQL 9.2.4 为例安装xlogdump.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >unzip xlogdump-master.zip</font></div><div><font size="2"   >cd xlogdump-master</font></div><div><font size="2"   >[root@db-172-16-3-33 ~]# export PATH=/opt/pgsql9.2.4/bin:$PATH</font></div><div><font size="2"   >[root@db-172-16-3-33 ~]# which pg_config</font></div><div><font size="2"   >/opt/pgsql9.2.4/bin/pg_config</font></div><div><font size="2"   >gmake USE_PGXS=1</font></div><div><font size="2"   >gmake USE_PGXS=1 install</font></div><p></p></pre></div><div>安装输出 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-33 xlogdump-master]# gmake USE_PGXS=1</font></div><div><font size="2"   >gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -g -DVERSION_STR=\""0.6devel"\" -I. -I/opt/pgsql9.2.4/include -DDATADIR=\"/opt/pgsql9.2.4/share\" -I. -I. -I/opt/pgsql9.2.4/include/server -I/opt/pgsql9.2.4/include/internal -D_GNU_SOURCE -I/usr/include/libxml2 &nbsp; -c -o strlcpy.o strlcpy.c</font></div><div><font size="2"   >gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -g -DVERSION_STR=\""0.6devel"\" -I. -I/opt/pgsql9.2.4/include -DDATADIR=\"/opt/pgsql9.2.4/share\" -I. -I. -I/opt/pgsql9.2.4/include/server -I/opt/pgsql9.2.4/include/internal -D_GNU_SOURCE -I/usr/include/libxml2 &nbsp; -c -o xlogdump.o xlogdump.c</font></div><div><font size="2"   >gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -g -DVERSION_STR=\""0.6devel"\" -I. -I/opt/pgsql9.2.4/include -DDATADIR=\"/opt/pgsql9.2.4/share\" -I. -I. -I/opt/pgsql9.2.4/include/server -I/opt/pgsql9.2.4/include/internal -D_GNU_SOURCE -I/usr/include/libxml2 &nbsp; -c -o xlogdump_rmgr.o xlogdump_rmgr.c</font></div><div><font size="2"   >gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -g -DVERSION_STR=\""0.6devel"\" -I. -I/opt/pgsql9.2.4/include -DDATADIR=\"/opt/pgsql9.2.4/share\" -I. -I. -I/opt/pgsql9.2.4/include/server -I/opt/pgsql9.2.4/include/internal -D_GNU_SOURCE -I/usr/include/libxml2 &nbsp; -c -o xlogdump_statement.o xlogdump_statement.c</font></div><div><font size="2"   >cp oid2name-`echo 9.2.4 | sed -e 's/^\([0-9]*\)\.\([0-9]*\).*/\1\2/g'`.txt oid2name.txt</font></div><div><font size="2"   >gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -g -DVERSION_STR=\""0.6devel"\" -I. -I/opt/pgsql9.2.4/include -DDATADIR=\"/opt/pgsql9.2.4/share\" -I. -I. -I/opt/pgsql9.2.4/include/server -I/opt/pgsql9.2.4/include/internal -D_GNU_SOURCE -I/usr/include/libxml2 &nbsp; -c -o xlogdump_oid2name.o xlogdump_oid2name.c</font></div><div><font size="2"   >gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -g strlcpy.o xlogdump.o xlogdump_rmgr.o xlogdump_statement.o xlogdump_oid2name.o -L/opt/pgsql9.2.4/lib -lpgport -L/opt/pgsql9.2.4/lib -lpq -L/opt/pgsql9.2.4/lib &nbsp;-Wl,-rpath,'/opt/pgsql9.2.4/lib',--enable-new-dtags &nbsp;-lpgport -lxslt -lxml2 -lpam -lssl -lcrypto -lz -lreadline -ltermcap -lcrypt -ldl -lm &nbsp;-o xlogdump</font></div><div><font size="2"   >[root@db-172-16-3-33 xlogdump-master]# gmake USE_PGXS=1 install</font></div><div><font size="2"   >/bin/mkdir -p '/opt/pgsql9.2.4/share/contrib'</font></div><div><font size="2"   >/bin/mkdir -p '/opt/pgsql9.2.4/share/doc/contrib'</font></div><div><font size="2"   >/bin/mkdir -p '/opt/pgsql9.2.4/bin'</font></div><div><font size="2"   >/bin/sh /opt/pgsql9.2.4/lib/pgxs/src/makefiles/../../config/install-sh -c -m 644 ./oid2name.txt &nbsp;'/opt/pgsql9.2.4/share/contrib/'</font></div><div><font size="2"   >/bin/sh /opt/pgsql9.2.4/lib/pgxs/src/makefiles/../../config/install-sh -c -m 644 ./README.xlogdump '/opt/pgsql9.2.4/share/doc/contrib/'</font></div><div><font size="2"   >/bin/sh /opt/pgsql9.2.4/lib/pgxs/src/makefiles/../../config/install-sh -c &nbsp;xlogdump '/opt/pgsql9.2.4/bin'</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >xlogdump安装完成.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-33 xlogdump-master]# which xlogdump</font></div><div><font size="2"   >/opt/pgsql9.2.4/bin/xlogdump</font></div><p></p></pre></div><div>xlogdump的命令行选项 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-33 xlogdump-master]# xlogdump --help</font></div><div><font size="2"   >xlogdump version 0.6devel</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Usage:</font></div><div><font size="2"   >&nbsp; xlogdump [OPTION]... [segment file(s)]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Options:</font></div><div><font size="2"   >&nbsp; -r, --rmid=RMID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Outputs only the transaction log records</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; containing the specified operation.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RMID:Resource Manager</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0:XLOG</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1:Transaction</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2:Storage</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3:CLOG</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4:Database</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5:Tablespace</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6:MultiXact</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7:RelMap</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8:Standby</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9:Heap2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10:Heap</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 11:Btree</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 12:Hash</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 13:Gin</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 14:Gist</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 15:Sequence</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16:SPGist</font></div><div><font size="2"   >&nbsp; -x, --xid=XID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Outputs only the transaction log records</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; containing the specified transaction id.</font></div><div><font size="2"   >&nbsp; -t, --transactions &nbsp; &nbsp; &nbsp; &nbsp;Outputs only transaction info: the xid,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; total length and status of each transaction.</font></div><div><font size="2"   >&nbsp; -s, --statements &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Tries to build fake statements that produce the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; physical changes found within the xlog segments.</font></div><div><font size="2"   >&nbsp; -S, --stats &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Collects and shows statistics of the transaction</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; log records from the xlog segments.</font></div><div><font size="2"   >&nbsp; -n, --oid2name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Show object names instead of OIDs with looking up</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the system catalogs or a cache file.</font></div><div><font size="2"   >&nbsp; -g, --gen_oid2name &nbsp; &nbsp; &nbsp; &nbsp;Generate an oid2name cache file (oid2name.out)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; by reading the system catalogs.</font></div><div><font size="2"   >&nbsp; -T, --hide-timestamps &nbsp; &nbsp; Do not print timestamps.</font></div><div><font size="2"   >&nbsp; -?, --help &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Show this help.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >oid2name supplimental options:</font></div><div><font size="2"   >&nbsp; -h, --host=HOST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; database server host or socket directory</font></div><div><font size="2"   >&nbsp; -p, --port=PORT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; database server port number</font></div><div><font size="2"   >&nbsp; -U, --user=NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; database user name to connect</font></div><div><font size="2"   >&nbsp; -d, --dbname=NAME &nbsp; &nbsp; &nbsp; &nbsp; database name to connect</font></div><div><font size="2"   >&nbsp; -f, --file=FILE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; file name to read oid2name cache</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Report bugs to &lt;satoshi.nagayasu@gmail.com&gt;.</font></div><p></p></pre></div><div><br></div><div>使用xlogdump可以从WAL日志中读取到的信息和PostgreSQL 9.3的pg_xlogdump类似.</div><div>注意xlogdump多了项统计和oid2name转换的功能.&nbsp;</div><div>pg_xlogdump则多了输出backupblock详细信息的功能.</div><div><br></div><div>xlogdump使用举例 :&nbsp;</div><div>SESSION A :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-33-&gt; psql</font></div><div><font size="2"   >psql (9.2.4)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# \d test</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;Table "public.test"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | integer |&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# begin;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >digoal=# select txid_current();</font></div><div><font size="2"   >&nbsp;txid_current&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; 5140831</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# insert into test values (10);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# create table new_test (like test including all);</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=# insert into new_test values (9);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# delete from test;</font></div><div><font size="2"   >DELETE 11</font></div><div><font size="2"   >digoal=# end;</font></div><div><font size="2"   >COMMIT</font></div><div><font size="2"   >digoal=# checkpoint;</font></div><div><font size="2"   >CHECKPOINT</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >SESSION B :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-33 ~]# which xlogdump</font></div><div><font size="2"   >/opt/pgsql9.2.4/bin/xlogdump</font></div><div><font size="2"   >[root@db-172-16-3-33 ~]# cd /pgdata1919/pg_xlog</font></div><div><font size="2"   >[root@db-172-16-3-33 pg_xlog]# ll -rt|tail -n 5</font></div><div><font size="2"   >-rw------- 1 pg92 pg92 16777216 May 16 12:39 00000002000000020000007A</font></div><div><font size="2"   >-rw------- 1 pg92 pg92 16777216 May 16 12:39 00000002000000020000007B</font></div><div><font size="2"   >-rw------- 1 pg92 pg92 16777216 May 16 12:39 00000002000000020000007C</font></div><div><font size="2"   >drwx------ 2 pg92 pg92 &nbsp; &nbsp;12288 May 16 12:43 archive_status</font></div><div><font size="2"   >-rw------- 1 pg92 pg92 16777216 May 17 12:42 00000002000000020000007D</font></div><p></p></pre></div><div>生成被分析的库的oid2name文件.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-33 pg_xlog]# xlogdump -g -h 127.0.0.1 -p 1919 -U digoal -d digoal</font></div><div><font size="2"   >oid2name.out successfully created.</font></div><p></p></pre></div><div>因为被分析的xlog文件是最后一个文件, 最好关闭数据库后进行分析 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-33-&gt; pg_ctl stop -m fast</font></div><div><font size="2"   >waiting for server to shut down.... done</font></div><div><font size="2"   >server stopped</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >分析 :&nbsp;</span></div><div><pre class="prettyprint"   ><p><font size="2"   >xlogdump -n -s -f ./oid2name.out /pgdata1919/pg_xlog/00000002000000020000007D 2&gt;/dev/null|less</font></p></pre></div><div>截取xid=5140831的部分.</div><div>因为使用了-n参数,所以oid被转成了表名, test, new_test.</div><div>其他的含义可以参考 :&nbsp;</div><div>PostgreSQL 9.3 XLOG dump contrib introduce</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201312311244246/"   >http://blog.163.com/digoal@126/blog/static/163877040201312311244246/</a></div><div>虽然只插入了2条记录, 创建了1个表, 但是观察到的insert有很多, 有btree的也有heap的, 那是为什么呢?</div><div>因为有create table 的动作, 这个动作需要改动很多系统表.</div><div>如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select relname from pg_class where pg_relation_filepath(oid) ~ '12531';</font></div><div><font size="2"   >&nbsp;relname&nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;pg_type</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select relname from pg_class where pg_relation_filepath(oid) ~ '12533';</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; relname &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >-------------------</font></div><div><font size="2"   >&nbsp;pg_type_oid_index</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select oid,relname from pg_class where pg_relation_filepath(oid) ~ '12534';</font></div><div><font size="2"   >&nbsp;oid &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;relname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------+---------------------------</font></div><div><font size="2"   >&nbsp;2704 | pg_type_typname_nsp_index</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select oid,relname from pg_class where pg_relation_filepath(oid) ~ '12656';</font></div><div><font size="2"   >&nbsp;oid &nbsp;| &nbsp;relname &nbsp;</font></div><div><font size="2"   >------+-----------</font></div><div><font size="2"   >&nbsp;2608 | pg_depend</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select oid,relname from pg_class where pg_relation_filepath(oid) ~ '12658';</font></div><div><font size="2"   >&nbsp;oid &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; relname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------+--------------------------</font></div><div><font size="2"   >&nbsp;2673 | pg_depend_depender_index</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select oid,relname from pg_class where pg_relation_filepath(oid) ~ '12659';</font></div><div><font size="2"   >&nbsp;oid &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;relname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------+---------------------------</font></div><div><font size="2"   >&nbsp;2674 | pg_depend_reference_index</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select oid,relname from pg_class where pg_relation_filepath(oid) ~ '12554';</font></div><div><font size="2"   >&nbsp;oid &nbsp;| relname &nbsp;</font></div><div><font size="2"   >------+----------</font></div><div><font size="2"   >&nbsp;1259 | pg_class</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select oid,relname from pg_class where pg_relation_filepath(oid) ~ '12545';</font></div><div><font size="2"   >&nbsp;oid &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; relname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------+---------------------------------</font></div><div><font size="2"   >&nbsp;2658 | pg_attribute_relid_attnam_index</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>详细xlog dump数据 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[cur:2/7DA24A98, xid:5140831, rmid:10(Heap), len/tot_len:21/497, info:8, prev:2/7DA24A38] insert: s/d/r:pg_default/digoal/test blk/off:0/11 header: none</font></div><div><font size="2"   >[cur:2/7DA24A98, xid:5140831, rmid:10(Heap), len/tot_len:21/497, info:8, prev:2/7DA24A38] bkpblock[1]: s/d/r:pg_default/digoal/test blk:0 hole_off/len:68/7772</font></div><div><font size="2"   >[cur:2/7DA24C90, xid:5140831, rmid:2(Storage), len/tot_len:16/48, info:16, prev:2/7DA24A98] create rel: s/d/r:pg_default/digoal/new_test</font></div><div><font size="2"   >[cur:2/7DA24CC0, xid:5140831, rmid:10(Heap), len/tot_len:21/6797, info:8, prev:2/7DA24C90] insert: s/d/r:pg_default/digoal/12531 blk/off:7/78 header: none</font></div><div><font size="2"   >[cur:2/7DA24CC0, xid:5140831, rmid:10(Heap), len/tot_len:21/6797, info:8, prev:2/7DA24C90] bkpblock[1]: s/d/r:pg_default/digoal/12531 blk:7 hole_off/len:384/1472</font></div><div><font size="2"   >[page:650, xlp_info:5, xlp_tli:2, xlp_pageaddr:2/7DA28000] XLP_FIRST_IS_CONTRECORD XLP_BKP_REMOVABLE&nbsp;</font></div><div><font size="2"   >[cur:2/7DA26750, xid:5140831, rmid:11(Btree), len/tot_len:18/7854, info:8, prev:2/7DA24CC0] insert_leaf: s/d/r:pg_default/digoal/12533 tid 1/387</font></div><div><font size="2"   >[cur:2/7DA26750, xid:5140831, rmid:11(Btree), len/tot_len:18/7854, info:8, prev:2/7DA24CC0] bkpblock[1]: s/d/r:pg_default/digoal/12533 blk:1 hole_off/len:1572/412</font></div><div><font size="2"   >[cur:2/7DA28618, xid:5140831, rmid:11(Btree), len/tot_len:18/8202, info:8, prev:2/7DA26750] insert_leaf: s/d/r:pg_default/digoal/12534 tid 1/172</font></div><div><font size="2"   >[cur:2/7DA28618, xid:5140831, rmid:11(Btree), len/tot_len:18/8202, info:8, prev:2/7DA26750] bkpblock[1]: s/d/r:pg_default/digoal/12534 blk:1 hole_off/len:1048/64</font></div><div><font size="2"   >[cur:2/7DA2A628, xid:5140831, rmid:10(Heap), len/tot_len:21/1661, info:8, prev:2/7DA28618] insert: s/d/r:pg_default/digoal/12656 blk/off:49/26 header: none</font></div><div><font size="2"   >[cur:2/7DA2A628, xid:5140831, rmid:10(Heap), len/tot_len:21/1661, info:8, prev:2/7DA28618] bkpblock[1]: s/d/r:pg_default/digoal/12656 blk:49 hole_off/len:128/6608</font></div><div><font size="2"   >[page:651, xlp_info:5, xlp_tli:2, xlp_pageaddr:2/7DA2C000] XLP_FIRST_IS_CONTRECORD XLP_BKP_REMOVABLE&nbsp;</font></div><div><font size="2"   >[cur:2/7DA2ACA8, xid:5140831, rmid:11(Btree), len/tot_len:18/5518, info:8, prev:2/7DA2A628] insert_leaf: s/d/r:pg_default/digoal/12658 tid 26/185</font></div><div><font size="2"   >[cur:2/7DA2ACA8, xid:5140831, rmid:11(Btree), len/tot_len:18/5518, info:8, prev:2/7DA2A628] bkpblock[1]: s/d/r:pg_default/digoal/12658 blk:26 hole_off/len:796/2748</font></div><div><font size="2"   >[cur:2/7DA2C250, xid:5140831, rmid:11(Btree), len/tot_len:18/5854, info:8, prev:2/7DA2ACA8] insert_leaf: s/d/r:pg_default/digoal/12659 tid 18/196</font></div><div><font size="2"   >[cur:2/7DA2C250, xid:5140831, rmid:11(Btree), len/tot_len:18/5854, info:8, prev:2/7DA2ACA8] bkpblock[1]: s/d/r:pg_default/digoal/12659 blk:18 hole_off/len:844/2412</font></div><div><font size="2"   >[cur:2/7DA2D930, xid:5140831, rmid:10(Heap), len/tot_len:175/207, info:0, prev:2/7DA2C250] insert: s/d/r:pg_default/digoal/12531 blk/off:7/79 header: t_infomask2 30 t_infomask 2057 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA2DA00, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA2D930] insert_leaf: s/d/r:pg_default/digoal/12533 tid 1/387</font></div><div><font size="2"   >[cur:2/7DA2DA48, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA2DA00] insert_leaf: s/d/r:pg_default/digoal/12534 tid 1/40</font></div><div><font size="2"   >[cur:2/7DA2DA98, xid:5140831, rmid:10(Heap), len/tot_len:52/84, info:0, prev:2/7DA2DA48] insert: s/d/r:pg_default/digoal/12656 blk/off:49/27 header: t_infomask2 7 t_infomask 2048 t_hoff 24</font></div><div><font size="2"   >[cur:2/7DA2DAF0, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA2DA98] insert_leaf: s/d/r:pg_default/digoal/12658 tid 26/185</font></div><div><font size="2"   >[cur:2/7DA2DB40, xid:5140831, rmid:11(Btree), len/tot_len:18/5014, info:8, prev:2/7DA2DAF0] insert_leaf: s/d/r:pg_default/digoal/12659 tid 31/93</font></div><div><font size="2"   >[cur:2/7DA2DB40, xid:5140831, rmid:11(Btree), len/tot_len:18/5014, info:8, prev:2/7DA2DAF0] bkpblock[1]: s/d/r:pg_default/digoal/12659 blk:31 hole_off/len:724/3252</font></div><div><font size="2"   >[page:652, xlp_info:5, xlp_tli:2, xlp_pageaddr:2/7DA30000] XLP_FIRST_IS_CONTRECORD XLP_BKP_REMOVABLE&nbsp;</font></div><div><font size="2"   >[cur:2/7DA2EED8, xid:5140831, rmid:10(Heap), len/tot_len:21/5049, info:8, prev:2/7DA2DB40] insert: s/d/r:pg_default/digoal/12554 blk/off:7/37 header: none</font></div><div><font size="2"   >[cur:2/7DA2EED8, xid:5140831, rmid:10(Heap), len/tot_len:21/5049, info:8, prev:2/7DA2DB40] bkpblock[1]: s/d/r:pg_default/digoal/12554 blk:7 hole_off/len:460/3220</font></div><div><font size="2"   >[cur:2/7DA302A8, xid:5140831, rmid:11(Btree), len/tot_len:18/7174, info:8, prev:2/7DA2EED8] insert_leaf: s/d/r:pg_default/digoal/12556 tid 1/353</font></div><div><font size="2"   >[cur:2/7DA302A8, xid:5140831, rmid:11(Btree), len/tot_len:18/7174, info:8, prev:2/7DA2EED8] bkpblock[1]: s/d/r:pg_default/digoal/12556 blk:1 hole_off/len:1436/1092</font></div><div><font size="2"   >[cur:2/7DA31EB0, xid:5140831, rmid:11(Btree), len/tot_len:18/7882, info:8, prev:2/7DA302A8] insert_leaf: s/d/r:pg_default/digoal/12557 tid 1/54</font></div><div><font size="2"   >[cur:2/7DA31EB0, xid:5140831, rmid:11(Btree), len/tot_len:18/7882, info:8, prev:2/7DA302A8] bkpblock[1]: s/d/r:pg_default/digoal/12557 blk:1 hole_off/len:824/384</font></div><div><font size="2"   >[cur:2/7DA33D80, xid:5140831, rmid:10(Heap), len/tot_len:21/397, info:8, prev:2/7DA31EB0] insert: s/d/r:pg_default/digoal/12543 blk/off:45/2 header: none</font></div><div><font size="2"   >[cur:2/7DA33D80, xid:5140831, rmid:10(Heap), len/tot_len:21/397, info:8, prev:2/7DA31EB0] bkpblock[1]: s/d/r:pg_default/digoal/12543 blk:45 hole_off/len:32/7872</font></div><div><font size="2"   >[page:653, xlp_info:5, xlp_tli:2, xlp_pageaddr:2/7DA34000] XLP_FIRST_IS_CONTRECORD XLP_BKP_REMOVABLE&nbsp;</font></div><div><font size="2"   >[cur:2/7DA33F10, xid:5140831, rmid:11(Btree), len/tot_len:18/1386, info:8, prev:2/7DA33D80] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/46</font></div><div><font size="2"   >[cur:2/7DA33F10, xid:5140831, rmid:11(Btree), len/tot_len:18/1386, info:8, prev:2/7DA33D80] bkpblock[1]: s/d/r:pg_default/digoal/12545 blk:16 hole_off/len:208/6880</font></div><div><font size="2"   >[cur:2/7DA34490, xid:5140831, rmid:11(Btree), len/tot_len:18/6414, info:8, prev:2/7DA33F10] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA34490, xid:5140831, rmid:11(Btree), len/tot_len:18/6414, info:8, prev:2/7DA33F10] bkpblock[1]: s/d/r:pg_default/digoal/12546 blk:10 hole_off/len:1284/1852</font></div><div><font size="2"   >[cur:2/7DA35DA0, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA34490] insert: s/d/r:pg_default/digoal/12543 blk/off:45/3 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA35E50, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA35DA0] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/46</font></div><div><font size="2"   >[cur:2/7DA35EA0, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA35E50] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA35EE8, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA35EA0] insert: s/d/r:pg_default/digoal/12543 blk/off:45/4 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA35F98, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA35EE8] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/48</font></div><div><font size="2"   >[cur:2/7DA35FE8, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA35F98] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA36030, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA35FE8] insert: s/d/r:pg_default/digoal/12543 blk/off:45/5 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA360E0, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA36030] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/46</font></div><div><font size="2"   >[cur:2/7DA36130, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA360E0] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA36178, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA36130] insert: s/d/r:pg_default/digoal/12543 blk/off:45/6 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA36228, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA36178] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/49</font></div><div><font size="2"   >[cur:2/7DA36278, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA36228] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA362C0, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA36278] insert: s/d/r:pg_default/digoal/12543 blk/off:45/7 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA36370, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA362C0] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/46</font></div><div><font size="2"   >[cur:2/7DA363C0, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA36370] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA36408, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA363C0] insert: s/d/r:pg_default/digoal/12543 blk/off:45/8 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA364B8, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA36408] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/50</font></div><div><font size="2"   >[cur:2/7DA36508, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA364B8] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA36550, xid:5140831, rmid:10(Heap), len/tot_len:52/84, info:0, prev:2/7DA36508] insert: s/d/r:pg_default/digoal/12656 blk/off:49/28 header: t_infomask2 7 t_infomask 2048 t_hoff 24</font></div><div><font size="2"   >[cur:2/7DA365A8, xid:5140831, rmid:11(Btree), len/tot_len:18/5182, info:8, prev:2/7DA36550] insert_leaf: s/d/r:pg_default/digoal/1[cur:2/7DA35E50, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA35DA0] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/46</font></div><div><font size="2"   >[cur:2/7DA35EA0, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA35E50] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA35EE8, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA35EA0] insert: s/d/r:pg_default/digoal/12543 blk/off:45/4 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA35F98, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA35EE8] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/48</font></div><div><font size="2"   >[cur:2/7DA35FE8, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA35F98] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA36030, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA35FE8] insert: s/d/r:pg_default/digoal/12543 blk/off:45/5 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA360E0, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA36030] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/46</font></div><div><font size="2"   >[cur:2/7DA36130, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA360E0] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA36178, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA36130] insert: s/d/r:pg_default/digoal/12543 blk/off:45/6 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA36228, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA36178] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/49</font></div><div><font size="2"   >[cur:2/7DA36278, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA36228] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA362C0, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA36278] insert: s/d/r:pg_default/digoal/12543 blk/off:45/7 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA36370, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA362C0] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/46</font></div><div><font size="2"   >[cur:2/7DA363C0, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA36370] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA36408, xid:5140831, rmid:10(Heap), len/tot_len:143/175, info:0, prev:2/7DA363C0] insert: s/d/r:pg_default/digoal/12543 blk/off:45/8 header: t_infomask2 21 t_infomask 2049 t_hoff 32</font></div><div><font size="2"   >[cur:2/7DA364B8, xid:5140831, rmid:11(Btree), len/tot_len:42/74, info:0, prev:2/7DA36408] insert_leaf: s/d/r:pg_default/digoal/12545 tid 16/50</font></div><div><font size="2"   >[cur:2/7DA36508, xid:5140831, rmid:11(Btree), len/tot_len:34/66, info:0, prev:2/7DA364B8] insert_leaf: s/d/r:pg_default/digoal/12546 tid 10/315</font></div><div><font size="2"   >[cur:2/7DA36550, xid:5140831, rmid:10(Heap), len/tot_len:52/84, info:0, prev:2/7DA36508] insert: s/d/r:pg_default/digoal/12656 blk/off:49/28 header: t_infomask2 7 t_infomask 2048 t_hoff 24</font></div><div><font size="2"   >[cur:2/7DA365A8, xid:5140831, rmid:11(Btree), len/tot_len:18/5182, info:8, prev:2/7DA36550] insert_leaf: s/d/r:pg_default/digoal/12659 tid 27/75</font></div><div><font size="2"   >[cur:2/7DA379E8, xid:5140831, rmid:11(Btree), len/tot_len:18/7758, info:8, prev:2/7DA365A8] bkpblock[1]: s/d/r:pg_default/digoal/12659 blk:27 hole_off/len:1116/508</font></div><div><font size="2"   >[cur:2/7DA39850, xid:5140831, rmid:8(Standby), len/tot_len:16/48, info:0, prev:2/7DA379E8] standby</font></div><div><font size="2"   >[cur:2/7DA39880, xid:5140831, rmid:10(Heap), len/tot_len:31/63, info:128, prev:2/7DA39850] insert(init): s/d/r:pg_default/digoal/new_test blk/off:0/1 header: t_infomask2 1 t_infomask 2048 t_hoff 24</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA398C0, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA39880] delete: s/d/r:pg_default/digoal/test block 0 off 1</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA398F8, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA398C0] delete: s/d/r:pg_default/digoal/test block 0 off 2</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA39930, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA398F8] delete: s/d/r:pg_default/digoal/test block 0 off 3</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA39968, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA39930] delete: s/d/r:pg_default/digoal/test block 0 off 4</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA399A0, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA39968] delete: s/d/r:pg_default/digoal/test block 0 off 5</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA399D8, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA399A0] delete: s/d/r:pg_default/digoal/test block 0 off 6</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA39A10, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA399D8] delete: s/d/r:pg_default/digoal/test block 0 off 7</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA39A48, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA39A10] delete: s/d/r:pg_default/digoal/test block 0 off 8</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA39A80, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA39A48] delete: s/d/r:pg_default/digoal/test block 0 off 9</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA39AB8, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA39A80] delete: s/d/r:pg_default/digoal/test block 0 off 10</font></div><div><font size="2"   >DELETE FROM test WHERE ...[cur:2/7DA39AF0, xid:5140831, rmid:10(Heap), len/tot_len:21/53, info:16, prev:2/7DA39AB8] delete: s/d/r:pg_default/digoal/test block 0 off 11</font></div><div><font size="2"   >[cur:2/7DA39B28, xid:5140831, rmid:1(Transaction), len/tot_len:368/400, info:0, prev:2/7DA39AF0] d/s:12788/1663 commit at 2013-05-17 12:42:35 CST</font></div><p></p></pre></div><div>xlogdump还可以对xlog文件的rmid进行汇总统计输出, 如下 :&nbsp;</div><div>分析xlog文件的统计信息, 各个RMID的数据量 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-33 pg_xlog]# xlogdump -S /pgdata1919/pg_xlog/00000002000000020000007D 2&gt;/dev/null|less</font></div><div><font size="2"   >---------------------------------------------------------------</font></div><div><font size="2"   >TimeLineId: 2, LogId: 2, LogSegment: 125</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Resource manager stats:&nbsp;</font></div><div><font size="2"   >&nbsp; [0]XLOG &nbsp; &nbsp; &nbsp;: 292 records, 18624 bytes (avg 63.8 bytes)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;checkpoint: 291, switch: 1, backup end: 0</font></div><div><font size="2"   >&nbsp; [1]Transaction: 45755 records, 551500 bytes (avg 12.1 bytes)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;commit: 3, abort: 0</font></div><div><font size="2"   >&nbsp; [2]Storage &nbsp; : 2 records, 32 bytes (avg 16.0 bytes)</font></div><div><font size="2"   >&nbsp; [3]CLOG &nbsp; &nbsp; &nbsp;: 1 record, 4 bytes (avg 4.0 bytes)</font></div><div><font size="2"   >&nbsp; [4]Database &nbsp;: 0 record, 0 byte (avg 0.0 byte)</font></div><div><font size="2"   >&nbsp; [5]Tablespace: 0 record, 0 byte (avg 0.0 byte)</font></div><div><font size="2"   >&nbsp; [6]MultiXact : 0 record, 0 byte (avg 0.0 byte)</font></div><div><font size="2"   >&nbsp; [7]RelMap &nbsp; &nbsp;: 0 record, 0 byte (avg 0.0 byte)</font></div><div><font size="2"   >&nbsp; [8]Standby &nbsp; : 298 records, 5932 bytes (avg 19.9 bytes)</font></div><div><font size="2"   >&nbsp; [9]Heap2 &nbsp; &nbsp; : 1 record, 100 bytes (avg 100.0 bytes)</font></div><div><font size="2"   >&nbsp; [10]Heap &nbsp; &nbsp; &nbsp;: 45862 records, 2915975 bytes (avg 63.6 bytes)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ins: 45787, upd/hot_upd: 0/1, del: 74</font></div><div><font size="2"   >&nbsp; [11]Btree &nbsp; &nbsp; : 45927 records, 1647280 bytes (avg 35.9 bytes)</font></div><div><font size="2"   >&nbsp; [12]Hash &nbsp; &nbsp; &nbsp;: 0 record, 0 byte (avg 0.0 byte)</font></div><div><font size="2"   >&nbsp; [13]Gin &nbsp; &nbsp; &nbsp; : 0 record, 0 byte (avg 0.0 byte)</font></div><div><font size="2"   >&nbsp; [14]Gist &nbsp; &nbsp; &nbsp;: 0 record, 0 byte (avg 0.0 byte)</font></div><div><font size="2"   >&nbsp; [15]Sequence &nbsp;: 1386 records, 218988 bytes (avg 158.0 bytes)</font></div><div><font size="2"   >&nbsp; [16]SPGist &nbsp; &nbsp;: 0 record, 0 byte (avg 0.0 byte)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Backup block stats: 421 blocks, 410580 bytes (avg 975.2 bytes)</font></div><p></p></pre></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="https://github.com/snaga/xlogdump"   >https://github.com/snaga/xlogdump</a></div><div>2.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/wal-internals.html"   >http://www.postgresql.org/docs/9.2/static/wal-internals.html</a></div><div>3.&nbsp;<span style="line-height: 22px;"   >PostgreSQL 9.3 XLOG dump contrib introduce</span></div><div style="line-height: 22px;"   ><a style="line-height: 22px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201312311244246/"   >http://blog.163.com/digoal@126/blog/static/163877040201312311244246/</a></div><div><br></div><wbr></div>
	</div>
</div>
</body>
</html>