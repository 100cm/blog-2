<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.3 JSON type improve</h2>
	<h5 id="">2013-05-10 15:05:22&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201341003544706/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><pre class="prettyprint"   ><p></p><div><font size="2"   >E.1.3.5.1. JSON</font></div><div><font size="2"   >Add operators and functions to extract values from JSON data strings (Andrew Dunstan)</font></div><div><font size="2"   >Allow JSON data strings to be converted into records (Andrew Dunstan)</font></div><div><font size="2"   >Add functions to convert values, records, and hstore data to JSON (Andrew Dunstan)</font></div><p></p></pre></div><div>[测试]</div><div>JSON 操作符 :&nbsp;</div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; background-color: rgb(224, 236, 239); border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"   ><colgroup><col><col><col><col><thead><tr><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Operator</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Right Operand Type</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Description</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Example</th></tr></thead><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><tt>-&gt;</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >int</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >Get JSON array element</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><tt>'[1,2,3]'::json-&gt;2</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>-&gt;</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >text</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Get JSON object field</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>'{"a":1,"b":2}'::json-&gt;'b'</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>-&gt;&gt;</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >int</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Get JSON array element as text</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>'[1,2,3]'::json-&gt;&gt;2</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>-&gt;&gt;</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >text</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Get JSON object field as text</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>'{"a":1,"b":2}'::json-&gt;&gt;'b'</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>#&gt;</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >array of text</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Get JSON object at specified path</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>'{"a":[1,2,3],"b":[4,5,6]}'::json#&gt;'{a,2}'</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>#&gt;&gt;</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >array of text</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Get JSON object at specified path as text</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>'{"a":[1,2,3],"b":[4,5,6]}'::json#&gt;&gt;'{a,2}'</tt></td></tr></table></div><div><div>验证 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 19px;"   >digoal=# select oprname,oprcode,oprleft::regtype,oprright::regtype,oprresult::regtype from pg_operator where oprleft='json'::regtype or oprright='json'::regtype;<br> oprname |          oprcode          | oprleft | oprright | oprresult <br>---------+---------------------------+---------+----------+-----------<br> -&gt;      | json_object_field         | json    | text     | json  -- 从json中取json对象, 返回json<br> -&gt;&gt;     | json_object_field_text    | json    | text     | text  -- 从json中取json对象, 返回text<br> -&gt;      | json_array_element        | json    | integer  | json  -- 从json array中取元素, 返回json<br> -&gt;&gt;     | json_array_element_text   | json    | integer  | text  -- 从json array中取元素, 返回text<br> #&gt;      | json_extract_path_op      | json    | text[]   | json  -- 从json中根据指定路径取元素, 返回json<br> #&gt;&gt;     | json_extract_path_text_op | json    | text[]   | text  -- 从json中根据指定路径取元素, 返回text<br>(6 rows)</span></font></div><p></p></pre></div></div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 19px;"   >digoal=# select '{"a":1,"b":2,"c":3}'::json-&gt;'a';<br> ?column? <br>----------<br> 1<br>(1 row)<br>digoal=# select '{"a":1,"b":2,"c":3}'::json-&gt;&gt;'a';<br> ?column? <br>----------<br> 1<br>(1 row)<br>digoal=# select '[[1,2],[3]]'::json-&gt;0;<br> ?column? <br>----------<br> [1,2]<br>(1 row)<br>digoal=# select '[[1,2],[3]]'::json-&gt;&gt;1;<br> ?column? <br>----------<br> [3]<br>(1 row)<br>digoal=# select '[[1,2],[3]]'::json#&gt;'{0,0}';<br> ?column? <br>----------<br> 1<br>(1 row)<br><br>digoal=# select '[[1,2],[3]]'::json#&gt;'{0,1}';<br> ?column? <br>----------<br> 2<br>(1 row)<br><br>digoal=# select '[[1,2],[3]]'::json#&gt;'{1}';<br> ?column? <br>----------<br> [3]<br>(1 row)<br><br>digoal=# select '[[1,2],[3]]'::json#&gt;'{1,0}';<br> ?column? <br>----------<br> 3<br>(1 row)<br><br>digoal=# select '[[1,2],[3]]'::json#&gt;'{1,0,0}';<br> ?column? <br>----------<br> <br>(1 row)</span></font></div><p></p></pre></div><div>json函数 :&nbsp;</div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; background-color: rgb(224, 236, 239); border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"   ><colgroup><col><col><col><col><col><thead><tr><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Function</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Return Type</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Description</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Example</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Example Result</th></tr></thead><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>array_to_json(anyarray [, pretty_bool])</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >json</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Returns the array as JSON. A PostgreSQL multidimensional array becomes a JSON array of arrays. Line feeds will be added between dimension 1 elements if<tt>pretty_bool</tt>&nbsp;is true.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>array_to_json('{{1,5},{99,100}}'::int[])</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>[[1,5],[99,100]]</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>row_to_json(record [, pretty_bool])</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >json</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Returns the row as JSON. Line feeds will be added between level 1 elements if<tt>pretty_bool</tt>&nbsp;is true.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>row_to_json(row(1,'foo'))</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>{"f1":1,"f2":"foo"}</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>to_json(anyelement)</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >json</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Returns the value as JSON. If the data type is not builtin, and there is a cast from the type to json, the cast function will be used to perform the conversion. Otherwise, for any value other than a number, a boolean or NULL, the text representation will be used, escaped and quoted so that it is legal JSON.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>to_json('Fred said "Hi."'::text)</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>"Fred said \"Hi.\""</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_array_length(json)</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >int</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Returns the number of elements in the outermost json array.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_array_length('[1,2,3,{"f1":1,"f2":[5,6]},4]')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>5</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_each(json)</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >SETOF key text, value json</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Expands the outermost json object into a set of key/value pairs.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>select * from json_each('{"a":"foo", "b":"bar"}')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><pre style="font-size: 1em; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 1px solid rgb(207, 207, 207); padding: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow: auto; border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; background-color: rgb(247, 247, 247);"   > key | value
-----+-------
 a   | "foo"
 b   | "bar"
 
</pre></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_each_text(from_json json)</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >SETOF key text, value text</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Expands the outermost json object into a set of key/value pairs. The returned value will be of type text.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>select * from json_each_text('{"a":"foo", "b":"bar"}')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><pre style="font-size: 1em; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 1px solid rgb(207, 207, 207); padding: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow: auto; border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; background-color: rgb(247, 247, 247);"   > key | value
-----+-------
 a   | foo
 b   | bar
 
</pre></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_extract_path(from_json json, VARIADIC path_elems text[])</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >json</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Returns json object pointed to by&nbsp;<tt>path_elems</tt>.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_extract_path('{"f2":{"f3":1},"f4":{"f5":99,"f6":"foo"}}','f4')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>{"f5":99,"f6":"foo"}</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_extract_path_text(from_json json, VARIADIC path_elems text[])</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >text</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Returns json object pointed to by&nbsp;<tt>path_elems</tt>.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_extract_path_text('{"f2":{"f3":1},"f4":{"f5":99,"f6":"foo"}}','f4', 'f6')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>foo</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_object_keys(json)</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >SETOF text</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Returns set of keys in the json object. Only the "outer" object will be displayed.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_object_keys('{"f1":"abc","f2":{"f3":"a", "f4":"b"}}')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><pre style="font-size: 1em; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 1px solid rgb(207, 207, 207); padding: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow: auto; border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; background-color: rgb(247, 247, 247);"   > json_object_keys
------------------
 f1
 f2
</pre></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_populate_record(base anyelement, from_json json, [, use_json_as_text bool=false]</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >anyelement</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Expands the object in from_json to a row whose columns match the record type defined by base. Conversion will be best effort; columns in base with no corresponding key in from_json will be left null. A column may only be specified once.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>select * from json_populate_record(null::x, '{"a":1,"b":2}')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><pre style="font-size: 1em; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 1px solid rgb(207, 207, 207); padding: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow: auto; border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; background-color: rgb(247, 247, 247);"   > a | b
---+---
 1 | 2
</pre></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_populate_recordset(base anyelement, from_json json, [, use_json_as_text bool=false]</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >SETOF anyelement</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Expands the outermost set of objects in from_json to a set whose columns match the record type defined by base. Conversion will be best effort; columns in base with no corresponding key in from_json will be left null. A column may only be specified once.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>select * from json_populate_recordset(null::x, '[{"a":1,"b":2},{"a":3,"b":4}]')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><pre style="font-size: 1em; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 1px solid rgb(207, 207, 207); padding: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow: auto; border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; background-color: rgb(247, 247, 247);"   > a | b
---+---
 1 | 2
 3 | 4
 
</pre></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_array_elements(json)</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >SETOF json</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Expands a json array to a set of json elements.</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json_array_elements('[1,true, [2,false]]')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><pre style="font-size: 1em; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 1px solid rgb(207, 207, 207); padding: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow: auto; border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; background-color: rgb(247, 247, 247);"   >   value
-----------
 1
 true
 [2,false]
</pre></td></tr></table></div><div>测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 19px;"   >digoal=# select array_to_json('{{1,5},{99,100}}'::int[]);<br>  array_to_json   <br>------------------<br> [[1,5],[99,100]]<br>(1 row)<br>digoal=# select row_to_json(row(1,'foo'));<br>     row_to_json     <br>---------------------<br> {"f1":1,"f2":"foo"}<br>(1 row)<br><br>digoal=# select to_json('Fred said "Hi."'::text);<br>       to_json       <br>---------------------<br> "Fred said \"Hi.\""<br>(1 row)<br>digoal=# select json_array_length('[1,2,3,{"f1":1,"f2":[5,6]},4]');<br> json_array_length <br>-------------------<br>                 5<br>(1 row)<br>digoal=# select * from json_each('{"a":"foo", "b":"bar"}');<br> key | value <br>-----+-------<br> a   | "foo"<br> b   | "bar"<br>(2 rows)<br>digoal=# select * from json_each_text('{"a":"foo", "b":"bar"}');<br> key | value <br>-----+-------<br> a   | foo<br> b   | bar<br>(2 rows)<br>digoal=# select json_extract_path('{"f2":{"f3":1},"f4":{"f5":99,"f6":"foo"}}','f4');<br>  json_extract_path   <br>----------------------<br> {"f5":99,"f6":"foo"}<br>(1 row)<br>digoal=# select json_extract_path_text('{"f2":{"f3":1},"f4":{"f5":99,"f6":"foo"}}','f4', 'f6');<br> json_extract_path_text <br>------------------------<br> foo<br>(1 row)<br>digoal=# select json_array_elements('[1,true, [2,false]]');<br> json_array_elements <br>---------------------<br> 1<br> true<br> [2,false]<br>(3 rows)<br>digoal=# create table test(c1 int,c2 int);<br>CREATE TABLE<br>digoal=# select * from json_populate_record(null::test, '{"c1":1,"b":2,"c2":3}');<br> c1 | c2 <br>----+----<br>  1 |  3<br>(1 row)<br>digoal=# select * from json_populate_record(null::test, '{"c1":1,"b":2, "c1":3}');<br> c1 | c2 <br>----+----<br>  3 |   <br>(1 row)<br>digoal=# select * from json_populate_recordset(null::test, '[{"c2":1,"c1":2},{"c1":3,"c2":4}]');<br> c1 | c2 <br>----+----<br>  2 |  1<br>  3 |  4<br>(2 rows)</span></font></div><p></p></pre></div><div>聚合 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select json_agg(i) from generate_series(1,10) i;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; json_agg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------------------------------</font></div><div><font size="2"   >&nbsp;[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# create table t(id int,info text,crt_time timestamp);<br>CREATE TABLE</font></div><div><font size="2"   >digoal=# insert into t select generate_series(1,10),md5(random()::text),clock_timestamp();<br>INSERT 0 10<br>digoal=# select json_agg(t) from t;<br>                                           json_agg                                            <br>-----------------------------------------------------------------------------------------------<br> [{"id":1,"info":"bad22715a0520d0fd5ffc64a3046cf05","crt_time":"2013-05-10 15:02:55.664282"}, +<br>  {"id":2,"info":"6763f180faa87b86a000c03651501bc7","crt_time":"2013-05-10 15:02:55.664368"}, +<br>  {"id":3,"info":"ed5007fde04fd057e40f8bd4441df77a","crt_time":"2013-05-10 15:02:55.664375"}, +<br>  {"id":4,"info":"af95492cf049f3a77554dc5915263481","crt_time":"2013-05-10 15:02:55.664379"}, +<br>  {"id":5,"info":"b36b1226ded0e742624adace84b6ca43","crt_time":"2013-05-10 15:02:55.664384"}, +<br>  {"id":6,"info":"311907aeef14ca1cef4119d1af167106","crt_time":"2013-05-10 15:02:55.664388"}, +<br>  {"id":7,"info":"e718e389fee41b6964d20eba8616c8af","crt_time":"2013-05-10 15:02:55.664398"}, +<br>  {"id":8,"info":"fc2eaf4b8572671cd1f0374286f547d2","crt_time":"2013-05-10 15:02:55.664402"}, +<br>  {"id":9,"info":"23ed8cd9615cf31fffe9e5d429f11447","crt_time":"2013-05-10 15:02:55.66441"},  +<br>  {"id":10,"info":"04bdd6c8279750fdf00d1da2de4f6fb8","crt_time":"2013-05-10 15:02:55.664414"}]<br>(1 row)</font></div><p></p></pre></div><div>HSTORE :&nbsp;</div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; background-color: rgb(224, 236, 239); border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"   ><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><code>hstore_to_json(hstore)</code></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><tt>json</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >get&nbsp;<tt>hstore</tt>&nbsp;as a json value</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><tt>hstore_to_json('"a key"=&gt;1, b=&gt;t, c=&gt;null, d=&gt;12345, e=&gt;012345, f=&gt;1.234, g=&gt;2.345e+4')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><tt>{"a key": "1", "b": "t", "c": null, "d": "12345", "e": "012345", "f": "1.234", "g": "2.345e+4"}</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><code>hstore_to_json_loose(hstore)</code></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>json</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >get&nbsp;<tt>hstore</tt>&nbsp;as a json value, but attempting to distinguish numerical and boolean values so they are unquoted in the json</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>hstore_to_json_loose('"a key"=&gt;1, b=&gt;t, c=&gt;null, d=&gt;12345, e=&gt;012345, f=&gt;1.234, g=&gt;2.345e+4')</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>{"a key": 1, "b": true, "c": null, "d": 12345, "e": "012345", "f": 1.234, "g": 2.345e+4}</tt></td></tr></table></div><div>测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# create extension hstore;</font></div><div><font size="2"   >CREATE EXTENSION</font></div></div><div><div><font size="2"   >digoal=# select hstore_to_json('"a key"=&gt;1, b=&gt;t, c=&gt;null, d=&gt;12345, e=&gt;012345, f=&gt;1.234, g=&gt;2.345e+4');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hstore_to_json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >-------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;{"b": "t", "c": null, "d": "12345", "e": "012345", "f": "1.234", "g": "2.345e+4", "a key": "1"}</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select hstore_to_json_loose('"a key"=&gt;1, b=&gt;t, c=&gt;null, d=&gt;12345, e=&gt;012345, f=&gt;1.234, g=&gt;2.345e+4');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hstore_to_json_loose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;{"b": true, "c": null, "d": 12345, "e": "012345", "f": 1.234, "g": 2.345e+4, "a key": 1}</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;PostgreSQL 9.3 JSON function enhanced</div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201321333759270/"   >http://blog.163.com/digoal@126/blog/static/163877040201321333759270/</a></div><div>2.&nbsp;mongoDB javascript TO PostgreSQL DO language</div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201293082737559/"   >http://blog.163.com/digoal@126/blog/static/163877040201293082737559/</a></div><div>3.&nbsp;PostgreSQL json_accessors</div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402012112832614918/"   >http://blog.163.com/digoal@126/blog/static/1638770402012112832614918/</a></div><div>4.&nbsp;PostgreSQL JSON json_in and json_validate_cstring performance test</div><div><a href="http://blog.163.com/digoal@126/blog/static/16387704020130165241651/"   >http://blog.163.com/digoal@126/blog/static/16387704020130165241651/</a></div><div>5.&nbsp;Loading Useful Modules in PostgreSQL PLV8 lang</div><div><a href="http://blog.163.com/digoal@126/blog/static/16387704020132143340793/"   >http://blog.163.com/digoal@126/blog/static/16387704020132143340793/</a></div><div>6.&nbsp;PostgreSQL pl/v8 language (use google v8 javascript engine)</div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402013045395446/"   >http://blog.163.com/digoal@126/blog/static/1638770402013045395446/</a></div><div>7.&nbsp;pg-json extension</div><div><a href="http://blog.163.com/digoal@126/blog/static/16387704020120182349667/"   >http://blog.163.com/digoal@126/blog/static/16387704020120182349667/</a></div><div>8.&nbsp;migrate Data From PostgreSQL to mongoDB using PG's copy AND mongoimport</div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402011076252545/"   >http://blog.163.com/digoal@126/blog/static/1638770402011076252545/</a></div><div>9.&nbsp;PostgreSQL 9.2devel add JSON type and some functions</div><div><a href="http://blog.163.com/digoal@126/blog/static/16387704020121150212379/"   >http://blog.163.com/digoal@126/blog/static/16387704020121150212379/</a></div><div>10.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html"   >http://www.postgresql.org/docs/devel/static/functions-json.html</a></div><div>11.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/hstore.html"   >http://www.postgresql.org/docs/devel/static/hstore.html</a></div><div>12.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-aggregate.html"   >http://www.postgresql.org/docs/devel/static/functions-aggregate.html</a></div></div>
	</div>
</div>
</body>
</html>