<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PivotalR between R & PostgreSQL-like Databases(for exp : Greenplum, hadoop access by hawq)</h2>
	<h5 id="">2015-04-14 11:16:12&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402015314104923545/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PivotalR是R的一个包, 这个包提供了将R翻译成SQL语句的能力, 即对大数据进行挖掘的话. 用户将大数据存储在数据库中, 例如PostgreSQL , Greenplum.&nbsp;</div><div>用户在R中使用R的语法即可, 不需要直接访问数据库, 因为PivotalR 会帮你翻译成SQL语句, 并且返回结果给R.</div><div>这个过程不需要传输原始数据到R端, 所以可以完成R不能完成的任务(因为R是数据在内存中的运算, 如果数据量超过内存会有问题)</div><div>PivotalR还封装了MADlib, 里面包含了大量的机器学习的函数, 回归分析的函数等.</div><div><br></div><div><br></div><div>这个包的说明 :&nbsp;</div><div><div>PivotalR-package&nbsp;</div><div>An R font-end to PostgreSQL and Greenplum database, and wrapper</div><div>for in-database parallel and distributed machine learning open-source</div><div>library MADlib</div><div><br></div><div>Description</div><div>PivotalR is a package that enables users of R, the most popular open source statistical programming</div><div>language and environment to interact with the Pivotal (Greenplum) Database as well as Pivotal</div><div>HD/HAWQ for Big Data analytics. It does so by providing an interface to the operations on tables/views</div><div>in the database. These operations are almost the same as those of data.frame. Thus the</div><div>users of R do not need to learn SQL when they operate on the objects in the database. The latest</div><div>code is available at https://github.com/madlib-internal/PivotalR. A training video and a</div><div>quick-start guide are available at http://zimmeee.github.io/gp-r/#pivotalr.</div><div><br></div><div>Details</div><div>Package: PivotalR</div><div>Type: Package</div><div>Version: 0.1.17</div><div>Date: 2014-09-15</div><div>License: GPL (&gt;= 2)</div><div>Depends: methods, DBI, RPostgreSQL</div><div><br></div><div>This package enables R users to easily develop, refine and deploy R scripts that leverage the parallelism</div><div>and scalability of the database as well as in-database analytics libraries to operate on big</div><div>data sets that would otherwise not fit in R memory - all this without having to learn SQL because</div><div>the package provides an interface that they are familiar with.</div><div><br></div><div>The package also provides a wrapper for MADlib. MADlib is an open-source library for scalable</div><div>in-database analytics. It provides data-parallel implementations of mathematical, statistical and</div><div>machine-learning algorithms for structured and unstructured data. The number of machine learning</div><div>algorithms that MADlib covers is quickly increasing.</div><div><br></div><div>As an R front-end to the PostgreSQL-like databases, this package minimizes the amount of data</div><div>transferred between the database and R. All the big data is stored in the database. The user enters</div><div>their familiar R syntax, and the package translates it into SQL queries and sends the SQL query into</div><div>database for parallel execution. The computation result, which is small (if it is as big as the original</div><div>data, what is the point of big data analytics?), is returned to R to the user.</div><div><br></div><div>On the other hand, this package also gives the usual SQL users the access of utilizing the powerful</div><div>analytics and graphics functionalities of R. Although the database itself has difficulty in plotting,</div><div>the result can be analyzed and presented beautifully with R.</div><div><br></div><div>This current version of PivotalR provides the core R infrastructure and data frame functions as well</div><div>as over 50 analytical functions in R that leverage in-database execution. These include</div><div><br></div><div>* Data Connectivity - db.connect, db.disconnect, db.Rquery</div><div>* Data Exploration - db.data.frame, subsets</div><div>* R language features - dim, names, min, max, nrow, ncol, summary etc</div><div>* Reorganization Functions - merge, by (group-by), samples</div><div>* Transformations - as.factor, null replacement</div><div>* Algorithms - linear regression and logistic regression wrappers for MADlib</div><div><br></div><div>Note</div><div>This package is differernt from PL/R, which is another way of using R with PostgreSQL-like</div><div>databases. PL/R enables the users to run R scripts from SQL. In the parallel Greenplum database,</div><div>one can use PL/R to implement parallel algorithms.</div><div><br></div><div>However, PL/R still requires non-trivial knowledge of SQL to use it effectively. It is mostly limited</div><div>to explicitly parallel jobs. And for the end user, it is still a SQL interface.</div><div><br></div><div>This package does not require any knowledge of SQL, and it works for both explicitly and implicitly</div><div>parallel jobs by employing the open-source MADlib library. It is much more scalable. And for the</div><div>end user, it is a pure R interface with the conventional R syntax.</div><div><br></div><div>Author(s)</div><div>Author: Predictive Analytics Team at Pivotal Inc. &lt;user@madlib.net&gt;, with contributions from</div><div>Data Scientist Team at Pivotal Inc.</div><div>Maintainer: Caleb Welton, Pivotal Inc. &lt;cwelton@pivotal.io&gt;</div><div><br></div><div>References</div><div>[1] MADlib website, http://madlib.net</div><div>[2] MADlib user docs, http://doc.madlib.net/master</div><div>[3] MADlib Wiki page, http://github.com/madlib/madlib/wiki</div><div>[4] MADlib contribution guide, https://github.com/madlib/madlib/wiki/Contribution-Guide</div><div>[5] MADlib on GitHub, https://github.com/madlib/madlib</div><div><br></div><div>See Also</div><div>madlib.lm Linear regression</div><div>madlib.glm Linear, logistic and multinomial logistic regressions</div><div>madlib.summary summary of a table in the database.</div></div><div><br></div><div><div>Examples</div><div>## Not run:</div><div>## get the help for the package</div><div>help("PivotalR-package")</div><div>## get help for a function</div><div>help(madlib.lm)</div><div>## create multiple connections to different databases</div><div>db.connect(port = 5433) # connection 1, use default values for the parameters</div><div>db.connect(dbname = "test", user = "qianh1", password = "", host =</div><div>"remote.machine.com", madlib = "madlib07", port = 5432) # connection 2</div><div>db.list() # list the info for all the connections</div><div>## list all tables/views that has "ornst" in the name</div><div>db.objects("ornst")</div><div>## list all tables/views</div><div>db.objects(conn.id = 1)</div><div>## create a table and the R object pointing to the table</div><div>## using the example data that comes with this package</div><div>delete("abalone", conn.id = cid)</div><div>x &lt;- as.db.data.frame(abalone, "abalone")</div><div>## OR if the table already exists, you can create the wrapper directly</div><div>## x &lt;- db.data.frame("abalone")</div><div>dim(x) # dimension of the data table</div><div>names(x) # column names of the data table</div><div>madlib.summary(x) # look at a summary for each column</div><div>lk(x, 20) # look at a sample of the data</div><div>## look at a sample sorted by id column</div><div>lookat(sort(x, decreasing = FALSE, x$id), 20)</div><div>lookat(sort(x, FALSE, NULL), 20) # look at a sample ordered randomly</div><div>## linear regression Examples --------</div><div>## fit one different model to each group of data with the same sex</div><div>fit1 &lt;- madlib.lm(rings ~ . - id | sex, data = x)</div><div>fit1 # view the result</div><div>lookat(mean((x$rings - predict(fit1, x))^2)) # mean square error</div><div>## plot the predicted values v.s. the true values</div><div>ap &lt;- x$rings # true values</div><div>ap$pred &lt;- predict(fit1, x) # add a column which is the predicted values</div><div>## If the data set is very big, you do not want to load all the</div><div>## data points into R and plot. We can just plot a random sample.</div><div>random.sample &lt;- lk(sort(ap, FALSE, "random"), 1000) # sort randomly</div><div>plot(random.sample) # plot a random sample</div><div>## fit a single model to all data treating sex as a categorical variable ---------</div><div>y &lt;- x # make a copy, y is now a db.data.frame object</div><div>y$sex &lt;- as.factor(y$sex) # y becomes a db.Rquery object now</div><div>fit2 &lt;- madlib.lm(rings ~ . - id, data = y)</div><div>fit2 # view the result</div><div>lookat(mean((y$rings - predict(fit2, y))^2)) # mean square error</div><div>## logistic regression Examples --------</div><div>## fit one different model to each group of data with the same sex</div><div>fit3 &lt;- madlib.glm(rings &lt; 10 ~ . - id | sex, data = x, family = "binomial")</div><div>fit3 # view the result</div><div>## the percentage of correct prediction</div><div>lookat(mean((x$rings &lt; 10) == predict(fit3, x)))</div><div>## fit a single model to all data treating sex as a categorical variable ----------</div><div>y &lt;- x # make a copy, y is now a db.data.frame object</div><div>y$sex &lt;- as.factor(y$sex) # y becomes a db.Rquery object now</div><div>fit4 &lt;- madlib.glm(rings &lt; 10 ~ . - id, data = y, family = "binomial")</div><div>fit4 # view the result</div><div>## the percentage of correct prediction</div><div>lookat(mean((y$rings &lt; 10) == predict(fit4, y)))</div><div>## Group by Examples --------</div><div>## mean value of each column except the "id" column</div><div>lk(by(x[,-1], x$sex, mean))</div><div>## standard deviation of each column except the "id" column</div><div>lookat(by(x[,-1], x$sex, sd))</div><div>## Merge Examples --------</div><div>## create two objects with different rows and columns</div><div>key(x) &lt;- "id"</div><div>y &lt;- x[1:300, 1:6]</div><div>z &lt;- x[201:400, c(1,2,4,5)]</div><div>## get 100 rows</div><div>m &lt;- merge(y, z, by = c("id", "sex"))</div><div>lookat(m, 20)</div><div>## operator Examples --------</div><div>y &lt;- x$length + x$height + 2.3</div><div>z &lt;- x$length * x$height / 3</div><div>lk(y &lt; z, 20)</div><div>## ------------------------------------------------------------------------</div><div>## Deal with NULL values</div><div>delete("null_data")</div><div>x &lt;- as.db.data.frame(null.data, "null_data")</div><div>## OR if the table already exists, you can create the wrapper directly</div><div>## x &lt;- db.data.frame("null_data")</div><div>dim(x)</div><div>names(x)</div><div>## ERROR, because of NULL values</div><div>fit &lt;- madlib.lm(sf_mrtg_pct_assets ~ ., data = x)</div><div>## remove NULL values</div><div>y &lt;- x # make a copy</div><div>for (i in 1:10) y &lt;- y[!is.na(y[i]),]</div><div>dim(y)</div><div>fit &lt;- madlib.lm(sf_mrtg_pct_assets ~ ., data = y)</div><div>fit</div><div>## Or we can replace all NULL values</div><div>x[is.na(x)] &lt;- 45</div><div>## End(Not run)</div></div><div><br></div><div>安装,使用 :&nbsp;</div><div>&gt; install.packages("PivotalR")</div><div><div>&gt; library(PivotalR)</div><div>Loading required package: Matrix</div><div>Attaching package: ‘PivotalR’</div><div>The following objects are masked from ‘package:stats’:</div><div>&nbsp; &nbsp; sd, var</div><div>The following object is masked from ‘package:base’:</div><div>&nbsp; &nbsp; cbind</div></div><div><br></div><div><span style="line-height: 28px;"   >[参考]</span></div><wbr><div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://blog.pivotal.io/data-science-pivotal/products/introducing-r-for-big-data-with-pivotalr"   >http://blog.pivotal.io/data-science-pivotal/products/introducing-r-for-big-data-with-pivotalr</a></div><div>2.&nbsp;<a target="_blank" rel="nofollow" href="http://cran.r-project.org/web/packages/PivotalR/PivotalR.pdf"   >http://cran.r-project.org/web/packages/PivotalR/PivotalR.pdf</a></div><div>3.&nbsp;<a target="_blank" rel="nofollow" href="https://github.com/pivotalsoftware/PivotalR"   >https://github.com/pivotalsoftware/PivotalR</a></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PivotalR between R  PostgreSQL-like Databases(for exp : Greenplum, hadoop access by hawq) - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>