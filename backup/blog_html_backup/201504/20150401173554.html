<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">install kvm hosts use kickstart in CentOS 6 in text mode</h2>
	<h5 id="">2015-04-01 17:35:54&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402015315195563/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >和前面一篇文章类似,&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020153142253971/"   >http://blog.163.com/digoal@126/blog/static/16387704020153142253971/</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >本文讲述使用kickstart文件安装kvm虚拟机, 因此不需要连接图形界面.</div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><br></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >在服务器安装必要的包, 不再需要图形相关的包.</div><div><pre class="prettyprint"   ><p style="color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   ></p><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   ><span style="line-height: 22.75px;"   ># yum install -y qemu-img qemu-kvm virt-manager libvirt libvirt-python python-virtinst libvirt-client libvirt libvirt-client virt-what</span></font></div><p style="color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   ></p></pre></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >创建一个虚拟磁盘目录</div><pre class="prettyprint"   ><p></p><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ># mkdir /data03/kvmdisk</font></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ></div><p></p></pre><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><span style="line-height: 28px;"   >创建虚拟磁盘, 用于虚拟机的系统盘</span></div><pre class="prettyprint"   ><p></p><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ># qemu-img create -f qcow2 -o encryption=off,cluster_size=2M,preallocation=full /data03/kvmdisk/disk01.img 32G</font></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ></div><p></p></pre><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><span style="line-height: 28px;"   >下载安装镜像</span></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ># mkdir /data03/iso</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ># cd iso</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ># wget http://mirrors.aliyun.com/centos/6.6/isos/x86_64/CentOS-6.6-x86_64-bin-DVD1.iso</font></div><p></p></pre></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >启动libvirtd</div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ># service libvirtd start</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ># chkconfig libvirtd on</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ># chkconfig libvirt-guests off</font></div><p></p></pre></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >查看当前启动的网桥</div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><div style="line-height: 28px;"   ><font size="2"   ># brctl show</font></div><div style="line-height: 28px;"   ><font size="2"   >bridge name &nbsp; &nbsp; bridge id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STP enabled &nbsp; &nbsp; interfaces</font></div><div style="line-height: 28px;"   ><font size="2"   >virbr0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8000.5254001263b0 &nbsp; &nbsp; &nbsp; yes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; virbr0-nic</font></div></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ># ifconfig</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >em1 &nbsp; &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:22:19:60:77:8F &nbsp;</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:172.16.3.150 &nbsp;Bcast:172.16.3.255 &nbsp;Mask:255.255.255.0</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::222:19ff:fe60:778f/64 Scope:Link</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:5469716 errors:0 dropped:0 overruns:0 frame:0</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:2830916 errors:0 dropped:0 overruns:0 carrier:0</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000&nbsp;</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:5147311077 (4.7 GiB) &nbsp;TX bytes:198552462 (189.3 MiB)</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >lo &nbsp; &nbsp; &nbsp; &nbsp;Link encap:Local Loopback &nbsp;</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1 &nbsp;Mask:255.0.0.0</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: ::1/128 Scope:Host</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING &nbsp;MTU:65536 &nbsp;Metric:1</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:79073 errors:0 dropped:0 overruns:0 frame:0</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:79073 errors:0 dropped:0 overruns:0 carrier:0</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:24506711 (23.3 MiB) &nbsp;TX bytes:24506711 (23.3 MiB)</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >virbr0 &nbsp; &nbsp;Link encap:Ethernet &nbsp;HWaddr 52:54:00:12:63:B0 &nbsp;</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.122.1 &nbsp;Bcast:192.168.122.255 &nbsp;Mask:255.255.255.0</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</font></div><p></p></pre></div></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >网桥地址配置</div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   ># grep -r 192.168.122 /etc/libvirt</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >/etc/libvirt/qemu/networks/default.xml: &nbsp;&lt;ip address="192.168.122.1" netmask="255.255.255.0"&gt;</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >/etc/libvirt/qemu/networks/default.xml: &nbsp; &nbsp; &nbsp;&lt;range start="192.168.122.2" end="192.168.122.254" /&gt;</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >/etc/libvirt/qemu/networks/autostart/default.xml: &nbsp;&lt;ip address="192.168.122.1" netmask="255.255.255.0"&gt;</font></div><div style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >/etc/libvirt/qemu/networks/autostart/default.xml: &nbsp; &nbsp; &nbsp;&lt;range start="192.168.122.2" end="192.168.122.254" /&gt;</font></div><p></p></pre></div></div><div><br></div><div>生成密码加密字符串, 即虚拟机的root用户密码 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># grub-crypt --sha-512</font></div><div><font size="2"   >Password:&nbsp;</font></div><div><font size="2"   >Retype password:&nbsp;</font></div><div><font size="2"   >$6$3V1UXXvrJ1qqWgAO$KaT7KOjWwsVERUZOVE5DB97Og1YIqCQeL54BtHZPasPSYHOnDzUDSS60AJ.3wLUCwVWmIS/HhVnhvo6Y4PWjM1</font></div><p></p></pre></div><div><br></div><div>选择合适的IP地址 , 例如<span style="line-height: 28px;"   >192.168.122.199. 对应的kickstart配置项</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >network --onboot yes --device eth0 --bootproto static --ip 192.168.122.199 --netmask 255.255.255.0 --gateway=192.168.122.1&nbsp;--nameserver=202.101.172.35,202.101.172.47 --hostname digoal.sky-mobi.com --noipv6</font></span></div><div></div><p></p></pre></div><div>创建kickstart配置文件</div><div># vi /root/ ks.cfg&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># install or upgrade?</font></div><div><font size="2"   >install</font></div><div><font size="2"   ># password</font></div><div><font size="2"   >rootpw &nbsp;--iscrypted $6$yz7YWSt2MmouUuTu$cjz1eZf9lhMke2Ply8P5Jngrwxh5lb8zwmC124JlXdOnSvrKZaD2/IWdVgahFfNIykbYCBnzCqbbVwjZH59YA.</font></div><div><font size="2"   >authconfig --enableshadow --passalgo=sha512</font></div><div><font size="2"   >firewall --service=ssh</font></div><div><font size="2"   >text</font></div><div><font size="2"   >firstboot --disable</font></div><div><font size="2"   >keyboard us</font></div><div><font size="2"   >lang en_US.UTF-8</font></div><div><font size="2"   >selinux --disabled</font></div><div><font size="2"   >timezone Aisa/Shanghai</font></div><div><font size="2"   ># 配置网络</font></div><div><font size="2"   >network --onboot yes --device eth0 --bootproto static --ip 192.168.122.199 --netmask 255.255.255.0 --gateway=192.168.122.1&nbsp;--nameserver=202.101.172.35,202.101.172.47 --hostname digoal.sky-mobi.com --noipv6</font></div><div><font size="2"   ># 指定引导分区</font></div><div><font size="2"   >zerombr</font></div><div><font size="2"   >bootloader --location=mbr --driveorder=vda</font></div><div><font size="2"   ># 清除硬盘分区</font></div><div><font size="2"   >clearpart --drives=vda --all --initlabel</font></div><div><font size="2"   >part / --fstype="ext4" --asprimary --size=29000</font></div><div><font size="2"   >part swap --size=2048</font></div><div><font size="2"   >reboot</font></div><div><font size="2"   >%packages</font></div><div><font size="2"   >@base</font></div><p></p></pre></div></div><div><br></div><div>开始安装, 使用text console.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># <span style="line-height: 21px;"   >virt-install \</span></font></div><font size="2"   ><span style="line-height: 21px;"   >   --name=centos6_6_x64 \<br>   --disk path=/data03/kvmdisk/disk01.img,device=disk,bus=virtio,perms=rw,cache=writethrough \<br>   --graphics none \<br>   --vcpus=4 --ram=4096 \<br>   --location=/data03/iso/CentOS-6.6-x86_64-bin-DVD1.iso \<br>   --network bridge=virbr0 \<br>   --os-type=linux \<br>   --os-variant=rhel6 \<br>   --initrd-inject=/root/ks.cfg \<br>   --extra-args="ks=file:/ks.cfg console=tty0 console=ttyS0,115200n8"</span></font><p></p></pre></div><div><br></div><div>等待安装完, 这个虚拟机会自动关闭, 需要人工启动这个虚拟机</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># virsh list --all</font></div><div><font size="2"   >&nbsp;Id &nbsp; &nbsp;Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; State</font></div><div><font size="2"   >----------------------------------------------------</font></div><div><font size="2"   >&nbsp;- &nbsp; &nbsp; centos6_6_x64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;shut off</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   ># virsh start centos6_6_x64</font></div><p></p></pre></div><div>开机自动启动配置 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi /etc/rc.local</font></div><div><font size="2"   >/usr/bin/virsh start centos6_6_x64</font></div><p></p></pre></div><div><br></div><div>[其他]</div><div>1. 如果不想使用kickstart, 并且要使用text安装的话, 只需要略微变动virt-install的参数, 如下 :&nbsp;</div><div>这样就完美了, 在没有图形环境时, 可以放心使用了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >virt-install \<br>   --name=centos6_6_x64 \<br>   --disk path=/data03/kvmdisk/disk01.img,device=disk,bus=virtio,perms=rw,cache=writethrough \<br>   --graphics none \<br>   --vcpus=4 --ram=4096 \<br>   --location=/data03/iso/CentOS-6.6-x86_64-bin-DVD1.iso \<br>   --network bridge=virbr0 \<br>   --os-type=linux \<br>   --os-variant=rhel6 \<br>   --extra-args="console=tty0 console=ttyS0,115200n8"</span></font></div><p></p></pre></div><div>连接console的方法 :&nbsp;</div><div># virsh</div><div>&gt; console $domainID</div><div>&gt; 退出console 按下ctrl+]</div><div><br></div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-150 ~]# virsh</font></div><div><font size="2"   >Welcome to virsh, the virtualization interactive terminal.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Type: &nbsp;'help' for help with commands</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;'quit' to quit</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >virsh # lis</font></div><div><font size="2"   >error: unknown command: 'lis'</font></div><div><font size="2"   >virsh # list</font></div><div><font size="2"   >&nbsp;Id &nbsp; &nbsp;Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; State</font></div><div><font size="2"   >----------------------------------------------------</font></div><div><font size="2"   >&nbsp;2 &nbsp; &nbsp; centos6_6_x64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;running</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >virsh # console 1</font></div><div><font size="2"   >error: failed to get domain '1'</font></div><div><font size="2"   >error: Domain not found: no domain with matching name '1'</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >virsh # console 2</font></div><div><font size="2"   >Connected to domain centos6_6_x64</font></div><div><font size="2"   >Escape character is ^]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >CentOS release 6.6 (Final)</font></div><div><font size="2"   >Kernel 2.6.32-504.el6.x86_64 on an x86_64</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal.sky-mobi.com login: root</font></div><div><font size="2"   >Password:&nbsp;</font></div><div><font size="2"   >Last login: Thu Apr &nbsp;2 00:12:27 on ttyS0</font></div><div><font size="2"   >[root@digoal ~]#&nbsp;</font></div><div><font size="2"   >[root@digoal ~]#&nbsp;</font></div></div><div><div><font size="2"   >[root@digoal ~]# exit</font></div><div><font size="2"   >logout</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >CentOS release 6.6 (Final)</font></div><div><font size="2"   >Kernel 2.6.32-504.el6.x86_64 on an x86_64</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal.sky-mobi.com login: 这里按下ctrl+]返回本地控制台</font></div><div><font size="2"   >virsh #&nbsp;</font></div><div><font size="2"   >virsh #&nbsp;</font></div></div><p></p></pre></div><div><br></div><div><br></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="install kvm hosts use kickstart in CentOS 6 - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>