<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL MVCC - age introduce</h2>
	<h5 id="">2012-12-25 21:57:05&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201211259497702/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 靠xid以及tuple的事务状态标记(t_infomask)来判断TUPLE的可见性.</div><div>另外vacuum以及autovacuum也需要xid来判断是否将TUPLE修改为frozen的状态.</div><div>涉及到几个数据库参数可参见postgresql.conf</div><div>这里主要讲一下怎么计算tuple的age. (因为xid是32位的, 是循环使用的, 所以需要frozen机制)</div><div>计算age可以用到函数age(xid)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; \sf+ age(xid)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; CREATE OR REPLACE FUNCTION pg_catalog.age(xid)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RETURNS integer</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LANGUAGE internal</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STABLE STRICT</font></div><div><font size="2"   >1 &nbsp; &nbsp; &nbsp; AS $function$xid_age$function$;</font></div><p></p></pre></div><div>举例 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select ctid,cmin,cmax,xmin,xmax,age(xmin),* from test limit 1;</font></div><div><font size="2"   >&nbsp; &nbsp; ctid &nbsp; &nbsp;| cmin | cmax | &nbsp; &nbsp;xmin &nbsp; &nbsp;| xmax | age | id | info&nbsp;</font></div><div><font size="2"   >------------+------+------+------------+------+-----+----+------</font></div><div><font size="2"   >&nbsp;(13136,30) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 1155636848 | &nbsp; &nbsp;0 | &nbsp;20 | &nbsp;2 | test</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>获取两个事务后 :&nbsp;</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select txid_current();</font></div><div><font size="2"   >&nbsp;txid_current&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; &nbsp;1155636868</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; select txid_current();</font></div><div><font size="2"   >&nbsp;txid_current&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; &nbsp;1155636869</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>age增加2 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select ctid,cmin,cmax,xmin,xmax,age(xmin),* from test limit 1;</font></div><div><font size="2"   >&nbsp; &nbsp; ctid &nbsp; &nbsp;| cmin | cmax | &nbsp; &nbsp;xmin &nbsp; &nbsp;| xmax | age | id | info&nbsp;</font></div><div><font size="2"   >------------+------+------+------------+------+-----+----+------</font></div><div><font size="2"   >&nbsp;(13136,30) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 1155636848 | &nbsp; &nbsp;0 | &nbsp;22 | &nbsp;2 | test</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div></div><div>22这个值等于下一个xid-xmin, 解释见末尾的<span style="font-family: monospace; font-size: small; line-height: 19px; white-space: pre;"   >&nbsp;GetStableLatestTransactionId</span>&nbsp;:&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select (1155636869+1)-1155636848;</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;22</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>LatestTransactionId 也可以通过以下函数得到 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select txid_current_snapshot();</font></div><div><font size="2"   >&nbsp;txid_current_snapshot &nbsp;</font></div><div><font size="2"   >------------------------</font></div><div><font size="2"   >&nbsp;1155636870:1155636870:</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>注意txid_current()和txid_current_snapshot()得到的是txid, 64比特. xid是32比特的.&nbsp;</div><div>因为这个测试库的事务量目前还未超过20亿, xid还未rotate, 所以txid-xid的到age是可行的, 如果xid已经rotate了, 那么直接减就不对了.</div><div>参见 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402011830105342275/"   >http://blog.163.com/digoal@126/blog/static/1638770402011830105342275/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020118301222520/"   >http://blog.163.com/digoal@126/blog/static/16387704020118301222520/</a></div><div><br></div><div>txid_current()和txid_current_snapshot()对应的internal函数如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=&gt; \sf+ txid_current_snapshot</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; CREATE OR REPLACE FUNCTION pg_catalog.txid_current_snapshot()</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RETURNS txid_snapshot</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LANGUAGE internal</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STABLE STRICT</font></div><div><font size="2"   >1 &nbsp; &nbsp; &nbsp; AS $function$txid_current_snapshot$function$</font></div><div><font size="2"   >digoal=&gt; \sf+ txid_current</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; CREATE OR REPLACE FUNCTION pg_catalog.txid_current()</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RETURNS bigint</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LANGUAGE internal</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STABLE STRICT</font></div><div><font size="2"   >1 &nbsp; &nbsp; &nbsp; AS $function$txid_current$function$</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* Public functions.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* txid_current() and txid_current_snapshot() are the only ones that</font></div><div><font size="2"   >&nbsp;* communicate with core xid machinery. &nbsp;All the others work on data</font></div><div><font size="2"   >&nbsp;* returned by them.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* txid_current() returns int8</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;Return the current toplevel transaction ID as TXID</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;If the current transaction does not have one, one is assigned.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >Datum</font></div><div><font size="2"   >txid_current(PG_FUNCTION_ARGS)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; txid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;val;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TxidEpoch &nbsp; &nbsp; &nbsp; state;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* Must prevent during recovery because if an xid is not assigned we try</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* to assign one, which would fail. Programs already rely on this function</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* to always return a valid current xid, so we should not change this to</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* return NULL or similar invalid xid.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; PreventCommandDuringRecovery("txid_current()");</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; load_xid_epoch(&amp;state);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; val = convert_xid(GetTopTransactionId(), &amp;state);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_INT64(val);</font></div><div><font size="2"   >}</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* txid_current_snapshot() returns txid_snapshot</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Return current snapshot in TXID format</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Note that only top-transaction XIDs are included in the snapshot.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >Datum</font></div><div><font size="2"   >txid_current_snapshot(PG_FUNCTION_ARGS)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TxidSnapshot *snap;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; uint32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nxip,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TxidEpoch &nbsp; &nbsp; &nbsp; state;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Snapshot &nbsp; &nbsp; &nbsp; &nbsp;cur;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; cur = GetActiveSnapshot();</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (cur == NULL)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elog(ERROR, "no active snapshot set");</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; load_xid_epoch(&amp;state);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* allocate */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; nxip = cur-&gt;xcnt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; size = TXID_SNAPSHOT_SIZE(nxip);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; snap = palloc(size);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; SET_VARSIZE(snap, size);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* fill */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; snap-&gt;xmin = convert_xid(cur-&gt;xmin, &amp;state);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; snap-&gt;xmax = convert_xid(cur-&gt;xmax, &amp;state);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; snap-&gt;nxip = nxip;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; for (i = 0; i &lt; nxip; i++)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; snap-&gt;xip[i] = convert_xid(cur-&gt;xip[i], &amp;state);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* we want them guaranteed to be in ascending order */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; sort_snapshot(snap);</font></div></div><div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_POINTER(snap);</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div><div><br></div><div>vacuum freeze后, xmin变成了2, 这个2的含义可以参看<span style="line-height: 22px;"   >src/include/access/transam.h, 在本文末尾</span>&nbsp;:&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; vacuum FREEZE test;</font></div><div><font size="2"   >VACUUM</font></div><div><font size="2"   >digoal=&gt; select ctid,cmin,cmax,xmin,xmax,age(xmin),* from test limit 1;</font></div><div><font size="2"   >&nbsp; &nbsp; ctid &nbsp; &nbsp;| cmin | cmax | xmin | xmax | &nbsp; &nbsp;age &nbsp; &nbsp; | id | info&nbsp;</font></div><div><font size="2"   >------------+------+------+------+------+------------+----+------</font></div><div><font size="2"   >&nbsp;(13136,30) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | &nbsp; &nbsp;2 | &nbsp; &nbsp;0 | 2147483647 | &nbsp;2 | test</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>函数age(xid)的源码如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >src/backend/utils/adt/xid.c</font></div><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;xid_age &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - compute age of an XID (relative to latest stable xid)</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >Datum</font></div><div><font size="2"   >xid_age(PG_FUNCTION_ARGS)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TransactionId xid = PG_GETARG_TRANSACTIONID(0);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TransactionId now = GetStableLatestTransactionId();</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* Permanent XIDs are always infinitely old */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (!TransactionIdIsNormal(xid))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_INT32(INT_MAX);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_INT32((int32) (now - xid));</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >当前如果已分配xid则使用当前xid, 如果未分配则使用下一个xid.</font></div><div><font size="2"   >src/backend/access/transam/xact.c</font></div><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;GetStableLatestTransactionId</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Get the transaction's XID if it has one, else read the next-to-be-assigned</font></div><div><font size="2"   >&nbsp;* XID. &nbsp;Once we have a value, return that same value for the remainder of the</font></div><div><font size="2"   >&nbsp;* current transaction. &nbsp;This is meant to provide the reference point for the</font></div><div><font size="2"   >&nbsp;* age(xid) function, but might be useful for other maintenance tasks as well.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >TransactionId</font></div><div><font size="2"   >GetStableLatestTransactionId(void)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; static LocalTransactionId lxid = InvalidLocalTransactionId;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; static TransactionId stablexid = InvalidTransactionId;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (lxid != MyProc-&gt;lxid)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lxid = MyProc-&gt;lxid;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stablexid = GetTopTransactionIdIfAny();</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!TransactionIdIsValid(stablexid))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stablexid = ReadNewTransactionId();</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Assert(TransactionIdIsValid(stablexid));</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return stablexid;</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div><div><br></div><div>【参考】</div><div>1.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201183043153622/"   >http://blog.163.com/digoal@126/blog/static/163877040201183043153622/</a></div><div>2.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402011830105342275/"   >http://blog.163.com/digoal@126/blog/static/1638770402011830105342275/</a></div><div>3.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020118301222520/"   >http://blog.163.com/digoal@126/blog/static/16387704020118301222520/</a></div><div>4.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/runtime-config-autovacuum.html"   >http://www.postgresql.org/docs/9.2/static/runtime-config-autovacuum.html</a></div><div>5.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/routine-vacuuming.html#VACUUM-FOR-WRAPAROUND"   >http://www.postgresql.org/docs/9.2/static/routine-vacuuming.html#VACUUM-FOR-WRAPAROUND</a></div><div>6.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201210134586363/"   >http://blog.163.com/digoal@126/blog/static/163877040201210134586363/</a></div><div>7.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201041111516154/"   >http://blog.163.com/digoal@126/blog/static/163877040201041111516154/</a></div><div><span style="line-height: 22px;"   >8. src/include/access/transam.h</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >00020 /* ----------------</font></div><div><font size="2"   >00021 &nbsp;* &nbsp; &nbsp; &nbsp;Special transaction ID values</font></div><div><font size="2"   >00022 &nbsp;*</font></div><div><font size="2"   >00023 &nbsp;* BootstrapTransactionId is the XID for "bootstrap" operations, and</font></div><div><font size="2"   >00024 &nbsp;* FrozenTransactionId is used for very old tuples. &nbsp;Both should</font></div><div><font size="2"   >00025 &nbsp;* always be considered valid.</font></div><div><font size="2"   >00026 &nbsp;*</font></div><div><font size="2"   >00027 &nbsp;* FirstNormalTransactionId is the first "normal" transaction id.</font></div><div><font size="2"   >00028 &nbsp;* Note: if you need to change it, you must change pg_class.h as well.</font></div><div><font size="2"   >00029 &nbsp;* ----------------</font></div><div><font size="2"   >00030 &nbsp;*/</font></div><div><font size="2"   >00031 #define InvalidTransactionId &nbsp; &nbsp; &nbsp; &nbsp;((TransactionId) 0)</font></div><div><font size="2"   >00032 #define BootstrapTransactionId &nbsp; &nbsp; &nbsp;((TransactionId) 1)</font></div><div><font size="2"   >00033 #define FrozenTransactionId &nbsp; &nbsp; &nbsp; &nbsp; ((TransactionId) 2)</font></div><div><font size="2"   >00034 #define FirstNormalTransactionId &nbsp; &nbsp;((TransactionId) 3)</font></div><div><font size="2"   >00035 #define MaxTransactionId &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;((TransactionId) 0xFFFFFFFF)</font></div><div><font size="2"   >00036&nbsp;</font></div><div><font size="2"   >00037 /* ----------------</font></div><div><font size="2"   >00038 &nbsp;* &nbsp; &nbsp; &nbsp;transaction ID manipulation macros</font></div><div><font size="2"   >00039 &nbsp;* ----------------</font></div><div><font size="2"   >00040 &nbsp;*/</font></div><div><font size="2"   >00041 #define TransactionIdIsValid(xid) &nbsp; &nbsp; &nbsp; ((xid) != InvalidTransactionId)</font></div><div><font size="2"   >00042 #define TransactionIdIsNormal(xid) &nbsp; &nbsp; &nbsp;((xid) &gt;= FirstNormalTransactionId)</font></div><div><font size="2"   >00043 #define TransactionIdEquals(id1, id2) &nbsp; ((id1) == (id2))</font></div><div><font size="2"   >00044 #define TransactionIdStore(xid, dest) &nbsp; (*(dest) = (xid))</font></div><div><font size="2"   >00045 #define StoreInvalidTransactionId(dest) (*(dest) = InvalidTransactionId)</font></div><p></p></pre></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL MVCC - age introduce - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>