<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">pageinspect analyze index item migrated within btree pages</h2>
	<h5 id="">2012-10-26 11:16:36&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020129248105943/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">上一篇《<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020129249646421/"  >Performance tuning case : primary key on uuid or text or int8 type column</a>》提到离散的UUID值作为PK的话带来很大的索引写开销。<div>这里使用pageinspect来分析一下, 索引发生了些什么造成这么大的写操作。</div><div><br>1. 安装pageinspect参考《<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020114273265960/"  >Use pageinspect EXTENSION view PostgreSQL Page's raw infomation</a>》</div><div>2. 安装uuid-ossp参考《<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020129249646421/"  >Performance tuning case : primary key on uuid or text or int8 type column</a>》</div><div>3. 创建测试表</div><div>测试表1 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# \d digoal.test_text_pk&nbsp;</font></div><div><font size="2"  >Table "digoal.test_text_pk"</font></div><div><font size="2"  >&nbsp;Column | Type | Modifiers&nbsp;</font></div><div><font size="2"  >--------+------+-----------</font></div><div><font size="2"  >&nbsp;id &nbsp; &nbsp; | text | not null</font></div><div><font size="2"  >Indexes:</font></div><div><font size="2"  >&nbsp; &nbsp; "test_text_pk_pkey" PRIMARY KEY, btree (id), tablespace "tbs_digoal_idx"</font></div><p></p></pre></div><div><br></div><div>测试表2 :&nbsp;</div><div><wbr></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# \d digoal.test_int8_pk&nbsp;</font></div><div><font size="2"  >&nbsp;Table "digoal.test_int8_pk"</font></div><div><font size="2"  >&nbsp;Column | &nbsp;Type &nbsp;| Modifiers&nbsp;</font></div><div><font size="2"  >--------+--------+-----------</font></div><div><font size="2"  >&nbsp;id &nbsp; &nbsp; | bigint | not null</font></div><div><font size="2"  >Indexes:</font></div><div><font size="2"  >&nbsp; &nbsp; "test_int8_pk_pkey" PRIMARY KEY, btree (id), tablespace "tbs_digoal_idx"</font></div><p></p></pre></div><div><br></div><div>4. 测试</div><div><div style="line-height: 22px;"  >4.1 测试使用序列生成的主键, 索引的离散度.</div><div style="line-height: 22px;"  ><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  >digoal=&gt; truncate test_int8_pk;</font></span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  >TRUNCATE TABLE</font></div><div style="line-height: 22px;"  ><font size="2"  >digoal=&gt; insert into test_int8_pk values (nextval('test_seq'::regclass));</font></div><div style="line-height: 22px;"  ><font size="2"  >INSERT 0 1</font></div></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  >digoal=# select * from bt_page_items('digoal.test_int8_pk_pkey',1);</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp;itemoffset | ctid &nbsp;| itemlen | nulls | vars | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >------------+-------+---------+-------+------+-------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 | (0,1) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| 51 08 79 01 00 00 00 00</font></div><div style="line-height: 22px;"  ><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  >这里itemoffset是btree block中的offset. &nbsp;ctid指的是tuple的ctid, 也就是heap page里面的.</div></div><div style="line-height: 22px;"  ><br style="line-height: 22px;"  ></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><font size="2"  >digoal=# insert into digoal.test_int8_pk values (nextval('digoal.test_seq'::regclass));</font></div><div style="line-height: 22px;"  ><font size="2"  >INSERT 0 1</font></div><div style="line-height: 22px;"  ><font size="2"  >略, 插入很多条后,&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >digoal=# select * from bt_page_items('digoal.test_int8_pk_pkey',1);</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp;itemoffset | ctid &nbsp;| itemlen | nulls | vars | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >------------+-------+---------+-------+------+-------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 | (0,1) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| 51 08 79 01 00 00 00 00</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | (0,2) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| b5 08 79 01 00 00 00 00</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3 | (0,3) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| b6 08 79 01 00 00 00 00</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4 | (0,4) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| b7 08 79 01 00 00 00 00</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5 | (0,5) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| b8 08 79 01 00 00 00 00</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6 | (0,6) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| b9 08 79 01 00 00 00 00</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7 | (0,7) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| ba 08 79 01 00 00 00 00</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8 | (0,8) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| bb 08 79 01 00 00 00 00</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 9 | (0,9) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| bc 08 79 01 00 00 00 00</font></div><div style="line-height: 22px;"  ><font size="2"  >(9 rows)</font></div><p></p></pre></div><div style="line-height: 22px;"  >从itemoffset和ctid来看, 是一一对应的, 索引中的排序和heap page中的排序一一对应. 后面我们会看到uuid就不是这样的了, 会产生不对应的情况.</div></div><div style="line-height: 22px;"  ><br style="line-height: 22px;"  ></div><div style="line-height: 22px;"  >使用pgbench, 插入大量数据. 注意这里用到了8个并发, sequece的cache为100, 所以会产生索引itemoffset和heap ctid的偏移.</div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  >pg9.2.0@db-172-16-3-150-&gt; vi pgbench.sql&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >insert into test_int8_pk (id) values (nextval('test_seq'::regclass));</font></div></div><div style="line-height: 22px;"  ><font size="2"  ><br style="line-height: 22px;"  ></font></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  >pg9.2.0@db-172-16-3-150-&gt; pgbench -M prepared -n -j 8 -c 8 -T 60 -f ./pgbench.sql -U digoal digoal&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >transaction type: Custom query</font></div><div style="line-height: 22px;"  ><font size="2"  >scaling factor: 1</font></div><div style="line-height: 22px;"  ><font size="2"  >query mode: prepared</font></div><div style="line-height: 22px;"  ><font size="2"  >number of clients: 8</font></div><div style="line-height: 22px;"  ><font size="2"  >number of threads: 8</font></div><div style="line-height: 22px;"  ><font size="2"  >duration: 60 s</font></div><div style="line-height: 22px;"  ><font size="2"  >number of transactions actually processed: 5128221</font></div><div style="line-height: 22px;"  ><font size="2"  >tps = 85469.341462 (including connections establishing)</font></div><div style="line-height: 22px;"  ><font size="2"  >tps = 85478.689693 (excluding connections establishing)</font></div></div><p></p></pre></div></div><div style="line-height: 22px;"  ><br style="line-height: 22px;"  ></div><div style="line-height: 22px;"  >分析表, 得到索引的块数量. blockid 从0开始, 所以最后一个blickid应该是20107.</div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  >digoal=# analyze digoal.test_int8_pk ;</font></div><div style="line-height: 22px;"  ><font size="2"  >ANALYZE</font></div></div><div><div style="line-height: 22px;"  ><font size="2"  >digoal=# select relpages from pg_class where relname='test_int8_pk_pkey';</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp;relpages&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >----------</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; 20108</font></div><div style="line-height: 22px;"  ><font size="2"  >(1 row)</font></div></div><p></p></pre></div></div><div><div style="line-height: 22px;"  ><br></div><div style="line-height: 22px;"  >从<span style="line-height: 22px;"  >data='51 08 79 01 00 00 00 00'来看, 它还存在于btree page的1号块中. 没有变化到其他块中. 后面测试uuid时, 我们会发现数据发生了迁移, 变到其他块去了.</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# select * from (select i blockno,(bt_page_items('digoal.test_int8_pk_pkey',i)).* from (select generate_series(1,20107) i ) t) t where data='51 08 79 01 00 00 00 00';</font></div><div><font size="2"  >&nbsp;blockno | itemoffset | ctid &nbsp;| itemlen | nulls | vars | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >---------+------------+-------+---------+-------+------+-------------------------</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 | (0,1) | &nbsp; &nbsp; &nbsp;16 | f &nbsp; &nbsp; | f &nbsp; &nbsp;| 51 08 79 01 00 00 00 00</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div><div style="line-height: 22px;"  >离散度 :&nbsp;</div><div style="line-height: 22px;"  >(平均每个btree数据块中含有多少个heap块的信息, 这个值越大说明越离散)</div></div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >digoal=# select count(*) from (select blockno,regexp_matches(ctid::text,'(\d+,)') heapblockno,count(*) from (select i blockno,(bt_page_items('digoal.test_int8_pk_pkey',i)).* from (select generate_series(1,20107) i ) t) t group by blockno,regexp_matches(ctid::text,'(\d+,)') order by blockno,regexp_matches(ctid::text,'(\d+,)')) t;</font></div><div><font size="2"  >&nbsp;count &nbsp;</font></div><div><font size="2"  >--------</font></div><div><font size="2"  >&nbsp;113757</font></div><div><font size="2"  >(1 row)</font></div></div><div><div><font size="2"  >digoal=# select 113757/20107.0;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; ?column? &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >--------------------</font></div><div><font size="2"  >&nbsp;5.6575819366389814</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"  >离散度是5.7.&nbsp;</span></div><div><br></div><div style="line-height: 22px;"  >4.2 测试使用UUID生成的主键, 索引的离散度.</div></div></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >插入测试数据 :&nbsp;</span></div><div style="line-height: 22px;"  ><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  >digoal=&gt; truncate test_text_pk ;</font></span></div><div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  >TRUNCATE TABLE</font></div></div></div><div><div><font size="2"  >digoal=&gt; insert into test_text_pk values (uuid_generate_v4());</font></div><div><font size="2"  >INSERT 0 1</font></div><div><font size="2"  >digoal=&gt; select ctid,* from test_text_pk ;</font></div><div><font size="2"  >&nbsp;ctid &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >-------+--------------------------------------</font></div><div><font size="2"  >&nbsp;(0,1) | 3c50fa12-0fde-49cd-81b0-1fa02650cadf</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div><div>查看0号块, root块的信息 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; \c digoal postgres</font></div><div><font size="2"  >You are now connected to database "digoal" as user "postgres".</font></div><div><font size="2"  >digoal=# select * from bt_metap('digoal.test_text_pk_pkey');</font></div><div><font size="2"  >&nbsp;magic &nbsp;| version | root | level | fastroot | fastlevel&nbsp;</font></div><div><font size="2"  >--------+---------+------+-------+----------+-----------</font></div><div><font size="2"  >&nbsp;340322 | &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp;1 | &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div></div><div><div>查看0号块的头信息 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# select * from page_header(get_raw_page('digoal.test_text_pk_pkey',0));</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp;lsn &nbsp; &nbsp; | tli | flags | lower | upper | special | pagesize | version | prune_xid&nbsp;</font></div><div><font size="2"  >-------------+-----+-------+-------+-------+---------+----------+---------+-----------</font></div><div><font size="2"  >&nbsp;22/4F0295F0 | &nbsp; 3 | &nbsp; &nbsp; 0 | &nbsp; &nbsp;48 | &nbsp;8176 | &nbsp; &nbsp;8176 | &nbsp; &nbsp; 8192 | &nbsp; &nbsp; &nbsp; 4 | &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div></div><div><div><span style="line-height: 22px;"  >从这里可以看出, 指向HEAP PAGE(0,1)的索引在第一个btree 数据块的offset=1.</span></div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >digoal=# select * from bt_page_stats('digoal.test_text_pk_pkey',1);</font></div><div><font size="2"  >&nbsp;blkno | type | live_items | dead_items | avg_item_size | page_size | free_size | btpo_prev | btpo_next | btpo | btpo_flags&nbsp;</font></div><div><font size="2"  >-------+------+------------+------------+---------------+-----------+-----------+-----------+-----------+------+------------</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp;1 | l &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;48 | &nbsp; &nbsp; &nbsp;8192 | &nbsp; &nbsp; &nbsp;8096 | &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3</font></div><div><font size="2"  >(1 row)</font></div></div><div><div><font size="2"  >digoal=# select * from bt_page_items('digoal.test_text_pk_pkey',1);</font></div><div><font size="2"  >-[ RECORD 1 ]-----------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"  >itemoffset | 1</font></div><div><font size="2"  >ctid &nbsp; &nbsp; &nbsp; | (0,1)</font></div><div><font size="2"  >itemlen &nbsp; &nbsp;| 48</font></div><div><font size="2"  >nulls &nbsp; &nbsp; &nbsp;| f</font></div><div><font size="2"  >vars &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"  >data &nbsp; &nbsp; &nbsp; | 4b 33 63 35 30 66 61 31 32 2d 30 66 64 65 2d 34 39 63 64 2d 38 31 62 30 2d 31 66 61 30 32 36 35 30 63 61 64 66 00 00 00</font></div></div><p></p></pre></div></div><div><div>多插几条后, 你会发现itemoffset变化了. 变成了7, 因为uuid是离散的, 后插入的值可能跳跃到前面去.</div></div><div><div style="line-height: 22px;"  ><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><font size="2"  >digoal=# select * from bt_page_items('digoal.test_text_pk_pkey',1) where ctid='(0,1)';</font></div><div style="line-height: 22px;"  ><font size="2"  >-[ RECORD 1 ]-----------------------------------------------------------------------------------------------------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  >itemoffset | 7</font></div><div style="line-height: 22px;"  ><font size="2"  >ctid &nbsp; &nbsp; &nbsp; | (0,1)</font></div><div style="line-height: 22px;"  ><font size="2"  >itemlen &nbsp; &nbsp;| 48</font></div><div style="line-height: 22px;"  ><font size="2"  >nulls &nbsp; &nbsp; &nbsp;| f</font></div><div style="line-height: 22px;"  ><font size="2"  >vars &nbsp; &nbsp; &nbsp; | t</font></div><div style="line-height: 22px;"  ><font size="2"  >data &nbsp; &nbsp; &nbsp; | 4b 33 63 35 30 66 61 31 32 2d 30 66 64 65 2d 34 39 63 64 2d 38 31 62 30 2d 31 66 61 30 32 36 35 30 63 61 64 66 00 00 00</font></div><p></p></pre></div></div><div>使用pgbench插入大量数据.</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >pg9.2.0@db-172-16-3-150-&gt; vi pgbench.sql&nbsp;</font></div><div><font size="2"  >insert into test_text_pk (id) values (uuid_generate_v4());</font></div></div><div><div><font size="2"  >pg9.2.0@db-172-16-3-150-&gt; pgbench -M prepared -n -j 8 -c 8 -T 60 -f ./pgbench.sql -U digoal digoal&nbsp;</font></div><div><font size="2"  >transaction type: Custom query</font></div><div><font size="2"  >scaling factor: 1</font></div><div><font size="2"  >query mode: prepared</font></div><div><font size="2"  >number of clients: 8</font></div><div><font size="2"  >number of threads: 8</font></div><div><font size="2"  >duration: 60 s</font></div><div><font size="2"  >number of transactions actually processed: 2071981</font></div><div><font size="2"  >tps = 33795.029537 (including connections establishing)</font></div><div><font size="2"  >tps = 33798.602881 (excluding connections establishing)</font></div></div><p></p></pre></div><div>为了比较两个场景(uuid和sequence)的离散度, 我们要把两个表的记录数弄成一样的.</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >digoal=&gt; select count(*) from test_text_pk ;</font></div><div><font size="2"  >&nbsp; count &nbsp;</font></div><div><font size="2"  >---------</font></div><div><font size="2"  >&nbsp;2071985</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >digoal=&gt; select count(*) from test_int8_pk ;</font></div><div><font size="2"  >&nbsp; count &nbsp;</font></div><div><font size="2"  >---------</font></div><div><font size="2"  >&nbsp;5128230</font></div><div><font size="2"  >(1 row)</font></div></div><div><font size="2"  ><br></font></div><div><div><font size="2"  >digoal=&gt; select 5128230-2071985;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp; 3056245</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >digoal=&gt; select 3056245/5;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp; &nbsp;611249</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div>使用5个连接, 分别插入<span style="line-height: 22px;"  >611249条.</span></div><div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >pg9.2.0@db-172-16-3-150-&gt; pgbench -M prepared -n -j 5 -c 5 -t 611249 -f ./pgbench.sql -U digoal digoal&nbsp;</font></div><div><font size="2"  >transaction type: Custom query</font></div><div><font size="2"  >scaling factor: 1</font></div><div><font size="2"  >query mode: prepared</font></div><div><font size="2"  >number of clients: 5</font></div><div><font size="2"  >number of threads: 5</font></div><div><font size="2"  >number of transactions per client: 611249</font></div><div><font size="2"  >number of transactions actually processed: 3056245/3056245</font></div><div><font size="2"  >tps = 8481.444009 (including connections establishing)</font></div><div><font size="2"  >tps = 8481.569374 (excluding connections establishing)</font></div><div><font size="2"  >pg9.2.0@db-172-16-3-150-&gt; psql digoal postgres</font></div><div><font size="2"  >psql (9.2.0)</font></div><div><font size="2"  >Type "help" for help.</font></div><p></p></pre></div><div>数据一致 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# select count(*) from digoal.test_text_pk ;</font></div><div><font size="2"  >&nbsp; count &nbsp;</font></div><div><font size="2"  >---------</font></div><div><font size="2"  >&nbsp;5128230</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div></div><div>分析表 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# analyze digoal.test_text_pk ;</font></div><div><div><font size="2"  >ANALYZE</font></div></div><div><div><font size="2"  >digoal=# select relpages from pg_class where relname='test_text_pk_pkey';</font></div><div><font size="2"  >&nbsp;relpages&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp; &nbsp; 48232</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div>离散度 :&nbsp;</div><div>(平均每个btree数据块中含有多少个heap块的信息, 这个值越大说明越离散)</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >digoal=# select count(*) from (select blockno,regexp_matches(ctid::text,'(\d+,)') heapblockno,count(*) from (select i blockno,(bt_page_items('digoal.test_text_pk_pkey',i)).* from (select generate_series(1,48231) i ) t) t group by blockno,regexp_matches(ctid::text,'(\d+,)') order by blockno,regexp_matches(ctid::text,'(\d+,)')) t;</font></div><div><font size="2"  >&nbsp; count &nbsp;</font></div><div><font size="2"  >---------</font></div><div><font size="2"  >&nbsp;5218063</font></div><div><font size="2"  >(1 row)</font></div></div><div><div><font size="2"  >digoal=# select 5218063/48231.0;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;?column? &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >----------------------</font></div><div><font size="2"  >&nbsp;108.1889863365885012</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div>离散度是108</div><div><br></div><div>4.3 引起前面我们插入test_int8_pk时使用了8个并发连接, 所以出现了跳跃, 现在我们使用pgbench 只用1个连接测试索引离散度.</div><div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  >pg9.2.0@db-172-16-3-150-&gt; vi pgbench.sql&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >insert into test_int8_pk (id) values (nextval('test_seq'::regclass));</font></div></div><div><div style="line-height: 22px;"  ><font size="2"  >pg9.2.0@db-172-16-3-150-&gt; pgbench -M prepared -n -j 1 -c 1 -t 5128230 -f ./pgbench.sql -U digoal digoal&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >transaction type: Custom query</font></div><div style="line-height: 22px;"  ><font size="2"  >scaling factor: 1</font></div><div style="line-height: 22px;"  ><font size="2"  >query mode: prepared</font></div><div style="line-height: 22px;"  ><font size="2"  >number of clients: 1</font></div><div style="line-height: 22px;"  ><font size="2"  >number of threads: 1</font></div><div style="line-height: 22px;"  ><font size="2"  >number of transactions per client: 5128230</font></div><div style="line-height: 22px;"  ><font size="2"  >number of transactions actually processed: 5128230/5128230</font></div><div style="line-height: 22px;"  ><font size="2"  >tps = 12315.105527 (including connections establishing)</font></div><div style="line-height: 22px;"  ><font size="2"  >tps = 12315.179462 (excluding connections establishing)</font></div></div><p></p></pre></div></div><div><div style="line-height: 22px;"  >分析表 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><div><div><font size="2"  >digoal=# analyze digoal.test_int8_pk ;</font></div><div><font size="2"  >ANALYZE</font></div><div><font size="2"  >digoal=# select relpages from pg_class where relname='test_int8_pk_pkey';</font></div><div><font size="2"  >&nbsp;relpages&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp; &nbsp; 14063</font></div><div><font size="2"  >(1 row)</font></div></div></div></div><div><font size="2"  ><br></font></div><div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  >digoal=# select 50812/<span style="line-height: 22px;"  >14062</span>.0;</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; ?column? &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >--------------------</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp;3.6134262551557389</font></div><div style="line-height: 22px;"  ><font size="2"  >(1 row)</font></div></div></div><p></p></pre></div></div></div><div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >使用1个连接后, 离散度是3.6. 相比5.6有所下降. 为什么不是1呢? 因为索引的一个PAGE可以存储更多的tuple 信息. 所以1个page中包含了多个heap page也是可能的.</span></div></div><div><br></div><div>5. 其实离散度还可以从pg_stats系统表的顺性来看.</div><div>test_int8_pk的id字段的<span style="line-height: 22px;"  >correlation=1, 说明值的顺序和物理存储顺序完全匹配.</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; select * from pg_stats where tablename='test_int8_pk';</font></div><div><font size="2"  >schemaname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | digoal</font></div><div><font size="2"  >tablename &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| test_int8_pk</font></div><div><font size="2"  >attname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| id</font></div><div><font size="2"  >inherited &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f</font></div><div><font size="2"  >null_frac &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0</font></div><div><font size="2"  >avg_width &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 8</font></div><div><font size="2"  >n_distinct &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | -1</font></div><div><font size="2"  >most_common_vals &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"  >most_common_freqs &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"  >histogram_bounds &nbsp; &nbsp; &nbsp; | {29838052,29889587,29941829,29996284,30049067,30095481,30149949,30199948,30246714,30304418,30357875,30405713,30454170,30504240,30554509,30606207,30663743,30713746,30764653,30817283,30867810,30917521,30965820,31018596,31065487,31115505,31167375,31220204,31270240,31320584,31372567,31428657,31480074,31530250,31585782,31638403,31685544,31735385,31790844,31844458,31893300,31939775,31988146,32035610,32086224,32135423,32181071,32233532,32287654,32339198,32394747,32447665,32503537,32552850,32603287,32659275,32712525,32762516,32813792,32870698,32928363,32980064,33028329,33080209,33132552,33183973,33231771,33278461,33331777,33376457,33426189,33477025,33529585,33579216,33633518,33681080,33728169,33782771,33837889,33892593,33946049,33993313,34044390,34096964,34148166,34196726,34244527,34298765,34348191,34396274,34445661,34502817,34551819,34601492,34645170,34692006,34748476,34805448,34859143,34914579,34965884}</font></div><div><font size="2"  >correlation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1</font></div><div><font size="2"  >most_common_elems &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"  >most_common_elem_freqs |&nbsp;</font></div><div><font size="2"  >elem_count_histogram &nbsp; |&nbsp;</font></div><p></p></pre></div><div><span style="line-height: 22px;"  >test_text_pk的id字段的</span><span style="line-height: 22px;"  >correlation=</span><span style="line-height: 22px;"  >0.00300677</span><span style="line-height: 22px;"  >, 说明值的顺序和物理存储顺序非常不匹配.</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; select * from pg_stats where tablename='test_text_pk';</font></div><div><div><font size="2"  >schemaname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | digoal</font></div><div><font size="2"  >tablename &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| test_text_pk</font></div><div><font size="2"  >attname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| id</font></div><div><font size="2"  >inherited &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f</font></div><div><font size="2"  >null_frac &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0</font></div><div><font size="2"  >avg_width &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 37</font></div><div><font size="2"  >n_distinct &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | -1</font></div><div><font size="2"  >most_common_vals &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"  >most_common_freqs &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"  >histogram_bounds &nbsp; &nbsp; &nbsp; | {0000d039-b245-4089-bd8c-df39fb345578,02ab35ea-058c-4cc2-9d05-54c1a2751084,05687dad-ec92-47cd-bcb7-3de1e1cf6bc5,07fdaef2-b706-4f8e-b5ff-e24fe5093f87,0a7a9b8b-9573-4157-a532-c59410551945,0d13918b-b0fb-4120-b8ab-332015a742c2,0fbadae7-9aea-470c-91ca-a61e09969209,1232fde0-bba5-4bae-9d3b-554b1b6f6d6c,14d2ae28-966f-49ae-8784-ec33e5673c09,17435d86-ae41-4b8a-b3ac-3ddfe40c4e44,19c8139c-7fa8-4d95-ad24-e2e4a82a41fb,1c1bba44-108b-40de-9944-23c6fe3728b4,1eaf4461-2a06-48f0-89d5-334fc51b8056,2157ae47-16f3-4c8c-a9c2-f7e1de74e82e,23d97345-2a12-4292-b8bc-33a73a1d009a,265d4824-1889-47fb-b8b6-b892461c2727,28e65b66-daa2-486c-8103-d66fadaee942,2b5784dd-2028-4322-8e68-d0e24dc0728a,2df704f9-10a8-4079-b11e-13fb4a13daa0,306cc06e-b187-490e-9288-18969f1a0729,331f46cd-07eb-43ee-b122-d03bf96376ea,3573fd99-d2ae-42ad-96b7-63ea8e552c6f,382dffad-10a4-4bbe-bd20-c8bd568d9779,3ab53d66-fe00-437e-8245-e56ae9cd9355,3d78287a-ba2d-49c3-90b5-65a71cf4af57,4008476a-9510-4d3b-8e8c-f8d9289f03da,428792c1-8307-48d2-968c-d24e5f7e781b,455177d6-64ac-4b06-b064-f8eea33b8d02,4802d47b-4d04-4a45-a019-2ad1cd5697b9,4aa8693f-dfac-44a4-8e27-a05f84d3cedf,4d583891-fa5b-4954-a47a-aa8f268b28d8,4fdfaa6b-4886-4de1-a595-fdbfb4114b77,523f2bed-8c87-4b42-85a6-0e499867e760,54ac54ea-a8eb-4a63-97ab-6c165b3896a9,570cd8ef-42da-42da-923d-e5d802971fba,59989dc1-f0c2-4dab-a473-6058faa53d88,5c2dc2b8-e740-4867-9f4b-e3170ae267bf,5ed6341c-ce8f-4d02-b55a-3467c36bc650,6185be67-31d7-4a37-8456-975ff028d6ab,644bcce6-02a4-4858-b507-b56d702339ce,66d2c2c1-d93a-4da4-b73e-6c7b4756ebfa,697a389c-833a-4e86-8fc7-81b73d3a0005,6c5e448b-600f-43c6-8e5f-dfd4d88e0bca,6eb7a41c-b86f-4d71-b025-1624f4227c0e,7143bc97-3832-4794-9f9a-1fea607b498f,73eafcdb-6254-4f73-9e96-110d3ed4d5fe,76ace179-60b6-48eb-aa23-9d6da47e4b3b,793c0997-5946-4127-8a6f-489463052ef5,7bda0775-6658-4d01-9c1a-bdc98f86d81c,7e78dd32-e6a0-4b3f-97b5-2eaee658e230,8103c47e-0469-457a-9868-a827ebb5d3dd,837b49c1-3059-4639-9875-a24bafa60e02,86295ae9-a8d2-4ab6-ac3a-a275afca167e,8887e22b-a30f-439c-a13d-19c4cd887852,8b0188a3-a452-4348-a011-8668cdc9ab7a,8d9cd2ce-43ab-4c65-8ecf-3ce0850cf248,90476f28-16c4-4c63-bdce-94f8dd491250,92e2a199-2567-4f7f-bd50-9412dc912a40,9552f44c-0480-47c1-97a1-8b3f8ab37506,97b597f4-02fe-4f3d-9670-1745fa2b66c1,99fd177c-90bc-429b-bdac-97d7c1c772be,9cc27b6c-7e56-45dc-a768-436377cf5e93,9ef468e0-21ba-426a-8dcb-97ea2b68a08b,a18318c5-da32-4716-afca-ad69c8d453fe,a3d75218-ce68-42d7-89de-620d884c71d5,a69b6aaa-40a3-45b9-963f-ee33534c9e45,a9646ef0-d393-4a92-b404-8cae735592e8,abff4cb9-715e-412a-89da-6612f6a3fdcd,ae8373ed-f163-4ee9-879b-aa826041a93f,b100b5bf-49ff-4e82-a2dc-abb8c8c0691c,b3bb63fe-1d91-417d-bc3e-7423fb246de4,b64bbaf8-d6c1-4455-a997-3c5bdfa475ca,b8bb88b9-465c-4acc-9be2-533a10ce8cf9,bb32f984-c74e-4be0-9bbc-b995df5ee7d3,bdd577a4-aff4-4dc9-9a04-b07cb820a8ea,c04752b0-0ff2-469e-8acb-3197e6b7ef39,c2b17891-5730-447d-bc90-e4281f1ea2f0,c5870234-1711-4f5d-9ff3-f84d572a934d,c80120e8-80f5-4f3c-8d54-654d44c2f419,caaf2a6f-4f45-49f7-967e-98d1c08aab0f,cd60f042-2459-40ca-b664-574c0445b151,d021dc5e-4b8b-46e2-957f-1b8ba27040b5,d286a760-985c-4516-a94b-cd212282cb44,d4df4fb3-6651-46e6-beee-db3df25d6c63,d7869f83-5f6d-4919-84ce-20df7f7c101e,da0b96b3-0dd5-464b-85b3-d70e6cea09f6,dc573abd-a038-4507-885d-b8740e003645,dee38ade-31bd-43e6-8052-9247e1423173,e15ede6a-3265-4e17-b2f7-d0865c8a3cbd,e3f1ad07-cd1d-4e9f-a528-323014936b41,e668ca79-e598-4193-845b-dcd5448f64eb,e92e9a22-a577-4cd2-ba3f-4006c56e26a6,ebd81613-d6b3-45db-9195-1dc92ff42e87,ee6b723a-0f8e-4db6-93b4-191cbced6de1,f12bd7aa-fc34-4714-9a78-cd42c40fdda2,f380016e-a0e3-4b88-91ce-1288349087b5,f626900a-d37d-445b-98c7-c5710b1d05c8,f89476a3-4dc6-499f-a905-d1b507dd6d00,fb17f787-963c-4f89-a92e-1aecd1bf1424,fd9daa6e-781d-4278-bf0a-0ac9d06f5682,ffffd925-5d1c-4b6c-bc5f-bb7304d5705b}</font></div><div><font size="2"  >correlation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.00300677</font></div><div><font size="2"  >most_common_elems &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"  >most_common_elem_freqs |&nbsp;</font></div><div><font size="2"  >elem_count_histogram &nbsp; |&nbsp;</font></div></div><p></p></pre></div><div><br></div><div><br></div><div>【其他】</div><div>1. btree 索引的0号BLOCK是meta节点, 不存储item信息.</div><div>2. btree 索引数据库末尾几位有特殊通途, 所以tuple信息从(blocksize-special)开始, 这个与HEAP数据块是不一样的, HEAP数据块的special=0;</div><div><br></div>【参考】<div>1.&nbsp;<a rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/pageinspect.html"  >http://www.postgresql.org/docs/9.2/static/pageinspect.html</a></div><div>2. Performance tuning case : primary key on uuid or text or int8 type column</div><div><a href="http://blog.163.com/digoal@126/blog/static/16387704020129249646421/"  >http://blog.163.com/digoal@126/blog/static/16387704020129249646421/</a></div><div>3.&nbsp;Use pageinspect EXTENSION view PostgreSQL Page's raw infomation</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020114273265960/"  >http://blog.163.com/digoal@126/blog/static/16387704020114273265960/</a></div><div>4. src/include/access/nbtree.h</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >/*</font></div><div><font size="2"  >&nbsp;* Macros to test whether a page is leftmost or rightmost on its tree level,</font></div><div><font size="2"  >&nbsp;* as well as other state info kept in the opaque data.</font></div><div><font size="2"  >&nbsp;*/</font></div><div><font size="2"  >#define P_LEFTMOST(opaque) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;((opaque)-&gt;btpo_prev == P_NONE)</font></div><div><font size="2"  >#define P_RIGHTMOST(opaque) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((opaque)-&gt;btpo_next == P_NONE)</font></div><div><font size="2"  >#define P_ISLEAF(opaque) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;((opaque)-&gt;btpo_flags &amp; BTP_LEAF)</font></div><div><font size="2"  >#define P_ISROOT(opaque) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;((opaque)-&gt;btpo_flags &amp; BTP_ROOT)</font></div><div><font size="2"  >#define P_ISDELETED(opaque) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((opaque)-&gt;btpo_flags &amp; BTP_DELETED)</font></div><div><font size="2"  >#define P_ISHALFDEAD(opaque) &nbsp; &nbsp;((opaque)-&gt;btpo_flags &amp; BTP_HALF_DEAD)</font></div><div><font size="2"  >#define P_IGNORE(opaque) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;((opaque)-&gt;btpo_flags &amp; (BTP_DELETED|BTP_HALF_DEAD))</font></div><div><font size="2"  >#define P_HAS_GARBAGE(opaque) &nbsp; ((opaque)-&gt;btpo_flags &amp; BTP_HAS_GARBAGE)</font></div><p></p></pre></div><div>5. contrib/pageinspect/btreefuncs.c</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  ><span> </span>/* page type (flags) */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; if (P_ISDELETED(opaque))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stat-&gt;type = 'd';</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stat-&gt;btpo.xact = opaque-&gt;btpo.xact;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; else if (P_IGNORE(opaque))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stat-&gt;type = 'e';</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; else if (P_ISLEAF(opaque))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stat-&gt;type = 'l';</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; else if (P_ISROOT(opaque))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stat-&gt;type = 'r';</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; else</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stat-&gt;type = 'i';</font></div><p></p></pre></div><div>6.&nbsp;PostgreSQL Statistics and Query Explain Introduction</div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201041111454178/"  >http://blog.163.com/digoal@126/blog/static/163877040201041111454178/</a></div></div>
	</div>
</div>
</body>
</html>