<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL Replication Slots attention</h2>
	<h5 id="">2015-06-16 9:40:35&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201551693110103/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 9.4开始引入了replication slot的概念，使用replication slot有几个好处。</div><div>1. 当standby的查询正需要某些行版本时，主节点实施vacuum并不会回收这些空间，从而避免standby上执行SQL与vacuum产生的XLOG replay发生冲突。</div><div>2. 不再需要设置wal_keep_segments，因为主节点可以根据连接的slot反馈的接收位置，来确保不会删除需要的XLOG。即当STANDBY接收很快时，XLOG目录中的文件数会比较少，当STANDBY网络异常或离线时，XLOG可能会堆积文件。</div><div>注意，这些都需要配合hot_standby_feedback使用，务必开启<span style="line-height: 28px;"   >hot_standby_feedback</span><span style="line-height: 28px;"   >。</span></div><div><h2 style="margin: 2ex 0em 1.2em; color: rgb(102, 102, 102); font-family: verdana, sans-serif; line-height: normal; font-size: 1.2em !important;"   ><a id="STREAMING-REPLICATION-SLOTS" name="STREAMING-REPLICATION-SLOTS" rel="nofollow"   >25.2.6. Replication Slots</a></h2><p style="font-size: 12.1599998474121px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >Replication slots provide an automated way to ensure that the master does not remove WAL segments until they have been received by all standbys, and that the master does not remove rows which could cause a&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/hot-standby.html#HOT-STANDBY-CONFLICT"   >recovery conflict</a>&nbsp;even when the standby is disconnected.</p><p style="font-size: 12.1599998474121px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >In lieu of using replication slots, it is possible to prevent the removal of old WAL segments using&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/runtime-config-replication.html#GUC-WAL-KEEP-SEGMENTS"   >wal_keep_segments</a>, or by storing the segments in an archive using&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/runtime-config-wal.html#GUC-ARCHIVE-COMMAND"   >archive_command</a>. However, these methods often result in retaining more WAL segments than required, whereas replication slots retain only the number of segments known to be needed. An advantage of these methods is that they bound the space requirement for&nbsp;<tt>pg_xlog</tt>; there is currently no way to do this using replication slots.</p><p style="font-size: 12.1599998474121px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >Similarly,&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/runtime-config-replication.html#GUC-HOT-STANDBY-FEEDBACK"   >hot_standby_feedback</a>&nbsp;and&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/runtime-config-replication.html#GUC-VACUUM-DEFER-CLEANUP-AGE"   >vacuum_defer_cleanup_age</a>&nbsp;provide protection against relevant rows being removed by vacuum, but the former provides no protection during any time period when the standby is not connected, and the latter often needs to be set to a high value to provide adequate protection. Replication slots overcome these disadvantages.</p></div><div><br></div><div>测试：</div><div><div>///////////////////////// Primary:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select * from pg_file_settings;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sourcefile &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | sourceline | seqno | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;setting &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >-----------------------------------------------+------------+-------+----------------------------+--------------------</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 63 | &nbsp; &nbsp; 1 | port &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 1922</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 64 | &nbsp; &nbsp; 2 | max_connections &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 100</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 68 | &nbsp; &nbsp; 3 | unix_socket_directories &nbsp; &nbsp;| .</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 71 | &nbsp; &nbsp; 4 | unix_socket_permissions &nbsp; &nbsp;| 0700</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;102 | &nbsp; &nbsp; 5 | tcp_keepalives_idle &nbsp; &nbsp; &nbsp; &nbsp;| 60</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;104 | &nbsp; &nbsp; 6 | tcp_keepalives_interval &nbsp; &nbsp;| 10</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;106 | &nbsp; &nbsp; 7 | tcp_keepalives_count &nbsp; &nbsp; &nbsp; | 10</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;116 | &nbsp; &nbsp; 8 | shared_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 4096MB</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;131 | &nbsp; &nbsp; 9 | dynamic_shared_memory_type | posix</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;160 | &nbsp; &nbsp;10 | bgwriter_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 10ms</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;176 | &nbsp; &nbsp;11 | wal_level &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| logical</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;179 | &nbsp; &nbsp;12 | synchronous_commit &nbsp; &nbsp; &nbsp; &nbsp; | off</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;189 | &nbsp; &nbsp;13 | wal_compression &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;192 | &nbsp; &nbsp;14 | wal_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 16MB</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;194 | &nbsp; &nbsp;15 | wal_writer_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 10ms</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;202 | &nbsp; &nbsp;16 | max_wal_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8GB</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;227 | &nbsp; &nbsp;17 | max_wal_senders &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 32</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;232 | &nbsp; &nbsp;18 | max_replication_slots &nbsp; &nbsp; &nbsp;| 32</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;234 | &nbsp; &nbsp;19 | track_commit_timestamp &nbsp; &nbsp; | off</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;322 | &nbsp; &nbsp;20 | log_destination &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| csvlog</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;328 | &nbsp; &nbsp;21 | logging_collector &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;340 | &nbsp; &nbsp;22 | log_truncate_on_rotation &nbsp; | on</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;446 | &nbsp; &nbsp;23 | log_timezone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | PRC</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;533 | &nbsp; &nbsp;24 | datestyle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| iso, mdy</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;535 | &nbsp; &nbsp;25 | timezone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | PRC</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;548 | &nbsp; &nbsp;26 | lc_messages &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| C</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;550 | &nbsp; &nbsp;27 | lc_monetary &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| C</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;551 | &nbsp; &nbsp;28 | lc_numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | C</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;552 | &nbsp; &nbsp;29 | lc_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| C</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;555 | &nbsp; &nbsp;30 | default_text_search_config | pg_catalog.english</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.auto.conf | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | &nbsp; &nbsp;31 | track_commit_timestamp &nbsp; &nbsp; | on</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.auto.conf | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 | &nbsp; &nbsp;32 | shared_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8GB</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.auto.conf | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 | &nbsp; &nbsp;33 | synchronous_commit &nbsp; &nbsp; &nbsp; &nbsp; | on</font></div><div><font size="2"   >(33 rows)</font></div><p></p></pre></div><div><br></div><div>///////////////////////// Standby:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg95@db-172-16-3-150-&gt; psql -h 127.0.0.1 -p 1923</font></div><div><font size="2"   >psql (9.5devel)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >postgres=# select * from pg_file_settings;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sourcefile &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| sourceline | seqno | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;setting &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >-------------------------------------------------+------------+-------+------------------------------+--------------------</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 63 | &nbsp; &nbsp; 1 | port &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 1923</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 64 | &nbsp; &nbsp; 2 | max_connections &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 100</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 68 | &nbsp; &nbsp; 3 | unix_socket_directories &nbsp; &nbsp; &nbsp;| .</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 71 | &nbsp; &nbsp; 4 | unix_socket_permissions &nbsp; &nbsp; &nbsp;| 0700</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;102 | &nbsp; &nbsp; 5 | tcp_keepalives_idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 60</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;104 | &nbsp; &nbsp; 6 | tcp_keepalives_interval &nbsp; &nbsp; &nbsp;| 10</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;106 | &nbsp; &nbsp; 7 | tcp_keepalives_count &nbsp; &nbsp; &nbsp; &nbsp; | 10</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;116 | &nbsp; &nbsp; 8 | shared_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 4096MB</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;131 | &nbsp; &nbsp; 9 | dynamic_shared_memory_type &nbsp; | posix</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;160 | &nbsp; &nbsp;10 | bgwriter_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 10ms</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;176 | &nbsp; &nbsp;11 | wal_level &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| logical</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;179 | &nbsp; &nbsp;12 | synchronous_commit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;189 | &nbsp; &nbsp;13 | wal_compression &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;192 | &nbsp; &nbsp;14 | wal_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 16MB</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;194 | &nbsp; &nbsp;15 | wal_writer_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 10ms</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;202 | &nbsp; &nbsp;16 | max_wal_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8GB</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;227 | &nbsp; &nbsp;17 | max_wal_senders &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 32</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;232 | &nbsp; &nbsp;18 | max_replication_slots &nbsp; &nbsp; &nbsp; &nbsp;| 32</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;234 | &nbsp; &nbsp;19 | track_commit_timestamp &nbsp; &nbsp; &nbsp; | off</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;250 | &nbsp; &nbsp;20 | hot_standby &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;258 | &nbsp; &nbsp;21 | wal_receiver_status_interval | 1s</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;260 | &nbsp; &nbsp;22 | hot_standby_feedback &nbsp; &nbsp; &nbsp; &nbsp; | on</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;322 | &nbsp; &nbsp;23 | log_destination &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| csvlog</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;328 | &nbsp; &nbsp;24 | logging_collector &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;340 | &nbsp; &nbsp;25 | log_truncate_on_rotation &nbsp; &nbsp; | on</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;446 | &nbsp; &nbsp;26 | log_timezone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | PRC</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;533 | &nbsp; &nbsp;27 | datestyle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| iso, mdy</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;535 | &nbsp; &nbsp;28 | timezone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | PRC</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;548 | &nbsp; &nbsp;29 | lc_messages &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| C</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;550 | &nbsp; &nbsp;30 | lc_monetary &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| C</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;551 | &nbsp; &nbsp;31 | lc_numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | C</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;552 | &nbsp; &nbsp;32 | lc_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| C</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;555 | &nbsp; &nbsp;33 | default_text_search_config &nbsp; | pg_catalog.english</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.auto.conf | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | &nbsp; &nbsp;34 | track_commit_timestamp &nbsp; &nbsp; &nbsp; | on</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.auto.conf | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 | &nbsp; &nbsp;35 | shared_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8GB</font></div><div><font size="2"   >&nbsp;/data03/pg95_stdby/pg_root/postgresql.auto.conf | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 | &nbsp; &nbsp;36 | synchronous_commit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on</font></div><div><font size="2"   >(36 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pg95@db-172-16-3-150-&gt; cd /data03/pg95_stdby/pg_root/</font></div><div><font size="2"   >pg95@db-172-16-3-150-&gt; cat recovery.conf |grep ^[a-z]</font></div><div><font size="2"   >recovery_target_timeline = 'latest'</font></div><div><font size="2"   >standby_mode = on</font></div><div><font size="2"   >primary_conninfo = 'hostaddr=127.0.0.1 port=1922' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # e.g. 'host=localhost port=5432'</font></div><div><font size="2"   >primary_slot_name = 'abc'</font></div><p></p></pre></div><div><br></div><div>///////////////////////// Primary:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg95@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.5devel)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >postgres=# select pg_create_physical_replication_slot('abc');</font></div><div><font size="2"   >postgres=# select * from pg_replication_slots ;</font></div><div><font size="2"   >&nbsp;slot_name | plugin | slot_type | datoid | database | active | active_pid | xmin | catalog_xmin | restart_lsn&nbsp;</font></div><div><font size="2"   >-----------+--------+-----------+--------+----------+--------+------------+------+--------------+-------------</font></div><div><font size="2"   >&nbsp;abc &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;| physical &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; 5093 | 1809 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 6/6E000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# create table test(id int)</font></div><div><font size="2"   >postgres-# ;</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >postgres=# insert into test values (1),(2),(3);</font></div><div><font size="2"   >INSERT 0 3</font></div><p></p></pre></div><div><br></div><div>///////////////////////// Standby:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg95@db-172-16-3-150-&gt; psql -h 127.0.0.1 -p 1923</font></div><div><font size="2"   >postgres=# begin transaction isolation level repeatable read;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >postgres=# select * from test;</font></div><div><font size="2"   >&nbsp;id&nbsp;</font></div><div><font size="2"   >----</font></div><div><font size="2"   >&nbsp; 1</font></div><div><font size="2"   >&nbsp; 2</font></div><div><font size="2"   >&nbsp; 3</font></div><div><font size="2"   >(3 rows)</font></div><p></p></pre></div><div><br></div><div>///////////////////////// Primary:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# delete from test;</font></div><div><font size="2"   >DELETE 3</font></div><div><font size="2"   >postgres=# vacuum verbose test;</font></div><div><font size="2"   >INFO: &nbsp;vacuuming "public.test"</font></div><div><font size="2"   >INFO: &nbsp;"test": found 0 removable, 3 nonremovable row versions in 1 out of 1 pages</font></div><div><font size="2"   >DETAIL: &nbsp;3 dead row versions cannot be removed yet.</font></div><div><font size="2"   >There were 0 unused item pointers.</font></div><div><font size="2"   >Skipped 0 pages due to buffer pins.</font></div><div><font size="2"   >0 pages are entirely empty.</font></div><div><font size="2"   >CPU 0.00s/0.00u sec elapsed 0.00 sec.</font></div><div><font size="2"   >VACUUM</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select * from pg_stat_replication ;</font></div><div><font size="2"   >-[ RECORD 1 ]----+------------------------------</font></div><div><font size="2"   >pid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 5093</font></div><div><font size="2"   >usesysid &nbsp; &nbsp; &nbsp; &nbsp; | 10</font></div><div><font size="2"   >usename &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| postgres</font></div><div><font size="2"   >application_name | walreceiver</font></div><div><font size="2"   >client_addr &nbsp; &nbsp; &nbsp;| 127.0.0.1</font></div><div><font size="2"   >client_hostname &nbsp;|&nbsp;</font></div><div><font size="2"   >client_port &nbsp; &nbsp; &nbsp;| 20694</font></div><div><font size="2"   >backend_start &nbsp; &nbsp;| 2015-06-16 08:50:58.779855+08</font></div><div><font size="2"   >backend_xmin &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >state &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| streaming</font></div><div><font size="2"   >sent_location &nbsp; &nbsp;| 7/77B09918</font></div><div><font size="2"   >write_location &nbsp; | 7/77B09918</font></div><div><font size="2"   >flush_location &nbsp; | 7/77B09918</font></div><div><font size="2"   >replay_location &nbsp;| 7/77B09918</font></div><div><font size="2"   >sync_priority &nbsp; &nbsp;| 0</font></div><div><font size="2"   >sync_state &nbsp; &nbsp; &nbsp; | async</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# checkpoint;</font></div><div><font size="2"   >CHECKPOINT</font></div><div><font size="2"   >postgres=# vacuum VERBOSE test;</font></div><div><font size="2"   >INFO: &nbsp;vacuuming "public.test"</font></div><div><font size="2"   >INFO: &nbsp;"test": found 0 removable, 3 nonremovable row versions in 1 out of 1 pages</font></div><div><font size="2"   >DETAIL: &nbsp;3 dead row versions cannot be removed yet.</font></div><div><font size="2"   >There were 0 unused item pointers.</font></div><div><font size="2"   >Skipped 0 pages due to buffer pins.</font></div><div><font size="2"   >0 pages are entirely empty.</font></div><div><font size="2"   >CPU 0.00s/0.00u sec elapsed 0.00 sec.</font></div><div><font size="2"   >VACUUM</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select * from pg_replication_slots ;</font></div><div><font size="2"   >-[ RECORD 1 ]+-----------</font></div><div><font size="2"   >slot_name &nbsp; &nbsp;| abc</font></div><div><font size="2"   >plugin &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >slot_type &nbsp; &nbsp;| physical</font></div><div><font size="2"   >datoid &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >database &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >active &nbsp; &nbsp; &nbsp; | t</font></div><div><font size="2"   >active_pid &nbsp; | 5093</font></div><div><font size="2"   >xmin &nbsp; &nbsp; &nbsp; &nbsp; | 1815</font></div><div><font size="2"   >catalog_xmin |&nbsp;</font></div><div><font size="2"   >restart_lsn &nbsp;| 7/77B099F8</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select * from pg_stat_replication ;</font></div><div><font size="2"   >-[ RECORD 1 ]----+------------------------------</font></div><div><font size="2"   >pid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 5093</font></div><div><font size="2"   >usesysid &nbsp; &nbsp; &nbsp; &nbsp; | 10</font></div><div><font size="2"   >usename &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| postgres</font></div><div><font size="2"   >application_name | walreceiver</font></div><div><font size="2"   >client_addr &nbsp; &nbsp; &nbsp;| 127.0.0.1</font></div><div><font size="2"   >client_hostname &nbsp;|&nbsp;</font></div><div><font size="2"   >client_port &nbsp; &nbsp; &nbsp;| 20694</font></div><div><font size="2"   >backend_start &nbsp; &nbsp;| 2015-06-16 08:50:58.779855+08</font></div><div><font size="2"   >backend_xmin &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >state &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| streaming</font></div><div><font size="2"   >sent_location &nbsp; &nbsp;| 7/77B099F8</font></div><div><font size="2"   >write_location &nbsp; | 7/77B099F8</font></div><div><font size="2"   >flush_location &nbsp; | 7/77B099F8</font></div><div><font size="2"   >replay_location &nbsp;| 7/77B099F8</font></div><div><font size="2"   >sync_priority &nbsp; &nbsp;| 0</font></div><div><font size="2"   >sync_state &nbsp; &nbsp; &nbsp; | async</font></div><p></p></pre></div><div>即使standby此时断开，primary也不会清理这些垃圾。必须等待hot standby对应的事务结束，同时feedback给primary后，才会回收这些垃圾。</div><div>///////////////////////// HOST:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 backend]# ifdown lo</font></div><div></div><p></p></pre></div><div>///////////////////////// Primary:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select * from pg_stat_replication ;</font></div><div><font size="2"   >&nbsp;pid | usesysid | usename | application_name | client_addr | client_hostname | client_port | backend_start | backend_xmin | state |&nbsp;</font></div><div><font size="2"   >sent_location | write_location | flush_location | replay_location | sync_priority | sync_state&nbsp;</font></div><div><font size="2"   >-----+----------+---------+------------------+-------------+-----------------+-------------+---------------+--------------+-------+-</font></div><div><font size="2"   >--------------+----------------+----------------+-----------------+---------------+------------</font></div><div><font size="2"   >(0 rows)</font></div><div><font size="2"   >postgres=# vacuum VERBOSE test;</font></div><div><font size="2"   >INFO: &nbsp;vacuuming "public.test"</font></div><div><font size="2"   >INFO: &nbsp;"test": found 0 removable, 3 nonremovable row versions in 1 out of 1 pages</font></div><div><font size="2"   >DETAIL: &nbsp;3 dead row versions cannot be removed yet.</font></div><div><font size="2"   >There were 0 unused item pointers.</font></div><div><font size="2"   >Skipped 0 pages due to buffer pins.</font></div><div><font size="2"   >0 pages are entirely empty.</font></div><div><font size="2"   >CPU 0.00s/0.00u sec elapsed 0.00 sec.</font></div><div><font size="2"   >VACUUM</font></div><p></p></pre></div><div><br></div><div>///////////////////////// HOST:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 backend]# ifup lo</font></div><div></div><p></p></pre></div><div>///////////////////////// Primary:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# vacuum VERBOSE test;</font></div><div><font size="2"   >INFO: &nbsp;vacuuming "public.test"</font></div><div><font size="2"   >INFO: &nbsp;"test": removed 3 row versions in 1 pages</font></div><div><font size="2"   >INFO: &nbsp;"test": found 3 removable, 0 nonremovable row versions in 1 out of 1 pages</font></div><div><font size="2"   >DETAIL: &nbsp;0 dead row versions cannot be removed yet.</font></div><div><font size="2"   >There were 0 unused item pointers.</font></div><div><font size="2"   >Skipped 0 pages due to buffer pins.</font></div><div><font size="2"   >0 pages are entirely empty.</font></div><div><font size="2"   >CPU 0.00s/0.00u sec elapsed 0.00 sec.</font></div><div><font size="2"   >INFO: &nbsp;"test": truncated 1 to 0 pages</font></div><div><font size="2"   >DETAIL: &nbsp;CPU 0.00s/0.00u sec elapsed 0.00 sec.</font></div><div><font size="2"   >VACUUM</font></div><p></p></pre></div><div><br></div><div><br></div><div><br></div><div>///////////////////////// use shutdown immediate can also reflect it:</div><div>///////////////////////// Primary:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# insert into test values (1),(2),(3);</font></div><div><font size="2"   >INSERT 0 3</font></div><p></p></pre></div><div><br></div><div>///////////////////////// Standby:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# begin transaction isolation level repeatable read;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >postgres=# select * from test;</font></div><div><font size="2"   >&nbsp;id&nbsp;</font></div><div><font size="2"   >----</font></div><div><font size="2"   >&nbsp; 1</font></div><div><font size="2"   >&nbsp; 2</font></div><div><font size="2"   >&nbsp; 3</font></div><div><font size="2"   >(3 rows)</font></div><p></p></pre></div><div><br></div><div>///////////////////////// Primary:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# delete from test;</font></div><div><font size="2"   >DELETE 3</font></div><div><font size="2"   >postgres=# vacuum VERBOSE test;</font></div><div><font size="2"   >INFO: &nbsp;vacuuming "public.test"</font></div><div><font size="2"   >INFO: &nbsp;"test": found 0 removable, 3 nonremovable row versions in 1 out of 1 pages</font></div><div><font size="2"   >DETAIL: &nbsp;3 dead row versions cannot be removed yet.</font></div><div><font size="2"   >There were 0 unused item pointers.</font></div><div><font size="2"   >Skipped 0 pages due to buffer pins.</font></div><div><font size="2"   >0 pages are entirely empty.</font></div><div><font size="2"   >CPU 0.00s/0.00u sec elapsed 0.00 sec.</font></div><div><font size="2"   >VACUUM</font></div><p></p></pre></div><div><br></div><div>///////////////////////// shutdown hot_standby:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg95@db-172-16-3-150-&gt; pg_ctl stop -m immediate -D /data03/pg95_stdby/pg_root</font></div><div><font size="2"   >waiting for server to shut down.... done</font></div><div><font size="2"   >server stopped</font></div><p></p></pre></div><div><br></div><div>///////////////////////// Primary:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select * from pg_stat_replication ;</font></div><div><font size="2"   >(0 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select * from pg_replication_slots;</font></div><div><font size="2"   >-[ RECORD 1 ]+-----------</font></div><div><font size="2"   >slot_name &nbsp; &nbsp;| abc</font></div><div><font size="2"   >plugin &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >slot_type &nbsp; &nbsp;| physical</font></div><div><font size="2"   >datoid &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >database &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >active &nbsp; &nbsp; &nbsp; | f</font></div><div><font size="2"   >active_pid &nbsp; |&nbsp;</font></div><div><font size="2"   >xmin &nbsp; &nbsp; &nbsp; &nbsp; | 1818</font></div><div><font size="2"   >catalog_xmin |&nbsp;</font></div><div><font size="2"   >restart_lsn &nbsp;| 7/77B0B690</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# vacuum VERBOSE test;</font></div><div><font size="2"   >INFO: &nbsp;vacuuming "public.test"</font></div><div><font size="2"   >INFO: &nbsp;"test": found 0 removable, 3 nonremovable row versions in 1 out of 1 pages</font></div><div><font size="2"   >DETAIL: &nbsp;3 dead row versions cannot be removed yet.</font></div><div><font size="2"   >There were 0 unused item pointers.</font></div><div><font size="2"   >Skipped 0 pages due to buffer pins.</font></div><div><font size="2"   >0 pages are entirely empty.</font></div><div><font size="2"   >CPU 0.00s/0.00u sec elapsed 0.00 sec.</font></div><div><font size="2"   >VACUUM</font></div><p></p></pre></div><div>注意，当standby长期离线时，务必删除slot，否则垃圾会越来越多。</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select pg_drop_replication_slot('abc');</font></div><div><font size="2"   >-[ RECORD 1 ]------------+-</font></div><div><font size="2"   >pg_drop_replication_slot |&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# vacuum VERBOSE test;</font></div><div><font size="2"   >INFO: &nbsp;vacuuming "public.test"</font></div><div><font size="2"   >INFO: &nbsp;"test": removed 3 row versions in 1 pages</font></div><div><font size="2"   >INFO: &nbsp;"test": found 3 removable, 0 nonremovable row versions in 1 out of 1 pages</font></div><div><font size="2"   >DETAIL: &nbsp;0 dead row versions cannot be removed yet.</font></div><div><font size="2"   >There were 0 unused item pointers.</font></div><div><font size="2"   >Skipped 0 pages due to buffer pins.</font></div><div><font size="2"   >0 pages are entirely empty.</font></div><div><font size="2"   >CPU 0.00s/0.00u sec elapsed 0.00 sec.</font></div><div><font size="2"   >INFO: &nbsp;"test": truncated 1 to 0 pages</font></div><div><font size="2"   >DETAIL: &nbsp;CPU 0.00s/0.00u sec elapsed 0.00 sec.</font></div><div><font size="2"   >VACUUM</font></div><p></p></pre></div><div><br></div></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/warm-standby.html"   >http://www.postgresql.org/docs/devel/static/warm-standby.html</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-admin.html#PG-REPLICATION-ORIGIN-SESSION-PROGRESS"   >http://www.postgresql.org/docs/devel/static/functions-admin.html#PG-REPLICATION-ORIGIN-SESSION-PROGRESS</a></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL Replication Slots attention - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>