<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">use iperf test network performance (tcp window & performance)</h2>
	<h5 id="">2015-06-05 15:50:18&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402015553437256/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>用iperf可以测试客户端和服务端之间的网络性能。</div><div>例如两台服务器是在同一个交换机下面的，可以用这种方法测试交换机和网卡的转发能力。当然测试结果还和tcp窗口配置，还有包的大小有一定关系（这种情况下往往不是二层的瓶颈）。</div><div>测试例子：</div><div>启动服务端</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># iperf -f M -i 5 -m -N -s</font></div><div></div><p></p></pre></div><div>启动客户端，单线程测试，TCP窗口大小1000字节。(非常小，所以性能不能达到网卡瓶颈1Gbit)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># iperf -f M -i 5 -m -w 1000 -N -t 100 -c $server_ip</font></div><div><div><font size="2"   >WARNING: TCP window size set to 1000 bytes. A small window size</font></div><div><font size="2"   >will give poor performance. See the Iperf documentation.</font></div><div><font size="2"   >------------------------------------------------------------</font></div><div><font size="2"   >Client connecting to&nbsp;<span style="line-height: 28px;"   >$server_ip</span>, TCP port 5001</font></div><div><font size="2"   >TCP window size: 0.00 MByte (WARNING: requested 0.00 MByte)</font></div><div><font size="2"   >------------------------------------------------------------</font></div><div><font size="2"   >[ &nbsp;3] local &nbsp;port 38549 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ ID] Interval &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bandwidth</font></div><div><font size="2"   >[ &nbsp;3] &nbsp;0.0- 5.0 sec &nbsp; 184 MBytes &nbsp;36.8 MBytes/sec</font></div><div><font size="2"   >[ &nbsp;3] &nbsp;5.0-10.0 sec &nbsp; 184 MBytes &nbsp;36.8 MBytes/sec</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >sar -n DEV 1 1000</font></div><div><div><font size="2"   >03:29:43 PM &nbsp; &nbsp; IFACE &nbsp; rxpck/s &nbsp; txpck/s &nbsp; &nbsp;rxkB/s &nbsp; &nbsp;txkB/s &nbsp; rxcmp/s &nbsp; txcmp/s &nbsp;rxmcst/s</font></div><div><font size="2"   >03:29:44 PM &nbsp; &nbsp; &nbsp; &nbsp;lo &nbsp; &nbsp; 17.35 &nbsp; &nbsp; 17.35 &nbsp; &nbsp; &nbsp;6.07 &nbsp; &nbsp; &nbsp;6.07 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00</font></div><div><font size="2"   >03:29:44 PM &nbsp; &nbsp; &nbsp;eth0 &nbsp; 5421.43 &nbsp;27036.73 &nbsp; &nbsp;338.84 &nbsp;39982.72 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00</font></div></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >启动客户端，单线程测试，TCP窗口大小16K。速度有所提升</span></div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 28px;"   ><font size="2"   ># iperf -f M -i 5 -m -w 16K -N -t 100 -c&nbsp;<span style="line-height: 28px;"   >$server_ip</span></font></div><div style="line-height: 28px;"   ><font size="2"   >------------------------------------------------------------</font></div><div style="line-height: 28px;"   ><font size="2"   >Client connecting to&nbsp;<span style="line-height: 28px;"   >$server_ip</span><span style="line-height: 28px;"   >, TCP port 5001</span></font></div><div style="line-height: 28px;"   ><font size="2"   >TCP window size: 0.03 MByte (WARNING: requested 0.02 MByte)</font></div><div style="line-height: 28px;"   ><font size="2"   >------------------------------------------------------------</font></div><div style="line-height: 28px;"   ><font size="2"   >[ &nbsp;3] local &nbsp;port 38551 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div style="line-height: 28px;"   ><font size="2"   >[ ID] Interval &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bandwidth</font></div><div style="line-height: 28px;"   ><font size="2"   >[ &nbsp;3] &nbsp;0.0- 5.0 sec &nbsp; 494 MBytes &nbsp;98.7 MBytes/sec</font></div><div style="line-height: 28px;"   ><font size="2"   >[ &nbsp;3] &nbsp;5.0-10.0 sec &nbsp; 493 MBytes &nbsp;98.6 MBytes/sec</font></div><div style="line-height: 28px;"   ><font size="2"   >[ &nbsp;3] 10.0-15.0 sec &nbsp; 493 MBytes &nbsp;98.7 MBytes/sec</font></div><div style="line-height: 28px;"   ><font size="2"   >[ &nbsp;3] 15.0-20.0 sec &nbsp; 493 MBytes &nbsp;98.7 MBytes/sec</font></div><div style="line-height: 28px;"   ><font size="2"   >[ &nbsp;3] 20.0-25.0 sec &nbsp; 494 MBytes &nbsp;98.7 MBytes/sec</font></div><div style="line-height: 28px;"   ><font size="2"   >[ &nbsp;3] 25.0-30.0 sec &nbsp; 493 MBytes &nbsp;98.7 MBytes/sec</font></div><div style="line-height: 28px;"   ><font size="2"   >[ &nbsp;3] 30.0-35.0 sec &nbsp; 493 MBytes &nbsp;98.5 MBytes/sec</font></div></div><div style="line-height: 28px;"   ><font size="2"   ><br></font></div><div><div><font size="2"   >03:31:22 PM &nbsp; &nbsp; IFACE &nbsp; rxpck/s &nbsp; txpck/s &nbsp; &nbsp;rxkB/s &nbsp; &nbsp;txkB/s &nbsp; rxcmp/s &nbsp; txcmp/s &nbsp;rxmcst/s</font></div><div><font size="2"   >03:31:23 PM &nbsp; &nbsp; &nbsp; &nbsp;lo &nbsp; &nbsp; 22.00 &nbsp; &nbsp; 22.00 &nbsp; &nbsp; &nbsp;7.88 &nbsp; &nbsp; &nbsp;7.88 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00</font></div><div><font size="2"   >03:31:23 PM &nbsp; &nbsp; &nbsp;eth0 &nbsp; 7138.00 &nbsp;71027.00 &nbsp; &nbsp;446.21 105035.24 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00</font></div></div><p></p></pre></div></div><wbr><div><br></div><div>窗口调整为32K时，基本达到了1Gbit的极限。</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># iperf -f M -i 5 -m -w 32K -N -t 100 -c&nbsp;<span style="line-height: 28px;"   >$server_ip</span></font></div><div><font size="2"   >------------------------------------------------------------</font></div><div><font size="2"   >Client connecting to&nbsp;<span style="line-height: 28px;"   >$server_ip</span>, TCP port 5001</font></div><div><font size="2"   >TCP window size: 0.06 MByte (WARNING: requested 0.03 MByte)</font></div><div><font size="2"   >------------------------------------------------------------</font></div><div><font size="2"   >[ &nbsp;3] local &nbsp;port 38552 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ ID] Interval &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bandwidth</font></div><div><font size="2"   >[ &nbsp;3] &nbsp;0.0- 5.0 sec &nbsp; 566 MBytes &nbsp; 113 MBytes/sec</font></div><div><font size="2"   >[ &nbsp;3] &nbsp;5.0-10.0 sec &nbsp; 566 MBytes &nbsp; 113 MBytes/sec</font></div><div><font size="2"   >[ &nbsp;3] 10.0-15.0 sec &nbsp; 566 MBytes &nbsp; 113 MBytes/sec</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >03:35:04 PM &nbsp; &nbsp; IFACE &nbsp; rxpck/s &nbsp; txpck/s &nbsp; &nbsp;rxkB/s &nbsp; &nbsp;txkB/s &nbsp; rxcmp/s &nbsp; txcmp/s &nbsp;rxmcst/s</font></div><div><font size="2"   >03:35:05 PM &nbsp; &nbsp; &nbsp; &nbsp;lo &nbsp; &nbsp; 21.74 &nbsp; &nbsp; 21.74 &nbsp; &nbsp; &nbsp;8.40 &nbsp; &nbsp; &nbsp;8.40 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00</font></div><div><font size="2"   >03:35:05 PM &nbsp; &nbsp; &nbsp;eth0 &nbsp; 8379.35 &nbsp;88493.48 &nbsp; &nbsp;523.71 130868.47 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00 &nbsp; &nbsp; &nbsp;0.00</font></div></div><p></p></pre></div><div><br></div><div>最后测试一下多线程，使用1500的窗口，同样可以把网卡极限跑满：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># iperf -f M -i 5 -m -w 1500 -N -t 100 -c&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;-P 10</font></div><div><font size="2"   >WARNING: TCP window size set to 1500 bytes. A small window size</font></div><div><font size="2"   >will give poor performance. See the Iperf documentation.</font></div><div><font size="2"   >------------------------------------------------------------</font></div><div><font size="2"   >Client connecting to&nbsp;<span style="line-height: 28px;"   >$server_ip</span>, TCP port 5001</font></div><div><font size="2"   >TCP window size: 0.00 MByte (WARNING: requested 0.00 MByte)</font></div><div><font size="2"   >------------------------------------------------------------</font></div><div><font size="2"   >[ 12] local &nbsp;port 38564 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ &nbsp;3] local &nbsp;port 38554 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ &nbsp;4] local &nbsp;port 38555 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ &nbsp;5] local &nbsp;port 38557 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ &nbsp;7] local &nbsp;port 38558 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ &nbsp;6] local &nbsp;port 38559 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ &nbsp;8] local &nbsp;port 38560 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ &nbsp;9] local &nbsp;port 38561 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ 10] local &nbsp;port 38562 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span><span style="line-height: 28px;"   >&nbsp;port 5001</span></font></div><div><font size="2"   >[ 11] local &nbsp;port 38563 connected with&nbsp;<span style="line-height: 28px;"   >$server_ip</span>&nbsp;port 5001</font></div><div><font size="2"   >[ ID] Interval &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bandwidth</font></div><div><font size="2"   >[ 12] &nbsp;0.0- 5.0 sec &nbsp;47.2 MBytes &nbsp;9.45 MBytes/sec</font></div><div><font size="2"   >[ &nbsp;5] &nbsp;0.0- 5.0 sec &nbsp;56.4 MBytes &nbsp;11.3 MBytes/sec</font></div><div><font size="2"   >[ &nbsp;6] &nbsp;0.0- 5.0 sec &nbsp;50.6 MBytes &nbsp;10.1 MBytes/sec</font></div><div><font size="2"   >[ &nbsp;8] &nbsp;0.0- 5.0 sec &nbsp;43.6 MBytes &nbsp;8.72 MBytes/sec</font></div><div><font size="2"   >[ &nbsp;4] &nbsp;0.0- 5.0 sec &nbsp;52.4 MBytes &nbsp;10.5 MBytes/sec</font></div><div><font size="2"   >[ 10] &nbsp;0.0- 5.0 sec &nbsp;53.5 MBytes &nbsp;10.7 MBytes/sec</font></div><div><font size="2"   >[ 11] &nbsp;0.0- 5.0 sec &nbsp;50.0 MBytes &nbsp;10.0 MBytes/sec</font></div><div><font size="2"   >[ &nbsp;7] &nbsp;0.0- 5.0 sec &nbsp;53.0 MBytes &nbsp;10.6 MBytes/sec</font></div><div><font size="2"   >[ &nbsp;3] &nbsp;0.0- 5.0 sec &nbsp;55.4 MBytes &nbsp;11.1 MBytes/sec</font></div><div><font size="2"   >[ &nbsp;9] &nbsp;0.0- 5.0 sec &nbsp;56.0 MBytes &nbsp;11.2 MBytes/sec</font></div><div><font size="2"   >[SUM] &nbsp;0.0- 5.0 sec &nbsp; 518 MBytes &nbsp; 104 MBytes/sec</font></div><p></p></pre></div><div><br></div><div>所以如果我们使用单线程传输，tcp窗口的大小很关键。</div><div>Linux可以通过设置几个内核参数来设置默认的发送和接收窗口的大小。</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >net.ipv4.tcp_mem = 5794944 &nbsp; &nbsp; &nbsp;7726592 11589888</font></div><div><font size="2"   >net.ipv4.tcp_wmem = 4096 &nbsp; &nbsp; &nbsp; &nbsp;16384 &nbsp; 4194304</font></div><div><font size="2"   >net.ipv4.tcp_rmem = 4096 &nbsp; &nbsp; &nbsp; &nbsp;87380 &nbsp; 4194304</font></div></div><div><font size="2"   >net.ipv4.tcp_window_scaling = 1</font></div><p></p></pre></div><div>man tcp</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;tcp_rmem (since Linux 2.4)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; This &nbsp;is &nbsp;a &nbsp;vector &nbsp;of &nbsp;3 &nbsp;integers: [min, default, max]. &nbsp;These parameters are used by TCP to regulate</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; receive buffer sizes. &nbsp;TCP dynamically adjusts the size of the receive buffer from the &nbsp;defaults &nbsp;listed</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; below, in the range of these values, depending on memory available in the system.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; min &nbsp; &nbsp; &nbsp; minimum &nbsp;size &nbsp;of the receive buffer used by each TCP socket. &nbsp;The default value is the system</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; page size. &nbsp;(On Linux 2.4, the default value is 4K, lowered to PAGE_SIZE bytes &nbsp;in &nbsp;low-memory</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; systems.) &nbsp; This &nbsp;value is used to ensure that in memory pressure mode, allocations below this</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size will still succeed. &nbsp;This is not used to bound the size of the &nbsp;receive &nbsp;buffer &nbsp;declared</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; using SO_RCVBUF on a socket.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default &nbsp; the &nbsp;default &nbsp;size &nbsp;of the receive buffer for a TCP socket. &nbsp;This value overwrites the initial</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default buffer size from the generic global net.core.rmem_default defined for &nbsp;all &nbsp;protocols.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The &nbsp;default value is 87380 bytes. &nbsp;(On Linux 2.4, this will be lowered to 43689 in low-memory</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; systems.) &nbsp;If larger receive buffer sizes are desired, this &nbsp;value &nbsp;should &nbsp;be &nbsp;increased &nbsp;(to</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; affect &nbsp;all &nbsp;sockets). &nbsp; To &nbsp;employ large TCP windows, the net.ipv4.tcp_window_scaling must be</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; enabled (default).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; max &nbsp; &nbsp; &nbsp; the maximum size of the receive buffer used by each TCP socket. &nbsp;This value does not &nbsp;override</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the &nbsp;global &nbsp;net.core.rmem_max. &nbsp; This &nbsp;is &nbsp;not &nbsp;used &nbsp;to limit the size of the receive buffer</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; declared using SO_RCVBUF on a socket. &nbsp;The default value is calculated using the formula</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; max(87380, min(4MB, tcp_mem[1]*PAGE_SIZE/128))</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (On Linux 2.4, the default is 87380*2 bytes, lowered to 87380 in low-memory systems).</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;tcp_window_scaling (Boolean; default: enabled; since Linux 2.2)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable RFC 1323 TCP window scaling. &nbsp;This feature allows the use of a large window (&gt; 64K) on a TCP con-</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nection, &nbsp;should &nbsp;the &nbsp;other end support it. &nbsp;Normally, the 16 bit window length field in the TCP header</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; limits the window size to less than 64K bytes. &nbsp;If larger windows are desired, applications can increase</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the &nbsp;size of their socket buffers and the window scaling option will be employed. &nbsp;If tcp_window_scaling</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is disabled, TCP will not negotiate the use of window scaling &nbsp;with &nbsp;the &nbsp;other &nbsp;end &nbsp;during &nbsp;connection</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setup.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;tcp_wmem (since Linux 2.4)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; This &nbsp;is a vector of 3 integers: [min, default, max]. &nbsp;These parameters are used by TCP to regulate send</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buffer sizes. &nbsp;TCP dynamically adjusts the size of the send buffer from the default values listed below,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in the range of these values, depending on memory available.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; min &nbsp; &nbsp; &nbsp; Minimum size of the send buffer used by each TCP socket. &nbsp;The default value is the system page</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size. &nbsp;(On Linux 2.4, the default value is 4K bytes.) &nbsp;This value is used to &nbsp;ensure &nbsp;that &nbsp;in</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memory &nbsp;pressure &nbsp;mode, &nbsp;allocations &nbsp;below this size will still succeed. &nbsp;This is not used to</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bound the size of the send buffer declared using SO_SNDBUF on a socket.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default &nbsp; The default size of the send buffer for a TCP &nbsp;socket. &nbsp; This &nbsp;value &nbsp;overwrites &nbsp;the &nbsp;initial</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default &nbsp;buffer &nbsp;size from the generic global net.core.wmem_default defined for all protocols.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The default value is 16K bytes. &nbsp;If larger send buffer sizes are desired, this value should be</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; increased &nbsp; &nbsp;(to &nbsp; &nbsp;affect &nbsp; &nbsp;all &nbsp; &nbsp;sockets). &nbsp; &nbsp; To &nbsp; &nbsp;employ &nbsp; large &nbsp; TCP &nbsp; windows, &nbsp; the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /proc/sys/net/ipv4/tcp_window_scaling must be set to a non-zero value (default).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; max &nbsp; &nbsp; &nbsp; The maximum size of the send buffer used by each TCP socket. &nbsp;This value does not override the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value &nbsp;in &nbsp;/proc/sys/net/core/wmem_max. &nbsp;This is not used to limit the size of the send buffer</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; declared using SO_SNDBUF on a socket. &nbsp;The default value is calculated using the formula</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; max(65536, min(4MB, tcp_mem[1]*PAGE_SIZE/128))</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (On Linux 2.4, the default value is 128K bytes, lowered 64K depending on low-memory &nbsp;systems.)</font></div></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1. man iperf</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >IPERF(1) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; User Manuals &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IPERF(1)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >NAME</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;iperf - perform network throughput tests</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SYNOPSIS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;iperf -s [ options ]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;iperf -c server [ options ]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;iperf -u -s [ options ]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;iperf -u -c server [ options ]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >DESCRIPTION</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;iperf &nbsp;is a tool for performing network throughput measurements. &nbsp;It can test either TCP or UDP throughput. &nbsp;To</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;perform an iperf test the user must establish both a server (to discard traffic) &nbsp;and &nbsp;a &nbsp;client &nbsp;(to &nbsp;generate</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;traffic).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >GENERAL OPTIONS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-f, --format</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [kmKM] &nbsp; format to report: Kbits, Mbits, KBytes, MBytes</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-h, --help</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print a help synopsis</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-i, --interval n</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pause n seconds between periodic bandwidth reports</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-l, --len n[KM]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set length read/write buffer to n (default 8 KB)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-m, --print_mss</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print TCP maximum segment size (MTU - TCP/IP header)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-o, --output &lt;filename&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; output the report or error message to this specified file</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-p, --port n</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set server port to listen on/connect to to n (default 5001)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-u, --udp</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; use UDP rather than TCP</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-w, --window n[KM]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TCP window size (socket buffer size)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-B, --bind &lt;host&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bind to &lt;host&gt;, an interface or multicast address</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-C, --compatibility</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for use with older versions does not sent extra msgs</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-M, --mss n</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set TCP maximum segment size (MTU - 40 bytes)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-N, --nodelay</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set TCP no delay, disabling Nagle’s Algorithm</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-v, --version</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print version information and quit</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-V, --IPv6Version</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set the domain to IPv6</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-x, --reportexclude</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [CDMSV] &nbsp; exclude C(connection) D(data) M(multicast) S(settings) V(server) reports</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-y, --reportstyle C|c</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if set to C or c report results as CSV (comma separated values)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SERVER SPECIFIC OPTIONS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-s, --server</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; run in server mode</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-U, --single_udp</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; run in single threaded UDP mode</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-D, --daemon</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; run the server as a daemon</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >CLIENT SPECIFIC OPTIONS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-b, --bandwidth n[KM]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set target bandwidth to n bits/sec (default 1 Mbit/sec). &nbsp;This setting requires UDP (-u).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-c, --client &lt;host&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; run in client mode, connecting to &lt;host&gt;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-d, --dualtest</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Do a bidirectional test simultaneously</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-n, --num n[KM]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; number of bytes to transmit (instead of -t)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-r, --tradeoff</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Do a bidirectional test individually</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-t, --time n</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time in seconds to transmit for (default 10 secs)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-F, --fileinput &lt;name&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; input the data to be transmitted from a file</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-I, --stdin</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; input the data to be transmitted from stdin</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-L, --listenport n</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port to recieve bidirectional tests back on</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-P, --parallel n</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; number of parallel client threads to run</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-T, --ttl n</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-to-live, for multicast (default 1)</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-Z, --linux-congestion &lt;algo&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set TCP congestion control algorithm (Linux only)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >ENVIRONMENT</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;TCP_WINDOW_SIZE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Controls the size of TCP buffers.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >DIAGNOSTICS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;This section needs to be filled in.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >BUGS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Exit statuses are inconsistent. &nbsp;The threading implementation is rather heinous.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >AUTHORS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Iperf was originally written by Mark Gates and Alex Warshavsky. &nbsp;Man page and maintence by Jon Dugan &lt;jdugan at</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;x1024 dot net&gt;. &nbsp;Other contributions from Ajay Tirumala, Jim Ferguson, Feng Qin, Kevin &nbsp;Gibbs, &nbsp;John &nbsp;Estabrook</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;&lt;jestabro &nbsp;at &nbsp;ncsa.uiuc.edu&gt;, Andrew Gallatin &lt;gallatin at gmail.com&gt;, Stephen Hemminger &lt;shemminger at linux-</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;foundation.org&gt;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SEE ALSO</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;http://iperf.sourceforge.net/</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >NLANR/DAST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;APRIL 2008 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IPERF(1)</font></div></div><p></p></pre></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="use iperf test network performance (tcp window  performance) - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>