<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL tuple output order & column output order</h2>
	<h5 id="">2012-03-22 11:09:08&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201222210555500/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>一、tuple output order</div>在大多数数据库中如果没有用order by指定数据返回的顺序, 返回的结果都是无序的, 甚至每次返回的结果顺序可能都不一样.<div>那么就算不一样其实也是有一些规律可循的.</div><div>1. 首先是, 我们想想一条SQL交给数据库执行的时候, 它是怎么scan的. 怎么SCAN直接影响输出的顺序. 怎么scan可以从执行计划中看出来.</div><div>2. 当tuple被更新后, PostgreSQL的做法是把原来的记录修改它的xmax, 然后<span style="line-height: 22px;"   >在free space map中找到一个空槽位,</span>新增一条TUPLE.</div><div>3. 可能还需要考虑其他因素.</div><div>来举个例子 :&nbsp;</div><div>创建测算表与索引:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; create table order_test ( id int ,username text );</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=&gt; create index idx_order_test_1 on order_test (id);</font></div><div><font size="2"   >CREATE INDEX</font></div><p></p></pre></div><div>插入测试数据 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; insert into order_test select generate_series(1,100000),'digoal';</font></div><div><font size="2"   >INSERT 0 100000</font></div><p></p></pre></div><div>测试查询结果的顺序 :&nbsp;</div><div>以下两次顺序是一样的,</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; ctid &nbsp;| &nbsp;id &nbsp;| username&nbsp;</font></div><div><font size="2"   >--------+------+----------</font></div><div><font size="2"   >&nbsp;(5,76) | 1001 | digoal</font></div><div><font size="2"   >&nbsp;(5,77) | 1002 | digoal</font></div><div><font size="2"   >&nbsp;(5,78) | 1003 | digoal</font></div><div><font size="2"   >&nbsp;(5,79) | 1004 | digoal</font></div><div><font size="2"   >&nbsp;(5,80) | 1005 | digoal</font></div><div><font size="2"   >&nbsp;(5,81) | 1006 | digoal</font></div><div><font size="2"   >&nbsp;(5,82) | 1007 | digoal</font></div><div><font size="2"   >&nbsp;(5,83) | 1008 | digoal</font></div><div><font size="2"   >(8 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; ctid &nbsp;| &nbsp;id &nbsp;| username&nbsp;</font></div><div><font size="2"   >--------+------+----------</font></div><div><font size="2"   >&nbsp;(5,76) | 1001 | digoal</font></div><div><font size="2"   >&nbsp;(5,77) | 1002 | digoal</font></div><div><font size="2"   >&nbsp;(5,78) | 1003 | digoal</font></div><div><font size="2"   >&nbsp;(5,79) | 1004 | digoal</font></div><div><font size="2"   >&nbsp;(5,80) | 1005 | digoal</font></div><div><font size="2"   >&nbsp;(5,81) | 1006 | digoal</font></div><div><font size="2"   >&nbsp;(5,82) | 1007 | digoal</font></div><div><font size="2"   >&nbsp;(5,83) | 1008 | digoal</font></div><div><font size="2"   >(8 rows)</font></div><p></p></pre></div><div>查看上次查询的执行计划 :&nbsp;</div><div>使用的是bitmap heap scan.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; explain select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >---------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Bitmap Heap Scan on order_test &nbsp;(cost=7.67..347.59 rows=333 width=42)</font></div><div><font size="2"   >&nbsp; &nbsp;Recheck Cond: ((id &gt; 1000) AND (id &lt; 1009))</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Bitmap Index Scan on idx_order_test_1 &nbsp;(cost=0.00..7.59 rows=333 width=0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: ((id &gt; 1000) AND (id &lt; 1009))</font></div><div><font size="2"   >(4 rows)</font></div><p></p></pre></div><div>接下来换成index_scan和seq_scan的执行计划继续查询 :</div><div><pre class="prettyprint"   ><div><font size="2"   >digoal=&gt; set enable_bitmapscan=off;</font></div><div><font size="2"   >SET</font></div><div><font size="2"   >digoal=&gt; explain select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >----------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Index Scan using idx_order_test_1 on order_test &nbsp;(cost=0.00..520.92 rows=333 width=42)</font></div><div><font size="2"   >&nbsp; &nbsp;Index Cond: ((id &gt; 1000) AND (id &lt; 1009))</font></div><div><font size="2"   >(2 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; ctid &nbsp;| &nbsp;id &nbsp;| username&nbsp;</font></div><div><font size="2"   >--------+------+----------</font></div><div><font size="2"   >&nbsp;(5,76) | 1001 | digoal</font></div><div><font size="2"   >&nbsp;(5,77) | 1002 | digoal</font></div><div><font size="2"   >&nbsp;(5,78) | 1003 | digoal</font></div><div><font size="2"   >&nbsp;(5,79) | 1004 | digoal</font></div><div><font size="2"   >&nbsp;(5,80) | 1005 | digoal</font></div><div><font size="2"   >&nbsp;(5,81) | 1006 | digoal</font></div><div><font size="2"   >&nbsp;(5,82) | 1007 | digoal</font></div><div><font size="2"   >&nbsp;(5,83) | 1008 | digoal</font></div><div><font size="2"   >(8 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; set enable_indexscan=off;<br>SET<br>digoal=&gt; explain select ctid,* from order_test where id&gt;1000 and id&lt;1009;<br>                           QUERY PLAN                           <br>----------------------------------------------------------------<br> Seq Scan on order_test  (cost=0.00..1539.14 rows=333 width=42)<br>   Filter: ((id &gt; 1000) AND (id &lt; 1009))<br>(2 rows)<br><br>digoal=&gt; select ctid,* from order_test where id&gt;1000 and id&lt;1009;<br>  ctid  |  id  | username <br>--------+------+----------<br> (5,76) | 1001 | digoal<br> (5,77) | 1002 | digoal<br> (5,78) | 1003 | digoal<br> (5,79) | 1004 | digoal<br> (5,80) | 1005 | digoal<br> (5,81) | 1006 | digoal<br> (5,82) | 1007 | digoal<br> (5,83) | 1008 | digoal<br>(8 rows)</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >返回的顺序还是一样的, 不要急.&nbsp;</span>接下来我更新一条记录再次查询 :&nbsp;</div><div>注意到这次的返回顺序就和SCAN方法有关了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; update order_test set username='DIGOAL' where id=1001;</font></div><div><font size="2"   >UPDATE 1</font></div><div><font size="2"   >digoal=&gt; explain select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >----------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Seq Scan on order_test &nbsp;(cost=0.00..1539.14 rows=333 width=42)</font></div><div><font size="2"   >&nbsp; &nbsp;Filter: ((id &gt; 1000) AND (id &lt; 1009))</font></div><div><font size="2"   >(2 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; &nbsp;ctid &nbsp; &nbsp;| &nbsp;id &nbsp;| username&nbsp;</font></div><div><font size="2"   >-----------+------+----------</font></div><div><font size="2"   >&nbsp;(5,77) &nbsp; &nbsp;| 1002 | digoal</font></div><div><font size="2"   >&nbsp;(5,78) &nbsp; &nbsp;| 1003 | digoal</font></div><div><font size="2"   >&nbsp;(5,79) &nbsp; &nbsp;| 1004 | digoal</font></div><div><font size="2"   >&nbsp;(5,80) &nbsp; &nbsp;| 1005 | digoal</font></div><div><font size="2"   >&nbsp;(5,81) &nbsp; &nbsp;| 1006 | digoal</font></div><div><font size="2"   >&nbsp;(5,82) &nbsp; &nbsp;| 1007 | digoal</font></div><div><font size="2"   >&nbsp;(5,83) &nbsp; &nbsp;| 1008 | digoal</font></div><div><font size="2"   >&nbsp;(540,101) | 1001 | DIGOAL</font></div><div><font size="2"   >(8 rows)</font></div><p></p></pre></div><div>seq_scan的扫描顺序以及返回结果的顺序显然和这条记录的物理存储的顺序有关系.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=&gt; set enable_indexscan=on;</font></div><div><font size="2"   >SET</font></div><div><font size="2"   >digoal=&gt; explain select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >----------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Index Scan using idx_order_test_1 on order_test &nbsp;(cost=0.00..520.92 rows=333 width=42)</font></div><div><font size="2"   >&nbsp; &nbsp;Index Cond: ((id &gt; 1000) AND (id &lt; 1009))</font></div><div><font size="2"   >(2 rows)</font></div></div><div><div><font size="2"   >digoal=&gt; select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; &nbsp;ctid &nbsp; &nbsp;| &nbsp;id &nbsp;| username&nbsp;</font></div><div><font size="2"   >-----------+------+----------</font></div><div><font size="2"   >&nbsp;(540,101) | 1001 | DIGOAL</font></div><div><font size="2"   >&nbsp;(5,77) &nbsp; &nbsp;| 1002 | digoal</font></div><div><font size="2"   >&nbsp;(5,78) &nbsp; &nbsp;| 1003 | digoal</font></div><div><font size="2"   >&nbsp;(5,79) &nbsp; &nbsp;| 1004 | digoal</font></div><div><font size="2"   >&nbsp;(5,80) &nbsp; &nbsp;| 1005 | digoal</font></div><div><font size="2"   >&nbsp;(5,81) &nbsp; &nbsp;| 1006 | digoal</font></div><div><font size="2"   >&nbsp;(5,82) &nbsp; &nbsp;| 1007 | digoal</font></div><div><font size="2"   >&nbsp;(5,83) &nbsp; &nbsp;| 1008 | digoal</font></div><div><font size="2"   >(8 rows)</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"   >index_scan的扫描顺序以及返回结果的顺序显然和index的存储结构和扫描顺序有关系, 它是按照index的值顺序扫描的.</span> </div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; set enable_bitmapscan=on;</font></div><div><font size="2"   >SET</font></div><div><font size="2"   >digoal=&gt; explain select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >---------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Bitmap Heap Scan on order_test &nbsp;(cost=7.67..347.59 rows=333 width=42)</font></div><div><font size="2"   >&nbsp; &nbsp;Recheck Cond: ((id &gt; 1000) AND (id &lt; 1009))</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Bitmap Index Scan on idx_order_test_1 &nbsp;(cost=0.00..7.59 rows=333 width=0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: ((id &gt; 1000) AND (id &lt; 1009))</font></div><div><font size="2"   >(4 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; select ctid,* from order_test where id&gt;1000 and id&lt;1009;</font></div><div><font size="2"   >&nbsp; &nbsp;ctid &nbsp; &nbsp;| &nbsp;id &nbsp;| username&nbsp;</font></div><div><font size="2"   >-----------+------+----------</font></div><div><font size="2"   >&nbsp;(5,77) &nbsp; &nbsp;| 1002 | digoal</font></div><div><font size="2"   >&nbsp;(5,78) &nbsp; &nbsp;| 1003 | digoal</font></div><div><font size="2"   >&nbsp;(5,79) &nbsp; &nbsp;| 1004 | digoal</font></div><div><font size="2"   >&nbsp;(5,80) &nbsp; &nbsp;| 1005 | digoal</font></div><div><font size="2"   >&nbsp;(5,81) &nbsp; &nbsp;| 1006 | digoal</font></div><div><font size="2"   >&nbsp;(5,82) &nbsp; &nbsp;| 1007 | digoal</font></div><div><font size="2"   >&nbsp;(5,83) &nbsp; &nbsp;| 1008 | digoal</font></div><div><font size="2"   >&nbsp;(540,101) | 1001 | DIGOAL</font></div><div><font size="2"   >(8 rows)</font></div><p></p></pre></div><div>而bitmap scan的话, 是先从索引扫到所有的item, 然后按照item排序后再从heap table扫tuple输出, 所以是按照ctid排序输出的.</div><div><br></div><div>二、column output order</div><div>列的顺序基本上是固定的,&nbsp;</div><div>它的顺序取决于pg_attribute的attnum的值.</div><div><pre class="prettyprint"   ><div><font size="2"   >digoal=&gt; select * from pg_attribute where attrelid=(select oid from pg_class where relname='order_test');<br> attrelid | attname  | atttypid | attstattarget | attlen | attnum | attndims | attcacheoff | atttypmod | attbyval | attstorage | att<br>align | attnotnull | atthasdef | attisdropped | attislocal | attinhcount | attcollation | attacl | attoptions <br>----------+----------+----------+---------------+--------+--------+----------+-------------+-----------+----------+------------+----<br>------+------------+-----------+--------------+------------+-------------+--------------+--------+------------<br>    25285 | tableoid |       26 |             0 |      4 |     -7 |        0 |          -1 |        -1 | t        | p          | i  <br>      | t          | f         | f            | t          |           0 |            0 |        | <br>    25285 | cmax     |       29 |             0 |      4 |     -6 |        0 |          -1 |        -1 | t        | p          | i  <br>      | t          | f         | f            | t          |           0 |            0 |        | <br>    25285 | xmax     |       28 |             0 |      4 |     -5 |        0 |          -1 |        -1 | t        | p          | i  <br>      | t          | f         | f            | t          |           0 |            0 |        | <br>    25285 | cmin     |       29 |             0 |      4 |     -4 |        0 |          -1 |        -1 | t        | p          | i  <br>      | t          | f         | f            | t          |           0 |            0 |        | <br>    25285 | xmin     |       28 |             0 |      4 |     -3 |        0 |          -1 |        -1 | t        | p          | i  <br>      | t          | f         | f            | t          |           0 |            0 |        | <br>    25285 | ctid     |       27 |             0 |      6 |     -1 |        0 |          -1 |        -1 | f        | p          | s  <br>      | t          | f         | f            | t          |           0 |            0 |        | <br>    25285 | id       |       23 |            -1 |      4 |      1 |        0 |          -1 |        -1 | t        | p          | i  <br>      | f          | f         | f            | t          |           0 |            0 |        | <br>    25285 | username |       25 |            -1 |     -1 |      2 |        0 |          -1 |        -1 | f        | x          | i  <br>      | f          | f         | f            | t          |           0 |          100 |        | <br>(8 rows)</font></div><p></p></pre></div><div>直接调整attnum带来的后果 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# \d test</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Table "public.test"</font></div><div><font size="2"   >&nbsp; Column &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >----------+-----------------------------+-----------</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; &nbsp; | integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"   >&nbsp;crt_time | timestamp without time zone |&nbsp;</font></div><div><font size="2"   >&nbsp;info &nbsp; &nbsp; | text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >Indexes:</font></div><div><font size="2"   >&nbsp; &nbsp; "test_pkey" PRIMARY KEY, btree (id)</font></div><div><font size="2"   >&nbsp; &nbsp; "idx_test_crt_time" btree (crt_time)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# insert into test values (1,now(),'digoal');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >postgres=# select * from pg_attribute where attrelid='test'::regclass;</font></div><div><font size="2"   >&nbsp;attrelid | attname &nbsp;| atttypid | attstattarget | attlen | attnum | attndims | attcacheoff | atttypmod | attbyval | attstorage | att</font></div><div><font size="2"   >align | attnotnull | atthasdef | attisdropped | attislocal | attinhcount | attcollation | attacl | attoptions | attfdwoptions&nbsp;</font></div><div><font size="2"   >----------+----------+----------+---------------+--------+--------+----------+-------------+-----------+----------+------------+----</font></div><div><font size="2"   >------+------------+-----------+--------------+------------+-------------+--------------+--------+------------+---------------</font></div><div><font size="2"   >&nbsp; &nbsp; 24641 | tableoid | &nbsp; &nbsp; &nbsp; 26 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp;4 | &nbsp; &nbsp; -7 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | t &nbsp; &nbsp; &nbsp; &nbsp;| p &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 24641 | cmax &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; 29 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp;4 | &nbsp; &nbsp; -6 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | t &nbsp; &nbsp; &nbsp; &nbsp;| p &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 24641 | xmax &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; 28 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp;4 | &nbsp; &nbsp; -5 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | t &nbsp; &nbsp; &nbsp; &nbsp;| p &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 24641 | cmin &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; 29 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp;4 | &nbsp; &nbsp; -4 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | t &nbsp; &nbsp; &nbsp; &nbsp;| p &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 24641 | xmin &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; 28 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp;4 | &nbsp; &nbsp; -3 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | t &nbsp; &nbsp; &nbsp; &nbsp;| p &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 24641 | ctid &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; 27 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp;6 | &nbsp; &nbsp; -1 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | f &nbsp; &nbsp; &nbsp; &nbsp;| p &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| s &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 24641 | id &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; 23 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp;4 | &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | t &nbsp; &nbsp; &nbsp; &nbsp;| p &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 24641 | crt_time | &nbsp; &nbsp; 1114 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp;8 | &nbsp; &nbsp; &nbsp;2 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | t &nbsp; &nbsp; &nbsp; &nbsp;| p &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| d &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; 24641 | info &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; 25 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; -1 | &nbsp; &nbsp; &nbsp;3 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | f &nbsp; &nbsp; &nbsp; &nbsp;| x &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >(9 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# update pg_attribute set attnum=4 where attrelid='test'::regclass and attname='crt_time';</font></div><div><font size="2"   >UPDATE 1</font></div><div><font size="2"   >postgres=# update pg_attribute set attnum=2 where attrelid='test'::regclass and attname='info';</font></div><div><font size="2"   >UPDATE 1</font></div><div><font size="2"   >postgres=# update pg_attribute set attnum=3 where attrelid='test'::regclass and attname='crt_time';</font></div><div><font size="2"   >UPDATE 1</font></div><div><font size="2"   >postgres=# \d test</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Table "public.test"</font></div><div><font size="2"   >&nbsp; Column &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >----------+-----------------------------+-----------</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; &nbsp; | integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"   >&nbsp;info &nbsp; &nbsp; | text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;crt_time | timestamp without time zone |&nbsp;</font></div><div><font size="2"   >Indexes:</font></div><div><font size="2"   >&nbsp; &nbsp; "test_pkey" PRIMARY KEY, btree (id)</font></div><div><font size="2"   >&nbsp; &nbsp; "idx_test_crt_time" btree (info timestamp_ops)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select * from test limit 1;</font></div><div><font size="2"   >ERROR: &nbsp;invalid memory alloc request size 18446744073709551613</font></div></pre></div><div>因为只调整了元数据, page中的数据还是按照原来的顺序存储的, 取出的时候由于数据类型不一致等原因都会导致错误.&nbsp;</div><div><br></div><div>【参考】</div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402010411115555401/"   >http://blog.163.com/digoal@126/blog/static/1638770402010411115555401/</a> </div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201112251058216/"   >http://blog.163.com/digoal@126/blog/static/163877040201112251058216/</a> </div><div>src/backend/access</div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL tuple output order  column output order - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>