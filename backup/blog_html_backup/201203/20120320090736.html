<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL extensions makefile : PGXS</h2>
	<h5 id="">2012-03-20 9:07:36&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020122208374396/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">今天一位同事问我有些PostgreSQL的插件为什么在make的时候要加PGXS=1, 不加就无法编译成功.<div>首先PGXS是干什么用的?</div><div>这个在手册的35.16. Extension Building Infrastructure有详细的介绍.</div><div>简单来说如果你写了一个PostgreSQL的Extension, 在发布的时候给它写一个轻便的build系统也是一件比较麻烦的事情.</div><div>PGXS提供了一套简单的Extension的build框架. 因此只需要按照PGXS提供的模板写一个简单的makefile就可以在一个已经安装好的PostgreSQL Server上编译你的Extension了.&nbsp;</div><div>需要注意的是PGXS并不是一个可以适用所有PostgreSQL相关软件的build框架, 复杂的软件还是需要自己写<span style="line-height: 22px;"  >build系统的.</span></div><div>【原文】</div><div><pre class="prettyprint"  ><p><font size="2"  >If you are thinking about distributing your PostgreSQL extension modules, setting up a portable build system for them can be fairly difficult. Therefore the PostgreSQL installation provides a build infrastructure for extensions, called PGXS, so that simple extension modules can be built simply against an already installed server. PGXS is mainly intended for extensions that include C code, although it can be used for pure-SQL extensions too. Note that PGXS is not intended to be a universal build system framework that can be used to build any software interfacing to PostgreSQL; it simply automates common build rules for simple server extension modules. For more complicated packages, you might need to write your own build system</font></p></pre></div><div>通过pg_config --pgxs可以查看模板文件的位置.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >pg_config --pgxs</font></div><div><font size="2"  >/opt/pgsql/lib/pgxs/src/makefiles/pgxs.mk</font></div><p></p></pre></div><div>它的内容如下 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  ># PGXS: PostgreSQL extensions makefile</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ># src/makefiles/pgxs.mk</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ># This file contains generic rules to build many kinds of simple</font></div><div><font size="2"  ># extension modules. &nbsp;You only need to set a few variables and include</font></div><div><font size="2"  ># this file, the rest will be done here.</font></div><div><font size="2"  >#</font></div><div><font size="2"  ># Use the following layout for your Makefile:</font></div><div><font size="2"  >#</font></div><div><font size="2"  ># &nbsp; [variable assignments, see below]</font></div><div><font size="2"  ># &nbsp; [custom rules, rarely necessary]</font></div><div><font size="2"  >#</font></div><div><font size="2"  ># &nbsp; PG_CONFIG = pg_config</font></div><div><font size="2"  ># &nbsp; PGXS := $(shell $(PG_CONFIG) --pgxs)</font></div><div><font size="2"  ># &nbsp; include $(PGXS)</font></div><div><font size="2"  >#</font></div><div><font size="2"  ># Set one of these three variables to specify what is built:</font></div><div><font size="2"  >#</font></div><div><font size="2"  ># &nbsp; MODULES -- list of shared-library objects to be built from source files</font></div><div><font size="2"  ># &nbsp; &nbsp; with same stem (do not include library suffixes in this list)</font></div><div><font size="2"  ># &nbsp; MODULE_big -- a shared library to build from multiple source files</font></div><div><font size="2"  ># &nbsp; &nbsp; (list object files in OBJS)</font></div><div><font size="2"  ># &nbsp; PROGRAM -- an executable program to build (list object files in OBJS)</font></div><div><font size="2"  >#</font></div><div><font size="2"  ># The following variables can also be set:</font></div><div><font size="2"  >#</font></div><div><font size="2"  ># &nbsp; EXTENSION -- name of extension (there must be a $EXTENSION.control file)</font></div><div><font size="2"  ># &nbsp; MODULEDIR -- subdirectory of $PREFIX/share into which DATA and DOCS files</font></div><div><font size="2"  ># &nbsp; &nbsp; should be installed (if not set, default is "extension" if EXTENSION</font></div><div><font size="2"  ># &nbsp; &nbsp; is set, or "contrib" if not)</font></div><div><font size="2"  ># &nbsp; DATA -- random files to install into $PREFIX/share/$MODULEDIR</font></div><div><font size="2"  ># &nbsp; DATA_built -- random files to install into $PREFIX/share/$MODULEDIR,</font></div><div><font size="2"  ># &nbsp; &nbsp; which need to be built first</font></div><div><font size="2"  ># &nbsp; DATA_TSEARCH -- random files to install into $PREFIX/share/tsearch_data</font></div><div><font size="2"  ># &nbsp; DOCS -- random files to install under $PREFIX/doc/$MODULEDIR</font></div><div><font size="2"  ># &nbsp; SCRIPTS -- script files (not binaries) to install into $PREFIX/bin</font></div><div><font size="2"  ># &nbsp; SCRIPTS_built -- script files (not binaries) to install into $PREFIX/bin,</font></div><div><font size="2"  ># &nbsp; &nbsp; which need to be built first</font></div><div><font size="2"  ># &nbsp; REGRESS -- list of regression test cases (without suffix)</font></div><div><font size="2"  ># &nbsp; REGRESS_OPTS -- additional switches to pass to pg_regress</font></div><div><font size="2"  ># &nbsp; EXTRA_CLEAN -- extra files to remove in 'make clean'</font></div><div><font size="2"  ># &nbsp; PG_CPPFLAGS -- will be added to CPPFLAGS</font></div><div><font size="2"  ># &nbsp; PG_LIBS -- will be added to PROGRAM link line</font></div><div><font size="2"  ># &nbsp; SHLIB_LINK -- will be added to MODULE_big link line</font></div><div><font size="2"  ># &nbsp; PG_CONFIG -- path to pg_config program for the PostgreSQL installation</font></div><div><font size="2"  ># &nbsp; &nbsp; to build against (typically just "pg_config" to use the first one in</font></div><div><font size="2"  ># &nbsp; &nbsp; your PATH)</font></div><div><font size="2"  >#</font></div><div><font size="2"  ># Better look at some of the existing uses for examples...</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifndef PGXS</font></div><div><font size="2"  >ifndef NO_PGXS</font></div><div><font size="2"  >$(error pgxs error: makefile variable PGXS or NO_PGXS must be set)</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >endif</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef PGXS</font></div><div><font size="2"  ># We assume that we are in src/makefiles/, so top is ...</font></div><div><font size="2"  >top_builddir := $(dir $(PGXS))../..</font></div><div><font size="2"  >include $(top_builddir)/src/Makefile.global</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >top_srcdir = $(top_builddir)</font></div><div><font size="2"  >srcdir = .</font></div><div><font size="2"  >VPATH =</font></div><div><font size="2"  >endif</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  >override CPPFLAGS := -I. -I$(srcdir) $(CPPFLAGS)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef MODULES</font></div><div><font size="2"  >override CFLAGS += $(CFLAGS_SL)</font></div><div><font size="2"  >endif</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef MODULEDIR</font></div><div><font size="2"  >datamoduledir := $(MODULEDIR)</font></div><div><font size="2"  >docmoduledir := $(MODULEDIR)</font></div><div><font size="2"  >else</font></div><div><font size="2"  >ifdef EXTENSION</font></div><div><font size="2"  >datamoduledir := extension</font></div><div><font size="2"  >docmoduledir := extension</font></div><div><font size="2"  >else</font></div><div><font size="2"  >datamoduledir := contrib</font></div><div><font size="2"  >docmoduledir := contrib</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >endif</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef PG_CPPFLAGS</font></div><div><font size="2"  >override CPPFLAGS := $(PG_CPPFLAGS) $(CPPFLAGS)</font></div><div><font size="2"  >endif</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >all: $(PROGRAM) $(DATA_built) $(SCRIPTS_built) $(addsuffix $(DLSUFFIX), $(MODULES)) $(addsuffix .control, $(EXTENSION))</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef MODULE_big</font></div><div><font size="2"  ># shared library parameters</font></div><div><font size="2"  >NAME = $(MODULE_big)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >include $(top_srcdir)/src/Makefile.shlib</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >all: all-lib</font></div><div><font size="2"  >endif # MODULE_big</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  >install: all installdirs</font></div><div><font size="2"  >ifneq (,$(EXTENSION))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_DATA) $(addprefix $(srcdir)/, $(addsuffix .control, $(EXTENSION))) '$(DESTDIR)$(datadir)/extension/'</font></div><div><font size="2"  >endif # EXTENSION</font></div><div><font size="2"  >ifneq (,$(DATA)$(DATA_built))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_DATA) $(addprefix $(srcdir)/, $(DATA)) $(DATA_built) '$(DESTDIR)$(datadir)/$(datamoduledir)/'</font></div><div><font size="2"  >endif # DATA</font></div><div><font size="2"  >ifneq (,$(DATA_TSEARCH))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_DATA) $(addprefix $(srcdir)/, $(DATA_TSEARCH)) '$(DESTDIR)$(datadir)/tsearch_data/'</font></div><div><font size="2"  >endif # DATA_TSEARCH</font></div><div><font size="2"  >ifdef MODULES</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_SHLIB) $(addsuffix $(DLSUFFIX), $(MODULES)) '$(DESTDIR)$(pkglibdir)/'</font></div><div><font size="2"  >endif # MODULES</font></div><div><font size="2"  >ifdef DOCS</font></div><div><font size="2"  >ifdef docdir</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_DATA) $(addprefix $(srcdir)/, $(DOCS)) '$(DESTDIR)$(docdir)/$(docmoduledir)/'</font></div><div><font size="2"  >endif # docdir</font></div><div><font size="2"  >endif # DOCS</font></div><div><font size="2"  >ifdef PROGRAM</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_PROGRAM) $(PROGRAM)$(X) '$(DESTDIR)$(bindir)'</font></div><div><font size="2"  >endif # PROGRAM</font></div><div><font size="2"  >ifdef SCRIPTS</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_SCRIPT) $(addprefix $(srcdir)/, $(SCRIPTS)) '$(DESTDIR)$(bindir)/'</font></div><div><font size="2"  >endif # SCRIPTS</font></div><div><font size="2"  >ifdef SCRIPTS_built</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_SCRIPT) $(SCRIPTS_built) '$(DESTDIR)$(bindir)/'</font></div><div><font size="2"  >endif # SCRIPTS_built</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef MODULE_big</font></div><div><font size="2"  >install: install-lib</font></div><div><font size="2"  >endif # MODULE_big</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  >installdirs:</font></div><div><font size="2"  >ifneq (,$(DATA)$(DATA_built))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(MKDIR_P) '$(DESTDIR)$(datadir)/$(datamoduledir)'</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifneq (,$(DATA_TSEARCH))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(MKDIR_P) '$(DESTDIR)$(datadir)/tsearch_data'</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifneq (,$(MODULES))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(MKDIR_P) '$(DESTDIR)$(pkglibdir)'</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef DOCS</font></div><div><font size="2"  >ifdef docdir</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(MKDIR_P) '$(DESTDIR)$(docdir)/$(docmoduledir)'</font></div><div><font size="2"  >endif # docdir</font></div><div><font size="2"  >endif # DOCS</font></div><div><font size="2"  >ifneq (,$(PROGRAM)$(SCRIPTS)$(SCRIPTS_built))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(MKDIR_P) '$(DESTDIR)$(bindir)'</font></div><div><font size="2"  >endif</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef MODULE_big</font></div><div><font size="2"  >installdirs: installdirs-lib</font></div><div><font size="2"  >endif # MODULE_big</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  >uninstall:</font></div><div><font size="2"  >ifneq (,$(EXTENSION))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(addprefix '$(DESTDIR)$(datadir)/extension'/, $(notdir $(addsuffix .control, $(EXTENSION))))</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifneq (,$(DATA)$(DATA_built))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(addprefix '$(DESTDIR)$(datadir)/$(datamoduledir)'/, $(notdir $(DATA) $(DATA_built)))</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifneq (,$(DATA_TSEARCH))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(addprefix '$(DESTDIR)$(datadir)/tsearch_data'/, $(notdir $(DATA_TSEARCH)))</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef MODULES</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(addprefix '$(DESTDIR)$(pkglibdir)'/, $(addsuffix $(DLSUFFIX), $(MODULES)))</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef DOCS</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(addprefix '$(DESTDIR)$(docdir)/$(docmoduledir)'/, $(DOCS))</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef PROGRAM</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f '$(DESTDIR)$(bindir)/$(PROGRAM)$(X)'</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef SCRIPTS</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(addprefix '$(DESTDIR)$(bindir)'/, $(SCRIPTS))</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef SCRIPTS_built</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(addprefix '$(DESTDIR)$(bindir)'/, $(SCRIPTS_built))</font></div><div><font size="2"  >endif</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef MODULE_big</font></div><div><font size="2"  >uninstall: uninstall-lib</font></div><div><font size="2"  >endif # MODULE_big</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  >clean:</font></div><div><font size="2"  >ifdef MODULES</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(addsuffix $(DLSUFFIX), $(MODULES)) $(addsuffix .o, $(MODULES))</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef DATA_built</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(DATA_built)</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef SCRIPTS_built</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(SCRIPTS_built)</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef PROGRAM</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(PROGRAM)$(X)</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef OBJS</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(OBJS)</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef EXTRA_CLEAN</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f $(EXTRA_CLEAN)</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >ifdef REGRESS</font></div><div><font size="2"  ># things created by various check targets</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -rf $(pg_regress_clean_files)</font></div><div><font size="2"  >ifeq ($(PORTNAME), win)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; rm -f regress.def</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >endif # REGRESS</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef MODULE_big</font></div><div><font size="2"  >clean: clean-lib</font></div><div><font size="2"  >endif</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >distclean maintainer-clean: clean</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef REGRESS</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ># Select database to use for running the tests</font></div><div><font size="2"  >REGRESS_OPTS += --dbname=$(CONTRIB_TESTDB)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ># where to find psql for running the tests</font></div><div><font size="2"  >PSQLDIR = $(bindir)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ># When doing a VPATH build, must copy over the data files so that the</font></div><div><font size="2"  ># driver script can find them. &nbsp;We have to use an absolute path for</font></div><div><font size="2"  ># the targets, because otherwise make will try to locate the missing</font></div><div><font size="2"  ># files using VPATH, and will find them in $(srcdir), but the point</font></div><div><font size="2"  ># here is that we want to copy them from $(srcdir) to the build</font></div><div><font size="2"  ># directory.</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef VPATH</font></div><div><font size="2"  >abs_builddir := $(shell pwd)</font></div><div><font size="2"  >test_files_src := $(wildcard $(srcdir)/data/*.data)</font></div><div><font size="2"  >test_files_build := $(patsubst $(srcdir)/%, $(abs_builddir)/%, $(test_files_src))</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >all: $(test_files_build)</font></div><div><font size="2"  >$(test_files_build): $(abs_builddir)/%: $(srcdir)/%</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; ln -s $&lt; $@</font></div><div><font size="2"  >endif # VPATH</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >.PHONY: submake</font></div><div><font size="2"  >submake:</font></div><div><font size="2"  >ifndef PGXS</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(MAKE) -C $(top_builddir)/src/test/regress pg_regress$(X)</font></div><div><font size="2"  >endif</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ># against installed postmaster</font></div><div><font size="2"  >installcheck: submake</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(pg_regress_installcheck) $(REGRESS_OPTS) $(REGRESS)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef PGXS</font></div><div><font size="2"  >check:</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; @echo '"$(MAKE) check" is not supported.'</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; @echo 'Do "$(MAKE) install", then "$(MAKE) installcheck" instead.'</font></div><div><font size="2"  >else</font></div><div><font size="2"  >check: all submake</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(pg_regress_check) --extra-install=$(subdir) $(REGRESS_OPTS) $(REGRESS)</font></div><div><font size="2"  >endif</font></div><div><font size="2"  >endif # REGRESS</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  ># STANDARD RULES</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifneq (,$(MODULES)$(MODULE_big))</font></div><div><font size="2"  >%.sql: %.sql.in</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; sed 's,MODULE_PATHNAME,$$libdir/$*,g' $&lt; &gt;$@</font></div><div><font size="2"  >endif</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef PROGRAM</font></div><div><font size="2"  >$(PROGRAM): $(OBJS)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; $(CC) $(CFLAGS) $(OBJS) $(PG_LIBS) $(LDFLAGS) $(LDFLAGS_EX) $(LIBS) -o $@</font></div><div><font size="2"  >endif</font></div><p></p></pre></div><div>一个实际的使用例子 :&nbsp;</div><div>postgresql-9.1.3/contrib/isn</div><div>cat Makefile&nbsp;</div><div><pre class="prettyprint"  ><div><font size="2"  ># contrib/isn/Makefile</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >MODULES = isn</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXTENSION = isn</font></div><div><font size="2"  >DATA = isn--1.0.sql isn--unpackaged--1.0.sql</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >ifdef USE_PGXS</font></div><div><font size="2"  >PG_CONFIG = pg_config</font></div><div><font size="2"  >PGXS := $(shell $(PG_CONFIG) --pgxs)</font></div><div><font size="2"  >include $(PGXS)</font></div><div><font size="2"  >else</font></div><div><font size="2"  >subdir = contrib/isn</font></div><div><font size="2"  >top_builddir = ../..</font></div><div><font size="2"  >include $(top_builddir)/src/Makefile.global</font></div><div><font size="2"  >include $(top_srcdir)/contrib/contrib-global.mk</font></div><div><font size="2"  >endif</font></div><p></p></pre></div><div>MODULES = isn</div><div>表示编译后会在以下目录生成isn.so文件.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >pg_config --libdir</font></div><div><font size="2"  >/opt/pgsql/lib</font></div><p></p></pre></div><div>EXTENSION = isn</div><div>这个是9.1的PGXS变量, 因此需要提供isn.control文件, 例如 :&nbsp;</div><div><div>less isn.control, 编译后会在</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  ># isn extension</font></div><div><font size="2"  >comment = 'data types for international product numbering standards'</font></div><div><font size="2"  >default_version = '1.0'</font></div><div><font size="2"  >module_pathname = '$libdir/isn'</font></div><div><font size="2"  >relocatable = true</font></div><p></p></pre></div></div><div>DATA提供的sql和isn.control会拷贝到$PGHOME/share/extension目录.</div><div>最后面的是指出PGXS在什么地方, include它已经另外几个依赖的makefile.</div><div><br></div><div>其他的例子如PostGIS, 更加复杂.</div><div><br></div><div>【参考】</div><div><a rel="nofollow" href="http://www.postgresql.org/docs/current/static/extend-pgxs.html"  >http://www.postgresql.org/docs/current/static/extend-pgxs.html</a>&nbsp;</div><div>src/makefiles/pgxs.mk</div></div>
	</div>
</div>
</body>
</html>