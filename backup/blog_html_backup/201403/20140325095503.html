<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.4 new data type jsonb - do not need to reparser when used</h2>
	<h5 id="">2014-03-25 9:55:03&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201422594410975/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div style="font-family: sans-serif; font-size: small; line-height: normal;"   ><a style="color: rgb(0, 0, 0); display: block; padding: 6px 8px; font-weight: bold; background-color: rgb(217, 216, 209); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=d9134d0a355cfa447adc80db4505d5931084278a"   >Introduce jsonb, a structured format for storing json.</a></div><div style="padding: 6px 0px; border-style: solid; border-color: rgb(217, 216, 209); border-width: 0px 0px 1px; font-family: monospace; line-height: normal;"   ><table style="padding: 8px 4px; border-spacing: 0px;"   ><tbody><tr><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   >author</td><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   ><a title="Search for commits authored by Andrew Dunstan" style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=search;h=d9134d0a355cfa447adc80db4505d5931084278a;s=Andrew+Dunstan;st=author"   >Andrew Dunstan</a>&nbsp;<a title="Search for commits authored by andrew@dunslane.net" style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=search;h=d9134d0a355cfa447adc80db4505d5931084278a;s=andrew@dunslane.net;st=author"   >&lt;andrew@dunslane.net&gt;</a></td><td rowspan="2"   style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   ></td></tr><tr><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   ></td><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   >Sun, 23 Mar 2014 20:40:19 +0000 (16:40 -0400)</td></tr><tr><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   >committer</td><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   ><a title="Search for commits committed by Andrew Dunstan" style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=search;h=d9134d0a355cfa447adc80db4505d5931084278a;s=Andrew+Dunstan;st=committer"   >Andrew Dunstan</a>&nbsp;<a title="Search for commits committed by andrew@dunslane.net" style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=search;h=d9134d0a355cfa447adc80db4505d5931084278a;s=andrew@dunslane.net;st=committer"   >&lt;andrew@dunslane.net&gt;</a></td><td rowspan="2"   style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   ></td></tr><tr><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   ></td><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   >Sun, 23 Mar 2014 20:40:19 +0000 (16:40 -0400)</td></tr><tr><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   >commit</td><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   >d9134d0a355cfa447adc80db4505d5931084278a</td></tr><tr><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   >tree</td><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   ><a style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=tree;h=cefe155d0f0f71b9279444a86eab4b1b1facafdb;hb=d9134d0a355cfa447adc80db4505d5931084278a"   >cefe155d0f0f71b9279444a86eab4b1b1facafdb</a></td><td style="padding: 2px 5px; font-size: 10.909090995788574px; vertical-align: top; font-family: sans-serif;"   ><a style="color: rgb(136, 0, 0);" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=tree;h=cefe155d0f0f71b9279444a86eab4b1b1facafdb;hb=d9134d0a355cfa447adc80db4505d5931084278a"   >tree</a>&nbsp;|&nbsp;<a title="in format: tar.gz" style="color: rgb(136, 0, 0);" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=snapshot;h=d9134d0a355cfa447adc80db4505d5931084278a;sf=tgz"   >snapshot</a></td></tr><tr><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   >parent</td><td style="padding: 2px 5px; font-size: 11.818181991577148px; vertical-align: top;"   ><a style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=b2b2491b06074e68fc7c96148cb0fdf0c8eb0469"   >b2b2491b06074e68fc7c96148cb0fdf0c8eb0469</a></td><td style="padding: 2px 5px; font-size: 10.909090995788574px; vertical-align: top; font-family: sans-serif;"   ><a style="color: rgb(136, 0, 0);" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=b2b2491b06074e68fc7c96148cb0fdf0c8eb0469"   >commit</a>&nbsp;|&nbsp;<a style="color: rgb(136, 0, 0);" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=d9134d0a355cfa447adc80db4505d5931084278a;hp=b2b2491b06074e68fc7c96148cb0fdf0c8eb0469"   >diff</a></td></tr></table></div><div style="padding: 8px; font-family: monospace; line-height: normal;"   >Introduce&nbsp;jsonb,&nbsp;a&nbsp;structured&nbsp;format&nbsp;for&nbsp;storing&nbsp;json.<br><br>The&nbsp;new&nbsp;format&nbsp;accepts&nbsp;exactly&nbsp;the&nbsp;same&nbsp;data&nbsp;as&nbsp;the&nbsp;json&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is<br>stored&nbsp;in&nbsp;a&nbsp;format&nbsp;that&nbsp;does&nbsp;not&nbsp;require&nbsp;reparsing&nbsp;the&nbsp;orgiginal&nbsp;text&nbsp;in&nbsp;order<br>to&nbsp;process&nbsp;it,&nbsp;making&nbsp;it&nbsp;much&nbsp;more&nbsp;suitable&nbsp;for&nbsp;indexing&nbsp;and&nbsp;other&nbsp;operations.<br>Insignificant&nbsp;whitespace&nbsp;is&nbsp;discarded,&nbsp;and&nbsp;the&nbsp;order&nbsp;of&nbsp;object&nbsp;keys&nbsp;is&nbsp;not<br>preserved.&nbsp;Neither&nbsp;are&nbsp;duplicate&nbsp;object&nbsp;keys&nbsp;kept&nbsp;-&nbsp;the&nbsp;later&nbsp;value&nbsp;for&nbsp;a&nbsp;given<br>key&nbsp;is&nbsp;the&nbsp;only&nbsp;one&nbsp;stored.<br><br>The&nbsp;new&nbsp;type&nbsp;has&nbsp;all&nbsp;the&nbsp;functions&nbsp;and&nbsp;operators&nbsp;that&nbsp;the&nbsp;json&nbsp;type&nbsp;has,<br>with&nbsp;the&nbsp;exception&nbsp;of&nbsp;the&nbsp;json&nbsp;generation&nbsp;functions&nbsp;(to_json,&nbsp;json_agg&nbsp;etc.)<br>and&nbsp;with&nbsp;identical&nbsp;semantics.&nbsp;In&nbsp;addition,&nbsp;there&nbsp;are&nbsp;operator&nbsp;classes&nbsp;for<br>hash&nbsp;and&nbsp;btree&nbsp;indexing,&nbsp;and&nbsp;two&nbsp;classes&nbsp;for&nbsp;GIN&nbsp;indexing,&nbsp;that&nbsp;have&nbsp;no<br>equivalent&nbsp;in&nbsp;the&nbsp;json&nbsp;type.<br><br>This&nbsp;feature&nbsp;grew&nbsp;out&nbsp;of&nbsp;previous&nbsp;work&nbsp;by&nbsp;Oleg&nbsp;Bartunov&nbsp;and&nbsp;Teodor&nbsp;Sigaev,&nbsp;which<br>was&nbsp;intended&nbsp;to&nbsp;provide&nbsp;similar&nbsp;facilities&nbsp;to&nbsp;a&nbsp;nested&nbsp;hstore&nbsp;type,&nbsp;but&nbsp;which<br>in&nbsp;the&nbsp;end&nbsp;proved&nbsp;to&nbsp;have&nbsp;some&nbsp;significant&nbsp;compatibility&nbsp;issues.<br><br>Authors:&nbsp;Oleg&nbsp;Bartunov,&nbsp;&nbsp;Teodor&nbsp;Sigaev,&nbsp;Peter&nbsp;Geoghegan&nbsp;and&nbsp;Andrew&nbsp;Dunstan.<br>Review:&nbsp;Andres&nbsp;Freund</div></div><div style="padding: 8px; font-family: monospace; line-height: normal;"   >jsonb类型和json的类型最主要的差别是, jsonb存储的是parser 后的类型, 而json 存储的是未parser的类型, 所以在使用上, jsonb更高效, 因为不需要reparser了. 而json类型在使用时需要reparse.&nbsp;</div><div style="padding: 8px; font-family: monospace; line-height: normal;"   >在写入效率上, jsonb 比 json略差, 因为有parser的开销.</div><div style="padding: 8px; font-family: monospace; line-height: normal;"   >同样的内容, 依据写法的不一, jsonb需要的存储空间也比json更小, 例如重复key的情况, jsonb仅存储最后一个key-value.&nbsp;</div><div style="padding: 8px; font-family: monospace; line-height: normal;"   >另一方面, jsonb不需要reparser所以在使用索引和操作符方面更加便利, 使用索引的@&gt;查询效率估计和mongoDB不相上下.</div><div style="padding: 8px; font-family: monospace; line-height: normal;"   >目前jsonb还有一些不足, 例如内嵌对象无法使用GIN索引 如.</div><div style="padding: 8px; font-family: monospace; line-height: normal;"   ><p style="font-size: 12px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >However, the index could not be used for queries like the following, due to the aforementioned nesting restriction:</p><pre style="font-size: 12px; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 1px solid rgb(207, 207, 207); padding: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow: auto; border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; background-color: rgb(247, 247, 247); line-height: normal;"   >SELECT jdoc-&gt;'guid', jdoc-&gt;'name' FROM api WHERE jdoc -&gt; 'tags' ? 'qui';
    </pre></div><div style="padding: 8px; font-family: monospace; line-height: normal;"   ><br></div><div style="padding: 8px; font-family: monospace; line-height: normal;"   ><span style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   >Great news: PostgreSQL introduced jsonb support, which is real data type with binary storage and indexing !</span><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><span style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   >This work is a confluence of two projects - our hstore and json, which were existed in PostgreSQL for years in somewhat incomplete forms - hstore (10 years old!) implements key-value storage with binary storage and indexing, while json - document storage implemented as a text. I and Teodor Sigaev have started working on nested hstore more than year ago with support of Engine Yard and got working prototype with everything document-oriented storage needed (see our presentations in Ottawa, 2013, Dublin, 2013,&nbsp;</span><a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 13px; vertical-align: baseline; color: rgb(205, 116, 105); text-decoration: none; font-family: Helvetica, Arial, sans-serif; line-height: 19.5px;" rel="nofollow" href="http://www.sai.msu.su/~megera/postgres/talks/"   >http://www.sai.msu.su/~megera/postg<wbr style="cursor: pointer;"   >res/talks/</a><span style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   >), which eventually happens to be binary storage for jsonb - a new data type, introduced by Andrew Dunstan, which has everything from json, but performs better, thanks to binary representation and indexing ! jsonb doesn't preserve an order of keys and keys are unique ( the last win). Later, we decided to leave hstore unchanged and moved all nesting stuff (binary storage and indexing) to PostgreSQL core in favor to jsonb, which is now is a diamond in the crown of PostgreSQL 9.4. Peter Geoghegan has joined the project and did the last push to the jsonb, which was great, since we were already tired and get bored with long and killimg work. Andrew forgot to say, that Alexander Korotkov introduced an elegant hash opclass for GIN, which competes with MongoDB performance in contains operator (see our presentation in Dublin). Also, I'd mention David Wheeler, who supported us in nested hstore project, Josh Berkus, who actually was a jsonb driver and shaked me and Teodor in the middle of russian long NY holidays. Andres Freund criticized the code, which is very necessary in such a complex project.</span><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><span style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   >Jsonb has several missing useful features (from nested hstore), but that could be added later as an extension.</span><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><span style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   >I hope all database people understand, what that project mean for PostgreSQL - 99.9% percent of projects don't need MongoDB and could be nicely implemented in relational model. Now, PostgreSQL (AFAIK, the first considerable RDBMS) introduced the real support for semi-structured data, which are common in nowaday world.</span><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><span style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   >For historical reason, we saved our nested hstore (hstore v2.0) in separate repository (</span><a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; font-size: 13px; vertical-align: baseline; color: rgb(205, 116, 105); text-decoration: none; font-family: Helvetica, Arial, sans-serif; line-height: 19.5px;" rel="nofollow" href="http://www.sigaev.ru/git/gitweb.cgi?p=hstore.git;a=summary"   >http://www.sigaev.ru/git/gitweb.cgi?p=h<wbr style="cursor: pointer;"   >store.git;a=summary</a><span style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   >).</span><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><span style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   >PS.</span><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><span style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   >I, Teodor and Alexander are working on better jsonb indexing. Hope, we'll have something to show at PGCon in Ottawa this year, stay tuned !</span><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><br style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   ><span style="color: rgb(113, 113, 113); font-family: Helvetica, Arial, sans-serif; font-size: 13px; line-height: 19.5px;"   >This is a screenshot of my message to Teodor Sigaev, which starts our nested hstore project.</span></div><div><br></div><div>这个差异在json和jsonb的输出和输入函数中可见一斑.</div><div>jsonb的输出</div><div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l37" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/jsonb.c;h=2fd87fc9e1afa95eebafcbd085f8597b272376ca;hb=HEAD#l37"   >  37</a> /*</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l38" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/jsonb.c;h=2fd87fc9e1afa95eebafcbd085f8597b272376ca;hb=HEAD#l38"   >  38</a> &nbsp;*&nbsp;jsonb&nbsp;type&nbsp;input&nbsp;function</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l39" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/jsonb.c;h=2fd87fc9e1afa95eebafcbd085f8597b272376ca;hb=HEAD#l39"   >  39</a> &nbsp;*/</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l40" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/jsonb.c;h=2fd87fc9e1afa95eebafcbd085f8597b272376ca;hb=HEAD#l40"   >  40</a> Datum</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l41" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/jsonb.c;h=2fd87fc9e1afa95eebafcbd085f8597b272376ca;hb=HEAD#l41"   >  41</a> jsonb_in(PG_FUNCTION_ARGS)</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l42" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/jsonb.c;h=2fd87fc9e1afa95eebafcbd085f8597b272376ca;hb=HEAD#l42"   >  42</a> {</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l43" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/jsonb.c;h=2fd87fc9e1afa95eebafcbd085f8597b272376ca;hb=HEAD#l43"   >  43</a> &nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*json&nbsp;=&nbsp;PG_GETARG_CSTRING(0);</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l44" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/jsonb.c;h=2fd87fc9e1afa95eebafcbd085f8597b272376ca;hb=HEAD#l44"   >  44</a> </div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l45" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/jsonb.c;h=2fd87fc9e1afa95eebafcbd085f8597b272376ca;hb=HEAD#l45"   >  45</a> &nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;jsonb_from_cstring(json,&nbsp;strlen(json));</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l46" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/jsonb.c;h=2fd87fc9e1afa95eebafcbd085f8597b272376ca;hb=HEAD#l46"   >  46</a> }</div></div><div><br></div><div>json的输出</div><div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l170" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l170"   > 170</a> /*</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l171" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l171"   > 171</a> &nbsp;*&nbsp;Input.</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l172" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l172"   > 172</a> &nbsp;*/</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l173" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l173"   > 173</a> Datum</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l174" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l174"   > 174</a> json_in(PG_FUNCTION_ARGS)</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l175" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l175"   > 175</a> {</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l176" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l176"   > 176</a> &nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*json&nbsp;=&nbsp;PG_GETARG_CSTRING(0);</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l177" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l177"   > 177</a> &nbsp;&nbsp;&nbsp;&nbsp;text&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*result&nbsp;=&nbsp;cstring_to_text(json);</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l178" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l178"   > 178</a> &nbsp;&nbsp;&nbsp;&nbsp;JsonLexContext&nbsp;*lex;</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l179" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l179"   > 179</a> </div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l180" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l180"   > 180</a> &nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;validate&nbsp;it&nbsp;*/</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l181" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l181"   > 181</a> &nbsp;&nbsp;&nbsp;&nbsp;lex&nbsp;=&nbsp;makeJsonLexContext(result,&nbsp;false);</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l182" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l182"   > 182</a> &nbsp;&nbsp;&nbsp;&nbsp;pg_parse_json(lex,&nbsp;&amp;nullSemAction);</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l183" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l183"   > 183</a> </div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l184" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l184"   > 184</a> &nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Internal&nbsp;representation&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;text,&nbsp;for&nbsp;now&nbsp;*/</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l185" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l185"   > 185</a> &nbsp;&nbsp;&nbsp;&nbsp;PG_RETURN_TEXT_P(result);</div><div style="font-family: monospace; font-size: small; white-space: pre; line-height: normal;"   ><a id="l186" style="color: rgb(153, 153, 153); text-decoration: none;" class="linenr" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/adt/json.c;h=a7364f30f847fd2f37c57c4512e19ea429c1078b;hb=HEAD#l186"   > 186</a> }</div></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=d9134d0a355cfa447adc80db4505d5931084278a"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=d9134d0a355cfa447adc80db4505d5931084278a</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/datatype-json.html#JSON-CONTAINMENT"   >http://www.postgresql.org/docs/devel/static/datatype-json.html#JSON-CONTAINMENT</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html"   >http://www.postgresql.org/docs/devel/static/functions-json.html</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-aggregate.html"   >http://www.postgresql.org/docs/devel/static/functions-aggregate.html</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/hstore.html"   >http://www.postgresql.org/docs/devel/static/hstore.html</a></div><div>6.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402012112832614918/"   >http://blog.163.com/digoal@126/blog/static/1638770402012112832614918/</a></div><div>7.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020121150212379/"   >http://blog.163.com/digoal@126/blog/static/16387704020121150212379/</a></div><div>8.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201321333759270/"   >http://blog.163.com/digoal@126/blog/static/163877040201321333759270/</a></div><div>9.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402013045395446/"   >http://blog.163.com/digoal@126/blog/static/1638770402013045395446/</a></div><div>10.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201341003544706/"   >http://blog.163.com/digoal@126/blog/static/163877040201341003544706/</a></div></div>
	</div>
</div>
</body>
</html>