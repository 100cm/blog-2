<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">pg_stats_reporter 2.0 usage</h2>
	<h5 id="">2014-03-05 13:04:07&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201425020982/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>接上一篇pg_statsinfo的文章,</div><div><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020142585616183/"   >http://blog.163.com/digoal@126/blog/static/16387704020142585616183/</a></div><div>本文讲一下图形化报表工具pg_stats_reporter的使用. 以CentOS 6.x x64为例.</div><div>安装依赖包 :&nbsp;</div><pre class="prettyprint"   ><p></p><div><font size="2"   >yum -y install httpd php php-pgsql php-intl php-cli</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >下载pg_stats_reporter的源码包</span></div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >wget&nbsp;http://pgfoundry.org/frs/download.php/3543/pg_stats_reporter-2.0.0.tar.gz</font></span></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >解压, 源码包的目录结构如图 :&nbsp;</span></div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >### &nbsp;Directory formation of source which was installed pg_stats_reporter &nbsp; ###</font></div><div style="line-height: 28px;"   ><font size="2"   >pg_stats_reporter</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;|</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;+- bin/ ...................... script which run on command line</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;|</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;+- html/</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;| &nbsp; &nbsp;|</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;| &nbsp; &nbsp;+- pg_stats_reporter/ ... script which run via HTTP server</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+- package/ ....... jQuery etc</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+- js/ ............ Javascripts for pg_stats_reporter</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+- css/ ........... CSS for pg_stats_reporter</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+- doc/ ........... manual of pg_stats_reporter</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;|</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp;+- pg_stats_reporter_lib/ .... configure files directory</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; |</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; +- module/ .............. php modules of pg_stats_reporter</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; |</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; +- template/ ............ template files</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; |</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; +- cache/ ............... configure file and cache files of Smarty</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; |</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; +- compiled/ ............ compiled files and template files of Smarty</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; |</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; +- message/ ............. language files</font></div><p></p></pre></div><div style="line-height: 28px;"   >安装步骤 :&nbsp;</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div><font size="2"   >$ su</font></div><div><font size="2"   ># tar xvfz pg_stats_reporter-2.0.0.tar.gz</font></div><div><font size="2"   ># cd&nbsp;<span style="line-height: 28px;"   >pg_stats_reporter</span></font></div><div><font size="2"   ># cp -r html/pg_stats_reporter /var/www/html</font></div><div><font size="2"   ># cp -r pg_stats_reporter_lib /var/www</font></div><div><font size="2"   ># cp bin/pg_stats_reporter /usr/local/bin</font></div><div><font size="2"   ># cd /var/www/pg_stats_reporter_lib</font></div><div><font size="2"   ># chown -R apache:apache cache compiled</font></div><p></p></pre></div><div style="line-height: 28px;"   >配置pg_stats_reporter</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div><font size="2"   ># cd /var/www/pg_stats_reporter_lib</font></div><div><font size="2"   ># cp pg_stats_reporter.ini.sample /etc/pg_stats_reporter.ini</font></div><div><font size="2"   ># cd /etc</font></div><div><font size="2"   ># vi pg_stats_reporter.ini</font></div><p></p></pre></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >;-------------------------------------</font></div><div><font size="2"   >; pg_stats_reporter configuration file</font></div><div><font size="2"   >;-------------------------------------</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >;-------------------------------------</font></div><div><font size="2"   >; global setting section</font></div><div><font size="2"   >;-------------------------------------</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[global_setting]</font></div><div><font size="2"   >install_directory = /var/www</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >;-------------------------------------</font></div><div><font size="2"   >; repository DB setting section</font></div><div><font size="2"   >;-------------------------------------</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[sample]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >;-------------------------------------</font></div><div><font size="2"   >; database connection</font></div><div><font size="2"   >;-------------------------------------</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >host = 172.16.3.39</font></div><div><font size="2"   >port = &nbsp;5432</font></div><div><font size="2"   >dbname = statsrepo</font></div><div><font size="2"   >username = statsrepo</font></div><div><font size="2"   >password = statsrepo</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >;-------------------------------------</font></div><div><font size="2"   >; report setting</font></div><div><font size="2"   >;-------------------------------------</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; --- Language Setting ---</font></div><div><font size="2"   >language = auto</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; --- Summary ---</font></div><div><font size="2"   >summary = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; --- Database System ---</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Database Statistics --</font></div><div><font size="2"   >database_statistics = true</font></div><div><font size="2"   >transaction_statistics = true</font></div><div><font size="2"   >database_size = true</font></div><div><font size="2"   >recovery_conflicts = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Instance Activity --</font></div><div><font size="2"   >wal_statistics = true</font></div><div><font size="2"   >instance_processes_ratio = true</font></div><div><font size="2"   >instance_processes = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; --- Operating System ---</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- OS Resource Usage --</font></div><div><font size="2"   >cpu_usage = true</font></div><div><font size="2"   >load_average = true</font></div><div><font size="2"   >io_usage = true</font></div><div><font size="2"   >memory_usage = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Disk Usage --</font></div><div><font size="2"   >disk_usage_per_tablespace = true</font></div><div><font size="2"   >disk_usage_per_table = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; --- SQL ---</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Notable Tables --</font></div><div><font size="2"   >heavily_updated_tables = true</font></div><div><font size="2"   >heavily_accessed_tables = true</font></div><div><font size="2"   >low_density_tables = true</font></div><div><font size="2"   >fragmented_tables = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Query Activity --</font></div><div><font size="2"   >functions = true</font></div><div><font size="2"   >statements = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Long Transactions --</font></div><div><font size="2"   >long_transactions = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Lock Conflicts --</font></div><div><font size="2"   >lock_conflicts = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; --- Operation Activity ---</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Checkpoint Activity --</font></div><div><font size="2"   >checkpoint_activity = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Autovacuum Activity --</font></div><div><font size="2"   >basic_statistics = true</font></div><div><font size="2"   >io_statistics = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Replication Activity --</font></div><div><font size="2"   >current_replication_status = true</font></div><div><font size="2"   >replication_delays = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; --- Information ---</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Schema Information --</font></div><div><font size="2"   >table = true</font></div><div><font size="2"   >index = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Setting Parameters --</font></div><div><font size="2"   >parameter = true</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >; -- Profiles --</font></div><div><font size="2"   >profiles = true</font></div><p></p></pre></div></div><div>启动httpd</div><pre class="prettyprint"   ><p></p><div><font size="2"   >service httpd restart</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >连接web :&nbsp;</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   >http://172.16.3.150/pg_stats_reporter/pg_stats_reporter.php</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >可以使用的php的参数举例如下 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >?repodb=sample&amp;instid=1&amp;begin=%272014-02-01%2000:00%27&amp;end=%272014-04-05%2000:00%27&amp;reload=1</font></div><div></div><p></p></pre></div><div>一个典型的WEB页面报告如下 :&nbsp;</div><div><div><img title="pg_stats_reporter 2.0 usage - 德哥@Digoal - PostgreSQL"   alt="pg_stats_reporter 2.0 usage - 德哥@Digoal - PostgreSQL"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/hflQshY3t8Yw8qOMcvqlcw==/4828984700548139860.png"   ></div><div>如图所示,</div><div>1. 创建新的报告</div><div>2. repo数据库按钮, 如果在/etc/pg_stats_reporter.ini中配置了多个repo的话, 这里将显示多个,&nbsp;</div><div>3. 该repo数据库中存储的instance信息, 例如一个repo中可以存储多个实例的snapshot信息.</div><div>4. 重载 /etc/pg_stats_reporter.ini 配置文件</div><div>5. SNAPSHOT的分类</div><div>6. 隐藏左边栏按钮</div><div>7. 帮助信息按钮</div><div>如果点了创建新的报告, 弹出如下对话框 :&nbsp;</div></div><div><div><img title="pg_stats_reporter 2.0 usage - 德哥@Digoal - PostgreSQL"   alt="pg_stats_reporter 2.0 usage - 德哥@Digoal - PostgreSQL"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/VbOWbRh3g9C0fEMbGntuqg==/3148297614609058236.png"   ></div>8,9输入需要生产报告的时间段.</div><div>10, 生成报告.</div><div>生成报告实际上是将一些参数传给php. 例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >http://172.16.3.150/pg_stats_reporter/pg_stats_reporter.php?repodb=sample&amp;instid=1&amp;begin=%272014-02-01%2000:00%27&amp;end=%272014-04-05%2000:00%27&amp;reload=1</font></div><div></div><p></p></pre></div><div>一个报告页面DEMO如下 :&nbsp;</div><div><a target="_blank" rel="nofollow" href="http://pgstatsinfo.projects.pgfoundry.org/files/report_sample.html"   >http://pgstatsinfo.projects.pgfoundry.org/files/report_sample.html</a></div><div><br></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020142585616183/"   >http://blog.163.com/digoal@126/blog/static/16387704020142585616183/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://pgstatsinfo.projects.pgfoundry.org/pg_stats_reporter.html"   >http://pgstatsinfo.projects.pgfoundry.org/pg_stats_reporter.html</a></div></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">xmarker - 2014-06-06 15:30:29</h5>
				<div>德哥，<span class="pln"  style=""  >php</span><span class="pun"  style=""  >-</span><span class="pln"  style=""  >intl这个包在系统iso里没有找到啊，为没装这个，然后装完pg_stats_reporter后，页面显示的都是html源码,这个是什么问题啊</span></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 xmarker - 2014-06-06 15:30:29</h5>
				<div style="width:600px;">我的是centos 6.x, 来自contrib repo.<div><div>[contrib]</div><div>name=CentOS-$releasever - Contrib</div><div>mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=contrib</div><div>#baseurl=http://mirror.centos.org/centos/$releasever/contrib/$basearch/</div><div>gpgcheck=0</div><div>enabled=1</div><div>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</div></div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">jack 回复 德哥@Digoal - 2014-06-06 15:30:29</h5>
				<div style="width:600px;">德哥,我安装后界面什么都看不到，&nbsp;HTTP 500 错误，怎么解决都不行？问题出在哪呀！</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 jack - 2014-06-06 15:30:29</h5>
				<div style="width:600px;">你看看http协议500是啥含义, 结合你的场景排查一下.</div>
			</div>
			<div id="">
				<h5 id="">FREYA - 2014-10-30 17:15:28</h5>
				<div><P>德哥，有上生产吗？</P></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 FREYA - 2014-10-30 17:15:28</h5>
				<div style="width:600px;">HI, 没有, 生成不用这个.</div>
			</div>
	</div>
</div>
</body>
</html>