<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL PITR THREE recovery target MODE: name,xid,time USE CASE - 2</h2>
	<h5 id="">2013-02-05 0:08:01&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013141100160/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >【接上一篇】 :&nbsp;</span></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020131410250983/"  >http://blog.163.com/digoal@126/blog/static/16387704020131410250983/</a></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><br></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >【9】</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >还原到第6个还原点,&nbsp;</span><span style="line-height: 22px;"  >recovery_target_inclusive = false</span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><pre class="prettyprint"  style="line-height: 22px;"  ><p style="line-height: 22px;"  ></p><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery.conf</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >restore_command = 'cp /data05/ocz/pgbak/arch/%f %p'</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_xid = '1698'</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_inclusive = false</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_timeline = 'latest'</font></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >pause_at_recovery_target = false</font></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >启动后,</font></span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# create extension pageinspect;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >CREATE EXTENSION</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;2 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | &nbsp; 8032 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;3 | (0,4) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1697 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(2 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1698 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(3 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from a;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+----------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:30:44.091741</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | 2013-02-04 15:31:19.57222</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | 2013-02-04 15:32:00.226317</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | 2013-02-04 15:34:35.589298</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from b;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+---------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:31:05.93215</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(1 row)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from c;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+----------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:31:34.491555</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | 2013-02-04 15:32:19.168515</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(2 rows)</font></div></div><p style="line-height: 22px;"  ></p></pre></div></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><br style="line-height: 22px;"  ></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >【10】</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >还原到第6个还原点,&nbsp;</span><span style="line-height: 22px;"  >recovery_target_inclusive = true</span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><pre class="prettyprint"  style="line-height: 22px;"  ><p style="line-height: 22px;"  ></p><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery.conf</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >restore_command = 'cp /data05/ocz/pgbak/arch/%f %p'</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_xid = '1698'</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_inclusive = true</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_timeline = 'latest'</font></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >pause_at_recovery_target = false</font></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >启动后,</font></span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# create extension pageinspect;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >CREATE EXTENSION</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;2 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | &nbsp; 8032 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;3 | (0,4) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1697 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(2 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1698 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(3 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from a;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+----------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:30:44.091741</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | 2013-02-04 15:31:19.57222</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | 2013-02-04 15:32:00.226317</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | 2013-02-04 15:34:35.589298</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from b;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+---------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:31:05.93215</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(1 row)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from c;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+----------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:31:34.491555</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | 2013-02-04 15:32:19.168515</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | 2013-02-04 15:35:18.284565</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(3 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;2 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | &nbsp; 8032 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;3 | (0,4) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1697 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(2 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1698 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(3 rows)</font></div></div><p style="line-height: 22px;"  ></p></pre></div></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><br style="line-height: 22px;"  ></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >【11】</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >还原到第7个还原点,&nbsp;</span><span style="line-height: 22px;"  >recovery_target_inclusive = false</span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><pre class="prettyprint"  style="line-height: 22px;"  ><p style="line-height: 22px;"  ></p><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery.conf</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >restore_command = 'cp /data05/ocz/pgbak/arch/%f %p'</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_xid = '1697'</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_inclusive = false</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_timeline = 'latest'</font></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >pause_at_recovery_target = false</font></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >启动后,</font></span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# create extension pageinspect;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >CREATE EXTENSION</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;2 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | &nbsp; 8032 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;3 | (0,4) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1697 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(2 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1698 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(3 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from a;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+----------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:30:44.091741</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | 2013-02-04 15:31:19.57222</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | 2013-02-04 15:32:00.226317</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | 2013-02-04 15:34:35.589298</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from b;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+---------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:31:05.93215</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(1 row)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from c;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+----------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:31:34.491555</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | 2013-02-04 15:32:19.168515</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | 2013-02-04 15:35:18.284565</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(3 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;2 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | &nbsp; 8032 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;3 | (0,4) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1697 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(2 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1698 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(3 rows)</font></div></div><p style="line-height: 22px;"  ></p></pre></div></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><br style="line-height: 22px;"  ></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >【12】</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >还原到第7个还原点,&nbsp;</span><span style="line-height: 22px;"  >recovery_target_inclusive = true</span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><pre class="prettyprint"  style="line-height: 22px;"  ><p style="line-height: 22px;"  ></p><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery.conf</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >restore_command = 'cp /data05/ocz/pgbak/arch/%f %p'</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_xid = '1697'</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_inclusive = true</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >recovery_target_timeline = 'latest'</font></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >pause_at_recovery_target = false</font></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >启动后,</font></span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# create extension pageinspect;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >CREATE EXTENSION</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;2 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | &nbsp; 8032 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;3 | (0,4) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1697 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(2 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1698 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(3 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from a;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+----------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:30:44.091741</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | 2013-02-04 15:31:19.57222</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | 2013-02-04 15:32:00.226317</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | 2013-02-04 15:34:35.589298</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from b;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+---------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:31:05.93215</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(1 row)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from c;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+----------------------------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | 2013-02-04 15:31:34.491555</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | 2013-02-04 15:32:19.168515</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | 2013-02-04 15:35:18.284565</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(3 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;2 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 4 | &nbsp; 8032 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;3 | (0,4) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(4 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1697 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(2 rows)</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1698 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >(3 rows)</font></div></div><p style="line-height: 22px;"  ></p></pre></div></div><div style="line-height: 22px;"  ><br></div><div><span style="line-height: 22px;"  >【时间</span>recovery_target_time<span style="line-height: 22px;"  >作为还原目标点】</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >说明 :&nbsp;</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >1. 注意前面提到的结束点在COMMIT, ABORT, RESTORE_NAME三种XlogRecord中选择。</span></div><div style="line-height: 22px;"  >2. 时间作为还原目标时, 也可以同时设置recovery_target_inclusive参数.</div><div><pre class="prettyprint"  ><div><font size="2"  >src/backend/access/transam/xlog.c</font></div><div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* There can be many transactions that share the same commit time, so</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* we stop after the last one, if we are inclusive, or stop at the</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* first one if we are exclusive</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (recoveryTargetInclusive)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stopsHere = (recordXtime &gt; recoveryTargetTime);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stopsHere = (recordXtime &gt;= recoveryTargetTime);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (stopsHere)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *includeThis = false;</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"  >3. 与</span>recovery_target_time进行比较的XLogRecord中的<span style="line-height: 22px;"  >时间来自以下数据结构的xact_time或者还原点的创建时间 :&nbsp;</span></div><div>src/include/access/xact.h</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >typedef struct xl_xact_commit_compact</font></div><div><font size="2"  >{</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; TimestampTz xact_time; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* time of commit */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nsubxacts; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* number of subtransaction XIDs */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; /* ARRAY OF COMMITTED SUBTRANSACTION XIDs FOLLOWS */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; TransactionId subxacts[1]; &nbsp; &nbsp; &nbsp;/* VARIABLE LENGTH ARRAY */</font></div><div><font size="2"  >} xl_xact_commit_compact;</font></div></div><div><div><font size="2"  >typedef struct xl_xact_commit</font></div><div><font size="2"  >{</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; TimestampTz xact_time; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* time of commit */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; uint32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;xinfo; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* info flags */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nrels; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* number of RelFileNodes */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nsubxacts; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* number of subtransaction XIDs */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nmsgs; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* number of shared inval msgs */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; Oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dbId; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* MyDatabaseId */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; Oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tsId; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* MyDatabaseTableSpace */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; /* Array of RelFileNode(s) to drop at commit */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; RelFileNode xnodes[1]; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* VARIABLE LENGTH ARRAY */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; /* ARRAY OF COMMITTED SUBTRANSACTION XIDs FOLLOWS */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; /* ARRAY OF SHARED INVALIDATION MESSAGES FOLLOWS */</font></div><div><font size="2"  >} xl_xact_commit;</font></div></div><div><div><font size="2"  >typedef struct xl_xact_abort</font></div><div><font size="2"  >{</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; TimestampTz xact_time; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* time of abort */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nrels; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* number of RelFileNodes */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nsubxacts; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* number of subtransaction XIDs */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; /* Array of RelFileNode(s) to drop at abort */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; RelFileNode xnodes[1]; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* VARIABLE LENGTH ARRAY */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; /* ARRAY OF ABORTED SUBTRANSACTION XIDs FOLLOWS */</font></div><div><font size="2"  >} xl_xact_abort;</font></div></div><p></p></pre></div><div>4. 创建还原点的时间记录在这里 :&nbsp;</div><div>src/backend/access/transam/xlog.c</div><div><pre class="prettyprint"  ><p></p><div><span style="line-height: 19px; font-size: small; font-family: Arial, Helvetica, sans-serif;"  >/* logs restore point */</span></div><div><div><font size="2"  >typedef struct xl_restore_point</font></div><div><font size="2"  >{</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; TimestampTz rp_time;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; char &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rp_name[MAXFNAMELEN];</font></div><div><font size="2"  >} xl_restore_point;</font></div></div><p></p></pre></div><div>5. 在recoveryStopsHere中为时间点还原准备的时间逻辑如下 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; if (record-&gt;xl_rmid == RM_XACT_ID &amp;&amp; record_info == XLOG_XACT_COMMIT_COMPACT)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xl_xact_commit_compact *recordXactCommitData;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recordXactCommitData = (xl_xact_commit_compact *) XLogRecGetData(record);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recordXtime = recordXactCommitData-&gt;xact_time;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; else if (record-&gt;xl_rmid == RM_XACT_ID &amp;&amp; record_info == XLOG_XACT_COMMIT)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xl_xact_commit *recordXactCommitData;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recordXactCommitData = (xl_xact_commit *) XLogRecGetData(record);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recordXtime = recordXactCommitData-&gt;xact_time;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; else if (record-&gt;xl_rmid == RM_XACT_ID &amp;&amp; record_info == XLOG_XACT_ABORT)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xl_xact_abort *recordXactAbortData;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recordXactAbortData = (xl_xact_abort *) XLogRecGetData(record);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recordXtime = recordXactAbortData-&gt;xact_time;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; else if (record-&gt;xl_rmid == RM_XLOG_ID &amp;&amp; record_info == XLOG_RESTORE_POINT)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xl_restore_point *recordRestorePointData;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recordRestorePointData = (xl_restore_point *) XLogRecGetData(record);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recordXtime = recordRestorePointData-&gt;rp_time;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strncpy(recordRPName, recordRestorePointData-&gt;rp_name, MAXFNAMELEN);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><p></p></pre></div><div><span style="line-height: 22px;"  >6.&nbsp;</span><span style="line-height: 22px;"  >同一个时间点可能有多个COMMIT, ABORT, 或者</span>pg_create_restore_point()创建的<span style="line-height: 22px;"  >还原点;</span></div><div><span style="line-height: 22px;"  >7. 因此, 结合以上描述 :&nbsp;</span></div><div><span style="line-height: 22px;"  >&nbsp; &nbsp; 当设置了</span><span style="line-height: 22px;"  >recovery_target_inclusive=true时, 将APPLY这个时间点上所有的COMMIT, ABORT或还原点的XlogRecord.</span></div><div><span style="line-height: 22px;"  >&nbsp; &nbsp;&nbsp;</span><span style="line-height: 22px;"  >当设置了</span><span style="line-height: 22px;"  >recovery_target_inclusive=false时, 将不会APPLY</span><span style="line-height: 22px;"  >这个时间点上的任何COMMIT, ABORT或还原点的XlogRecord.</span></div><div><span style="line-height: 22px;"  >换句话说, 只有当</span>recovery_target_time设置的时间点上有COMMIT,ABORT或者还原点时,&nbsp;<span style="line-height: 22px;"  >recovery_target_inclusive才有实际意义.</span></div><div><span style="line-height: 22px;"  >否则肯定是一直APPLY到下一次出现</span><span style="line-height: 22px;"  >COMMIT,ABORT或者还原点, 并且该XlogRecord不APPLY</span><span style="line-height: 22px;"  >.</span></div><div>8. 时间的格式为TimestampTz, 例如 : '2013-02-04 23:25:54.922891+08'</div><div>【测试1】 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >recovery.conf</font></div><div><div><font size="2"  >restore_command = 'cp /data05/ocz/pgbak/arch/%f %p'</font></div><div><font size="2"  >recovery_target_time = '2013-02-04 15:30:44.091741'</font></div><div><font size="2"  >recovery_target_inclusive = false</font></div><div><font size="2"  >recovery_target_timeline = 'latest'</font></div><div><font size="2"  >pause_at_recovery_target = false</font></div></div><div><font size="2"  >分析 :&nbsp;</font></div><div><font size="2"  ><span style="line-height: 22px;"  >2013-02-04 15:30:44.091741</span>这个时间点如果有ABORT, COMMIT, 或者还原点的XlogRecord信息. 那么因为设置了<span style="line-height: 22px;"  >recovery_target_inclusive = false. 所以</span><span style="line-height: 22px;"  >立刻停止.</span></font></div><div><font size="2"  ><span style="line-height: 22px;"  >这个时间点如果没有ABORT, COMMIT, 或者还原点的XlogRecord信息. 那么在APPLY到下一个</span><span style="line-height: 22px;"  >ABORT, COMMIT, 或者还原点的XlogRecord信息时停止。</span></font></div><div><font size="2"  >本例应该是停止在第一个还原点的XlogRecord位置. 并且不APPLY该XlogRecord数据块.</font></div><div><span style="line-height: 22px;"  ><font size="2"  >启动后,</font></span></div><div><div><font size="2"  >postgres=# create extension pageinspect;</font></div><div><font size="2"  >CREATE EXTENSION</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# select * from a;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >postgres=# select * from b;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >postgres=# select * from c;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div><br></div><div><div style="line-height: 22px;"  >【测试2】 :&nbsp;</div><div style="line-height: 22px;"  ><pre class="prettyprint"  ><p></p><div><div style="line-height: 22px;"  ><font size="2"  >recovery.conf</font></div><div><div><div><font size="2"  >restore_command = 'cp /data05/ocz/pgbak/arch/%f %p'</font></div><div><font size="2"  >recovery_target_time = '2013-02-04 15:32:00.226317'</font></div><div><font size="2"  >recovery_target_inclusive = false</font></div><div><font size="2"  >recovery_target_timeline = 'latest'</font></div><div><font size="2"  >pause_at_recovery_target = false</font></div></div></div><div style="line-height: 22px;"  ><font size="2"  >分析 :&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >本例应该是停止在第2个还原点的XlogRecord位置. 并且不APPLY该XlogRecord数据块.</font></div></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  >启动后,</font></span></div><div><div><font size="2"  >postgres=# create extension pageinspect;</font></div><div><font size="2"  >CREATE EXTENSION</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  >postgres=# select * from a;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >postgres=# select * from b;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >postgres=# select * from c;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(2 rows)</font></div></div><p></p></pre></div></div><div><br></div><div style="line-height: 22px;"  >【pause_at_recovery_target的使用场景】</div><div>上一篇提到了使用<span style="line-height: 22px;"  >pause_at_recovery_target后</span>recovery_target_inclusive将不起作用.</div><div>原因是先判断是否设置了pause, 如下 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >src/backend/access/transam/xlog.c</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* Have we reached our recovery target?</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (recoveryStopsHere(record, &amp;recoveryApply))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (recoveryPauseAtTarget)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SetRecoveryPause(true);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recoveryPausesHere();</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reachedStopPoint = true; &nbsp; &nbsp; &nbsp; &nbsp;/* see below */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; recoveryContinue = false;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Exit loop if we reached non-inclusive recovery target */</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!recoveryApply)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><p></p></pre></div><div style="line-height: 22px;"  >【验证测试】 :&nbsp;</div><div style="line-height: 22px;"  >选择上一篇的第二个还原点,&nbsp;<span style="line-height: 22px;"  >recovery_target_inclusive = true,&nbsp;</span><span style="line-height: 22px;"  >pause_at_recovery_target = true .</span></div><div><div>recovery.conf</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >restore_command = 'cp /data05/ocz/pgbak/arch/%f %p'</font></div><div><font size="2"  >recovery_target_xid = '1696'</font></div><div><font size="2"  >recovery_target_inclusive = true</font></div><div><font size="2"  >recovery_target_timeline = 'latest'</font></div><div><font size="2"  >pause_at_recovery_target = true</font></div><div><font size="2"  >启动后,&nbsp;</font></div></div><div><div><font size="2"  >digoal@db-172-16-3-150-&gt; psql</font></div><div><font size="2"  >psql (9.2.1)</font></div><div><font size="2"  >Type "help" for help.</font></div><div><font size="2"  >postgres=# create extension pageinspect;</font></div><div><font size="2"  >ERROR: &nbsp;cannot execute CREATE EXTENSION in a read-only transaction</font></div><div><font size="2"  >postgres=# select * from a;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >postgres=# select * from b;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >postgres=# select * from c;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div></div><p></p></pre></div></div><div>显然与上一篇同样的测试但是<span style="line-height: 22px;"  >pause_at_recovery_target=false不一样.</span></div><div><span style="line-height: 22px;"  >原因就是前面说的. 因为先判断是否pause.&nbsp;</span></div><div><span style="line-height: 22px;"  >resume后, 该XlogRecord将被APPLY.</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# select pg_xlog_replay_resume();</font></div><div><font size="2"  >&nbsp;pg_xlog_replay_resume&nbsp;</font></div><div><font size="2"  >-----------------------</font></div><div><font size="2"  >&nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# create extension pageinspect;</font></div><div><font size="2"  >CREATE EXTENSION</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2048 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  >postgres=# select * from a;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >postgres=# select * from b;</font></div><div><font size="2"  >&nbsp;id | crt_time&nbsp;</font></div><div><font size="2"  >----+----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >postgres=# select * from c;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >----+----------------------------</font></div><div><font size="2"  >&nbsp; 1 | 2013-02-04 15:31:34.491555</font></div><div><font size="2"  >&nbsp; 2 | 2013-02-04 15:32:19.168515</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('a',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 3 | &nbsp; 8072 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1694 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,3) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('b',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1695 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2560 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# select * from heap_page_items(get_raw_page('c',0));</font></div><div><font size="2"  >&nbsp;lp | lp_off | lp_flags | lp_len | t_xmin | t_xmax | t_field3 | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_oid&nbsp;</font></div><div><font size="2"  >----+--------+----------+--------+--------+--------+----------+--------+-------------+------------+--------+--------+-------</font></div><div><font size="2"  >&nbsp; 1 | &nbsp; 8152 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;0 | (0,1) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >&nbsp; 2 | &nbsp; 8112 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; 40 | &nbsp; 1696 | &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp;1 | (0,2) &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; 2304 | &nbsp; &nbsp; 24 | &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >(2 rows)</font></div><p></p></pre></div><div style="line-height: 22px;"  >【小结】</div><div style="line-height: 22px;"  >1. 使用pause时, 并且设置了recovery_target_inclusive = true时,&nbsp;<span style="line-height: 22px;"  >需要特别小心 :&nbsp;</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >&nbsp; &nbsp; 看到的数据可能不是你想要的, 因为resume后会APPLY那个停止点的XLogRecord.</span></div><div style="line-height: 22px;"  >所以如果你要使用pause, 那么推荐你的做法是</div><div style="line-height: 22px;"  >&nbsp; &nbsp; 1.1 设置<span style="line-height: 22px;"  >recovery_target_inclusive = false, 那么resume后, 不会APPLY该XlogRecord, 也就不会造成错觉了.</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >&nbsp; &nbsp; 1.2 或者是使用</span><span style="line-height: 22px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >recovery_target_name作为还原目标, 因为这种XlogRecord中没有事务COMMIT或ABORT信息. 也就不存在APPLY或者不APPLY的差别了.</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >2. 还原目标XID的数据类型为TransactionId, 不是txid, 请注意.</span></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >src/include/c.h</font></div><div><pre class="prettyprint"  ><p><font size="2"  >00354 typedef uint32 TransactionId;</font></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >src/backend/utils/adt/txid.c</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><pre class="prettyprint"  ><p></p><div><font size="2"  >00033 /* txid will be signed int8 in database, so must limit to 63 bits */</font></div><div><font size="2"  >00034 #define MAX_TXID &nbsp; UINT64CONST(0x7FFFFFFFFFFFFFFF)</font></div><div><font size="2"  >00035&nbsp;</font></div><div><font size="2"  >00036 /* Use unsigned variant internally */</font></div><div><font size="2"  >00037 typedef uint64 txid;</font></div><p></p></pre></div><div>xid和txid的转换请参考 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402011830105342275/"  >http://blog.163.com/digoal@126/blog/static/1638770402011830105342275/</a></div></font></div><div style="line-height: 22px;"  ><br></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >【参考】</span><div style="line-height: 22px;"  >1.&nbsp;<a style="line-height: 22px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201303082942271/"  >http://blog.163.com/digoal@126/blog/static/163877040201303082942271/</a></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >2. src/include/access/xact.h</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >3. src/backend/access/transam/xlog.c</span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >4. src/include/catalog/pg_control.h</span><br style="line-height: 22px;"  >5. src/backend/utils/time/tqual.c</div></div><wbr></div>
	</div>
</div>
</body>
</html>