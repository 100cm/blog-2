<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL hll (HyperLogLog) extension for "State of The Art Cardinality Estimation Algorithm" - 3</h2>
	<h5 id="">2013-02-28 14:06:16&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020131288553810/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">前面两篇介绍了hll的安装和使用.&nbsp;<div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020131264480325/"   >http://blog.163.com/digoal@126/blog/static/16387704020131264480325/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402013127917876/"   >http://blog.163.com/digoal@126/blog/static/1638770402013127917876/</a><br><div><span style="line-height: 22px;"   ><br></span></div><div><span style="line-height: 22px;"   >接下来主要讲一下hll的存储结构.</span><div><div>一、hll_hashval类型的长度为64bit, 可以与int, int8类型相互转化. 但是在聚合成hll时结果是有差别的.&nbsp;</div><div>所以最好不要直接把int或int8类型当成hll_hashval来使用.</div><div><div>-- 创建测试表</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; create table agg (id int primary key,userids hll);</font></div><div><font size="2"   >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "agg_pkey" for table "agg"</font></div><div><font size="2"   >CREATE TABLE</font></div><p></p></pre></div></div><div>-- 使用generate_series函数生成数值.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; \df *.*generate_series*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List of functions</font></div><div><font size="2"   >&nbsp; &nbsp;Schema &nbsp; | &nbsp; &nbsp; &nbsp;Name &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; Result data type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Argument data types &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;| &nbsp;Type &nbsp;</font></div><div><font size="2"   >------------+-----------------+-----------------------------------+-----------------------------------------------------------------</font></div><div><font size="2"   >---+--------</font></div><div><font size="2"   >&nbsp;pg_catalog | generate_series | SETOF bigint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| bigint, bigint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | generate_series | SETOF bigint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| bigint, bigint, bigint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | generate_series | SETOF integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | integer, integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | generate_series | SETOF integer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | integer, integer, integer &nbsp; &nbsp;</font></div><p></p></pre></div><div>-- int直接转换成hll_hashval</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; insert into agg select 1,hll_add_agg(t::hll_hashval) from generate_series(-10000000::int,0::int) g(t);</font></div><div><font size="2"   >INSERT 0 1</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >-- int8直接转换成hll_hashval</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; insert into agg select 2,hll_add_agg(t::hll_hashval) from generate_series(-10000000::int8,0::int8) g(t);</font></div><div><font size="2"   >INSERT 0 1</font></div><p></p></pre></div><div>-- 调用hll_hash_integer</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; insert into agg select 3,hll_add_agg(hll_hash_integer(t)) from generate_series(-10000000::int,0::int) g(t);</font></div><div><font size="2"   >INSERT 0 1</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >-- 调用hll_hash_bigint</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; insert into agg select 4,hll_add_agg(hll_hash_bigint(t)) from generate_series(-10000000::int8,0::int8) g(t);</font></div><div><font size="2"   >INSERT 0 1</font></div><p></p></pre></div></div><div>-- 查看唯一值.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select id,#userids from agg;</font></div><div><font size="2"   >&nbsp;id | &nbsp; &nbsp; ?column? &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >----+------------------</font></div><div><font size="2"   >&nbsp; 1 | 12098218.8944067 &nbsp;-- int::hll_hashval</font></div><div><font size="2"   >&nbsp; 2 | 12098218.8944067 &nbsp;-- int8::hll_hashval</font></div><div><font size="2"   >&nbsp; 3 | 10132224.7985314 &nbsp;<span style="line-height: 22px;"   >-- hll_hash_integer</span></font></div><div><font size="2"   >&nbsp; 4 | 9710693.55748479 &nbsp;-- hll_hash_bigint</font></div><div><font size="2"   >(4 rows)</font></div><p></p></pre></div><div>根据文档的描述,&nbsp;<span style="line-height: 22px;"   >误差范围为</span><span style="line-height: 22px; font-family: Helvetica, arial, freesans, clean, sans-serif;"   >±1.04/√(2</span><sup style="margin: 0px; padding: 0px; border: 0px; font-family: Helvetica, arial, freesans, clean, sans-serif;"   >log2m</sup><span style="line-height: 22px; font-family: Helvetica, arial, freesans, clean, sans-serif;"   >).</span></div><div><span style="line-height: 22px; font-family: Helvetica, arial, freesans, clean, sans-serif;"   >-- 本例的log2m=12.</span></div><div><span style="line-height: 22px; font-family: Helvetica, arial, freesans, clean, sans-serif;"   ><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_log2m(userids) from agg;</font></div><div><font size="2"   >&nbsp;hll_log2m&nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 12</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 12</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 12</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 12</font></div><div><font size="2"   >(4 rows)</font></div><p></p></pre></div><div>可以计算出误差=<span style="line-height: 22px;"   >±</span><span style="line-height: 22px;"   >0.01625</span></div></span></div><div>-- 真实误差如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select id,((#userids)-10000001)/10000001 from agg;</font></div><div><font size="2"   >&nbsp;id | &nbsp; &nbsp; &nbsp;?column? &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >----+---------------------</font></div><div><font size="2"   >&nbsp; 1 | &nbsp; 0.209821768458491</font></div><div><font size="2"   >&nbsp; 2 | &nbsp; 0.209821768458491</font></div><div><font size="2"   >&nbsp; 3 | &nbsp;0.0132223785308992</font></div><div><font size="2"   >&nbsp; 4 | -0.0289307413584472</font></div><div><font size="2"   >(4 rows)</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >说明hll_hash_integer得到的hll_hashval的聚合误差在允许范围内.&nbsp;</span></div><div>直接转换以及使用hll_hash_bigint得到的hll_hashval的聚合超出误差范围.&nbsp;</div><div>其他 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=&gt; delete from agg;</font></div><div><font size="2"   >DELETE 6</font></div><div><font size="2"   >digoal=&gt; insert into agg select 6,hll_add_agg(hll_hash_text(t::text)) from generate_series(-10000000,0) g(t);</font></div><div><font size="2"   >INSERT 0 1</font></div></div><div><div><font size="2"   >digoal=&gt; insert into agg select 7,hll_add_agg(hll_hash_bytea(byteain(int4out(t)))) from generate_series(-10000000,0) g(t);</font></div><div><font size="2"   >INSERT 0 1</font></div></div><div><span style="line-height: 22px;"   ><font size="2"   >超出误差范围.</font></span></div><div><div><font size="2"   >digoal=&gt; select id,((#userids)-10000001)/10000001 from agg;</font></div><div><font size="2"   >&nbsp;id | &nbsp; &nbsp; &nbsp;?column? &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >----+---------------------</font></div><div><font size="2"   >&nbsp; 6 | -0.0193928457148722</font></div><div><font size="2"   >&nbsp; 7 | -0.0193928457148722</font></div><div><font size="2"   >(2 rows)</font></div></div><p></p></pre></div><div>所以最精确的还是使用hll_hash_integer得到的hll_hashval.</div><div><br></div><div>二、hll的存储 :&nbsp;</div><div>hll 直观来看就是字节流. 可以与bytea互相转换. 如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=&gt; select '\xffff'::bytea;</font></div><div><font size="2"   >&nbsp;bytea &nbsp;</font></div><div><font size="2"   >--------</font></div><div><font size="2"   >&nbsp;\xffff</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >-- bytea可以转换成hll, 但是这个hll不一定合法</font></div><div><div><font size="2"   >digoal=&gt; select '\xffff'::bytea::hll;</font></div><div><font size="2"   >&nbsp; hll &nbsp;&nbsp;</font></div><div><font size="2"   >--------</font></div><div><font size="2"   >&nbsp;\xffff</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>-- hll转换成bytea没有任何问题, 因为bytea可以存储任何字节流.</div><div><span style="line-height: 22px;"   >-- 但是hll有自己的存储规范, 实际上\xffff是不合法的, 如下 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=&gt; select '\xffff'::hll;</font></div><div><font size="2"   >ERROR: &nbsp;unknown schema version 15</font></div><div><font size="2"   >LINE 1: select '\xffff'::hll;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div></div><div><div><font size="2"   >digoal=&gt; select '\x1fff'::hll;</font></div><div><font size="2"   >ERROR: &nbsp;undefined multiset type</font></div><div><font size="2"   >LINE 1: select '\x1fff'::hll;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >digoal=&gt; select '\x13ff'::hll;</font></div><div><font size="2"   >ERROR: &nbsp;sparse multiset too small</font></div><div><font size="2"   >LINE 1: select '\x13ff'::hll;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >digoal=&gt; select '\x14ff'::hll;</font></div><div><font size="2"   >ERROR: &nbsp;inconsistently sized compressed multiset</font></div><div><font size="2"   >LINE 1: select '\x14ff'::hll;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div></div><p></p></pre></div><div><div>-- 这个是合法的</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select '\x128c7f'::hll;</font></div><div><font size="2"   >&nbsp; &nbsp;hll &nbsp; &nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;\x128c7f</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div></div><div>-- DEBUG一个合法的hll如下 :&nbsp;</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_print('\x128c7f'::hll);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hll_print &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;EXPLICIT, 0 elements, nregs=4096, nbits=5, expthresh=-1(320), sparseon=1:</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>-- DEBUG一个非法hll, 报错 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_print('\xffff'::bytea::hll);</font></div><div><font size="2"   >ERROR: &nbsp;unknown schema version 15</font></div><p></p></pre></div><br><wbr></div><div>三、hll的数据结构</div><div>总的来说包含五个部分的信息(data bytes不一定有, 如果是EMPTY或者无效定义则没有data bytes的数据).</div><div><pre class="prettyprint"   ><p><font size="2"   >1byte(version, data type), 1byte(parameter), 1byte(cutoff), data bytes;</font></p></pre></div><div>3.1 version和data type占用第一个字节 :&nbsp;</div><div>第一个字节分成了2部分信息, 如下 :&nbsp;</div><div>&nbsp; version 指schema version , 目前为1 , 占用前4个比特位.</div><div>&nbsp; data type 占用后4个比特位.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp; // First byte is the version and type header.</font></div><div><font size="2"   >&nbsp; &nbsp; uint8_t vers = (i_bitp[0] &gt;&gt; 4) &amp; 0xf;</font></div><div><font size="2"   >&nbsp; &nbsp; uint8_t type = i_bitp[0] &amp; 0xf;</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >3.2 parameter 占用第二个字节 :&nbsp;</span></div><div><span style="line-height: 22px;"   >第二个字节分成了2部分信息, 如下 :&nbsp;</span></div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; the highest 3 bits are used to encode the integer value "registerWidth - 1", and</font></div><div><font size="2"   >&nbsp; the remaining 5 bits encode the integer value "log2(numberOfRegisters)".</font></div><p></p></pre></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >"registerWidth" may take values from 1 to 8, inclusive, and "log2(numberOfRegisters)" may take on 1 to 31, inclusive.</font></div><div><div><font size="2"   >For example:</font></div><div><span style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; P = xA6 = 1010 0110 = 101 00110</font></span></div><div><font size="2"   >thus "registerWidth - 1" = 5, 因此 "registerWidth" = 6 and "log2(numberOfRegisters)" = 6, 因此 "numberOfRegisters" = 2^6 = 64.</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"   >3.3 cutoff 占用第三个字节 :&nbsp;</span></div></div><div><span style="line-height: 22px;"   >第三个字节分成了3部分信息, 第二个比特位表示是否允许sparse结构. 接下来的6个比特位存储cutoff的(指数-1)信息. 如下 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >The 'cutoff' byte C encodes parameters defining the EXPLICIT to SPARSE, or EXPLICIT to FULL promotions.</font></div><div><font size="2"   >-- 因为SPARSE到FULL不需要根据cutoff的值来判断, 当使用SPARSE存储会超过使用FULL存储时, 即转换为FULL.</font></div><div><span style="line-height: 22px;"   ><font size="2"   >1 bit (the top bit) of padding,</font></span></div><div><font size="2"   >1 bit (second highest bit) indicating the boolean value sparseEnabled, and</font></div><div><font size="2"   >6 bits (lowest six bits) as a big-endian integer explicitCutoff that can take on the values 0, 63, or 1 to 31 inclusive.</font></div><p></p></pre></div><div>相关代码 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >// This routine is used to encode an expthresh value to be stored</font></div><div><font size="2"   >// in the typmod metadata or a hll header.</font></div><div><font size="2"   >//</font></div><div><font size="2"   >static int32 encode_expthresh(int64 expthresh)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; // This routine presumes the uncompressed value is correct and</font></div><div><font size="2"   >&nbsp; &nbsp; // doesn't range check.</font></div><div><font size="2"   >&nbsp; &nbsp; //</font></div><div><font size="2"   >&nbsp; &nbsp; if (expthresh == -1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return 63;</font></div><div><font size="2"   >&nbsp; &nbsp; else if (expthresh == 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return 0;</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return integer_log2(expthresh) + 1;</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >// If expthresh == -1 (auto select expthresh) determine</font></div><div><font size="2"   >// the expthresh to use from nbits and nregs.</font></div><div><font size="2"   >//</font></div><div><font size="2"   >// -1则自动计算cutoff的值</font></div><div><font size="2"   >static size_t</font></div><div><font size="2"   >expthresh_value(int64 expthresh, size_t nbits, size_t nregs)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; if (expthresh != -1)</font></div><div><font size="2"   >&nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return (size_t) expthresh;</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; // Auto is selected, choose the maximum number of explicit</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; // registers that fits in the same space as the compressed</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; // encoding.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; size_t cmpsz = ((nbits * nregs) + 7) / 8;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return cmpsz / sizeof(uint64_t);</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   >}</font></div><p></p></pre></div><div>解码代码 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >// The expthresh is represented in a encoded format in the</font></div><div><font size="2"   >// type modifier to save metadata bits. &nbsp;This routine is used</font></div><div><font size="2"   >// when the expthresh comes from a typmod value or hll header.</font></div><div><font size="2"   >//</font></div><div><font size="2"   >static int64 decode_expthresh(int32 encoded_expthresh)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; // This routine presumes the encoded value is correct and</font></div><div><font size="2"   >&nbsp; &nbsp; // doesn't range check.</font></div><div><font size="2"   >&nbsp; &nbsp; //</font></div><div><font size="2"   >&nbsp; &nbsp; if (encoded_expthresh == 63)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return -1LL;</font></div><div><font size="2"   >&nbsp; &nbsp; else if (encoded_expthresh == 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return 0;</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return 1LL &lt;&lt; (encoded_expthresh - 1);</font></div><div><font size="2"   >}</font></div><p></p></pre></div><div><br></div><div>3.4 不同的data type对应的data bytes也不一样.</div><div>所以data bytes存储的是动态的结构, data type可能包含如下结构类型. 数值对应的是存储在HLL中的第一个字节的后4个比特位.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >0 - undefined, 无效或未定义的结构, 因此没有data bytes的部分.</font></div><div><font size="2"   >1 - EMPTY, A constant value that denotes the empty set. 同样没有data bytes的部分</font></div><div><font size="2"   >2 - EXPLICIT, 连续的字节流, 每个字节存储一个hll_hashval. 并且按照hll_hashval排序存储的结构.</font></div><div><font size="2"   >3 - SPARSE, 后面再解释.</font></div><div><font size="2"   >4 - FULL, 后面再解释.</font></div><p></p></pre></div><div><br></div><div>根据第三部分的介绍, 举例来解析一下各个部分的信息 :&nbsp;</div><div>首先设置一下几部分的信息 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >log2m = 10</font></div><div><font size="2"   >regwidth = 1</font></div><div><font size="2"   >expthresh = 4</font></div><div><font size="2"   >sparseon = 1</font></div><div><font size="2"   >digoal=&gt; select hll_set_defaults(10,1,4,1);</font></div><div><font size="2"   >-- 输出1个hll的字节流信息:</font></div><div><div><font size="2"   >digoal=&gt; select hll_add_agg(hll_hash_integer(t)) from generate_series(1,2) g(t);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hll_add_agg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------</font></div><div><font size="2"   >&nbsp;\x120a438895a3f5af28cafeda0ce907e4355b60</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>从上面这个字节流来分析头的信息 :&nbsp;</div><div>1. 第一个字节: 0x12</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >schema version是头4个比特=1</font></div><div><font size="2"   >data type是后4个比特 = 2, 对应的是EXPLICIT</font></div><p></p></pre></div><div>2. 第二个字节: 0x0a</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >前3个比特是registerWidth - 1=0, 所以<span style="line-height: 22px;"   >registerWidth=1;</span></font></div><div><font size="2"   >后5个比特是log2(numberOfRegisters)=10, 所以<span style="line-height: 22px;"   >numberOfRegisters=2^10= 1024;</span></font></div><p></p></pre></div><div>3. 第三个字节: 0x43</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >展开成2进制为: 01000011</font></div><div><font size="2"   >第一个比特是为了满足8bit 对其的padding. 值是多少都忽略不计;</font></div><div><font size="2"   >第二个比特是sparseEnabled的布尔逻辑, 值为1;</font></div><div><font size="2"   >最后6个比特是integer_log2(expthresh) + 1, 这里我们设置了<span style="line-height: 22px;"   >expthresh=4, 所以</span><span style="line-height: 22px;"   >integer_log2(expthresh) + 1 = 3;</span></font></div><div><font size="2"   ><span style="line-height: 22px;"   >如果6个比特位满表示127, 但是不能取这么大的值, 因为</span>1LL &lt;&lt; (encoded_expthresh - 1) 最多存储64bit. 所以前面提到了最大是63.&nbsp;</font></div><p></p></pre></div><div>4. 后面的是data bytes: 0x<span style="line-height: 22px;"   >8895a3f5af28cafeda0ce907e4355b60</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >使用hll_print可以打印出以上解析的信息 :&nbsp;</font></span></div><div><div style="line-height: 22px;"   ><font size="2"   >digoal=&gt; select hll_print(hll_add_agg(hll_hash_integer(t))) from generate_series(1,2) g(t);</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hll_print &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >---------------------------------------------------------------------</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;EXPLICIT, 2 elements, nregs=1024, nbits=1, expthresh=4, sparseon=1:+</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;0: -8604791237420463362 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;1: -2734554653617988768&nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >(1 row)</font></div><div style="line-height: 22px;"   ><font size="2"   >将以上的data 转换成16进制 :&nbsp;</font></div><div><font size="2"   >8895A3F5AF28CAFE</font></div></div><div><font size="2"   >DA0CE907E4355B60</font></div><div><font size="2"   >正好是hll值中对应的data bytes部分.</font></div><p></p></pre></div><div><br></div><div>四、data type详解 :&nbsp;</div><div>1. EMPTY, 没有data bytes的部分, 看字节流如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_empty();</font></div><div><font size="2"   >&nbsp;hll_empty&nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp;\x110a43</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=&gt; select hll_print(hll_empty());</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hll_print &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >-----------------------------------------------------</font></div><div><font size="2"   >&nbsp;EMPTY, nregs=1024, nbits=1, expthresh=4, sparseon=1</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div><br></div><div>2. EXPLICIT, 第三部分已经讲过, 这里就不再多说了. 只是要注意2点 :&nbsp;</div><div>2.1 存储是针对hll_hashval排序好了的.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=&gt; select hll_set_defaults(10,1,8192,1);</font></div><div><font size="2"   >&nbsp;hll_set_defaults&nbsp;</font></div><div><font size="2"   >------------------</font></div><div><font size="2"   >&nbsp;(10,1,4,1)</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >digoal=&gt; select hll_hash_integer(t) from generate_series(1,10) g(t);</font></div><div><font size="2"   >&nbsp; &nbsp;hll_hash_integer &nbsp;&nbsp;</font></div><div><font size="2"   >----------------------</font></div><div><font size="2"   >&nbsp;-8604791237420463362</font></div><div><font size="2"   >&nbsp;-2734554653617988768</font></div><div><font size="2"   >&nbsp;5208657608173592891</font></div><div><font size="2"   >&nbsp;2072756739463403504</font></div><div><font size="2"   >&nbsp;6655367218388208063</font></div><div><font size="2"   >&nbsp;-5566252076597558760</font></div><div><font size="2"   >&nbsp;9162408199432052219</font></div><div><font size="2"   >&nbsp;8282768600195057636</font></div><div><font size="2"   >&nbsp;1779292183511753683</font></div><div><font size="2"   >&nbsp;3213538865073541202</font></div><div><font size="2"   >(10 rows)</font></div></div><div><div><font size="2"   >digoal=&gt; select hll_print(hll_add_agg(hll_hash_integer(t))) from generate_series(1,10) g(t);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hll_print &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >-------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;EXPLICIT, 10 elements, nregs=1024, nbits=1, expthresh=8192, sparseon=1:+</font></div><div><font size="2"   >&nbsp;0: -8604791237420463362 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp;1: -5566252076597558760 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp;2: -2734554653617988768 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp;3: &nbsp;1779292183511753683 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp;4: &nbsp;2072756739463403504 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp;5: &nbsp;3213538865073541202 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp;6: &nbsp;5208657608173592891 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp;7: &nbsp;6655367218388208063 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp;8: &nbsp;8282768600195057636 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp;9: &nbsp;9162408199432052219&nbsp;</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><br></div><div>2.2 如果手动设置了expthresh, 那么使用explicit存储的最大存储空间就是3 bytes + (8bytes * expthresh); 当存储的值个数超过expthresh是会转换成SPARSE或FULL存储, 占用的空间会缩小. 具体缩小到多少可以<span style="line-height: 22px;"   >参考以下表 :&nbsp;</span></div><div><table style="margin: 15px 0px; padding: 0px; border: 0px; border-collapse: collapse; border-spacing: 0px; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 14px; line-height: 22px; color: rgb(51, 51, 51);"   ><tbody style="margin: 0px; padding: 0px; border: 0px;"   ><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204);"   ><th style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   ><code style="margin: 0px 2px; padding: 0px 5px; border: 1px solid rgb(234, 234, 234); font-size: 12px; font-family: Consolas, 'Liberation Mono', Courier, monospace; background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: nowrap;"   >logm2</code></th><th style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   ><code style="margin: 0px 2px; padding: 0px 5px; border: 1px solid rgb(234, 234, 234); font-size: 12px; font-family: Consolas, 'Liberation Mono', Courier, monospace; background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: nowrap;"   >regwidth=1</code></th><th style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   ><code style="margin: 0px 2px; padding: 0px 5px; border: 1px solid rgb(234, 234, 234); font-size: 12px; font-family: Consolas, 'Liberation Mono', Courier, monospace; background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: nowrap;"   >regwidth=2</code></th><th style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   ><code style="margin: 0px 2px; padding: 0px 5px; border: 1px solid rgb(234, 234, 234); font-size: 12px; font-family: Consolas, 'Liberation Mono', Courier, monospace; background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: nowrap;"   >regwidth=3</code></th><th style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   ><code style="margin: 0px 2px; padding: 0px 5px; border: 1px solid rgb(234, 234, 234); font-size: 12px; font-family: Consolas, 'Liberation Mono', Courier, monospace; background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: nowrap;"   >regwidth=4</code></th><th style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   ><code style="margin: 0px 2px; padding: 0px 5px; border: 1px solid rgb(234, 234, 234); font-size: 12px; font-family: Consolas, 'Liberation Mono', Courier, monospace; background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: nowrap;"   >regwidth=5</code></th><th style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   ><code style="margin: 0px 2px; padding: 0px 5px; border: 1px solid rgb(234, 234, 234); font-size: 12px; font-family: Consolas, 'Liberation Mono', Courier, monospace; background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; white-space: nowrap;"   >regwidth=6</code></th></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(248, 248, 248);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >10</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >7.4e+02 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >128B</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.0e+03 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >256B</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >4.7e+04 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >384B</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.2e+07 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >512B</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >7.9e+11 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >640B</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.4e+21 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >768B</sub></em></td></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >11</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.5e+03 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >256B</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >5.9e+03 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >512B</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >9.5e+04 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >768B</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >2.4e+07 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >1.0KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.6e+12 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >1.2KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >6.8e+21 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >1.5KB</sub></em></td></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(248, 248, 248);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >12</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.0e+03 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >512B</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.2e+04 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >1.0KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.9e+05 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >1.5KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >4.8e+07 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >2.0KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.2e+12 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >2.5KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.4e+22 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >3KB</sub></em></td></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >13</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >5.9e+03 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >1.0KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >2.4e+04 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >2.0KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.8e+05 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >3KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >9.7e+07 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >4KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >6.3e+12 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >5KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >2.7e+22 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >6KB</sub></em></td></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(248, 248, 248);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >14</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.2e+04 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >2.0KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >4.7e+04 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >4KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >7.6e+05 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >6KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.9e+08 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >8KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.3e+13 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >10KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >5.4e+22 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >12KB</sub></em></td></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >15</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >2.4e+04 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >4KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >9.5e+04 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >8KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.5e+06 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >12KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.9e+08 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >16KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >2.5e+13 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >20KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.1e+23 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >24KB</sub></em></td></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(248, 248, 248);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >16</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >4.7e+04 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >8KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.9e+05 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >16KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.0e+06 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >24KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >7.7e+08 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >32KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >5.1e+13 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >40KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >2.2e+23 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >48KB</sub></em></td></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >17</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >9.5e+04 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >16KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.8e+05 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >32KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >6.0e+06 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >48KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.5e+09 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >64KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.0e+14 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >80KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >4.4e+23 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >96KB</sub></em></td></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(248, 248, 248);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >18</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.9e+05 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >32KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >7.6e+05 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >64KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.2e+07 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >96KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.1e+09 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >128KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >2.0e+14 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >160KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >8.7e+23 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >192KB</sub></em></td></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >19</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.8e+05 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >64KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.5e+06 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >128KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >2.4e+07 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >192KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >6.2e+09 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >256KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >4.1e+14 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >320KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.7e+24 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >384KB</sub></em></td></tr><tr style="margin: 0px; padding: 0px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(248, 248, 248);"   ><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >20</td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >7.6e+05 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >128KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.0e+06 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >256KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >4.8e+07 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >384KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >1.2e+10 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >512KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >8.1e+14 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >640KB</sub></em></td><td style="margin: 0px; padding: 6px 13px; border: 1px solid rgb(204, 204, 204);"   >3.5e+24 &nbsp;&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;"   ><sub style="margin: 0px; padding: 0px; border: 0px;"   >768KB</sub></em></td></tr></table></div><div>例如 :&nbsp;</div><div>-- logm2:10, regwidth:1对应以上表的存储空间是128 bytes, 将thresh设置成8192, 也就是说要超过8192个存储的值时才会使用sparse存储.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_set_defaults(10,1,8192,1);</font></div><div><font size="2"   >&nbsp;hll_set_defaults&nbsp;</font></div><div><font size="2"   >------------------</font></div><div><font size="2"   >&nbsp;(10,1,8192,1)</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>-- 8192个值时, 由于使用explicit存储结构, 所以占用空间是3bytes + 8192*8 =&nbsp;<span style="line-height: 22px;"   >65539 bytes</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select octet_length(hll_add_agg(hll_hash_integer(t))::text::bytea) from generate_series(1,8192) g(t);</font></div><div><font size="2"   >&nbsp;octet_length&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 65539</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>-- 当值增加到8193, 那么会转换成sparse存储结构, 空间降到3 bytes + 128 bytes = 131 bytes.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select octet_length(hll_add_agg(hll_hash_integer(t))::text::bytea) from generate_series(1,8193) g(t);</font></div><div><font size="2"   >&nbsp;octet_length&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 131</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>-- 需要注意的是,&nbsp;<span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >logm2:10, regwidth:1 最多只能存储的值不到8193个, 所以转换成sparse存储后信息会丢失.</span></div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >digoal=&gt; select #hll_add_agg(hll_hash_integer(t)) from generate_series(1,8193) g(t);</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;?column?&nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >----------</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; NaN</font></div><div style="line-height: 22px;"   ><font size="2"   >(1 row)</font></div><p></p></pre></div><div style="line-height: 22px;"   >-- 而8192是explicit存储的, 所以信息是完全的 :&nbsp;</div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select #hll_add_agg(hll_hash_integer(t)) from generate_series(1,8192) g(t);</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;8192</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div style="line-height: 22px;"   >-- 从hll_print的输出可以看出端倪 :&nbsp;</div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_print(hll_add_agg(hll_hash_integer(t))) from generate_series(1,8193) g(t);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hll_print &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;COMPRESSED, 1024 filled nregs=1024, nbits=1, expthresh=8192, sparseon=1: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp; &nbsp; 0: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; &nbsp;32: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; &nbsp;64: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; &nbsp;96: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 128: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 160: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 192: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 224: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 256: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 288: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 320: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 352: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 384: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 416: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 448: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 480: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 512: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 544: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 576: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 608: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 640: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 672: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 704: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 736: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 768: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 800: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 832: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 864: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 896: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 928: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 960: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 992: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1&nbsp;</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div style="line-height: 22px;"   >把cutoff调整为自动, 再看看到底log2m:10, regwidth:1 能存储多少个值.</div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_set_defaults(10,1,-1,1);</font></div><div><font size="2"   >&nbsp;hll_set_defaults&nbsp;</font></div><div><font size="2"   >------------------</font></div><div><font size="2"   >&nbsp;(10,1,8192,1)</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div style="line-height: 22px;"   >-- 临界值是7090, 如下 :&nbsp;</div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   >-- 所有的bit全是1 :&nbsp;</span></div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_print(hll_add_agg(hll_hash_integer(t))) from generate_series(1,7091) g(t);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hll_print &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;COMPRESSED, 1024 filled nregs=1024, nbits=1, expthresh=-1(16), sparseon=1: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp; &nbsp; 0: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; &nbsp;32: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; &nbsp;64: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; &nbsp;96: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 128: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 160: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 192: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 224: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 256: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 288: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 320: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 352: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 384: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 416: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 448: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 480: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 512: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 544: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 576: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 608: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 640: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 672: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 704: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 736: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 768: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 800: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 832: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 864: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 896: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 928: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 960: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 992: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1&nbsp;</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>-- 352这行有个bit还是0</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_print(hll_add_agg(hll_hash_integer(t))) from generate_series(1,7090) g(t);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hll_print &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;COMPRESSED, 1023 filled nregs=1024, nbits=1, expthresh=-1(16), sparseon=1: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp; &nbsp; 0: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; &nbsp;32: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; &nbsp;64: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; &nbsp;96: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 128: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 160: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 192: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 224: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 256: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 288: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 320: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 352: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;0 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 384: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 416: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 448: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 480: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 512: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 544: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 576: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 608: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 640: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 672: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 704: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 736: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 768: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 800: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 832: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 864: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 896: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 928: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 960: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 +</font></div><div><font size="2"   >&nbsp; 992: &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1 &nbsp;1&nbsp;</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div></div></div><div>-- 从distinct的结果也能看出来 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select #(hll_add_agg(hll_hash_integer(t))) from generate_series(1,7090) g(t);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;?column? &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------</font></div><div><font size="2"   >&nbsp;7097.82712893384</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=&gt; select #(hll_add_agg(hll_hash_integer(t))) from generate_series(1,7091) g(t);</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; NaN</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>-- 所以log2m=10, regwidth=1存储的值并不是7.4e+02, 而是7090. 这不知道是不是文档上的BUG。</div><div><br></div><div>3. SPARSE</div><div>存储的不是完整的hll_hashval, 而是short-word, 由log2(numberOfRegisters) + registerWidth这两个宽度的比特位组成.</div><div>例如log2m=10, regwidth=1, 则存储1个值消耗11个比特.</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >log2(numberOfRegisters) 称为 index.</font></span></div><div><span style="line-height: 22px;"   ><font size="2"   >registerWidth 称为 value.</font></span></div><p></p></pre></div><div><span style="line-height: 22px;"   >注意这里也有对齐的问题, 如果&nbsp;</span>BITS = (registerWidth + log2(numberOfRegisters)) * numberOfRegisters 不是8的倍数, 那么末尾需要填0。</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >log2m=10, regwidth=1, expthresh= -1(16): (expthresh自动计算得到).</font></div><div><font size="2"   >这种情况下 :&nbsp;</font></div><div><div><font size="2"   >digoal=&gt; select hll_add_agg(hll_hash_integer(t)) from generate_series(1,17) g(t);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hll_add_agg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----------------------------------------------------------</font></div><div><font size="2"   >&nbsp;\x130a7f05e13c528c33666d51ca776fefde18cb1bfbb07d3fc9fc20</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >长度27字节 :&nbsp;</font></div><div><div><font size="2"   >digoal=&gt; select octet_length(hll_add_agg(hll_hash_integer(t))::text::bytea) from generate_series(1,17) g(t);</font></div><div><font size="2"   >&nbsp;octet_length&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;27</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >长度计算 :&nbsp;</font></div><div><font size="2"   >17个值占用的空间是11*17=187字节, 不能被8整除, 需要添5个0.</font></div><div><div><font size="2"   >digoal=&gt; select 11*17;</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; 187</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >添5个0后等于192; 因此data bytes部分占据24字节.</font></div><div><div><font size="2"   >digoal=&gt; select 192/8;</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;24</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >24加上头部的3个字节正好是27字节.</font></div><p></p></pre></div><div>-- 手册上的例子 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >For example, if log2(numberOfRegisters) = 11 and registerWidth = 6, and if the register index/value pairs are (11, 6) and (1099, 19):</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >= [(11, 6), (1099, 19), padding] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# as unsigned decimal-encoded pairs</font></div><div><font size="2"   >= [(0b00000001011, 0b000110), (0b10001001011, 0b010011), 0b000000] &nbsp;# as two binary-encoded pairs and 6 bits of padding</font></div><div><font size="2"   >= [(0b00000001011000110), (0b10001001011010011), 0b000000] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# as binary-encoded 17-bit short words and 6 bits of padding</font></div><div><font size="2"   >= [0b00000001, 0b01100011, 0b01000100, 0b10110100, 0b11000000] &nbsp; &nbsp; &nbsp;# as binary-encoded octets in array</font></div><div><font size="2"   >= [0x01, 0x63, 0x44, 0x5B, 0xC0] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# as byte array</font></div><div><font size="2"   >&nbsp; 0x0163445BC0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# as hex</font></div><p></p></pre></div><div><br></div><div>4. FULL</div><div>当使用sparse存储可能超过使用full存储的空间开销时, 会转成full存储.&nbsp;</div><div>(或者设置了enablesparse=false,0)时超过expthresh后会从explicit直接转换成FULL.)</div><div>FULL存储结构如下 :&nbsp;</div><div><div style="line-height: 22px;"   >存储的不是完整的hll_hashval, 而是short-word, 由registerWidth的比特位组成.</div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   >例如log2m=10, regwidth=1, 则存储1个值消耗1个比特.</span></div></div><div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   >registerWidth 称为 value.</span></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   >注意这里也有对齐的问题, 如果&nbsp;</span><span style="line-height: 22px;"   >BITS = registerWidth * numberOfRegisters</span>&nbsp;不是8的倍数, 那么末尾需要填0。</div><div style="line-height: 22px;"   >例如 :&nbsp;</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_set_defaults(10,2,16,1);</font></div><div><font size="2"   >&nbsp;hll_set_defaults&nbsp;</font></div><div><font size="2"   >------------------</font></div><div><font size="2"   >&nbsp;(10,7,16,1)</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>-- 全部填满, 每个short-word是2bit, 可存储范围为0-3. 从下面的print可以看出已经全部填满.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; select hll_print(hll_add_agg(hll_hash_bigint(t))) from generate_series(1,9999999::int8) g(t);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hll_print &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;COMPRESSED, 1024 filled nregs=1024, nbits=2, expthresh=16, sparseon=1: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"   >&nbsp; &nbsp; 0: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; &nbsp;32: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; &nbsp;64: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; &nbsp;96: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 128: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 160: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 192: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 224: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 256: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 288: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 320: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 352: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 384: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 416: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 448: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 480: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 512: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 544: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 576: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 608: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 640: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 672: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 704: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 736: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 768: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 800: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 832: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 864: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 896: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 928: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 960: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 +</font></div><div><font size="2"   >&nbsp; 992: &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3 &nbsp;3&nbsp;</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div></div></div><div><span style="line-height: 22px;"   >-- 手册中的例子 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >For example, if registerWidth = 5 and numberOfRegisters = 4, and if the register index/value pairs are (0, 0), (1,1), (2,2), (3,3):</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; [0, 1, 2, 3, padding] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# as unsigned decimal-encoded register values</font></div><div><font size="2"   >= [0b00000, 0b00001, 0b00010, 0b00011, 0b0000] # as four 5-bit "short words" + 4 bits padding</font></div><div><font size="2"   >= [0b00000000, 0b01000100, 0b00110000] &nbsp; &nbsp; &nbsp; &nbsp; # as binary-encoded octets in array</font></div><div><font size="2"   >= [0x00, 0x44, 0x30] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # as hex-encoded byte array</font></div><div><font size="2"   >= 0x004430 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # as hex</font></div><p></p></pre></div><div><br></div><div>五、数据类型转换的规则.</div><div>因为data bytes部分存储的数据结构是动态的, 类型转换的规则如下 :&nbsp;</div><div><div>Hierarchy</div><div>The hierarchy is dependent on the 'cutoff' byte C. When a set is promoted from one 'type'/algorithm to another, the top nibble of the 'version' byte V, the 'parameter' byte P, and the 'cutoff' byte C all remain the same. The bottom nibble of V and the 'data' bytes B may change.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >When any value is added to an EMPTY set,</font></div><div><font size="2"   >if explicitCutoff = 0 and sparseEnabled = 0, then it is promoted to a FULL set containing that one value.</font></div><div><font size="2"   >if explicitCutoff = 0 and sparseEnabled = 1, then it is promoted to a SPARSE set containing that one value.</font></div><div><font size="2"   >if explicitCutoff &gt; 0 but &lt; 63, then it is promoted to an EXPLICIT set containing that one value.</font></div><p></p></pre></div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >When inserting an element into an EXPLICIT set,</font></div><div><span style="line-height: 22px;"   ><font size="2"   >if sparseEnabled = 0 and explicitCutoff = 0, then it is promoted to a FULL set.</font></span></div><div><font size="2"   >if sparseEnabled = 1 and explicitCutoff = 0, then it is promoted to a SPARSE set.</font></div><div><font size="2"   >if sparseEnabled = 0 and explicitCutoff &gt; 0 and &lt; 63, and if inserting the element would cause the cardinality to exceed 2 ^ (explicitCutoff - 1), then it is promoted to a FULL.</font></div><div><font size="2"   >if sparseEnabled = 1 and explicitCutoff &gt; 0 and &lt; 63, and if inserting the element would cause the cardinality to exceed 2 ^ (explicitCutoff - 1), then it is promoted to a SPARSE.</font></div><div><font size="2"   >if sparseEnabled = 0 and explicitCutoff = 63, then the criteria for promotion is implementation-dependent, as this value of explicitCutoff indicates an 'auto' promotion mode. Since sparseEnabled = 0 the set can only be promoted to a FULL set.</font></div><div><font size="2"   >if sparseEnabled = 1 and explicitCutoff = 63, then the promotion is implementation-dependent, as this value of explicitCutoff indicates an 'auto' promotion mode. Since sparseEnabled = 1 the set can only be promoted to a SPARSE set.</font></div><p></p></pre></div><div><br></div><div><pre class="prettyprint"   ><p><font size="2"   >When inserting an element into a SPARSE set, if that element would cause the storage size of the SPARSE set to be greater than that of a FULL set, then it is promoted to a FULL set.</font></p></pre></div></div><div><br></div></div></div></div>六、<div>性能举例 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=&gt; create table test(c1 hll);</font></div><div><font size="2"   >CREATE TABLE</font></div></div><div><div><font size="2"   >digoal=&gt; insert into test select hll_add_agg(hll_hash_integer(t)) from generate_series(1,100000000) g(t);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >Time: 73342.322 ms</font></div><div><font size="2"   >digoal=&gt; insert into test select hll_add_agg(hll_hash_integer(t)) from generate_series(-50000001,50000000) g(t);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >Time: 73190.797 ms</font></div></div><div><div><font size="2"   >digoal=&gt; select #c1,(100000000-(#c1))/100000000.0 from test;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;?column? &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; ?column? &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------+----------------------</font></div><div><font size="2"   >&nbsp;99473843.5133928 | &nbsp;0.00526156486607164</font></div><div><font size="2"   >&nbsp;99928107.7019657 | 0.000718922980343103</font></div><div><font size="2"   >(2 rows)</font></div></div><div><div><font size="2"   >digoal=&gt; select #hll_union_agg(c1),(150000002-(#hll_union_agg(c1)))/150000002.0 from test;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;?column? &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;?column? &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------+--------------------</font></div><div><font size="2"   >&nbsp;148198541.947098 | 0.0120097335258864</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 6.776 ms</font></div></div><p></p></pre></div></div>
	</div>
</div>
</body>
</html>