<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL FUSE tool, mount database AS a filesystem</h2>
	<h5 id="">2013-02-03 12:20:51&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201313101418591/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>把PostgreSQL的数据库操作转换成普通的操作系统命令. 当然一般不会有这种使用场景. 纯属实验.</div><div>下载 :&nbsp;</div><div><a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresqlfs.git;a=summary"  >http://git.postgresql.org/gitweb/?p=postgresqlfs.git;a=summary</a></div><div><br></div><div>安装 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >tar -zxvf postgresqlfs-b5b1a25.tar.gz&nbsp;</font></div><div><font size="2"  >mv postgresqlfs-b5b1a25&nbsp;/home/ocz/postgresql-9.2.1/contrib/</font></div></div><div><font size="2"  >. /home/ocz/.bash_profile</font></div><div><font size="2"  >cd /home/ocz/postgresql-9.2.1/contrib/postgresqlfs-b5b1a25/</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 22px;"  >(编译异常处理-1)</span><span style="line-height: 22px;"  >&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >vi&nbsp;GNUmakefile</font></div><div><font size="2"  >删除以下option.</font></div><div><font size="2"  >-Werror</font></div><div><font size="2"  >-Wtype-limits</font></div><div><font size="2"  >-Wno-sign-conversion&nbsp;</font></div><div><font size="2"  >-Wlogical-op</font></div><div><font size="2"  >否则报错 :&nbsp;</font></div><div><div><font size="2"  >[root@db-172-16-3-150 postgresqlfs-b5b1a25]# gmake clean</font></div><div><font size="2"  >rm -f postgresqlfs.o path.o strlcpy.o query.o postgresqlfs</font></div><div><font size="2"  >[root@db-172-16-3-150 postgresqlfs-b5b1a25]# gmake</font></div><div><font size="2"  >gmake: pg_config: Command not found</font></div><div><font size="2"  >gcc -std=gnu99 -Wall -Wshadow -Werror -Wextra -Wformat=2 -Wpointer-arith -Wtype-limits -Wbad-function-cast -Wcast-qual -Wcast-align -Wwrite-strings -Wconversion -Wno-sign-conversion -Wlogical-op -Waggregate-return -Wstrict-prototypes -Wmissing-prototypes -D_FILE_OFFSET_BITS=64 -I &nbsp;-c -o postgresqlfs.o postgresqlfs.c</font></div><div><font size="2"  >cc1: error: unrecognized command line option "-Wtype-limits"</font></div><div><font size="2"  >cc1: error: unrecognized command line option "-Wno-sign-conversion"</font></div><div><font size="2"  >cc1: error: unrecognized command line option "-Wlogical-op"</font></div><div><font size="2"  >gmake: *** [postgresqlfs.o] Error 1</font></div></div><div><font size="2"  >或者 :&nbsp;</font></div><div><font size="2"  >cc1: warnings being treated as errors</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 22px;"  >(编译异常处理-2)</span><span style="line-height: 22px;"  >&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >修改行 :&nbsp;</font></div><div><font size="2"  >LIBS = $(shell pkg-config fuse --libs) -lpq</font></div><div><font size="2"  >改成 :&nbsp;</font></div><div><font size="2"  >LIBS = $(shell pkg-config fuse --libs) -L/home/ocz/pgsql9.2.1/lib -lpq</font></div><div><font size="2"  >否则报错 :&nbsp;</font></div><div><div><font size="2"  >/usr/bin/ld: cannot find -lpq</font></div><div><font size="2"  >collect2: ld returned 1 exit status</font></div><div><font size="2"  >gmake: *** [postgresqlfs] Error 1</font></div></div><p></p></pre></div><div><br></div><div>编译正常如下 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >root@db-172-16-3-150-&gt; gmake all</font></div><div><font size="2"  >gcc -std=gnu99 -Wall -Wshadow -Wextra -Wformat=2 -Wpointer-arith -Wbad-function-cast -Wcast-qual -Wcast-align -Wwrite-strings -Wconversion -Waggregate-return -Wstrict-prototypes -Wmissing-prototypes &nbsp;postgresqlfs.o path.o strlcpy.o query.o -pthread -L/lib64 -lfuse -lrt -ldl &nbsp; -L/home/ocz/pgsql9.2.1/lib -lpq -o postgresqlfs</font></div><p></p></pre></div><div><br></div><div>gcc 版本 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><span style="line-height: 22px;"  ><font size="2"  >[root@db-172-16-3-150 postgresqlfs-b5b1a25]# gcc -v</font></span></div><div><div><font size="2"  >Using built-in specs.</font></div><div><font size="2"  >Target: x86_64-redhat-linux</font></div><div><font size="2"  >Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-libgcj-multifile --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --disable-plugin --with-java-home=/usr/lib/jvm/java-1.4.2-gcj-1.4.2.0/jre --with-cpu=generic --host=x86_64-redhat-linux</font></div><div><font size="2"  >Thread model: posix</font></div><div><font size="2"  >gcc version 4.1.2 20080704 (Red Hat 4.1.2-52)</font></div></div><p></p></pre></div><div><br></div><div>测试 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >su - root</font></div><div><font size="2"  >假设以下数据库已经存在, 该数据库为standby数据库, 只读, 不能写, 所以在集群文件夹下创建数据库和SCHEMA时报错.</font></div><div><div><font size="2"  >export PGHOSTADDR=172.16.3.33</font></div><div><font size="2"  >export PGPORT=9200</font></div><div><font size="2"  >export PGDATABASE=digoal</font></div><div><font size="2"  >export PGUSER=digoal</font></div><div><font size="2"  >export PGPASSWORD=digoal</font></div></div><div><font size="2"  >cd&nbsp;<span style="line-height: 22px;"  >/home/ocz/postgresql-9.2.1/contrib/postgresqlfs-b5b1a25/</span></font></div><div><font size="2"  ><span style="line-height: 22px;"  >./</span>postgresqlfs /mnt</font></div><p></p></pre></div><div>读测试 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >digoal=# create table test (id int,info text,crt_time timestamp);</font></div><div><font size="2"  >CREATE TABLE</font></div></div><div><div><font size="2"  >digoal=# insert into test select generate_series(1,5),'test',clock_timestamp();</font></div><div><font size="2"  >INSERT 0 5</font></div><div><font size="2"  >digoal=# select * from test;</font></div><div><font size="2"  >&nbsp;id | info | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >----+------+----------------------------</font></div><div><font size="2"  >&nbsp; 1 | test | 2013-02-03 11:57:29.444508</font></div><div><font size="2"  >&nbsp; 2 | test | 2013-02-03 11:57:29.444643</font></div><div><font size="2"  >&nbsp; 3 | test | 2013-02-03 11:57:29.444647</font></div><div><font size="2"  >&nbsp; 4 | test | 2013-02-03 11:57:29.444649</font></div><div><font size="2"  >&nbsp; 5 | test | 2013-02-03 11:57:29.44465</font></div><div><font size="2"  >(5 rows)</font></div></div><div><div><font size="2"  >digoal=# \c digoal digoal</font></div><div><font size="2"  >You are now connected to database "digoal" as user "digoal".</font></div><div><font size="2"  >--  注意这个表是超级用户创建的, 未赋予digoal用户读权限, 所以在目录中查看将报错</font></div><div><font size="2"  >digoal=&gt; select * from test;</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation test</font></div></div><p></p></pre></div><div>在目录中查看 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >root@db-172-16-3-150-&gt; pwd</font></div><div><font size="2"  >/mnt/digoal/public</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; cd test</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; ls</font></div><div><font size="2"  >ls: reading directory .: Input/output error</font></div><p></p></pre></div><div>-- 赋予digoal权限 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; \c digoal postgres</font></div><div><font size="2"  >You are now connected to database "digoal" as user "postgres".</font></div><div><font size="2"  >digoal=# grant all on table test to digoal;</font></div><div><font size="2"  >GRANT</font></div><p></p></pre></div><div>再次查看数据正常, 数据以ctid为目录的方式列出, 每个字段1个文件, 并加上顺序序列.</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >root@db-172-16-3-150-&gt; ls</font></div><div><font size="2"  >(0,1) &nbsp;(0,2) &nbsp;(0,3) &nbsp;(0,4) &nbsp;(0,5)</font></div></div><div><div><font size="2"  >root@db-172-16-3-150-&gt; cd \(0\,1\)/</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; ls</font></div><div><font size="2"  >01_id &nbsp;02_info &nbsp;03_crt_time</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; cat *</font></div><div><font size="2"  >1test2013-02-03 11:57:29.444508root@db-172-16-3-150-&gt;&nbsp;</font></div></div><p></p></pre></div><div>代码部分 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; else if (dbpath_is_table(dbpath))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PGresult *res;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int i;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; char str[PATH_MAX];</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str[0] = '\0';</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res = db_query(dbconn, "SELECT attname FROM pg_attribute WHERE attrelid = (SELECT ci.oid FROM pg_class ci, pg_class ct, pg_index i, pg_namespace n WHERE n.oid = ct.relnamespace AND ci.oid = i.indexrelid AND ct.oid = i.indrelid AND n.nspname = '%s' AND ct.relname = '%s' AND NOT EXISTS (SELECT 1 FROM pg_attribute at, pg_attribute ai WHERE at.attrelid = ct.oid AND ai.attrelid = ci.oid AND at.attname = ai.attname AND at.attnum &lt; 0) AND i.indisunique ORDER BY i.indisprimary DESC LIMIT 1) ORDER BY attnum;", dbpath.schema, dbpath.table);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (i = 0; i &lt; PQntuples(res); i++)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcat(str, PQgetvalue(res, i, 0));</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strcat(str, "::text || '_' || ");</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; debug("unique key is %s", str);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PQclear(res);</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res = db_query(dbconn, "SELECT %s ctid FROM %s.%s;", str, dbpath.schema, dbpath.table);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!res)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -EIO;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (i = 0; i &lt; PQntuples(res); i++)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; debug("added row %s", PQgetvalue(res, i, 0));</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filler(buf, PQgetvalue(res, i, 0), NULL, 0);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PQclear(res);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div></div><div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; else if (dbpath_is_row(dbpath))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PGresult *res;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int i;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; res = db_query(dbconn, "SELECT to_char(attnum, 'FM00') || '_' || attname FROM pg_attribute a, pg_class c, pg_namespace n WHERE a.attrelid = c.oid AND c.relnamespace = n.oid AND NOT attisdropped AND attnum &gt; 0 AND n.nspname = '%s' AND c.relname = '%s';", dbpath.schema, dbpath.table);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!res)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -EIO;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (i = 0; i &lt; PQntuples(res); i++)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; debug("added column %s", PQgetvalue(res, i, 0));</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filler(buf, PQgetvalue(res, i, 0), NULL, 0);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PQclear(res);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div></div><p></p></pre></div><div><br></div><div>写测试 :&nbsp;</div><div>-- 由于是STANDBY库, 显然不允许写入.</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >root@db-172-16-3-150-&gt; pwd</font></div><div><font size="2"  >/mnt/digoal/public</font></div></div><div><div><font size="2"  >root@db-172-16-3-150-&gt; mkdir fstest</font></div><div><font size="2"  >mkdir: cannot create directory `fstest': Function not implemented</font></div></div><div><font size="2"  >-- 注意这个报错不是因为不允许写入而造成的, 而是没有实现创建表的转换.</font></div><p></p></pre></div><div>-- 以下则是因为只读造成的错误 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >root@db-172-16-3-150-&gt; cd ..</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; pwd</font></div><div><font size="2"  >/mnt/digoal</font></div><div><font size="2"  >-- 在数据库目录创建文件夹, 相当于创建schema</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; ls</font></div><div><font size="2"  >information_schema &nbsp;pg_catalog &nbsp;pg_temp_1 &nbsp;pg_toast &nbsp;pg_toast_temp_1 &nbsp;public</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; mkdir digoal</font></div><div><font size="2"  >mkdir: cannot create directory `digoal': Input/output error</font></div><p></p></pre></div><div>对应代码 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (dbpath_is_schema(dbpath))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return db_command(dbconn, "CREATE SCHEMA %s;", dbpath.schema);</font></div><p></p></pre></div><div>在集群目录创建文件夹, 相当于创建数据库</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >root@db-172-16-3-150-&gt; cd ..</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; pwd</font></div><div><font size="2"  >/mnt</font></div></div><div><div><font size="2"  >root@db-172-16-3-150-&gt; mkdir dbtest</font></div><div><font size="2"  >mkdir: cannot create directory `dbtest': Input/output error</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"  >对应代码 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; else if (dbpath_is_database(dbpath))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return db_command(dbconn, "CREATE DATABASE %s;", dbpath.database);</font></div><p></p></pre></div><div><br></div><div>-- 连接到PRIMARY 库, 重新挂载目录</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >root@db-172-16-3-150-&gt; cd</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; umount /mnt</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; export PGPORT=9201</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; /home/ocz/postgresql-9.2.1/contrib/postgresqlfs-b5b1a25/postgresqlfs /mnt</font></div><p></p></pre></div><div>创建DBTEST数据库, &nbsp;但是由于挂载时用到的digoal用户没有创建数据库的权限, 所以报错.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >root@db-172-16-3-150-&gt; cd /mnt</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; ll</font></div><div><font size="2"  >total 63K</font></div><div><font size="2"  >drwxr-xr-x 1 root root 42 Feb &nbsp;3 12:02 digoal</font></div><div><font size="2"  >drwxr-xr-x 1 root root 42 Feb &nbsp;3 12:02 postgres</font></div><div><font size="2"  >drwxr-xr-x 1 root root 42 Feb &nbsp;3 12:02 template1</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; mkdir dbtest</font></div><div><font size="2"  >mkdir: cannot create directory `dbtest': Input/output error</font></div><p></p></pre></div><div>-- 赋予超级用户权限</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# alter role digoal superuser;</font></div><div><font size="2"  >ALTER ROLE</font></div><p></p></pre></div><div>再次创建目录成功 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >root@db-172-16-3-150-&gt; mkdir dbtest</font></div><div><font size="2"  >root@db-172-16-3-150-&gt;&nbsp;</font></div><p></p></pre></div><div>-- 在集群目录下创建的目录, 相当于创建数据库 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# \l</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List of databases</font></div><div><font size="2"  >&nbsp; &nbsp;Name &nbsp; &nbsp;| &nbsp;Owner &nbsp; | Encoding | Collate | Ctype | &nbsp; Access privileges &nbsp;&nbsp;</font></div><div><font size="2"  >-----------+----------+----------+---------+-------+-----------------------</font></div><div><font size="2"  >&nbsp;dbtest &nbsp; &nbsp;| digoal &nbsp; | UTF8 &nbsp; &nbsp; | C &nbsp; &nbsp; &nbsp; | C &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"  >&nbsp;digoal &nbsp; &nbsp;| postgres | UTF8 &nbsp; &nbsp; | C &nbsp; &nbsp; &nbsp; | C &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"  >&nbsp;postgres &nbsp;| postgres | UTF8 &nbsp; &nbsp; | C &nbsp; &nbsp; &nbsp; | C &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"  >&nbsp;template0 | postgres | UTF8 &nbsp; &nbsp; | C &nbsp; &nbsp; &nbsp; | C &nbsp; &nbsp; | =c/postgres &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | postgres=CTc/postgres</font></div><div><font size="2"  >&nbsp;template1 | postgres | UTF8 &nbsp; &nbsp; | C &nbsp; &nbsp; &nbsp; | C &nbsp; &nbsp; | =c/postgres &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | postgres=CTc/postgres</font></div><div><font size="2"  >(5 rows)</font></div><p></p></pre></div><div>在数据库目录, 创建目录, 等于创建schema :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >root@db-172-16-3-150-&gt; cd dbtest/</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; mkdir schematest</font></div></div><div><font size="2"  ><br></font></div><div><div><font size="2"  >digoal=# \c dbtest digoal</font></div><div><font size="2"  >You are now connected to database "dbtest" as user "digoal".</font></div><div><font size="2"  >dbtest=# \dn</font></div><div><font size="2"  >&nbsp; &nbsp; List of schemas</font></div><div><font size="2"  >&nbsp; &nbsp; Name &nbsp; &nbsp;| &nbsp;Owner &nbsp;&nbsp;</font></div><div><font size="2"  >------------+----------</font></div><div><font size="2"  >&nbsp;public &nbsp; &nbsp; | postgres</font></div><div><font size="2"  >&nbsp;schematest | digoal</font></div><div><font size="2"  >(2 rows)</font></div></div><p></p></pre></div><div>在schema目录, 创建目录失败, 因为目前没有实现这个函数 :</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >root@db-172-16-3-150-&gt; cd schematest/</font></div><div><font size="2"  >root@db-172-16-3-150-&gt; mkdir tabletest</font></div><div><font size="2"  >mkdir: cannot create directory `tabletest': Function not implemented</font></div><p></p></pre></div><div><br></div><div>以上测试仅供参考, 目前这个功能基本上只能玩玩. 没有什么用途.</div><div><br></div>【参考】<div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresqlfs.git;a=summary"  >http://git.postgresql.org/gitweb/?p=postgresqlfs.git;a=summary</a></div><div>2.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/libpq-envars.html"  >http://www.postgresql.org/docs/9.2/static/libpq-envars.html</a><br><br><wbr></div></div>
	</div>
</div>
</body>
</html>