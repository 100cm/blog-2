<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL batch Get Data|ETL use "cursor" replace "order by PK or (UK+not null) limit $? offset $?"</h2>
	<h5 id="">2013-02-05 13:31:44&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020131510158723/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>从PostgreSQL 读取大量数据, 一般需要分批处理.</div><div>今天一位开发的同事抱怨在某业务中从数据库读取大量数据耗时非常漫长.&nbsp;</div><div>模拟环境如下 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# create table test(id int primary key, crt_time timestamp);</font></div><div><font size="2"  >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "test_pkey" for table "test"</font></div><div><font size="2"  >CREATE TABLE</font></div><div><font size="2"  >postgres=# insert into test select generate_series(1,5000000),clock_timestamp();</font></div><div><font size="2"  >INSERT 0 5000000</font></div><p></p></pre></div><div>每天约有500W条记录插入test表, 该业务每天需要将1天的数据读取出来.</div><div>所以在crt_time上有个时间索引.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# create index idx_test_crt_time on test (crt_time);</font></div><div><font size="2"  >CREATE INDEX</font></div><p></p></pre></div><div>读取的SQL如下, 每次读取2W条 :&nbsp;</div><div><pre class="prettyprint"  ><p><font size="2"  >postgres=# select * from test where crt_time &gt;= '$1'::date and crt_time &lt; '$2'::date order by id limit 20000 offset $3;</font></p></pre></div><div>执行计划 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# explain select * from test where crt_time &gt;= '2013-02-05'::date and crt_time &lt; '2013-02-06'::date order by id limit 20000 offset 0;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >---------------------------------------------------------------------------------------------------</font></div><div><font size="2"  >&nbsp;Limit &nbsp;(cost=73335.94..73385.94 rows=20000 width=12)</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Sort &nbsp;(cost=73335.94..73398.44 rows=25000 width=12)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Sort Key: id</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Index Scan using idx_test_crt_time on test &nbsp;(cost=0.00..71509.74 rows=25000 width=12)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: ((crt_time &gt;= '2013-02-05'::date) AND (crt_time &lt; '2013-02-06'::date))</font></div><div><font size="2"  >(5 rows)</font></div><p></p></pre></div><div>相当于要执行250次以上SQL.才能将所有数据读出.</div><div>测试如下 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >ocz@db-172-16-3-150-&gt; cat test.sh</font></div><div><font size="2"  >#!/bin/bash</font></div><div><font size="2"  >date +%F%T</font></div><div><font size="2"  >for ((i=0;i&lt;250;i++)) do</font></div><div><font size="2"  >psql &lt;&lt;EOF &gt;&gt;/dev/shm/test.out 2&gt;&amp;1</font></div><div><font size="2"  >select * from test where crt_time &gt;= '2013-02-05'::date and crt_time &lt; '2013-02-06'::date order by id limit 20000 offset (20000*$i);</font></div><div><font size="2"  >EOF</font></div><div><font size="2"  >done</font></div><div><font size="2"  >date +%F%T</font></div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >ocz@db-172-16-3-150-&gt; ./test.sh&nbsp;</font></div><div><font size="2"  >2013-02-0510:26:45</font></div><div><font size="2"  >2013-02-0510:56:47</font></div><p></p></pre></div><div>耗时 :&nbsp;</div><div>1802秒.</div><div>work_mem调到4GB后为806秒.</div><div><br></div><div><span style="line-height: 22px;"  >将以上场景改成通过游标的方式 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >ocz@db-172-16-3-150-&gt; cat test.sh</font></div><div><font size="2"  >#!/bin/bash</font></div><div><font size="2"  >for ((i=0;i&lt;250;i++)) do</font></div><div><font size="2"  >&nbsp; SQL=$SQL"fetch 20000 from cur1; "</font></div><div><font size="2"  >done</font></div><div><font size="2"  >echo $SQL</font></div><div><font size="2"  >date +%F%T</font></div><div><font size="2"  >psql &lt;&lt;EOF &gt;&gt;/dev/shm/test.out 2&gt;&amp;1</font></div><div><font size="2"  >begin;</font></div><div><font size="2"  >declare cur1 cursor for select * from test where crt_time &gt;= '2013-02-05'::date and crt_time &lt; '2013-02-06'::date;</font></div><div><font size="2"  >$SQL</font></div><div><font size="2"  >close cur1;</font></div><div><font size="2"  >EOF</font></div><div><font size="2"  >date +%F%T</font></div><p></p></pre></div><div><div style="line-height: 22px;"  >执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >ocz@db-172-16-3-150-&gt; ./test.sh&nbsp;</font></div><div><font size="2"  >fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1; fetch 20000 from cur1;</font></div><div><font size="2"  >2013-02-0513:13:34</font></div><div><font size="2"  >2013-02-0513:14:18</font></div><p></p></pre></div><div style="line-height: 22px;"  >耗时 :&nbsp;</div><div style="line-height: 22px;"  >44秒.</div></div><div style="line-height: 22px;"  ><br></div><div style="line-height: 22px;"  >两种方式性能相差41倍.</div><div><br></div><div>【小结】</div><div>1. 使用第一种方式获取数据, 有2个弊端：</div><div>&nbsp; &nbsp; 1.1 耗费资源, 因为每次都要重新排序.</div><div>&nbsp; &nbsp; 1.2 使用read committed隔离模式, 如果抽取的数据在变更的话, 最终获取到的数据可能不一致(逻辑上不一致).</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 例如A记录和B记录是相互依赖的. A记录抽取后, A,B被更新, 然后抽B记录. 最终A,B记录逻辑上不一致.</div><div>&nbsp; &nbsp; 如果要解决不一致的问题, 必须使用repeatable read或以上隔离模式, 并且开启事务在同一个事务中进行抽取.</div><div>不一致问题再现 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >postgres=# create table test(id int primary key, crt_time timestamp, info text);</font></div><div><font size="2"  >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "test_pkey" for table "test"</font></div><div><font size="2"  >CREATE TABLE</font></div></div><div><div><font size="2"  >postgres=# insert into test select generate_series(1,10), clock_timestamp(), 'test';</font></div><div><font size="2"  >INSERT 0 10</font></div></div><div><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></div><div><div><font size="2"  >postgres=# select * from test order by id limit 1 offset 0;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| info&nbsp;</font></div><div><font size="2"  >----+----------------------------+------</font></div><div><font size="2"  >&nbsp; 1 | 2013-02-05 13:23:19.249236 | test</font></div><div><font size="2"  >(1 row)</font></div></div><div><font size="2"  ><br></font></div><div><span style="line-height: 22px;"  ><font size="2"  >SESSION B(业务进程) :&nbsp;</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  ><div>postgres=# update test set info='new' where id=2;</div><div>UPDATE 1</div><div><br></div><div><span style="line-height: 22px;"  >SESSION A(抽取进程) :&nbsp;</span></div><div><span style="line-height: 22px;"  ><div>postgres=# select * from test order by id limit 1 offset 1;</div><div>&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| info&nbsp;</div><div>----+----------------------------+------</div><div>&nbsp; 2 | 2013-02-05 13:23:19.249515 | new</div><div>(1 row)</div><div>-- 显然这里抽取到的数据不一致, SESSION B的改动在后面的抽取中反映出来了.</div></span></div></font></span></div><p></p></pre></div><div><span style="line-height: 22px;"  >问题解决测试(repeatable read) :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><span style="line-height: 22px;"  ><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  ><div>postgres=# begin ISOLATION LEVEL repeatable read;</div><div>BEGIN</div><div>postgres=# select * from test order by id limit 2 offset 0;</div><div>&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| info&nbsp;</div><div>----+----------------------------+------</div><div>&nbsp; 1 | 2013-02-05 13:23:19.249236 | test</div><div>&nbsp; 2 | 2013-02-05 13:23:19.249515 | new</div><div>(2 rows)</div></font></span></div><div><span style="line-height: 22px;"  ><font size="2"  ><br></font></span></div><div><span style="line-height: 22px;"  ><font size="2"  >SESSION B(业务进程) :&nbsp;</font></span></div><div><div><font size="2"  >postgres=# update test set info='new' where id=3;</font></div><div><font size="2"  >UPDATE 1</font></div></div><div><font size="2"  ><br></font></div><div><span style="line-height: 22px;"  ><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></span></div><div><span style="line-height: 22px;"  ><div><font size="2"  >postgres=# select * from test order by id limit 2 offset 2;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| info&nbsp;</font></div><div><font size="2"  >----+----------------------------+------</font></div><div><font size="2"  >&nbsp; 3 | 2013-02-05 13:23:19.249527 | test</font></div><div><font size="2"  >&nbsp; 4 | 2013-02-05 13:23:19.249532 | test</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  >-- 数据一致, 没有受到SESSION B的影响.</font></div></span></div><p></p></pre></div><div><span style="line-height: 22px;"  ><div><br></div></span></div><div>2. 使用游标抽取解决了以上两个问题.</div><div>测试 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >postgres=# truncate test ;</font></div><div><font size="2"  >TRUNCATE TABLE</font></div></div><div><div><font size="2"  >postgres=# insert into test select generate_series(1,10), clock_timestamp(), 'test';</font></div><div><font size="2"  >INSERT 0 10</font></div></div><div><span style="line-height: 22px;"  ><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  ><div>postgres=# begin;</div><div>BEGIN</div><div>postgres=# declare cur1 cursor for select * from test;</div><div>DECLARE CURSOR</div><div>postgres=# fetch 5 from cur1;</div><div>&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| info&nbsp;</div><div>----+----------------------------+------</div><div>&nbsp; 1 | 2013-02-05 13:27:24.408857 | test</div><div>&nbsp; 2 | 2013-02-05 13:27:24.411389 | test</div><div>&nbsp; 3 | 2013-02-05 13:27:24.411402 | test</div><div>&nbsp; 4 | 2013-02-05 13:27:24.411407 | test</div><div>&nbsp; 5 | 2013-02-05 13:27:24.411412 | test</div><div>(5 rows)</div><div><br></div></font></span></div><div><span style="line-height: 22px;"  ><font size="2"  >SESSION B(业务进程) :&nbsp;</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  ><div>postgres=# update test set info='new' where id=6;</div><div>UPDATE 1</div><div><br></div></font></span></div><div><span style="line-height: 22px;"  ><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></span></div><div><div><font size="2"  >postgres=# fetch 5 from cur1;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| info&nbsp;</font></div><div><font size="2"  >----+----------------------------+------</font></div><div><font size="2"  >&nbsp; 6 | 2013-02-05 13:27:24.411417 | test</font></div><div><font size="2"  >&nbsp; 7 | 2013-02-05 13:27:24.411421 | test</font></div><div><font size="2"  >&nbsp; 8 | 2013-02-05 13:27:24.411426 | test</font></div><div><font size="2"  >&nbsp; 9 | 2013-02-05 13:27:24.411431 | test</font></div><div><font size="2"  >&nbsp;10 | 2013-02-05 13:27:24.411436 | test</font></div><div><font size="2"  >(5 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >postgres=# fetch 5 from cur1;</font></div><div><font size="2"  >&nbsp;id | crt_time | info&nbsp;</font></div><div><font size="2"  >----+----------+------</font></div><div><font size="2"  >(0 rows)</font></div></div><div><font size="2"  >-- 数据一致, 没有受到SESSION B的影响.</font></div><div><font size="2"  >postgres=# close cur1;<br>CLOSE CURSOR</font></div><div><font size="2"  >-- 记得关闭游标.</font></div><p></p></pre></div><div><span style="line-height: 22px;"  ><br></span></div><div><span style="line-height: 22px;"  >3. 如果想不重复抽取数据, 并且不使用排序的话. 怎么办呢? 什么情况下可以这么做?</span></div><div><span style="line-height: 22px;"  >回到本文开头, 本例用到的SQL :&nbsp;</span></div><div>select * from test where crt_time &gt;= '$1'::date and crt_time &lt; '$2'::date order by id limit 20000 offset $3;</div><div>这里对pk:id 做了排序, 然后limit . offset .</div><div>如果不排序直接 limit . offset . 最终可能得到重复的数据.</div><div>那么怎么样不排序又能得到一致的结果呢?</div><div>&nbsp; &nbsp; 1. 让SQL走索引(本例为crt_time).</div><div>&nbsp; &nbsp; 2. 确保取数据的区间内索引不会变更. 例如本例的走的时间索引, 同时这个字段在抽取过程中只会随着时间增长, 不会插入比当前值更小的值.</div><div>或者即使会插入更小的值, 也不会影响到本SQL要取的数据区间的索引page（例如取的是前一天的值, 只要新插入的数据不是前一天的范围就行）.&nbsp;</div><div>满足以上2点, 那么不用排序也可以分页取出逻辑一致的数据.</div><div>虽然如此, 但是最优的方法还是推荐游标, 因为使用offset时每条SQL索引页还是要重复扫的.</div><div>测试环境 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >postgres=# drop table test;</font></div><div><font size="2"  >DROP TABLE</font></div><div><font size="2"  >postgres=# create table test(id int primary key, crt_time timestamp, info text);</font></div><div><font size="2"  >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "test_pkey" for table "test"</font></div><div><font size="2"  >CREATE TABLE</font></div><div><font size="2"  >postgres=# select now();</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; now &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >-------------------------------</font></div><div><font size="2"  >&nbsp;2013-02-05 14:14:43.036225+08</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# insert into test select generate_series(1,10),clock_timestamp(),'digoal';</font></div><div><font size="2"  >INSERT 0 10</font></div><div><font size="2"  >postgres=# create index idx_test_crt_time on test (crt_time);</font></div><div><font size="2"  >CREATE INDEX</font></div><div><font size="2"  >postgres=# select now();</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; now &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >-------------------------------</font></div><div><font size="2"  >&nbsp;2013-02-05 14:15:44.936202+08</font></div><div><font size="2"  >(1 row)</font></div></div><div><font size="2"  >取数区间 :&nbsp;</font></div><div><font size="2"  ><span style="line-height: 22px;"  >2013-02-05 14:14:43.036225 到&nbsp;</span><span style="line-height: 22px;"  >2013-02-05 14:15:44.936202</span></font></div><p></p></pre></div><div><br></div><div>测试(取数范围外) :&nbsp;</div><div>3.1 新增<span style="line-height: 22px;"  >(取数范围外)</span><span style="line-height: 22px;"  >&nbsp;:&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></div><div><font size="2"  >-- 确保抽取进程执行计划正确, 走的是crt_time索引.</font></div><div><div><font size="2"  >postgres=# set enable_seqscan=off;</font></div><div><font size="2"  >SET</font></div><div><font size="2"  >postgres=# explain select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202';</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"  >---------------------------------</font></div><div><font size="2"  >&nbsp;Index Scan using idx_test_crt_time on test &nbsp;(cost=0.00..8.27 rows=1 width=44)</font></div><div><font size="2"  >&nbsp; &nbsp;Index Cond: ((crt_time &gt;= '2013-02-05 14:14:43.036225'::timestamp without time zone) AND (crt_time &lt;= '2013-02-05 14:15:44.936202</font></div><div><font size="2"  >'::timestamp without time zone))</font></div><div><font size="2"  >(2 rows)</font></div></div><div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 0;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 1 | 2013-02-05 14:15:22.751121 | digoal</font></div><div><font size="2"  >&nbsp; 2 | 2013-02-05 14:15:22.751417 | digoal</font></div><div><font size="2"  >&nbsp; 3 | 2013-02-05 14:15:22.751428 | digoal</font></div><div><font size="2"  >&nbsp; 4 | 2013-02-05 14:15:22.751433 | digoal</font></div><div><font size="2"  >&nbsp; 5 | 2013-02-05 14:15:22.751438 | digoal</font></div><div><font size="2"  >(5 rows)</font></div></div><div><font size="2"  ><br></font></div><div><font size="2"  >SESSION B(业务进程) :&nbsp;</font></div><div><font size="2"  >-- 在取数范围前后各插入1条数据.</font></div><div><div><font size="2"  >postgres=# insert into test values (0, '2013-02-04 14:14:43.036225', 'digoal');</font></div><div><font size="2"  >INSERT 0 1</font></div><div><font size="2"  >postgres=# insert into test values (11, '2013-02-06 14:14:43.036225', 'digoal');</font></div><div><font size="2"  >INSERT 0 1</font></div></div><div><font size="2"  ><br></font></div><div><span style="line-height: 22px;"  ><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></span></div><div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 5;&nbsp;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 6 | 2013-02-05 14:15:22.751443 | digoal</font></div><div><font size="2"  >&nbsp; 7 | 2013-02-05 14:15:22.751448 | digoal</font></div><div><font size="2"  >&nbsp; 8 | 2013-02-05 14:15:22.751452 | digoal</font></div><div><font size="2"  >&nbsp; 9 | 2013-02-05 14:15:22.751457 | digoal</font></div><div><font size="2"  >&nbsp;10 | 2013-02-05 14:15:22.751462 | digoal</font></div><div><font size="2"  >(5 rows)</font></div></div><div><font size="2"  >-- 数据抽取正常</font></div><p></p></pre></div><div><br></div><div>3.2 修改<span style="line-height: 22px;"  >(取数范围外)</span><span style="line-height: 22px;"  >&nbsp;:&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><span style="line-height: 22px;"  ><font size="2"  >-- 先确保抽取走crt_time索引, 略, 同上.</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></span></div><div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 0;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 1 | 2013-02-05 14:15:22.751121 | digoal</font></div><div><font size="2"  >&nbsp; 2 | 2013-02-05 14:15:22.751417 | digoal</font></div><div><font size="2"  >&nbsp; 3 | 2013-02-05 14:15:22.751428 | digoal</font></div><div><font size="2"  >&nbsp; 4 | 2013-02-05 14:15:22.751433 | digoal</font></div><div><font size="2"  >&nbsp; 5 | 2013-02-05 14:15:22.751438 | digoal</font></div><div><font size="2"  >(5 rows)</font></div><div><span style="line-height: 22px;"  ><font size="2"  >SESSION B(业务进程) :&nbsp;</font></span></div><div><font size="2"  >postgres=# update test set crt_time='2013-02-03 14:14:43.036225',id=-1,info='test' where id=0;</font></div><div><font size="2"  >UPDATE 1</font></div><div><font size="2"  >postgres=# update test set crt_time='2013-02-07 14:14:43.036225',id=12,info='test' where id=11;</font></div><div><font size="2"  >UPDATE 1</font></div><div><span style="line-height: 22px;"  ><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></span></div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 5;&nbsp;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 6 | 2013-02-05 14:15:22.751443 | digoal</font></div><div><font size="2"  >&nbsp; 7 | 2013-02-05 14:15:22.751448 | digoal</font></div><div><font size="2"  >&nbsp; 8 | 2013-02-05 14:15:22.751452 | digoal</font></div><div><font size="2"  >&nbsp; 9 | 2013-02-05 14:15:22.751457 | digoal</font></div><div><font size="2"  >&nbsp;10 | 2013-02-05 14:15:22.751462 | digoal</font></div><div><font size="2"  >(5 rows)</font></div></div><p></p></pre></div><div><br></div><div>3.3 删除<span style="line-height: 22px;"  >(取数范围外)</span><span style="line-height: 22px;"  >&nbsp;:&nbsp;</span></div><div><div style="line-height: 22px;"  ><pre class="prettyprint"  ><p></p><div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  >-- 先确保抽取走crt_time索引, 略, 同上.</font></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></span></div></div><div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 0;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 1 | 2013-02-05 14:15:22.751121 | digoal</font></div><div><font size="2"  >&nbsp; 2 | 2013-02-05 14:15:22.751417 | digoal</font></div><div><font size="2"  >&nbsp; 3 | 2013-02-05 14:15:22.751428 | digoal</font></div><div><font size="2"  >&nbsp; 4 | 2013-02-05 14:15:22.751433 | digoal</font></div><div><font size="2"  >&nbsp; 5 | 2013-02-05 14:15:22.751438 | digoal</font></div><div><font size="2"  >(5 rows)</font></div></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  >SESSION B(业务进程) :&nbsp;</font></span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  >postgres=# delete from test where id=-1;</font></div><div style="line-height: 22px;"  ><font size="2"  >DELETE 1</font></div><div style="line-height: 22px;"  ><font size="2"  >postgres=# delete from test where id=12;</font></div><div style="line-height: 22px;"  ><font size="2"  >DELETE 1</font></div></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  >SESSION A(抽取进程) :&nbsp;</font></span></div><div style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 5;&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >----+----------------------------+--------</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; 6 | 2013-02-05 14:15:22.751443 | digoal</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; 7 | 2013-02-05 14:15:22.751448 | digoal</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; 8 | 2013-02-05 14:15:22.751452 | digoal</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; 9 | 2013-02-05 14:15:22.751457 | digoal</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp;10 | 2013-02-05 14:15:22.751462 | digoal</font></div><div style="line-height: 22px;"  ><font size="2"  >(5 rows)</font></div></div><p></p></pre></div></div><div style="line-height: 22px;"  ><br></div><div><div style="line-height: 22px;"  >测试(取数范围内的crt_time索引字段变更, 可能导致结果不一致或重复) :&nbsp;</div><div style="line-height: 22px;"  >3.4 新增<span style="line-height: 22px;"  >(取数范围内, 准确来说是已经取数的区间)</span><span style="line-height: 22px;"  >&nbsp;:&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 0;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 1 | 2013-02-05 14:15:22.751121 | digoal</font></div><div><font size="2"  >&nbsp; 2 | 2013-02-05 14:15:22.751417 | digoal</font></div><div><font size="2"  >&nbsp; 3 | 2013-02-05 14:15:22.751428 | digoal</font></div><div><font size="2"  >&nbsp; 4 | 2013-02-05 14:15:22.751433 | digoal</font></div><div><font size="2"  >&nbsp; 5 | 2013-02-05 14:15:22.751438 | digoal</font></div><div><font size="2"  >(5 rows)</font></div><div><font size="2"  >postgres=# insert into test values (0,'2013-02-05 14:15:22.751433','new');</font></div><div><font size="2"  >INSERT 0 1</font></div><div><font size="2"  >-- ID=5的记录重复抽取 :&nbsp;</font></div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 5;&nbsp;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 5 | 2013-02-05 14:15:22.751438 | digoal</font></div><div><font size="2"  >&nbsp; 6 | 2013-02-05 14:15:22.751443 | digoal</font></div><div><font size="2"  >&nbsp; 7 | 2013-02-05 14:15:22.751448 | digoal</font></div><div><font size="2"  >&nbsp; 8 | 2013-02-05 14:15:22.751452 | digoal</font></div><div><font size="2"  >&nbsp; 9 | 2013-02-05 14:15:22.751457 | digoal</font></div><div><font size="2"  >(5 rows)</font></div><p></p></pre></div><div style="line-height: 22px;"  >在未取数区间新增对结果没影响 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# delete from test where id=0;</font></div><div><font size="2"  >DELETE 1</font></div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 0;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 1 | 2013-02-05 14:15:22.751121 | digoal</font></div><div><font size="2"  >&nbsp; 2 | 2013-02-05 14:15:22.751417 | digoal</font></div><div><font size="2"  >&nbsp; 3 | 2013-02-05 14:15:22.751428 | digoal</font></div><div><font size="2"  >&nbsp; 4 | 2013-02-05 14:15:22.751433 | digoal</font></div><div><font size="2"  >&nbsp; 5 | 2013-02-05 14:15:22.751438 | digoal</font></div><div><font size="2"  >(5 rows)</font></div><div><font size="2"  >postgres=# insert into test values (0,'2013-02-05 14:15:22.751457','new');</font></div><div><font size="2"  >INSERT 0 1</font></div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 5;&nbsp;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 6 | 2013-02-05 14:15:22.751443 | digoal</font></div><div><font size="2"  >&nbsp; 7 | 2013-02-05 14:15:22.751448 | digoal</font></div><div><font size="2"  >&nbsp; 8 | 2013-02-05 14:15:22.751452 | digoal</font></div><div><font size="2"  >&nbsp; 0 | 2013-02-05 14:15:22.751457 | new</font></div><div><font size="2"  >&nbsp; 9 | 2013-02-05 14:15:22.751457 | digoal</font></div><div><font size="2"  >(5 rows)</font></div><p></p></pre></div><div style="line-height: 22px;"  ><br></div><div style="line-height: 22px;"  >3.5 修改<span style="line-height: 22px;"  >(取数范围内, 准确来说是已取数的区间记录修改到未取数区间, 或者未取数区间的数据修改到未取数区间以外的其他区间)</span><span style="line-height: 22px;"  >&nbsp;:&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >postgres=# delete from test &nbsp;where id=0;</font></div><div><font size="2"  >DELETE 1</font></div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 0;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 1 | 2013-02-05 14:15:22.751121 | digoal</font></div><div><font size="2"  >&nbsp; 2 | 2013-02-05 14:15:22.751417 | digoal</font></div><div><font size="2"  >&nbsp; 3 | 2013-02-05 14:15:22.751428 | digoal</font></div><div><font size="2"  >&nbsp; 4 | 2013-02-05 14:15:22.751433 | digoal</font></div><div><font size="2"  >&nbsp; 5 | 2013-02-05 14:15:22.751438 | digoal</font></div><div><font size="2"  >(5 rows)</font></div></div><div><div><font size="2"  >postgres=# update test set crt_time = '2013-02-05 14:15:22.751448' where id=5;</font></div><div><font size="2"  >UPDATE 1</font></div><div><font size="2"  >-- ID=6的记录抽取不到, 并且已抽取数据的CRT_time最大的那条记录将重复抽取.</font></div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 5;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 5 | 2013-02-05 14:15:22.751448 | digoal</font></div><div><font size="2"  >&nbsp; 7 | 2013-02-05 14:15:22.751448 | digoal</font></div><div><font size="2"  >&nbsp; 8 | 2013-02-05 14:15:22.751452 | digoal</font></div><div><font size="2"  >&nbsp; 9 | 2013-02-05 14:15:22.751457 | digoal</font></div><div><font size="2"  >&nbsp;10 | 2013-02-05 14:15:22.751462 | digoal</font></div><div><font size="2"  >(5 rows)</font></div></div><p></p></pre></div><div style="line-height: 22px;"  ><br></div><div style="line-height: 22px;"  >3.6 删除<span style="line-height: 22px;"  >(取数范围内, 准确来说是删除已取数区间的数据, 将导致有数据抽取不到)</span><span style="line-height: 22px;"  >&nbsp;:&nbsp;</span></div></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# update test set crt_time = '2013-02-05 14:15:22.751438' where id=5;</font></div><div><font size="2"  >UPDATE 1</font></div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 0;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 1 | 2013-02-05 14:15:22.751121 | digoal</font></div><div><font size="2"  >&nbsp; 2 | 2013-02-05 14:15:22.751417 | digoal</font></div><div><font size="2"  >&nbsp; 3 | 2013-02-05 14:15:22.751428 | digoal</font></div><div><font size="2"  >&nbsp; 4 | 2013-02-05 14:15:22.751433 | digoal</font></div><div><font size="2"  >&nbsp; 5 | 2013-02-05 14:15:22.751438 | digoal</font></div><div><font size="2"  >(5 rows)</font></div><div><font size="2"  >postgres=# delete from test where id=1;</font></div><div><font size="2"  >DELETE 1</font></div><div><font size="2"  >-- ID=6的记录将抽取不到.</font></div><div><font size="2"  >postgres=# select * from test where crt_time between '2013-02-05 14:14:43.036225' and '2013-02-05 14:15:44.936202' limit 5 offset 5;&nbsp;</font></div><div><font size="2"  >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;info &nbsp;</font></div><div><font size="2"  >----+----------------------------+--------</font></div><div><font size="2"  >&nbsp; 7 | 2013-02-05 14:15:22.751448 | digoal</font></div><div><font size="2"  >&nbsp; 8 | 2013-02-05 14:15:22.751452 | digoal</font></div><div><font size="2"  >&nbsp; 9 | 2013-02-05 14:15:22.751457 | digoal</font></div><div><font size="2"  >&nbsp;10 | 2013-02-05 14:15:22.751462 | digoal</font></div><div><font size="2"  >(4 rows)</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 22px;"  ><br></span></div>【参考】<div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://jdbc.postgresql.org/documentation/head/query.html"  >http://jdbc.postgresql.org/documentation/head/query.html</a></div><div>2.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/libpq-exec.html"  >http://www.postgresql.org/docs/9.2/static/libpq-exec.html</a><br><br><wbr></div></div>
	</div>
</div>
</body>
</html>