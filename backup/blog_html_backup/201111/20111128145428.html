<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PHP use DATE type in PostgreSQL</h2>
	<h5 id="">2011-11-28 14:54:28&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402011102825311681/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">一位哥们碰到的比较头痛的问题，PHP在传入DATE类型给POSTGRESQL的时候，会报错。<div>因为PHP实际上传的是个字符串，报错是当然滴。</div><div><br>如果是函数的话，解决办法是输入参数的类型改成TEXT，在函数里面再转一次。当然这不是什么好的方法，</div><div><br></div><div>如下 :&nbsp;</div><div><div>digoal=&gt; create or replace function f_php_date_test(i_date text) returns date as $BODY$</div><div>declare</div><div>v_date date;</div><div>begin</div><div>set datestyle = 'iso, ymd';</div><div>v_date := i_date::date;</div><div>return v_date;</div><div>end;</div><div>$BODY$ language plpgsql;</div><div>CREATE FUNCTION</div><div>Time: 0.679 ms</div></div><div><br></div><div><div>digoal=&gt; select * from f_php_date_test('2011-12-11');</div><div>&nbsp;f_php_date_test&nbsp;</div><div>-----------------</div><div>&nbsp;2011-12-11</div><div>(1 row)</div></div><div><br></div><div>更直接的方法是PHP传入的时候带上类型转换。</div><div><span style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(245, 245, 255);"  >Well, I'm pretty sure there's nothing wrong with postgres or php - there will be a bug in your code somewhere.</span><br style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  ><br style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  ><span style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  >For starters, you are coding in a very dangerous style. Try using this as your query instead:</span><br style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  ><br style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  ><span style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  >INSERT INTO board_uid_pooltracking (type, first, last) VALUES ('$TYPE', '$FIRST'::int8, '$LAST'::int8);</span><br style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  ><br style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  ><span style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  >Also, add an 'echo $QUERY' after the '$QUERY=' line and tell us exactly what the query is when it fails.</span><br style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  ><br style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  ><span style="color: rgb(51, 51, 51); font-family: verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; text-align: -webkit-auto; background-color: rgb(245, 245, 255);"  >Chris</span></div><div><br></div><div><br></div><div>【参考】</div><div><a rel="nofollow" href="http://www.phpbuilder.com/board/showthread.php?t=634773"  >http://www.phpbuilder.com/board/showthread.php?t=634773</a></div></div>
	</div>
</div>
</body>
</html>