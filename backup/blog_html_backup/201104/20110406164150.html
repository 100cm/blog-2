<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL Role Membership</h2>
	<h5 id="">2011-04-06 16:41:50&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402011362564157/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">在PostgreSQL中有用户,角色以及组的术语，表达的是同样的意思。<br>因此在PostgreSQL的语法上,user,role,group实际上是相通的。<br>如,<br><pre class="prettyprint"  ><p><font size="2"  >create role<br>create user<br>create group</font></p></pre>语法<br><pre class="prettyprint"  ><p><font size="2"  >postgres=# \h create role<br>Command:&nbsp;&nbsp;&nbsp;&nbsp; CREATE ROLE<br>Description: define a new database role<br>Syntax:<br>CREATE ROLE name [ [ WITH ] option [ ... ] ]<br><br>where option can be:<br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUPERUSER | NOSUPERUSER<br>&nbsp;&nbsp;&nbsp; | CREATEDB | NOCREATEDB<br>&nbsp;&nbsp;&nbsp; | CREATEROLE | NOCREATEROLE<br>&nbsp;&nbsp;&nbsp; | CREATEUSER | NOCREATEUSER<br>&nbsp;&nbsp;&nbsp; | INHERIT | NOINHERIT<br>&nbsp;&nbsp;&nbsp; | LOGIN | NOLOGIN<br>&nbsp;&nbsp;&nbsp; | CONNECTION LIMIT connlimit<br>&nbsp;&nbsp;&nbsp; | [ ENCRYPTED | UNENCRYPTED ] PASSWORD 'password'<br>&nbsp;&nbsp;&nbsp; | VALID UNTIL 'timestamp' <br>&nbsp;&nbsp;&nbsp; | IN ROLE role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | IN GROUP role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | ROLE role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | ADMIN role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | USER role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | SYSID uid<br><br>postgres=# \h create user<br>Command:&nbsp;&nbsp;&nbsp;&nbsp; CREATE USER<br>Description: define a new database role<br>Syntax:<br>CREATE USER name [ [ WITH ] option [ ... ] ]<br><br>where option can be:<br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUPERUSER | NOSUPERUSER<br>&nbsp;&nbsp;&nbsp; | CREATEDB | NOCREATEDB<br>&nbsp;&nbsp;&nbsp; | CREATEROLE | NOCREATEROLE<br>&nbsp;&nbsp;&nbsp; | CREATEUSER | NOCREATEUSER<br>&nbsp;&nbsp;&nbsp; | INHERIT | NOINHERIT<br>&nbsp;&nbsp;&nbsp; | LOGIN | NOLOGIN<br>&nbsp;&nbsp;&nbsp; | CONNECTION LIMIT connlimit<br>&nbsp;&nbsp;&nbsp; | [ ENCRYPTED | UNENCRYPTED ] PASSWORD 'password'<br>&nbsp;&nbsp;&nbsp; | VALID UNTIL 'timestamp' <br>&nbsp;&nbsp;&nbsp; | IN ROLE role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | IN GROUP role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | ROLE role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | ADMIN role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | USER role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | SYSID uid<br><br>postgres=# \h create group<br>Command:&nbsp;&nbsp;&nbsp;&nbsp; CREATE GROUP<br>Description: define a new database role<br>Syntax:<br>CREATE GROUP name [ [ WITH ] option [ ... ] ]<br><br>where option can be:<br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUPERUSER | NOSUPERUSER<br>&nbsp;&nbsp;&nbsp; | CREATEDB | NOCREATEDB<br>&nbsp;&nbsp;&nbsp; | CREATEROLE | NOCREATEROLE<br>&nbsp;&nbsp;&nbsp; | CREATEUSER | NOCREATEUSER<br>&nbsp;&nbsp;&nbsp; | INHERIT | NOINHERIT<br>&nbsp;&nbsp;&nbsp; | LOGIN | NOLOGIN<br>&nbsp;&nbsp;&nbsp; | [ ENCRYPTED | UNENCRYPTED ] PASSWORD 'password'<br>&nbsp;&nbsp;&nbsp; | VALID UNTIL 'timestamp' <br>&nbsp;&nbsp;&nbsp; | IN ROLE role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | IN GROUP role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | ROLE role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | ADMIN role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | USER role_name [, ...]<br>&nbsp;&nbsp;&nbsp; | SYSID uid</font></p></pre><br>很明显，干的是同一件事情。（下面的描述中将使用”用户“来代表，用户、角色和组。）<br>注意到，在创建一个用户时，可以选择inherit或noinherit。什么意思呢？这里就涉及到用户的membership。<br>可以把用户赋予给用户。<br>如 GRANT role_name [, ...] TO role_name [, ...] [ WITH ADMIN OPTION ]<br>下面来看一下inherit和noinherit有什么区别 : <br><tt><pre class="prettyprint"  ><p><font size="2"  >postgres=# create role role_a nosuperuser nocreatedb nocreaterole inherit login encrypted password '123456';<br>CREATE ROLE<br>postgres=# create role role_b nosuperuser nocreatedb nocreaterole noinherit login encrypted password '123456';<br>CREATE ROLE<br>postgres=# grant connect on database digoal to role_b;<br>GRANT<br>digoal=# revoke all on database digoal from public;<br>REVOKE<br>digoal=# \c digoal role_a<br>FATAL:&nbsp; permission denied for database "digoal"<br>DETAIL:&nbsp; User does not have CONNECT privilege.<br>Previous connection kept<br>digoal=# \c digoal role_b<br>You are now connected to database "digoal" as user "role_b".<br>digoal=&gt; \c postgres postgres<br>You are now connected to database "postgres" as user "postgres".<br>postgres=# grant role_b to role_a;<br>GRANT ROLE<br>postgres=# \c digoal role_a&nbsp; 当role_b赋予给role_a后，由于role_a有inherit属性,所以登录role_a时会直接继承来自role_b的权限。<br>You are now connected to database "digoal" as user "role_a".<br>digoal=&gt; \c postgres postgres<br>You are now connected to database "postgres" as user "postgres".<br>postgres=# alter role role_a noinherit;<br>ALTER ROLE<br>postgres=# \c digoal role_a&nbsp;&nbsp; role_a关闭了inherit属性,所以登录role_a时不能直接继承来自role_b的权限，因此无法登陆digoal数据库。<br>FATAL:&nbsp; permission denied for database "digoal"<br>DETAIL:&nbsp; User does not have CONNECT privilege.<br>Previous connection kept<br><br>inherit特例,无法继承<tt>LOGIN</tt>, <tt>SUPERUSER</tt>,    <tt>CREATEDB</tt>, and </font><tt><font size="2"  >CREATEROLE, CREATEUSER的权限。这些属于特殊权限，必须在建用户时直接赋予.</font></tt></p></pre><br>如果用户创建时选择的是noinherit ， 那么被赋予的role只能通过set role来调用。如<br><pre class="prettyprint"  ><p><font size="2"  >postgres=# grant all on database digoal to public;<br>GRANT<br>postgres=# alter role role_a noinherit;<br>ALTER ROLE<br>postgres=# \c digoal digoal<br>digoal=&gt; grant all on table tbl_test to role_b;<br>GRANT<br>digoal=&gt; grant all on schema digoal to role_b;<br>GRANT<br>digoal=&gt; \c digoal role_a;<br>digoal=&gt; begin;delete from digoal.tbl_test;<br>BEGIN<br>ERROR:&nbsp; permission denied for schema digoal<br>LINE 1: delete from digoal.tbl_test;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^<br>digoal=&gt; rollback;<br>digoal=&gt; set role role_b;&nbsp; 没有inherit属性时，需要通过 set role 来切换 role。<br>SET<br>digoal=&gt; begin;delete from digoal.tbl_test;<br>BEGIN<br>DELETE 4<br>digoal=&gt; rollback;<br>ROLLBACK</font></p></pre><br>回到原始ROLE : <br><pre class="prettyprint"  ><p><font size="2"  >digoal=&gt; set role none;<br>SET<br>digoal=&gt; begin;delete from digoal.tbl_test;<br>BEGIN<br>ERROR:&nbsp; permission denied for schema digoal<br>LINE 1: delete from digoal.tbl_test;</font></p></pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^<br>可以使用</tt>以下命令回到原始ROLE : <br><tt><pre class="prettyprint"  ><p><font size="2"  >SET ROLE role_a ; <br>SET ROLE NONE ; <br>RESET ROLE ; </font></p></pre></tt><br>在SQL标准中，ROLE带有inherit属性，USER不带有inherit属性。但是在PostgreSQL中创建一个用户时，默认是inherit的。<br>看需求来设置了。</div>
	</div>
</div>
</body>
</html>