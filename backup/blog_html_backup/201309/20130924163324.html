<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL integration with pg_matlab</h2>
	<h5 id="">2013-09-24 16:33:24&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201382383321464/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>pg_matlab是一个pg插件, 并非一般的过程语言. 使用pg_matlab创建的函数必须转换成c代码后, 编译并在数据库中使用共享库的方式调用.</div><div><br></div><div>pg_matlab下载和安装 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >wget http://www.cybertec.at/download/pg_matlab/pg_matlab-v2.tar.gz</font></div><div><font size="2"   >tar -zxvf pg_matlab-v2.tar.gz</font></div><div><font size="2"   >mv pg_matlab /opt/soft_bak/postgresql-9.3beta2/contrib/</font></div><div><font size="2"   >[root@db-172-16-3-39 contrib]# cd /opt/soft_bak/postgresql-9.3beta2/contrib/pg_matlab/</font></div><div><font size="2"   >[root@db-172-16-3-39 pg_matlab]# . /home/pg93/.bash_profile&nbsp;</font></div><div><font size="2"   >root@db-172-16-3-39-&gt; which pg_config</font></div><div><font size="2"   >/opt/pgsql9.3beta2/bin/pg_config</font></div><div><font size="2"   >root@db-172-16-3-39-&gt; gmake clean</font></div><div><font size="2"   >gmake clean -e -C matcored</font></div><div><font size="2"   >gmake[1]: Entering directory `/opt/soft_bak/postgresql-9.3beta2/contrib/pg_matlab/matcored'</font></div><div><font size="2"   >rm -f matcored.o mat_wrapper.o matcored</font></div><div><font size="2"   >gmake[1]: Leaving directory `/opt/soft_bak/postgresql-9.3beta2/contrib/pg_matlab/matcored'</font></div><div><font size="2"   >USE_PGXS=1 gmake clean -e -C libmatpg</font></div><div><font size="2"   >gmake[1]: Entering directory `/opt/soft_bak/postgresql-9.3beta2/contrib/pg_matlab/libmatpg'</font></div><div><font size="2"   >rm -f matpg.so &nbsp; libmatpg.a &nbsp;libmatpg.pc</font></div><div><font size="2"   >rm -f create_mat_pg_operators.sql</font></div><div><font size="2"   >rm -f mat_pg_funcs.o</font></div><div><font size="2"   >gmake[1]: Leaving directory `/opt/soft_bak/postgresql-9.3beta2/contrib/pg_matlab/libmatpg'</font></div><div><font size="2"   >root@db-172-16-3-39-&gt; gmake</font></div><div><font size="2"   >gmake -e -C matcored</font></div><div><font size="2"   >gmake[1]: Entering directory `/opt/soft_bak/postgresql-9.3beta2/contrib/pg_matlab/matcored'</font></div><div><font size="2"   >cc -Wall -c -o matcored.o matcored.c -I/extern/include -I../libmatcore/distrib</font></div><div><font size="2"   >In file included from matcored.c:15:</font></div><div><font size="2"   >../libmatcore/distrib/libmatcore.h:17:22: error: mclmcrrt.h: No such file or directory</font></div><div><font size="2"   >In file included from matcored.c:15:</font></div><div><font size="2"   >../libmatcore/distrib/libmatcore.h:63: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘MW_CALL_CONV’</font></div><div><font size="2"   >../libmatcore/distrib/libmatcore.h:68: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘MW_CALL_CONV’</font></div><div><font size="2"   >../libmatcore/distrib/libmatcore.h:71: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘libmatcoreTerminate’</font></div><div><font size="2"   >../libmatcore/distrib/libmatcore.h:76: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘libmatcorePrintStackTrace’</font></div><div><font size="2"   >../libmatcore/distrib/libmatcore.h:79: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘MW_CALL_CONV’</font></div><div><font size="2"   >../libmatcore/distrib/libmatcore.h:82: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘libmatcoreGetMcrID’</font></div><div><font size="2"   >../libmatcore/distrib/libmatcore.h:86: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘MW_CALL_CONV’</font></div><div><font size="2"   >matcored.c: In function ‘send_matcored_response’:</font></div><div><font size="2"   >matcored.c:60: warning: implicit declaration of function ‘strncpy’</font></div><div><font size="2"   >matcored.c:60: warning: incompatible implicit declaration of built-in function ‘strncpy’</font></div><div><font size="2"   >matcored.c:60: warning: implicit declaration of function ‘strlen’</font></div><div><font size="2"   >matcored.c:60: warning: incompatible implicit declaration of built-in function ‘strlen’</font></div><div><font size="2"   >matcored.c: In function ‘send_matcored_error’:</font></div><div><font size="2"   >matcored.c:74: warning: incompatible implicit declaration of built-in function ‘strncpy’</font></div><div><font size="2"   >matcored.c:74: warning: incompatible implicit declaration of built-in function ‘strlen’</font></div><div><font size="2"   >matcored.c:81: warning: implicit declaration of function ‘memset’</font></div><div><font size="2"   >matcored.c:81: warning: incompatible implicit declaration of built-in function ‘memset’</font></div><div><font size="2"   >matcored.c: At top level:</font></div><div><font size="2"   >matcored.c:99: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘read_int_param’</font></div><div><font size="2"   >matcored.c: In function ‘send_int_param’:</font></div><div><font size="2"   >matcored.c:141: warning: incompatible implicit declaration of built-in function ‘strncpy’</font></div><div><font size="2"   >matcored.c:141: warning: incompatible implicit declaration of built-in function ‘strlen’</font></div><div><font size="2"   >matcored.c: At top level:</font></div><div><font size="2"   >matcored.c:150: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘read_binary_param’</font></div><div><font size="2"   >matcored.c: In function ‘send_binary_param’:</font></div><div><font size="2"   >matcored.c:186: warning: incompatible implicit declaration of built-in function ‘strncpy’</font></div><div><font size="2"   >matcored.c:186: warning: incompatible implicit declaration of built-in function ‘strlen’</font></div><div><font size="2"   >matcored.c: In function ‘init_matcore’:</font></div><div><font size="2"   >matcored.c:197: warning: implicit declaration of function ‘libmatcoreInitialize’</font></div><div><font size="2"   >matcored.c: In function ‘terminate_matcore’:</font></div><div><font size="2"   >matcored.c:207: warning: implicit declaration of function ‘libmatcoreTerminate’</font></div><div><font size="2"   >matcored.c: In function ‘add_vector’:</font></div><div><font size="2"   >matcored.c:226: warning: implicit declaration of function ‘read_int_param’</font></div><div><font size="2"   >matcored.c:231: warning: implicit declaration of function ‘read_binary_param’</font></div><div><font size="2"   >matcored.c: In function ‘handle_client’:</font></div><div><font size="2"   >matcored.c:276: warning: implicit declaration of function ‘strncmp’</font></div><div><font size="2"   >matcored.c:276: warning: incompatible implicit declaration of built-in function ‘strlen’</font></div><div><font size="2"   >matcored.c: In function ‘set_sighandler’:</font></div><div><font size="2"   >matcored.c:346: warning: incompatible implicit declaration of built-in function ‘memset’</font></div><div><font size="2"   >matcored.c: In function ‘listen_on_port’:</font></div><div><font size="2"   >matcored.c:371: warning: incompatible implicit declaration of built-in function ‘memset’</font></div><div><font size="2"   >matcored.c: In function ‘connect_on_port’:</font></div><div><font size="2"   >matcored.c:435: warning: incompatible implicit declaration of built-in function ‘memset’</font></div><div><font size="2"   >matcored.c:447: warning: incompatible implicit declaration of built-in function ‘strncpy’</font></div><div><font size="2"   >matcored.c: In function ‘main’:</font></div><div><font size="2"   >matcored.c:471: warning: implicit declaration of function ‘strcmp’</font></div><div><font size="2"   >gmake[1]: *** [matcored.o] Error 1</font></div><div><font size="2"   >gmake[1]: Leaving directory `/opt/soft_bak/postgresql-9.3beta2/contrib/pg_matlab/matcored'</font></div><div><font size="2"   >gmake: *** [all] Error 2</font></div><p></p></pre></div><div><br></div><div>错误来自libmatcore/distrib/libmatcore.h</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* MATLAB Compiler: 4.13 (R2010a)</font></div><div><font size="2"   >&nbsp;* Date: Thu Feb 10 10:54:51 2011</font></div><div><font size="2"   >&nbsp;* Arguments: "-B" "macro_default" "-W" "lib:libmatcore" "-T" "link:lib" "-d"</font></div><div><font size="2"   >&nbsp;* "/home/babak/Downloads/pg_matlab/libmatcore/src" "-w"</font></div><div><font size="2"   >&nbsp;* "enable:specified_file_mismatch" "-w" "enable:repeated_file" "-w"</font></div><div><font size="2"   >&nbsp;* "enable:switch_ignored" "-w" "enable:missing_lib_sentinel" "-w"</font></div><div><font size="2"   >&nbsp;* "enable:demo_license" "-g" "-G" "-v" "/home/babak/Downloads/pg_matlab/add.m"&nbsp;</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >#include "mclmcrrt.h"</font></div><p></p></pre></div><div>头文件不存在, 因此在安装pg_matlab前需要先安装MCR.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >unzip MCR_R2012a_glnxa64_installer.zip</font></div><div><font size="2"   >修改输入文件文件</font></div><div><font size="2"   >vi installer_input.txt</font></div><div><font size="2"   >agreeToLicense=yes</font></div><div><font size="2"   >product.MATLAB_Compiler</font></div><p></p></pre></div><div>安装&nbsp;</div><pre class="prettyprint"   ><p></p><div><font size="2"   >./install -mode silent -inputFile ./installer_input.txt</font></div><div></div><p></p></pre><div><span style="line-height: 23px;"   >安装正常的输出 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >添加到LD_LIBRARY_PATH</font></div><div><font size="2"   >/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/runtime/glnxa64:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/bin/glnxa64:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/sys/os/glnxa64:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/sys/java/jre/glnxa64/jre/lib/amd64/native_threads:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/sys/java/jre/glnxa64/jre/lib/amd64/server:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/sys/java/jre/glnxa64/jre/lib/amd64</font></div><div><font size="2"   >Next, set the XAPPLRESDIR environment variable to the following value:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/X11/app-defaults</font></div><div><font size="2"   >(Sep 25, 2013 16:02:28) Exiting with status 0</font></div><div><font size="2"   >(Sep 25, 2013 16:02:28) End - Successful.</font></div><div><font size="2"   >Finished</font></div><p></p></pre></div><div>mcr默认安装到这里来了</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; ll /usr/local/MATLAB/MATLAB_Compiler_Runtime/v717</font></div><div><font size="2"   >total 136K</font></div><div><font size="2"   >drwxr-xr-x &nbsp;5 root root 4.0K Sep 25 16:02 appdata</font></div><div><font size="2"   >drwxr-xr-x &nbsp;5 root root 4.0K Sep 25 16:02 bin</font></div><div><font size="2"   >drwxr-xr-x &nbsp;3 root root 4.0K Sep 25 16:02 etc</font></div><div><font size="2"   >drwxr-xr-x &nbsp;4 root root 4.0K Sep 25 16:02 extern</font></div><div><font size="2"   >drwxr-xr-x &nbsp;3 root root 4.0K Sep 25 16:02 help</font></div><div><font size="2"   >drwxr-xr-x &nbsp;4 root root 4.0K Sep 25 16:02 java</font></div><div><font size="2"   >-r--r--r-- &nbsp;1 root root &nbsp;72K Jan 15 &nbsp;2012 license.txt</font></div><div><font size="2"   >-r--r--r-- &nbsp;1 root root 5.1K Dec 21 &nbsp;2011 MCR_license.txt</font></div><div><font size="2"   >-r--r--r-- &nbsp;1 root root 3.9K Jan &nbsp;5 &nbsp;2012 patents.txt</font></div><div><font size="2"   >drwxr-xr-x 64 root root 4.0K Sep 25 16:02 resources</font></div><div><font size="2"   >drwxr-xr-x &nbsp;3 root root 4.0K Sep 25 16:02 runtime</font></div><div><font size="2"   >drwxr-xr-x &nbsp;3 root root 4.0K Sep 25 16:02 simulink</font></div><div><font size="2"   >drwxr-xr-x &nbsp;8 root root 4.0K Sep 25 16:02 sys</font></div><div><font size="2"   >drwxr-xr-x 10 root root 4.0K Sep 25 16:02 toolbox</font></div><div><font size="2"   >-r--r--r-- &nbsp;1 root root &nbsp;248 Dec 26 &nbsp;2007 trademarks.txt</font></div><div><font size="2"   >drwxr-xr-x &nbsp;4 root root 4.0K Sep 25 16:02 X11</font></div><p></p></pre></div><div>在安装pg_matlab前, 接下来要修改几个地方,&nbsp;</div><div>1. pg_matlab</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; pwd</font></div><div><font size="2"   >/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/matcored</font></div><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; vi Makefile&nbsp;</font></div><div><font size="2"   >修改</font></div><div><font size="2"   >PGM_DIR = /opt/pgsql/bin</font></div><div><font size="2"   >LIB_DIR = /opt/pgsql/lib</font></div><div><font size="2"   >加一行</font></div><div><font size="2"   >MATLABROOT=/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717</font></div><div><font size="2"   ><br></font></div><div><div style="line-height: 23px; font-family: Arial, Helvetica, sans-serif; white-space: normal;"   ><font size="2"   >root@digoal-PowerEdge-R610-&gt; pwd</font></div><div style="line-height: 23px; font-family: Arial, Helvetica, sans-serif; white-space: normal;"   ><font size="2"   >/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab</font></div><div style="line-height: 23px; font-family: Arial, Helvetica, sans-serif; white-space: normal;"   ><font size="2"   >root@digoal-PowerEdge-R610-&gt; vi Makefile&nbsp;</font></div><div style="line-height: 23px; font-family: Arial, Helvetica, sans-serif; white-space: normal;"   ><font size="2"   >修改</font></div><div style="line-height: 23px; font-family: Arial, Helvetica, sans-serif; white-space: normal;"   ><font size="2"   >MATLABROOT=/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717</font></div></div><p></p></pre></div><div><span style="line-height: 23px;"   >2. 修改环境变量</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - pg92</font></div><div><font size="2"   >把安装mcr时建议的配置加上去</font></div><div><font size="2"   >vi .bash_profile</font></div><div><font size="2"   >export LD_LIBRARY_PATH=/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/runtime/glnxa64:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/bin/glnxa64:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/sys/os/glnxa64:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/sys/java/jre/glnxa64/jre/lib/amd64/native_threads:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/sys/java/jre/glnxa64/jre/lib/amd64/server:/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/sys/java/jre/glnxa64/jre/lib/amd64:$PGHOME/lib:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib:$LD_LIBRARY_PATH</font></div><div><font size="2"   >export <span style="line-height: 20px;"   >XAPPLRESDIR=/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/X11/app-defaults</span></font></div><p></p></pre></div><div><span style="line-height: 23px;"   >3. 安装pg_matlab</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; make clean</font></div><div><font size="2"   >make clean -e -C matcored</font></div><div><font size="2"   >make[1]: Entering directory `/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/matcored'</font></div><div><font size="2"   >rm -f matcored.o mat_wrapper.o matcored</font></div><div><font size="2"   >make[1]: Leaving directory `/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/matcored'</font></div><div><font size="2"   >USE_PGXS=1 make clean -e -C libmatpg</font></div><div><font size="2"   >make[1]: Entering directory `/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/libmatpg'</font></div><div><font size="2"   >rm -f matpg.so &nbsp; libmatpg.a&nbsp;</font></div><div><font size="2"   >rm -f create_mat_pg_operators.sql</font></div><div><font size="2"   >rm -f mat_pg_funcs.o</font></div><div><font size="2"   >make[1]: Leaving directory `/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/libmatpg'</font></div><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; make</font></div><div><font size="2"   >make -e -C matcored</font></div><div><font size="2"   >make[1]: Entering directory `/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/matcored'</font></div><div><font size="2"   >cc -Wall -c -o matcored.o matcored.c -I/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/extern/include -I../libmatcore/distrib</font></div><div><font size="2"   >cc -Wall -c -o mat_wrapper.o mat_wrapper.c -I/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/extern/include -I../libmatcore/distrib</font></div><div><font size="2"   >gcc -o matcored matcored.o mat_wrapper.o -L/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/runtime/glnxa64 -L../libmatcore/distrib -lmwmclmcrrt -lmatcore</font></div><div><font size="2"   >make[1]: Leaving directory `/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/matcored'</font></div><div><font size="2"   >USE_PGXS=1 make -e -C libmatpg</font></div><div><font size="2"   >make[1]: Entering directory `/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/libmatpg'</font></div><div><font size="2"   >sed 's,MODULE_PATHNAME,$libdir/create_mat_pg_operators,g' create_mat_pg_operators.sql.in &gt;create_mat_pg_operators.sql</font></div><div><font size="2"   >gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -fexcess-precision=standard -g -fpic -I../matcored -I. -I. -I/opt/pgsql9.2.4/include/server -I/opt/pgsql9.2.4/include/internal -D_GNU_SOURCE -I/usr/include/libxml2 &nbsp; -c -o mat_pg_funcs.o mat_pg_funcs.c</font></div><div><font size="2"   >gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -fexcess-precision=standard -g -fpic -shared -o matpg.so mat_pg_funcs.o -L/opt/pgsql9.2.4/lib -L/usr/lib/x86_64-linux-gnu &nbsp;-Wl,--as-needed -Wl,-rpath,'/opt/pgsql9.2.4/lib',--enable-new-dtags &nbsp;</font></div><div><font size="2"   >make[1]: Leaving directory `/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/libmatpg'</font></div><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; make install</font></div><div><font size="2"   >cp libmatcore/distrib/libmatcore.so /opt/pgsql/lib</font></div><div><font size="2"   >cp matcored/matcored /opt/pgsql/bin</font></div><div><font size="2"   >USE_PGXS=1 make install -e -C libmatpg</font></div><div><font size="2"   >make[1]: Entering directory `/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/libmatpg'</font></div><div><font size="2"   >/bin/mkdir -p '/opt/pgsql9.2.4/lib'</font></div><div><font size="2"   >/bin/mkdir -p '/opt/pgsql9.2.4/share/contrib'</font></div><div><font size="2"   >/bin/sh /opt/pgsql9.2.4/lib/pgxs/src/makefiles/../../config/install-sh -c -m 755 &nbsp;matpg.so '/opt/pgsql9.2.4/lib/matpg.so'</font></div><div><font size="2"   >/bin/sh /opt/pgsql9.2.4/lib/pgxs/src/makefiles/../../config/install-sh -c -m 644 &nbsp;create_mat_pg_operators.sql '/opt/pgsql9.2.4/share/contrib/'</font></div><div><font size="2"   >make[1]: Leaving directory `/data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/libmatpg'</font></div><p></p></pre></div><div><br></div><div>4. 修改ld.so.conf</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /etc/ld.so.conf</font></div><div><font size="2"   >/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/bin/glnxa64</font></div><div><font size="2"   >/usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/runtime/glnxa64</font></div><div><font size="2"   >执行ldconfig, 同时检查是否生效</font></div><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; ldconfig</font></div><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; ldconfig -p|grep libmwmclmcrrt</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libmwmclmcrrt.so.7.17 (libc6,x86-64) =&gt; /usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/runtime/glnxa64/libmwmclmcrrt.so.7.17</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libmwmclmcrrt.so (libc6,x86-64) =&gt; /usr/local/MATLAB/MATLAB_Compiler_Runtime/v717/runtime/glnxa64/libmwmclmcrrt.so</font></div><p></p></pre></div><div><br></div><div>启动matcored</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; /opt/pgsql/bin/matcored 54321</font></div><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; which matcored</font></div><div><font size="2"   >/opt/pgsql/bin/matcored</font></div><div><font size="2"   >启动matcored时指定监听端口54321</font></div><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; matcored 54321</font></div><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; ps -efw|grep matcored</font></div><div><font size="2"   >pg92 &nbsp; &nbsp; 13041 &nbsp; &nbsp; 1 &nbsp;0 16:32 pts/1 &nbsp; &nbsp;00:00:00 matcored 54321</font></div><div><font size="2"   >pg92 &nbsp; &nbsp; 13043 12932 &nbsp;0 16:32 pts/1 &nbsp; &nbsp;00:00:00 grep --color=auto matcored</font></div><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; netstat -anp|grep 54321</font></div><div><font size="2"   >(Not all processes could be identified, non-owned process info</font></div><div><font size="2"   >&nbsp;will not be shown, you would have to be root to see it all.)</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 127.0.0.1:54321 &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;13041/matcored &nbsp;</font></div><p></p></pre></div><div><br></div><div>在数据库中创建函数</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; cd /data01/soft_bak/postgresql-9.2.4/contrib/pg_matlab/</font></div><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; cat create_mat_pg_operators.sql&nbsp;</font></div><div><font size="2"   >-- + operator</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >CREATE OR REPLACE FUNCTION mat_pg_add(DOUBLE PRECISION[], DOUBLE PRECISION[]) RETURNS DOUBLE PRECISION[]&nbsp;</font></div><div><font size="2"   >AS 'libmatpg.so', 'mat_pg_add'&nbsp;</font></div><div><font size="2"   >LANGUAGE C STRICT IMMUTABLE;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >DROP OPERATOR + (DOUBLE PRECISION[],DOUBLE PRECISION[]);</font></div><div><font size="2"   >CREATE OPERATOR + (</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; PROCEDURE = mat_pg_add,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; LEFTARG = DOUBLE PRECISION[],</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; RIGHTARG = DOUBLE PRECISION[]</font></div><div><font size="2"   >);</font></div><p></p></pre></div><div>报错 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; psql -f create_mat_pg_operators.sql&nbsp;</font></div><div><font size="2"   >psql:create_mat_pg_operators.sql:5: ERROR: &nbsp;could not access file "libmatpg.so": No such file or directory</font></div><div><font size="2"   >psql:create_mat_pg_operators.sql:7: ERROR: &nbsp;operator does not exist: double precision[] + double precision[]</font></div><div><font size="2"   >psql:create_mat_pg_operators.sql:12: ERROR: &nbsp;function mat_pg_add(double precision[], double precision[]) does not exist</font></div><p></p></pre></div><div>这个动态库文件不存在</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; ll /opt/pgsql/lib/libmatpg*</font></div><div><font size="2"   >ls: cannot access /opt/pgsql/lib/libmatpg*: No such file or directory</font></div><p></p></pre></div><div>解决办法 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; cd /opt/pgsql/lib</font></div><div><font size="2"   >root@digoal-PowerEdge-R610-&gt; mv matpg.so libmatpg.so</font></div><div><font size="2"   >pg92@digoal-PowerEdge-R610-&gt; psql -f create_mat_pg_operators.sql&nbsp;</font></div><div><font size="2"   >CREATE FUNCTION</font></div><div><font size="2"   >psql:create_mat_pg_operators.sql:7: ERROR: &nbsp;operator does not exist: double precision[] + double precision[]</font></div><div><font size="2"   >CREATE OPERATOR</font></div><p></p></pre></div><div><br></div><div>[安装说明]</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >How to compile, install and run</font></div><div><font size="2"   >===============================</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Before compilation, you need to set a few environment variables.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >- PATH (if needed, if PostgreSQL is installed into a custom directory)</font></div><div><font size="2"   >- MATLABROOT, so the Makefiles find the proper include and shared library files</font></div><div><font size="2"   >- LD_LIBRARY_PATH or modify /etc/ld.so.conf so the libmatcore.so is found.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The main Makefile has the PGM_DIR and LIB_DIR, matcored and libmatcore.so</font></div><div><font size="2"   >are installed there, respectively.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The C header file pg_matlab/libmatpg/mat_pg_funcs.h contains the hardcoded</font></div><div><font size="2"   >port number (54321 by default) that the PostgreSQL module will connect to.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >After setting all the above, run "make" from the main pg_matlab directory.</font></div><div><font size="2"   >Then run "make install", you most likely need to be root to do this, but it</font></div><div><font size="2"   >depends on the installation directories.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >You need to install the SQL script into the database you want to use Matlab,</font></div><div><font size="2"   >replace "dbname" with the proper name in the command below:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >$ psql -f libmatpg/create_mat_pg_operators.sql dbname</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >When it's done, you need to run the installed "matcored" with the following</font></div><div><font size="2"   >command:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >$ matcored NNN</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >where NNN is the port number. Use the same port number as you used above.</font></div><div><font size="2"   >You should use a special user for running matcored and this user must have</font></div><div><font size="2"   >"ulimit -c 0" set, so the core dumps from the failing daemon children don't</font></div><div><font size="2"   >fill up the disk.</font></div><div><font size="2"   >vi /etc/security/limits.conf</font></div><div><font size="2"   >* soft &nbsp; &nbsp;core &nbsp; &nbsp;unlimited</font></div><div><font size="2"   >* hard &nbsp; &nbsp;core &nbsp; &nbsp;unlimited</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >When matcored is running, you can use commands like these in PostgreSQL</font></div><div><font size="2"   >to add two vectors:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SELECT mat_pg_add( '{1,2,3,4}' , '{2,3,4,5}' );</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >or</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SELECT '{1,2,3,4}'::float8[] + '{2,3,4,5}'::float8[];</font></div><p></p></pre></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 23px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/message-id/7A0C0515-3896-4ABF-985A-09EB3B97AB3A@cybertec.at"   >http://www.postgresql.org/message-id/7A0C0515-3896-4ABF-985A-09EB3B97AB3A@cybertec.at</a></div><div>2.&nbsp;<a style="line-height: 23px;" target="_blank" rel="nofollow" href="http://www.cybertec.at/en/products/pg_matlab-matlab-postgresql-integration/"   >http://www.cybertec.at/en/products/pg_matlab-matlab-postgresql-integration/</a></div><div>3.&nbsp;<a style="line-height: 23px;" target="_blank" rel="nofollow" href="http://www.cybertec.at/en/products/pg_matlab-matlab-postgresql-integration/pg_matlab-sample-code/"   >http://www.cybertec.at/en/products/pg_matlab-matlab-postgresql-integration/pg_matlab-sample-code/</a></div><div>4.&nbsp;<a style="line-height: 23px;" target="_blank" rel="nofollow" href="http://www.cybertec.at/en/media/downloads/"   >http://www.cybertec.at/en/media/downloads/</a></div></div>5.&nbsp;<a rel="nofollow" href="http://download.csdn.net/detail/weizi4332/5581569"   >http://download.csdn.net/detail/weizi4332/5581569</a><div>6.&nbsp;<a style="line-height: 23px;" rel="nofollow" href="http://bbs.weiphone.com/read-htm-tid-6280022.html"   >http://bbs.weiphone.com/read-htm-tid-6280022.html</a></div><div>7.&nbsp;<a style="line-height: 23px;" rel="nofollow" href="https://kb.wisc.edu/cae/page.php?id=29336"   >https://kb.wisc.edu/cae/page.php?id=29336</a></div><div>8.&nbsp;<a style="line-height: 23px;" rel="nofollow" href="http://thepiratebay.sx/torrent/8315857/"   >http://thepiratebay.sx/torrent/8315857/</a></div><div>9.&nbsp;<a style="line-height: 23px;" rel="nofollow" href="http://hi.baidu.com/chenyangh/item/e7b7ac192e70b0fcddeeca61"   >http://hi.baidu.com/chenyangh/item/e7b7ac192e70b0fcddeeca61</a></div><div>10.&nbsp;<a style="line-height: 23px;" rel="nofollow" href="http://blog.csdn.net/rumswell/article/details/11881475"   >http://blog.csdn.net/rumswell/article/details/11881475</a></div></div>
	</div>
</div>
</body>
</html>