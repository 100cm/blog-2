<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">deploy owned private docker registry based on docker HUB registry image</h2>
	<h5 id="">2014-11-03 11:10:30&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201410393931894/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>docker HUB提供了registry的image, 可以非常方便的搭建私有regisrty.</div><div>当然你也可以选择从docker-registry的源码来搭建. 见 :&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/docker/docker-registry"   >https://github.com/docker/docker-registry</a></div><div><br></div><div>本文主要说一下使用docker registry image搭建私有registry.</div><div><br></div><div>1. 首先要部署docker</div><div>参考 :&nbsp;</div><div><a target="_blank" rel="nofollow" href="https://docs.docker.com/installation/#installation"   >https://docs.docker.com/installation/#installation</a></div><div><br></div><div>2. 启动docker 服务端, 最好使用-g 设置好root路径.</div><div>参考 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020149303488635/"   >http://blog.163.com/digoal@126/blog/static/16387704020149303488635/</a></div><div><br></div><div>3. 然后从docker hub 下载registry镜像到本地.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ~]# docker pull registry</font></div><div><div><font size="2"   >[root@db-172-16-3-221 ~]# docker images registry</font></div><div><font size="2"   >REPOSITORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VIRTUAL SIZE</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.8.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3e7767ddd728 &nbsp; &nbsp; &nbsp; &nbsp;9 days ago &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;427.9 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.7.3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c723c9b95ac0 &nbsp; &nbsp; &nbsp; &nbsp;9 days ago &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;424.1 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8e9a29f977a7 &nbsp; &nbsp; &nbsp; &nbsp;9 days ago &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;427.9 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.6.9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bee70978874c &nbsp; &nbsp; &nbsp; &nbsp;9 days ago &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;461.9 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.8.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cd3581c06bdc &nbsp; &nbsp; &nbsp; &nbsp;11 weeks ago &nbsp; &nbsp; &nbsp; &nbsp;442.5 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.6.8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 346f0c4d40c3 &nbsp; &nbsp; &nbsp; &nbsp;4 months ago &nbsp; &nbsp; &nbsp; &nbsp;447.8 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.7.2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8b65881eed3d &nbsp; &nbsp; &nbsp; &nbsp;4 months ago &nbsp; &nbsp; &nbsp; &nbsp;516 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.7.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a6a394071526 &nbsp; &nbsp; &nbsp; &nbsp;4 months ago &nbsp; &nbsp; &nbsp; &nbsp;516 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.7.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cc32522f16d6 &nbsp; &nbsp; &nbsp; &nbsp;4 months ago &nbsp; &nbsp; &nbsp; &nbsp;516 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.6.7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cd8d7a6d86d1 &nbsp; &nbsp; &nbsp; &nbsp;5 months ago &nbsp; &nbsp; &nbsp; &nbsp;452.5 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.6.6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e260f5a77e52 &nbsp; &nbsp; &nbsp; &nbsp;6 months ago &nbsp; &nbsp; &nbsp; &nbsp;443 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.6.5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e7bac0a3804b &nbsp; &nbsp; &nbsp; &nbsp;7 months ago &nbsp; &nbsp; &nbsp; &nbsp;433 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.6.3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1f7bbd131cd8 &nbsp; &nbsp; &nbsp; &nbsp;9 months ago &nbsp; &nbsp; &nbsp; &nbsp;490 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.6.2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0b520d776e7d &nbsp; &nbsp; &nbsp; &nbsp;9 months ago &nbsp; &nbsp; &nbsp; &nbsp;466.6 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.6.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 9f98cb899f46 &nbsp; &nbsp; &nbsp; &nbsp;9 months ago &nbsp; &nbsp; &nbsp; &nbsp;460.1 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.6.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 873f518b98ef &nbsp; &nbsp; &nbsp; &nbsp;9 months ago &nbsp; &nbsp; &nbsp; &nbsp;466.5 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.5.9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e8e5377f8307 &nbsp; &nbsp; &nbsp; &nbsp;9 months ago &nbsp; &nbsp; &nbsp; &nbsp;466.3 MB</font></div><div><font size="2"   >registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.6.4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b04ace768d59 &nbsp; &nbsp; &nbsp; &nbsp;9 months ago &nbsp; &nbsp; &nbsp; &nbsp;490 MB</font></div></div><p></p></pre></div><div><br></div><div>4. 使用<span style="line-height: 28px;"   >registry</span><span style="line-height: 28px;"   >&nbsp;image</span><span style="line-height: 28px;"   >启动container. 启动时最好指定卷(用于存储镜像), 端口映射.</span></div><div>创建目录, 用于存储镜像</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ~]# mkdir /data01/registry_sto</font></div><div><font size="2"   >[root@db-172-16-3-221 ~]# mkdir /data01/registry_conf</font></div><p></p></pre></div><div>创建配置文件, 从<a target="_blank" rel="nofollow" href="https://github.com/docker/docker-registry/blob/master/config/config_sample.yml"   >https://github.com/docker/docker-registry/blob/master/config/config_sample.yml</a>下载</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ~]# cd /data01/registry_conf</font></div><div><font size="2"   >[root@db-172-16-3-221 registry_conf]# vi config_sample.yml</font></div><p></p></pre></div><div># 把<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/docker/docker-registry/blob/master/config/config_sample.yml"   >https://github.com/docker/docker-registry/blob/master/config/config_sample.yml</a>的内容写入该文件.</div><div># 须修改几处, 本文使用本地存储, local配置. (为了使search可用, 必须设置search backend)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp; issue: '"Digoal`s docker-registry server"'</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >local: &amp;local</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;&lt;: *common</font></div><div><font size="2"   >&nbsp; &nbsp; storage: local</font></div><div><font size="2"   >&nbsp; &nbsp; storage_path: _env:STORAGE_PATH:/registry_sto</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; search_backend: _env:SEARCH_BACKEND:sqlalchemy</font></div><div><font size="2"   >&nbsp; &nbsp; sqlalchemy_index_database: _env:SQLALCHEMY_INDEX_DATABASE:sqlite:////tmp/docker-registry.db</font></div></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >5. 启动container, 指定网络, 指定端口映射, 指定卷, 环境变量(配置文件,存储路径),</span></div><div><span style="line-height: 28px;"   >先使用前台启动, 调试正常后, 加上-d 后台启动.</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >docker run -d --net="host" -p 5000:5000 -v /data01/registry_conf:/registory_conf -v /data01/registry_sto:/registry_sto -e DOCKER_REGISTRY_CONFIG=/registory_conf/config_sample.yml -e STORAGE_PATH=/registry_sto -e SETTINGS_FLAVOR=local --name=registry &nbsp;registry:0.8.1</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   ><br></font></span></div><div><div><font size="2"   >[root@db-172-16-3-221 registry_conf]# docker run --net="host" -p 5000:5000 -v /data01/registry_conf:/registory_conf -v /data01/registry_sto:/registry_sto -e DOCKER_REGISTRY_CONFIG=/registory_conf/config_sample.yml -e STORAGE_PATH=/registry_sto -e SETTINGS_FLAVOR=local --name=registry &nbsp;registry:0.8.1</font></div><div><font size="2"   >2014-11-03 02:26:50,648 WARNING: Cache storage disabled!</font></div><div><font size="2"   >2014-11-03 02:26:50,648 WARNING: LRU cache disabled!</font></div><div><font size="2"   >2014-11-03 02:26:50 [1] [INFO] Starting gunicorn 18.0</font></div><div><font size="2"   >2014-11-03 02:26:50 [1] [INFO] Listening at: http://0.0.0.0:5000 (1)</font></div><div><font size="2"   >2014-11-03 02:26:50 [1] [INFO] Using worker: gevent</font></div><div><font size="2"   >2014-11-03 02:26:50 [15] [INFO] Booting worker with pid: 15</font></div><div><font size="2"   >2014-11-03 02:26:50 [16] [INFO] Booting worker with pid: 16</font></div><div><font size="2"   >2014-11-03 02:26:50 [17] [INFO] Booting worker with pid: 17</font></div><div><font size="2"   >2014-11-03 02:26:51 [22] [INFO] Booting worker with pid: 22</font></div><div><font size="2"   >2014-11-03 02:26:51,022 WARNING: Cache storage disabled!</font></div><div><font size="2"   >2014-11-03 02:26:51,023 WARNING: LRU cache disabled!</font></div><div><font size="2"   >2014-11-03 02:26:51,030 WARNING: Cache storage disabled!</font></div><div><font size="2"   >2014-11-03 02:26:51,031 WARNING: LRU cache disabled!</font></div><div><font size="2"   >2014-11-03 02:26:51,105 WARNING: Cache storage disabled!</font></div><div><font size="2"   >2014-11-03 02:26:51,106 WARNING: LRU cache disabled!</font></div><div><font size="2"   >2014-11-03 02:26:51,193 WARNING: Cache storage disabled!</font></div><div><font size="2"   >2014-11-03 02:26:51,193 WARNING: LRU cache disabled!</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@db-172-16-3-221 ~]# docker ps</font></div><div><font size="2"   >CONTAINER ID &nbsp; &nbsp; &nbsp; &nbsp;IMAGE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMMAND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STATUS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PORTS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NAMES</font></div><div><font size="2"   >5c64e3cb2fd8 &nbsp; &nbsp; &nbsp; &nbsp;registry:0.8.1 &nbsp; &nbsp; &nbsp;/bin/sh -c 'exec doc &nbsp; 22 seconds ago &nbsp; &nbsp; &nbsp;Up 21 seconds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; registry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >[root@db-172-16-3-221 ~]# docker inspect registry</font></div><div><font size="2"   >[{</font></div><div><font size="2"   >&nbsp; &nbsp; "Args": [</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "-c",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "exec docker-registry"</font></div><div><font size="2"   >&nbsp; &nbsp; ],</font></div><div><font size="2"   >&nbsp; &nbsp; "Config": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "AttachStderr": true,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "AttachStdin": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "AttachStdout": true,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Cmd": [</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "/bin/sh",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "-c",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "exec docker-registry"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ],</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "CpuShares": 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Cpuset": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Domainname": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Entrypoint": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Env": [</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "DOCKER_REGISTRY_CONFIG=/registory_conf/config_sample.yml",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "STORAGE_PATH=/registry_sto",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "SETTINGS_FLAVOR=local",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ],</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "ExposedPorts": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "5000/tcp": {}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Hostname": "db-172-16-3-221",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Image": "registry:0.8.1",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Memory": 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "MemorySwap": 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "NetworkDisabled": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "OnBuild": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "OpenStdin": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "PortSpecs": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "StdinOnce": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Tty": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "User": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Volumes": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "WorkingDir": ""</font></div><div><font size="2"   >&nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; "Created": "2014-11-03T02:26:49.936106407Z",</font></div><div><font size="2"   >&nbsp; &nbsp; "Driver": "devicemapper",</font></div><div><font size="2"   >&nbsp; &nbsp; "ExecDriver": "native-0.2",</font></div><div><font size="2"   >&nbsp; &nbsp; "HostConfig": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Binds": [</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "/data01/registry_conf:/registory_conf",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "/data01/registry_sto:/registry_sto"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ],</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "ContainerIDFile": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Dns": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "DnsSearch": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Links": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "LxcConf": [],</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "NetworkMode": "host",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "PortBindings": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "5000/tcp": [</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "HostIp": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "HostPort": "5000"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Privileged": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "PublishAllPorts": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "VolumesFrom": null</font></div><div><font size="2"   >&nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; "HostnamePath": "/data01/docker/containers/5c64e3cb2fd8c3160c953a4708b31aeb9900eefc40787e3e565c099e977f1e1f/hostname",</font></div><div><font size="2"   >&nbsp; &nbsp; "HostsPath": "/data01/docker/containers/5c64e3cb2fd8c3160c953a4708b31aeb9900eefc40787e3e565c099e977f1e1f/hosts",</font></div><div><font size="2"   >&nbsp; &nbsp; "Id": "5c64e3cb2fd8c3160c953a4708b31aeb9900eefc40787e3e565c099e977f1e1f",</font></div><div><font size="2"   >&nbsp; &nbsp; "Image": "3e7767ddd728c1480e9bcfd5fdbe453b57f948deca3f55c9ef0459f9d24720a1",</font></div><div><font size="2"   >&nbsp; &nbsp; "MountLabel": "",</font></div><div><font size="2"   >&nbsp; &nbsp; "Name": "/registry",</font></div><div><font size="2"   >&nbsp; &nbsp; "NetworkSettings": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Bridge": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Gateway": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "IPAddress": "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "IPPrefixLen": 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "PortMapping": null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Ports": null</font></div><div><font size="2"   >&nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; "Path": "/bin/sh",</font></div><div><font size="2"   >&nbsp; &nbsp; "ProcessLabel": "",</font></div><div><font size="2"   >&nbsp; &nbsp; "ResolvConfPath": "/etc/resolv.conf",</font></div><div><font size="2"   >&nbsp; &nbsp; "State": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "ExitCode": 0,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "FinishedAt": "0001-01-01T00:00:00Z",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Paused": false,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Pid": 29578,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "Running": true,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "StartedAt": "2014-11-03T02:26:50.167293486Z"</font></div><div><font size="2"   >&nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; "Volumes": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "/registory_conf": "/data01/registry_conf",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "/registry_sto": "/data01/registry_sto"</font></div><div><font size="2"   >&nbsp; &nbsp; },</font></div><div><font size="2"   >&nbsp; &nbsp; "VolumesRW": {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "/registory_conf": true,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; "/registry_sto": true</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   >}</font></div><div><font size="2"   >]</font></div></div><p></p></pre></div><div><br></div><div>好了, 如果防火墙允许的话, 可以连接到这个私有的HUB了.</div><div><span style="line-height: 28px;"   >IE</span></div><div><div><img title="deploy owned docker registry based on docker HUB - 德哥@Digoal - PostgreSQL research"   alt="deploy owned docker registry based on docker HUB - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/epk8Pjng5NIBarY5hyh-OQ==/6608665216283304418.png"   ></div></div><div><br></div><div>6. 测试 :&nbsp;</div><div>6.1 首先测试push image到这个registry.</div><div>当然要先制作image, 制作image可以通过现有的image或者通过dockerfile来制作, 略.</div><div>假设当前已有的image如下, 我想把centos:centos6 push到刚刚搭建的私有docker registry.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ~]# docker images centos</font></div><div><font size="2"   >REPOSITORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VIRTUAL SIZE</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 504a65221a38 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 467.1 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 68edf809afe7 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 212.7 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 87e5b6b3ccc1 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 224 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;87e5b6b3ccc1 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 224 MB</font></div><p></p></pre></div><div><br></div><div>首先要打上tag</div><div><div>docker tag [-f|--force[=false]] IMAGE [REGISTRYHOST/][USERNAME/]NAME[:TAG]</div></div><div>如下,&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-221 ~]# docker tag 68edf809afe7 172.16.3.221:5000/centos:centos6</font></div><div><font size="2"   >[root@db-172-16-3-221 ~]# docker push 172.16.3.221:5000/centos:centos6</font></div><div><font size="2"   >The push refers to a repository [172.16.3.221:5000/centos] (len: 1)</font></div><div><font size="2"   >Sending image list</font></div><div><font size="2"   >Pushing repository 172.16.3.221:5000/centos (1 tags)</font></div><div><font size="2"   >511136ea3c5a: Image successfully pushed&nbsp;</font></div><div><font size="2"   >5b12ef8fd570: Image successfully pushed&nbsp;</font></div><div><font size="2"   >68edf809afe7: Image successfully pushed&nbsp;</font></div><div><font size="2"   >Pushing tag for rev [68edf809afe7] on {http://172.16.3.221:5000/v1/repositories/centos/tags/centos6}</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@db-172-16-3-221 data01]# cd registry_sto/</font></div><div><font size="2"   >[root@db-172-16-3-221 registry_sto]# ll</font></div><div><font size="2"   >total 4</font></div><div><font size="2"   >drwxr-xr-x 5 root root 4096 Nov &nbsp;3 10:41 images</font></div><div><font size="2"   >drwxr-xr-x 3 root root &nbsp; 20 Nov &nbsp;3 10:41 repositories</font></div><div><font size="2"   >[root@db-172-16-3-221 registry_sto]# du -sh *</font></div><div><font size="2"   >73M &nbsp; &nbsp; images</font></div><div><font size="2"   >12K &nbsp; &nbsp; repositories</font></div></div><p></p></pre></div><div><span style="line-height: 28px;"   >或存放到用户下(方便辨识是谁上传的, 或者归类) :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# docker tag 504a65221a38 172.16.3.221:5000/digoal/centos:centos5</font></div><div><font size="2"   >[root@150 ~]# docker push 172.16.3.221:5000/digoal/centos:centos5</font></div><div><font size="2"   >The push refers to a repository [172.16.3.221:5000/digoal/centos] (len: 1)</font></div><div><font size="2"   >Sending image list</font></div><div><font size="2"   >Pushing repository 172.16.3.221:5000/digoal/centos (1 tags)</font></div><div><font size="2"   >Image 511136ea3c5a already pushed, skipping</font></div><div><font size="2"   >Image 5b12ef8fd570 already pushed, skipping</font></div><div><font size="2"   >504a65221a38: Image successfully pushed&nbsp;</font></div><div><font size="2"   >Pushing tag for rev [504a65221a38] on {http://172.16.3.221:5000/v1/repositories/digoal/centos/tags/centos5}</font></div><p></p></pre></div><div><br></div><div>6.2 测试从私有registry pull image到本地</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# docker images</font></div><div><font size="2"   >REPOSITORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VIRTUAL SIZE</font></div><div><font size="2"   >digoal/pg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 9.3.5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b8a933b7f4d7 &nbsp; &nbsp; &nbsp; &nbsp;10 days ago &nbsp; &nbsp; &nbsp; &nbsp; 646.5 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 504a65221a38 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 467.1 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;centos7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 87e5b6b3ccc1 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 224 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;87e5b6b3ccc1 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 224 MB</font></div><div><font size="2"   >[root@150 ~]# docker pull 172.16.3.221:5000/centos:centos6</font></div><div><font size="2"   >Pulling repository 172.16.3.221:5000/centos</font></div><div><font size="2"   >68edf809afe7: Download complete&nbsp;</font></div><div><font size="2"   >511136ea3c5a: Download complete&nbsp;</font></div><div><font size="2"   >5b12ef8fd570: Download complete&nbsp;</font></div><div><font size="2"   >注意repository列, 从私有registry下载的image很容易辨识.</font></div><div><font size="2"   >[root@150 ~]# docker images</font></div><div><font size="2"   >REPOSITORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VIRTUAL SIZE</font></div><div><font size="2"   >digoal/pg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9.3.5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b8a933b7f4d7 &nbsp; &nbsp; &nbsp; &nbsp;10 days ago &nbsp; &nbsp; &nbsp; &nbsp; 646.5 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; centos5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 504a65221a38 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 467.1 MB</font></div><div><font size="2"   >172.16.3.221:5000/centos &nbsp; centos6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 68edf809afe7 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 212.7 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; centos7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 87e5b6b3ccc1 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 224 MB</font></div><div><font size="2"   >centos &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;87e5b6b3ccc1 &nbsp; &nbsp; &nbsp; &nbsp;4 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 224 MB</font></div><p></p></pre></div><div><br></div><div>6.3 使用私有registry下载的image run container :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# docker run -t -i --rm 172.16.3.221:5000/centos:centos6 /bin/bash</font></div><div><font size="2"   >bash-4.1# w</font></div><div><font size="2"   >&nbsp;02:47:41 up 25 days, 22:48, &nbsp;0 users, &nbsp;load average: 0.00, 0.00, 0.00</font></div><div><font size="2"   >USER &nbsp; &nbsp; TTY &nbsp; &nbsp; &nbsp;FROM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LOGIN@ &nbsp; IDLE &nbsp; JCPU &nbsp; PCPU WHAT</font></div><div><font size="2"   >bash-4.1# uname -r</font></div><div><font size="2"   >2.6.32-431.23.3.el6.x86_64</font></div><div><font size="2"   >bash-4.1# cat /etc/redhat-release &nbsp;&nbsp;</font></div><div><font size="2"   >CentOS release 6.5 (Final)</font></div><p></p></pre></div><div><br></div><div>6.4 search , 使用方法如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@150 ~]# curl -X GET http://172.16.3.221:5000/v1/search?q=centos</font></div><div><font size="2"   >{"num_results": 2, "query": "centos", "results": [{"description": null, "name": "library/centos"}, {"description": null, "name": "digoal/centos"}]}</font></div></div><div><div><font size="2"   >[root@150 ~]# curl -X GET http://172.16.3.221:5000/v1/search?q=digoal</font></div><div><font size="2"   >{"num_results": 1, "query": "digoal", "results": [{"description": null, "name": "digoal/centos"}]}</font></div></div><p></p></pre></div><div><br></div><div><br></div><div>结合openstack等云平台使用, 将镜像存储到云平台镜像管理存储, 可参考 :&nbsp;</div><div><a target="_blank" rel="nofollow" href="http://www.activestate.com/blog/2014/01/deploying-your-own-private-docker-registry"   >http://www.activestate.com/blog/2014/01/deploying-your-own-private-docker-registry</a></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://blog.docker.com/2013/07/how-to-use-your-own-registry/"   >http://blog.docker.com/2013/07/how-to-use-your-own-registry/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.activestate.com/blog/2014/01/deploying-your-own-private-docker-registry"   >http://www.activestate.com/blog/2014/01/deploying-your-own-private-docker-registry</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/docker/docker-registry"   >https://github.com/docker/docker-registry</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/docker/docker-registry/blob/master/ADVANCED.md"   >https://github.com/docker/docker-registry/blob/master/ADVANCED.md</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/docker/docker-registry/blob/master/config/config_sample.yml"   >https://github.com/docker/docker-registry/blob/master/config/config_sample.yml</a></div><div>6. man docker-tag</div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="deploy owned docker registry based on docker HUB - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>