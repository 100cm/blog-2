<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">how to create owned centos base image on centos</h2>
	<h5 id="">2014-11-04 17:05:44&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201410443845799/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>一般情况下, 我们需要制作image的话, 总需要一个基本的image, 那么这个base image是哪里来的呢?</div><div>如果不自制的话, 那就得去docker HUB下载.</div><div><br></div><div>其实base image也可以自制, 参考docker提供的mkimage开头的脚本 :&nbsp;</div><div><a target="_blank" rel="nofollow" href="https://github.com/docker/docker/tree/master/contrib"   >https://github.com/docker/docker/tree/master/contrib</a></div><div><br></div><div>例如mkimage-yum.sh是在centos中制作centos base image的脚本.</div><div>例如我在CentOS 6.x x64中可以制作centos 6 x64最新版的image.</div><div>脚本内容如下 :&nbsp;</div><div>最后一步tar --numeric-owner -c -C "$target" . | docker import - $name:$version是使用docker import导入到本地镜像库.</div><div>[root@150 ~]# vi build.sh</div><wbr><div><pre class="prettyprint"   ><p></p><div><font size="2"   >#!/usr/bin/env bash</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># Create a base CentOS Docker image.</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># This script is useful on systems with yum installed (e.g., building</font></div><div><font size="2"   ># a CentOS image on CentOS). &nbsp;See contrib/mkimage-rinse.sh for a way</font></div><div><font size="2"   ># to build CentOS images on other systems.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >usage() {</font></div><div><font size="2"   >&nbsp; &nbsp; cat &lt;&lt;EOOPTS</font></div><div><font size="2"   >$(basename $0) [OPTIONS] &lt;name&gt;</font></div><div><font size="2"   >OPTIONS:</font></div><div><font size="2"   >&nbsp; -y &lt;yumconf&gt; &nbsp;The path to the yum config to install packages from. The</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default is /etc/yum.conf.</font></div><div><font size="2"   >EOOPTS</font></div><div><font size="2"   >&nbsp; &nbsp; exit 1</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># option defaults</font></div><div><font size="2"   >yum_config=/etc/yum.conf</font></div><div><font size="2"   >while getopts ":y:h" opt; do</font></div><div><font size="2"   >&nbsp; &nbsp; case $opt in</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; y)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yum_config=$OPTARG</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; h)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; usage</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; \?)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "Invalid option: -$OPTARG"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; usage</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; &nbsp; esac</font></div><div><font size="2"   >done</font></div><div><font size="2"   >shift $((OPTIND - 1))</font></div><div><font size="2"   >name=$1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if [[ -z $name ]]; then</font></div><div><font size="2"   >&nbsp; &nbsp; usage</font></div><div><font size="2"   >fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >#--------------------</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >target=$(mktemp -d --tmpdir $(basename $0).XXXXXX)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >set -x</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >mkdir -m 755 "$target"/dev</font></div><div><font size="2"   >mknod -m 600 "$target"/dev/console c 5 1</font></div><div><font size="2"   >mknod -m 600 "$target"/dev/initctl p</font></div><div><font size="2"   >mknod -m 666 "$target"/dev/full c 1 7</font></div><div><font size="2"   >mknod -m 666 "$target"/dev/null c 1 3</font></div><div><font size="2"   >mknod -m 666 "$target"/dev/ptmx c 5 2</font></div><div><font size="2"   >mknod -m 666 "$target"/dev/random c 1 8</font></div><div><font size="2"   >mknod -m 666 "$target"/dev/tty c 5 0</font></div><div><font size="2"   >mknod -m 666 "$target"/dev/tty0 c 4 0</font></div><div><font size="2"   >mknod -m 666 "$target"/dev/urandom c 1 9</font></div><div><font size="2"   >mknod -m 666 "$target"/dev/zero c 1 5</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >yum -c "$yum_config" --installroot="$target" --releasever=/ --setopt=tsflags=nodocs \</font></div><div><font size="2"   >&nbsp; &nbsp; --setopt=group_package_types=mandatory -y groupinstall Core</font></div><div><font size="2"   >yum -c "$yum_config" --installroot="$target" -y clean all</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >cat &gt; "$target"/etc/sysconfig/network &lt;&lt;EOF</font></div><div><font size="2"   >NETWORKING=yes</font></div><div><font size="2"   >HOSTNAME=localhost.localdomain</font></div><div><font size="2"   >EOF</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># effectively: febootstrap-minimize --keep-zoneinfo --keep-rpmdb</font></div><div><font size="2"   ># --keep-services "$target". &nbsp;Stolen from mkimage-rinse.sh</font></div><div><font size="2"   ># &nbsp;locales</font></div><div><font size="2"   >rm -rf "$target"/usr/{{lib,share}/locale,{lib,lib64}/gconv,bin/localedef,sbin/build-locale-archive}</font></div><div><font size="2"   ># &nbsp;docs</font></div><div><font size="2"   >rm -rf "$target"/usr/share/{man,doc,info,gnome/help}</font></div><div><font size="2"   ># &nbsp;cracklib</font></div><div><font size="2"   >rm -rf "$target"/usr/share/cracklib</font></div><div><font size="2"   ># &nbsp;i18n</font></div><div><font size="2"   >rm -rf "$target"/usr/share/i18n</font></div><div><font size="2"   ># &nbsp;sln</font></div><div><font size="2"   >rm -rf "$target"/sbin/sln</font></div><div><font size="2"   ># &nbsp;ldconfig</font></div><div><font size="2"   >rm -rf "$target"/etc/ld.so.cache</font></div><div><font size="2"   >rm -rf "$target"/var/cache/ldconfig/*</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >version=</font></div><div><font size="2"   >if [ -r "$target"/etc/redhat-release ]; then</font></div><div><font size="2"   >&nbsp; &nbsp; version="$(sed 's/^[^0-9\]*\([0-9.]\+\).*$/\1/' "$target"/etc/redhat-release)"</font></div><div><font size="2"   >fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if [ -z "$version" ]; then</font></div><div><font size="2"   >&nbsp; &nbsp; echo &gt;&amp;2 "warning: cannot autodetect OS version, using '$name' as tag"</font></div><div><font size="2"   >&nbsp; &nbsp; version=$name</font></div><div><font size="2"   >fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >tar --numeric-owner -c -C "$target" . | docker import - $name:$version</font></div><div><font size="2"   >docker run -i -t $name:$version echo success</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >rm -rf "$target"</font></div><p></p></pre></div><div><br></div><div>yum的installroot用于将包安装到指定的root, 而不是本地.</div><div>man yum</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--installroot=root</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Specifies an alternative installroot, relative to which all packages will be installed.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configuration Option: installroot</font></div><p></p></pre></div><div><br></div><div><div>[root@150 ~]# cat /etc/yum.conf&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[main]</font></div><div><font size="2"   >cachedir=/var/cache/yum/$basearch/$releasever</font></div><div><font size="2"   >keepcache=0</font></div><div><font size="2"   >debuglevel=2</font></div><div><font size="2"   >logfile=/var/log/yum.log</font></div><div><font size="2"   >exactarch=1</font></div><div><font size="2"   >obsoletes=1</font></div><div><font size="2"   >gpgcheck=1</font></div><div><font size="2"   >plugins=1</font></div><div><font size="2"   >installonly_limit=5</font></div><div><font size="2"   >bugtracker_url=http://bugs.centos.org/set_project.php?project_id=16&amp;ref=http://bugs.centos.org/bug_report_page.php?category=yum</font></div><div><font size="2"   >distroverpkg=centos-release</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># &nbsp;This is the default, if you make this bigger yum won't see if the metadata</font></div><div><font size="2"   ># is newer on the remote and so you'll "gain" the bandwidth of not having to</font></div><div><font size="2"   ># download the new metadata and "pay" for it by yum not having correct</font></div><div><font size="2"   ># information.</font></div><div><font size="2"   ># &nbsp;It is esp. important, to have correct metadata, for distributions like</font></div><div><font size="2"   ># Fedora which don't keep old packages around. If you don't like this checking</font></div><div><font size="2"   ># interupting your command line usage, it's much better to have something</font></div><div><font size="2"   ># manually check the metadata once an hour (yum-updatesd will do this).</font></div><div><font size="2"   ># metadata_expire=90m</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># PUT YOUR REPOS HERE OR IN separate files named file.repo</font></div><div><font size="2"   ># in /etc/yum.repos.d</font></div><p></p></pre></div></div><div><br></div><div>跑这个脚本, 就可以创建centos6的镜像了, 自动tag为最新版本.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# chmod 500 ./build.sh</font></div><div><div><font size="2"   >[root@150 ~]# ./build.sh&nbsp;</font></div><div><font size="2"   >build.sh [OPTIONS] &lt;name&gt;</font></div><div><font size="2"   >OPTIONS:</font></div><div><font size="2"   >&nbsp; -y &lt;yumconf&gt; &nbsp;The path to the yum config to install packages from. The</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default is /etc/yum.conf.</font></div></div><p></p></pre></div><div><br></div><div>运行过程的输出提取如下 :&nbsp;</div><div><div>[root@150 ~]# ./build.sh -y /etc/yum.conf centos6</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >+ mkdir -m 755 /tmp/build.sh.BEGiT6/dev</font></div><div><font size="2"   >+ mknod -m 600 /tmp/build.sh.BEGiT6/dev/console c 5 1</font></div><div><font size="2"   >+ mknod -m 600 /tmp/build.sh.BEGiT6/dev/initctl p</font></div><div><font size="2"   >+ mknod -m 666 /tmp/build.sh.BEGiT6/dev/full c 1 7</font></div><div><font size="2"   >+ mknod -m 666 /tmp/build.sh.BEGiT6/dev/null c 1 3</font></div><div><font size="2"   >+ mknod -m 666 /tmp/build.sh.BEGiT6/dev/ptmx c 5 2</font></div><div><font size="2"   >+ mknod -m 666 /tmp/build.sh.BEGiT6/dev/random c 1 8</font></div><div><font size="2"   >+ mknod -m 666 /tmp/build.sh.BEGiT6/dev/tty c 5 0</font></div><div><font size="2"   >+ mknod -m 666 /tmp/build.sh.BEGiT6/dev/tty0 c 4 0</font></div><div><font size="2"   >+ mknod -m 666 /tmp/build.sh.BEGiT6/dev/urandom c 1 9</font></div><div><font size="2"   >+ mknod -m 666 /tmp/build.sh.BEGiT6/dev/zero c 1 5</font></div><div><font size="2"   >+ yum -c /etc/yum.conf --installroot=/tmp/build.sh.BEGiT6 --releasever=/ --setopt=tsflags=nodocs --setopt=group_package_types=mandatory -y groupinstall Core</font></div></div><div><font size="2"   >..........................................................................................................................................................</font></div><div><div><font size="2"   >Complete!</font></div><div><font size="2"   >+ yum -c /etc/yum.conf --installroot=/tmp/build.sh.BEGiT6 -y clean all</font></div><div><font size="2"   >Loaded plugins: fastestmirror, refresh-packagekit, security, versionlock</font></div><div><font size="2"   >Cleaning repos: base extras updates</font></div><div><font size="2"   >Cleaning up Everything</font></div><div><font size="2"   >Cleaning up list of fastest mirrors</font></div><div><font size="2"   >+ cat</font></div><div><font size="2"   >+ rm -rf /tmp/build.sh.BEGiT6/usr/lib/locale /tmp/build.sh.BEGiT6/usr/share/locale /tmp/build.sh.BEGiT6/usr/lib/gconv /tmp/build.sh.BEGiT6/usr/lib64/gconv /tmp/build.sh.BEGiT6/usr/bin/localedef /tmp/build.sh.BEGiT6/usr/sbin/build-locale-archive</font></div><div><font size="2"   >+ rm -rf /tmp/build.sh.BEGiT6/usr/share/man /tmp/build.sh.BEGiT6/usr/share/doc /tmp/build.sh.BEGiT6/usr/share/info /tmp/build.sh.BEGiT6/usr/share/gnome/help</font></div><div><font size="2"   >+ rm -rf /tmp/build.sh.BEGiT6/usr/share/cracklib</font></div><div><font size="2"   >+ rm -rf /tmp/build.sh.BEGiT6/usr/share/i18n</font></div><div><font size="2"   >+ rm -rf /tmp/build.sh.BEGiT6/sbin/sln</font></div><div><font size="2"   >+ rm -rf /tmp/build.sh.BEGiT6/etc/ld.so.cache</font></div><div><font size="2"   >+ rm -rf /tmp/build.sh.BEGiT6/var/cache/ldconfig/aux-cache</font></div><div><font size="2"   >+ version=</font></div><div><font size="2"   >+ '[' -r /tmp/build.sh.BEGiT6/etc/redhat-release ']'</font></div><div><font size="2"   >++ sed 's/^[^0-9\]*\([0-9.]\+\).*$/\1/' /tmp/build.sh.BEGiT6/etc/redhat-release</font></div><div><font size="2"   >+ version=6.6</font></div><div><font size="2"   >+ '[' -z 6.6 ']'</font></div><div><font size="2"   >+ tar --numeric-owner -c -C /tmp/build.sh.BEGiT6 .</font></div><div><font size="2"   >+ docker import - centos6:6.6</font></div><div><font size="2"   >c459824791f12b110ae8c2bd83847b2cd34c5a36d9afbb69db4e2acfe2c7c79c</font></div><div><font size="2"   >+ docker run -i -t centos6:6.6 echo success</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >success</font></div><div><font size="2"   >+ rm -rf /tmp/build.sh.BEGiT6</font></div></div><p></p></pre></div></div><div><div><br></div><div>运行完后, 可以在本地查看到刚才生成的image.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# docker images</font></div><div><font size="2"   >REPOSITORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VIRTUAL SIZE</font></div><div><font size="2"   >centos6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6.6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c459824791f1 &nbsp; &nbsp; &nbsp; &nbsp;34 seconds ago &nbsp; &nbsp; &nbsp;192.2 MB</font></div><p></p></pre></div></div><div><br></div><div>使用这个image</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# docker run -t -i --rm centos6:6.6 /bin/bash</font></div><div><font size="2"   >bash-4.1# cat /etc/redhat-release &nbsp;&nbsp;</font></div><div><font size="2"   >CentOS release 6.6 (Final)</font></div><div><font size="2"   >bash-4.1# df -h</font></div><div><font size="2"   >Filesystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Size &nbsp;Used Avail Use% Mounted on</font></div><div><font size="2"   >rootfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9.9G &nbsp;354M &nbsp;9.0G &nbsp; 4% /</font></div><div><font size="2"   >/dev/mapper/docker-8:33-3407874-86d271118901ababe886058c9cfca4790857f38117c4a3b9f09b8b03d1f1ebb5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 9.9G &nbsp;354M &nbsp;9.0G &nbsp; 4% /</font></div><div><font size="2"   >tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;48G &nbsp; &nbsp; 0 &nbsp; 48G &nbsp; 0% /dev</font></div><div><font size="2"   >shm &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;64M &nbsp; &nbsp; 0 &nbsp; 64M &nbsp; 0% /dev/shm</font></div><div><font size="2"   >/dev/sdc1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 221G &nbsp;156G &nbsp; 54G &nbsp;75% /.dockerinit</font></div><div><font size="2"   >/dev/sda1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;39G &nbsp;4.4G &nbsp; 34G &nbsp;12% /etc/resolv.conf</font></div><div><font size="2"   >/dev/sdc1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 221G &nbsp;156G &nbsp; 54G &nbsp;75% /etc/hostname</font></div><div><font size="2"   >/dev/sdc1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 221G &nbsp;156G &nbsp; 54G &nbsp;75% /etc/hosts</font></div><div><font size="2"   >tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;48G &nbsp; &nbsp; 0 &nbsp; 48G &nbsp; 0% /proc/kcore</font></div><p></p></pre></div><div><br></div><div><br></div><div><br></div><div>提交到docker hub或私有docker registry</div><div>提交到docker hub</div><div><div><pre class="prettyprint"   ><p style="line-height: 28px;"   ></p><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >[root@150 tmp]# docker ps -a</font></div><div style="line-height: 28px;"   ><font size="2"   >CONTAINER ID &nbsp; &nbsp; &nbsp; &nbsp;IMAGE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; COMMAND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STATUS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PORTS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NAMES</font></div><div style="line-height: 28px;"   ><font size="2"   >64b683e221ae &nbsp; &nbsp; &nbsp; &nbsp;centos6:6.6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo success &nbsp; &nbsp; &nbsp; &nbsp;19 minutes ago &nbsp; &nbsp; &nbsp;Exited (0) 19 minutes ago &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ecstatic_fermi &nbsp; &nbsp; &nbsp;</font></div></div><div style="line-height: 28px;"   ><div><font size="2"   ><br></font></div><div><font size="2"   >[root@150 ~]# docker commit -a "digoal@126.com" -m "this is centos6.6 base image created on centos6.5 x64" -p 64b683e221ae digoal/centos6:6.6</font></div><div><font size="2"   >6f7b94e36cd2bb846209418195b7569a048bc03a4badc51095a488ff6ddc8709</font></div></div><div style="line-height: 28px;"   ><font size="2"   ><br></font></div><div style="line-height: 28px;"   ><div><font size="2"   >[root@150 ~]# docker push digoal/centos6:6.6</font></div><div><font size="2"   >The push refers to a repository [digoal/centos6] (len: 1)</font></div><div><font size="2"   >Sending image list</font></div><div><font size="2"   >Pushing repository digoal/centos6 (1 tags)</font></div></div><div><font size="2"   >Pushing tag for rev [6f7b94e36cd2] on {https://cdn-registry-1.docker.io/v1/repositories/digoal/centos6/tags/6.6}</font></div><p style="line-height: 28px;"   ></p></pre></div></div><div><br></div><div>上传到私有registry</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# docker tag centos6:6.6 172.16.3.221:5000/digoal/centos6:6.6</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><span style="line-height: 21px;"   >[root@150 ~]# docker push 172.16.3.221:5000/digoal/centos6:6.6<br>The push refers to a repository [172.16.3.221:5000/digoal/centos6] (len: 1)<br>Sending image list<br>Pushing repository 172.16.3.221:5000/digoal/centos6 (1 tags)<br>c459824791f1: Image successfully pushed <br>Pushing tag for rev [c459824791f1] on {http://172.16.3.221:5000/v1/repositories/digoal/centos6/tags/6.6}</span></font></div><p></p></pre></div><div><br></div>[参考<span style="line-height: 28px;"   >]</span><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/docker/docker/blob/master/contrib/mkimage-yum.sh"   >https://github.com/docker/docker/blob/master/contrib/mkimage-yum.sh</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://docs.docker.com/articles/baseimages/"   >https://docs.docker.com/articles/baseimages/</a></div><div>3. man docker-import</div><div><wbr style="line-height: 28px;"   ><span style="line-height: 28px;"   >
</span><a style="line-height: 28px;" rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="how to create owned centos base image on centos - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">xmarker - 2014-11-18 15:01:28</h5>
				<div>问个问题，德哥，虽然通过mkimage-yum.sh脚本能创建一个实体操作系统的镜像，但我发现实体操作系统的自定义文件、源码安装的服务等在新创建的镜像中都没有了，如何能完全复制？<div>比如我实体机上通过源码安装的pg数据库、tomcat、nginx等，怎么能创建一个和实体操作系统一样的镜像?</div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 xmarker - 2014-11-18 15:01:28</h5>
				<div style="width:600px;">把你在本地安装的软件, 拷贝到<span style=""  >"$target"/相对路径, 下.   注意依赖库也拷贝到对应的相对路径下去, .</span></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 xmarker - 2014-11-18 15:01:28</h5>
				<div style="width:600px;">实际上你可以在container下安装你需要的软件, 然后commit. 不建议在做base image的时候做进去.</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">xmarker 回复 德哥@Digoal - 2014-11-18 15:01:28</h5>
				<div style="width:600px;">哦，谢谢德哥，还是从一开始就搞个容器然后加东西commit比较靠谱点</div>
			</div>
	</div>
</div>
</body>
</html>