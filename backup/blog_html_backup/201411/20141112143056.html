<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">manatee & SmartDataCenter 7 automated failover, fault monitoring and leader-election system built for managing a set of replicated PG servers.</h2>
	<h5 id="">2014-11-12 14:30:56&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020141012230798/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>manatee, 先记录一下, 是个不错的东西.</div><div>用来管理postgresql 基于流复制的HA, 需要依赖zfs, zookeeper.</div><div>作者在<a style="line-height: 28px; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://www.joyent.com/technology/smartos"   >SmartOS</a>上进行的测试, (主要是要用ZFS), 不知道在zfsonlinux下会怎么样, 需要进一步测试.</div><div><h1 style="box-sizing: border-box; font-size: 2.25em; margin: 1em 0px 16px; line-height: 1.2;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   >Overview</h1><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Welcome to the Manatee guide. This guide is intended to give you a quick introduction to Manatee, and to help you setup your own instance of Manatee.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >We assume that you already know how to administer a replicated PostgreSQL(PG) instance, and are familiar with general Unix concepts. For background information on HA PostgreSQL, look&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/high-availability.html"   >here</a>.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-what-is-manatee" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#what-is-manatee"   ></a>What is Manatee?</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee is an automated failover, fault monitoring and leader-election system built for managing a set of replicated PG servers. It is written completely in Node.js.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >A traditional replicated PG shard is not resilient to the death or partition of any of the nodes from the rest. This is generally solved by involving a human in the loop, such as having monitoring systems which alerts an operator to fix the shard manually when failure events occur.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee automates failover by using a consensus layer (Zookeeper) and takes the human out of the loop. In the face of network partitions or death of any node, Manatee will automatically detect these events and rearrange the shard topology so that neither durability nor availability are compromised. The loss of one node in a Manatee shard will not impact system read/write availability, even if it was the primary node in the shard. Reads are still available as long as there is&nbsp;<em style="box-sizing: border-box;"   >at least one</em>active node left in the shard. Data integrity is never compromised -- Manatee has built in data divergence detection and will prevent data on the nodes from forking from each other.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee also simplifies backups, restores and rebuilds. New nodes in the shard are automatically bootstrapped from existing nodes. If a node becomes unrecoverrable, it can be rebuilt by restoring from an existing node in the shard.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-architectural-components" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#architectural-components"   ></a>Architectural Components</h2><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-shard-overview" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#shard-overview"   ></a>Shard Overview</h3><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >This is the component diagram of a fully setup Manatee shard. Much of the details of each Manatee node itself has been simplified, with detailed descriptions in later sections.</p><div><img title="manatee  SmartDataCenter 7 automated failover, fault monitoring and leader-election system built for managing a set of replicated PG servers. - 德哥@Digoal - PostgreSQL research"   alt="manatee  SmartDataCenter 7 automated failover, fault monitoring and leader-election system built for managing a set of replicated PG servers. - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/WDzay0kFK7J9arSkYO9hdQ==/3362500071885765547.jpg"   ></div><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >&nbsp;</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Each shard consists of 3 Manatee nodes, a primary(A), synchronous standby(B) and asynchronous standby(C) setup in a daisy chain. Nodes only gossip to other nodes that are immediately adjacent in the graph. Using node A as an example, it is only aware of the node directly in front of it (none) and the node directly behind it, B.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   ><a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/warm-standby.html#CASCADING-REPLICATION"   >PostgreSQL Cascading replication</a>&nbsp;is used in the shard at (3). There is only one direct replication connection to each node from the node immediately behind it. That is, only B replicates from A, and only C replicates from B. C will never replicate from A as long as B is alive.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >The primary uses&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/warm-standby.html#SYNCHRONOUS-REPLICATION"   >PostgreSQL synchronous replication</a>&nbsp;to replicate to the synchronous standby. This ensures data written to Manatee will be persisted to at least the primary and sync standby. Without this, failovers of a node in the shard can cause data inconsistency between nodes. The synchronous standby uses asynchronous replication to the async standby.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >The topology of the shard is maintained by (1) and (2). Leaders of each node, (i.e. the node directly in front of self) are determined by (2) via Zookeeper(ZK). Standbys are determined by the standby node itself, the standby in this case B, determines via (2) that its leader is A, and communicates its standby status to A via (1).</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >When a node dies, the node that's directly behind it is promoted in the topology. If the promoted node was an async peer and is promoted to the sync peer, it's PG replication type is also changed from async to sync.</p><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-manatee-node-detail" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#manatee-node-detail"   ></a>Manatee Node Detail</h3><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Here are the components encapsulated within a single Manatee node.</p><div><img title="manatee  SmartDataCenter 7 automated failover, fault monitoring and leader-election system built for managing a set of replicated PG servers. - 德哥@Digoal - PostgreSQL research"   alt="manatee  SmartDataCenter 7 automated failover, fault monitoring and leader-election system built for managing a set of replicated PG servers. - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/Fj1rUoEhu_n07hR1UO3-8w==/2860067238374582941.jpg"   ></div><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >&nbsp;</p><h4 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.4; font-size: 1.25em;position:inherit; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-manatee-sitter" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#manatee-sitter"   ></a>Manatee Sitter</h4><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >The sitter is the main process in within Manatee. The PG process runs as the child of the sitter. PG never runs unless the sitter is running. The sitter is responsible for:</p><ul style="box-sizing: border-box; padding-left: 2em; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   ><li style="box-sizing: border-box;"   >Managing the underlying PG instance. The PG process runs as a child process of the sitter. This means that PG doesn't run unless the sitter is running. Additionally, the sitter initializes, restores, and configures the PG instance depending on its current role in the shard. (1)</li><li style="box-sizing: border-box;"   >Managing leadership status with ZK. Each sitter participates in a ZK election, and is notified when its leader node has changed. (5)</li><li style="box-sizing: border-box;"   >ZFS is used by PG to persist data (4). The use of ZFS will be elaborated on in a later section.</li></ul><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-manatee-snapshotter" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#manatee-snapshotter"   ></a>Manatee Snapshotter</h3><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >The snapshotter takes periodic ZFS snapshots of the PG instance. (2) These snapshots are used to backup and restore the database to other nodes in the shard.</p><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-manatee-backup-server" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#manatee-backup-server"   ></a>Manatee Backup Server</h3><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >The snapshots taken by the snapshotter are made available to other nodes by the REST backupserver. The backupserver, upon receiving a backup request, will send the snapshots to another node. (3) (6)</p><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-zfs" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#zfs"   ></a>ZFS</h3><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee relies on the&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://en.wikipedia.org/wiki/ZFS"   >ZFS</a>&nbsp;file system. Specifically, ZFS&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://illumos.org/man/1m/zfs"   >snapshots</a>&nbsp;are used to create point-in-time snapshots of the PG database. The&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >zfs send</code>&nbsp;and&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >zfs recv</code>&nbsp;utilities are used to restore or bootstrap other nodes in the shard.</p><h1 style="box-sizing: border-box; font-size: 2.25em; margin: 1em 0px 16px; line-height: 1.2;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-supported-platforms" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#supported-platforms"   ></a>Supported Platforms</h1><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee has been tested and runs in production on Joyent's&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://www.joyent.com/technology/smartos"   >SmartOS</a>, and should work on most&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://illumos.org/"   >Illumos</a>&nbsp;distributions such as OmniOS. Unix-like operating systems that have ZFS support should work, but have not been tested.</p><h1 style="box-sizing: border-box; font-size: 2.25em; margin: 1em 0px 16px; line-height: 1.2;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-dependencies" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#dependencies"   ></a>Dependencies</h1><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >You must install the following dependencies before installing Manatee.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-nodejs" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#nodejs"   ></a>Node.js</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee requires&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://nodejs.org/download/"   >Node.js 0.10.26</a>&nbsp;or later.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-zookeeper" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#zookeeper"   ></a>Zookeeper</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee requires&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://zookeeper.apache.org/releases.html"   >Apache Zookeeper 3.4.x</a>.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-postgresql" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#postgresql"   ></a>PostgreSQL</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee requires&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://www.postgresql.org/download/"   >PostgreSQL 9.2.x</a>&nbsp;or later.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-zfs-1" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#zfs-1"   ></a>ZFS</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee requires the&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://en.wikipedia.org/wiki/ZFS"   >ZFS</a>&nbsp;file system.</p><h1 style="box-sizing: border-box; font-size: 2.25em; margin: 1em 0px 16px; line-height: 1.2;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-installation" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#installation"   ></a>Installation</h1><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Get the latest Manatee&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="https://github.com/joyent/manatee"   >source</a>. Alternatively, you can grab the release&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="https://github.com/joyent/manatee/releases"   >tarball</a>.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Install the package dependencies via npm install.</p><div style="box-sizing: border-box; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><pre style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 0px; font-stretch: normal; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; word-break: normal; background-color: rgb(247, 247, 247);"   >[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>/manatee]# npm install</pre></div><h1 style="box-sizing: border-box; font-size: 2.25em; margin: 1em 0px 16px; line-height: 1.2;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-configuration" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#configuration"   ></a>Configuration</h1><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-setup-zookeeper" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#setup-zookeeper"   ></a>Setup Zookeeper</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Setup a Zookeeper instance by following&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://zookeeper.apache.org/doc/trunk/zookeeperAdmin.html"   >this guide</a>.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-manatee-configuration" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#manatee-configuration"   ></a>Manatee Configuration</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee comes with sample configs under&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="https://github.com/joyent/manatee/tree/master/etc"   >the etc directory</a>. Manatee configuration files are JSON-formatted.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >The default configuration files have been well tested and deployed in production. Refrain from tuning them, especially the timeouts, unless you are sure of the consequences.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-configuring-postgresql" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#configuring-postgresql"   ></a>Configuring PostgreSQL</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee comes with a default set of PG&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="https://github.com/joyent/manatee/tree/master/etc"   >configs</a>. You'll want to tune your&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >postgresql.conf</code>&nbsp;with parameters that suit your workload. Refer to the&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/www.postgres.com"   >PostgreSQL documentation</a>.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-smf" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#smf"   ></a>SMF</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >The illumos&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://www.illumos.org/man/5/smf"   >Service Management Facility</a>&nbsp;can be used as a process manager for the Manatee processes. SMF provides service supervision and restarter functionality for Manatee, among other things. There is a set of sample SMF manifests under&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="https://github.com/joyent/manatee/tree/master/smf"   >the smf directory</a>.</p><h1 style="box-sizing: border-box; font-size: 2.25em; margin: 1em 0px 16px; line-height: 1.2;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-administration" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#administration"   ></a>Administration</h1><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >This section assumes you are using SMF to manage the Manatee instances and are running on SmartOS.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-creating-a-new-manatee-shard" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#creating-a-new-manatee-shard"   ></a>Creating a new Manatee Shard</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >The physical location of each Manatee node in the shard is important. Each Manatee node should be located on a different<em style="box-sizing: border-box;"   >physical</em>&nbsp;host than the others in the shard, and if possible in different data centers. In this way, failures of a single physical host or DC will not impact the availability of your Manatee shard.</p><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-setting-up-smf" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#setting-up-smf"   ></a>Setting up SMF</h3><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >It's recommended that you use a service restarter, such as SMF, with Manatee. Before running Manatee as an SMF service, you must first import the service manifest.</p><div style="box-sizing: border-box; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><pre style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 0px; font-stretch: normal; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; word-break: normal; background-color: rgb(247, 247, 247);"   >[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>/manatee]# svccfg import ./smf/sitter.xml
[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>/manatee]# svccfg import ./smf/backupserver.xml
[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>/manatee]# svccfg import ./smf/snapshotter.xml</pre></div><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Check the svcs have been imported:</p><div style="box-sizing: border-box; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><pre style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 0px; font-stretch: normal; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; word-break: normal; background-color: rgb(247, 247, 247);"   >[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>]# svcs -a <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >|</span> grep manatee
disabled       17:33:13 svc:/manatee-sitter:default
disabled       17:33:13 svc:/manatee-backupserver:default
disabled       17:33:13 svc:/manatee-snapshotter:default</pre></div><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Once the manifests have been imported, you can start the services.</p><div style="box-sizing: border-box; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><pre style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 0px; font-stretch: normal; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; word-break: normal; background-color: rgb(247, 247, 247);"   >[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>/manatee]# svcadm <span style="box-sizing: border-box; color: rgb(209, 32, 137);"   >enable</span> manatee-sitter
[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>/manatee]# svcadm <span style="box-sizing: border-box; color: rgb(209, 32, 137);"   >enable</span> manatee-backupserver
[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>/manatee]# svcadm <span style="box-sizing: border-box; color: rgb(209, 32, 137);"   >enable</span> manatee-snapshotter</pre></div><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Repeat these steps on all Manatee nodes. You now have a highly available automated failover PG shard.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-adding-a-new-node-to-the-manatee-shard" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#adding-a-new-node-to-the-manatee-shard"   ></a>Adding a new Node to the Manatee Shard</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Adding a new node is easy.</p><ul style="box-sizing: border-box; padding-left: 2em; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   ><li style="box-sizing: border-box;"   >Create a new node.</li><li style="box-sizing: border-box;"   >Install and configure Manatee from the steps above.</li><li style="box-sizing: border-box;"   >Setup and start the Manatee SMF services.</li></ul><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >This new node will automatically determine its position in the shard and clone its PG data from its leader. You do not need to manually build the new node.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-moving-manatee-nodes" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#moving-manatee-nodes"   ></a>Moving Manatee Nodes</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >In the normal course of maintenance, you may need to move or upgrade the Manatee nodes in the shard. You can do this by adding a new node to the shard, waiting for it to catch up (using tools described in the following sectons), and then removing the node you wanted to move/upgrade.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Additional nodes past the initial 3 will just be asynchronous standbys and will not impact the shard's performance or availability.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-shard-administration" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#shard-administration"   ></a>Shard Administration</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee provides the&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >manatee-adm</code>&nbsp;utility which gives visibility into the status of the Manatee shard. One of the key subcommands is the&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >status</code>&nbsp;command.</p><div style="box-sizing: border-box; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><pre style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 0px; font-stretch: normal; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; word-break: normal; background-color: rgb(247, 247, 247);"   >[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>/manatee]# ./node_modules/manatee/bin/manatee-adm status -z <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >&lt;</span>zk_ip<span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >&gt;</span>
{
<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1<span style="box-sizing: border-box;"   >"</span></span>: {
    <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>primary<span style="box-sizing: border-box;"   >"</span></span>: {
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.4.12<span style="box-sizing: border-box;"   >"</span></span>,
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>pgUrl<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>tcp://postgres@172.27.4.12:5432/postgres<span style="box-sizing: border-box;"   >"</span></span>,
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zoneId<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>b515b611-3b6e-4cc9-8d1f-3cf78e27bf24<span style="box-sizing: border-box;"   >"</span></span>,
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>repl<span style="box-sizing: border-box;"   >"</span></span>: {
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>pid<span style="box-sizing: border-box;"   >"</span></span>: 23047,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>usesysid<span style="box-sizing: border-box;"   >"</span></span>: 10,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>usename<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>postgres<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>application_name<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>tcp://postgres@172.27.5.8:5432/postgres<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>client_addr<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.5.8<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>client_hostname<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>client_port<span style="box-sizing: border-box;"   >"</span></span>: 42718,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>backend_start<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-04-28T17:07:55.548Z<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>state<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>streaming<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>sent_location<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>E/D9D14780<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>write_location<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>E/D9D14780<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>flush_location<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>E/D9D14780<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>replay_location<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>E/D9D14378<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>sync_priority<span style="box-sizing: border-box;"   >"</span></span>: 1,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>sync_state<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>sync<span style="box-sizing: border-box;"   >"</span></span>
        }
    },
    <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>sync<span style="box-sizing: border-box;"   >"</span></span>: {
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.5.8<span style="box-sizing: border-box;"   >"</span></span>,
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>pgUrl<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>tcp://postgres@172.27.5.8:5432/postgres<span style="box-sizing: border-box;"   >"</span></span>,
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zoneId<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>d2de0030-986e-4dae-991d-7d85f2e333d9<span style="box-sizing: border-box;"   >"</span></span>,
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>repl<span style="box-sizing: border-box;"   >"</span></span>: {
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>pid<span style="box-sizing: border-box;"   >"</span></span>: 95136,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>usesysid<span style="box-sizing: border-box;"   >"</span></span>: 10,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>usename<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>postgres<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>application_name<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>tcp://postgres@172.27.3.7:5432/postgres<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>client_addr<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.7<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>client_hostname<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>client_port<span style="box-sizing: border-box;"   >"</span></span>: 53461,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>backend_start<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-04-28T21:28:07.905Z<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>state<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>streaming<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>sent_location<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>E/D9D14780<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>write_location<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>E/D9D14780<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>flush_location<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>E/D9D14780<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>replay_location<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>E/D9D14378<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>sync_priority<span style="box-sizing: border-box;"   >"</span></span>: 0,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>sync_state<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>async<span style="box-sizing: border-box;"   >"</span></span>
        }
    },
    <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>async<span style="box-sizing: border-box;"   >"</span></span>: {
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.7<span style="box-sizing: border-box;"   >"</span></span>,
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>pgUrl<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>tcp://postgres@172.27.3.7:5432/postgres<span style="box-sizing: border-box;"   >"</span></span>,
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zoneId<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>70d44638-f4fb-4cbd-8611-0f7c83d8502f<span style="box-sizing: border-box;"   >"</span></span>,
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>repl<span style="box-sizing: border-box;"   >"</span></span>: {},
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>lag<span style="box-sizing: border-box;"   >"</span></span>: {
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time_lag<span style="box-sizing: border-box;"   >"</span></span>: {}
        }
    }
}
}</pre></div><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >This prints out the current topology of the shard. The "repl" field shows the standby that's currently connected to the node. It's the same set of fields that is returned by the PG query&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >select * from pg_stat_replication</code>. The repl field is helpful in verifying the status of the PostgreSQL instances. If the repl field exists, it means that the node's standby is caught up and streaming. If there is no repl field, it means that there is no PG instance replication from this node. This is expected with the last node in the shard.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >However, if there is another node after the current one in the shard, and there is no repl field, it indicatees there is a problem with replication between the two nodes.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-shard-history" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#shard-history"   ></a>Shard History</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >You can query any past topology changes by using the&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >history</code>&nbsp;subcommand.</p><div style="box-sizing: border-box; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><pre style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 0px; font-stretch: normal; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; word-break: normal; background-color: rgb(247, 247, 247);"   >[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>/manatee]# ./node_modules/manatee/bin/manatee-adm <span style="box-sizing: border-box; color: rgb(209, 32, 137);"   >history</span> -s <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >'</span>1<span style="box-sizing: border-box;"   >'</span></span> -z <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >&lt;</span>zk_ips<span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >&gt;</span>
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1394597418025<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-12T04:10:18.025Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.8<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>AssumeLeader<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Leader<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000000<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1394597438430<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-12T04:10:38.430Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.4.13<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewLeader<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Standby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.8<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000001<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1394597451091<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-12T04:10:51.091Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.8<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewStandby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Leader<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>5432<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000002<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1394597477394<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-12T04:11:17.394Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.5.9<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewLeader<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Standby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.4.13<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000003<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1394597473513<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-12T04:11:13.513Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.4.13<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewStandby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Standby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.8<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>5432<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000004<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1395446372034<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-21T23:59:32.034Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.5.9<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewLeader<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Standby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.8<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000005<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1395446374071<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-21T23:59:34.071Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.8<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewStandby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Leader<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>5432<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000006<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1395449937712<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-22T00:58:57.712Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.4.13<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewLeader<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Standby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.5.9<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000007<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1395449938742<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-22T00:58:58.742Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.5.9<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewStandby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Standby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.8<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>5432<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000008<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1395450121000<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-22T01:02:01.000Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.5.9<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewLeader<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Standby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.4.13<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000009<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1395450121005<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-22T01:02:01.005Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.5.9<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewStandby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Standby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.4.13<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>5432<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000010<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1395450121580<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-22T01:02:01.580Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.4.13<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewLeader<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Standby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.8<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span><span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000011<span style="box-sizing: border-box;"   >"</span></span>}
{<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>time<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1395450122033<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>date<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>2014-03-22T01:02:02.033Z<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>ip<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.4.13<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>action<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>NewStandby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>role<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>Standby<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>master<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.3.8<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>slave<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>5432<span style="box-sizing: border-box;"   >"</span></span>,<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zkSeq<span style="box-sizing: border-box;"   >"</span></span>:<span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>0000000012<span style="box-sizing: border-box;"   >"</span></span>}</pre></div><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >This will return a list of every single Manatee flip sorted by time. The node is identified by the "ip" field. The type of transition is identified by the "action" field. The current role of the node is identified by the "role" field. Only the first element of the daisy chain, i.e. the Primary node, will ever have the role of Leader. All other nodes will be standbys.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >There are 3 different types of Manatee flips:</p><ul style="box-sizing: border-box; padding-left: 2em; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   ><li style="box-sizing: border-box;"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >AssumeLeader</code>. This means the node has become the primary of the shard. This might mean that the primary has changed. Verify against the last AssumeLeader event to see if the primary has changed.</li><li style="box-sizing: border-box;"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >NewLeader</code>. This means the current node's leader may have changed. the "master" field represents its new leader. Note that its leader may not neccessarily be the primary of the shard, it only represents the node directly in front of the current node.</li><li style="box-sizing: border-box;"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >NewStandby</code>. This means the current node's standby may have changed. The "slave" field represents the new standby node.</li></ul><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >This tool is invaluable when attempting to reconstruct the timeline of flips in a Manatee shard, especially when the shard is in safe mode.</p><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a id="user-content-safe-mode" style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" aria-hidden="true" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/user-guide.md#safe-mode"   ></a>Safe Mode</h2><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >You can check that the shard is in safe mode via&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >manatee-adm status</code>.</p><div style="box-sizing: border-box; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><pre style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 0px; font-stretch: normal; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; word-break: normal; background-color: rgb(247, 247, 247);"   >[root@host <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >~</span>/manatee]# ./node_modules/manatee/bin/manatee-stat -p <span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >&lt;</span>zk_ip<span style="box-sizing: border-box; color: rgb(110, 84, 148);"   >&gt;</span>
{
    <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>1<span style="box-sizing: border-box;"   >"</span></span>: {
        <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>error<span style="box-sizing: border-box;"   >"</span></span>: {
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>primary<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>172.27.4.12<span style="box-sizing: border-box;"   >"</span></span>,
            <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>zoneId<span style="box-sizing: border-box;"   >"</span></span>: <span style="box-sizing: border-box; color: rgb(223, 80, 0);"   ><span style="box-sizing: border-box;"   >"</span>8372b732-007c-400c-9642-9eb63d169cf2<span style="box-sizing: border-box;"   >"</span></span>
        }
    }
}</pre></div><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >The&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-stretch: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >error</code>&nbsp;field indicates that the shard is in safe mode.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >When in safe mode, Manatee will be only available for reads but you will not be able to write to it until it is manually cleared by an operator.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Before we run through how to bring a Manatee back up from safe mode, it's important to discuss why safe mode exists.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >There are situations through a series of Manatee flips where the shard's data could potentially become inconsistent. Consider the following scenario: We have a Manatee shard at rest with nodes A, B, and C. Refer to the&nbsp;<em style="box-sizing: border-box;"   >Shard Overview</em>section for the diagram of this topology.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Now, imagine that all 3 nodes restart at around the same time. If C enters the shard first, it becomes the primary of the shard. Because it was previously the async, its PG xlog may not be completely up to date. If C starts taking writes at this point then the data between C, and A/B will become forked and the shard has become inconsistent.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >Manatee will not allow this to happen. The shard will enter safe mode if detects a mismatch between the primary and its standby's xlogs.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >In practice this situation could occur frequently, e.g. in the face of network partitions. Instead of taking a 33% chance each time this happens that the shard will enter safe mode (if the async gets promoted to primary), Manatee proactively tries to avoid this by persisting information about the previous topological state. Only the previous primary or sync can be promoted to the primary.</p><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   >However, due to some limitations in PG itself, this is sometimes not sufficient. In this case, the shard will detect that it can no longer take writes and put itself into safe mode.</p><p style="box-sizing: border-box; margin-top: 0px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px; margin-bottom: 0px !important;"   >For information on how to recover from Safe mode, check out the&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="https://github.com/joyent/manatee/blob/master/docs/trouble-shooting.md"   >trouble shooting guide</a></p></div><div><br></div><div>[参考]</div>1.&nbsp;<a target="_blank" rel="nofollow" href="https://github.com/joyent/manatee"   >https://github.com/joyent/manatee</a><br><wbr><div>2.&nbsp;<a target="_blank" rel="nofollow" href="https://docs.joyent.com/sdc7/overview-of-smartdatacenter-7"   >https://docs.joyent.com/sdc7/overview-of-smartdatacenter-7</a></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="manatee  SmartDataCenter 7 automated failover, fault monitoring and leader-election system built for managing a set of replicated PG servers. - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>