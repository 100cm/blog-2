<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Open PostgreSQL Monitoring powered by Dalibo</h2>
	<h5 id="">2014-09-30 9:51:35&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201483094449528/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><h1 style="margin-top: 0em; margin-bottom: 0em; font-family: verdana, sans-serif;"   ><font size="3"   ><span style="font-weight: normal; line-height: 28px;"   >opm是dalibo开发的一个数据库监控软件, 个人感觉目前还没有pg_statsinfo好用.</span></font></h1><div><font size="3"   ><span style="font-weight: normal; line-height: 28px;"   >如果要集成到统一的监控平台, 建议使用zabbix, nagios, ganglia这类. 只要自己掌握好要监控的指标, 添加即可.</span></font></div><h1 style="margin-top: 0em; margin-bottom: 0em; font-family: verdana, sans-serif;"   ><font size="3"   ><span style="font-weight: normal; line-height: 28px;"   >安装参考 :&nbsp;</span></font></h1><div><a target="_blank" rel="nofollow" href="http://opm.readthedocs.org/opm-core/Installation.html"   >http://opm.readthedocs.org/opm-core/Installation.html</a></div><div><h1 style="box-sizing: border-box; margin-top: 0px; font-family: 'Roboto Slab', ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 28px; color: rgb(64, 64, 64); line-height: normal; background-color: rgb(252, 252, 252);"   >Installation</h1><div id="requirements"   style="box-sizing: border-box; color: rgb(64, 64, 64); font-family: Lato, proxima-nova, 'Helvetica Neue', Arial, sans-serif; line-height: normal; background-color: rgb(252, 252, 252);"   ><h2 style="box-sizing: border-box; margin-top: 0px; font-family: 'Roboto Slab', ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 24px;"   >Requirements</h2><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >To install OPM, you need a 9.3 or more PostgreSQL cluster, standard compiling tools and Nagios. The PostgreSQL cluster and Nagios can be installed on the servers you want, and can be installed on the same server.</p></div><div id="system"   style="box-sizing: border-box; color: rgb(64, 64, 64); font-family: Lato, proxima-nova, 'Helvetica Neue', Arial, sans-serif; line-height: normal; background-color: rgb(252, 252, 252);"   ><h2 style="box-sizing: border-box; margin-top: 0px; font-family: 'Roboto Slab', ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 24px;"   >System</h2><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >The tool “pg_config” is required, install the PostgreSQL development packages of your Linux distribution if necessary. We suppose that the repositories&nbsp;<strong style="box-sizing: border-box;"   >opm-core</strong>&nbsp;and&nbsp;<strong style="box-sizing: border-box;"   >opm-wh_nagios</strong>&nbsp;are stored into&nbsp;<strong style="box-sizing: border-box;"   >/usr/local/src/opm/</strong>.</p></div><div id="opm-core"   style="box-sizing: border-box; color: rgb(64, 64, 64); font-family: Lato, proxima-nova, 'Helvetica Neue', Arial, sans-serif; line-height: normal; background-color: rgb(252, 252, 252);"   ><h2 style="box-sizing: border-box; margin-top: 0px; font-family: 'Roboto Slab', ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 24px;"   >OPM core</h2><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >We need to install the core of opm first. From your opm directory as user “root”:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >root:/usr/local/src/opm# cd opm-core/pg
root:/usr/local/src/opm/opm-core/pg# make install
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Then, using a superuser role:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >postgres@postgres=# CREATE DATABASE opm;
postgres@postgres=# \c opm
postgres@opm=# CREATE EXTENSION opm_core;
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >You’ll need to create a first opm admin account:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >postgres@opm=# SELECT create_admin('admin1', 'admin1');
</pre></div></div></div><div id="wh-nagios"   style="box-sizing: border-box; color: rgb(64, 64, 64); font-family: Lato, proxima-nova, 'Helvetica Neue', Arial, sans-serif; line-height: normal; background-color: rgb(252, 252, 252);"   ><h2 style="box-sizing: border-box; margin-top: 0px; font-family: 'Roboto Slab', ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 24px;"   >wh_nagios</h2><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >To install the module “wh_nagios”, from your opm directory as user “root”:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >root:/usr/local/src/opm# cd opm-wh_nagios/pg
root:/usr/local/src/opm/wh_nagios/pg# make install
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Then, using a superuser role:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >postgres@opm=# CREATE EXTENSION hstore;
CREATE EXTENSION

postgres@opm=# CREATE EXTENSION wh_nagios;
CREATE EXTENSION
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Then, you need to create a crontab that will process incoming data and dispatch them. As instance, to trigger it every minute:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >* * * * * psql -c 'SELECT wh_nagios.dispatch_record()' opm
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >This crontab can belong to any user, as long as it can connect to the PostgreSQL opm database.</p><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >To allows a opm role to import data in a warehouse, you need to call “public.grant_dispatch”. As instance, for a opm role called “user1” on warehouse “wh_nagios”:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >postgres@opm=# SELECT grant_dispatcher('wh_nagios', 'user1');
</pre></div></div></div><div id="nagios-nagios-dispatcher"   style="box-sizing: border-box; color: rgb(64, 64, 64); font-family: Lato, proxima-nova, 'Helvetica Neue', Arial, sans-serif; line-height: normal; background-color: rgb(252, 252, 252);"   ><h2 style="box-sizing: border-box; margin-top: 0px; font-family: 'Roboto Slab', ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 24px;"   >Nagios &amp; nagios_dispatcher</h2><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >The dispatcher “nagios_dispatcher” aimed to dispatch perfdata from Nagios files to the “wh_nagios” warehouse.</p><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >“nagios_dispatcher” require the DBD::Pg perl module. Make sure to install it on your system . Eg. under debian:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >root:~# apt-get install libdbd-pg-perl
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >We’ll need first to setup Nagios to create its perdata files that “nagios_dispatcher” will poll and consume. As user “root”, create to required command file and destination folder:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >root:~# mkdir -p /var/lib/nagios3/spool/perfdata/
root:~# chown nagios: /var/lib/nagios3/spool/perfdata/
root:~# cat &lt;&lt;'EOF' &gt;&gt; /etc/nagios3/commands.cfg
define command{
    command_name    process-service-perfdata-file
    command_line    /bin/mv /var/lib/nagios3/service-perfdata /var/lib/nagios3/spool/perfdata/service-perfdata.$TIMET$
}
define command{
    command_name    process-host-perfdata-file
    command_line    /bin/mv /var/lib/nagios3/host-perfdata /var/lib/nagios3/spool/perfdata/host-perfdata.$TIMET$
}
EOF
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Then, in your Nagios main configuration file, make sure the following parameter are set accordingly:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >process_performance_data=1
host_perfdata_file=/var/lib/nagios3/host-perfdata
service_perfdata_file=/var/lib/nagios3/service-perfdata
host_perfdata_file_processing_command=process-host-perfdata-file
service_perfdata_file_processing_command=process-service-perfdata-file
host_perfdata_file_template=DATATYPE::HOSTPERFDATA\tTIMET::$TIMET$\tHOSTNAME::$HOSTNAME$\tHOSTPERFDATA::$HOSTPERFDATA$\tHOSTCHECKCOMMAND::$HOSTCHECKCOMMAND$\tHOSTSTATE::$HOSTSTATE$\tHOSTSTATETYPE::$HOSTSTATETYPE$\tHOSTOUTPUT::$HOSTOUTPUT$
service_perfdata_file_template=DATATYPE::SERVICEPERFDATA\tTIMET::$TIMET$\tHOSTNAME::$HOSTNAME$\tSERVICEDESC::$SERVICEDESC$\tSERVICEPERFDATA::$SERVICEPERFDATA$\tSERVICECHECKCOMMAND::$SERVICECHECKCOMMAND$\tHOSTSTATE::$HOSTSTATE$\tHOSTSTATETYPE::$HOSTSTATETYPE$\tSERVICESTATE::$SERVICESTATE$\tSERVICESTATETYPE::$SERVICESTATETYPE$\tSERVICEOUTPUT::$SERVICEOUTPUT$
host_perfdata_file_mode=a
service_perfdata_file_mode=a
host_perfdata_file_processing_interval=15
service_perfdata_file_processing_interval=15
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >The dispatcher itself:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >root:~# mkdir -p /usr/local/etc/
root:~# cat &lt;&lt;EOF &gt; /usr/local/etc/nagios_dispatcher.conf
daemon=1
directory=/var/lib/nagios3/spool/perfdata/
frequency=5
db_connection_string=dbi:Pg:dbname=opm host=127.0.0.1
db_user=YOUR_USER
db_password=YOUR_PASS
debug=0
syslog=1
hostname_filter = /^$/ # Empty hostname. Never happens
service_filter = /^$/ # Empty service
label_filter = /^$/ # Empty label
EOF

root:~# chown nagios /usr/local/etc/nagios_dispatcher.conf
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Install the nagios_dispatcher.pl file into the /usr/local/bin/ directory:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >root:~# cp /usr/local/src/opm/ /usr/local/bin
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Add the following line at the end of the /etc/inittab file:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >d1:23:respawn:/usr/bin/perl -w /usr/local/bin/nagios_dispatcher.pl --daemon --config /usr/local/etc/nagios_dispatcher.conf
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Reload the /etc/inittab file:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >root:~# init q
</pre></div></div></div><div id="user-interface"   style="box-sizing: border-box; color: rgb(64, 64, 64); font-family: Lato, proxima-nova, 'Helvetica Neue', Arial, sans-serif; line-height: normal; background-color: rgb(252, 252, 252);"   ><h2 style="box-sizing: border-box; margin-top: 0px; font-family: 'Roboto Slab', ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 24px;"   >User interface</h2><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >The default user interface is based on the web framework&nbsp;<a style="box-sizing: border-box; color: rgb(155, 89, 182); text-decoration: none;" rel="nofollow" href="http://www.mojolicio.us/"   >Mojolicious</a>. You need to install:</p><ul style="box-sizing: border-box; margin-top: 0px; margin-bottom: 24px; margin-left: 0px; list-style-position: initial; list-style-image: initial; line-height: 24px;"   ><li style="box-sizing: border-box; list-style: disc; margin-left: 24px;"   >Perl (5.10 or above)</li><li style="box-sizing: border-box; list-style: disc; margin-left: 24px;"   >Mojolicious (4.50 or above, less than 5.0)</li><li style="box-sizing: border-box; list-style: disc; margin-left: 24px;"   >Mojolicious::Plugin::I18N</li><li style="box-sizing: border-box; list-style: disc; margin-left: 24px;"   >PostgreSQL (9.3 or above)</li><li style="box-sizing: border-box; list-style: disc; margin-left: 24px;"   >A CGI/Perl webserver</li></ul><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >You can install “Mojolicious” using CAPN, the&nbsp;<em style="box-sizing: border-box;"   >online script</em>&nbsp;or your Linux distribution package system if available. Here is an example with the online script:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >curl get.mojolicio.us | sh
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >“Mojolicious::Plugin::I18N” is available on CPAN.</p><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >To install the UI plugin “wh_nagios” (or any other UI plugin), from your opm directory as user “root”:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >root:/usr/local/src/opm# cd opm-core/ui/modules
root:/usr/local/src/opm/opm-core/ui/modules# ln -s /usr/local/src/opm/opm-wh_nagios/ui wh_nagios
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Then, on your OPM database side, you need to create an opm user for the UI:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >postgres@opm=# CREATE USER opmui WITH ENCRYPTED PASSWORD 'opmui';
postgres@opm=# SELECT * from grant_appli('opmui');
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Finally, in the directory&nbsp;<strong style="box-sizing: border-box;"   >/usr/local/src/opm/opm-core/ui</strong>, copy the&nbsp;<strong style="box-sizing: border-box;"   >opm.conf-dist</strong>&nbsp;file to<strong style="box-sizing: border-box;"   >opm.conf</strong>, and edit it to suit you needs, for instance:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >{
    ...
    "database" : {
        "dbname"   : "opm",
        "host"     : "127.0.0.1",
        "port"     : "5432",
        "user"     : "opmui",
        "password" : "opmui"
    },
    ...
    "plugins" : [ "wh_nagios" ]
}
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >To test the web user interface quickly, you can use either “morbo” or “hypnotoad”, both installed with Mojolicious. Example with Morbo:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >user:/usr/local/src/opm/opm-core/ui/opm$ morbo script/opm
[Fri Nov 29 12:12:52 2013] [debug] Helper "url_for" already exists, replacing.
[Fri Nov 29 12:12:52 2013] [debug] Reading config file "/home/ioguix/git/opm/ui/opm/opm.conf".
[Fri Nov 29 12:12:53 2013] [info] Listening at "http://*:3000".
Server available at http://127.0.0.1:3000.
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Using “hypnotoad”, which suit better for production:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >user:/usr/local/src/opm/ui/opm/opm-core$ hypnotoad -f script/opm
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >Removing “-f” makes it daemonize.</p><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >If you want to use “apache”, here is a quick configuration sample using CGI:</p><div style="box-sizing: border-box; border: 1px solid rgb(225, 228, 229); padding: 0px; overflow-x: auto; margin: 1px 0px 24px; background: rgb(255, 255, 255);"   ><div style="box-sizing: border-box; border: none; padding: 0px; overflow-x: auto; margin: 0px; background: none;"   ><pre style="box-sizing: border-box; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 12px; margin-top: 0px; margin-bottom: 0px; padding: 12px; line-height: 1.5; overflow: auto;"   >&lt;VirtualHost *:80&gt;
        ServerAdmin webmaster@example.com
        ServerName opm.example.com
        DocumentRoot /var/www/opm/public/

        &lt;Directory /var/www/opm/public/&gt;
                AllowOverride None
                Order allow,deny
                allow from all
                IndexIgnore *

                RewriteEngine On
                RewriteBase /
                RewriteRule ^$ opm.cgi [L]
                RewriteCond %{REQUEST_FILENAME} !-f
                RewriteCond %{REQUEST_FILENAME} !-d
                RewriteRule ^(.*)$ opm.cgi/$1 [L]
        &lt;/Directory&gt;

        ScriptAlias /opm.cgi /var/www/opm/script/opm
        &lt;Directory /var/www/opm/script/&gt;
                AddHandler cgi-script .cgi
                Options +ExecCGI
                AllowOverride None
                Order allow,deny
                allow from all
                SetEnv MOJO_MODE production
                SetEnv MOJO_MAX_MESSAGE_SIZE 4294967296
        &lt;/Directory&gt;

        ErrorLog ${APACHE_LOG_DIR}/opm.log
        # Possible values include: debug, info, notice, warn, error, crit,
        # alert, emerg.
        LogLevel warn

        CustomLog ${APACHE_LOG_DIR}/opm.log combined
&lt;/VirtualHost&gt;
</pre></div></div><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >(assuming that the directory&nbsp;<strong style="box-sizing: border-box;"   >/usr/local/src/opm/opm-core/ui</strong>&nbsp;has been symlinked to<strong style="box-sizing: border-box;"   >/var/www/opm</strong>).</p><p style="box-sizing: border-box; line-height: 24px; margin-top: 0px; margin-bottom: 24px;"   >For a complete list and specifications on supported http servers, please check the&nbsp;<a style="box-sizing: border-box; color: rgb(155, 89, 182); text-decoration: none;" rel="nofollow" href="http://mojolicio.us/perldoc/Mojolicious/Guides/Cookbook#DEPLOYMENT"   >Mojolicious official documentation</a>.</p></div></div><h1 style="font-size: 1.4em; margin-top: 0em; margin-bottom: 0em; color: rgb(236, 88, 0); font-family: verdana, sans-serif; line-height: normal;"   >Introducing Open PostgreSQL Monitoring (OPM)</h1><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   ><em>Paris, September 8th 2014</em></p><h2 style="font-size: 1.2em; margin: 1.2em 0em; color: rgb(102, 102, 102); font-family: verdana, sans-serif; line-height: normal;"   >Oversee and Manage Your PostgreSQL Servers</h2><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >The OPM Development Group (see below) is proud to present the first public release of Open PostgreSQL Monitoring, a fully open source monitoring suite for PostgreSQL.</p><h2 style="font-size: 1.2em; margin: 1.2em 0em; color: rgb(102, 102, 102); font-family: verdana, sans-serif; line-height: normal;"   >Get Graphs and Stats from your PostgreSQL instances!</h2><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >PostgreSQL may be the most advanced database in the world but one of its biggest handicap is the lack of open source dedicated monitoring tools. Compared to its competitors, the PostgreSQL community has not been able to produce tools similar to Oracle Grid Control, MySQL Workbench or SQL Server Management Studio.</p><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >Today we'd like to present the OPM project: a fully open-source suite designed to provide dynamic graphs, custom stats series, performance analysis, server health overview and team management...</p><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >If you have serveral postgres servers in production, Open PostgreSQL Monitoring is the perfect to watch the current activity of your databases, with DBA-centric stats such as: database size, hit ratio, streaming replication lag, system load, page bloat, longest queries, WAL files generation, locks, backends status, etc.</p><h2 style="font-size: 1.2em; margin: 1.2em 0em; color: rgb(102, 102, 102); font-family: verdana, sans-serif; line-height: normal;"   >Extensibility is the key</h2><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >This initial public version is obviously a first step toward more features and more versatility.</p><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >OPM includes remote agents, a stat storage system and a web GUI. Most of the code is currently in Perl and the stat collection is based on Nagios, but the whole suite is designed to be extended to other monitoring frameworks and other languages. It is possible to your own remote agent, a specific stat storage or even an alternative user interface.</p><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >The OPM project was started in 2012 and it's been used in production for months, monitoring dozens of servers like a charm. We're publishing today the version 2.3 with the hope that it will be useful for other PostgreSQL users around the world.</p><h2 style="font-size: 1.2em; margin: 1.2em 0em; color: rgb(102, 102, 102); font-family: verdana, sans-serif; line-height: normal;"   >Credits</h2><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >The OPM Development Group would like to thank all the developers who contributed to this release, especially Sebastien Fauveau from&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://a.rtisco.de/"   >Art is Code</a>&nbsp;for his UI/UX design skills.<br></p><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >OPM is an open project available under the PostgreSQL License. Any contribution to build a better tool is welcome. You just have to send your ideas, features requests or patches using the GitHub tools or directly to contact@opm.io</p><h2 style="font-size: 1.2em; margin: 1.2em 0em; color: rgb(102, 102, 102); font-family: verdana, sans-serif; line-height: normal;"   >Links</h2><ul style="font-size: 12px; line-height: 1.2em; margin-top: 0.2em; margin-bottom: 0.1em; font-family: verdana, sans-serif;"   ><li style="font-size: 1em; line-height: 1.2em; margin-top: 0.2em; margin-bottom: 0.1em;"   >Website :&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://opm.io/"   >http://opm.io/</a></li><li style="font-size: 1em; line-height: 1.2em; margin-top: 0.2em; margin-bottom: 0.1em;"   >Demo :&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://demo.opm.io/"   >http://demo.opm.io</a>&nbsp;(login/pass = opm/demo)</li><li style="font-size: 1em; line-height: 1.2em; margin-top: 0.2em; margin-bottom: 0.1em;"   >twitter :&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://twiter.com/__opm__"   >@<strong>opm</strong></a></li></ul><hr style="font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"   ><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   ><strong>About OPM</strong>&nbsp;:</p><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >Open PostgreSQL Monitoring is a free software designed to help you manage your PostgreSQL servers. It's a flexible tool that will follow the activity of each instance. It can gather stats, display dashboards and send warnings when something goes wrong. The long-term goal of the project is to provide similar features to those of Oracle Grid Control or SQL Server Management Studio.</p><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >Code &amp; Demo at&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://opm.io/"   >http://opm.io/</a></p><hr style="font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"   ><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   ><strong>About the OPM Development Group</strong>&nbsp;:</p><p style="font-size: 12px; line-height: 1.2em; margin: 1.2em 0em; font-family: verdana, sans-serif;"   >This project is driven by the OPM Development Group (OPMDG), a team of developers gathered to build efficient monitoring tools for PostgreSQL. So far the main sponsor of this project is DALIBO, the leading PostgreSQL company in France. However the project team is open to ideas and contributions: individuals and companies who share the goals of the OPMDG are welcome to join the team!</p></div><wbr><div><br></div>[参考]<div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/about/news/1542/"   >http://www.postgresql.org/about/news/1542/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://opm.io/"   >http://opm.io/</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://demo.opm.io/"   >http://demo.opm.io/</a></div><div>user: opm</div><div>pwd: demo</div><div><br><div><a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Open PostgreSQL Monitoring powered by Dalibo - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a><br></div></div></div>
	</div>
</div>
</body>
</html>