<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">fence vmware use vmware vSphere SDK for Perl</h2>
	<h5 id="">2014-09-25 10:56:29&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201481805519157/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div><div>我们可以通过fence_vmware命令连接到vCenter来fence vCenter管理的虚拟机.</div><div>本文将简单的描述一下fence_vmware的使用, 以及/etc/cluster/cluster.conf的配置.</div><div>命令行帮助如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@digoal_02 soft_bak]# fence_vmware --help</font></div><div><font size="2"   >Usage:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fence_vmware [options]</font></div><div><font size="2"   >Options:</font></div><div><font size="2"   >&nbsp; &nbsp;-o, --action=&lt;action&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Action: status, reboot (default), off or on</font></div><div><font size="2"   >&nbsp; &nbsp;-a, --ip=&lt;ip&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IP address or hostname of fencing device</font></div><div><font size="2"   >&nbsp; &nbsp;-l, --username=&lt;name&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Login name</font></div><div><font size="2"   >&nbsp; &nbsp;-p, --password=&lt;password&gt; &nbsp; &nbsp; &nbsp;Login password or passphrase</font></div><div><font size="2"   >&nbsp; &nbsp;-S, --password-script=&lt;script&gt; Script to run to retrieve password</font></div><div><font size="2"   >&nbsp; &nbsp;-n, --plug=&lt;id&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Physical plug number on device or</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name of virtual machine</font></div><div><font size="2"   >&nbsp; &nbsp;-e, --exec=&lt;command&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Command to execute</font></div><div><font size="2"   >&nbsp; &nbsp;-d, --vmware_type=&lt;type&gt; &nbsp; &nbsp; &nbsp; Type of VMware to connect</font></div><div><font size="2"   >&nbsp; &nbsp;-x, --ssh &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Use ssh connection</font></div><div><font size="2"   >&nbsp; &nbsp;-k, --identity-file=&lt;filename&gt; Identity file (private key) for ssh&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;-s, --vmware-datacenter=&lt;dc&gt; &nbsp; VMWare datacenter filter</font></div><div><font size="2"   >&nbsp; &nbsp;-v, --verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Verbose mode</font></div><div><font size="2"   >&nbsp; &nbsp;-D, --debug-file=&lt;debugfile&gt; &nbsp; Debugging to output file</font></div><div><font size="2"   >&nbsp; &nbsp;-V, --version &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output version information and exit</font></div><div><font size="2"   >&nbsp; &nbsp;-h, --help &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Display this help and exit</font></div><div><font size="2"   >&nbsp; &nbsp;-C, --separator=&lt;char&gt; &nbsp; &nbsp; &nbsp; &nbsp; Separator for CSV created by 'list' operation</font></div><div><font size="2"   >&nbsp; &nbsp;--power-timeout &lt;seconds&gt; &nbsp; &nbsp; &nbsp;Test X seconds for status change after ON/OFF</font></div><div><font size="2"   >&nbsp; &nbsp;--shell-timeout &lt;seconds&gt; &nbsp; &nbsp; &nbsp;Wait X seconds for cmd prompt after issuing command</font></div><div><font size="2"   >&nbsp; &nbsp;--login-timeout &lt;seconds&gt; &nbsp; &nbsp; &nbsp;Wait X seconds for cmd prompt after login</font></div><div><font size="2"   >&nbsp; &nbsp;--power-wait &lt;seconds&gt; &nbsp; &nbsp; &nbsp; &nbsp; Wait X seconds after issuing ON/OFF</font></div><div><font size="2"   >&nbsp; &nbsp;--delay &lt;seconds&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Wait X seconds before fencing is started</font></div><div><font size="2"   >&nbsp; &nbsp;--retry-on &lt;attempts&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Count of attempts to retry power on</font></div><div><font size="2"   >[root@digoal_02 soft_bak]# fence_vmware_helper --help</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Synopsis: /usr/sbin/fence_vmware_helper OPTIONS&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Command-specific options:</font></div><div><font size="2"   >&nbsp; &nbsp;--datacenter</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; The name of the datacenter</font></div><div><font size="2"   >&nbsp; &nbsp;--operation (default 'list')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; The operation to perform (on,off,list,status). Operations on/off/status require name of the virtual machine</font></div><div><font size="2"   >&nbsp; &nbsp;--vmname</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; The name of the virtual machine</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Common VI options:&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;--config (variable VI_CONFIG)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Location of the VI Perl configuration file</font></div><div><font size="2"   >&nbsp; &nbsp;--credstore (variable VI_CREDSTORE)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Name of the credential store file defaults to &lt;HOME&gt;/.vmware/credstore/vicredentials.xml on Linux and &lt;APPDATA&gt;/VMware/credstore/vicredentials.xml on Windows</font></div><div><font size="2"   >&nbsp; &nbsp;--encoding (variable VI_ENCODING, default 'utf8')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Encoding: utf8, cp936 (Simplified Chinese), iso-8859-1 (German), shiftjis (Japanese)</font></div><div><font size="2"   >&nbsp; &nbsp;--help</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Display usage information for the script</font></div><div><font size="2"   >&nbsp; &nbsp;--passthroughauth (variable VI_PASSTHROUGHAUTH)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Attempt to use pass-through authentication</font></div><div><font size="2"   >&nbsp; &nbsp;--passthroughauthpackage (variable VI_PASSTHROUGHAUTHPACKAGE, default 'Negotiate')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Pass-through authentication negotiation package</font></div><div><font size="2"   >&nbsp; &nbsp;--password (variable VI_PASSWORD)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Password</font></div><div><font size="2"   >&nbsp; &nbsp;--portnumber (variable VI_PORTNUMBER)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Port used to connect to server</font></div><div><font size="2"   >&nbsp; &nbsp;--protocol (variable VI_PROTOCOL, default 'https')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Protocol used to connect to server</font></div><div><font size="2"   >&nbsp; &nbsp;--savesessionfile (variable VI_SAVESESSIONFILE)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; File to save session ID/cookie to utilize</font></div><div><font size="2"   >&nbsp; &nbsp;--server (variable VI_SERVER, default 'localhost')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; VI server to connect to. Required if url is not present</font></div><div><font size="2"   >&nbsp; &nbsp;--servicepath (variable VI_SERVICEPATH, default '/sdk/webService')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Service path used to connect to server</font></div><div><font size="2"   >&nbsp; &nbsp;--sessionfile (variable VI_SESSIONFILE)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; File containing session ID/cookie to utilize</font></div><div><font size="2"   >&nbsp; &nbsp;--url (variable VI_URL)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; VI SDK URL to connect to. Required if server is not present</font></div><div><font size="2"   >&nbsp; &nbsp;--username (variable VI_USERNAME)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Username</font></div><div><font size="2"   >&nbsp; &nbsp;--verbose (variable VI_VERBOSE)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Display additional debugging information</font></div><div><font size="2"   >&nbsp; &nbsp;--version</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Display version information for the script</font></div><p></p></pre></div></div><div>fence_vmware需要依赖vSphere提供的SDK.&nbsp;</div><div>如果你还没有安装SDK, 使用fence_vmware时会报错如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@digoal_01 vmware-vsphere-cli-distrib]# fence_vmware -a 10.10.10.155 -l OU\\digoal -p digoal_123321 -o list</font></div><div><font size="2"   >fence_vmware_helper returned Please install VI Perl API package to use this tool!</font></div><div><font size="2"   >Perl error: Can't locate VMware/VIRuntime.pm in @INC (@INC contains: /usr/local/lib64/perl5 /usr/local/share/perl5 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5 .) at (eval 1) line 1.</font></div><div><font size="2"   >BEGIN failed--compilation aborted at (eval 1) line 1.</font></div><div><font size="2"   >Please use '-h' for usage</font></div><p></p></pre></div><div><br></div><div><div style="line-height: 28px;"   >解决以上报错, 首先要根据环境中vSphere的版本, 下载对应的sdk.&nbsp;</div><div style="line-height: 28px;"   >例如5.5的for linux x86_64 sdk如下 :&nbsp;</div><div style="line-height: 28px;"   ><a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://my.vmware.com/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/5_5#drivers_tools"   >https://my.vmware.com/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/5_5#drivers_tools</a></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >vSphere SDK for Perl - 64-bit Linux Installer</font></div><div style="line-height: 28px;"   ><font size="2"   >File size: 26 MB</font></div><div style="line-height: 28px;"   ><font size="2"   >File type: gz</font></div><div style="line-height: 28px;"   ><font size="2"   >Download Now Download Manager Name: VMware-vSphere-Perl-SDK-5.5.0-2043780.x86_64.tar.gz&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >Release Date: 2014-09-09</font></div><div style="line-height: 28px;"   ><font size="2"   >Build Number: 2043780</font></div><div style="line-height: 28px;"   ><font size="2"   >vSphere SDK for Perl - 64-bit Linux Installer&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >Download an SDK for 64-bit Linux environments that allows to create Perl scripts to automate vSphere management.</font></div><div style="line-height: 28px;"   ><font size="2"   >MD5SUM: acf30529e00783f4a06ff5ce3ec9545c&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >SHA1SUM: 909a64950f4310ed36ec435f8922e110f8abd097</font></div><p></p></pre></div></div></div><div>执行vmware-install.pl安装SDK :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@digoal_01 soft_bak]# tar -zxvf VMware-vSphere-Perl-SDK-5.5.0-2043780.x86_64.tar.gz</font></div><div><font size="2"   >[root@digoal_01 soft_bak]# cd vmware-vsphere-cli-distrib/</font></div><div><font size="2"   >[root@digoal_01 vmware-vsphere-cli-distrib]# ll</font></div><div><font size="2"   >total 280</font></div><div><font size="2"   >drwxr-xr-x 10 root root &nbsp; 4096 Aug 13 23:54 apps</font></div><div><font size="2"   >drwxr-xr-x &nbsp;2 root root &nbsp; 4096 Aug 13 23:54 bin</font></div><div><font size="2"   >drwxr-xr-x &nbsp;3 root root &nbsp; 4096 Aug 13 23:54 doc</font></div><div><font size="2"   >drwxr-xr-x &nbsp;2 root root &nbsp; 4096 Aug 13 23:54 etc</font></div><div><font size="2"   >-r--r--r-- &nbsp;1 root root 253803 Aug 13 23:54 FILES</font></div><div><font size="2"   >drwxr-xr-x 29 root root &nbsp; 4096 Aug 13 23:54 lib</font></div><div><font size="2"   >-r--r--r-- &nbsp;1 root root &nbsp; 3340 Aug 13 23:54 Makefile.PL</font></div><div><font size="2"   >drwxr-xr-x &nbsp;2 root root &nbsp; 4096 Aug 13 23:54 man</font></div><div><font size="2"   >drwxr-xr-x &nbsp;2 root root &nbsp; 4096 Aug 13 23:54 resources</font></div><div><font size="2"   >lrwxrwxrwx &nbsp;1 root root &nbsp; &nbsp; 35 Sep 25 09:41 vmware-install.pl -&gt; bin/vmware-uninstall-vSphere-CLI.pl</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@digoal_01 vmware-vsphere-cli-distrib]# ./vmware-install.pl&nbsp;</font></div><div><font size="2"   >Creating a new vSphere CLI installer database using the tar4 format.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Installing vSphere CLI 5.5.0 build-2043780 for Linux.</font></div><div><font size="2"   >..............................</font></div><div><font size="2"   >Do you accept? (yes/no) yes &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Thank you.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >This vSphere CLI installer includes precompiled Perl modules for RHEL.</font></div><div><font size="2"   >Answering yes will install the precompiled modules, and answering no will&nbsp;</font></div><div><font size="2"   >install from CPAN.</font></div><div><font size="2"   >Do you want to install precompiled Perl modules for RHEL?</font></div><div><font size="2"   >[yes]&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >In which directory do you want to install the executable files?&nbsp;</font></div><div><font size="2"   >[/usr/bin] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Please wait while copying vSphere CLI files...</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The installation of vSphere CLI 5.5.0 build-2043780 for Linux completed&nbsp;</font></div><div><font size="2"   >successfully. You can decide to remove this software from your system at any&nbsp;</font></div><div><font size="2"   >time by invoking the following command:&nbsp;</font></div><div><font size="2"   >"/usr/bin/vmware-uninstall-vSphere-CLI.pl".</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >This installer has successfully installed both vSphere CLI and the vSphere SDK&nbsp;</font></div><div><font size="2"   >for Perl.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The following Perl modules were found on the system but may be too old to work&nbsp;</font></div><div><font size="2"   >with vSphere CLI:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >version 0.78 or newer&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Enjoy,</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >--the VMware team</font></div><p></p></pre></div><div>现在就可以使用fence_vmware来列出账号授权的虚拟机.</div><div>10.10.10.155 是vCenter的地址</div><div>OU\\digoal 是账号(这里假设vCenter的认证是通过AD域来管理的, 需要加前缀, 两个反斜线来转义)&nbsp;</div><div>digoal_123321 是域账号OU\digoal的密码</div><div>-o list 列出用户授权的虚拟机(这里列出的虚拟机名称要被fence_vmware用于开关机)</div><div>-v 输出明细数据</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@digoal_01 ~]# fence_vmware -a 10.10.10.155 -l OU\\digoal -p digoal_123321 -o list -v</font></div><div><font size="2"   >fence_vmware_helper --server 'digoal_01' --username 'OU\digoal' --password 'digoal_123321' --operation list</font></div><div><font size="2"   >digoal_02:[FOR-VC] digoal_02/digoal_02.vmx:poweredOn:connected</font></div><div><font size="2"   >digoal_01:[FOR-VC] digoal_01/digoal_01.vmx:poweredOn:connected</font></div><div><font size="2"   >digoal_02,</font></div><div><font size="2"   >digoal_01,</font></div><p></p></pre></div><div>使用-n 指定虚拟机, 查看状态.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@digoal_01 vmware-vsphere-cli-distrib]# fence_vmware -a 10.10.10.155 -l OU\\digoal -p digoal_123321 -n digoal_01 -o status &nbsp;-v</font></div><div><font size="2"   >fence_vmware_helper --server 'digoal_01' --username 'OU\digoal' --password 'digoal_123321' --operation status --vmname 'digoal_01'</font></div><div><font size="2"   >digoal_01:[FOR-VC] digoal_01/digoal_01.vmx:poweredOn:connected</font></div><div><font size="2"   >Status: ON</font></div><p></p></pre></div><div><br></div><div>修改/etc/cluster/cluster.conf, 注意递增config_version版本.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@digoal_02 ~]# cat /etc/cluster/cluster.conf&nbsp;</font></div><div><font size="2"   >&lt;cluster config_version="31" name="digoal001"&gt;</font></div><div><font size="2"   >&nbsp; &lt;fence_daemon post_fail_delay="6" post_join_delay="30"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="10.10.10.154" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="abc"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" port="digoal_01" name="fence_vc"/&gt; &nbsp; # port 是这个主机对应的vCenter里的虚拟机名</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" port="digoal_01" name="fence_vc"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="10.10.10.221" nodeid="2"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="abc"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="off" port="digoal_02" name="fence_vc"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="on" port="digoal_02" name="fence_vc"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div><div><font size="2"   >&nbsp; &lt;/clusternodes&gt;</font></div><div><font size="2"   >&nbsp; &lt;cman expected_votes="1" transport="udpu" two_node="1"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_vmware" ipaddr="10.10.10.155" login="OU\digoal" name="fence_vc" passwd="digoal_123321"/&gt;</font></div><div><font size="2"   >&nbsp; &lt;/fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &lt;rm&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;failoverdomain name="digoal001_fd" nofailback="1" ordered="1" restricted="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;failoverdomainnode name="10.10.10.154" priority="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;failoverdomainnode name="10.10.10.221" priority="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/failoverdomain&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/failoverdomains&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;resources&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;ip address="10.10.10.223" monitor_link="1"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;script file="/usr/local/bin/pgctl.sh" name="pgctl"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;action name="status" interval="10"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/script&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/resources&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;service autostart="0" domain="digoal001_fd" name="digoal001_pg"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;ip ref="10.10.10.223"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;script ref="pgctl"/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/service&gt;</font></div><div><font size="2"   >&nbsp; &lt;/rm&gt;</font></div><div><font size="2"   >&nbsp; &lt;logging/&gt;</font></div><div><font size="2"   >&lt;/cluster&gt;</font></div><p></p></pre></div></div><div>重启集群 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >clusvcadm -d service_name</font></div><div><font size="2"   >umount gfs_dir</font></div><div><font size="2"   >service clvmd stop</font></div><div><font size="2"   >service rgmanager stop</font></div><div><font size="2"   >service cman stop</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >service cman start</font></div><div><font size="2"   >service rgmanager start</font></div><div><font size="2"   >service clvmd start</font></div><div><font size="2"   >mount gfs_dir</font></div><div><font size="2"   >clusvcadm -e service_name</font></div><p></p></pre></div><div><br></div><div>[参考]</div>1.&nbsp;<wbr><a target="_blank" rel="nofollow" href="http://www.it165.net/os/html/201307/5698.html"   >http://www.it165.net/os/html/201307/5698.html</a><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://developercenter.vmware.com/web/sdk/55/vsphere-perl"   >http://developercenter.vmware.com/web/sdk/55/vsphere-perl</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://www.vmware.com/support/developer/viperltoolkit/"   >https://www.vmware.com/support/developer/viperltoolkit/</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://my.vmware.com/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere"   >https://my.vmware.com/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://my.vmware.com/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/5_5#drivers_tools"   >https://my.vmware.com/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/5_5#drivers_tools</a></div><div>6.&nbsp;</div><div># man fence_vmware</div><div># man fence_vmware_helper</div><div># man fence_vmware_soap</div><div>7.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020148169845549/"   >http://blog.163.com/digoal@126/blog/static/16387704020148169845549/</a></div><div>8.&nbsp;/usr/share/cluster/cluster.rng</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!-- fence_vmware --&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;group rha:name="fence_vmware" rha:description="Fence agent for VMWare"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="option"/&gt; &lt;!-- deprecated; for compatibility. &nbsp;use "action" --&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="action" rha:description="Fencing Action" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="ipaddr" rha:description="IP Address or Hostname" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="login" rha:description="Login Name" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="passwd" rha:description="Login password or passphrase" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="passwd_script" rha:description="Script to retrieve password" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="port" rha:description="Physical plug number or name of virtual machine" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="exec" rha:description="Command to execute" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="vmware_type" rha:description="Type of VMware to connect" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="secure" rha:description="SSH connection" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="identity_file" rha:description="Identity file for ssh" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="vmware_datacenter" rha:description="Show only machines in specified datacenter" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="verbose" rha:description="Verbose mode" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="debug" rha:description="Write debug information to given file" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="version" rha:description="Display version information and exit" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="help" rha:description="Display help and exit" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="separator" rha:description="Separator for CSV created by operation list" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="power_timeout" rha:description="Test X seconds for status change after ON/OFF" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="shell_timeout" rha:description="Wait X seconds for cmd prompt after issuing command" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="login_timeout" rha:description="Wait X seconds for cmd prompt after login" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="power_wait" rha:description="Wait X seconds after issuing ON/OFF" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="delay" rha:description="Wait X seconds before fencing is started" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;attribute name="retry_on" rha:description="Count of attempts to retry power on" /&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/optional&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/group&gt;</font></div></div><p></p></pre></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="fence vmware use vmware vsphere sdk for perl - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>