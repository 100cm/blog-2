<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">zabbix agentd configure</h2>
	<h5 id="">2014-09-01 15:25:42&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201481103924780/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>在被监控的主机, 需要有一个zabbix的agent来负责将监控数据发送给proxy或直接发送给server.</div><div>同时agentd也支持监听, proxy和server可以主动要求agent调用监控命令. 但是在安全性要求较高的环境, 一般不开启agent的被动模式, 只使用主动模式, 即agent主动往外发监控数据, 但是不接受任何远程调用.&nbsp;</div><div>两种模式的运行机制 :&nbsp;</div><div><div>In a passive check the agent responds to a data request. Zabbix server (or proxy) asks for data, for example, CPU load, and Zabbix agent sends back the result.</div><div><br></div><div>Active checks require more complex processing. The agent must first retrieve a list of items from Zabbix server for independent processing. Then it will periodically send new values to the server.</div></div><div>详见</div><div><a target="_blank" rel="nofollow" href="https://www.zabbix.com/documentation/2.2/manual/appendix/items/activepassive"   >https://www.zabbix.com/documentation/2.2/manual/appendix/items/activepassive</a></div><div><br></div><div>server和proxy的配置参考 :&nbsp;</div><wbr><div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >1.&nbsp;<a style="line-height: 28px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014731111811804/"   >http://blog.163.com/digoal@126/blog/static/1638770402014731111811804/</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >2.&nbsp;<a style="line-height: 28px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014811040957/"   >http://blog.163.com/digoal@126/blog/static/1638770402014811040957/</a></div><div style="line-height: 28px;"   >3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020148110173574/"   >http://blog.163.com/digoal@126/blog/static/16387704020148110173574/</a></div></div><div style="line-height: 28px;"   >本文假设我们要将监控数据发送给proxy.&nbsp;</div><div style="line-height: 28px;"   >配置agentd.conf如下, 连接到proxy.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi /opt/zabbix/etc/zabbix_agentd.conf</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >PidFile=/tmp/zabbix_agentd.pid</font></div><div><font size="2"   >LogFile=/tmp/zabbix_agentd.log</font></div><div><font size="2"   >LogFileSize=10</font></div><div><font size="2"   >EnableRemoteCommands=0</font></div><div><font size="2"   >StartAgents=0</font></div><div><font size="2"   >ServerActive=172.16.3.150:10052</font></div><div><font size="2"   >Hostname=agent150</font></div><div><font size="2"   >RefreshActiveChecks=120</font></div></div><p></p></pre></div><div><br></div><div>启动agentd</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># useradd zabbix_agent</font></div><div><font size="2"   >[root@150 etc]# su - zabbix_agent -c "zabbix_agentd -c /opt/zabbix/etc/zabbix_agentd.conf"</font></div><p></p></pre></div><div><br></div><div>在zabbix WEB 添加主机, 注意主机名和agentd.conf Hostname配置一致.</div><div><div><img title="zabbix agentd configure - 德哥@Digoal - PostgreSQL research"   alt="zabbix agentd configure - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/Nr3J1R9vlaap_jE0sL3URg==/6608755376236547481.png"   ></div></div><div><br></div><div>添加监控模板.</div><div><div><img title="zabbix agentd configure - 德哥@Digoal - PostgreSQL research"   alt="zabbix agentd configure - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/7xA0-Qq2t6MnwYo-AVWvDg==/6608864227887694463.png"   ></div></div><div><br></div><div>重启proxy, 因为proxy是从server获取配置的, 所以必须重启获取刚才添加的主机. 否则agent会报找不到主机的错误.</div><div>如下 :&nbsp;</div><div><div>&nbsp;33315:20140901:155115.763 no active checks on server [172.16.3.150:10052]: host [agent221] not found</div><div>&nbsp;33315:20140901:155315.787 no active checks on server [172.16.3.150:10052]: host [agent221] not found</div></div><div><br></div><div>[被动相关配置]</div><div>zabbix_agentd.conf</div><div>需开启监听, 允许远程调用, Server配置一个列表, 表示允许被哪些远程的服务端IP连接本agent.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >PidFile=/tmp/zabbix_agentd.pid</font></div><div><font size="2"   >LogFile=/tmp/zabbix_agentd.log</font></div><div><font size="2"   >LogFileSize=10</font></div><div><font size="2"   >EnableRemoteCommands=1</font></div><div><font size="2"   >LogRemoteCommands=1</font></div><div><font size="2"   >Server=172.16.3.150</font></div><div><font size="2"   >ListenPort=10050</font></div><div><font size="2"   >ListenIP=0.0.0.0</font></div><div><font size="2"   >StartAgents=8</font></div><div><font size="2"   >ServerActive=172.16.3.150:10052</font></div><div><font size="2"   >Hostname=agent150</font></div><div><font size="2"   >RefreshActiveChecks=120</font></div><p></p></pre></div><div><br></div>[参考]<div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >1.&nbsp;<a style="line-height: 28px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014731111811804/"   >http://blog.163.com/digoal@126/blog/static/1638770402014731111811804/</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >2.&nbsp;<a style="line-height: 28px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014811040957/"   >http://blog.163.com/digoal@126/blog/static/1638770402014811040957/</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020148110173574/"   >http://blog.163.com/digoal@126/blog/static/16387704020148110173574/</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://www.zabbix.com/documentation/2.2/manual/appendix/config/zabbix_agentd"   >https://www.zabbix.com/documentation/2.2/manual/appendix/config/zabbix_agentd</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://www.zabbix.com/documentation/2.2/manual/concepts/agent"   >https://www.zabbix.com/documentation/2.2/manual/concepts/agent</a></div><div>6.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://www.zabbix.com/documentation/2.2/manual/config/hosts/host"   >https://www.zabbix.com/documentation/2.2/manual/config/hosts/host</a></div><div><br></div><div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="zabbix agentd configure - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a><br></div></div></div>
	</div>
</div>
</body>
</html>