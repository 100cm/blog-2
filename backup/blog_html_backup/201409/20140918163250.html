<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">ganglia metric introduce</h2>
	<h5 id="">2014-09-18 16:32:50&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201481835916946/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>本文主要介绍一下ganglia metric的概念, 为以后更好的了解metric的扩展.</div><div>metric即监控项, gmond自带的核心模块中, 包含了7类监控项目, 共计40几个监控项.</div><div>使用gmond -m可以查看所有的监控项.</div><div><br></div><div>我们先来了解一下metric的数据结构 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >ganglia-3.6.0/lib/gm_protocol.h</font></div><div><font size="2"   >struct Ganglia_25metric {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int key;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; char *name;   // metric name, 一台主机的metric name必须唯一</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int tmax;    //  指<span style="line-height: 21px;"   >发生metric对应组内的所有metric到send channel的时间间隔, 对应collection_group中time_threshold配置.</span></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Ganglia_value_types type;   // 值的类型, 如int8 , float ...</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; char *units;  // 单位, 只用作显示, 不用做计算</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; char *slope;   //  值的变化趋势, 如zero(不变), positive(只增), negative(只减), both(即增即减)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; char *fmt;    </font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int msg_size;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; char *desc;   // 描述</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int *metadata;</font></div><div><font size="2"   >};</font></div><p></p></pre></div><div><br></div><div>然后dump一个XML来看看 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># netstat -anp|grep gmond</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 0.0.0.0:8649 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;4271/gmond &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >udp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 172.16.3.221:63894 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;239.2.11.71:8649 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ESTABLISHED 4271/gmond &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >udp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 239.2.11.71:8649 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4271/gmond</font></div><p></p></pre></div><div>将gmond的数据dump出来.</div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 cpu]# telnet 127.0.0.1 8649</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >截取一部分metric的信息如下</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&lt;GANGLIA_XML VERSION="3.6.0" SOURCE="gmond"&gt;<br>&lt;CLUSTER NAME="test" LOCALTIME="1411027577" OWNER="digoal" LATLONG="111 122" URL="http://dba.sky-mobi.com"&gt;<br><br></font></div><div><font size="2"   >&lt;HOST NAME="db-172-16-3-221.localdomain" IP="172.16.3.221" TAGS="" REPORTED="1411027564" TN="12" TMAX="20" DMAX="86400" LOCATION="1,2,3" GMOND_STARTED="1411026704"&gt;</font></div><div><font size="2"   >........</font></div><div><font size="2"   >&lt;METRIC NAME="load_one" VAL="0.00" TYPE="float" UNITS=" " TN="62" TMAX="70" DMAX="0" SLOPE="both"&gt;</font></div><div><font size="2"   >&lt;EXTRA_DATA&gt;</font></div><div><font size="2"   >&lt;EXTRA_ELEMENT NAME="GROUP" VAL="load"/&gt;</font></div><div><font size="2"   >&lt;EXTRA_ELEMENT NAME="DESC" VAL="One minute load average"/&gt;</font></div><div><font size="2"   >&lt;EXTRA_ELEMENT NAME="TITLE" VAL="One Minute Load Average"/&gt;</font></div><div><font size="2"   >&lt;/EXTRA_DATA&gt;</font></div><div><font size="2"   >&lt;/METRIC&gt;</font></div><div><font size="2"   >......</font></div><div><font size="2"   >&lt;/HOST&gt;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&lt;HOST NAME="abc" IP="172.16.3.150" TAGS="" REPORTED="1411026788" TN="788" TMAX="20" DMAX="86400" LOCATION="unspecified" GMOND_STARTED="0"&gt;<br>&lt;METRIC NAME="load_five" VAL="1.0" TYPE="float" UNITS="" TN="810" TMAX="60" DMAX="0" SLOPE="both"&gt;<br>&lt;EXTRA_DATA&gt;<br>&lt;EXTRA_ELEMENT NAME="TITLE" VAL="load_five"/&gt;<br>&lt;EXTRA_ELEMENT NAME="DESC" VAL="load_five"/&gt;<br>&lt;EXTRA_ELEMENT NAME="GROUP" VAL="cpu"/&gt;<br>&lt;EXTRA_ELEMENT NAME="CLUSTER" VAL="test"/&gt;<br>&lt;EXTRA_ELEMENT NAME="SPOOF_HOST" VAL="172.16.3.150:abc"/&gt;<br>&lt;/EXTRA_DATA&gt;<br>&lt;/METRIC&gt;</font></div><div><font size="2"   >......</font></div><div><font size="2"   >&lt;/HOST&gt;</font></div><p></p></pre></div><div>host相关XML的代码</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; len = apr_snprintf(hostxml, 1024,&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"&lt;HOST NAME=\"%s\" IP=\"%s\" TAGS=\"%s\" REPORTED=\"%d\" TN=\"%d\" TMAX=\"%d\" DMAX=\"%d\" LOCATION=\"%s\" GMOND_STARTED=\"%d\"&gt;\n",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hostinfo-&gt;hostname,&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hostinfo-&gt;ip,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tags ? tags : "",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(int)(hostinfo-&gt;last_heard_from / APR_USEC_PER_SEC),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tn,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;host_tmax,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;host_dmax,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hostinfo-&gt;location? hostinfo-&gt;location: "unspecified",&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hostinfo-&gt;gmond_started);</font></div><p></p></pre></div><div>含义参考</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014812104313876/"   >http://blog.163.com/digoal@126/blog/static/1638770402014812104313876/</a></div><div><br></div><div>metric相关XML的代码</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; len = apr_snprintf(metricxml, 1024,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;METRIC NAME=\"%s\" VAL=\"%s\" TYPE=\"%s\" UNITS=\"%s\" TN=\"%d\" TMAX=\"%d\" DMAX=\"%d\" SLOPE=\"%s\"&gt;\n",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; metricName,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gmetric_value_to_str(&amp;(val-&gt;message_u.v_message)),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;message_u.f_message.Ganglia_metadata_msg_u.gfull.metric.type,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;message_u.f_message.Ganglia_metadata_msg_u.gfull.metric.units,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (int)((now - val-&gt;last_heard_from) / APR_USEC_PER_SEC),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;message_u.f_message.Ganglia_metadata_msg_u.gfull.metric.tmax,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data-&gt;message_u.f_message.Ganglia_metadata_msg_u.gfull.metric.dmax,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slope_to_cstr(data-&gt;message_u.f_message.Ganglia_metadata_msg_u.gfull.metric.slope));</font></div><p></p></pre></div><div>含义参考</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014812104313876/"   >http://blog.163.com/digoal@126/blog/static/1638770402014812104313876/</a></div><div><br></div><div>接下来, 我们可以看看gmond的核心模块中的其中一个load模块是如何采样的.</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@db-172-16-3-221 cpu]# cat mod_load.c</font></div><div style="line-height: 28px;"   ><font size="2"   >#include &lt;gm_metric.h&gt;</font></div><div style="line-height: 28px;"   ><font size="2"   >#include &lt;libmetrics.h&gt;</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >mmodule load_module;</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >static int load_metric_init ( apr_pool_t *p )</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; int i;</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; libmetrics_init();</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; for (i = 0; load_module.metrics_info[i].name != NULL; i++) {</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* Initialize the metadata storage for each of the metrics and then</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp;store one or more key/value pairs. &nbsp;The define MGROUPS defines</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp;the key for the grouping attribute. */</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; MMETRIC_INIT_METADATA(&amp;(load_module.metrics_info[i]),p);</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; MMETRIC_ADD_METADATA(&amp;(load_module.metrics_info[i]),MGROUP,"load");</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; }</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; return 0;</font></div><div style="line-height: 28px;"   ><font size="2"   >}</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >static void load_metric_cleanup ( void )</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >}</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >static g_val_t load_metric_handler ( int metric_index )</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; g_val_t val;</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; /* The metric_index corresponds to the order in which</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;the metrics appear in the metric_info array</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; */</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; switch (metric_index) {</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; case 0:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return load_one_func();</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; case 1:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return load_five_func();</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; case 2:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return load_fifteen_func();</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; }</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; /* default case */</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; val.f = 0;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; return val;</font></div><div style="line-height: 28px;"   ><font size="2"   >}</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >static Ganglia_25metric load_metric_info[] =&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; {0, "load_one", &nbsp; &nbsp; &nbsp;70, GANGLIA_VALUE_FLOAT, " ", "both", "%.2f", UDP_HEADER_SIZE+8, "One minute load average"},</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; {0, "load_five", &nbsp; &nbsp;325, GANGLIA_VALUE_FLOAT, " ", "both", "%.2f", UDP_HEADER_SIZE+8, "Five minute load average"},</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; {0, "load_fifteen", 950, GANGLIA_VALUE_FLOAT, " ", "both", "%.2f", UDP_HEADER_SIZE+8, "Fifteen minute load average"},</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; {0, NULL}</font></div><div style="line-height: 28px;"   ><font size="2"   >};</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >mmodule load_module =</font></div><div style="line-height: 28px;"   ><font size="2"   >{</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; STD_MMODULE_STUFF,</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; load_metric_init,</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; load_metric_cleanup,</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; load_metric_info,</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; load_metric_handler,</font></div><div style="line-height: 28px;"   ><font size="2"   >};</font></div><p></p></pre></div></div><div>除了metric name, 其实还看到了metric group 的信息. group方便gweb归类.</div><div>例如核心模块中的group load包含了3个metric. (load_one, load_five, load_fifteen)</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@db-172-16-3-221 cpu]# gmond -m|grep load</font></div><div style="line-height: 28px;"   ><font size="2"   >load_fifteen &nbsp; &nbsp;Fifteen minute load average (module load_module)</font></div><div style="line-height: 28px;"   ><font size="2"   >load_one &nbsp; &nbsp; &nbsp; &nbsp;One minute load average (module load_module)</font></div><div style="line-height: 28px;"   ><font size="2"   >load_five &nbsp; &nbsp; &nbsp; Five minute load average (module load_module)</font></div><p></p></pre></div></div><div><br></div><div>最后, 通过gmetric来了解一下metric.</div><div>gmetric是一个可以手工向udp send channel发送metric信息的工具. 它需要读gmond.conf配置文件, 从中得到udp send channel以及其他信息, 然后从命令行输入metric相关的值, 发送出去.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># man gmetric</font></div><div><div><font size="2"   >GMETRIC(1) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; User Commands &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;GMETRIC(1)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >NAME</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;gmetric - manual page for Ganglia Custom Metric Utility</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SYNOPSIS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;gmetric [OPTIONS]...</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >DESCRIPTION</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The &nbsp;Ganglia &nbsp;Metric Client (gmetric) announces a metric on the list of defined send channels defined in a con-</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;figuration file</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-h, --help</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Print help and exit</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-V, --version</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Print version and exit</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-c, --conf=STRING   //配置文件</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The configuration file to use for finding send channels (default=‘/etc/ganglia/gmond.conf’)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-n, --name=STRING   // metric name</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Name of the metric</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-v, --value=STRING   // metric 值</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Value of the metric</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-t, --type=STRING   // metric 值类型</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Either string|int8|uint8|int16|uint16|int32|uint32|float|double</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-u, --units=STRING   // 单位</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Unit of measure for the value e.g. Kilobytes, Celcius (default=‘’)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-s, --slope=STRING   // 值属性</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Either zero|positive|negative|both &nbsp;(default=‘both’)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-x, --tmax=INT    // 类似gmond里配置的 collection group 消息发送间隔</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The maximum time in seconds between gmetric calls (default=‘60’)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-d, --dmax=INT    // metric 超时删除时间, 目前貌似没有用到这个.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The lifetime in seconds of this metric &nbsp;(default=‘0’)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-g, --group=STRING    //  metric属于哪个组, 可以参考核心模块, 例如load_five属于load组.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Group of the metric</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-D, --desc=STRING  // 描述</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Description of the metric</font></div><div><font size="2"   > </font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-T, --title=STRING  // 在gweb中显示为 title</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Title of the metric</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-S, --spoof=STRING    // 指定metric的主机名, IP. (例如在A主机发送消息, 默认是会将metric归到A主机的, 但是如果你想从A主机发出B主机的metric, 那就需要spoof)  (因为metric是以主机名为归类分开存储的)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IP address and name of host/device (colon separated) we are spoofing &nbsp;(default=‘’)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-H, --heartbeat   // 心跳消息</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spoof a heartbeat message (use with spoof option)</font></div></div><p></p></pre></div><div>命令行帮助 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 cpu]# gmetric -h</font></div><div><font size="2"   >gmetric 3.6.0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The Ganglia Metric Client (gmetric) announces a metric</font></div><div><font size="2"   >on the list of defined send channels defined in a configuration file</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Usage: gmetric [OPTIONS]...</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; -h, --help &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Print help and exit</font></div><div><font size="2"   >&nbsp; -V, --version &nbsp; &nbsp; &nbsp; &nbsp; Print version and exit</font></div><div><font size="2"   >&nbsp; -c, --conf=STRING &nbsp; &nbsp; The configuration file to use for finding send channels&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(default=`/opt/ganglia-core-3.6.0/etc/gmond.conf')</font></div><div><font size="2"   >&nbsp; -n, --name=STRING &nbsp; &nbsp; Name of the metric</font></div><div><font size="2"   >&nbsp; -v, --value=STRING &nbsp; &nbsp;Value of the metric</font></div><div><font size="2"   >&nbsp; -t, --type=STRING &nbsp; &nbsp; Either&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string|int8|uint8|int16|uint16|int32|uint32|float|double</font></div><div><font size="2"   >&nbsp; -u, --units=STRING &nbsp; &nbsp;Unit of measure for the value e.g. Kilobytes, Celcius &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (default=`')</font></div><div><font size="2"   >&nbsp; -s, --slope=STRING &nbsp; &nbsp;Either zero|positive|negative|both &nbsp;(default=`both')</font></div><div><font size="2"   >&nbsp; -x, --tmax=INT &nbsp; &nbsp; &nbsp; &nbsp;The maximum time in seconds between gmetric calls &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (default=`60')</font></div><div><font size="2"   >&nbsp; -d, --dmax=INT &nbsp; &nbsp; &nbsp; &nbsp;The lifetime in seconds of this metric &nbsp;(default=`0')</font></div><div><font size="2"   >&nbsp; -g, --group=STRING &nbsp; &nbsp;Group(s) of the metric (comma-separated)</font></div><div><font size="2"   >&nbsp; -C, --cluster=STRING &nbsp;Cluster of the metric</font></div><div><font size="2"   >&nbsp; -D, --desc=STRING &nbsp; &nbsp; Description of the metric</font></div><div><font size="2"   >&nbsp; -T, --title=STRING &nbsp; &nbsp;Title of the metric</font></div><div><font size="2"   >&nbsp; -S, --spoof=STRING &nbsp; &nbsp;IP address and name of host/device (colon separated) we&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; are spoofing &nbsp;(default=`')</font></div><div><font size="2"   >&nbsp; -H, --heartbeat &nbsp; &nbsp; &nbsp; spoof a heartbeat message (use with spoof option)</font></div><p></p></pre></div><div>分组在gweb中应用 :&nbsp;</div><div><div><img title="ganglia metric introduce - 德哥@Digoal - PostgreSQL research"   alt="ganglia metric introduce - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/WpPs7yjEpUYSqGGtOT2Bxw==/6608869725445919587.png"   ></div></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014810227936/"   >http://blog.163.com/digoal@126/blog/static/1638770402014810227936/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014812104313876/"   >http://blog.163.com/digoal@126/blog/static/1638770402014812104313876/</a></div><div>3.&nbsp;ganglia-3.6.0/gmond/modules/cpu/*</div><div>4. man gmetric</div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="ganglia metric introduce - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>