<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">gmetad configure</h2>
	<h5 id="">2014-09-11 10:52:09&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014810346993/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>gmetad的用途是从gmond接收metric统计信息, 并将统计信息存入rrdtools数据文件.</div><div>或者将接收到的metric forward给外部系统, 如Graphite.</div><div>同时gmetad还支持在gmetad之间传输XML dump数据, 组成一个大的监控系统.</div><div>gmetad还提供interactivei请求, 例如gweb使用interactive向gmetad请求不能再rrd文件中描述的信息.</div><div>基本的架构图如下, gmetad从gmond获取metric信息, 一个cluster只需要从一个gmond主机获取即可(例如mute节点).</div><div>注意这里使用的是TCP连接, 而不是UDP,&nbsp;</div><div>TCP端口对应gmond.conf中的tcp_accept_channel.port.</div><div><div><img title="gmetad configure - 德哥@Digoal - PostgreSQL research"   alt="gmetad configure - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/N5BHqojuTmc7q6tolqX9Kw==/6619570172607040147.png"   ></div><div><br></div>HA架构, gmetad支持在一个data_source中配置一个集群中的多个gmond节点, 顺序请求, 第一个配置的主机返回成功即可.</div><div><div><img title="gmetad configure - 德哥@Digoal - PostgreSQL research"   alt="gmetad configure - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/R0fzGCvs3CcRKl6cJxn23A==/6608490393934301104.png"   ></div><div><br></div>异构架构, 当一个gmetad不能收集所有cluster的信息时, 可以使用另外的gmetad来汇聚多个gmetad的信息.</div><div>即gmetad和gmetad之间互联.</div><div>需要配置的有gridname, 表示gmetad属于哪个grid, 多个gmetad组成了一个grid. 注意gridname和cluster name要区分开来,</div><div>结构是这样的 :&nbsp;</div><div><span style="line-height: 28px;"   >grid下面是cluster(s),&nbsp;</span></div><div>cluster下面是host(s),&nbsp;</div><div><div><img title="gmetad configure - 德哥@Digoal - PostgreSQL research"   alt="gmetad configure - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/dm2gRAZepuNtKPT53qi5oQ==/6619545983351229414.png"   ></div><div><br></div>最后这张图表示使用rrdcached, 合并IO, 减少rrd文件的频繁IO请求.<br><div><img title="gmetad configure - 德哥@Digoal - PostgreSQL research"   alt="gmetad configure - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/TLXiLgAMN2soUD_0fhjnhA==/6608194625307514177.png"   ></div></div><div><br></div><div>默认的配置文件如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 etc]# cat gmetad.conf&nbsp;</font></div><div><font size="2"   ># This is an example of a Ganglia Meta Daemon configuration file</font></div><div><font size="2"   ># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;http://ganglia.sourceforge.net/</font></div><div><font size="2"   >#</font></div><div><font size="2"   >#</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># Setting the debug_level to 1 will keep daemon in the forground and</font></div><div><font size="2"   ># show only error messages. Setting this value higher than 1 will make&nbsp;</font></div><div><font size="2"   ># gmetad output debugging information and stay in the foreground.</font></div><div><font size="2"   ># default: 0</font></div><div><font size="2"   ># debug_level 10</font></div><div><font size="2"   >#</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># What to monitor. The most important section of this file.&nbsp;</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># The data_source tag specifies either a cluster or a grid to</font></div><div><font size="2"   ># monitor. If we detect the source is a cluster, we will maintain a complete</font></div><div><font size="2"   ># set of RRD databases for it, which can be used to create historical&nbsp;</font></div><div><font size="2"   ># graphs of the metrics. If the source is a grid (it comes from another gmetad),</font></div><div><font size="2"   ># we will only maintain summary RRDs for it.</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># Format:&nbsp;</font></div><div><font size="2"   ># data_source "my cluster" [polling interval] address1:port addreses2:port ...</font></div><div><font size="2"   >#&nbsp;</font></div><div><font size="2"   ># The keyword 'data_source' must immediately be followed by a unique</font></div><div><font size="2"   ># string which identifies the source, then an optional polling interval in&nbsp;</font></div><div><font size="2"   ># seconds. The source will be polled at this interval on average.&nbsp;</font></div><div><font size="2"   ># If the polling interval is omitted, 15sec is asssumed.&nbsp;</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># If you choose to set the polling interval to something other than the default,</font></div><div><font size="2"   ># note that the web frontend determines a host as down if its TN value is less</font></div><div><font size="2"   ># than 4 * TMAX (20sec by default). &nbsp;Therefore, if you set the polling interval</font></div><div><font size="2"   ># to something around or greater than 80sec, this will cause the frontend to</font></div><div><font size="2"   ># incorrectly display hosts as down even though they are not.</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># A list of machines which service the data source follows, in the&nbsp;</font></div><div><font size="2"   ># format ip:port, or name:port. If a port is not specified then 8649</font></div><div><font size="2"   ># (the default gmond port) is assumed.</font></div><div><font size="2"   ># default: There is no default value</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># data_source "my cluster" 10 localhost &nbsp;my.machine.edu:8649 &nbsp;1.2.3.5:8655</font></div><div><font size="2"   ># data_source "my grid" 50 1.3.4.7:8655 grid.org:8651 grid-backup.org:8651</font></div><div><font size="2"   ># data_source "another source" 1.3.4.7:8655 &nbsp;1.3.4.8</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >data_source "my cluster" localhost</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >rrd归档配置 , 含义参考man rrdcreate</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># Round-Robin Archives</font></div><div><font size="2"   ># You can specify custom Round-Robin archives here (defaults are listed below)</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># Old Default RRA: Keep 1 hour of metrics at 15 second resolution. 1 day at 6 minute</font></div><div><font size="2"   ># RRAs "RRA:AVERAGE:0.5:1:244" "RRA:AVERAGE:0.5:24:244" "RRA:AVERAGE:0.5:168:244" "RRA:AVERAGE:0.5:672:244" \</font></div><div><font size="2"   ># &nbsp; &nbsp; &nbsp;"RRA:AVERAGE:0.5:5760:374"</font></div><div><font size="2"   ># New Default RRA</font></div><div><font size="2"   ># Keep 5856 data points at 15 second resolution assuming 15 second (default) polling. That's 1 day</font></div><div><font size="2"   ># Two weeks of data points at 1 minute resolution (average)</font></div><div><font size="2"   >#RRAs "RRA:AVERAGE:0.5:1:5856" "RRA:AVERAGE:0.5:4:20160" "RRA:AVERAGE:0.5:40:52704"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >当前节点的grid相关配置,&nbsp;</font></div><div><font size="2"   >如果scalable配置为on , 则表示从下游的gmetad收集过来的信息会进行汇聚.</font></div><div><span style="line-height: 28px;"   ><font size="2"   >如果scalable配置为off , 则表示从下游的gmetad收集过来的信息不进行汇聚(2.5.0的风格).</font></span></div><div><font size="2"   >#</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># Scalability mode. If on, we summarize over downstream grids, and respect</font></div><div><font size="2"   ># authority tags. If off, we take on 2.5.0-era behavior: we do not wrap our output</font></div><div><font size="2"   ># in &lt;GRID&gt;&lt;/GRID&gt; tags, we ignore all &lt;GRID&gt; tags we see, and always assume</font></div><div><font size="2"   ># we are the "authority" on data source feeds. This approach does not scale to</font></div><div><font size="2"   ># large groups of clusters, but is provided for backwards compatibility.</font></div><div><font size="2"   ># default: on</font></div><div><font size="2"   ># scalable off</font></div><div><font size="2"   ># gridname , 必须和cluster name区分开来.</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># The name of this Grid. All the data sources above will be wrapped in a GRID</font></div><div><font size="2"   ># tag with this name.</font></div><div><font size="2"   ># default: unspecified</font></div><div><font size="2"   ># gridname "MyGrid"</font></div><div><font size="2"   >#</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># The authority URL for this grid. Used by other gmetads to locate graphs</font></div><div><font size="2"   ># for our data sources. Generally points to a ganglia/</font></div><div><font size="2"   ># website on this machine.</font></div><div><font size="2"   ># default: "http://hostname/ganglia/",</font></div><div><font size="2"   ># &nbsp; where hostname is the name of this machine, as defined by gethostname().</font></div><div><font size="2"   ># authority "http://mycluster.org/newprefix/"</font></div><div><font size="2"   ># 配置受信任的上游主机, 不在这个列表的上游gmetad, 不能从这个gmetad获取信息.</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># List of machines this gmetad will share XML with. Localhost</font></div><div><font size="2"   ># is always trusted.&nbsp;</font></div><div><font size="2"   ># default: There is no default value</font></div><div><font size="2"   ># trusted_hosts 127.0.0.1 169.229.50.165 my.gmetad.org</font></div><div><font size="2"   >#&nbsp;</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># If you want any host which connects to the gmetad XML to receive</font></div><div><font size="2"   ># data, then set this value to "on"</font></div><div><font size="2"   ># default: off</font></div><div><font size="2"   ># all_trusted on</font></div><div><font size="2"   >#</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># If you don't want gmetad to setuid then set this to off</font></div><div><font size="2"   ># default: on</font></div><div><font size="2"   ># setuid off</font></div><div><font size="2"   >#</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># User gmetad will setuid to (defaults to "nobody")</font></div><div><font size="2"   ># default: "nobody"</font></div><div><font size="2"   ># setuid_username "nobody"</font></div><div><font size="2"   >#</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># Umask to apply to created rrd files and grid directory structure</font></div><div><font size="2"   ># default: 0 (files are public)</font></div><div><font size="2"   ># umask 022</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># &nbsp;上游节点的gmetad, 通过这个端口访问下游节点的gmetad, 获取xml dump</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># The port gmetad will answer requests for XML</font></div><div><font size="2"   ># default: 8651</font></div><div><font size="2"   ># xml_port 8651</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># 交互式访问的端口, 例如可以通过telnet获取xml信息.</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># The port gmetad will answer queries for XML. This facility allows</font></div><div><font size="2"   ># simple subtree and summation views of the XML tree.</font></div><div><font size="2"   ># default: 8652</font></div><div><font size="2"   ># interactive_port 8652</font></div><div><font size="2"   >#</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># The number of threads answering XML requests</font></div><div><font size="2"   ># default: 4</font></div><div><font size="2"   ># server_threads 10</font></div><div><font size="2"   >#</font></div><div><font size="2"   >rrd数据文件目录.</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># Where gmetad stores its round-robin databases</font></div><div><font size="2"   ># default: "/var/lib/ganglia/rrds"</font></div><div><font size="2"   ># rrd_rootdir "/some/other/place"</font></div><div><font size="2"   >#</font></div><div><font size="2"   >不汇聚数据的metric列表.</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># List of metric prefixes this gmetad will not summarize at cluster or grid level.</font></div><div><font size="2"   ># default: There is no default value</font></div><div><font size="2"   ># unsummarized_metrics diskstat CPU</font></div><div><font size="2"   >#</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># In earlier versions of gmetad, hostnames were handled in a case</font></div><div><font size="2"   ># sensitive manner</font></div><div><font size="2"   ># If your hostname directories have been renamed to lower case,</font></div><div><font size="2"   ># set this option to 0 to disable backward compatibility.</font></div><div><font size="2"   ># From version 3.2, backwards compatibility will be disabled by default.</font></div><div><font size="2"   ># default: 1 &nbsp; (for gmetad &lt; 3.2)</font></div><div><font size="2"   ># default: 0 &nbsp; (for gmetad &gt;= 3.2)</font></div><div><font size="2"   >case_sensitive_hostnames 0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >/* gmetad收集到的信息, forward给graphite.</font></div><div><font size="2"   >那么需要如下配置 */</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># It is now possible to export all the metrics collected by gmetad directly to</font></div><div><font size="2"   ># graphite by setting the following attributes.&nbsp;</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># The hostname or IP address of the Graphite server</font></div><div><font size="2"   ># default: unspecified</font></div><div><font size="2"   ># carbon_server "my.graphite.box"</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># The port and protocol on which Graphite is listening</font></div><div><font size="2"   ># default: 2003</font></div><div><font size="2"   ># carbon_port 2003</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># default: tcp</font></div><div><font size="2"   ># carbon_protocol udp</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># **Deprecated in favor of graphite_path** A prefix to prepend to the&nbsp;</font></div><div><font size="2"   ># metric names exported by gmetad. Graphite uses dot-</font></div><div><font size="2"   ># separated paths to organize and refer to metrics.&nbsp;</font></div><div><font size="2"   ># default: unspecified</font></div><div><font size="2"   ># graphite_prefix "datacenter1.gmetad"</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># A user-definable graphite path. Graphite uses dot-</font></div><div><font size="2"   ># separated paths to organize and refer to metrics.&nbsp;</font></div><div><font size="2"   ># For reverse compatibility graphite_prefix will be prepended to this</font></div><div><font size="2"   ># path, but this behavior should be considered deprecated.</font></div><div><font size="2"   ># This path may include 3 variables that will be replaced accordingly:</font></div><div><font size="2"   ># %s -&gt; source (cluster name)</font></div><div><font size="2"   ># %h -&gt; host (host name)</font></div><div><font size="2"   ># %m -&gt; metric (metric name)</font></div><div><font size="2"   ># default: graphite_prefix.%s.%h.%m</font></div><div><font size="2"   ># graphite_path "datacenter1.gmetad.%s.%h.%m</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># Number of milliseconds gmetad will wait for a response from the graphite server&nbsp;</font></div><div><font size="2"   ># default: 500</font></div><div><font size="2"   ># carbon_timeout 500</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >memcached相关配置.</font></div><div><font size="2"   >#-------------------------------------------------------------------------------</font></div><div><font size="2"   ># Memcached configuration (if it has been compiled in)</font></div><div><font size="2"   ># Format documentation at http://docs.libmemcached.org/libmemcached_configuration.html</font></div><div><font size="2"   ># default: ""</font></div><div><font size="2"   ># memcached_parameters "--SERVER=127.0.0.1"</font></div><div><font size="2"   >#</font></div><p></p></pre></div><div><br></div><div>简单的配置如下 :&nbsp;</div><div>创建rrd数据文件目录, 修改权限 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># mkdir -p /data01/rrd</font></div><div><font size="2"   ># chown nobody /data01/rrd</font></div><p></p></pre></div><div>配置gmetad.conf&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi /opt/ganglia-core-3.6.0/etc/gmetad.conf&nbsp;</font></div><div><div><font size="2"   >data_source "my cluster" 10 172.16.3.221&nbsp;</font></div><div><font size="2"   >RRAs "RRA:AVERAGE:0.5:1:5856" "RRA:AVERAGE:0.5:4:20160" "RRA:AVERAGE:0.5:40:52704"&nbsp;</font></div><div><font size="2"   >setuid on</font></div><div><font size="2"   >setuid_username "nobody"</font></div><div><font size="2"   >umask 022</font></div><div><font size="2"   >xml_port 8651</font></div><div><font size="2"   >interactive_port 8652</font></div><div><font size="2"   >server_threads 10</font></div><div><font size="2"   >rrd_rootdir "/data01/rrd"</font></div><div><font size="2"   >case_sensitive_hostnames 0</font></div></div><p></p></pre></div><div><br></div><div>启动gmetad</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 etc]# gmetad -c /opt/ganglia-core-3.6.0/etc/gmetad.conf&nbsp;</font></div><div><font size="2"   >[root@db-172-16-3-221 etc]# netstat -anp|grep gmetad</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 0.0.0.0:8651 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;4982/gmetad &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 0.0.0.0:8652 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;4982/gmetad &nbsp;</font></div><p></p></pre></div><div><br></div><div>产生的rrd文件如下 :&nbsp;</div><div>注意产生的文件和XML里面解析出来的主机名有关 :&nbsp;</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@db-172-16-3-221 rrd]# cat /etc/hosts</font></div><div style="line-height: 28px;"   ><font size="2"   >127.0.0.1 &nbsp; localhost localhost.localdomain localhost4 localhost4.localdomain4</font></div><div style="line-height: 28px;"   ><font size="2"   >#::1 &nbsp; &nbsp; &nbsp; &nbsp; localhost localhost.localdomain localhost6 localhost6.localdomain6</font></div><div style="line-height: 28px;"   ><font size="2"   >172.16.3.221 db-172-16-3-221.localdomain db-172-16-3-221</font></div><div style="line-height: 28px;"   ><font size="2"   >172.16.3.150 150.sky-mobi.com</font></div><p></p></pre></div></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >我们查看一台gmond的XML信息如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 rrd]# telnet 172.16.3.221 8649</font></div><div><div><font size="2"   >&lt;GANGLIA_XML VERSION="3.6.0" SOURCE="gmond"&gt;</font></div><div><font size="2"   >&lt;CLUSTER NAME="test" LOCALTIME="1410403311" OWNER="digoal" LATLONG="111 122" URL="http://dba.sky-mobi.com"&gt;</font></div><div><font size="2"   >&lt;HOST NAME="db-172-16-3-221.localdomain" IP="172.16.3.221" TAGS="" REPORTED="1410403301" TN="9" TMAX="20" DMAX="86400" LOCATION="1,2,3" GMOND_STARTED="1410332246"&gt;</font></div></div><p></p></pre></div><div><br></div><div>查看gmetad收集到的这台gmond的rrd信息 :&nbsp;</div><div>目录结构包括summary , 集群名, 集群下面的主机名, summary :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># cd /data01/rrd/</font></div><div><div><font size="2"   >[root@db-172-16-3-221 rrd]# ll -R</font></div><div><font size="2"   >.:</font></div><div><font size="2"   >total 4</font></div><div><font size="2"   >drwxr-xr-x 2 nobody nobody 4096 Sep 10 17:38 __SummaryInfo__</font></div><div><font size="2"   >drwxr-xr-x 4 nobody nobody &nbsp; 62 Sep 10 17:37 test</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >./__SummaryInfo__:</font></div><div><font size="2"   >total 35728</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 boottime.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 bytes_in.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 bytes_out.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_aidle.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_idle.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_nice.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_num.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_speed.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_steal.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_system.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_user.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_wio.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 disk_free.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 disk_total.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 load_fifteen.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 load_five.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 load_one.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 mem_buffers.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 mem_cached.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 mem_free.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 mem_shared.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 mem_total.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 part_max_used.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 pkts_in.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 pkts_out.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 proc_run.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 proc_total.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 swap_free.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 swap_total.rrd</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >./test:</font></div><div><font size="2"   >total 8</font></div><div><font size="2"   >drwxr-xr-x 2 nobody nobody 4096 Sep 10 17:37 db-172-16-3-221.localdomain</font></div><div><font size="2"   >drwxr-xr-x 2 nobody nobody 4096 Sep 10 17:37 __SummaryInfo__</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >./test/db-172-16-3-221.localdomain:</font></div><div><font size="2"   >total 17864</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 boottime.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 bytes_in.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 bytes_out.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 cpu_aidle.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 cpu_idle.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 cpu_nice.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 cpu_num.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 cpu_speed.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 cpu_steal.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 cpu_system.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 cpu_user.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 cpu_wio.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 disk_free.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 disk_total.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 load_fifteen.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 load_five.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 load_one.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 mem_buffers.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 mem_cached.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 mem_free.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 mem_shared.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 mem_total.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 part_max_used.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 pkts_in.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 pkts_out.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 proc_run.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 proc_total.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 swap_free.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 630760 Sep 10 17:38 swap_total.rrd</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >./test/__SummaryInfo__:</font></div><div><font size="2"   >total 35728</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 boottime.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 bytes_in.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 bytes_out.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_aidle.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_idle.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_nice.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_num.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_speed.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_steal.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_system.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_user.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 cpu_wio.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 disk_free.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 disk_total.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 load_fifteen.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 load_five.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 load_one.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 mem_buffers.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 mem_cached.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 mem_free.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 mem_shared.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 mem_total.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 part_max_used.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 pkts_in.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 pkts_out.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 proc_run.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 proc_total.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 swap_free.rrd</font></div><div><font size="2"   >-rw-r--r-- 1 nobody nobody 1260992 Sep 10 17:38 swap_total.rrd</font></div></div><p></p></pre></div><div><br></div><div>与gmetad交互, 同样可以使用telnet :&nbsp;</div><div>8651端口获取这台gmetad的XML元数据.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-221 db-172-16-3-221.localdomain]# netstat -anp|grep gmeta</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 0.0.0.0:8651 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;4982/gmetad &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 0.0.0.0:8652 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;4982/gmetad &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >unix &nbsp;2 &nbsp; &nbsp; &nbsp;[ ] &nbsp; &nbsp; &nbsp; &nbsp; DGRAM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;39681 &nbsp;4982/gmetad &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >[root@db-172-16-3-221 db-172-16-3-221.localdomain]# telnet 127.0.0.1 8651</font></div><div><font size="2"   >Trying 127.0.0.1...</font></div><div><font size="2"   >Connected to 127.0.0.1.</font></div><div><font size="2"   >Escape character is '^]'.</font></div><div><font size="2"   >&lt;?xml version="1.0" encoding="ISO-8859-1" standalone="yes"?&gt;</font></div><div><font size="2"   >&lt;!DOCTYPE GANGLIA_XML [</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;!ELEMENT GANGLIA_XML (GRID|CLUSTER|HOST)*&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST GANGLIA_XML VERSION CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST GANGLIA_XML SOURCE CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;!ELEMENT GRID (CLUSTER | GRID | HOSTS | METRICS)*&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST GRID NAME CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST GRID AUTHORITY CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST GRID LOCALTIME CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;!ELEMENT CLUSTER (HOST | HOSTS | METRICS)*&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST CLUSTER NAME CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST CLUSTER OWNER CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST CLUSTER LATLONG CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST CLUSTER URL CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST CLUSTER LOCALTIME CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;!ELEMENT HOST (METRIC)*&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOST NAME CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOST IP CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOST LOCATION CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOST TAGS CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOST REPORTED CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOST TN CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOST TMAX CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOST DMAX CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOST GMOND_STARTED CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;!ELEMENT METRIC (EXTRA_DATA*)&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRIC NAME CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRIC VAL CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRIC TYPE (string | int8 | uint8 | int16 | uint16 | int32 | uint32 | float | double | timestamp) #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRIC UNITS CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRIC TN CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRIC TMAX CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRIC DMAX CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRIC SLOPE (zero | positive | negative | both | unspecified) #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRIC SOURCE (gmond) 'gmond'&gt;</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;!ELEMENT EXTRA_DATA (EXTRA_ELEMENT*)&gt;</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;!ELEMENT EXTRA_ELEMENT EMPTY&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST EXTRA_ELEMENT NAME CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST EXTRA_ELEMENT VAL CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;!ELEMENT HOSTS EMPTY&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOSTS UP CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOSTS DOWN CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST HOSTS SOURCE (gmond | gmetad) #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp;&lt;!ELEMENT METRICS (EXTRA_DATA*)&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRICS NAME CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRICS SUM CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRICS NUM CDATA #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRICS TYPE (string | int8 | uint8 | int16 | uint16 | int32 | uint32 | float | double | timestamp) #REQUIRED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRICS UNITS CDATA #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRICS SLOPE (zero | positive | negative | both | unspecified) #IMPLIED&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;!ATTLIST METRICS SOURCE (gmond) 'gmond'&gt;</font></div><div><font size="2"   >]&gt;</font></div><div><font size="2"   >&lt;GANGLIA_XML VERSION="3.6.0" SOURCE="gmetad"&gt;</font></div><div><font size="2"   >&lt;GRID NAME="unspecified" AUTHORITY="http://db-172-16-3-221/ganglia/" LOCALTIME="1410403531"&gt;</font></div><div><font size="2"   >&lt;CLUSTER NAME="test" LOCALTIME="1410403521" OWNER="digoal" LATLONG="111 122" URL="http://dba.sky-mobi.com"&gt;</font></div><div><font size="2"   >&lt;HOST NAME="db-172-16-3-221.localdomain" IP="172.16.3.221" REPORTED="1410403521" TN="10" TMAX="20" DMAX="86400" LOCATION="1,2,3" GMOND_STARTED="1410332246" TAGS=""&gt;</font></div><div><font size="2"   >&lt;METRIC NAME="disk_free" VAL="3209.276" TYPE="double" UNITS="GB" TN="181" TMAX="180" DMAX="0" SLOPE="both" SOURCE="gmond"&gt;</font></div><div><font size="2"   >&lt;EXTRA_DATA&gt;</font></div><div><font size="2"   >&lt;EXTRA_ELEMENT NAME="GROUP" VAL="disk"/&gt;</font></div><div><font size="2"   >&lt;EXTRA_ELEMENT NAME="DESC" VAL="Total free disk space"/&gt;</font></div><div><font size="2"   >&lt;EXTRA_ELEMENT NAME="TITLE" VAL="Disk Space Available"/&gt;</font></div><div><font size="2"   >&lt;/EXTRA_DATA&gt;</font></div></div><div><font size="2"   >...</font></div><div><font size="2"   >略</font></div><p></p></pre></div><div><br></div><div>8652端口的查询语法, 交互式查询方法 :&nbsp;</div><div>例如本例的集群名为test, 其中一台主机名为<span style="line-height: 28px;"   >db-172-16-3-221.localdomain</span></div><div><span style="line-height: 28px;"   >用法如下 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >As mentioned previously, gmetad listens on TCP port</font></div><div><font size="2"   >8652 (by default) for interactive queries. The interactive query functionality enables</font></div><div><font size="2"   >client programs to get XML dumps of the state of only the portion of the Grid in which</font></div><div><font size="2"   >they’re interested.</font></div><div><font size="2"   >Interactive queries are performed via a text protocol (similar to SMTP or HTTP). Queries are hierarchal, and begin with a forward slash (/). For example, the following query</font></div><div><font size="2"   >returns an XML dump of the entire grid state:</font></div><div><font size="2"   >/</font></div><div><font size="2"   >To narrow the query result, specify the name of a cluster:</font></div><div><font size="2"   >/cluster1</font></div><div><font size="2"   >To narrow the query result further, specify the name of a host in the cluster:</font></div><div><font size="2"   >/cluster1/host1</font></div><div><font size="2"   >Queries may be suffixed with a filter to modify the type of metric information returned</font></div><div><font size="2"   >by the query (as of this writing, summaryis the only filter available). For example, you</font></div><div><font size="2"   >can request only the summary metric data from cluster1like so:</font></div><div><font size="2"   >/cluster1?filter=summary</font></div><p></p></pre></div><div><br></div><div>例如导出一台主机的METADATA</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-221 db-172-16-3-221.localdomain]# telnet 127.0.0.1 8652</font></div><div><font size="2"   >Trying 127.0.0.1...</font></div><div><font size="2"   >Connected to 127.0.0.1.</font></div><div><font size="2"   >Escape character is '^]'.</font></div><div><font size="2"   >/test/db-172-16-3-221.localdomain&nbsp;</font></div></div><div><font size="2"   >......</font></div><div><div><font size="2"   >&lt;GANGLIA_XML VERSION="3.6.0" SOURCE="gmetad"&gt;</font></div><div><font size="2"   >&lt;GRID NAME="unspecified" AUTHORITY="http://db-172-16-3-221/ganglia/" LOCALTIME="1410403721"&gt;</font></div><div><font size="2"   >&lt;CLUSTER NAME="test" LOCALTIME="1410403711" OWNER="digoal" LATLONG="111 122" URL="http://dba.sky-mobi.com"&gt;</font></div><div><font size="2"   >&lt;HOST NAME="db-172-16-3-221.localdomain" IP="172.16.3.221" REPORTED="1410403710" TN="0" TMAX="20" DMAX="86400" LOCATION="1,2,3" GMOND_STARTED="1410332246" TAGS=""&gt;</font></div><div><font size="2"   >&lt;METRIC NAME="disk_free" VAL="3209.276" TYPE="double" UNITS="GB" TN="0" TMAX="180" DMAX="0" SLOPE="both" SOURCE="gmond"&gt;</font></div><div><font size="2"   >&lt;EXTRA_DATA&gt;</font></div><div><font size="2"   >&lt;EXTRA_ELEMENT NAME="GROUP" VAL="disk"/&gt;</font></div><div><font size="2"   >&lt;EXTRA_ELEMENT NAME="DESC" VAL="Total free disk space"/&gt;</font></div><div><font size="2"   >&lt;EXTRA_ELEMENT NAME="TITLE" VAL="Disk Space Available"/&gt;</font></div><div><font size="2"   >&lt;/EXTRA_DATA&gt;</font></div><div><font size="2"   >&lt;/METRIC&gt;</font></div></div><div><font size="2"   >......</font></div><div><font size="2"   >略</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >使用rrdtool导出rrd的内容.</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-221 db-172-16-3-221.localdomain]# rrdtool dump ./swap_free.rrd |less</font></div><div><font size="2"   >&lt;?xml version="1.0" encoding="utf-8"?&gt;</font></div><div><font size="2"   >&lt;!DOCTYPE rrd SYSTEM "http://oss.oetiker.ch/rrdtool/rrdtool.dtd"&gt;</font></div><div><font size="2"   >&lt;!-- Round Robin Database Dump --&gt;</font></div><div><font size="2"   >&lt;rrd&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;version&gt;0003&lt;/version&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;step&gt;10&lt;/step&gt; &lt;!-- Seconds --&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;lastupdate&gt;1410403482&lt;/lastupdate&gt; &lt;!-- 2014-09-11 10:44:42 CST --&gt;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;ds&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;name&gt; sum &lt;/name&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;type&gt; GAUGE &lt;/type&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;minimal_heartbeat&gt;80&lt;/minimal_heartbeat&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;min&gt;NaN&lt;/min&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;max&gt;NaN&lt;/max&gt;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- PDP Status --&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;last_ds&gt;1048568&lt;/last_ds&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;value&gt;2.0971360000e+06&lt;/value&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;unknown_sec&gt; 0 &lt;/unknown_sec&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/ds&gt;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Round Robin Archives --&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;rra&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;cf&gt;AVERAGE&lt;/cf&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;pdp_per_row&gt;1&lt;/pdp_per_row&gt; &lt;!-- 10 seconds --&gt;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;params&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;xff&gt;5.0000000000e-01&lt;/xff&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/params&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;cdp_prep&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;ds&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;primary_value&gt;1.0485680000e+06&lt;/primary_value&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;secondary_value&gt;1.0485680000e+06&lt;/secondary_value&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;value&gt;NaN&lt;/value&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;unknown_datapoints&gt;0&lt;/unknown_datapoints&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/ds&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/cdp_prep&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;database&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- 2014-09-10 18:28:50 CST / 1410344930 --&gt; &lt;row&gt;&lt;v&gt;1.0485680000e+06&lt;/v&gt;&lt;/row&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- 2014-09-10 18:29:00 CST / 1410344940 --&gt; &lt;row&gt;&lt;v&gt;1.0485680000e+06&lt;/v&gt;&lt;/row&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- 2014-09-10 18:29:10 CST / 1410344950 --&gt; &lt;row&gt;&lt;v&gt;1.0485680000e+06&lt;/v&gt;&lt;/row&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- 2014-09-10 18:29:20 CST / 1410344960 --&gt; &lt;row&gt;&lt;v&gt;1.0485680000e+06&lt;/v&gt;&lt;/row&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- 2014-09-10 18:29:30 CST / 1410344970 --&gt; &lt;row&gt;&lt;v&gt;1.0485680000e+06&lt;/v&gt;&lt;/row&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- 2014-09-10 18:29:40 CST / 1410344980 --&gt; &lt;row&gt;&lt;v&gt;1.0485680000e+06&lt;/v&gt;&lt;/row&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- 2014-09-10 18:29:50 CST / 1410344990 --&gt; &lt;row&gt;&lt;v&gt;1.0485680000e+06&lt;/v&gt;&lt;/row&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- 2014-09-10 18:30:00 CST / 1410345000 --&gt; &lt;row&gt;&lt;v&gt;1.0485680000e+06&lt;/v&gt;&lt;/row&gt;</font></div></div><div><font size="2"   >....略</font></div><p></p></pre></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014899439839/"   >http://blog.163.com/digoal@126/blog/static/1638770402014899439839/</a></div><div>2.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201489111654684/"   >http://blog.163.com/digoal@126/blog/static/163877040201489111654684/</a></div><div>3.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014810227936/"   >http://blog.163.com/digoal@126/blog/static/1638770402014810227936/</a></div><div>4. man rrdcreate</div><div>5. &lt;monitoring with Ganglia&gt;</div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="gmetad configure - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">c - 2014-10-24 17:45:14</h5>
				<div>rrdcache的使用配置在哪？</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 c - 2014-10-24 17:45:14</h5>
				<div style="width:600px;">没有</div>
			</div>
	</div>
</div>
</body>
</html>