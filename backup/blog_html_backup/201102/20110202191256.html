<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Passing Patameters to PL/SQL Subprograms</h2>
	<h5 id="">2011-02-02 19:12:56&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020111264954584/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><br>SUBPROGRAM调用流程:<br><div><img title="Passing Patameters to PL/SQL Subprograms - 德哥@Digoal - The Heart,The World."  alt="Passing Patameters to PL/SQL Subprograms - 德哥@Digoal - The Heart,The World."  style="margin: 0pt 10px 0pt 0pt;"  src="http://img313.ph.126.net/ECfkdXpZgT1AQVJHAjYtCA==/3679722370539215102.jpg"  ></div>&nbsp;<br><br>形参和实参举例:<br><pre>DECLARE<br>  emp_num NUMBER(6) := 120;<br>  bonus   NUMBER(6) := 100;<br>  merit   NUMBER(4) := 50;<br>  PROCEDURE raise_salary (emp_id NUMBER, amount NUMBER) IS<br>    BEGIN<br>      UPDATE employees SET salary = salary + amount WHERE employee_id = emp_id;<br>  END raise_salary;<br>BEGIN<br>  raise_salary(emp_num, bonus); -- procedure call specifies actual parameters<br>  raise_salary(emp_num, merit + bonus); -- expressions can be used as parameters<br>END;<br>/<br><br>位置调用，名字调用和混合调用举例：<br>DECLARE<br>  emp_num NUMBER(6) := 120;<br>  bonus   NUMBER(6) := 50;<br>  PROCEDURE raise_salary (emp_id NUMBER, amount NUMBER) IS<br>    BEGIN<br>      UPDATE employees SET salary = salary + amount WHERE employee_id = emp_id;<br>  END raise_salary;<br>BEGIN<br>  raise_salary(emp_num, bonus); -- positional procedure call for actual parameters<br>  raise_salary(amount =&gt; bonus, emp_id =&gt; emp_num); -- named parameters<br>  raise_salary(emp_num, amount =&gt; bonus); -- mixed parameters<br>END;<br>/<br><br>参数模式：<br>参数分三种模式,IN (默认),OUT,IN OUT<br>这三种模式适用任何subprogram,但是在使用当中最好不要在函数中使用OUT和IN OUT模式，函数使用中应该尽量避免返回多个值，同时函数对端<br>影响应该是自由的。换句话说不要改变非本地变量（相对subprogram）。<br><br>IN模式介绍：<br>不指定模式的话默认是IN模式，IN模式的形参，一般用在传输值给被调用的SUBPROGRAM，在subprogram内部，IN形参类似常量，不可以指派值给<br>它。<br>可以传输常量，文字，已经被初始化的变量，或者表达式给IN形参数。<br>IN形参可以设置初始化默认值，当调用带有默认值的形参SUBPROGRAM时，忘记传输值给这些参数的话讲使用默认值。<br><br>OUT模式介绍：<br>OUT模式的参数在SUBPROGRAM中类似变量，在SUBPROGRAM中可以改变OUT模式的形参值，修改的值将影响调用这个SUBPROGRAM的程序的实参的值。<br>使用举例：<br>DECLARE<br>  emp_num       NUMBER(6) := 120;<br>  bonus         NUMBER(6) := 50;<br>  emp_last_name VARCHAR2(25);<br>  PROCEDURE raise_salary (emp_id IN NUMBER, amount IN NUMBER, <br>                          emp_name OUT VARCHAR2) IS<br>    BEGIN<br>      UPDATE employees SET salary = salary + amount WHERE employee_id = emp_id;<br>      SELECT last_name INTO emp_name FROM employees WHERE employee_id = emp_id;<br>  END raise_salary;<br>BEGIN<br>  raise_salary(emp_num, bonus, emp_last_name); <br>  DBMS_OUTPUT.PUT_LINE('Salary has been updated for: ' || emp_last_name);<br>END;<br>/<br><br>必须传输变量给OUT形参，不能传输常量或表达式。调用时OUT形参对应的实参值将丢失，除非使用了NOCOPY或者SUBPROGRAM退出时遇到unhandled<br>exception.<br>和变量类似，OUT形参被初始为NULL，因此OUT形参的数据类型不能为定义为NOT NULL的类型，如NATURALN , POSITIVEN。否则调用SUBPROGRAM<br>时将遭遇VALUE_ERROR异常。<br>退出SUBPROGRAM前，务必指派有意义的值给OUT 形参数。否则成功退出SUBPROGRAM后，对应的实参将变成NULL。成功退出SUBPROGRAM后，OUT形参<br>的值将赋予给实参。如果遭遇unhandled exception，OUT形参的值不会赋予给对应的实参。<br><br>IN OUT模式举例：<br>IN OUT模式的形参用于传输初始值，并且返回修改过的值的SUBPROGRAM的调用者。IN OUT形参的对应实参必须是变量，不能是常量或者表达式。<br>成功退出SUBPROGRAM后，IN OUT形参的值将赋予给实参。如果遭遇unhandled exception，IN OUT形参的值不会赋予给对应的实参。<br><br>三种模式对比：<br></pre><table title="Parameter Modes"  summary="This table is described in the preceding text"  dir="ltr"  width="100%"  border="1"  cellpadding="3"  cellspacing="0"  frame="hsides"  rules="groups"  ><thead><tr valign="top"  align="left"  ><th id="r1c1-t3"  valign="bottom"  align="left"  >IN</th> <th id="r1c2-t3"  valign="bottom"  align="left"  >OUT</th> <th id="r1c3-t3"  valign="bottom"  align="left"  >IN OUT</th> </tr> </thead> <tbody> <tr valign="top"  align="left"  > <td id="r2c1-t3"  headers="r1c1-t3"  align="left"  >The default</td> <td headers="r2c1-t3 r1c2-t3"  align="left"  >Must be specified</td> <td headers="r2c1-t3 r1c3-t3"  align="left"  >Must be specified</td> </tr> <tr valign="top"  align="left"  > <td id="r3c1-t3"  headers="r1c1-t3"  align="left"  >Passes values to a subprogram</td> <td headers="r3c1-t3 r1c2-t3"  align="left"  >Returns values to the caller</td> <td headers="r3c1-t3 r1c3-t3"  align="left"  >Passes initial values to a subprogram and returns updated values to the caller</td> </tr> <tr valign="top"  align="left"  > <td id="r4c1-t3"  headers="r1c1-t3"  align="left"  >Formal parameter acts like a constant</td> <td headers="r4c1-t3 r1c2-t3"  align="left"  >Formal parameter acts like an uninitialized variable</td> <td headers="r4c1-t3 r1c3-t3"  align="left"  >Formal parameter acts like an initialized variable</td> </tr> <tr valign="top"  align="left"  > <td id="r5c1-t3"  headers="r1c1-t3"  align="left"  >Formal parameter cannot be assigned a value</td> <td headers="r5c1-t3 r1c2-t3"  align="left"  >Formal parameter must be assigned a value</td> <td headers="r5c1-t3 r1c3-t3"  align="left"  >Formal parameter should be assigned a value</td> </tr> <tr valign="top"  align="left"  > <td id="r6c1-t3"  headers="r1c1-t3"  align="left"  >Actual parameter can be a constant, initialized variable, literal, or expression</td> <td headers="r6c1-t3 r1c2-t3"  align="left"  >Actual parameter must be a variable</td> <td headers="r6c1-t3 r1c3-t3"  align="left"  >Actual parameter must be a variable</td> </tr> <tr valign="top"  align="left"  > <td id="r7c1-t3"  headers="r1c1-t3"  align="left"  >Actual parameter is passed by reference (a pointer to the value is passed in)</td> <td headers="r7c1-t3 r1c2-t3"  align="left"  >Actual parameter is passed by value (a copy of the value is passed out) unless <code>NOCOPY</code> is specified</td> <td headers="r7c1-t3 r1c3-t3"  align="left"  >Actual parameter is passed by value (a copy of the value is passed in and out) unless <code>NOCOPY</code> is specified</td></tr></table><pre><br>NOCOPY举例：<br>The optional <code>NOCOPY</code> keyword speeds up processing of large <code>OUT</code> or <code>IN OUT</code> parameters.<br>The <code>NOCOPY</code> compiler hint increases the possibility of <a id="sthref1843" name="sthref1843" rel="nofollow"  ></a><a id="sthref1844" name="sthref1844" rel="nofollow"  ></a><a id="sthref1845" name="sthref1845" rel="nofollow"  ></a>aliasing<br> (that is, having two different names refer to the same memory location). This can occur when a global variable appears as an actual <br>parameter in a subprogram call and then is referenced within the subprogram. The result is indeterminate because it depends on the method<br> of parameter passing chosen by the compiler.<br><br>DECLARE<br>   TYPE Definition IS RECORD (<br>      word    VARCHAR2(20),<br>      meaning VARCHAR2(200));<br>   TYPE Dictionary IS VARRAY(2000) OF Definition;<br>   lexicon Dictionary := Dictionary();<br>   PROCEDURE add_entry (word_list IN OUT NOCOPY Dictionary) IS<br>   BEGIN<br>     word_list(1).word := 'aardvark';<br>     lexicon(1).word := 'aardwolf';<br>   END;<br>BEGIN<br>   lexicon.EXTEND;<br>   add_entry(lexicon);<br>   DBMS_OUTPUT.PUT_LINE(lexicon(1).word);<br>END;<br>/<br></pre></div>
	</div>
</div>
</body>
</html>