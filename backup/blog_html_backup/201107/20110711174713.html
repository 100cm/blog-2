<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">thinking about the bussiness system high availability</h2>
	<h5 id="">2011-07-11 17:47:13&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201161151348179/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">我这里说的bussiness system指的是业务系统整体。包括应用程序，网络，数据库，主机，存储等等和应用系统可用性有关的东西。<div>bussiness system high availability 大多数情况下指的是业务连续性。</div><div>比如下面这个最简单的业务系统:</div><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img767.ph.126.net/L2ZWzFdDyOowbyC7p3ctsw==/4907516218950549053.png"></div><div><div><div style="line-height: 22px;">存在如下缺陷:</div><div style="line-height: 22px;">1. 接入网络出现问题的话，应用程序就不能被用户访问。</div><div style="line-height: 22px;">2. 数据库出现故障，也不能提供服务。</div><div style="line-height: 22px;">3. 应用服务器出现故障也不能提供服务。</div></div><div style="line-height: 22px;"><br></div><div>再来看一个图:</div><div><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/uPUeoAuue9vgvifGXu3ypw==/1554867771366459165.png"></div>&nbsp;这里也存在几个缺陷:</div><div><div style="line-height: 22px;">1. 接入网络出现问题的话，应用程序就不能被用户访问。</div><div style="line-height: 22px;">2. 数据库出现故障，也不能提供服务。</div></div><div style="line-height: 22px;"><br></div><div style="line-height: 22px;">再看:</div><div style="line-height: 22px;"><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/WwYoiZ4RBkyqK1bXHV5h4Q==/2366360129207170164.png"></div>&nbsp;这里增加了一个消息中间件，如果数据库DOWN机得话，可以保持队列，但是也只能完成部分功能，提高了部分整个系统可用性。</div><div style="line-height: 22px;"><br></div><div style="line-height: 22px;">再看一个:</div><div style="line-height: 22px;"><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/c3aSON4_6ZnYgKUGIL0kAQ==/608548899665234030.png"></div>&nbsp;</div><div style="line-height: 22px;">这里用到了数据库复制，读写分离。进一步提高了整个业务系统的可用性。</div><div style="line-height: 22px;">但是还不够，再看一个：</div><div style="line-height: 22px;"><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/qmdRtg5U-T8SAsAIx18mQA==/1130403506486790881.png"></div>&nbsp;</div><div style="line-height: 22px;">这次加入了应用层缓存，再次提高系统可用性。但是还不够。</div><div style="line-height: 22px;">继续：</div><div style="line-height: 22px;"><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/MR9MINHpm3IxLbsURdTbiw==/1024568915243583674.png"></div>&nbsp;</div><div style="line-height: 22px;">这次把应用层缓存和消息中间件都做了群集再次提高系统可用性。但是还不够</div><div style="line-height: 22px;">继续：</div><div style="line-height: 22px;"><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img762.ph.126.net/akXhVl-hJPLciisw0bEDUA==/4925812092436884492.png"></div>&nbsp;</div><div style="line-height: 22px;">这次加入了负载均衡，再次提高系统可用性。但是还不够，</div><div style="line-height: 22px;">继续：</div><div style="line-height: 22px;"><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/Yjpkv4ollfpE3OYK7Avn-Q==/2683582427976190041.png"></div>&nbsp;</div><div style="line-height: 22px;">数据库再次群集，进一步提高系统可用性。</div><div style="line-height: 22px;">DB-primary集群，oracle可以考虑RAC，PG可以考虑RHCS等。</div><div style="line-height: 22px;">但是还不够，如果IDC挂了怎么办？</div><div style="line-height: 22px;">继续</div><div style="line-height: 22px;"><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/7Ew_0YSfohnriHodbkZewQ==/2659938529932495228.png"></div>&nbsp;</div>&nbsp;增加了智能DNS解析，再一次提高系统可用性。但是还不够。还可以提高。</div><div>如下：</div><div><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/7ZV82G9NQ3vOjME0xVCRFQ==/1291407193165285599.png"></div>&nbsp;</div><div>根据业务系统功能，拆分数据库，进一步提高业务系统可用性。</div><div><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/8DkzTVB3aNEV6L-Y12bYpg==/2823475491401388578.png"></div>&nbsp;数据库水平拆分，按照特定的规则，将数据拆为多份，如用户ID取模.但是需要保证拆分后的数据库整体一致性，如一个库的用户赠与了物品给另一个库的用户。那么这个过程结束后，数据库能看到的状态是，物品在另一个库的时候，第一个库是没有物品的。不能出现两个库都有或者都没有该物品。这个问题其实是比较难解决的,需要一个全局事务来保证。</div><div><br></div><div>还有很多很多办法来提高业务的连续性。</div><div>但是如果仅仅关注数据库的话，对于数据库来说，压力太大了。伤不起啊。</div><div>【参考】</div><div>websphere mq</div><div>active mq</div><div>messageq</div><div>redis</div><div>zookeeper</div><div>memcacheQ</div><div>rabbitmq</div><div>等，</div><div>感谢王炎给我提供的关于消息中间件的讲解。</div><div>【补充】</div><div>1. 图中rabbitMQ泛指MQ。</div><div>2. MQ的逻辑层次是在应用和数据库之间，以上图中的是物理连接.以下是逻辑位置.</div><div><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/wThnk96MSPHA-TQzGKgUEw==/1025131865197006774.png"></div>&nbsp;3. 数据库集群仲裁,负责激活Standby和IP的漂移.</div><div><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/aqnNG4WE5_CXKtmxreQBcw==/600386125340626691.png"></div>&nbsp;4. 可以建立多个MQ，分别存放只读和读写的消息队列。</div><div><div><img title="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." alt="thinking about the bussiness system high availability - 德哥@Digoal - The Heart,The World." style="margin:0 10px 0 0;" src="http://img.ph.126.net/X1AiHUdevimhvxXTXfpfNA==/1323213865533592871.png"></div>&nbsp;</div></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">francs - 2011-07-13 17:27:45</h5>
				<div>好贴，<IMG src="http://b.bst.126.net/common/portrait/face/preview/face0.gif">加精啊！</div>
			</div>
	</div>
</div>
</body>
</html>