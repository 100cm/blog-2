<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.5 new feature - use FSM fast evaluate bloat and other table level statics</h2>
	<h5 id="">2015-05-15 17:42:50&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201541553253503/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>今天看到一个9.5的patch，是和pgstattuple插件统计有关的，正常情况下，调用pgstattuple统计时需要扫全表。</div><div><div>always performs a&nbsp;<span style="line-height: 28px;"   >full-table scan and returns an exact count of live and dead tuples&nbsp;</span><span style="line-height: 28px;"   >(and their sizes) and free space。</span></div></div><div><span style="line-height: 28px;"   >现在添加了一个函数</span>pgstattuple_approx()，标记为VM的块通过fsm获取并转换信息，而不在VM中的块则需要扫heap page。</div><div>这样大大提高了大表输出<span style="line-height: 28px;"   >pgstattuple统计信息的</span><span style="line-height: 28px;"   >速度。</span></div><div><span style="line-height: 28px;"   >看到这里，发现这个patch和我以前写的一篇关于统计表的真实膨胀情况的方法是类似的，有兴趣的朋友可参考：</span></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402013527920474/"   >http://blog.163.com/digoal@126/blog/static/1638770402013527920474/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201361931250103/"   >http://blog.163.com/digoal@126/blog/static/163877040201361931250103/</a></div><div><br></div><div><a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/pgstattuple.html"   >http://www.postgresql.org/docs/devel/static/pgstattuple.html</a></div><div><br></div><div><div style="font-family: sans-serif; font-size: small; line-height: normal;"   ><a style="color: rgb(0, 0, 0); display: block; padding: 6px 8px; font-weight: bold; text-decoration: none; background-color: rgb(237, 236, 230);" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=5850b20f58a594ac69f4f77b24cad94fc3bfd946"   >Add pgstattuple_approx() to the pgstattuple extension.</a></div><div style="padding: 6px 0px; border-style: solid; border-color: rgb(217, 216, 209); border-width: 0px 0px 1px; font-family: monospace; line-height: normal;"   ><table style="padding: 8px 4px; border-spacing: 0px;"   ><tbody><tr><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   >author</td><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   ><a title="Search for commits authored by Andres Freund" style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=search;h=5850b20f58a594ac69f4f77b24cad94fc3bfd946;s=Andres+Freund;st=author"   >Andres Freund</a>&nbsp;<a title="Search for commits authored by andres@anarazel.de" style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=search;h=5850b20f58a594ac69f4f77b24cad94fc3bfd946;s=andres@anarazel.de;st=author"   >&lt;andres@anarazel.de&gt;</a></td><td rowspan="2"   style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   ></td></tr><tr><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   ></td><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   >Wed, 13 May 2015 05:31:04 +0000 (07:31 +0200)</td></tr><tr><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   >committer</td><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   ><a title="Search for commits committed by Andres Freund" style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=search;h=5850b20f58a594ac69f4f77b24cad94fc3bfd946;s=Andres+Freund;st=committer"   >Andres Freund</a>&nbsp;<a title="Search for commits committed by andres@anarazel.de" style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=search;h=5850b20f58a594ac69f4f77b24cad94fc3bfd946;s=andres@anarazel.de;st=committer"   >&lt;andres@anarazel.de&gt;</a></td><td rowspan="2"   style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   ></td></tr><tr><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   ></td><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   >Wed, 13 May 2015 05:35:06 +0000 (07:35 +0200)</td></tr><tr><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   >commit</td><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   >5850b20f58a594ac69f4f77b24cad94fc3bfd946</td></tr><tr><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   >tree</td><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   ><a style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=tree;h=94c2b2bbc0ee7f7313400521ce2c8b768a911dfe;hb=5850b20f58a594ac69f4f77b24cad94fc3bfd946"   >94c2b2bbc0ee7f7313400521ce2c8b768a911dfe</a></td><td style="padding: 2px 5px; font-size: 12px; vertical-align: top; font-family: sans-serif;"   ><a style="color: rgb(136, 0, 0);" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=tree;h=94c2b2bbc0ee7f7313400521ce2c8b768a911dfe;hb=5850b20f58a594ac69f4f77b24cad94fc3bfd946"   >tree</a>&nbsp;|&nbsp;<a title="in format: tar.gz" style="color: rgb(136, 0, 0);" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=snapshot;h=5850b20f58a594ac69f4f77b24cad94fc3bfd946;sf=tgz"   >snapshot</a></td></tr><tr><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   >parent</td><td style="padding: 2px 5px; font-size: 12px; vertical-align: top;"   ><a style="color: rgb(0, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=dcf5e319089e750d726a0e18a8c90b258c39362c"   >dcf5e319089e750d726a0e18a8c90b258c39362c</a></td><td style="padding: 2px 5px; font-size: 12px; vertical-align: top; font-family: sans-serif;"   ><a style="color: rgb(136, 0, 0);" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=dcf5e319089e750d726a0e18a8c90b258c39362c"   >commit</a>&nbsp;|&nbsp;<a style="color: rgb(136, 0, 0);" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=5850b20f58a594ac69f4f77b24cad94fc3bfd946;hp=dcf5e319089e750d726a0e18a8c90b258c39362c"   >diff</a></td></tr></table></div><div style="padding: 8px; font-family: monospace; line-height: normal;"   ><font size="2"   >Add&nbsp;pgstattuple_approx()&nbsp;to&nbsp;the&nbsp;pgstattuple&nbsp;extension.<br><br>The&nbsp;new&nbsp;function&nbsp;allows&nbsp;to&nbsp;estimate&nbsp;bloat&nbsp;and&nbsp;other&nbsp;table&nbsp;level&nbsp;statics<br>in&nbsp;a&nbsp;faster,&nbsp;but&nbsp;approximate,&nbsp;way.&nbsp;It&nbsp;does&nbsp;so&nbsp;by&nbsp;using&nbsp;information&nbsp;from<br>the&nbsp;free&nbsp;space&nbsp;map&nbsp;for&nbsp;pages&nbsp;marked&nbsp;as&nbsp;all&nbsp;visible&nbsp;in&nbsp;the&nbsp;visibility<br>map.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;table&nbsp;is&nbsp;actually&nbsp;read&nbsp;and&nbsp;free&nbsp;space/bloat&nbsp;is<br>measured&nbsp;accurately.&nbsp;&nbsp;In&nbsp;many&nbsp;cases&nbsp;that&nbsp;allows&nbsp;to&nbsp;get&nbsp;bloat&nbsp;information<br>much&nbsp;quicker,&nbsp;causing&nbsp;less&nbsp;IO.<br><br>Author:&nbsp;Abhijit&nbsp;Menon-Sen<br>Reviewed-By:&nbsp;Andres&nbsp;Freund,&nbsp;Amit&nbsp;Kapila&nbsp;and&nbsp;Tomas&nbsp;Vondra<br>Discussion:&nbsp;<a style="color: rgb(136, 0, 0); text-decoration: none;" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=object;h=20140402214144"   >20140402214144</a>.GA28681@kea.toroid.org</font></div></div><div>文档说明：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >+ &nbsp; &lt;varlistentry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp;&lt;term&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;indexterm&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;&lt;primary&gt;pgstattuple_approx&lt;/primary&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;/indexterm&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;function&gt;pgstattuple_approx(regclass) returns record&lt;/&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp;&lt;/term&gt;</font></div><div><font size="2"   >+</font></div><div><font size="2"   >+ &nbsp; &nbsp;&lt;listitem&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;para&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;&lt;function&gt;pgstattuple_approx&lt;/function&gt; is a faster alternative to</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;&lt;function&gt;pgstattuple&lt;/function&gt; that returns approximate results.</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;The argument is the target relation's OID.</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;For example:</font></div><div><font size="2"   >+&lt;programlisting&gt;</font></div><div><font size="2"   >+test=&gt; SELECT * FROM pgstattuple_approx('pg_catalog.pg_proc'::regclass);</font></div><div><font size="2"   >+-[ RECORD 1 ]--------+-------</font></div><div><font size="2"   >+table_len &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 573440</font></div><div><font size="2"   >+scanned_percent &nbsp; &nbsp; &nbsp;| 2</font></div><div><font size="2"   >+approx_tuple_count &nbsp; | 2740</font></div><div><font size="2"   >+approx_tuple_len &nbsp; &nbsp; | 561210</font></div><div><font size="2"   >+approx_tuple_percent | 97.87</font></div><div><font size="2"   >+dead_tuple_count &nbsp; &nbsp; | 0</font></div><div><font size="2"   >+dead_tuple_len &nbsp; &nbsp; &nbsp; | 0</font></div><div><font size="2"   >+dead_tuple_percent &nbsp; | 0</font></div><div><font size="2"   >+approx_free_space &nbsp; &nbsp;| 11996</font></div><div><font size="2"   >+approx_free_percent &nbsp;| 2.09</font></div><div><font size="2"   >+&lt;/programlisting&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;The output columns are described in &lt;xref linkend="pgstatapprox-columns"&gt;.</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;/para&gt;</font></div><div><font size="2"   >+</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;para&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;Whereas &lt;function&gt;pgstattuple&lt;/function&gt; always performs a</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;full-table scan and returns an exact count of live and dead tuples</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;(and their sizes) and free space, &lt;function&gt;pgstattuple_approx&lt;/function&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;tries to avoid the full-table scan and returns exact dead tuple</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;statistics along with an approximation of the number and</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;size of live tuples and free space.</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;/para&gt;</font></div><div><font size="2"   >+</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;para&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;It does this by skipping pages that have only visible tuples</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;according to the visibility map (if a page has the corresponding VM</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;bit set, then it is assumed to contain no dead tuples). For such</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;pages, it derives the free space value from the free space map, and</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;assumes that the rest of the space on the page is taken up by live</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;tuples.</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;/para&gt;</font></div><div><font size="2"   >+</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;para&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;For pages that cannot be skipped, it scans each tuple, recording its</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;presence and size in the appropriate counters, and adding up the</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;free space on the page. At the end, it estimates the total number of</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;live tuples based on the number of pages and tuples scanned (in the</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;same way that VACUUM estimates pg_class.reltuples).</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;/para&gt;</font></div><div><font size="2"   >+</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;table id="pgstatapprox-columns"&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;&lt;title&gt;&lt;function&gt;pgstattuple_approx&lt;/function&gt; Output Columns&lt;/title&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;&lt;tgroup cols="3"&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &lt;thead&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Column&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Type&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Description&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &lt;/thead&gt;</font></div><div><font size="2"   >+</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &lt;tbody&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;structfield&gt;table_len&lt;/structfield&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;type&gt;bigint&lt;/type&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Physical relation length in bytes (exact)&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;structfield&gt;scanned_percent&lt;/structfield&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;type&gt;float8&lt;/type&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Percentage of table scanned&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;structfield&gt;tuple_count&lt;/structfield&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;type&gt;bigint&lt;/type&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Number of live tuples (estimated)&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;structfield&gt;tuple_len&lt;/structfield&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;type&gt;bigint&lt;/type&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Total length of live tuples in bytes (estimated)&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;structfield&gt;tuple_percent&lt;/structfield&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;type&gt;float8&lt;/type&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Percentage of live tuples&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;structfield&gt;dead_tuple_count&lt;/structfield&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;type&gt;bigint&lt;/type&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Number of dead tuples (exact)&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;structfield&gt;dead_tuple_len&lt;/structfield&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;type&gt;bigint&lt;/type&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Total length of dead tuples in bytes (exact)&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;structfield&gt;dead_tuple_percent&lt;/structfield&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;type&gt;float8&lt;/type&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Percentage of dead tuples&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;structfield&gt;approx_free_space&lt;/structfield&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;type&gt;bigint&lt;/type&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Total free space in bytes (estimated)&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;row&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;structfield&gt;approx_free_percent&lt;/structfield&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;&lt;type&gt;float8&lt;/type&gt;&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp; &lt;entry&gt;Percentage of free space&lt;/entry&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &nbsp;&lt;/row&gt;</font></div><div><font size="2"   >+</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp; &lt;/tbody&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;&lt;/tgroup&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;/table&gt;</font></div><div><font size="2"   >+</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;para&gt;</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;In the above output, the free space figures may not match the</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;&lt;function&gt;pgstattuple&lt;/function&gt; output exactly, because the free</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;space map gives us an exact figure, but is not guaranteed to be</font></div><div><font size="2"   >+ &nbsp; &nbsp; &nbsp;accurate to the byte.</font></div><div><font size="2"   >+ &nbsp; &nbsp; &lt;/para&gt;</font></div><div><font size="2"   >+</font></div><div><font size="2"   >+ &nbsp; &nbsp;&lt;/listitem&gt;</font></div><div><font size="2"   >+ &nbsp; &lt;/varlistentry&gt;</font></div><div><font size="2"   >+</font></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=5850b20f58a594ac69f4f77b24cad94fc3bfd946"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=5850b20f58a594ac69f4f77b24cad94fc3bfd946</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402013527920474/"   >http://blog.163.com/digoal@126/blog/static/1638770402013527920474/</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201361931250103/"   >http://blog.163.com/digoal@126/blog/static/163877040201361931250103/</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/pgstattuple.html"   >http://www.postgresql.org/docs/devel/static/pgstattuple.html</a></div><div>5.&nbsp;<a target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=blobdiff;f=doc/src/sgml/pgstattuple.sgml;h=b31fee9b0e1f48675d4013b7e3bea306aa3dedf7;hp=9cabd71166e8e948a610c30f573a7b762b0655ca;hb=5850b20f58a594ac69f4f77b24cad94fc3bfd946;hpb=dcf5e319089e750d726a0e18a8c90b258c39362c"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=blobdiff;f=doc/src/sgml/pgstattuple.sgml;h=b31fee9b0e1f48675d4013b7e3bea306aa3dedf7;hp=9cabd71166e8e948a610c30f573a7b762b0655ca;hb=5850b20f58a594ac69f4f77b24cad94fc3bfd946;hpb=dcf5e319089e750d726a0e18a8c90b258c39362c</a></div><div><a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/pgstattuple.html"   ><font color="#000000"   ><br></font></a><span style="line-height: 28px;"   >
</span><a style="line-height: 28px;" rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL 9.5 new feature - use FSM fast evaluate bloat and other table level statics - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div></div>
	</div>
</div>
</body>
</html>