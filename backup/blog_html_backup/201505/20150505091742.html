<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL & Oracle - 2 OLTP "update/select based primary key" & insert</h2>
	<h5 id="">2015-05-05 9:17:42&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020154431045764/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>本文主要是针对Oracle的测试， PostgreSQL的测试和测试结果请参考上一篇：</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201541104656600/"   >http://blog.163.com/digoal@126/blog/static/163877040201541104656600/</a></div><div><br></div><div>Oracle版本为12c。硬件和软件环境与上一篇测试PostgreSQL的保持一致，同一台主机，测试时关闭其他任何有干扰的服务和软件。</div><div>调整Oracle参数，创建测试表，生成测试数据：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SQL&gt; create tablespace tbs_digoal datafile '/data01/oradata/tbs_digoal' size 30G autoextend off;</font></div><div><font size="2"   >SQL&gt; create tablespace tbs_digoal_idx datafile '/data02/oradata/tbs_digoal_idx' size 30G autoextend off;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; create user digoal identified by digoal default tablespace tbs_digoal;</font></div><div><font size="2"   >SQL&gt; grant resource,connect,dba to digoal;</font></div><div><font size="2"   >SQL&gt; grant unlimited tablespace to digoal;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; alter system set processes=2000 scope=spfile;</font></div><div><font size="2"   >SQL&gt; alter system set SGA_TARGET=24G scope=spfile;</font></div><div><font size="2"   >SQL&gt; alter system set PGA_AGGREGATE_TARGET=1G scope=spfile;</font></div><div><font size="2"   >SQL&gt; alter system set db_keep_cache_size=10G scope=spfile;</font></div><div><font size="2"   >SQL&gt; alter system set CURSOR_SHARING=force scope=spfile;</font></div><div><font size="2"   >SQL&gt; <span style="line-height: 21px;"   >alter system set commit_logging='batch' scope=spfile; &nbsp;</span></font></div><div><font size="2"   ><span style="line-height: 21px;"   >SQL&gt; alter system set commit_write='nowait' scope=spfile;</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; shutdown immediate</font></div><div><font size="2"   >SQL&gt; startup</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; conn digoal/digoal</font></div><div><font size="2"   >SQL&gt; create table tbl (id int,info varchar2(256),crt_time date) tablespace tbs_digoal;</font></div><p></p></pre></div><div><br></div><div>插入测试数据：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >declare &nbsp;&nbsp;</font></div><div><font size="2"   >id int := 1;&nbsp;</font></div><div><font size="2"   >begin &nbsp;&nbsp;</font></div><div><font size="2"   >loop &nbsp;&nbsp;</font></div><div><font size="2"   >exit when id&gt;50000000;&nbsp;</font></div><div><font size="2"   >insert into digoal.tbl nologging select id,sysdate,sysdate from dual;</font></div><div><font size="2"   >id := id+1;</font></div><div><font size="2"   >end loop;&nbsp;</font></div><div><font size="2"   >commit;</font></div><div><font size="2"   >end;&nbsp;</font></div><div><font size="2"   >/</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >-- 或</font></div><div><font size="2"   >&nbsp;</font></div><div><font size="2"   >declare &nbsp;</font></div><div><font size="2"   >maxrecords constant int := 50000000;&nbsp;</font></div><div><font size="2"   >begin&nbsp;</font></div><div><font size="2"   >for id in 1..maxrecords loop&nbsp;</font></div><div><font size="2"   >insert into digoal.tbl nologging select id,sysdate,sysdate from dual;</font></div><div><font size="2"   >end loop;&nbsp;</font></div><div><font size="2"   >dbms_output.put_line('成功导入数据！');&nbsp;</font></div><div><font size="2"   >commit;&nbsp;</font></div><div><font size="2"   >end;&nbsp;</font></div><div><font size="2"   >/</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >-- 或</font></div><div><font size="2"   >SQL&gt; insert into digoal.tbl nologging select rownum,sysdate,sysdate from dual connect by level &lt;=50000000;</font></div><p></p></pre></div><div><br></div><div>创建主键，将数据加载到内存。</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SQL&gt; alter table digoal.tbl add constraint tbl_pkey primary key(id) using index tablespace tbs_digoal_idx;</font></div><div><font size="2"   >SQL&gt; alter table digoal.tbl storage (buffer_pool KEEP);</font></div><div><font size="2"   >SQL&gt; alter index digoal.tbl_pkey storage (buffer_pool KEEP);</font></div><p></p></pre></div><div><br></div><div>修改profile</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi&nbsp;/etc/profile</font></div><div><div><font size="2"   >export ORACLE_BASE=/opt/oracle/product</font></div><div><font size="2"   >export ORACLE_HOME=$ORACLE_BASE/12.0.2/db_1</font></div><div><font size="2"   >export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH</font></div><div><font size="2"   >export PATH=$ORACLE_HOME/bin:$PATH</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   ># . /etc/profile</font></div><p></p></pre></div><div><br></div><div>安装python oracle驱动</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># wget&nbsp;https://pypi.python.org/packages/source/c/cx_Oracle/cx_Oracle-5.1.3.tar.gz#md5=cd6ff16559cbc9c20087ec812c7092ab</font></div><div><font size="2"   ># tar -zxvf&nbsp;<span style="line-height: 28px;"   >cx_Oracle-5.1.3.tar.gz</span></font></div><div><font size="2"   ># cd&nbsp;<span style="line-height: 28px;"   >cx_Oracle-5.1.3</span></font></div><div><font size="2"   ><span style="line-height: 28px;"   ># python&nbsp;</span>setup.py install</font></div><p></p></pre></div><div><br></div><div>python测试脚本：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   ># vi test.py<br>import threading<br>import time<br>import cx_Oracle<br>import random<br><br>dsn=cx_Oracle.makedsn('127.0.0.1', 1521, 'oradb')<br><br>xs=12000<br>tps=dict()<br><br>class n_t(threading.Thread):   # The timer class is derived from the class threading.Thread<br>  def __init__(self, num):<br>    threading.Thread.__init__(self)<br>    self.thread_num = num<br><br>  def run(self): #Overwrite run() method, put what you want the thread do here<br>    db=cx_Oracle.connect('digoal','digoal',dsn)<br>    db.autocommit=1<br>    cur=db.cursor()<br>    pre=cur.prepare('update /*SQL' + str(self.thread_num) + '*/ tbl set info=sysdate,crt_time=sysdate where id=:id')<br><br>    tps[self.thread_num] = dict()<br><br>    f = open("/tmp/oracle_test." + str(self.thread_num), "w")<br><br>    for x in range(1,3001):<br>      start_t = time.time()<br>      for i in range(0,xs):<br>        cur.execute(pre,{'id':random.randrange(1,50000000)})    <br>      stop_t = time.time()<br>      tps[self.thread_num][x] = round(xs/(stop_t-start_t),2)<br>      res = "Round: " + str(x) + " TID: " + str(self.thread_num) + " Sec: " + str(round((stop_t-start_t),2)) + " tps: " + str(tps[self.thread_num][x])<br>      print &gt;&gt; f, res<br>      f.flush()<br><br>    f.close()<br><br>def test():<br>  t_names = []<br>  for i in xrange(0,26):<br>    t_names.append(n_t(i))<br><br>  for t in t_names:<br>    t.start()<br>  <br>  return<br><br>if __name__ == '__main__':<br>  test()</span></font></div><p></p></pre></div><div><br></div><div>更新(26 conn)测试：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># nohup python ./test.py &gt;/dev/null 2&gt;&amp;1 &amp;</font></div><div></div><p></p></pre></div><div>测试结果，约10秒输出一次tps：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># less /tmp/oracle_test.22</font></div><div><div><font size="2"   >Round: 1 TID: 22 Sec: 11.46 tps: 1187.12</font></div><div><font size="2"   >Round: 2 TID: 22 Sec: 11.34 tps: 1198.65</font></div></div><div><font size="2"   >.....</font></div><p></p></pre></div><div>其他线程结果略。</div><div><br></div><div>测试结果合并：</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># vi tps.py</font></div><div><font size="2"   >import fileinput</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >file = dict()</font></div><div><font size="2"   >line = dict()</font></div><div><font size="2"   >tps=0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >for i in xrange(0,26):</font></div><div><font size="2"   >&nbsp; file[i] = open("/tmp/oracle_test." + str(i))</font></div><div><font size="2"   >&nbsp;</font></div><div><font size="2"   >while 1:</font></div><div><font size="2"   >&nbsp; &nbsp; for i in xrange(0,26):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; line[i] = file[i].readline().split(" ",8)[7]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; tps = tps + float(line[i])</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; print(str(tps))</font></div><div><font size="2"   >&nbsp; &nbsp; tps=0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; if not line[0]:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; break</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >for i in xrange(0,26):</font></div><div><font size="2"   >&nbsp; file[i].close()</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   ># python tps.py</font></div><div><div><font size="2"   >33792.57</font></div><div><font size="2"   >29093.92</font></div><div><font size="2"   >33370.67</font></div><div><font size="2"   >33768.3</font></div><div><font size="2"   >33750.5</font></div><div><font size="2"   >33458.86</font></div><div><font size="2"   >30580.32</font></div><div><font size="2"   >33369.79</font></div></div><div><font size="2"   >......</font></div><p></p></pre></div><div>图：</div><div><div><img title="PostgreSQL VS Oracle - 2 OLTP update/select based primary key  insert - 德哥@Digoal - PostgreSQL research"   alt="PostgreSQL VS Oracle - 2 OLTP update/select based primary key  insert - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/8V2bk-vqvQg9rQjL6Ba2rA==/6597243489496061228.png"   ></div>Oracle UPDATE TPS集中在32000到33000，比较平顺。</div><div><br></div><div>查询(36 conn)测试：</div><div>测试脚本：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   ># vi test.py<br>import threading<br>import time<br>import cx_Oracle<br>import random<br><br>dsn=cx_Oracle.makedsn('127.0.0.1', 1521, 'oradb')<br><br>xs=12000<br>tps=dict()<br><br>class n_t(threading.Thread):   # The timer class is derived from the class threading.Thread<br>  def __init__(self, num):<br>    threading.Thread.__init__(self)<br>    self.thread_num = num<br><br>  def run(self): #Overwrite run() method, put what you want the thread do here<br>    db=cx_Oracle.connect('digoal','digoal',dsn)<br>    db.autocommit=1<br>    cur=db.cursor()<br>    pre=cur.prepare('select /*SQL' + str(self.thread_num) + '*/ * from tbl where id=:id')<br><br>    tps[self.thread_num] = dict()<br><br>    f = open("/tmp/oracle_test." + str(self.thread_num), "w")<br><br>    for x in range(1,3001):<br>      start_t = time.time()<br>      for i in range(0,xs):<br>        cur.execute(pre,{'id':random.randrange(1,50000000)})    <br>      stop_t = time.time()<br>      tps[self.thread_num][x] = round(xs/(stop_t-start_t),2)<br>      res = "Round: " + str(x) + " TID: " + str(self.thread_num) + " Sec: " + str(round((stop_t-start_t),2)) + " tps: " + str(tps[self.thread_num][x])<br>      print &gt;&gt; f, res<br>      f.flush()<br><br>    f.close()<br><br>def test():<br>  t_names = []<br>  for i in xrange(0,36):<br>    t_names.append(n_t(i))<br><br>  for t in t_names:<br>    t.start()<br>  <br>  return<br><br>if __name__ == '__main__':<br>  test()</span></font></div><p></p></pre></div><div>测试结果：</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># less oracle_test.0</font></div><div><font size="2"   >Round: 1 TID: 0 Sec: 13.37 tps: 897.85</font></div><div><font size="2"   >Round: 2 TID: 0 Sec: 11.72 tps: 1023.83</font></div><div><font size="2"   >Round: 3 TID: 0 Sec: 11.89 tps: 1009.26</font></div><div><font size="2"   >Round: 4 TID: 0 Sec: 11.82 tps: 1015.2</font></div><div><font size="2"   >Round: 5 TID: 0 Sec: 11.84 tps: 1013.37</font></div><div><font size="2"   >Round: 6 TID: 0 Sec: 11.91 tps: 1007.87</font></div><div><font size="2"   >Round: 7 TID: 0 Sec: 11.97 tps: 1002.33</font></div><div><font size="2"   >Round: 8 TID: 0 Sec: 11.96 tps: 1003.0</font></div><div><font size="2"   >Round: 9 TID: 0 Sec: 11.92 tps: 1007.11</font></div><div><font size="2"   >Round: 10 TID: 0 Sec: 11.75 tps: 1020.97</font></div><div><font size="2"   >Round: 11 TID: 0 Sec: 11.75 tps: 1021.17</font></div><div><font size="2"   >Round: 12 TID: 0 Sec: 11.95 tps: 1004.07</font></div><div><font size="2"   >Round: 13 TID: 0 Sec: 11.81 tps: 1015.96</font></div></div><div><font size="2"   >......</font></div><p></p></pre></div><div>合并结果：</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >36637.71</font></div><div><font size="2"   >36436.34</font></div><div><font size="2"   >36512.47</font></div><div><font size="2"   >36614.69</font></div><div><font size="2"   >36585.26</font></div><div><font size="2"   >36553.55</font></div><div><font size="2"   >36578.89</font></div><div><font size="2"   >36540.29</font></div><div><font size="2"   >36483.53</font></div><div><font size="2"   >36594.29</font></div><div><font size="2"   >36438.53</font></div><div><font size="2"   >36518.64</font></div><div><font size="2"   >36480.38</font></div></div><div><font size="2"   >......</font></div><p></p></pre></div><div>图：</div><div><div><img title="PostgreSQL VS Oracle - 2 OLTP update/select based primary key  insert - 德哥@Digoal - PostgreSQL research"   alt="PostgreSQL VS Oracle - 2 OLTP update/select based primary key  insert - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/gCd8LFWn1pJEuXrEQ6grSg==/6608833441562599399.png"   ></div></div><div><br></div><div>插入(20 conn)测试：</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >SQL&gt; truncate table digoal.tbl;</font></div><div><font size="2"   >SQL&gt; create sequence digoal.seq cache 12000;</font></div></div><div><div><font size="2"   >SQL&gt; alter table digoal.tbl modify crt_time default sysdate;</font></div><div><font size="2"   >SQL&gt; alter table digoal.tbl modify info default sysdate;</font></div></div><div><font size="2"   >SQL&gt; alter table digoal.tbl storage (buffer_pool default);<br>SQL&gt; alter index digoal.tbl_pkey storage (buffer_pool default);<br></font></div><p></p></pre></div><div><div>测试脚本：</div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi test.py</font></div><div><font size="2"   >import threading</font></div><div><font size="2"   >import time</font></div><div><font size="2"   >import cx_Oracle</font></div><div><font size="2"   >import random</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >dsn=cx_Oracle.makedsn('127.0.0.1', 1521, 'oradb')</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >xs=12000</font></div><div><font size="2"   >tps=dict()</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >class n_t(threading.Thread): &nbsp; # The timer class is derived from the class threading.Thread</font></div><div><font size="2"   >&nbsp; def __init__(self, num):</font></div><div><font size="2"   >&nbsp; &nbsp; threading.Thread.__init__(self)</font></div><div><font size="2"   >&nbsp; &nbsp; self.thread_num = num</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; def run(self): #Overwrite run() method, put what you want the thread do here</font></div><div><font size="2"   >&nbsp; &nbsp; db=cx_Oracle.connect('digoal','digoal',dsn)</font></div><div><font size="2"   >&nbsp; &nbsp; db.autocommit=1</font></div><div><font size="2"   >&nbsp; &nbsp; cur=db.cursor()</font></div><div><font size="2"   >&nbsp; &nbsp; pre=cur.prepare('insert /*SQL' + str(self.thread_num) +'*/ into tbl (id) values(seq.nextval)')</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; tps[self.thread_num] = dict()</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; f = open("/tmp/oracle_test." + str(self.thread_num), "w")</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; for x in range(1,3001):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; start_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; for i in range(0,xs):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; cur.execute(pre) &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; stop_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; tps[self.thread_num][x] = round(xs/(stop_t-start_t),2)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; res = "Round: " + str(x) + " TID: " + str(self.thread_num) + " Sec: " + str(round((stop_t-start_t),2)) + " tps: " + str(tps[self.thread_num][x])</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; print &gt;&gt; f, res</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; f.flush()</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; f.close()</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >def test():</font></div><div><font size="2"   >&nbsp; t_names = []</font></div><div><font size="2"   >&nbsp; for i in xrange(0,20):</font></div><div><font size="2"   >&nbsp; &nbsp; t_names.append(n_t(i))</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; for t in t_names:</font></div><div><font size="2"   >&nbsp; &nbsp; t.start()</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; return</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if __name__ == '__main__':</font></div><div><font size="2"   >&nbsp; test()</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >测试结果：</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># less oracle_test.19</font></div><div><font size="2"   >Round: 1 TID: 19 Sec: 22.98 tps: 522.25</font></div><div><font size="2"   >Round: 2 TID: 19 Sec: 27.12 tps: 442.54</font></div><div><font size="2"   >Round: 3 TID: 19 Sec: 23.8 tps: 504.2</font></div><div><font size="2"   >Round: 4 TID: 19 Sec: 26.47 tps: 453.35</font></div><div><font size="2"   >Round: 5 TID: 19 Sec: 23.63 tps: 507.83</font></div><div><font size="2"   >Round: 6 TID: 19 Sec: 23.78 tps: 504.72</font></div><div><font size="2"   >Round: 7 TID: 19 Sec: 26.02 tps: 461.13</font></div><div><font size="2"   >Round: 8 TID: 19 Sec: 23.9 tps: 502.02</font></div><div><font size="2"   >Round: 9 TID: 19 Sec: 26.22 tps: 457.67</font></div><div><font size="2"   >Round: 10 TID: 19 Sec: 23.48 tps: 511.14</font></div><div><font size="2"   >Round: 11 TID: 19 Sec: 26.89 tps: 446.31</font></div><div><font size="2"   >Round: 12 TID: 19 Sec: 22.46 tps: 534.37</font></div></div><div><font size="2"   >......</font></div><p></p></pre></div><div>合并结果：</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >10195.18</font></div><div><font size="2"   >8863.84</font></div><div><font size="2"   >10067.91</font></div><div><font size="2"   >9167.06</font></div><div><font size="2"   >9753.85</font></div><div><font size="2"   >10024.51</font></div><div><font size="2"   >9028.92</font></div><div><font size="2"   >10006.42</font></div><div><font size="2"   >8869.49</font></div><div><font size="2"   >10251.39</font></div><div><font size="2"   >9202.53</font></div><div><font size="2"   >10048.2</font></div><div><font size="2"   >10062.34</font></div></div><div><font size="2"   >......</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >图：</span></div><div><div><img title="PostgreSQL VS Oracle - 2 OLTP update/select based primary key  insert - 德哥@Digoal - PostgreSQL research"   alt="PostgreSQL VS Oracle - 2 OLTP update/select based primary key  insert - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/C6VpMDnYSjVoigm6vKcA9Q==/6630910535536760470.png"   ></div></div><div><span style="line-height: 28px;"   >Oracle插入时需先写UNDO,再写redo,所以比较慢.</span></div><div><br></div><div>[其他]</div><div>1. 一开始测试脚本报错，<span style="line-height: 28px;"   >ORA-24550&nbsp;</span><span style="line-height: 28px;"   >KPEDBG_HDL_PUSH_FCPTRMAX。</span></div><div>解决办法 ：&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># cd /opt/oracle/product/12.0.2/db_1/network/admin/</font></div><div><font size="2"   ># cp samples/sqlnet.ora ./</font></div><div><font size="2"   ># vi&nbsp;<span style="line-height: 28px;"   >sqlnet.ora</span></font></div><div><span style="line-height: 28px;"   ><font size="2"   >追加 :&nbsp;</font></span></div><font size="2"   ><wbr></font><div style="line-height: 28px;"   ><font size="2"   >DIAG_ADR_ENABLED=FALSE</font></div><div style="line-height: 28px;"   ><font size="2"   >DIAG_SIGHANDLER_ENABLED=FALSE</font></div><div style="line-height: 28px;"   ><font size="2"   >DIAG_DDE_ENABLED=FALSE</font></div><p></p></pre></div><div style="line-height: 28px;"   >2. 测试时遇到过大量的CURSOR pin S的等待事件，通过添加注释，改写SQL解决。</div><div style="line-height: 28px;"   >例如：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp; pre=cur.prepare('insert /*SQL' + str(self.thread_num) +'*/ into tbl (id) values(seq.nextval)')</font></div><div></div><p></p></pre></div><div style="line-height: 28px;"   >[参考]</div><div style="line-height: 28px;"   >1.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201541104656600/"   >http://blog.163.com/digoal@126/blog/static/163877040201541104656600/</a></div><div style="line-height: 28px;"   ><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL VS Oracle - 2 OLTP update/select based primary key  insert - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>