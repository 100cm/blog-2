<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL Developer Options (debug, trace, system table mod and so on...)</h2>
	<h5 id="">2013-01-28 17:30:23&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201302843359574/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 提供了一些开发参数, 一般在生产库中不推荐使用。主要用于调试环境。</div><div>同时有些参数是否支持, 是需要在编译PostgreSQL软件指定的。</div><div>所有的开发参数如下 :&nbsp;</div><div><div>Developer Options</div><div>The following parameters are intended for work on the PostgreSQL source code, and in some cases to assist with recovery of severely damaged databases. There should be no reason to use them on a production database. As such, they have been excluded from the sample postgresql.conf file. Note that many of these parameters require special source compilation flags to work at all.</div><div><br></div><div>1. allow_system_table_mods (boolean)</div><div>Allows modification of the structure of system tables. This is used by initdb. This parameter can only be set at server start.</div><div>在数据库启动前调整, 一般被用于initdb. 当然你如果想修改系统表的表结构, 也可以通过打开这个参数后来调整.</div><div>涉及代码 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >src/include/catalog/heap.h</font></div><div><font size="2"   >src/include/catalog/index.h</font></div><div><font size="2"   >src/backend/catalog/index.c</font></div><div><font size="2"   >src/backend/catalog/heap.c</font></div><div><font size="2"   >src/backend/utils/misc/guc.c</font></div><div><font size="2"   >src/backend/postmaster/postmaster.c</font></div><div><font size="2"   >src/backend/tcop/postgres.c</font></div><p></p></pre></div><div>创建索引, 约束, 表时如果定义了allow_system_table_mods, 这个表允许放到系统schema(namespace)中, 并且这个表的更改需要打开<span style="line-height: 22px;"   >allow_system_table_mods参数.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* index_create</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* heapRelation: table to build index on (suitably locked by caller)</font></div><div><font size="2"   >&nbsp;* indexRelationName: what it say</font></div><div><font size="2"   >&nbsp;* indexRelationId: normally, pass InvalidOid to let this routine</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;generate an OID for the index. &nbsp;During bootstrap this may be</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nonzero to specify a preselected OID.</font></div><div><font size="2"   >&nbsp;* relFileNode: normally, pass InvalidOid to get new storage. &nbsp;May be</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nonzero to attach an existing valid build.</font></div><div><font size="2"   >&nbsp;* indexInfo: same info executor uses to insert into the index</font></div><div><font size="2"   >&nbsp;* indexColNames: column names to use for index (List of char *)</font></div><div><font size="2"   >&nbsp;* accessMethodObjectId: OID of index AM to use</font></div><div><font size="2"   >&nbsp;* tableSpaceId: OID of tablespace to use</font></div><div><font size="2"   >&nbsp;* collationObjectId: array of collation OIDs, one per index column</font></div><div><font size="2"   >&nbsp;* classObjectId: array of index opclass OIDs, one per index column</font></div><div><font size="2"   >&nbsp;* coloptions: array of per-index-column indoption settings</font></div><div><font size="2"   >&nbsp;* reloptions: AM-specific options</font></div><div><font size="2"   >&nbsp;* isprimary: index is a PRIMARY KEY</font></div><div><font size="2"   >&nbsp;* isconstraint: index is owned by PRIMARY KEY, UNIQUE, or EXCLUSION constraint</font></div><div><font size="2"   >&nbsp;* deferrable: constraint is DEFERRABLE</font></div><div><font size="2"   >&nbsp;* initdeferred: constraint is INITIALLY DEFERRED</font></div><div><font size="2"   >&nbsp;* allow_system_table_mods: allow table to be a system catalog</font></div><div><font size="2"   >&nbsp;* skip_build: true to skip the index_build() step for the moment; caller</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;must do it later (typically via reindex_index())</font></div><div><font size="2"   >&nbsp;* concurrent: if true, do not lock the table against writers. &nbsp;The index</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;will be marked "invalid" and the caller must take additional steps</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to fix it up.</font></div><div><font size="2"   >&nbsp;* is_internal: if true, post creation hook for new index</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Returns the OID of the created index.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >Oid</font></div><div><font size="2"   >index_create(Relation heapRelation,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const char *indexRelationName,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid indexRelationId,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid relFileNode,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IndexInfo *indexInfo,</font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List *indexColNames,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid accessMethodObjectId,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid tableSpaceId,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid *collationObjectId,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid *classObjectId,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int16 *coloptions,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Datum reloptions,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool isprimary,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool isconstraint,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool deferrable,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool initdeferred,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool allow_system_table_mods,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool skip_build,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool concurrent,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool is_internal)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* index_constraint_create</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Set up a constraint associated with an index</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* heapRelation: table owning the index (must be suitably locked by caller)</font></div><div><font size="2"   >&nbsp;* indexRelationId: OID of the index</font></div><div><font size="2"   >&nbsp;* indexInfo: same info executor uses to insert into the index</font></div><div><font size="2"   >&nbsp;* constraintName: what it say (generally, should match name of index)</font></div><div><font size="2"   >&nbsp;* constraintType: one of CONSTRAINT_PRIMARY, CONSTRAINT_UNIQUE, or</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CONSTRAINT_EXCLUSION</font></div><div><font size="2"   >&nbsp;* deferrable: constraint is DEFERRABLE</font></div><div><font size="2"   >&nbsp;* initdeferred: constraint is INITIALLY DEFERRED</font></div><div><font size="2"   >&nbsp;* mark_as_primary: if true, set flags to mark index as primary key</font></div><div><font size="2"   >&nbsp;* update_pgindex: if true, update pg_index row (else caller's done that)</font></div><div><font size="2"   >&nbsp;* remove_old_dependencies: if true, remove existing dependencies of index</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;on table's columns</font></div><div><font size="2"   >&nbsp;* allow_system_table_mods: allow table to be a system catalog</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >void</font></div><div><font size="2"   >index_constraint_create(Relation heapRelation,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Oid indexRelationId,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IndexInfo *indexInfo,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const char *constraintName,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; char constraintType,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bool deferrable,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bool initdeferred,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bool mark_as_primary,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bool update_pgindex,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bool remove_old_dependencies,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bool allow_system_table_mods)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >/* --------------------------------</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;heap_create_with_catalog</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;creates a new cataloged relation. &nbsp;see comments above.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Arguments:</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;relname: name to give to new rel</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;relnamespace: OID of namespace it goes in</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;reltablespace: OID of tablespace it goes in</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;relid: OID to assign to new rel, or InvalidOid to select a new OID</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;reltypeid: OID to assign to rel's rowtype, or InvalidOid to select one</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;reloftypeid: if a typed table, OID of underlying type; else InvalidOid</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;ownerid: OID of new rel's owner</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;tupdesc: tuple descriptor (source of column definitions)</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;cooked_constraints: list of precooked check constraints and defaults</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;relkind: relkind for new rel</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;relpersistence: rel's persistence status (permanent, temp, or unlogged)</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;shared_relation: TRUE if it's to be a shared relation</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;mapped_relation: TRUE if the relation will use the relfilenode map</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;oidislocal: TRUE if oid column (if any) should be marked attislocal</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;oidinhcount: attinhcount to assign to oid column (if any)</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;oncommit: ON COMMIT marking (only relevant if it's a temp table)</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;reloptions: reloptions in Datum form, or (Datum) 0 if none</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;use_user_acl: TRUE if should look for user-defined default permissions;</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if FALSE, relacl is always set NULL</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;allow_system_table_mods: TRUE to allow creation in system namespaces</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Returns the OID of the new relation</font></div><div><font size="2"   >&nbsp;* --------------------------------</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >Oid</font></div><div><font size="2"   >heap_create_with_catalog(const char *relname,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid relnamespace,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid reltablespace,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid relid,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid reltypeid,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid reloftypeid,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Oid ownerid,</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TupleDesc tupdesc,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List *cooked_constraints,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;char relkind,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;char relpersistence,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool shared_relation,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool mapped_relation,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool oidislocal,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int oidinhcount,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OnCommitAction oncommit,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Datum reloptions,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool use_user_acl,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool allow_system_table_mods,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool is_internal)</font></div></div><p></p></pre></div><div><br></div><div>2. debug_assertions (boolean)</div><div>Turns on various assertion checks. This is a debugging aid. If you are experiencing strange problems or crashes you might want to turn this on, as it might expose programming mistakes. To use this parameter, the macro USE_ASSERT_CHECKING must be defined when PostgreSQL is built (accomplished by the configure option --enable-cassert). Note that debug_assertions defaults to on if PostgreSQL has been built with assertions enabled.</div><div>如果编译数据库软件时含<span style="line-height: 22px;"   >--enable-cassert选项, 则这个参数有意义.</span></div><div><br></div><div>3. ignore_system_indexes (boolean)</div><div>Ignore system indexes when reading system tables (but still update the indexes when modifying the tables). This is useful when recovering from damaged system indexes. This parameter cannot be changed after session start.</div><div>当系统表的索引异常时使用, 跳过索引扫描.&nbsp;</div><div><br></div><div>4. post_auth_delay (integer)</div><div>If nonzero, a delay of this many seconds occurs when a new server process is started, after it conducts the authentication procedure. This is intended to give developers an opportunity to attach to the server process with a debugger. This parameter cannot be changed after session start.</div><div><br></div><div>5. pre_auth_delay (integer)</div><div>If nonzero, a delay of this many seconds occurs just after a new server process is forked, before it conducts the authentication procedure. This is intended to give developers an opportunity to attach to the server process with a debugger to trace down misbehavior in authentication. This parameter can only be set in the postgresql.conf file or on the server command line.</div><div><br></div><div>6. trace_notify (boolean)</div><div>Generates a great amount of debugging output for the LISTEN and NOTIFY commands. client_min_messages or log_min_messages must be DEBUG1 or lower to send this output to the client or server logs, respectively.</div><div><br></div><div>7. trace_recovery_messages (enum)</div><div>Enables logging of recovery-related debugging output that otherwise would not be logged. This parameter allows the user to override the normal setting of log_min_messages, but only for specific messages. This is intended for use in debugging Hot Standby. Valid values are DEBUG5, DEBUG4, DEBUG3, DEBUG2, DEBUG1, and LOG. The default, LOG, does not affect logging decisions at all. The other values cause recovery-related debug messages of that priority or higher to be logged as though they had LOG priority; for common settings of log_min_messages this results in unconditionally sending them to the server log. This parameter can only be set in the postgresql.conf file or on the server command line.</div><div><br></div><div>8. trace_sort (boolean)</div><div>If on, emit information about resource usage during sort operations. This parameter is only available if the TRACE_SORT macro was defined when PostgreSQL was compiled. (However, TRACE_SORT is currently defined by default.)</div><div>编译时需要定义TRACE_SORT宏, 默认已经定义了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >src/include/pg_config_manual.h</font></div><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* Enable tracing of resource consumption during sort operations;</font></div><div><font size="2"   >&nbsp;* see also the trace_sort GUC var. &nbsp;For 8.1 this is enabled by default.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >#define TRACE_SORT 1</font></div></div><p></p></pre></div><div><br></div><div>9. trace_locks (boolean)</div><div>If on, emit information about lock usage. Information dumped includes the type of lock operation, the type of lock and the unique identifier of the object being locked or unlocked. Also included are bit masks for the lock types already granted on this object as well as for the lock types awaited on this object. For each lock type a count of the number of granted locks and waiting locks is also dumped as well as the totals. An example of the log file output is shown here:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >LOG: &nbsp;LockAcquire: new: lock(0xb7acd844) id(24688,24696,0,0,0,1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; grantMask(0) req(0,0,0,0,0,0,0)=0 grant(0,0,0,0,0,0,0)=0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; wait(0) type(AccessShareLock)</font></div><div><font size="2"   >LOG: &nbsp;GrantLock: lock(0xb7acd844) id(24688,24696,0,0,0,1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; grantMask(2) req(1,0,0,0,0,0,0)=1 grant(1,0,0,0,0,0,0)=1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; wait(0) type(AccessShareLock)</font></div><div><font size="2"   >LOG: &nbsp;UnGrantLock: updated: lock(0xb7acd844) id(24688,24696,0,0,0,1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; grantMask(0) req(0,0,0,0,0,0,0)=0 grant(0,0,0,0,0,0,0)=0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; wait(0) type(AccessShareLock)</font></div><div><font size="2"   >LOG: &nbsp;CleanUpLock: deleting: lock(0xb7acd844) id(24688,24696,0,0,0,1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; grantMask(0) req(0,0,0,0,0,0,0)=0 grant(0,0,0,0,0,0,0)=0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; wait(0) type(INVALID)</font></div><div><font size="2"   >Details of the structure being dumped may be found in src/include/storage/lock.h.</font></div></pre></div><div>This parameter is only available if the LOCK_DEBUG macro was defined when PostgreSQL was compiled.</div><div><span style="line-height: 22px;"   >编译时需要定义</span><span style="line-height: 22px;"   >LOCK_DEBUG</span><span style="line-height: 22px;"   >宏, 默认未定义, 修改如下文件, 解除/* #define LOCK_DEBUG */的注释.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >src/include/pg_config_manual.h</font></div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* Enable debugging print statements for lock-related operations.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >#define LOCK_DEBUG</font></div><p></p></pre></div><div>或者定义在src/Makefile.custom中 :&nbsp;</div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >pgdev@db-172-16-3-150-&gt; cat Makefile.custom&nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >CFLAGS+=-DLOCK_DEBUG</font></div><div style="line-height: 22px;"   ><font size="2"   >CFLAGS+=-DBTREE_BUILD_STATS</font></div><div style="line-height: 22px;"   ><font size="2"   >CFLAGS+=-DWAL_DEBUG</font></div><p></p></pre></div></div><div><br></div><div>10. trace_lwlocks (boolean)</div><div>If on, emit information about lightweight lock usage. Lightweight locks are intended primarily to provide mutual exclusion of access to shared-memory data structures.</div><div>This parameter is only available if the LOCK_DEBUG macro was defined when PostgreSQL was compiled.</div><div><span style="line-height: 22px;"   >同上编译时需要定义</span><span style="line-height: 22px;"   >LOCK_DEBUG</span><span style="line-height: 22px;"   >宏, 默认未定义.</span></div><div><span style="line-height: 22px;"   ><br></span></div><div>11. trace_userlocks (boolean)</div><div>If on, emit information about user lock usage. Output is the same as for trace_locks, only for advisory locks.</div><div><span style="line-height: 22px;"   >This parameter is only available if the LOCK_DEBUG macro was defined when PostgreSQL was compiled.</span></div><div><span style="line-height: 22px;"   >同上编译时需要定义</span><span style="line-height: 22px;"   >LOCK_DEBUG</span><span style="line-height: 22px;"   >宏, 默认未定义.</span></div><div><span style="line-height: 22px;"   ><br></span></div><div>12. trace_lock_oidmin (integer)</div><div>If set, do not trace locks for tables below this OID. (use to avoid output on system tables)</div><div><span style="line-height: 22px;"   >This parameter is only available if the LOCK_DEBUG macro was defined when PostgreSQL was compiled.</span></div><div><br></div><div>13. trace_lock_table (integer)</div><div>Unconditionally trace locks on this table (OID).</div><div><span style="line-height: 22px;"   >This parameter is only available if the LOCK_DEBUG macro was defined when PostgreSQL was compiled.</span></div><div><span style="line-height: 22px;"   >同上编译时需要定义</span><span style="line-height: 22px;"   >LOCK_DEBUG</span><span style="line-height: 22px;"   >宏, 默认未定义.</span></div><div><span style="line-height: 22px;"   ><br></span></div><div>14. debug_deadlocks (boolean)</div><div>If set, dumps information about all current locks when a deadlock timeout occurs.</div><div><span style="line-height: 22px;"   >This parameter is only available if the LOCK_DEBUG macro was defined when PostgreSQL was compiled.</span></div><div><span style="line-height: 22px;"   >同上编译时需要定义</span><span style="line-height: 22px;"   >LOCK_DEBUG</span><span style="line-height: 22px;"   >宏, 默认未定义.</span></div><div><span style="line-height: 22px;"   ><br></span></div><div>15. log_btree_build_stats (boolean)</div><div>If set, logs system resource usage statistics (memory and CPU) on various B-tree operations.</div><div><span style="line-height: 22px;"   >This parameter is only available if the BTREE_BUILD_STATS macro was defined when PostgreSQL was compiled.</span></div><div><span style="line-height: 22px;"   >编译时需要定义</span><span style="line-height: 22px;"   >BTREE_BUILD_STATS</span><span style="line-height: 22px;"   >宏, 默认未定义.</span></div><div><span style="line-height: 22px;"   >这个可以定义在src/Makefile.custom中 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pgdev@db-172-16-3-150-&gt; cat Makefile.custom&nbsp;</font></div><div><font size="2"   >CFLAGS+=-DLOCK_DEBUG</font></div><div><font size="2"   >CFLAGS+=-DBTREE_BUILD_STATS</font></div><div><font size="2"   >CFLAGS+=-DWAL_DEBUG</font></div><p></p></pre></div><div>使用如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# set log_btree_build_stats =on;</font></div><div><font size="2"   >SET</font></div><p></p></pre></div><div><br></div><div>16. wal_debug (boolean)</div><div>If on, emit WAL-related debugging output. This parameter is only available if the WAL_DEBUG macro was defined when PostgreSQL was compiled.</div><div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   >编译时需要定义</span><span style="line-height: 22px;"   >WAL_DEBUG</span><span style="line-height: 22px;"   >宏, 默认未定义, 修改如下文件, 解除/* #define WAL_DEBUG */的注释.</span></div><div><pre class="prettyprint"   ><p style="line-height: 22px;"   ></p><div style="line-height: 22px;"   ><font size="2"   style="line-height: 19px;"   >src/include/pg_config_manual.h</font></div><div><font size="2"   ><span style="line-height: 19px;"   >/*<br> * Enable debugging print statements for WAL-related operations; see<br> * also the wal_debug GUC var.<br> */<br>#define WAL_DEBUG</span></font></div><p style="line-height: 22px;"   ></p></pre></div><div style="line-height: 22px;"   >或者定义在src/Makefile.custom中 :&nbsp;</div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >pgdev@db-172-16-3-150-&gt; cat Makefile.custom&nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >CFLAGS+=-DLOCK_DEBUG</font></div><div style="line-height: 22px;"   ><font size="2"   >CFLAGS+=-DBTREE_BUILD_STATS</font></div><div style="line-height: 22px;"   ><font size="2"   >CFLAGS+=-DWAL_DEBUG</font></div><p></p></pre></div></div></div><div><br></div><div>17. zero_damaged_pages (boolean)</div><div>Detection of a damaged page header normally causes PostgreSQL to report an error, aborting the current transaction. Setting zero_damaged_pages to on causes the system to instead report a warning, zero out the damaged page in memory, and continue processing. This behavior will destroy data, namely all the rows on the damaged page. However, it does allow you to get past the error and retrieve rows from any undamaged pages that might be present in the table. It is useful for recovering data if corruption has occurred due to a hardware or software error. You should generally not set this on until you have given up hope of recovering data from the damaged pages of a table. Zeroed-out pages are not forced to disk so it is recommended to recreate the table or the index before turning this parameter off again. The default setting is off, and it can only be changed by a superuser.</div></div><div>在读取磁盘中的数据块信息时, 如果遇到头信息错误的块, 默认情况下将报错.</div><div>打开这个参数后, 这些块将以0输出, 跳过从磁盘读取.&nbsp;</div><div>因为PostgreSQL的row信息不会跨数据块存储, 所以使用<span style="line-height: 22px;"   >zero_damaged_pages后, 即使有些数据块不能正常使用, 也能取到剩余的数据。</span></div><div><span style="line-height: 22px;"   >索引的错误直接重建索引即可.</span></div><div><br></div><div>【编译举例】</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >pgdev@db-172-16-3-150-&gt; cd postgresql-9.3devel/</font></div><div><font size="2"   >pgdev@db-172-16-3-150-&gt; cd src/</font></div></div><div><font size="2"   >pgdev@db-172-16-3-150-&gt; vi Makefile.custom</font></div><div><div><font size="2"   >CFLAGS+=-DLOCK_DEBUG</font></div><div><font size="2"   >CFLAGS+=-DBTREE_BUILD_STATS</font></div><div><font size="2"   >CFLAGS+=-DWAL_DEBUG</font></div></div><div><font size="2"   >su - root</font></div><div><span style="line-height: 22px;"   ><font size="2"   >pgdev@db-172-16-3-150-&gt; cd postgresql-9.3devel/</font></span></div><div><font size="2"   >./configure --prefix=/home/pgdev/pgsql9.3 --with-pgport=9300 --with-perl --with-python --with-tcl --with-openssl --with-pam --without-ldap --with-libxml --with-libxslt --enable-thread-safety --enable-cassert --with-wal-blocksize=16 --enable-debug &amp;&amp; gmake world</font></div><div><font size="2"   >gmake install-world</font></div><p></p></pre></div><div><br></div><div>【注意】</div><div>1. 跟踪和debug的参数, 如果要在当前会话看到效果, 一般建议修改以下 :&nbsp;</div><div>VERBOSITY verbose 用于输出代码位置.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# set client_min_messages=DEBUG1; -- (DEBUG1直到DEBUG5)</font></div><div><font size="2"   >SET</font></div></div><div><font size="2"   >digoal=# \set VERBOSITY verbose</font></div><p></p></pre></div><div><br></div>【参考】<wbr><div>1.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/runtime-config-developer.html"   >http://www.postgresql.org/docs/9.2/static/runtime-config-developer.html</a></div><div>2.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://wiki.postgresql.org/wiki/Developer_FAQ"   >http://wiki.postgresql.org/wiki/Developer_FAQ</a></div><div>3. src/Makefile.global</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >##########################################################################</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># Customization</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># This includes your local customizations if Makefile.custom exists</font></div><div><font size="2"   ># in the source directory. &nbsp;This file doesn't exist in the original</font></div><div><font size="2"   ># distribution so that it doesn't get overwritten when you upgrade.</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># NOTE: &nbsp;Makefile.custom is from the pre-Autoconf days of PostgreSQL.</font></div><div><font size="2"   ># You are liable to shoot yourself in the foot if you use it without</font></div><div><font size="2"   ># knowing exactly what you're doing. &nbsp;The preferred (and more</font></div><div><font size="2"   ># reliable) method is to communicate what you want to do to the</font></div><div><font size="2"   ># configure script, and leave the makefiles alone.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >-include $(top_srcdir)/src/Makefile.custom</font></div><p></p></pre></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL Developer Options (debug, trace, system table mod and so on...) - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>