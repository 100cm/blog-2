<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL oid alias</h2>
	<h5 id="">2013-01-16 15:43:41&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201301632731429/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 系统表中很多都用到了oid进行关联, 例如 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# \d pg_class</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; Table "pg_catalog.pg_class"</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp;Column &nbsp; &nbsp; | &nbsp; Type &nbsp; &nbsp;| Modifiers&nbsp;</font></div><div><font size="2"  >----------------+-----------+-----------</font></div><div><font size="2"  >&nbsp;relname &nbsp; &nbsp; &nbsp; &nbsp;| name &nbsp; &nbsp; &nbsp;| not null</font></div><div><font size="2"  >&nbsp;relnamespace &nbsp; | oid &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"  >&nbsp;reltype &nbsp; &nbsp; &nbsp; &nbsp;| oid &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"  >&nbsp;reloftype &nbsp; &nbsp; &nbsp;| oid &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relowner &nbsp; &nbsp; &nbsp; | oid &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relam &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| oid &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relfilenode &nbsp; &nbsp;| oid &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"  >&nbsp;reltablespace &nbsp;| oid &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relpages &nbsp; &nbsp; &nbsp; | integer &nbsp; | not null</font></div><div><font size="2"  >&nbsp;reltuples &nbsp; &nbsp; &nbsp;| real &nbsp; &nbsp; &nbsp;| not null</font></div><div><font size="2"  >&nbsp;relallvisible &nbsp;| integer &nbsp; | not null</font></div><div><font size="2"  >&nbsp;reltoastrelid &nbsp;| oid &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"  >&nbsp;reltoastidxid &nbsp;| oid &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relhasindex &nbsp; &nbsp;| boolean &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relisshared &nbsp; &nbsp;| boolean &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relpersistence | "char" &nbsp; &nbsp;| not null</font></div><div><font size="2"  >&nbsp;relkind &nbsp; &nbsp; &nbsp; &nbsp;| "char" &nbsp; &nbsp;| not null</font></div><div><font size="2"  >&nbsp;relnatts &nbsp; &nbsp; &nbsp; | smallint &nbsp;| not null</font></div><div><font size="2"  >&nbsp;relchecks &nbsp; &nbsp; &nbsp;| smallint &nbsp;| not null</font></div><div><font size="2"  >&nbsp;relhasoids &nbsp; &nbsp; | boolean &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relhaspkey &nbsp; &nbsp; | boolean &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relhasrules &nbsp; &nbsp;| boolean &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relhastriggers | boolean &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relhassubclass | boolean &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relfrozenxid &nbsp; | xid &nbsp; &nbsp; &nbsp; | not null</font></div><div><font size="2"  >&nbsp;relacl &nbsp; &nbsp; &nbsp; &nbsp; | aclitem[] |&nbsp;</font></div><div><font size="2"  >&nbsp;reloptions &nbsp; &nbsp; | text[] &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"  >Indexes:</font></div><div><font size="2"  >&nbsp; &nbsp; "pg_class_oid_index" UNIQUE, btree (oid)</font></div><div><font size="2"  >&nbsp; &nbsp; "pg_class_relname_nsp_index" UNIQUE, btree (relname, relnamespace)</font></div><p></p></pre></div><div>pgclass.<span style="line-height: 22px;"  >reltype 对应的是pg_type.oid.</span></div><div><span style="line-height: 22px;"  >如果想得到typname一般的做法是关联查询.</span></div><div><span style="line-height: 22px;"  >例如 :&nbsp;</span></div><div><span style="line-height: 22px;"  ><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# select a.rolname,b.relname from pg_class b,pg_roles a where b.relowner=a.oid and b.relname='t';</font></div><div><font size="2"  >&nbsp;rolname &nbsp;| relname&nbsp;</font></div><div><font size="2"  >----------+---------</font></div><div><font size="2"  >&nbsp;postgres | t</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div><br></div><div>但是表多的情况下, 关联非常多, 太繁琐了.</div><div>好在PostgreSQL提供了oid类型的别名.</div><div>这些别名以reg开头.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# select typname from pg_type where typname ~ '^reg';</font></div><div><font size="2"  >&nbsp; &nbsp; typname &nbsp; &nbsp;</font></div><div><font size="2"  >---------------</font></div><div><font size="2"  >&nbsp;regclass</font></div><div><font size="2"  >&nbsp;regconfig</font></div><div><font size="2"  >&nbsp;regdictionary</font></div><div><font size="2"  >&nbsp;regoper</font></div><div><font size="2"  >&nbsp;regoperator</font></div><div><font size="2"  >&nbsp;regproc</font></div><div><font size="2"  >&nbsp;regprocedure</font></div><div><font size="2"  >&nbsp;regtype</font></div><div><font size="2"  >(8 rows)</font></div><p></p></pre></div><div><br></div><div>oid和这些类型可以相互转化 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# select castsource::regtype,casttarget::regtype,castfunc::regproc from pg_cast where casttarget in (select oid from pg_type where typname ~ '^reg') and castfunc=0 order by casttarget,castsource;</font></div><div><font size="2"  >&nbsp; castsource &nbsp;| &nbsp;casttarget &nbsp; | castfunc&nbsp;</font></div><div><font size="2"  >--------------+---------------+----------</font></div><div><font size="2"  >&nbsp;integer &nbsp; &nbsp; &nbsp;| regproc &nbsp; &nbsp; &nbsp; | -</font></div><div><font size="2"  >&nbsp;oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| regproc &nbsp; &nbsp; &nbsp; | -</font></div><div><font size="2"  >&nbsp;regprocedure | regproc &nbsp; &nbsp; &nbsp; | -</font></div><div><font size="2"  >&nbsp;integer &nbsp; &nbsp; &nbsp;| regprocedure &nbsp;| -</font></div><div><font size="2"  >&nbsp;regproc &nbsp; &nbsp; &nbsp;| regprocedure &nbsp;| -</font></div><div><font size="2"  >&nbsp;oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| regprocedure &nbsp;| -</font></div><div><font size="2"  >&nbsp;integer &nbsp; &nbsp; &nbsp;| regoper &nbsp; &nbsp; &nbsp; | -</font></div><div><font size="2"  >&nbsp;oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| regoper &nbsp; &nbsp; &nbsp; | -</font></div><div><font size="2"  >&nbsp;regoperator &nbsp;| regoper &nbsp; &nbsp; &nbsp; | -</font></div><div><font size="2"  >&nbsp;integer &nbsp; &nbsp; &nbsp;| regoperator &nbsp; | -</font></div><div><font size="2"  >&nbsp;oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| regoperator &nbsp; | -</font></div><div><font size="2"  >&nbsp;regoper &nbsp; &nbsp; &nbsp;| regoperator &nbsp; | -</font></div><div><font size="2"  >&nbsp;integer &nbsp; &nbsp; &nbsp;| regclass &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >&nbsp;oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| regclass &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >&nbsp;integer &nbsp; &nbsp; &nbsp;| regtype &nbsp; &nbsp; &nbsp; | -</font></div><div><font size="2"  >&nbsp;oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| regtype &nbsp; &nbsp; &nbsp; | -</font></div><div><font size="2"  >&nbsp;integer &nbsp; &nbsp; &nbsp;| regconfig &nbsp; &nbsp; | -</font></div><div><font size="2"  >&nbsp;oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| regconfig &nbsp; &nbsp; | -</font></div><div><font size="2"  >&nbsp;integer &nbsp; &nbsp; &nbsp;| regdictionary | -</font></div><div><font size="2"  >&nbsp;oid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| regdictionary | -</font></div><div><font size="2"  >(20 rows)</font></div><p></p></pre></div><div>oid类型以及int类型转换成这些别名是不需要转化函数的, 所以称之为别名.</div><div><br></div><div>反过来 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# select castsource::regtype,casttarget::regtype,castfunc::regproc from pg_cast where casttarget in (select oid from pg_type where typname ='oid') and castfunc=0 order by casttarget,castsource;</font></div><div><font size="2"  >&nbsp; castsource &nbsp; | casttarget | castfunc&nbsp;</font></div><div><font size="2"  >---------------+------------+----------</font></div><div><font size="2"  >&nbsp;integer &nbsp; &nbsp; &nbsp; | oid &nbsp; &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >&nbsp;regproc &nbsp; &nbsp; &nbsp; | oid &nbsp; &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >&nbsp;regprocedure &nbsp;| oid &nbsp; &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >&nbsp;regoper &nbsp; &nbsp; &nbsp; | oid &nbsp; &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >&nbsp;regoperator &nbsp; | oid &nbsp; &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >&nbsp;regclass &nbsp; &nbsp; &nbsp;| oid &nbsp; &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >&nbsp;regtype &nbsp; &nbsp; &nbsp; | oid &nbsp; &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >&nbsp;regconfig &nbsp; &nbsp; | oid &nbsp; &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >&nbsp;regdictionary | oid &nbsp; &nbsp; &nbsp; &nbsp;| -</font></div><div><font size="2"  >(9 rows)</font></div><p></p></pre></div><div>int类型以及这些别名转化为oid也是不需要函数的.</div><div><br></div><div>举例 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# select attrelid, attrelid::regclass, attname, atttypid::regtype from pg_attribute where attrelid::regclass='t'::regclass;&nbsp;</font></div><div><font size="2"  >&nbsp;attrelid | attrelid | attname &nbsp;| atttypid&nbsp;</font></div><div><font size="2"  >----------+----------+----------+----------</font></div><div><font size="2"  >&nbsp; &nbsp;209175 | t &nbsp; &nbsp; &nbsp; &nbsp;| tableoid | oid</font></div><div><font size="2"  >&nbsp; &nbsp;209175 | t &nbsp; &nbsp; &nbsp; &nbsp;| cmax &nbsp; &nbsp; | cid</font></div><div><font size="2"  >&nbsp; &nbsp;209175 | t &nbsp; &nbsp; &nbsp; &nbsp;| xmax &nbsp; &nbsp; | xid</font></div><div><font size="2"  >&nbsp; &nbsp;209175 | t &nbsp; &nbsp; &nbsp; &nbsp;| cmin &nbsp; &nbsp; | cid</font></div><div><font size="2"  >&nbsp; &nbsp;209175 | t &nbsp; &nbsp; &nbsp; &nbsp;| xmin &nbsp; &nbsp; | xid</font></div><div><font size="2"  >&nbsp; &nbsp;209175 | t &nbsp; &nbsp; &nbsp; &nbsp;| ctid &nbsp; &nbsp; | tid</font></div><div><font size="2"  >&nbsp; &nbsp;209175 | t &nbsp; &nbsp; &nbsp; &nbsp;| info &nbsp; &nbsp; | text</font></div><div><font size="2"  >(7 rows)</font></div><p></p></pre></div><div>这里的attrelid对应的是pg_class.oid, atttypid对应的是pg_type.oid.&nbsp;</div><div>使用regclass, regtype别名, 比关联就方便多了.</div><div><br></div></span></div>【参考】<div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/datatype-oid.html"  >http://www.postgresql.org/docs/9.2/static/datatype-oid.html</a><br><br><wbr></div></div>
	</div>
</div>
</body>
</html>