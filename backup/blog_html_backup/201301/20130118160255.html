<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL Arabic numerals CHINESE SBS case replaced by digit</h2>
	<h5 id="">2013-01-18 16:02:55&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201301835936844/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">中文全角数字和半角数字的转换案例 :&nbsp;<div><pre class="prettyprint"  ><p></p><div><font size="2"  >do language plpgsql $$</font></div><div><font size="2"  >declare</font></div><div><font size="2"  >&nbsp; ts text;</font></div><div><font size="2"  >&nbsp; i text;</font></div><div><font size="2"  >&nbsp; out text;</font></div><div><font size="2"  >&nbsp; tp text;</font></div><div><font size="2"  >begin</font></div><div><font size="2"  >&nbsp; out := '';</font></div><div><font size="2"  >&nbsp; ts := 'ab１２３cd３３３４５d';</font></div><div><font size="2"  >&nbsp; foreach i in array regexp_split_to_array(ts,'') loop</font></div><div><font size="2"  >&nbsp; &nbsp; raise notice '%', i;</font></div><div><font size="2"  >&nbsp; &nbsp; select&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; case i&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '１' then '1'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '２' then '2'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '３' then '3'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '４' then '4'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '５' then '5'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '６' then '6'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '７' then '7'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '８' then '8'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '９' then '9'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '０' then '0'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; else i&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; end&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; into tp;</font></div><div><font size="2"  >&nbsp; &nbsp; out := out||tp;</font></div><div><font size="2"  >&nbsp; end loop;</font></div><div><font size="2"  >&nbsp; raise notice '%', out;</font></div><div><font size="2"  >&nbsp; end;</font></div><div><font size="2"  >$$;</font></div><p></p></pre></div><div>输出 :&nbsp;</div><div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >NOTICE: &nbsp;a</font></div><div><font size="2"  >NOTICE: &nbsp;b</font></div><div><font size="2"  >NOTICE: &nbsp;１</font></div><div><font size="2"  >NOTICE: &nbsp;２</font></div><div><font size="2"  >NOTICE: &nbsp;３</font></div><div><font size="2"  >NOTICE: &nbsp;c</font></div><div><font size="2"  >NOTICE: &nbsp;d</font></div><div><font size="2"  >NOTICE: &nbsp;３</font></div><div><font size="2"  >NOTICE: &nbsp;３</font></div><div><font size="2"  >NOTICE: &nbsp;３</font></div><div><font size="2"  >NOTICE: &nbsp;４</font></div><div><font size="2"  >NOTICE: &nbsp;５</font></div><div><font size="2"  >NOTICE: &nbsp;d</font></div><div><font size="2"  >NOTICE: &nbsp;ab123cd33345d</font></div><div><font size="2"  >DO</font></div></div><div></div><p></p></pre></div></div><div>写成函数 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >create or replace function sbs_to_digit(i_text text) returns text as $$</font></div><div><font size="2"  >declare</font></div><div><font size="2"  >&nbsp; i text;</font></div><div><font size="2"  >&nbsp; out text;</font></div><div><font size="2"  >&nbsp; tp text;</font></div><div><font size="2"  >begin</font></div><div><font size="2"  >&nbsp; out := '';</font></div><div><font size="2"  >&nbsp; foreach i in array regexp_split_to_array(i_text, '') loop</font></div><div><font size="2"  >&nbsp; &nbsp; select&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; case i&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '１' then '1'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '２' then '2'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '３' then '3'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '４' then '4'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '５' then '5'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '６' then '6'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '７' then '7'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '８' then '8'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '９' then '9'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; when '０' then '0'&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; else i&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; end&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; into tp;</font></div><div><font size="2"  >&nbsp; &nbsp; out := out||tp;</font></div><div><font size="2"  >&nbsp; end loop;</font></div><div><font size="2"  >&nbsp; return out;</font></div><div><font size="2"  >&nbsp; end;</font></div><div><font size="2"  >$$ language plpgsql;</font></div><p></p></pre></div><div>如下 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# select sbs_to_digit('你好abc１２３４');</font></div><div><font size="2"  >&nbsp;sbs_to_digit&nbsp;</font></div><div><font size="2"  >--------------</font></div><div><font size="2"  >&nbsp;你好abc1234</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div><span style="line-height: 22px;"  >这种方法可以扩充到任意字符的替换.</span></div><div><div><wbr></div></div></div>
	</div>
</div>
</body>
</html>