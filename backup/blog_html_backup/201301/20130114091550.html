<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.3 Support automatically-updatable views</h2>
	<h5 id="">2013-01-14 9:15:50&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201301483549300/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 9.3 简化了基于视图的DML操作, 在PostgreSQL 9.3以前的版本, 如果要对视图进行DML操作, 必须创建rule或者trigger.</div><div>trigger的例子可以参考 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020130931040444/"  >http://blog.163.com/digoal@126/blog/static/16387704020130931040444/</a></div><div>rule的例子略, 可参考&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/sql-createrule.html"  >http://www.postgresql.org/docs/9.2/static/sql-createrule.html</a></div><div>以下是PostgreSQL 9.3增加automatically-updatable views的说明 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >This patch makes "simple" views automatically updatable, without the need</font></div><div><font size="2"  >to create either INSTEAD OF triggers or INSTEAD rules. &nbsp;"Simple" views</font></div><div><font size="2"  >are those classified as updatable according to SQL-92 rules. &nbsp;The rewriter</font></div><div><font size="2"  >transforms INSERT/UPDATE/DELETE commands on such views directly into an</font></div><div><font size="2"  >equivalent command on the underlying table, which will generally have</font></div><div><font size="2"  >noticeably better performance than is possible with either triggers or</font></div><div><font size="2"  >user-written rules. &nbsp;A view that has INSTEAD OF triggers or INSTEAD rules</font></div><div><font size="2"  >continues to operate the same as before.</font></div><div><font size="2"  >For the moment, security_barrier views are not considered simple.</font></div><div><font size="2"  >Also, we do not support WITH CHECK OPTION. &nbsp;These features may be</font></div><div><font size="2"  >added in future.</font></div><div><font size="2"  >Dean Rasheed, reviewed by Amit Kapila</font></div><p></p></pre></div><div>注意 :&nbsp;</div><div>1. 目前PostgreSQL 9.3的automatically-updatable views不支持with check option.&nbsp;</div><div>也就是说不会对更新后的数据进行检查是否符合视图定义. 因此记录更新后可能在视图中不可见.</div><div>2. automatically-updatable view目前仅支持SQL92定义的simple views.</div><div>对于其他视图如果要更新, 还是需要创建rule或者trigger.</div><div>原文 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >Updatable Views</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >Simple views are automatically updatable: the system will allow INSERT, UPDATE and DELETE statements to be used on the view in the same way as on a regular table. A view is automatically updatable if it satisfies all of the following conditions:</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >The view must have exactly one entry in its FROM list, which must be a table or another updatable view.</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >The view definition must not contain WITH, DISTINCT, GROUP BY, HAVING, LIMIT, or OFFSET clauses at the top level.</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >The view definition must not contain set operations (UNION, INTERSECT or EXCEPT) at the top level.</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >All columns in the view's select list must be simple references to columns of the underlying relation. They cannot be expressions, literals or functions. System columns cannot be referenced, either.</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >No column of the underlying relation can appear more than once in the view's select list.</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >The view must not have the security_barrier property.</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >If the view is automatically updatable the system will convert any INSERT, UPDATE or DELETE statement on the view into the corresponding statement on the underlying base relation.</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >If an automatically updatable view contains a WHERE condition, the condition restricts which rows of the base relation are available to be modified by UPDATE and DELETE statements on the view.&nbsp;</font></div><div><font size="2"  >However, an UPDATE is allowed to change a row so that it no longer satisfies the WHERE condition, and thus is no longer visible through the view.&nbsp;</font></div><div><font size="2"  >Similarly, an INSERT command can potentially insert base-relation rows that do not satisfy the WHERE condition and thus are not visible through the view.</font></div><p></p></pre></div><div>带WHERE条件的简单视图, 在update和delete时, 只能操作视图可见的行, 视图不可见的行无法操作.&nbsp;</div><div>但是update操作允许将记录更新后不再符合where条件. insert也如此.</div><div><br></div><div>系统自带的测试脚本 :&nbsp;</div><div><div>src/test/regress/expected/updatable_views.out</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >--</font></div><div><font size="2"  >-- UPDATABLE VIEWS</font></div><div><font size="2"  >--</font></div><div><font size="2"  >-- check that non-updatable views are rejected with useful error messages</font></div><div><font size="2"  >CREATE TABLE base_tbl (a int PRIMARY KEY, b text DEFAULT 'Unspecified');</font></div><div><font size="2"  >INSERT INTO base_tbl SELECT i, 'Row ' || i FROM generate_series(-2, 2) g(i);</font></div><div><font size="2"  >CREATE VIEW ro_view1 AS SELECT DISTINCT a, b FROM base_tbl; -- DISTINCT not supported</font></div><div><font size="2"  >CREATE VIEW ro_view2 AS SELECT a, b FROM base_tbl GROUP BY a, b; -- GROUP BY not supported</font></div><div><font size="2"  >CREATE VIEW ro_view3 AS SELECT 1 FROM base_tbl HAVING max(a) &gt; 0; -- HAVING not supported</font></div><div><font size="2"  >CREATE VIEW ro_view4 AS SELECT count(*) FROM base_tbl; -- Aggregate functions not supported</font></div><div><font size="2"  >CREATE VIEW ro_view5 AS SELECT a, rank() OVER() FROM base_tbl; -- Window functions not supported</font></div><div><font size="2"  >CREATE VIEW ro_view6 AS SELECT a, b FROM base_tbl UNION SELECT -a, b FROM base_tbl; -- Set ops not supported</font></div><div><font size="2"  >CREATE VIEW ro_view7 AS WITH t AS (SELECT a, b FROM base_tbl) SELECT * FROM t; -- WITH not supported</font></div><div><font size="2"  >CREATE VIEW ro_view8 AS SELECT a, b FROM base_tbl ORDER BY a OFFSET 1; -- OFFSET not supported</font></div><div><font size="2"  >CREATE VIEW ro_view9 AS SELECT a, b FROM base_tbl ORDER BY a LIMIT 1; -- LIMIT not supported</font></div><div><font size="2"  >CREATE VIEW ro_view10 AS SELECT 1 AS a; -- No base relations</font></div><div><font size="2"  >CREATE VIEW ro_view11 AS SELECT b1.a, b2.b FROM base_tbl b1, base_tbl b2; -- Multiple base relations</font></div><div><font size="2"  >CREATE VIEW ro_view12 AS SELECT * FROM generate_series(1, 10) AS g(a); -- SRF in rangetable</font></div><div><font size="2"  >CREATE VIEW ro_view13 AS SELECT a, b FROM (SELECT * FROM base_tbl) AS t; -- Subselect in rangetable</font></div><div><font size="2"  >CREATE VIEW ro_view14 AS SELECT ctid FROM base_tbl; -- System columns not supported</font></div><div><font size="2"  >CREATE VIEW ro_view15 AS SELECT a, upper(b) FROM base_tbl; -- Expression/function in targetlist</font></div><div><font size="2"  >CREATE VIEW ro_view16 AS SELECT a, b, a AS aa FROM base_tbl; -- Repeated column</font></div><div><font size="2"  >CREATE VIEW ro_view17 AS SELECT * FROM ro_view1; -- Base relation not updatable</font></div><div><font size="2"  >CREATE VIEW ro_view18 WITH (security_barrier = true)</font></div><div><font size="2"  >&nbsp; AS SELECT * FROM base_tbl; -- Security barrier views not updatable</font></div><div><font size="2"  >CREATE VIEW ro_view19 AS SELECT * FROM (VALUES(1)) AS tmp(a); -- VALUES in rangetable</font></div><div><font size="2"  >CREATE SEQUENCE seq;</font></div><div><font size="2"  >CREATE VIEW ro_view20 AS SELECT * FROM seq; -- View based on a sequence</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'ro_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;ro_view1 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view10 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view11 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view12 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view13 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view14 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view15 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view16 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view17 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view18 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view19 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view2 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view3 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view4 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view5 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view6 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view7 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view8 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view9 &nbsp; | NO</font></div><div><font size="2"  >(20 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'ro_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------</font></div><div><font size="2"  >&nbsp;ro_view1 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view10 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view11 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view12 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view13 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view14 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view15 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view16 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view17 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view18 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view19 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view2 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view3 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view4 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view5 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view6 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view7 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view8 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view9 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(20 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'ro_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | &nbsp;column_name &nbsp;| is_updatable&nbsp;</font></div><div><font size="2"  >------------+---------------+--------------</font></div><div><font size="2"  >&nbsp;ro_view1 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view1 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view10 &nbsp;| a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view11 &nbsp;| a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view11 &nbsp;| b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view12 &nbsp;| a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view13 &nbsp;| a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view13 &nbsp;| b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view14 &nbsp;| ctid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view15 &nbsp;| a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view15 &nbsp;| upper &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view16 &nbsp;| a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view16 &nbsp;| b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view16 &nbsp;| aa &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view17 &nbsp;| a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view17 &nbsp;| b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view18 &nbsp;| a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view18 &nbsp;| b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view19 &nbsp;| a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view2 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view2 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| sequence_name | NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| last_value &nbsp; &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| start_value &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| increment_by &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| max_value &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| min_value &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| cache_value &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| log_cnt &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| is_cycled &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view20 &nbsp;| is_called &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view3 &nbsp; | ?column? &nbsp; &nbsp; &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view4 &nbsp; | count &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view5 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view5 &nbsp; | rank &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| NO</font></div><div><font size="2"  >&nbsp;ro_view6 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view6 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view7 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view7 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view8 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view8 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view9 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;ro_view9 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(43 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DELETE FROM ro_view1;</font></div><div><font size="2"  >ERROR: &nbsp;cannot delete from view "ro_view1"</font></div><div><font size="2"  >DETAIL: &nbsp;Views containing DISTINCT are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON DELETE DO INSTEAD rule or an INSTEAD OF DELETE trigger.</font></div><div><font size="2"  >DELETE FROM ro_view2;</font></div><div><font size="2"  >ERROR: &nbsp;cannot delete from view "ro_view2"</font></div><div><font size="2"  >DETAIL: &nbsp;Views containing GROUP BY are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON DELETE DO INSTEAD rule or an INSTEAD OF DELETE trigger.</font></div><div><font size="2"  >DELETE FROM ro_view3;</font></div><div><font size="2"  >ERROR: &nbsp;cannot delete from view "ro_view3"</font></div><div><font size="2"  >DETAIL: &nbsp;Views containing HAVING are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON DELETE DO INSTEAD rule or an INSTEAD OF DELETE trigger.</font></div><div><font size="2"  >DELETE FROM ro_view4;</font></div><div><font size="2"  >ERROR: &nbsp;cannot delete from view "ro_view4"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that return columns that are not columns of their base relation are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON DELETE DO INSTEAD rule or an INSTEAD OF DELETE trigger.</font></div><div><font size="2"  >DELETE FROM ro_view5;</font></div><div><font size="2"  >ERROR: &nbsp;cannot delete from view "ro_view5"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that return columns that are not columns of their base relation are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON DELETE DO INSTEAD rule or an INSTEAD OF DELETE trigger.</font></div><div><font size="2"  >DELETE FROM ro_view6;</font></div><div><font size="2"  >ERROR: &nbsp;cannot delete from view "ro_view6"</font></div><div><font size="2"  >DETAIL: &nbsp;Views containing UNION, INTERSECT or EXCEPT are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON DELETE DO INSTEAD rule or an INSTEAD OF DELETE trigger.</font></div><div><font size="2"  >UPDATE ro_view7 SET a=a+1;</font></div><div><font size="2"  >ERROR: &nbsp;cannot update view "ro_view7"</font></div><div><font size="2"  >DETAIL: &nbsp;Views containing WITH are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON UPDATE DO INSTEAD rule or an INSTEAD OF UPDATE trigger.</font></div><div><font size="2"  >UPDATE ro_view8 SET a=a+1;</font></div><div><font size="2"  >ERROR: &nbsp;cannot update view "ro_view8"</font></div><div><font size="2"  >DETAIL: &nbsp;Views containing LIMIT or OFFSET are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON UPDATE DO INSTEAD rule or an INSTEAD OF UPDATE trigger.</font></div><div><font size="2"  >UPDATE ro_view9 SET a=a+1;</font></div><div><font size="2"  >ERROR: &nbsp;cannot update view "ro_view9"</font></div><div><font size="2"  >DETAIL: &nbsp;Views containing LIMIT or OFFSET are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON UPDATE DO INSTEAD rule or an INSTEAD OF UPDATE trigger.</font></div><div><font size="2"  >UPDATE ro_view10 SET a=a+1;</font></div><div><font size="2"  >ERROR: &nbsp;cannot update view "ro_view10"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that do not select from a single table or view are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON UPDATE DO INSTEAD rule or an INSTEAD OF UPDATE trigger.</font></div><div><font size="2"  >UPDATE ro_view11 SET a=a+1;</font></div><div><font size="2"  >ERROR: &nbsp;cannot update view "ro_view11"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that do not select from a single table or view are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON UPDATE DO INSTEAD rule or an INSTEAD OF UPDATE trigger.</font></div><div><font size="2"  >UPDATE ro_view12 SET a=a+1;</font></div><div><font size="2"  >ERROR: &nbsp;cannot update view "ro_view12"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that do not select from a single table or view are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON UPDATE DO INSTEAD rule or an INSTEAD OF UPDATE trigger.</font></div><div><font size="2"  >INSERT INTO ro_view13 VALUES (3, 'Row 3');</font></div><div><font size="2"  >ERROR: &nbsp;cannot insert into view "ro_view13"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that do not select from a single table or view are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view insertable, provide an unconditional ON INSERT DO INSTEAD rule or an INSTEAD OF INSERT trigger.</font></div><div><font size="2"  >INSERT INTO ro_view14 VALUES (null);</font></div><div><font size="2"  >ERROR: &nbsp;cannot insert into view "ro_view14"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that return system columns are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view insertable, provide an unconditional ON INSERT DO INSTEAD rule or an INSTEAD OF INSERT trigger.</font></div><div><font size="2"  >INSERT INTO ro_view15 VALUES (3, 'ROW 3');</font></div><div><font size="2"  >ERROR: &nbsp;cannot insert into view "ro_view15"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that return columns that are not columns of their base relation are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view insertable, provide an unconditional ON INSERT DO INSTEAD rule or an INSTEAD OF INSERT trigger.</font></div><div><font size="2"  >INSERT INTO ro_view16 VALUES (3, 'Row 3', 3);</font></div><div><font size="2"  >ERROR: &nbsp;cannot insert into view "ro_view16"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that return the same column more than once are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view insertable, provide an unconditional ON INSERT DO INSTEAD rule or an INSTEAD OF INSERT trigger.</font></div><div><font size="2"  >INSERT INTO ro_view17 VALUES (3, 'ROW 3');</font></div><div><font size="2"  >ERROR: &nbsp;cannot insert into view "ro_view1"</font></div><div><font size="2"  >DETAIL: &nbsp;Views containing DISTINCT are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view insertable, provide an unconditional ON INSERT DO INSTEAD rule or an INSTEAD OF INSERT trigger.</font></div><div><font size="2"  >INSERT INTO ro_view18 VALUES (3, 'ROW 3');</font></div><div><font size="2"  >ERROR: &nbsp;cannot insert into view "ro_view18"</font></div><div><font size="2"  >DETAIL: &nbsp;Security-barrier views are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view insertable, provide an unconditional ON INSERT DO INSTEAD rule or an INSTEAD OF INSERT trigger.</font></div><div><font size="2"  >DELETE FROM ro_view19;</font></div><div><font size="2"  >ERROR: &nbsp;cannot delete from view "ro_view19"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that do not select from a single table or view are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON DELETE DO INSTEAD rule or an INSTEAD OF DELETE trigger.</font></div><div><font size="2"  >UPDATE ro_view20 SET max_value=1000;</font></div><div><font size="2"  >ERROR: &nbsp;cannot update view "ro_view20"</font></div><div><font size="2"  >DETAIL: &nbsp;Views that do not select from a single table or view are not automatically updatable.</font></div><div><font size="2"  >HINT: &nbsp;To make the view updatable, provide an unconditional ON UPDATE DO INSTEAD rule or an INSTEAD OF UPDATE trigger.</font></div><div><font size="2"  >DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to 16 other objects</font></div><div><font size="2"  >DETAIL: &nbsp;drop cascades to view ro_view1</font></div><div><font size="2"  >drop cascades to view ro_view17</font></div><div><font size="2"  >drop cascades to view ro_view2</font></div><div><font size="2"  >drop cascades to view ro_view3</font></div><div><font size="2"  >drop cascades to view ro_view5</font></div><div><font size="2"  >drop cascades to view ro_view6</font></div><div><font size="2"  >drop cascades to view ro_view7</font></div><div><font size="2"  >drop cascades to view ro_view8</font></div><div><font size="2"  >drop cascades to view ro_view9</font></div><div><font size="2"  >drop cascades to view ro_view11</font></div><div><font size="2"  >drop cascades to view ro_view13</font></div><div><font size="2"  >drop cascades to view ro_view15</font></div><div><font size="2"  >drop cascades to view ro_view16</font></div><div><font size="2"  >drop cascades to view ro_view18</font></div><div><font size="2"  >drop cascades to view ro_view4</font></div><div><font size="2"  >drop cascades to view ro_view14</font></div><div><font size="2"  >DROP VIEW ro_view10, ro_view12, ro_view19;</font></div><div><font size="2"  >DROP SEQUENCE seq CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to view ro_view20</font></div><div><font size="2"  >-- simple updatable view</font></div><div><font size="2"  >CREATE TABLE base_tbl (a int PRIMARY KEY, b text DEFAULT 'Unspecified');</font></div><div><font size="2"  >INSERT INTO base_tbl SELECT i, 'Row ' || i FROM generate_series(-2, 2) g(i);</font></div><div><font size="2"  >CREATE VIEW rw_view1 AS SELECT * FROM base_tbl WHERE a&gt;0;</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name = 'rw_view1';</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | YES</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name = 'rw_view1';</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | YES &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| YES</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name = 'rw_view1'</font></div><div><font size="2"  >&nbsp;ORDER BY ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | column_name | is_updatable&nbsp;</font></div><div><font size="2"  >------------+-------------+--------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >INSERT INTO rw_view1 VALUES (3, 'Row 3');</font></div><div><font size="2"  >INSERT INTO rw_view1 (a) VALUES (4);</font></div><div><font size="2"  >UPDATE rw_view1 SET a=5 WHERE a=4;</font></div><div><font size="2"  >DELETE FROM rw_view1 WHERE b='Row 2';</font></div><div><font size="2"  >SELECT * FROM base_tbl;</font></div><div><font size="2"  >&nbsp;a &nbsp;| &nbsp; &nbsp; &nbsp;b &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >----+-------------</font></div><div><font size="2"  >&nbsp;-2 | Row -2</font></div><div><font size="2"  >&nbsp;-1 | Row -1</font></div><div><font size="2"  >&nbsp; 0 | Row 0</font></div><div><font size="2"  >&nbsp; 1 | Row 1</font></div><div><font size="2"  >&nbsp; 3 | Row 3</font></div><div><font size="2"  >&nbsp; 5 | Unspecified</font></div><div><font size="2"  >(6 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXPLAIN (costs off) UPDATE rw_view1 SET a=6 WHERE a=5;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >--------------------------------------------------</font></div><div><font size="2"  >&nbsp;Update on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Index Scan using base_tbl_pkey on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: ((a &gt; 0) AND (a = 5))</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXPLAIN (costs off) DELETE FROM rw_view1 WHERE a=5;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >--------------------------------------------------</font></div><div><font size="2"  >&nbsp;Delete on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Index Scan using base_tbl_pkey on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: ((a &gt; 0) AND (a = 5))</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to view rw_view1</font></div><div><font size="2"  >-- view on top of view</font></div><div><font size="2"  >CREATE TABLE base_tbl (a int PRIMARY KEY, b text DEFAULT 'Unspecified');</font></div><div><font size="2"  >INSERT INTO base_tbl SELECT i, 'Row ' || i FROM generate_series(-2, 2) g(i);</font></div><div><font size="2"  >CREATE VIEW rw_view1 AS SELECT b AS bb, a AS aa FROM base_tbl WHERE a&gt;0;</font></div><div><font size="2"  >CREATE VIEW rw_view2 AS SELECT aa AS aaa, bb AS bbb FROM rw_view1 WHERE aa&lt;10;</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name = 'rw_view2';</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | YES</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name = 'rw_view2';</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | YES &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| YES</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name = 'rw_view2'</font></div><div><font size="2"  >&nbsp;ORDER BY ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | column_name | is_updatable&nbsp;</font></div><div><font size="2"  >------------+-------------+--------------</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | aaa &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | bbb &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >INSERT INTO rw_view2 VALUES (3, 'Row 3');</font></div><div><font size="2"  >INSERT INTO rw_view2 (aaa) VALUES (4);</font></div><div><font size="2"  >SELECT * FROM rw_view2;</font></div><div><font size="2"  >&nbsp;aaa | &nbsp; &nbsp; bbb &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >-----+-------------</font></div><div><font size="2"  >&nbsp; &nbsp;1 | Row 1</font></div><div><font size="2"  >&nbsp; &nbsp;2 | Row 2</font></div><div><font size="2"  >&nbsp; &nbsp;3 | Row 3</font></div><div><font size="2"  >&nbsp; &nbsp;4 | Unspecified</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >UPDATE rw_view2 SET bbb='Row 4' WHERE aaa=4;</font></div><div><font size="2"  >DELETE FROM rw_view2 WHERE aaa=2;</font></div><div><font size="2"  >SELECT * FROM rw_view2;</font></div><div><font size="2"  >&nbsp;aaa | &nbsp;bbb &nbsp;</font></div><div><font size="2"  >-----+-------</font></div><div><font size="2"  >&nbsp; &nbsp;1 | Row 1</font></div><div><font size="2"  >&nbsp; &nbsp;3 | Row 3</font></div><div><font size="2"  >&nbsp; &nbsp;4 | Row 4</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXPLAIN (costs off) UPDATE rw_view2 SET aaa=5 WHERE aaa=4;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >--------------------------------------------------------</font></div><div><font size="2"  >&nbsp;Update on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Index Scan using base_tbl_pkey on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: ((a &lt; 10) AND (a &gt; 0) AND (a = 4))</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXPLAIN (costs off) DELETE FROM rw_view2 WHERE aaa=4;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >--------------------------------------------------------</font></div><div><font size="2"  >&nbsp;Delete on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Index Scan using base_tbl_pkey on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: ((a &lt; 10) AND (a &gt; 0) AND (a = 4))</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to 2 other objects</font></div><div><font size="2"  >DETAIL: &nbsp;drop cascades to view rw_view1</font></div><div><font size="2"  >drop cascades to view rw_view2</font></div><div><font size="2"  >-- view on top of view with rules</font></div><div><font size="2"  >CREATE TABLE base_tbl (a int PRIMARY KEY, b text DEFAULT 'Unspecified');</font></div><div><font size="2"  >INSERT INTO base_tbl SELECT i, 'Row ' || i FROM generate_series(-2, 2) g(i);</font></div><div><font size="2"  >CREATE VIEW rw_view1 AS SELECT * FROM base_tbl WHERE a&gt;0 OFFSET 0; -- not updatable without rules/triggers</font></div><div><font size="2"  >CREATE VIEW rw_view2 AS SELECT * FROM rw_view1 WHERE a&lt;10;</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | column_name | is_updatable&nbsp;</font></div><div><font size="2"  >------------+-------------+--------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE RULE rw_view1_ins_rule AS ON INSERT TO rw_view1</font></div><div><font size="2"  >&nbsp; DO INSTEAD INSERT INTO base_tbl VALUES (NEW.a, NEW.b) RETURNING *;</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | YES</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | column_name | is_updatable&nbsp;</font></div><div><font size="2"  >------------+-------------+--------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE RULE rw_view1_upd_rule AS ON UPDATE TO rw_view1</font></div><div><font size="2"  >&nbsp; DO INSTEAD UPDATE base_tbl SET b=NEW.b WHERE a=OLD.a RETURNING NEW.*;</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | YES</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | column_name | is_updatable&nbsp;</font></div><div><font size="2"  >------------+-------------+--------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE RULE rw_view1_del_rule AS ON DELETE TO rw_view1</font></div><div><font size="2"  >&nbsp; DO INSTEAD DELETE FROM base_tbl WHERE a=OLD.a RETURNING OLD.*;</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | YES</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | YES &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | YES &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| YES</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | column_name | is_updatable&nbsp;</font></div><div><font size="2"  >------------+-------------+--------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >INSERT INTO rw_view2 VALUES (3, 'Row 3') RETURNING *;</font></div><div><font size="2"  >&nbsp;a | &nbsp; b &nbsp;&nbsp;</font></div><div><font size="2"  >---+-------</font></div><div><font size="2"  >&nbsp;3 | Row 3</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >UPDATE rw_view2 SET b='Row three' WHERE a=3 RETURNING *;</font></div><div><font size="2"  >&nbsp;a | &nbsp; &nbsp; b &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >---+-----------</font></div><div><font size="2"  >&nbsp;3 | Row three</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT * FROM rw_view2;</font></div><div><font size="2"  >&nbsp;a | &nbsp; &nbsp; b &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >---+-----------</font></div><div><font size="2"  >&nbsp;1 | Row 1</font></div><div><font size="2"  >&nbsp;2 | Row 2</font></div><div><font size="2"  >&nbsp;3 | Row three</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DELETE FROM rw_view2 WHERE a=3 RETURNING *;</font></div><div><font size="2"  >&nbsp;a | &nbsp; &nbsp; b &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >---+-----------</font></div><div><font size="2"  >&nbsp;3 | Row three</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT * FROM rw_view2;</font></div><div><font size="2"  >&nbsp;a | &nbsp; b &nbsp;&nbsp;</font></div><div><font size="2"  >---+-------</font></div><div><font size="2"  >&nbsp;1 | Row 1</font></div><div><font size="2"  >&nbsp;2 | Row 2</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXPLAIN (costs off) UPDATE rw_view2 SET a=3 WHERE a=2;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >------------------------------------------------------------------</font></div><div><font size="2"  >&nbsp;Update on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Nested Loop</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Index Scan using base_tbl_pkey on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (a = 2)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Subquery Scan on rw_view1</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: ((rw_view1.a &lt; 10) AND (rw_view1.a = 2))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Limit</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Bitmap Heap Scan on base_tbl base_tbl_1</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Recheck Cond: (a &gt; 0)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Bitmap Index Scan on base_tbl_pkey</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (a &gt; 0)</font></div><div><font size="2"  >(11 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXPLAIN (costs off) DELETE FROM rw_view2 WHERE a=2;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >------------------------------------------------------------------</font></div><div><font size="2"  >&nbsp;Delete on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Nested Loop</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Index Scan using base_tbl_pkey on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (a = 2)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Subquery Scan on rw_view1</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: ((rw_view1.a &lt; 10) AND (rw_view1.a = 2))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Limit</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Bitmap Heap Scan on base_tbl base_tbl_1</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Recheck Cond: (a &gt; 0)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Bitmap Index Scan on base_tbl_pkey</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (a &gt; 0)</font></div><div><font size="2"  >(11 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to 2 other objects</font></div><div><font size="2"  >DETAIL: &nbsp;drop cascades to view rw_view1</font></div><div><font size="2"  >drop cascades to view rw_view2</font></div><div><font size="2"  >-- view on top of view with triggers</font></div><div><font size="2"  >CREATE TABLE base_tbl (a int PRIMARY KEY, b text DEFAULT 'Unspecified');</font></div><div><font size="2"  >INSERT INTO base_tbl SELECT i, 'Row ' || i FROM generate_series(-2, 2) g(i);</font></div><div><font size="2"  >CREATE VIEW rw_view1 AS SELECT * FROM base_tbl WHERE a&gt;0 OFFSET 0; -- not updatable without rules/triggers</font></div><div><font size="2"  >CREATE VIEW rw_view2 AS SELECT * FROM rw_view1 WHERE a&lt;10;</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into,</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;is_trigger_updatable, is_trigger_deletable,</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;is_trigger_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into | is_trigger_updatable | is_trigger_deletable | is_trigger_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------+----------------------+----------------------+----------------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | column_name | is_updatable&nbsp;</font></div><div><font size="2"  >------------+-------------+--------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE FUNCTION rw_view1_trig_fn()</font></div><div><font size="2"  >RETURNS trigger AS</font></div><div><font size="2"  >$$</font></div><div><font size="2"  >BEGIN</font></div><div><font size="2"  >&nbsp; IF TG_OP = 'INSERT' THEN</font></div><div><font size="2"  >&nbsp; &nbsp; INSERT INTO base_tbl VALUES (NEW.a, NEW.b);</font></div><div><font size="2"  >&nbsp; &nbsp; RETURN NEW;</font></div><div><font size="2"  >&nbsp; ELSIF TG_OP = 'UPDATE' THEN</font></div><div><font size="2"  >&nbsp; &nbsp; UPDATE base_tbl SET b=NEW.b WHERE a=OLD.a;</font></div><div><font size="2"  >&nbsp; &nbsp; RETURN NEW;</font></div><div><font size="2"  >&nbsp; ELSIF TG_OP = 'DELETE' THEN</font></div><div><font size="2"  >&nbsp; &nbsp; DELETE FROM base_tbl WHERE a=OLD.a;</font></div><div><font size="2"  >&nbsp; &nbsp; RETURN OLD;</font></div><div><font size="2"  >&nbsp; END IF;</font></div><div><font size="2"  >END;</font></div><div><font size="2"  >$$</font></div><div><font size="2"  >LANGUAGE plpgsql;</font></div><div><font size="2"  >CREATE TRIGGER rw_view1_ins_trig INSTEAD OF INSERT ON rw_view1</font></div><div><font size="2"  >&nbsp; FOR EACH ROW EXECUTE PROCEDURE rw_view1_trig_fn();</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into,</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;is_trigger_updatable, is_trigger_deletable,</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;is_trigger_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into | is_trigger_updatable | is_trigger_deletable | is_trigger_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------+----------------------+----------------------+----------------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | column_name | is_updatable&nbsp;</font></div><div><font size="2"  >------------+-------------+--------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE TRIGGER rw_view1_upd_trig INSTEAD OF UPDATE ON rw_view1</font></div><div><font size="2"  >&nbsp; FOR EACH ROW EXECUTE PROCEDURE rw_view1_trig_fn();</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into,</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;is_trigger_updatable, is_trigger_deletable,</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;is_trigger_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into | is_trigger_updatable | is_trigger_deletable | is_trigger_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------+----------------------+----------------------+----------------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | column_name | is_updatable&nbsp;</font></div><div><font size="2"  >------------+-------------+--------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE TRIGGER rw_view1_del_trig INSTEAD OF DELETE ON rw_view1</font></div><div><font size="2"  >&nbsp; FOR EACH ROW EXECUTE PROCEDURE rw_view1_trig_fn();</font></div><div><font size="2"  >SELECT table_name, is_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.tables</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, is_updatable, is_insertable_into,</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;is_trigger_updatable, is_trigger_deletable,</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;is_trigger_insertable_into</font></div><div><font size="2"  >&nbsp; FROM information_schema.views</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name;</font></div><div><font size="2"  >&nbsp;table_name | is_updatable | is_insertable_into | is_trigger_updatable | is_trigger_deletable | is_trigger_insertable_into&nbsp;</font></div><div><font size="2"  >------------+--------------+--------------------+----------------------+----------------------+----------------------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | YES &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| YES &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| YES</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT table_name, column_name, is_updatable</font></div><div><font size="2"  >&nbsp; FROM information_schema.columns</font></div><div><font size="2"  >&nbsp;WHERE table_name LIKE 'rw_view%'</font></div><div><font size="2"  >&nbsp;ORDER BY table_name, ordinal_position;</font></div><div><font size="2"  >&nbsp;table_name | column_name | is_updatable&nbsp;</font></div><div><font size="2"  >------------+-------------+--------------</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view1 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >&nbsp;rw_view2 &nbsp; | b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | NO</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >INSERT INTO rw_view2 VALUES (3, 'Row 3') RETURNING *;</font></div><div><font size="2"  >&nbsp;a | &nbsp; b &nbsp;&nbsp;</font></div><div><font size="2"  >---+-------</font></div><div><font size="2"  >&nbsp;3 | Row 3</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >UPDATE rw_view2 SET b='Row three' WHERE a=3 RETURNING *;</font></div><div><font size="2"  >&nbsp;a | &nbsp; &nbsp; b &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >---+-----------</font></div><div><font size="2"  >&nbsp;3 | Row three</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT * FROM rw_view2;</font></div><div><font size="2"  >&nbsp;a | &nbsp; &nbsp; b &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >---+-----------</font></div><div><font size="2"  >&nbsp;1 | Row 1</font></div><div><font size="2"  >&nbsp;2 | Row 2</font></div><div><font size="2"  >&nbsp;3 | Row three</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DELETE FROM rw_view2 WHERE a=3 RETURNING *;</font></div><div><font size="2"  >&nbsp;a | &nbsp; &nbsp; b &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >---+-----------</font></div><div><font size="2"  >&nbsp;3 | Row three</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT * FROM rw_view2;</font></div><div><font size="2"  >&nbsp;a | &nbsp; b &nbsp;&nbsp;</font></div><div><font size="2"  >---+-------</font></div><div><font size="2"  >&nbsp;1 | Row 1</font></div><div><font size="2"  >&nbsp;2 | Row 2</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXPLAIN (costs off) UPDATE rw_view2 SET a=3 WHERE a=2;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >------------------------------------------------------------</font></div><div><font size="2"  >&nbsp;Update on rw_view1 rw_view1_1</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Subquery Scan on rw_view1</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: ((rw_view1.a &lt; 10) AND (rw_view1.a = 2))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Limit</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Bitmap Heap Scan on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Recheck Cond: (a &gt; 0)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Bitmap Index Scan on base_tbl_pkey</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (a &gt; 0)</font></div><div><font size="2"  >(8 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXPLAIN (costs off) DELETE FROM rw_view2 WHERE a=2;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >------------------------------------------------------------</font></div><div><font size="2"  >&nbsp;Delete on rw_view1 rw_view1_1</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Subquery Scan on rw_view1</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: ((rw_view1.a &lt; 10) AND (rw_view1.a = 2))</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Limit</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Bitmap Heap Scan on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Recheck Cond: (a &gt; 0)</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Bitmap Index Scan on base_tbl_pkey</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (a &gt; 0)</font></div><div><font size="2"  >(8 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to 2 other objects</font></div><div><font size="2"  >DETAIL: &nbsp;drop cascades to view rw_view1</font></div><div><font size="2"  >drop cascades to view rw_view2</font></div><div><font size="2"  >DROP FUNCTION rw_view1_trig_fn();</font></div><div><font size="2"  >-- update using whole row from view</font></div><div><font size="2"  >CREATE TABLE base_tbl (a int PRIMARY KEY, b text DEFAULT 'Unspecified');</font></div><div><font size="2"  >INSERT INTO base_tbl SELECT i, 'Row ' || i FROM generate_series(-2, 2) g(i);</font></div><div><font size="2"  >CREATE VIEW rw_view1 AS SELECT b AS bb, a AS aa FROM base_tbl;</font></div><div><font size="2"  >CREATE FUNCTION rw_view1_aa(x rw_view1)</font></div><div><font size="2"  >&nbsp; RETURNS int AS $$ SELECT x.aa $$ LANGUAGE sql;</font></div><div><font size="2"  >UPDATE rw_view1 v SET bb='Updated row 2' WHERE rw_view1_aa(v)=2</font></div><div><font size="2"  >&nbsp; RETURNING rw_view1_aa(v), v.bb;</font></div><div><font size="2"  >&nbsp;rw_view1_aa | &nbsp; &nbsp; &nbsp;bb &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >-------------+---------------</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 | Updated row 2</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT * FROM base_tbl;</font></div><div><font size="2"  >&nbsp;a &nbsp;| &nbsp; &nbsp; &nbsp; b &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >----+---------------</font></div><div><font size="2"  >&nbsp;-2 | Row -2</font></div><div><font size="2"  >&nbsp;-1 | Row -1</font></div><div><font size="2"  >&nbsp; 0 | Row 0</font></div><div><font size="2"  >&nbsp; 1 | Row 1</font></div><div><font size="2"  >&nbsp; 2 | Updated row 2</font></div><div><font size="2"  >(5 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXPLAIN (costs off)</font></div><div><font size="2"  >UPDATE rw_view1 v SET bb='Updated row 2' WHERE rw_view1_aa(v)=2</font></div><div><font size="2"  >&nbsp; RETURNING rw_view1_aa(v), v.bb;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >--------------------------------------------------</font></div><div><font size="2"  >&nbsp;Update on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Index Scan using base_tbl_pkey on base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (a = 2)</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to 2 other objects</font></div><div><font size="2"  >DETAIL: &nbsp;drop cascades to view rw_view1</font></div><div><font size="2"  >drop cascades to function rw_view1_aa(rw_view1)</font></div><div><font size="2"  >-- permissions checks</font></div><div><font size="2"  >CREATE USER view_user1;</font></div><div><font size="2"  >CREATE USER view_user2;</font></div><div><font size="2"  >SET SESSION AUTHORIZATION view_user1;</font></div><div><font size="2"  >CREATE TABLE base_tbl(a int, b text, c float);</font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (1, 'Row 1', 1.0);</font></div><div><font size="2"  >CREATE VIEW rw_view1 AS SELECT b AS bb, c AS cc, a AS aa FROM base_tbl;</font></div><div><font size="2"  >INSERT INTO rw_view1 VALUES ('Row 2', 2.0, 2);</font></div><div><font size="2"  >GRANT SELECT ON base_tbl TO view_user2;</font></div><div><font size="2"  >GRANT SELECT ON rw_view1 TO view_user2;</font></div><div><font size="2"  >GRANT UPDATE (a,c) ON base_tbl TO view_user2;</font></div><div><font size="2"  >GRANT UPDATE (bb,cc) ON rw_view1 TO view_user2;</font></div><div><font size="2"  >RESET SESSION AUTHORIZATION;</font></div><div><font size="2"  >SET SESSION AUTHORIZATION view_user2;</font></div><div><font size="2"  >CREATE VIEW rw_view2 AS SELECT b AS bb, c AS cc, a AS aa FROM base_tbl;</font></div><div><font size="2"  >SELECT * FROM base_tbl; -- ok</font></div><div><font size="2"  >&nbsp;a | &nbsp; b &nbsp; | c&nbsp;</font></div><div><font size="2"  >---+-------+---</font></div><div><font size="2"  >&nbsp;1 | Row 1 | 1</font></div><div><font size="2"  >&nbsp;2 | Row 2 | 2</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT * FROM rw_view1; -- ok</font></div><div><font size="2"  >&nbsp; bb &nbsp; | cc | aa&nbsp;</font></div><div><font size="2"  >-------+----+----</font></div><div><font size="2"  >&nbsp;Row 1 | &nbsp;1 | &nbsp;1</font></div><div><font size="2"  >&nbsp;Row 2 | &nbsp;2 | &nbsp;2</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT * FROM rw_view2; -- ok</font></div><div><font size="2"  >&nbsp; bb &nbsp; | cc | aa&nbsp;</font></div><div><font size="2"  >-------+----+----</font></div><div><font size="2"  >&nbsp;Row 1 | &nbsp;1 | &nbsp;1</font></div><div><font size="2"  >&nbsp;Row 2 | &nbsp;2 | &nbsp;2</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (3, 'Row 3', 3.0); -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation base_tbl</font></div><div><font size="2"  >INSERT INTO rw_view1 VALUES ('Row 3', 3.0, 3); -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation rw_view1</font></div><div><font size="2"  >INSERT INTO rw_view2 VALUES ('Row 3', 3.0, 3); -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation base_tbl</font></div><div><font size="2"  >UPDATE base_tbl SET a=a, c=c; -- ok</font></div><div><font size="2"  >UPDATE base_tbl SET b=b; -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation base_tbl</font></div><div><font size="2"  >UPDATE rw_view1 SET bb=bb, cc=cc; -- ok</font></div><div><font size="2"  >UPDATE rw_view1 SET aa=aa; -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation rw_view1</font></div><div><font size="2"  >UPDATE rw_view2 SET aa=aa, cc=cc; -- ok</font></div><div><font size="2"  >UPDATE rw_view2 SET bb=bb; -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation base_tbl</font></div><div><font size="2"  >DELETE FROM base_tbl; -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation base_tbl</font></div><div><font size="2"  >DELETE FROM rw_view1; -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation rw_view1</font></div><div><font size="2"  >DELETE FROM rw_view2; -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation base_tbl</font></div><div><font size="2"  >RESET SESSION AUTHORIZATION;</font></div><div><font size="2"  >SET SESSION AUTHORIZATION view_user1;</font></div><div><font size="2"  >GRANT INSERT, DELETE ON base_tbl TO view_user2;</font></div><div><font size="2"  >RESET SESSION AUTHORIZATION;</font></div><div><font size="2"  >SET SESSION AUTHORIZATION view_user2;</font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (3, 'Row 3', 3.0); -- ok</font></div><div><font size="2"  >INSERT INTO rw_view1 VALUES ('Row 4', 4.0, 4); -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation rw_view1</font></div><div><font size="2"  >INSERT INTO rw_view2 VALUES ('Row 4', 4.0, 4); -- ok</font></div><div><font size="2"  >DELETE FROM base_tbl WHERE a=1; -- ok</font></div><div><font size="2"  >DELETE FROM rw_view1 WHERE aa=2; -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation rw_view1</font></div><div><font size="2"  >DELETE FROM rw_view2 WHERE aa=2; -- ok</font></div><div><font size="2"  >SELECT * FROM base_tbl;</font></div><div><font size="2"  >&nbsp;a | &nbsp; b &nbsp; | c&nbsp;</font></div><div><font size="2"  >---+-------+---</font></div><div><font size="2"  >&nbsp;3 | Row 3 | 3</font></div><div><font size="2"  >&nbsp;4 | Row 4 | 4</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >RESET SESSION AUTHORIZATION;</font></div><div><font size="2"  >SET SESSION AUTHORIZATION view_user1;</font></div><div><font size="2"  >REVOKE INSERT, DELETE ON base_tbl FROM view_user2;</font></div><div><font size="2"  >GRANT INSERT, DELETE ON rw_view1 TO view_user2;</font></div><div><font size="2"  >RESET SESSION AUTHORIZATION;</font></div><div><font size="2"  >SET SESSION AUTHORIZATION view_user2;</font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (5, 'Row 5', 5.0); -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation base_tbl</font></div><div><font size="2"  >INSERT INTO rw_view1 VALUES ('Row 5', 5.0, 5); -- ok</font></div><div><font size="2"  >INSERT INTO rw_view2 VALUES ('Row 6', 6.0, 6); -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation base_tbl</font></div><div><font size="2"  >DELETE FROM base_tbl WHERE a=3; -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation base_tbl</font></div><div><font size="2"  >DELETE FROM rw_view1 WHERE aa=3; -- ok</font></div><div><font size="2"  >DELETE FROM rw_view2 WHERE aa=4; -- not allowed</font></div><div><font size="2"  >ERROR: &nbsp;permission denied for relation base_tbl</font></div><div><font size="2"  >SELECT * FROM base_tbl;</font></div><div><font size="2"  >&nbsp;a | &nbsp; b &nbsp; | c&nbsp;</font></div><div><font size="2"  >---+-------+---</font></div><div><font size="2"  >&nbsp;4 | Row 4 | 4</font></div><div><font size="2"  >&nbsp;5 | Row 5 | 5</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >RESET SESSION AUTHORIZATION;</font></div><div><font size="2"  >DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to 2 other objects</font></div><div><font size="2"  >DETAIL: &nbsp;drop cascades to view rw_view1</font></div><div><font size="2"  >drop cascades to view rw_view2</font></div><div><font size="2"  >DROP USER view_user1;</font></div><div><font size="2"  >DROP USER view_user2;</font></div><div><font size="2"  >-- column defaults</font></div><div><font size="2"  >CREATE TABLE base_tbl (a int PRIMARY KEY, b text DEFAULT 'Unspecified', c serial);</font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (1, 'Row 1');</font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (2, 'Row 2');</font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (3);</font></div><div><font size="2"  >CREATE VIEW rw_view1 AS SELECT a AS aa, b AS bb FROM base_tbl;</font></div><div><font size="2"  >ALTER VIEW rw_view1 ALTER COLUMN bb SET DEFAULT 'View default';</font></div><div><font size="2"  >INSERT INTO rw_view1 VALUES (4, 'Row 4');</font></div><div><font size="2"  >INSERT INTO rw_view1 (aa) VALUES (5);</font></div><div><font size="2"  >SELECT * FROM base_tbl;</font></div><div><font size="2"  >&nbsp;a | &nbsp; &nbsp; &nbsp;b &nbsp; &nbsp; &nbsp; | c&nbsp;</font></div><div><font size="2"  >---+--------------+---</font></div><div><font size="2"  >&nbsp;1 | Row 1 &nbsp; &nbsp; &nbsp; &nbsp;| 1</font></div><div><font size="2"  >&nbsp;2 | Row 2 &nbsp; &nbsp; &nbsp; &nbsp;| 2</font></div><div><font size="2"  >&nbsp;3 | Unspecified &nbsp;| 3</font></div><div><font size="2"  >&nbsp;4 | Row 4 &nbsp; &nbsp; &nbsp; &nbsp;| 4</font></div><div><font size="2"  >&nbsp;5 | View default | 5</font></div><div><font size="2"  >(5 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to view rw_view1</font></div><div><font size="2"  >-- Table having triggers</font></div><div><font size="2"  >CREATE TABLE base_tbl (a int PRIMARY KEY, b text DEFAULT 'Unspecified');</font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (1, 'Row 1');</font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (2, 'Row 2');</font></div><div><font size="2"  >CREATE FUNCTION rw_view1_trig_fn()</font></div><div><font size="2"  >RETURNS trigger AS</font></div><div><font size="2"  >$$</font></div><div><font size="2"  >BEGIN</font></div><div><font size="2"  >&nbsp; IF TG_OP = 'INSERT' THEN</font></div><div><font size="2"  >&nbsp; &nbsp; UPDATE base_tbl SET b=NEW.b WHERE a=1;</font></div><div><font size="2"  >&nbsp; &nbsp; RETURN NULL;</font></div><div><font size="2"  >&nbsp; END IF;</font></div><div><font size="2"  >&nbsp; RETURN NULL;</font></div><div><font size="2"  >END;</font></div><div><font size="2"  >$$</font></div><div><font size="2"  >LANGUAGE plpgsql;</font></div><div><font size="2"  >CREATE TRIGGER rw_view1_ins_trig AFTER INSERT ON base_tbl</font></div><div><font size="2"  >&nbsp; FOR EACH ROW EXECUTE PROCEDURE rw_view1_trig_fn();</font></div><div><font size="2"  >CREATE VIEW rw_view1 AS SELECT a AS aa, b AS bb FROM base_tbl;</font></div><div><font size="2"  >INSERT INTO rw_view1 VALUES (3, 'Row 3');</font></div><div><font size="2"  >select * from base_tbl;</font></div><div><font size="2"  >&nbsp;a | &nbsp; b &nbsp;&nbsp;</font></div><div><font size="2"  >---+-------</font></div><div><font size="2"  >&nbsp;2 | Row 2</font></div><div><font size="2"  >&nbsp;3 | Row 3</font></div><div><font size="2"  >&nbsp;1 | Row 3</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DROP VIEW rw_view1;</font></div><div><font size="2"  >DROP TRIGGER rw_view1_ins_trig on base_tbl;</font></div><div><font size="2"  >DROP FUNCTION rw_view1_trig_fn();</font></div><div><font size="2"  >DROP TABLE base_tbl;</font></div><div><font size="2"  >-- view with ORDER BY</font></div><div><font size="2"  >CREATE TABLE base_tbl (a int, b int);</font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (1,2), (4,5), (3,-3);</font></div><div><font size="2"  >CREATE VIEW rw_view1 AS SELECT * FROM base_tbl ORDER BY a+b;</font></div><div><font size="2"  >SELECT * FROM rw_view1;</font></div><div><font size="2"  >&nbsp;a | b &nbsp;</font></div><div><font size="2"  >---+----</font></div><div><font size="2"  >&nbsp;3 | -3</font></div><div><font size="2"  >&nbsp;1 | &nbsp;2</font></div><div><font size="2"  >&nbsp;4 | &nbsp;5</font></div><div><font size="2"  >(3 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >INSERT INTO rw_view1 VALUES (7,-8);</font></div><div><font size="2"  >SELECT * FROM rw_view1;</font></div><div><font size="2"  >&nbsp;a | b &nbsp;</font></div><div><font size="2"  >---+----</font></div><div><font size="2"  >&nbsp;7 | -8</font></div><div><font size="2"  >&nbsp;3 | -3</font></div><div><font size="2"  >&nbsp;1 | &nbsp;2</font></div><div><font size="2"  >&nbsp;4 | &nbsp;5</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >EXPLAIN (verbose, costs off) UPDATE rw_view1 SET b = b + 1 RETURNING *;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >-------------------------------------------------------------</font></div><div><font size="2"  >&nbsp;Update on public.base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp;Output: base_tbl.a, base_tbl.b</font></div><div><font size="2"  >&nbsp; &nbsp;-&gt; &nbsp;Seq Scan on public.base_tbl</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: base_tbl.a, (base_tbl.b + 1), base_tbl.ctid</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >UPDATE rw_view1 SET b = b + 1 RETURNING *;</font></div><div><font size="2"  >&nbsp;a | b &nbsp;</font></div><div><font size="2"  >---+----</font></div><div><font size="2"  >&nbsp;1 | &nbsp;3</font></div><div><font size="2"  >&nbsp;4 | &nbsp;6</font></div><div><font size="2"  >&nbsp;3 | -2</font></div><div><font size="2"  >&nbsp;7 | -7</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SELECT * FROM rw_view1;</font></div><div><font size="2"  >&nbsp;a | b &nbsp;</font></div><div><font size="2"  >---+----</font></div><div><font size="2"  >&nbsp;7 | -7</font></div><div><font size="2"  >&nbsp;3 | -2</font></div><div><font size="2"  >&nbsp;1 | &nbsp;3</font></div><div><font size="2"  >&nbsp;4 | &nbsp;6</font></div><div><font size="2"  >(4 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to view rw_view1</font></div><div><font size="2"  >-- multiple array-column updates</font></div><div><font size="2"  >CREATE TABLE base_tbl (a int, arr int[]);</font></div><div><font size="2"  >INSERT INTO base_tbl VALUES (1,ARRAY[2]), (3,ARRAY[4]);</font></div><div><font size="2"  >CREATE VIEW rw_view1 AS SELECT * FROM base_tbl;</font></div><div><font size="2"  >UPDATE rw_view1 SET arr[1] = 42, arr[2] = 77 WHERE a = 3;</font></div><div><font size="2"  >SELECT * FROM rw_view1;</font></div><div><font size="2"  >&nbsp;a | &nbsp; arr &nbsp;&nbsp;</font></div><div><font size="2"  >---+---------</font></div><div><font size="2"  >&nbsp;1 | {2}</font></div><div><font size="2"  >&nbsp;3 | {42,77}</font></div><div><font size="2"  >(2 rows)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DROP TABLE base_tbl CASCADE;</font></div><div><font size="2"  >NOTICE: &nbsp;drop cascades to view rw_view1</font></div><p></p></pre></div></div><div><br></div><div><br></div>【参考】<div>1.&nbsp;<a target="_blank" rel="nofollow" href="https://github.com/postgres/postgres/commit/a99c42f291421572aef2b0a9360294c7d89b8bc7"  >https://github.com/postgres/postgres/commit/a99c42f291421572aef2b0a9360294c7d89b8bc7</a></div><div>2.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/infoschema-tables.html"  >http://www.postgresql.org/docs/devel/static/infoschema-tables.html</a></div><div>3.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/infoschema-views.html"  >http://www.postgresql.org/docs/devel/static/infoschema-views.html</a></div><div>4.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/sql-createview.html"  >http://www.postgresql.org/docs/devel/static/sql-createview.html</a><br>5.&nbsp;<wbr><a style="line-height: 22px;" target="_blank" rel="nofollow" href="https://commitfest.postgresql.org/action/patch_view?id=923"  >https://commitfest.postgresql.org/action/patch_view?id=923</a></div></div>
	</div>
</div>
</body>
</html>