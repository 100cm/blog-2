<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">mongoDB VS PostgreSQL dml performance use python (pymongo & py-postgresql)</h2>
	<h5 id="">2015-02-04 21:38:15&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020151443228780/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>前面测试了mongodb和postgresql的插入性能对比, 参考如下 :&nbsp;</div><div><span style="line-height: 28px;"   >1.&nbsp;</span><wbr style="line-height: 28px;"   ><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020151435825593/"   >http://blog.163.com/digoal@126/blog/static/16387704020151435825593/</a><div style="line-height: 28px;"   >2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402015142858224/"   >http://blog.163.com/digoal@126/blog/static/1638770402015142858224/</a></div><div style="line-height: 28px;"   >3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020151210840303/"   >http://blog.163.com/digoal@126/blog/static/16387704020151210840303/</a></div></div><div style="line-height: 28px;"   >本文将测试对比一下select, update, 以及select, insert, update混合场景的性能.</div><div style="line-height: 28px;"   >同样使用并行8个线程测试.</div><div style="line-height: 28px;"   >(因为使用的驱动问题, python测试结果性能较差, mongo改用motor驱动的异步调用后, 性能提升明显, 测试结果仅供参考, 如果是PG的话, 建议使用pgbench测试)</div><div style="line-height: 28px;"   >mongoDB :&nbsp;</div><div style="line-height: 28px;"   >更新测试 :&nbsp;</div><div><p></p><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi test.py</font></div><div><font size="2"   >import threading</font></div><div><font size="2"   >import time</font></div><div><font size="2"   >import pymongo</font></div><div><font size="2"   >import random</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >c=pymongo.MongoClient('/tmp/mongodb-5281.sock')</font></div><div><font size="2"   >db = c.test_database</font></div><div><font size="2"   >db.drop_collection('test_collection')</font></div><div><font size="2"   >collection = db.test_collection</font></div><div><font size="2"   >print(collection.count())</font></div><div><font size="2"   >for i in range(0,1000000):</font></div><div><font size="2"   >&nbsp; collection.insert({'id':i, 'username': 'digoal.zhou', 'age':32, 'email':'digoal@126.com', 'qq':'276732431'})</font></div><div><font size="2"   ><span style="line-height: 28px;"   >collection.</span>create_index("id")</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >class n_t(threading.Thread): &nbsp; #The timer class is derived from the class threading.Thread</font></div><div><font size="2"   >&nbsp; def __init__(self, num):</font></div><div><font size="2"   >&nbsp; &nbsp; threading.Thread.__init__(self)</font></div><div><font size="2"   >&nbsp; &nbsp; self.thread_num = num</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; def run(self): #Overwrite run() method, put what you want the thread do here</font></div><div><font size="2"   >&nbsp; &nbsp; c=pymongo.MongoClient('/tmp/mongodb-5281.sock')</font></div><div><font size="2"   >&nbsp; &nbsp; db = c.test_database</font></div><div><font size="2"   >&nbsp; &nbsp; collection = db.test_collection</font></div><div><font size="2"   >&nbsp; &nbsp; start_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(start_t))</font></div><div><font size="2"   >&nbsp; &nbsp; for i in range(0,125000):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; collection.update({'id':random.randrange(0,1000000)}, {'$set': {'age': random.randrange(0,1000000)}})</font></div><div><font size="2"   >&nbsp; &nbsp; stop_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(stop_t))</font></div><div><font size="2"   >&nbsp; &nbsp; print(stop_t-start_t)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >def test():</font></div><div><font size="2"   >&nbsp; t_names = dict()</font></div><div><font size="2"   >&nbsp; for i in range(0,8):</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i] = n_t(i)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i].start()</font></div><div><font size="2"   >&nbsp; return</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if __name__ == '__main__':</font></div><div><font size="2"   >&nbsp; test()</font></div><p></p></pre></div><p></p></div><div>测试结果379秒 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost ~]# python test.py</font></div><div><font size="2"   >0</font></div><div><font size="2"   >TID:0 1423070907.7699816</font></div><div><font size="2"   >TID:1 1423070907.770696</font></div><div><font size="2"   >TID:2 1423070907.7744105</font></div><div><font size="2"   >TID:3 1423070907.7760801</font></div><div><font size="2"   >TID:4 1423070907.779555</font></div><div><font size="2"   >TID:7 1423070907.78037</font></div><div><font size="2"   >TID:6 1423070907.7860947</font></div><div><font size="2"   >TID:5 1423070907.78793</font></div><div><font size="2"   >TID:6 1423071285.5971715</font></div><div><font size="2"   >377.81107687950134</font></div><div><font size="2"   >TID:7 1423071286.6500263</font></div><div><font size="2"   >378.8696563243866</font></div><div><font size="2"   >TID:0 1423071286.9464445</font></div><div><font size="2"   >379.17646288871765</font></div><div><font size="2"   >TID:1 1423071287.1227949</font></div><div><font size="2"   >379.352098941803</font></div><div><font size="2"   >TID:3 1423071287.1230247</font></div><div><font size="2"   >379.3469445705414</font></div><div><font size="2"   >TID:5 1423071287.2262568</font></div><div><font size="2"   >379.4383268356323</font></div><div><font size="2"   >TID:4 1423071287.2609653</font></div><div><font size="2"   >379.4814102649689</font></div><div><font size="2"   >TID:2 1423071287.4058232</font></div><div><font size="2"   >379.6314127445221</font></div><p></p></pre></div><div><br></div><div><div style="line-height: 28px;"   >查询测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >import threading</font></div><div><font size="2"   >import time</font></div><div><font size="2"   >import pymongo</font></div><div><font size="2"   >import random</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >c=pymongo.MongoClient('/tmp/mongodb-5281.sock')</font></div><div><font size="2"   >db = c.test_database</font></div><div><font size="2"   ># db.drop_collection('test_collection')</font></div><div><font size="2"   >collection = db.test_collection</font></div><div><font size="2"   >print(collection.count())</font></div><div><font size="2"   ># for i in range(0,1000000):</font></div><div><font size="2"   ># &nbsp; collection.insert({'id':i, 'username': 'digoal.zhou', 'age':32, 'email':'digoal@126.com', 'qq':'276732431'})</font></div><div><font size="2"   ># collection.create_index("id")</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >class n_t(threading.Thread): &nbsp; #The timer class is derived from the class threading.Thread</font></div><div><font size="2"   >&nbsp; def __init__(self, num):</font></div><div><font size="2"   >&nbsp; &nbsp; threading.Thread.__init__(self)</font></div><div><font size="2"   >&nbsp; &nbsp; self.thread_num = num</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; def run(self): #Overwrite run() method, put what you want the thread do here</font></div><div><font size="2"   >&nbsp; &nbsp; c=pymongo.MongoClient('/tmp/mongodb-5281.sock')</font></div><div><font size="2"   >&nbsp; &nbsp; db = c.test_database</font></div><div><font size="2"   >&nbsp; &nbsp; collection = db.test_collection</font></div><div><font size="2"   >&nbsp; &nbsp; start_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(start_t))</font></div><div><font size="2"   >&nbsp; &nbsp; for i in range(0,125000):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; collection.find_one({'id': random.randrange(0,1000000)})</font></div><div><font size="2"   >&nbsp; &nbsp; stop_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(stop_t))</font></div><div><font size="2"   >&nbsp; &nbsp; print(stop_t-start_t)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >def test():</font></div><div><font size="2"   >&nbsp; t_names = dict()</font></div><div><font size="2"   >&nbsp; for i in range(0,8):</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i] = n_t(i)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i].start()</font></div><div><font size="2"   >&nbsp; return</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if __name__ == '__main__':</font></div><div><font size="2"   >&nbsp; test()</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >测试结果361秒 :&nbsp;</span></div><div><font size="2"   ><div><pre class="prettyprint"   ><p style="line-height: 28px;"   ></p><div><span style="line-height: 28px;"   >[root@localhost ~]# python test.py<br>2000000<br>TID:2 1423079875.4572093<br>TID:3 1423079875.4576375<br>TID:1 1423079875.4596934<br>TID:0 1423079875.4600854<br>TID:4 1423079875.4589622<br>TID:5 1423079875.4653761<br>TID:6 1423079875.463017<br>TID:7 1423079875.4694664<br>TID:7 1423080235.7239776<br>360.2545111179352<br>TID:3 1423080236.109339<br>360.6517014503479<br>TID:4 1423080236.1194305<br>360.66046833992004<br>TID:1 1423080236.260948<br>360.8012545108795<br>TID:2 1423080236.5218844<br>361.06467509269714<br>TID:5 1423080236.6404896<br>361.17511343955994<br>TID:0 1423080236.6446981<br>361.1846127510071<br>TID:6 1423080236.6607506<br>361.1977336406708</span></div><p style="line-height: 28px;"   ></p></pre></div></font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><br></span></div><div style="line-height: 28px;"   >更新, 插入, 查询综合测试 :&nbsp;</div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >import threading</font></div><div><font size="2"   >import time</font></div><div><font size="2"   >import pymongo</font></div><div><font size="2"   >import random</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >c=pymongo.MongoClient('/tmp/mongodb-5281.sock')</font></div><div><font size="2"   >db = c.test_database</font></div><div><font size="2"   ># db.drop_collection('test_collection')</font></div><div><font size="2"   >collection = db.test_collection</font></div><div><font size="2"   >print(collection.count())</font></div><div><font size="2"   ># for i in range(0,1000000):</font></div><div><font size="2"   ># &nbsp; collection.insert({'id':i, 'username': 'digoal.zhou', 'age':32, 'email':'digoal@126.com', 'qq':'276732431'})</font></div><div><font size="2"   ># collection.create_index("id")</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >class n_t(threading.Thread): &nbsp; #The timer class is derived from the class threading.Thread</font></div><div><font size="2"   >&nbsp; def __init__(self, num):</font></div><div><font size="2"   >&nbsp; &nbsp; threading.Thread.__init__(self)</font></div><div><font size="2"   >&nbsp; &nbsp; self.thread_num = num</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; def run(self): #Overwrite run() method, put what you want the thread do here</font></div><div><font size="2"   >&nbsp; &nbsp; c=pymongo.MongoClient('/tmp/mongodb-5281.sock')</font></div><div><font size="2"   >&nbsp; &nbsp; db = c.test_database</font></div><div><font size="2"   >&nbsp; &nbsp; collection = db.test_collection</font></div><div><font size="2"   >&nbsp; &nbsp; start_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(start_t))</font></div><div><font size="2"   >&nbsp; &nbsp; for i in range(0,125000):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; collection.insert({'id':random.randrange(1000001,2000000), 'username': 'digoal.zhou', 'age':32, 'email':'digoal@126.com', 'qq':'276732431'})</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; collection.update({'id':random.randrange(0,1000000)}, {'$set': {'age': random.randrange(0,1000000)}})</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; collection.find_one({'id': random.randrange(0,1000000)})</font></div><div><font size="2"   >&nbsp; &nbsp; stop_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(stop_t))</font></div><div><font size="2"   >&nbsp; &nbsp; print(stop_t-start_t)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >def test():</font></div><div><font size="2"   >&nbsp; t_names = dict()</font></div><div><font size="2"   >&nbsp; for i in range(0,8):</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i] = n_t(i)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i].start()</font></div><div><font size="2"   >&nbsp; return</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if __name__ == '__main__':</font></div><div><font size="2"   >&nbsp; test()</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >测试结果1150秒 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >[root@localhost ~]# python test.py<br>2000000<br>TID:0 1423080359.006871<br>TID:1 1423080359.0083587<br>TID:2 1423080359.009925<br>TID:4 1423080359.0124109<br>TID:3 1423080359.015088<br>TID:5 1423080359.0179524<br>TID:6 1423080359.0209677<br>TID:7 1423080359.0235417<br>TID:4 1423081508.11507<br>1149.1026592254639<br>TID:7 1423081508.1888452<br>1149.1653034687042<br>TID:2 1423081508.2641344<br>1149.2542095184326<br>TID:1 1423081508.3973265<br>1149.3889677524567<br>TID:0 1423081508.5400703<br>1149.5331993103027<br>TID:6 1423081508.594207<br>1149.573239326477<br>TID:5 1423081509.0279126<br>1150.0099601745605<br>TID:3 1423081509.0943637<br>1150.0792756080627</span></font></div><p></p></pre></div><div><br></div><div>PostgreSQL :&nbsp;</div><div>更新测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >import threading</font></div><div><font size="2"   >import time</font></div><div><font size="2"   >import postgresql</font></div><div><font size="2"   >import random</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >conn = { "user": "postgres",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"database": "postgres",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"unix": "/data01/pgdata/pg_root/.s.PGSQL.1921"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >db = postgresql.open(**conn)</font></div><div><font size="2"   >db.execute("drop table if exists tt")</font></div><div><font size="2"   >db.execute("create table tt(id int, username name, age int2, email text, qq text)")</font></div><div><font size="2"   >ins = db.prepare("insert into tt values($1,$2,$3,$4,$5)")</font></div><div><font size="2"   >for i in range(0,1000000):</font></div><div><font size="2"   >&nbsp; ins(i,'digoal.zhou',32,'digoal@126.com','276732431')</font></div><div><font size="2"   >db.execute("create index idx_tt_id on tt(id)")</font></div><div><font size="2"   >print(db.query("select count(1) as a from tt"))</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >class n_t(threading.Thread): &nbsp; #The timer class is derived from the class threading.Thread</font></div><div><font size="2"   >&nbsp; def __init__(self, num):</font></div><div><font size="2"   >&nbsp; &nbsp; threading.Thread.__init__(self)</font></div><div><font size="2"   >&nbsp; &nbsp; self.thread_num = num</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; def run(self): #Overwrite run() method, put what you want the thread do here</font></div><div><font size="2"   >&nbsp; &nbsp; conn = { "user": "postgres",&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"database": "postgres",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"unix": "/data01/pgdata/pg_root/.s.PGSQL.1921"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; db = postgresql.open(**conn)</font></div><div><font size="2"   >&nbsp; &nbsp; upd = db.prepare("update tt set age=$1 where id=$2")</font></div><div><font size="2"   >&nbsp; &nbsp; start_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(start_t))</font></div><div><font size="2"   >&nbsp; &nbsp; for i in range(0,125000):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; upd(random.randrange(0,100), random.randrange(0,1000000))</font></div><div><font size="2"   >&nbsp; &nbsp; stop_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(stop_t))</font></div><div><font size="2"   >&nbsp; &nbsp; print(stop_t-start_t)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >def test():</font></div><div><font size="2"   >&nbsp; t_names = dict()</font></div><div><font size="2"   >&nbsp; for i in range(0,8):</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i] = n_t(i)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i].start()</font></div><div><font size="2"   >&nbsp; return</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if __name__ == '__main__':</font></div><div><font size="2"   >&nbsp; test()</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >测试结果244秒 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >TID:0 1423072792.0481002</font></div><div><font size="2"   >TID:1 1423072792.050467</font></div><div><font size="2"   >TID:3 1423072792.0514963</font></div><div><font size="2"   >TID:2 1423072792.051693</font></div><div><font size="2"   >TID:5 1423072792.059382</font></div><div><font size="2"   >TID:4 1423072792.0605848</font></div><div><font size="2"   >TID:7 1423072792.0643597</font></div><div><font size="2"   >TID:6 1423072792.0657377</font></div><div><font size="2"   >TID:2 1423073034.8827112</font></div><div><font size="2"   >242.8310182094574</font></div><div><font size="2"   >TID:5 1423073035.024978</font></div><div><font size="2"   >242.96559596061707</font></div><div><font size="2"   >TID:4 1423073035.2550452</font></div><div><font size="2"   >243.1944603919983</font></div><div><font size="2"   >TID:7 1423073035.5245414</font></div><div><font size="2"   >243.46018171310425</font></div><div><font size="2"   >TID:1 1423073036.0639975</font></div><div><font size="2"   >244.0135304927826</font></div><div><font size="2"   >TID:3 1423073036.3519847</font></div><div><font size="2"   >244.30048847198486</font></div><div><font size="2"   >TID:0 1423073036.5292883</font></div><div><font size="2"   >244.48118805885315</font></div><div><font size="2"   >TID:6 1423073036.5383787</font></div><div><font size="2"   >244.47264099121094</font></div><p></p></pre></div><div><br></div><div>查询测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >import threading</font></div><div><font size="2"   >import time</font></div><div><font size="2"   >import postgresql</font></div><div><font size="2"   >import random</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >conn = { "user": "postgres",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"database": "postgres",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"unix": "/data01/pgdata/pg_root/.s.PGSQL.1921"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >db = postgresql.open(**conn)</font></div><div><font size="2"   ># db.execute("drop table if exists tt")</font></div><div><font size="2"   ># db.execute("create table tt(id int, username name, age int2, email text, qq text)")</font></div><div><font size="2"   ># ins = db.prepare("insert into tt values($1,$2,$3,$4,$5)")</font></div><div><font size="2"   ># for i in range(0,1000000):</font></div><div><font size="2"   ># &nbsp; ins(i,'digoal.zhou',32,'digoal@126.com','276732431')</font></div><div><font size="2"   ># db.execute("create index idx_tt_id on tt(id)")</font></div><div><font size="2"   >print(db.query("select count(1) as a from tt"))</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >class n_t(threading.Thread): &nbsp; #The timer class is derived from the class threading.Thread</font></div><div><font size="2"   >&nbsp; def __init__(self, num):</font></div><div><font size="2"   >&nbsp; &nbsp; threading.Thread.__init__(self)</font></div><div><font size="2"   >&nbsp; &nbsp; self.thread_num = num</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; def run(self): #Overwrite run() method, put what you want the thread do here</font></div><div><font size="2"   >&nbsp; &nbsp; conn = { "user": "postgres",&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"database": "postgres",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"unix": "/data01/pgdata/pg_root/.s.PGSQL.1921"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; db = postgresql.open(**conn)</font></div><div><font size="2"   >&nbsp; &nbsp; sel = db.prepare("select * from tt where id=$1 limit 1")</font></div><div><font size="2"   >&nbsp; &nbsp; start_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(start_t))</font></div><div><font size="2"   >&nbsp; &nbsp; for i in range(0,125000):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; sel(random.randrange(0,1000000))</font></div><div><font size="2"   >&nbsp; &nbsp; stop_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(stop_t))</font></div><div><font size="2"   >&nbsp; &nbsp; print(stop_t-start_t)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >def test():</font></div><div><font size="2"   >&nbsp; t_names = dict()</font></div><div><font size="2"   >&nbsp; for i in range(0,8):</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i] = n_t(i)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i].start()</font></div><div><font size="2"   >&nbsp; return</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if __name__ == '__main__':</font></div><div><font size="2"   >&nbsp; test()</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >测试结果438秒 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@localhost-&gt; python test.py</font></div><div><font size="2"   >[(1000000,)]</font></div><div><font size="2"   >TID:2 1423081634.6041436</font></div><div><font size="2"   >TID:1 1423081634.6072564</font></div><div><font size="2"   >TID:5 1423081634.6098883</font></div><div><font size="2"   >TID:0 1423081634.6110475</font></div><div><font size="2"   >TID:6 1423081634.611464</font></div><div><font size="2"   >TID:7 1423081634.6147678</font></div><div><font size="2"   >TID:3 1423081634.617597</font></div><div><font size="2"   >TID:4 1423081634.6184704</font></div><div><font size="2"   >TID:7 1423082070.8112974</font></div><div><font size="2"   >436.1965296268463</font></div><div><font size="2"   >TID:4 1423082071.5796437</font></div><div><font size="2"   >436.96117329597473</font></div><div><font size="2"   >TID:5 1423082071.6695313</font></div><div><font size="2"   >437.0596430301666</font></div><div><font size="2"   >TID:0 1423082071.8521369</font></div><div><font size="2"   >437.24108934402466</font></div><div><font size="2"   >TID:1 1423082072.5634701</font></div><div><font size="2"   >437.95621371269226</font></div><div><font size="2"   >TID:2 1423082072.678791</font></div><div><font size="2"   >438.0746474266052</font></div><div><font size="2"   >TID:3 1423082072.9825838</font></div><div><font size="2"   >438.3649866580963</font></div><div><font size="2"   >TID:6 1423082072.9963892</font></div><div><font size="2"   >438.3849251270294</font></div><p></p></pre></div><div><span style="line-height: 28px;"   ><br></span></div><div>更新, 插入, 查询综合测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >import threading</font></div><div><font size="2"   >import time</font></div><div><font size="2"   >import postgresql</font></div><div><font size="2"   >import random</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >conn = { "user": "postgres",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"database": "postgres",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"unix": "/data01/pgdata/pg_root/.s.PGSQL.1921"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >db = postgresql.open(**conn)</font></div><div><font size="2"   ># db.execute("drop table if exists tt")</font></div><div><font size="2"   ># db.execute("create table tt(id int, username name, age int2, email text, qq text)")</font></div><div><font size="2"   ># ins = db.prepare("insert into tt values($1,$2,$3,$4,$5)")</font></div><div><font size="2"   ># for i in range(0,1000000):</font></div><div><font size="2"   ># &nbsp; ins(i,'digoal.zhou',32,'digoal@126.com','276732431')</font></div><div><font size="2"   ># db.execute("create index idx_tt_id on tt(id)")</font></div><div><font size="2"   >print(db.query("select count(1) as a from tt"))</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >class n_t(threading.Thread): &nbsp; #The timer class is derived from the class threading.Thread</font></div><div><font size="2"   >&nbsp; def __init__(self, num):</font></div><div><font size="2"   >&nbsp; &nbsp; threading.Thread.__init__(self)</font></div><div><font size="2"   >&nbsp; &nbsp; self.thread_num = num</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; def run(self): #Overwrite run() method, put what you want the thread do here</font></div><div><font size="2"   >&nbsp; &nbsp; conn = { "user": "postgres",&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"database": "postgres",</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"unix": "/data01/pgdata/pg_root/.s.PGSQL.1921"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; db = postgresql.open(**conn)</font></div><div><font size="2"   >&nbsp; &nbsp; ins = db.prepare("insert into tt values($1,$2,$3,$4,$5)")</font></div><div><font size="2"   >&nbsp; &nbsp; upd = db.prepare("update tt set age=$1 where id=$2")</font></div><div><font size="2"   >&nbsp; &nbsp; sel = db.prepare("select * from tt where id=$1")</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; start_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(start_t))</font></div><div><font size="2"   >&nbsp; &nbsp; for i in range(0,125000):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; ins(random.randrange(1000001,2000000),'digoal.zhou',32,'digoal@126.com','276732431')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; upd(random.randrange(0,100), random.randrange(0,1000000))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; sel(random.randrange(0,1000000))</font></div><div><font size="2"   >&nbsp; &nbsp; stop_t = time.time()</font></div><div><font size="2"   >&nbsp; &nbsp; print("TID:" + str(self.thread_num) + " " + str(stop_t))</font></div><div><font size="2"   >&nbsp; &nbsp; print(stop_t-start_t)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >def test():</font></div><div><font size="2"   >&nbsp; t_names = dict()</font></div><div><font size="2"   >&nbsp; for i in range(0,8):</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i] = n_t(i)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; t_names[i].start()</font></div><div><font size="2"   >&nbsp; return</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if __name__ == '__main__':</font></div><div><font size="2"   >&nbsp; test()</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >测试结果938秒 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@localhost-&gt; python test.py</font></div><div><font size="2"   >[(1000000,)]</font></div><div><font size="2"   >TID:0 1423083626.888068</font></div><div><font size="2"   >TID:2 1423083626.8912995</font></div><div><font size="2"   >TID:1 1423083626.8920445</font></div><div><font size="2"   >TID:3 1423083626.893638</font></div><div><font size="2"   >TID:4 1423083626.8974612</font></div><div><font size="2"   >TID:6 1423083626.9039218</font></div><div><font size="2"   >TID:5 1423083626.9061637</font></div><div><font size="2"   >TID:7 1423083626.908666</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >TID:5 1423084561.3804135</font></div><div><font size="2"   >934.4742498397827</font></div><div><font size="2"   >TID:6 1423084563.4344044</font></div><div><font size="2"   >936.5304825305939</font></div><div><font size="2"   >TID:2 1423084564.1677904</font></div><div><font size="2"   >937.2764909267426</font></div><div><font size="2"   >TID:0 1423084564.5768228</font></div><div><font size="2"   >937.6887547969818</font></div><div><font size="2"   >TID:4 1423084564.839536</font></div><div><font size="2"   >937.9420747756958</font></div><div><font size="2"   >TID:1 1423084564.9242597</font></div><div><font size="2"   >938.0322151184082</font></div><div><font size="2"   >TID:7 1423084565.0638845</font></div><div><font size="2"   >938.1552186012268</font></div><div><font size="2"   >TID:3 1423084565.345857</font></div><div><font size="2"   >938.4522190093994</font></div><p></p></pre></div><div><br></div><div>PostgreSQL使用pgbench的测试结果 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># 初始化数据</font></div><div><font size="2"   >psql</font></div><div><font size="2"   >truncate tt;</font></div><div><font size="2"   >insert into tt select generate_series(1,1000000),<span style="line-height: 28px;"   >&nbsp;</span><span style="line-height: 28px;"   >'digoal.zhou',32,'digoal@126.com','276732431';</span></font></div><p></p></pre></div><div><span style="line-height: 28px;"   >更新</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@localhost-&gt; vi test.sql</font></div><div><font size="2"   >\setrandom v_id 0 1000000</font></div><div><font size="2"   >\setrandom v_age 0 100</font></div><div><font size="2"   >update tt set age=:v_age where id=:v_id;</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >测试结果32秒 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@localhost-&gt; pgbench -M prepared -n -r -f ./test.sql -c 8 -j 4 -t 125000</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 8</font></div><div><font size="2"   >number of threads: 4</font></div><div><font size="2"   >number of transactions per client: 125000</font></div><div><font size="2"   >number of transactions actually processed: 1000000/1000000</font></div><div><font size="2"   >tps = 31631.177435 (including connections establishing)</font></div><div><font size="2"   >tps = 31637.366682 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.002963 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom v_id 0 1000000</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.000671 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom v_age 0 100</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.232106 &nbsp; &nbsp; &nbsp; &nbsp;update tt set age=:v_age where id=:v_id;</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >查询</span></div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >postgres@localhost-&gt; vi test.sql</font></div><div style="line-height: 28px;"   ><font size="2"   >\setrandom v_id 0 1000000</font></div><div style="line-height: 28px;"   ><font size="2"   >select * from tt where id=:v_id;</font></div><p></p></pre></div></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >测试结果15秒 :&nbsp;</span></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >postgres@localhost-&gt; pgbench -M prepared -n -r -f ./test.sql -c 8 -j 4 -t 125000</font></div><div style="line-height: 28px;"   ><font size="2"   >transaction type: Custom query</font></div><div style="line-height: 28px;"   ><font size="2"   >scaling factor: 1</font></div><div style="line-height: 28px;"   ><font size="2"   >query mode: prepared</font></div><div style="line-height: 28px;"   ><font size="2"   >number of clients: 8</font></div><div style="line-height: 28px;"   ><font size="2"   >number of threads: 4</font></div><div style="line-height: 28px;"   ><font size="2"   >number of transactions per client: 125000</font></div><div style="line-height: 28px;"   ><font size="2"   >number of transactions actually processed: 1000000/1000000</font></div><div style="line-height: 28px;"   ><font size="2"   >tps = 66487.929382 (including connections establishing)</font></div><div style="line-height: 28px;"   ><font size="2"   >tps = 66514.422913 (excluding connections establishing)</font></div><div style="line-height: 28px;"   ><font size="2"   >statement latencies in milliseconds:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.002007 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom v_id 0 1000000</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.104391 &nbsp; &nbsp; &nbsp; &nbsp;select * from tt where id=:v_id;</font></div><p></p></pre></div></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >插入, 更新, 查询</span></div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 28px;"   ><font size="2"   >postgres@localhost-&gt; vi test.sql</font></div><div style="line-height: 28px;"   ><font size="2"   >\setrandom v_newid 1000001 2000000</font></div><div style="line-height: 28px;"   ><font size="2"   >\setrandom v_id 0 1000000</font></div><div style="line-height: 28px;"   ><font size="2"   >\setrandom v_age 0 100</font></div><div style="line-height: 28px;"   ><font size="2"   >insert into tt values(:v_newid,&nbsp;<span style="line-height: 28px;"   >'digoal.zhou',32,'digoal@126.com','276732431'</span>);</font></div><div style="line-height: 28px;"   ><font size="2"   >update tt set age=:v_age where id=:v_id;</font></div></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >select * from tt where id=:v_id;</font></span></div><p></p></pre></div></div><div><span style="line-height: 28px;"   >测试结果耗时69秒 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@localhost-&gt; pgbench -M prepared -n -r -f ./test.sql -c 8 -j 4 -t 125000</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 8</font></div><div><font size="2"   >number of threads: 4</font></div><div><font size="2"   >number of transactions per client: 125000</font></div><div><font size="2"   >number of transactions actually processed: 1000000/1000000</font></div><div><font size="2"   >tps = 14429.720005 (including connections establishing)</font></div><div><font size="2"   >tps = 14431.006796 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003031 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom v_newid 1000001 2000000</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.000816 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom v_id 0 1000000</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.000733 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom v_age 0 100</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.150249 &nbsp; &nbsp; &nbsp; &nbsp;insert into tt values(:v_newid, 'digoal.zhou',32,'digoal@126.com','276732431');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.180603 &nbsp; &nbsp; &nbsp; &nbsp;update tt set age=:v_age where id=:v_id;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.190850 &nbsp; &nbsp; &nbsp; &nbsp;select * from tt where id=:v_id;</font></div><p></p></pre></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >[小结]</span></div><div><span style="line-height: 28px;"   >python 测试结果 :&nbsp;</span></div><div><span style="line-height: 28px;"   >mongoDB&nbsp;</span></div><div><span style="line-height: 28px;"   >插入100W记录耗时 - 364秒</span></div><div><span style="line-height: 28px;"   >更新100W记录耗时 - 379</span><span style="line-height: 28px;"   >秒</span></div><div><span style="line-height: 28px;"   >100W记录索引检索100W次耗时 - 361</span><span style="line-height: 28px;"   >秒</span></div><div><span style="line-height: 28px;"   >综合测试, 插入</span><span style="line-height: 28px;"   >100W记录</span><span style="line-height: 28px;"   >, 更新</span><span style="line-height: 28px;"   >100W记录</span><span style="line-height: 28px;"   >, 查询</span><span style="line-height: 28px;"   >100W次耗时 - 1150</span><span style="line-height: 28px;"   >秒</span></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >PostgreSQL</span></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >插入100W记录耗时 - 226秒.</span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >更新100W记录耗时 - 244</span><span style="line-height: 28px;"   >秒.</span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >100W记录索引检索100W次耗时 - 438</span><span style="line-height: 28px;"   >秒.</span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >综合测试, 插入</span><span style="line-height: 28px;"   >100W记录</span><span style="line-height: 28px;"   >, 更新</span><span style="line-height: 28px;"   >100W记录</span><span style="line-height: 28px;"   >, 查询</span><span style="line-height: 28px;"   >100W次耗时 - 938</span><span style="line-height: 28px;"   >秒.</span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><br></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >PostgreSQL 使用pgbench测试结果 :&nbsp;</span></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >插入100W记录耗时 - 16秒</span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >更新100W记录耗时 - 32</span><span style="line-height: 28px;"   >秒.</span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >100W记录索引检索100W次耗时 - 15</span><span style="line-height: 28px;"   >秒.</span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >综合测试, 插入</span><span style="line-height: 28px;"   >100W记录</span><span style="line-height: 28px;"   >, 更新</span><span style="line-height: 28px;"   >100W记录</span><span style="line-height: 28px;"   >, 查询</span><span style="line-height: 28px;"   >100W次耗时 - 69</span><span style="line-height: 28px;"   >秒.</span></div></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><br></span></div></div><div>[参考]</div>1.&nbsp;<wbr><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020151435825593/"   >http://blog.163.com/digoal@126/blog/static/16387704020151435825593/</a><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402015142858224/"   >http://blog.163.com/digoal@126/blog/static/1638770402015142858224/</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020151210840303/"   >http://blog.163.com/digoal@126/blog/static/16387704020151210840303/</a></div><div>4.&nbsp;<a target="_blank" rel="nofollow" href="http://api.mongodb.org/python/current/api/pymongo/connection.html"   >http://api.mongodb.org/python/current/api/pymongo/connection.html</a></div><div>5.&nbsp;<a target="_blank" rel="nofollow" href="http://pythonhosted.org//py-postgresql/driver.html#queries"   >http://pythonhosted.org//py-postgresql/driver.html#queries</a></div><div>6.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://docs.python.org/2/library/random.html#module-random"   >https://docs.python.org/2/library/random.html#module-random</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="mongoDB VS PostgreSQL dml performance use python - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>