<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">why PostgreSQL - jdbc getTables error</h2>
	<h5 id="">2011-12-23 8:05:39&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402011112374227293/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>一个生产系统的报错 :&nbsp;</div><div>2011-12-23 00:00:22.046 CST,"mmochat","mmochat3",2393,"127.0.0.1:35406",4ef34f4d.959,4,"PARSE",2011-12-22 23:39:57 CST,123/0,53282411,ERROR,25P02,"current transaction is aborted, commands ignored until end of transaction block",,,,,,"SELECT NULL AS TABLE_CAT, n.nspname AS TABLE_SCHEM, c.relname AS TABLE_NAME, &nbsp;CASE n.nspname ~ '^pg_' OR n.nspname = 'information_schema' &nbsp;WHEN true THEN CASE &nbsp;WHEN n.nspname = 'pg_catalog' OR n.nspname = 'information_schema' THEN CASE c.relkind &nbsp; WHEN 'r' THEN 'SYSTEM TABLE' &nbsp; WHEN 'v' THEN 'SYSTEM VIEW' &nbsp; WHEN 'i' THEN 'SYSTEM INDEX' &nbsp; ELSE NULL &nbsp; END &nbsp;WHEN n.nspname = 'pg_toast' THEN CASE c.relkind &nbsp; WHEN 'r' THEN 'SYSTEM TOAST TABLE' &nbsp; WHEN 'i' THEN 'SYSTEM TOAST INDEX' &nbsp; ELSE NULL &nbsp; END &nbsp;ELSE CASE c.relkind &nbsp; WHEN 'r' THEN 'TEMPORARY TABLE' &nbsp; WHEN 'i' THEN 'TEMPORARY INDEX' &nbsp; ELSE NULL &nbsp; END &nbsp;END &nbsp;WHEN false THEN CASE c.relkind &nbsp;WHEN 'r' THEN 'TABLE' &nbsp;WHEN 'i' THEN 'INDEX' &nbsp;WHEN 'S' THEN 'SEQUENCE' &nbsp;WHEN 'v' THEN 'VIEW' &nbsp;ELSE NULL &nbsp;END &nbsp;ELSE NULL &nbsp;END &nbsp;AS TABLE_TYPE, d.description AS REMARKS &nbsp;FROM pg_catalog.pg_namespace n, pg_catalog.pg_class c &nbsp;LEFT JOIN pg_catalog.pg_description d ON (c.oid = d.objoid AND d.objsubid = 0) &nbsp;LEFT JOIN pg_catalog.pg_class dc ON (d.classoid=dc.oid AND dc.relname='pg_class') &nbsp;LEFT JOIN pg_catalog.pg_namespace dn ON (dn.oid=dc.relnamespace AND dn.nspname='pg_catalog') &nbsp;WHERE c.relnamespace = n.oid &nbsp;AND c.relname LIKE 'PROBABLYNOT' &nbsp;AND (false &nbsp;OR ( c.relkind = 'r' AND n.nspname !~ '^pg_' AND n.nspname &lt;&gt; 'information_schema' ) ) &nbsp;ORDER BY TABLE_TYPE,TABLE_SCHEM,TABLE_NAME ",,,""</div><div><br></div><div>首先要知道这句SQL来自什么地方, 是谁发起的请求?</div><div>这句SQL来自postgresql-jdbc驱动,&nbsp;</div><div>源码文件在 :&nbsp;</div><div>org/postgresql/jdbc2/AbstractJdbc2DatabaseMetaData.java</div><div><br></div><div>然后分析这个问题,&nbsp;问题并不在SQL, 因为执行是没有问题的, 而是<span style="line-height: 22px;"  >current transaction is aborted, commands ignored until end of transaction block</span></div><div><span style="line-height: 22px;"  >解决这个问题需要知道在调用getTables之前还有哪些动作, 那些才是引发这个报错的原因.为什么这么说呢? 来看一个例子 :&nbsp;</span></div><div><span style="line-height: 22px;"  ><div>digoal=&gt; create table test (id int check (id&lt;10));</div><div>CREATE TABLE</div><div>digoal=&gt; begin;</div><div>BEGIN</div><div>digoal=&gt; insert into test values(10);</div><div>ERROR: &nbsp;new row for relation "test" violates check constraint "test_id_check"</div><div>digoal=&gt; insert into test values(9);</div><div>ERROR: &nbsp;current transaction is aborted, commands ignored until end of transaction block</div><div>digoal=&gt; end;</div><div>ROLLBACK</div><div>数据库日志如下 :&nbsp;</div><div><div>2011-12-23 07:48:24.516 CST,"digoal","digoal",18551,"127.0.0.1:26509",4ef3c1a1.4877,5,"INSERT",2011-12-23 07:47:45 CST,2/98,0,ERROR,23514,"new row for relation ""test"" violates check constraint ""test_id_check""",,,,,,"insert into test values(10);",,,"psql"</div><div>2011-12-23 07:48:28.309 CST,"digoal","digoal",18551,"127.0.0.1:26509",4ef3c1a1.4877,6,"INSERT",2011-12-23 07:47:45 CST,2/0,0,ERROR,25P02,"current transaction is aborted, commands ignored until end of transaction block",,,,,,"insert into test values(9);",,,"psql"</div></div><div>在这两条错误中</div><div>SESSION_ID=<span style="line-height: 22px;"  >4ef3c1a1.4877</span></div><div><span style="line-height: 22px;"  >SESSION_LINE_NUM=5, 6</span></div><div><span style="line-height: 22px;"  >transaction_id=0</span></div><div><span style="line-height: 22px;"  ><br></span></div><div><span style="line-height: 22px;"  >好的，接下来分析生产系统的问题, 看看生产系统中报错的</span></div><div><span style="line-height: 22px;"  >SESSION_ID =</span>&nbsp;<span style="line-height: 22px;"  >4ef34f4d.959,4</span> </div><div><span style="line-height: 22px;"  >transaction_id=&nbsp;</span><span style="line-height: 22px;"  >53282411</span></div><div>再次到生产系统中根据这两个号去查，查到在这条报错的上一条报错满足我们的需求,如下 :&nbsp;</div><div><div>2011-12-23 00:00:22.045 CST,"mmochat","mmochat3",2393,"127.0.0.1:35406",4ef34f4d.959,3,"INSERT",2011-12-22 23:39:57 CST,123/248970,5</div><div>3282411,ERROR,23505,"duplicate key value violates unique constraint ""role_name_key""","Key (name)=(雪落无痕) already exists.",,,,,"</div><div>insert into role(skyid, name, sexual, family, type, friendlist_bmp, latest_login_time, latest_offline_time, suggest_name, create_tim</div><div>e, imei) values($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)",,,""</div></div><div>根源就是这了。就是说getTables和这条应用发出的SQL请求封装在一个事务中，并且这条应用的SQL刚好也失败了，导致事务失败, 也就是后面的getTables失败。</div></span></div><div>那么，为什么getTables要和应用的SQL搅和在一起呢？这个要问postgreSQL-jdbc的开发者了。</div><div>也许是为了减少与数据库的交互次数.</div><div><br></div><div>小结 :&nbsp;</div><div>1. getTables是不是一个问题？该不该有？</div><div>&nbsp; &nbsp; &nbsp; &nbsp; 从postgresql-jdbc得到的描述是这样的,<span style="line-height: 22px;"  >Get a description of tables available in a catalog.</span></div><div><span style="line-height: 22px;"  >&nbsp; &nbsp; &nbsp; &nbsp; 异常的捕获是</span><span style="line-height: 22px;"  >exception SQLException if a database-access error occurs.</span></div><div><span style="line-height: 22px;"  >&nbsp; &nbsp; &nbsp; &nbsp; 看起来没有多大必要, 有开关的话尽量关掉无谓的请求. 如果只是为了捕获这个异常, 业务系统应该也可以解决的.&nbsp;</span></div><div>2. 为什么getTables会报错?</div><div>&nbsp; &nbsp; &nbsp; &nbsp; 前面已经分析过了, 因为getTables与业务系统发起的SQL请求封装在一个事务中, 如果业务系统发出的SQL请求失败了, 再提交getTables的 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 请求将失败.</div><div><br></div><div>参考 :&nbsp;</div><div><pre style="font-size: 12px; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; padding-top: 2ex; padding-right: 2ex; padding-bottom: 2ex; padding-left: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow-x: auto; overflow-y: auto; border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; border-top-color: rgb(207, 207, 207); border-right-color: rgb(207, 207, 207); border-bottom-color: rgb(207, 207, 207); border-left-color: rgb(207, 207, 207); line-height: normal;"  >CREATE TABLE postgres_log (   log_time timestamp(3) with time zone,   user_name text,   database_name text,   process_id integer,   connection_from text,   session_id text,   session_line_num bigint,   command_tag text,   session_start_time timestamp with time zone,   virtual_transaction_id text,   transaction_id bigint,   error_severity text,   sql_state_code text,   message text,   detail text,   hint text,   internal_query text,   internal_query_pos integer,   context text,   query text,   query_pos integer,   location text,   application_name text,   PRIMARY KEY (session_id, session_line_num) );</pre></div><div><br></div><div><a rel="nofollow" href="http://jdbc.postgresql.org/"  >http://jdbc.postgresql.org/</a> </div><div><span style="line-height: 22px;"  >org/postgresql/jdbc2/AbstractJdbc2DatabaseMetaData.java</span> </div><div><div>/*</div><div>&nbsp; &nbsp; &nbsp;* Get a description of tables available in a catalog.</div><div>&nbsp; &nbsp; &nbsp;*</div><div>&nbsp; &nbsp; &nbsp;* &lt;p&gt;Only table descriptions matching the catalog, schema, table</div><div>&nbsp; &nbsp; &nbsp;* name and type criteria are returned. They are ordered by</div><div>&nbsp; &nbsp; &nbsp;* TABLE_TYPE, TABLE_SCHEM and TABLE_NAME.</div><div>&nbsp; &nbsp; &nbsp;*</div><div>&nbsp; &nbsp; &nbsp;* &lt;p&gt;Each table description has the following columns:</div><div>&nbsp; &nbsp; &nbsp;*</div><div>&nbsp; &nbsp; &nbsp;* &lt;ol&gt;</div><div>&nbsp; &nbsp; &nbsp;* &lt;li&gt;&lt;b&gt;TABLE_CAT&lt;/b&gt; String =&gt; table catalog (may be null)</div><div>&nbsp; &nbsp; &nbsp;* &lt;li&gt;&lt;b&gt;TABLE_SCHEM&lt;/b&gt; String =&gt; table schema (may be null)</div><div>&nbsp; &nbsp; &nbsp;* &lt;li&gt;&lt;b&gt;TABLE_NAME&lt;/b&gt; String =&gt; table name</div><div>&nbsp; &nbsp; &nbsp;* &lt;li&gt;&lt;b&gt;TABLE_TYPE&lt;/b&gt; String =&gt; table type. Typical types are "TABLE",</div><div>&nbsp; &nbsp; &nbsp;* "VIEW", "SYSTEM TABLE", "GLOBAL TEMPORARY", "LOCAL</div><div>&nbsp; &nbsp; &nbsp;* TEMPORARY", "ALIAS", "SYNONYM".</div><div>&nbsp; &nbsp; &nbsp;* &lt;li&gt;&lt;b&gt;REMARKS&lt;/b&gt; String =&gt; explanatory comment on the table</div><div>&nbsp; &nbsp; &nbsp;* &lt;/ol&gt;</div><div>&nbsp; &nbsp; &nbsp;*</div><div>&nbsp; &nbsp; &nbsp;* &lt;p&gt;The valid values for the types parameter are:</div><div>&nbsp; &nbsp; &nbsp;* "TABLE", "INDEX", "SEQUENCE", "VIEW", "TYPE"</div><div>&nbsp; &nbsp; &nbsp;* "SYSTEM TABLE", "SYSTEM INDEX", "SYSTEM VIEW",</div><div>&nbsp; &nbsp; &nbsp;* "SYSTEM TOAST TABLE", "SYSTEM TOAST INDEX",</div><div>&nbsp; &nbsp; &nbsp;* "TEMPORARY TABLE", "TEMPORARY VIEW", "TEMPORARY INDEX",</div><div>&nbsp; &nbsp; &nbsp;* "TEMPORARY SEQUENCE", "FOREIGN TABLE".</div><div>&nbsp; &nbsp; &nbsp;*</div><div>&nbsp; &nbsp; &nbsp;* @param catalog a catalog name; For org.postgresql, this is ignored, and</div><div>&nbsp; &nbsp; &nbsp;* should be set to null</div><div>&nbsp; &nbsp; &nbsp;* @param schemaPattern a schema name pattern</div><div>&nbsp; &nbsp; &nbsp;* @param tableNamePattern a table name pattern. For all tables this should be "%"</div><div>&nbsp; &nbsp; &nbsp;* @param types a list of table types to include; null returns</div><div>&nbsp; &nbsp; &nbsp;* all types</div><div>&nbsp; &nbsp; &nbsp;* @return each row is a table description</div><div>&nbsp; &nbsp; &nbsp;* @exception SQLException if a database-access error occurs.</div><div>&nbsp; &nbsp; &nbsp;*/</div><div>&nbsp; &nbsp; public java.sql.ResultSet getTables(String catalog, String schemaPattern, String tableNamePattern, String types[]) throws SQLException</div><div>&nbsp; &nbsp;</div></div>【备注】<div>今天发这个问题发到qq群之后得到了孙博士的支持，</div><div><span style="line-height: 22px;"  >http://www.java2s.com/Open-Source/Java-Document/Database-JDBC-Connection-Pool/c3p0/com/mchange/v2/c3p0/impl/DefaultConnectionTester.java.htm&nbsp;</span> </div><div><span style="line-height: 22px;"  ><br></span></div><div>1. 可能是调用了某个连接池，连接池封装了这个语句，然后又加入了activeCheckConnectionNoQuery{ ...getTables(null, null, "PROBABLYNOT", ....} &nbsp; &nbsp;函数，以测试后续的连接是否还active，连接池的问题也可以看看.</div><div><br></div><div>以下摘自</div><div><span style="line-height: 22px;"  >http://www.java2s.com/Open-Source/Java-Document/Database-JDBC-Connection-Pool/c3p0/com/mchange/v2/c3p0/impl/DefaultConnectionTester.java.htm&nbsp;</span></div><div><div>&nbsp;private&nbsp;int&nbsp;activeCheckConnectionNoQuery(Connection&nbsp;c,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable[]&nbsp;rootCauseOutParamHolder)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Debug.DEBUG&nbsp;&amp;&amp;&nbsp;Debug.TRACE&nbsp;==&nbsp;Debug.TRACE_MAX&nbsp;&amp;&amp;&nbsp;logger.isLoggable(&nbsp;MLevel.FINER&nbsp;)&nbsp;)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.finer("Entering&nbsp;DefaultConnectionTester.activeCheckConnection(Connection&nbsp;c).&nbsp;[using&nbsp;default&nbsp;system-table&nbsp;query]");<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultSet&nbsp;rs&nbsp;=&nbsp;null;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rs&nbsp;=&nbsp;c.getMetaData().getTables(null,&nbsp;null,&nbsp;"PROBABLYNOT",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;String[]&nbsp;{&nbsp;"TABLE"&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;CONNECTION_IS_OKAY;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(SQLException&nbsp;e)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Debug.DEBUG&nbsp;&amp;&amp;&nbsp;logger.isLoggable(MLevel.FINE))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.log(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MLevel.FINE,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Connection&nbsp;"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;c<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;"&nbsp;failed&nbsp;default&nbsp;system-table&nbsp;Connection&nbsp;test&nbsp;with&nbsp;an&nbsp;Exception!",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rootCauseOutParamHolder&nbsp;!=&nbsp;null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rootCauseOutParamHolder[0]&nbsp;=&nbsp;e;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;state&nbsp;=&nbsp;e.getSQLState();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(INVALID_DB_STATES.contains(state))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(logger.isLoggable(MLevel.WARNING))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.log(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MLevel.WARNING,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"SQL&nbsp;State&nbsp;'"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;state<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;"'&nbsp;of&nbsp;Exception&nbsp;which&nbsp;occurred&nbsp;during&nbsp;a&nbsp;Connection&nbsp;test&nbsp;(fallback&nbsp;DatabaseMetaData&nbsp;test)&nbsp;implies&nbsp;that&nbsp;the&nbsp;database&nbsp;is&nbsp;invalid,&nbsp;"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;"and&nbsp;the&nbsp;pool&nbsp;should&nbsp;refill&nbsp;itself&nbsp;with&nbsp;fresh&nbsp;Connections.",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;DATABASE_IS_INVALID;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;CONNECTION_IS_INVALID;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Debug.DEBUG&nbsp;&amp;&amp;&nbsp;logger.isLoggable(MLevel.FINE))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.log(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MLevel.FINE,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Connection&nbsp;"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;c<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;"&nbsp;failed&nbsp;default&nbsp;system-table&nbsp;Connection&nbsp;test&nbsp;with&nbsp;an&nbsp;Exception!",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rootCauseOutParamHolder&nbsp;!=&nbsp;null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rootCauseOutParamHolder[0]&nbsp;=&nbsp;e;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;CONNECTION_IS_INVALID;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultSetUtils.attemptClose(rs);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Debug.DEBUG&nbsp;&amp;&amp;&nbsp;Debug.TRACE&nbsp;==&nbsp;Debug.TRACE_MAX&nbsp;&amp;&amp;&nbsp;logger.isLoggable(&nbsp;MLevel.FINER&nbsp;)&nbsp;)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.finer("Exiting&nbsp;DefaultConnectionTester.activeCheckConnection(Connection&nbsp;c).&nbsp;[using&nbsp;default&nbsp;system-table&nbsp;query]");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br></div></div></div>
	</div>
</div>
</body>
</html>