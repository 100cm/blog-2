<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64</h2>
	<h5 id="">2014-07-11 22:18:50&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201461124422865/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>安装Drupal的系统需求, 需要web server, database, php.</div><div><a target="_blank" rel="nofollow" href="https://www.drupal.org/requirements"   >https://www.drupal.org/requirements</a></div><div>本文以Drupal 7.28, Nginx 1.6, PostgrSQL 9.3.4, PHP 5.4为例写一下Drupal的部署.</div><div>不涉及任何优化, 例如使用fpm, 用unix sock连接效率会更高.</div><div><br></div><div>安装参考</div><div><a target="_blank" rel="nofollow" href="https://www.drupal.org/documentation/install"   >https://www.drupal.org/documentation/install</a></div><div><br></div><div>一. nginx 安装, 本文选择使用rpm安装 :&nbsp;</div><div>首先要把nginx的源添加进来.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi /etc/yum.repos.d/nginx.repo</font></div><div><div><font size="2"   >[nginx]</font></div><div><font size="2"   >name=nginx repo</font></div><div><font size="2"   >baseurl=http://nginx.org/packages/centos/6/$basearch/</font></div><div><font size="2"   >gpgcheck=0</font></div><div><font size="2"   >enabled=1</font></div></div><p></p></pre></div><div>使用yum安装nginx</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum install -y nginx</font></div><div><div><font size="2"   >Dependencies Resolved</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >====================================================================================================================================</font></div><div><font size="2"   >&nbsp;Package &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Arch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Version &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Repository &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size</font></div><div><font size="2"   >====================================================================================================================================</font></div><div><font size="2"   >Installing:</font></div><div><font size="2"   >&nbsp;nginx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x86_64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.6.0-1.el6.ngx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nginx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 335 k</font></div><div><font size="2"   >Transaction Summary</font></div><div><font size="2"   >====================================================================================================================================</font></div><div><font size="2"   >Install &nbsp; &nbsp; &nbsp; 1 Package(s)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   ># rpm -ql nginx</font></div><div><font size="2"   >/etc/logrotate.d/nginx</font></div><div><font size="2"   >/etc/nginx</font></div><div><font size="2"   >/etc/nginx/conf.d</font></div><div><font size="2"   >/etc/nginx/conf.d/default.conf</font></div><div><font size="2"   >/etc/nginx/conf.d/example_ssl.conf</font></div><div><font size="2"   >/etc/nginx/fastcgi_params</font></div><div><font size="2"   >/etc/nginx/koi-utf</font></div><div><font size="2"   >/etc/nginx/koi-win</font></div><div><font size="2"   >/etc/nginx/mime.types</font></div><div><font size="2"   >/etc/nginx/nginx.conf</font></div><div><font size="2"   >/etc/nginx/scgi_params</font></div><div><font size="2"   >/etc/nginx/uwsgi_params</font></div><div><font size="2"   >/etc/nginx/win-utf</font></div><div><font size="2"   >/etc/rc.d/init.d/nginx</font></div><div><font size="2"   >/etc/sysconfig/nginx</font></div><div><font size="2"   >/usr/sbin/nginx</font></div><div><font size="2"   >/usr/share/nginx</font></div><div><font size="2"   >/usr/share/nginx/html</font></div><div><font size="2"   >/usr/share/nginx/html/50x.html</font></div><div><font size="2"   >/usr/share/nginx/html/index.html</font></div><div><font size="2"   >/var/cache/nginx</font></div><div><font size="2"   >/var/log/nginx</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   ># id nginx</font></div><div><font size="2"   >uid=494(nginx) gid=490(nginx) groups=490(nginx)</font></div></div><p></p></pre></div><div><br></div><div>配置nginx, 可参考.</div><div><a target="_blank" rel="nofollow" href="http://www.howtoforge.com/installing-nginx-with-php5-and-php-fpm-and-mysql-support-lemp-on-ubuntu-12.04-lts"   >http://www.howtoforge.com/installing-nginx-with-php5-and-php-fpm-and-mysql-support-lemp-on-ubuntu-12.04-lts</a></div><div><a target="_blank" rel="nofollow" href="http://wiki.nginx.org/NginxFullExample"   >http://wiki.nginx.org/NginxFullExample</a></div><div><a target="_blank" rel="nofollow" href="http://wiki.nginx.org/NginxFullExample2"   >http://wiki.nginx.org/NginxFullExample2</a></div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi /etc/nginx/nginx.conf&nbsp;</font></div><div><div><font size="2"   ><br></font></div><div><font size="2"   >user &nbsp;nginx;</font></div><div><font size="2"   >worker_processes &nbsp;4;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >error_log &nbsp;/var/log/nginx/error.log warn;</font></div><div><font size="2"   >pid &nbsp; &nbsp; &nbsp; &nbsp;/var/run/nginx.pid;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >events {</font></div><div><font size="2"   >&nbsp; &nbsp; worker_connections &nbsp;1024;</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >http {</font></div><div><font size="2"   >&nbsp; &nbsp; include &nbsp; &nbsp; &nbsp; /etc/nginx/mime.types;</font></div><div><font size="2"   >&nbsp; &nbsp; default_type &nbsp;application/octet-stream;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; log_format &nbsp;main &nbsp;'$remote_addr - $remote_user [$time_local] "$request" '</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '$status $body_bytes_sent "$http_referer" '</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '"$http_user_agent" "$http_x_forwarded_for"';</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; access_log &nbsp;/var/log/nginx/access.log &nbsp;main;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; sendfile &nbsp; &nbsp; &nbsp; &nbsp;on;</font></div><div><font size="2"   >&nbsp; &nbsp; #tcp_nopush &nbsp; &nbsp; on;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; keepalive_timeout &nbsp;2;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; #gzip &nbsp;on;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; include /etc/nginx/conf.d/*.conf;</font></div><div><font size="2"   >}</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   ># vi /etc/nginx/conf.d/default.conf&nbsp;</font></div><div><font size="2"   >server {</font></div><div><font size="2"   >&nbsp; &nbsp; listen &nbsp; &nbsp; &nbsp; 80;</font></div><div><font size="2"   >&nbsp; &nbsp; server_name &nbsp;_;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; #charset koi8-r;</font></div><div><font size="2"   >&nbsp; &nbsp; #access_log &nbsp;/var/log/nginx/log/host.access.log &nbsp;main;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; location / {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; root &nbsp; /opt/site/drupal; &nbsp;# drupal下载后重命名到这里.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; index &nbsp;index.php index.html index.htm;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; error_page 404 = @drupal;</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; location @drupal {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; rewrite ^(.*)$ /index.php?q=$1 last;</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; #error_page &nbsp;404 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/404.html;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # redirect server error pages to the static page /50x.html</font></div><div><font size="2"   >&nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; error_page &nbsp; 500 502 503 504 &nbsp;/50x.html;</font></div><div><font size="2"   >&nbsp; &nbsp; location = /50x.html {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; root &nbsp; /usr/share/nginx/html;</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # proxy the PHP scripts to Apache listening on 127.0.0.1:80</font></div><div><font size="2"   >&nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; #location ~ \.php$ {</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;proxy_pass &nbsp; http://127.0.0.1;</font></div><div><font size="2"   >&nbsp; &nbsp; #}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</font></div><div><font size="2"   >&nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; #location ~ \.php$ {</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;root &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; html;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;fastcgi_pass &nbsp; 127.0.0.1:9000;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;fastcgi_index &nbsp;index.php;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;fastcgi_param &nbsp;SCRIPT_FILENAME &nbsp;/scripts$fastcgi_script_name;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;include &nbsp; &nbsp; &nbsp; &nbsp;fastcgi_params;</font></div><div><font size="2"   >&nbsp; &nbsp; #}</font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; location ~ \.php$ {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; root /opt/site/drupal;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; include /etc/nginx/fastcgi_params;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_pass &nbsp; 127.0.0.1:9000; &nbsp; # php-fpm的监听</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_index &nbsp;index.php;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_param SCRIPT_FILENAME &nbsp;$document_root$fastcgi_script_name; &nbsp; </font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # deny access to .htaccess files, if Apache's document root</font></div><div><font size="2"   >&nbsp; &nbsp; # concurs with nginx's one</font></div><div><font size="2"   >&nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; #location ~ /\.ht {</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;deny &nbsp;all;</font></div><div><font size="2"   >&nbsp; &nbsp; #}</font></div><div><font size="2"   >}</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   ># service nginx start</font></div><div><font size="2"   >Starting nginx: [ &nbsp;OK &nbsp;]</font></div></div><div><div><font size="2"   ># netstat -anp|grep nginx</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 0.0.0.0:80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;10382/nginx &nbsp;</font></div></div><p></p></pre></div><div><div>测试nginx服务是否正常 :&nbsp;</div><div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/c0O15uRPQLjGf2AQpCvXzg==/832040031257436146.png"   ></div></div><div><br></div><div>二. PostgreSQL的安装和配置, 简单的写一下, 使用9.3.4的源码安装. (假设服务器内存96G).</div><div><div>&nbsp; 1. Linux 内核参数</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /etc/sysctl.conf</font></div><div><font size="2"   ># add by digoal.zhou</font></div><div><font size="2"   >kernel.shmmni = 4096</font></div><div><font size="2"   >kernel.sem = 50100 64128000 50100 1280</font></div><div><font size="2"   >fs.file-max = 7672460</font></div><div><font size="2"   >net.ipv4.ip_local_port_range = 9000 65000</font></div><div><font size="2"   >net.core.rmem_default = 1048576</font></div><div><font size="2"   >net.core.rmem_max = 4194304</font></div><div><font size="2"   >net.core.wmem_default = 262144</font></div><div><font size="2"   >net.core.wmem_max = 1048576</font></div><div><font size="2"   >net.ipv4.tcp_tw_recycle = 1</font></div><div><font size="2"   >net.ipv4.tcp_max_syn_backlog = 4096</font></div><div><font size="2"   >net.core.netdev_max_backlog = 10000</font></div><div><font size="2"   >fs.aio-max-nr = 1048576</font></div><div><font size="2"   >net.ipv4.tcp_timestamps = 0</font></div><div><font size="2"   >vm.overcommit_memory = 0</font></div><div><font size="2"   >net.ipv4.tcp_keepalive_time = 60</font></div><div><font size="2"   >net.ipv4.tcp_keepalive_intvl = 10</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi /etc/security/limits.conf</font></div><div><font size="2"   ># add by digoal.zhou</font></div><div><font size="2"   >* soft &nbsp; &nbsp;nofile &nbsp;131072</font></div><div><font size="2"   >* hard &nbsp; &nbsp;nofile &nbsp;131072</font></div><div><font size="2"   >* soft &nbsp; &nbsp;nproc &nbsp; 131072</font></div><div><font size="2"   >* hard &nbsp; &nbsp;nproc &nbsp; 131072</font></div><div><font size="2"   >* soft &nbsp; &nbsp;core &nbsp; &nbsp;unlimited</font></div><div><font size="2"   >* hard &nbsp; &nbsp;core &nbsp; &nbsp;unlimited</font></div><div><font size="2"   >* soft &nbsp; &nbsp;memlock 50000000</font></div><div><font size="2"   >* hard &nbsp; &nbsp;memlock 50000000</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi /etc/security/limits.d/90-nproc.conf</font></div><div><font size="2"   ># 注释所有并添加</font></div><div><font size="2"   >* soft &nbsp; &nbsp;nproc &nbsp; 131072</font></div><div><font size="2"   >* hard &nbsp; &nbsp;nproc &nbsp; 131072</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >生效</font></div><div><font size="2"   >sysctl -p</font></div><p></p></pre></div><div><br></div><div>&nbsp; 2. PostgreSQL 9.3.4 编译项</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >./configure '--with-perl' '--with-tcl' '--with-python' '--with-openssl' '--with-pam' '--with-ldap' '--with-libxml' '--with-libxslt' '--enable-thread-safety' '--with-blocksize=32'</font></div><div><font size="2"   >gmake world</font></div><div><font size="2"   >gmake install-world</font></div><p></p></pre></div><div><br></div><div>&nbsp; 3. PostgreSQL 参数</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi postgresql.conf</font></div><div><font size="2"   >listen_addresses = '0.0.0.0' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# what IP address(es) to listen on;</font></div><div><font size="2"   >port = 5432 &nbsp;# (change requires restart)</font></div><div><font size="2"   >max_connections = 2000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# (change requires restart)</font></div><div><font size="2"   >superuser_reserved_connections = 13 &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >unix_socket_directories = '.' &nbsp; # comma-separated list of directories</font></div><div><font size="2"   >unix_socket_permissions = 0700 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# begin with 0 to use octal notation</font></div><div><font size="2"   >password_encryption = on</font></div><div><font size="2"   >tcp_keepalives_idle = 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPIDLE, in seconds;</font></div><div><font size="2"   >tcp_keepalives_interval = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPINTVL, in seconds;</font></div><div><font size="2"   >tcp_keepalives_count = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # TCP_KEEPCNT;</font></div><div><font size="2"   >shared_buffers = 2048MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 128kB</font></div><div><font size="2"   >work_mem = 1024MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 64kB</font></div><div><font size="2"   >maintenance_work_mem = 1024MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 1MB</font></div><div><font size="2"   >shared_preload_libraries = 'pg_stat_statements' &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >vacuum_cost_delay = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 0-100 milliseconds</font></div><div><font size="2"   >vacuum_cost_limit = 10000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 credits</font></div><div><font size="2"   >bgwriter_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 10-10000ms between rounds</font></div><div><font size="2"   >wal_level = hot_standby &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # minimal, archive, or hot_standby</font></div><div><font size="2"   >synchronous_commit = off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# synchronization level;</font></div><div><font size="2"   >wal_buffers = 16384kB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 32kB, -1 sets based on shared_buffers</font></div><div><font size="2"   >wal_writer_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 milliseconds</font></div><div><font size="2"   >checkpoint_segments = 128 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # in logfile segments, min 1, 16MB each</font></div><div><font size="2"   >archive_mode = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # allows archiving to be done</font></div><div><font size="2"   >archive_command = '/bin/date' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # command to use to archive a logfile segment</font></div><div><font size="2"   >max_wal_senders = 32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# max number of walsender processes</font></div><div><font size="2"   >wal_keep_segments = 512 &nbsp; &nbsp; &nbsp; &nbsp; # in logfile segments, 16MB each; 0 disables</font></div><div><font size="2"   >hot_standby = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# "on" allows queries during recovery</font></div><div><font size="2"   >max_standby_archive_delay = 300s &nbsp; &nbsp; &nbsp; &nbsp;# max delay before canceling queries</font></div><div><font size="2"   >max_standby_streaming_delay = 300s &nbsp; &nbsp; &nbsp;# max delay before canceling queries</font></div><div><font size="2"   >wal_receiver_status_interval = 1s &nbsp; &nbsp; &nbsp; # send replies at least this often</font></div><div><font size="2"   >hot_standby_feedback = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # send info from standby to prevent</font></div><div><font size="2"   >effective_cache_size = 96000MB</font></div><div><font size="2"   >log_destination = 'csvlog' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Valid values are combinations of</font></div><div><font size="2"   >logging_collector = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Enable capturing of stderr and csvlog</font></div><div><font size="2"   >log_directory = 'pg_log' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# directory where log files are written,</font></div><div><font size="2"   >log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # log file name pattern,</font></div><div><font size="2"   >log_file_mode = 0600 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# creation mode for log files,</font></div><div><font size="2"   >log_truncate_on_rotation = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # If on, an existing log file with the</font></div><div><font size="2"   >log_rotation_age = 1d &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Automatic rotation of logfiles will</font></div><div><font size="2"   >log_rotation_size = 10MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Automatic rotation of logfiles will</font></div><div><font size="2"   >log_min_duration_statement = 1s # -1 is disabled, 0 logs all statements</font></div><div><font size="2"   >log_checkpoints = on</font></div><div><font size="2"   >log_connections = on</font></div><div><font size="2"   >log_disconnections = on</font></div><div><font size="2"   >log_error_verbosity = verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # terse, default, or verbose messages</font></div><div><font size="2"   >log_statement = 'ddl' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # none, ddl, mod, all</font></div><div><font size="2"   >log_timezone = 'PRC'</font></div><div><font size="2"   >track_activity_query_size = 4096 &nbsp; &nbsp; &nbsp; &nbsp;# (change requires restart)</font></div><div><font size="2"   >autovacuum = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Enable autovacuum subprocess? &nbsp;'on'</font></div><div><font size="2"   >log_autovacuum_min_duration = 0 # -1 disables, 0 logs all actions and</font></div><div><font size="2"   >datestyle = 'iso, mdy'</font></div><div><font size="2"   >timezone = 'PRC'</font></div><div><font size="2"   >lc_messages = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for system error message</font></div><div><font size="2"   >lc_monetary = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for monetary formatting</font></div><div><font size="2"   >lc_numeric = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# locale for number formatting</font></div><div><font size="2"   >lc_time = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for time formatting</font></div><div><font size="2"   >default_text_search_config = 'pg_catalog.english'</font></div><div><font size="2"   >pg_stat_statements.max = 1000</font></div><div><font size="2"   >pg_stat_statements.track = all</font></div><div><font size="2"   >pg_stat_statements.save = on</font></div><div><font size="2"   >其他的全部注释掉.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pg_hba.conf</font></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >生效</font></div><div><font size="2"   >重启数据库</font></div><p></p></pre></div><div><br></div><div>&nbsp; 4. 存储</div><div>pg_xlog, 活跃表, 索引 等 分开到不同的块设备(底层也分开)存储.</div><div><br></div><div>&nbsp; 5. 活跃表优化</div><div>下载这个插件安装</div><div><pre class="prettyprint"   ><p></p><div><a target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=pgfincore.git;a=summary"   ><font size="2"   >http://git.postgresql.org/gitweb/?p=pgfincore.git;a=summary</font></a></div><div><font size="2"   >mv pgfincore $PGSRC/contrib</font></div><div><font size="2"   >export PATH=$PGHOME/bin:$PATH</font></div><div><font size="2"   >确保pg_config命令在当前路径</font></div><div><font size="2"   >cd $PGSRC/contrib/pgfincore</font></div><div><font size="2"   >make clean</font></div><div><font size="2"   >make &amp;&amp; make install</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >psql dbname superuser</font></div><div><font size="2"   >create extension pgfincore;</font></div><div><font size="2"   >select * from pgfadvise_willneed('$sechema.活跃表'::regclass);</font></div><div><font size="2"   >select * from pgfadvise_willneed('$sechema.活跃索引'::regclass);</font></div><p></p></pre></div><div><br></div><div>&nbsp; 6. 请求跟踪, SQL优化</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql postgres postgres</font></div><div><font size="2"   >create extension pg_stat_statements;</font></div><div><font size="2"   >select pg_stat_statements_reset();</font></div><div><font size="2"   >执行应用压力测试.</font></div><div><font size="2"   >完了后查询CPU耗时排前5的SQL.</font></div><div><font size="2"   >select query,calls,total_time,total_time/calls from pg_stat_statements order by 3 desc limit 5 offset 0;</font></div><p></p></pre></div><div><br></div><div>这些SQL 的执行计划</div><div>explain $SQL;</div><div>看看有没有优化空间.</div></div><div><br></div><div>三. 安装PHP</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >yum install -y php php-xml php-fpm php-pgsql php-pdo php-common php-cli php-intl php-gd&nbsp;</font></div><div><div><font size="2"   ># rpm -qa|grep php</font></div><div><font size="2"   >php-pdo-5.4.30-1.el6.remi.x86_64</font></div><div><font size="2"   >php-common-5.4.30-1.el6.remi.x86_64</font></div><div><font size="2"   >php-5.4.30-1.el6.remi.x86_64</font></div><div><font size="2"   >php-cli-5.4.30-1.el6.remi.x86_64</font></div><div><font size="2"   >php-intl-5.4.30-1.el6.remi.x86_64</font></div><div><font size="2"   >php-pgsql-5.4.30-1.el6.remi.x86_64</font></div></div><div><font size="2"   >php-xml-5.4.30-1.el6.remi.x86_64</font></div><div><font size="2"   >php-fpm-5.4.30-1.el6.remi.x86_64&nbsp;</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   ># php -v</font></div><div><font size="2"   >PHP 5.4.30 (cli) (built: Jun 25 2014 15:27:51)&nbsp;</font></div><div><font size="2"   >Copyright (c) 1997-2014 The PHP Group</font></div><div><font size="2"   >Zend Engine v2.4.0, Copyright (c) 1998-2014 Zend Technologies</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >启动<span style="line-height: 28px;"   >php-fpm服务, 默认监听9000端口.php配置变更的话, 需要重启这个服务来生效.</span></font></div><div><div><font size="2"   >[root@db-172-16-3-150 drupal]# service php-fpm start</font></div><div><font size="2"   >Starting php-fpm: [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   >[root@db-172-16-3-150 drupal]# netstat -anp|grep 9000</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 127.0.0.1:9000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;14159/php-fpm &nbsp;</font></div></div><p></p></pre></div><div><br></div><div>配置php,&nbsp;<span style="line-height: 28px;"   >参见 :&nbsp;</span></div><div><a target="_blank" rel="nofollow" href="https://www.drupal.org/requirements/php"   >https://www.drupal.org/requirements/php</a></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /etc/php.ini</font></div><div><div><font size="2"   >Recommended PHP configuration settings</font></div><div><font size="2"   >Setting: session.cache_limiter = nocache</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Setting: session.auto_start = 0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Setting: expose_php = off</font></div><div><font size="2"   >Reason: Shows current PHP version in all header requests, security disclosure, see here</font></div><div><font size="2"   >Example: X-Powered-By: PHP/5.3.8</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Setting: allow_url_fopen = off</font></div><div><font size="2"   >Reason: This is a security issue: see here</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Setting: magic_quotes_gpc = off</font></div><div><font size="2"   >Reason: Forces quotes in variables - This feature has been deprecated as of PHP 5.3.0 and removed as of PHP 5.4.0.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Setting: register_globals = off</font></div><div><font size="2"   >Reason: Security issue - having this enabled subjects PHP variables to input from any source:</font></div><div><font size="2"   >This feature has been deprecated as of PHP 5.3.0 and removed as of PHP 5.4.0.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Setting: display_errors = Off</font></div><div><font size="2"   >Reason: Hides errors output to display (website) we want to send to log file instead.</font></div></div><p></p></pre></div><div><br></div><div>四. 安装Drupal 7.28</div><div>下载drupal</div><div><a target="_blank" rel="nofollow" href="https://www.drupal.org/project/drupal"   >https://www.drupal.org/project/drupal</a></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >wget&nbsp;http://ftp.drupal.org/files/projects/drupal-7.28.tar.gz</font></div><div><font size="2"   >tar -zxvf&nbsp;<span style="line-height: 28px;"   >drupal-7.28.tar.gz</span></font></div><div><div><font size="2"   ># ll&nbsp;<span style="line-height: 28px;"   >drupal-7.28</span></font></div><div><font size="2"   >total 252</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp;6604 May &nbsp;8 12:05 authorize.php</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 88691 May &nbsp;8 12:05 CHANGELOG.txt</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp;1481 May &nbsp;8 12:05 COPYRIGHT.txt</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp; 720 May &nbsp;8 12:05 cron.php</font></div><div><font size="2"   >drwxr-xr-x &nbsp;4 6226 6226 &nbsp;4096 May &nbsp;8 12:05 includes</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp; 529 May &nbsp;8 12:05 index.php</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp;1717 May &nbsp;8 12:05 INSTALL.mysql.txt</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp;1874 May &nbsp;8 12:05 INSTALL.pgsql.txt</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp; 703 May &nbsp;8 12:05 install.php</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp;1298 May &nbsp;8 12:05 INSTALL.sqlite.txt</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 17995 May &nbsp;8 12:05 INSTALL.txt</font></div><div><font size="2"   >-rwxrwxrwx &nbsp;1 6226 6226 18092 Nov &nbsp;1 &nbsp;2013 LICENSE.txt</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp;8191 May &nbsp;8 12:05 MAINTAINERS.txt</font></div><div><font size="2"   >drwxr-xr-x &nbsp;4 6226 6226 &nbsp;4096 May &nbsp;8 12:05 misc</font></div><div><font size="2"   >drwxr-xr-x 42 6226 6226 &nbsp;4096 May &nbsp;8 12:05 modules</font></div><div><font size="2"   >drwxr-xr-x &nbsp;5 6226 6226 &nbsp;4096 May &nbsp;8 12:05 profiles</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp;5382 May &nbsp;8 12:05 README.txt</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp;1561 May &nbsp;8 12:05 robots.txt</font></div><div><font size="2"   >drwxr-xr-x &nbsp;2 6226 6226 &nbsp;4096 May &nbsp;8 12:05 scripts</font></div><div><font size="2"   >drwxr-xr-x &nbsp;4 6226 6226 &nbsp;4096 May &nbsp;8 12:05 sites</font></div><div><font size="2"   >drwxr-xr-x &nbsp;7 6226 6226 &nbsp;4096 May &nbsp;8 12:05 themes</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 19986 May &nbsp;8 12:05 update.php</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp;9642 May &nbsp;8 12:05 UPGRADE.txt</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp;2178 May &nbsp;8 12:05 web.config</font></div><div><font size="2"   >-rw-r--r-- &nbsp;1 6226 6226 &nbsp; 417 May &nbsp;8 12:05 xmlrpc.php</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >创建站点目录, 和nginx配置的root一致.</font></div><div><div><font size="2"   >[root@db-172-16-3-150 ~]# mkdir /opt/site</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# mv /opt/soft_bak/drupal-7.28 /opt/site/drupal</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# chown -R nginx:nginx /opt/site/drupal</font></div></div><p></p></pre></div><div><br></div><div>安装语言文件至<span style="line-height: 28px;"   >drupal/profiles/standard/translations/</span></div><div><pre class="prettyprint"   ><p></p><div><a target="_blank" rel="nofollow" href="https://localize.drupal.org/translate/downloads"   ><font size="2"   >https://localize.drupal.org/translate/downloads</font></a></div><div><div><font size="2"   >[root@db-172-16-3-150 drupal]# cd /opt/site/drupal/profiles/standard/translations/</font></div><div><font size="2"   >[root@db-172-16-3-150 translations]# ll</font></div><div><font size="2"   >total 4</font></div><div><font size="2"   >-rw-r--r-- 1 nginx nginx 92 May &nbsp;8 12:05 README.txt</font></div><div><font size="2"   >[root@db-172-16-3-150 translations]# wget http://ftp.drupal.org/files/translations/7.x/drupal/drupal-7.28.zh-hans.po</font></div></div><p></p></pre></div><div><br></div><div>五. 创建数据库</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# create role drupal nosuperuser login encrypted password 'drupal123';</font></div><div><font size="2"   >CREATE ROLE</font></div></div><div><div><font size="2"   >pg93@db-172-16-3-150-&gt; cd /ssd4/pg93</font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; mkdir tbs_drupal</font></div></div><div><div><font size="2"   >digoal=# create tablespace tbs_drupal location '/ssd4/pg93/tbs_drupal';</font></div><div><font size="2"   >CREATE TABLESPACE</font></div><div><font size="2"   >digoal=# create database drupal728 with template template0 encoding 'UTF8' tablespace tbs_drupal;</font></div><div><font size="2"   >CREATE DATABASE</font></div></div><div><div><font size="2"   >digoal=# grant all on tablespace tbs_drupal to drupal;</font></div><div><font size="2"   >GRANT</font></div><div><font size="2"   >digoal=# grant all on database drupal728 to drupal;</font></div><div><font size="2"   >GRANT</font></div><div><font size="2"   >digoal=# \c drupal728 drupal</font></div><div><font size="2"   >You are now connected to database "drupal728" as user "drupal".</font></div><div><font size="2"   >drupal728=&gt; create schema drupal;</font></div><div><font size="2"   >CREATE SCHEMA</font></div></div><p></p></pre></div><div><br></div><div>测试连接 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-150-&gt; psql -h 172.16.3.150 -p 5432 -U drupal drupal728</font></div><div><font size="2"   >Password for user drupal:&nbsp;</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >drupal728=&gt; \dn</font></div><div><font size="2"   >&nbsp; List of schemas</font></div><div><font size="2"   >&nbsp; Name &nbsp;| &nbsp;Owner &nbsp;&nbsp;</font></div><div><font size="2"   >--------+----------</font></div><div><font size="2"   >&nbsp;drupal | drupal</font></div><div><font size="2"   >&nbsp;public | postgres</font></div><div><font size="2"   >(2 rows)</font></div><p></p></pre></div><div><br></div><div>六. 配置drupal.</div><div>在浏览器运行install.php脚本前的配置.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 drupal]# cd /opt/site/drupal/</font></div><div><font size="2"   >[root@db-172-16-3-150 drupal]# cp sites/default/default.settings.php sites/default/settings.php</font></div><div><font size="2"   >[root@db-172-16-3-150 drupal]# chmod a+w sites/default/settings.php&nbsp;</font></div><div><font size="2"   >[root@db-172-16-3-150 drupal]# chmod a+w sites/default</font></div><p></p></pre></div><div><br></div><div>打开一个IE浏览器, 输入WEB SERVER的IP.</div><div><div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/6v8sw0O3oSQwUiAd9t1DVw==/6608271591121239256.png"   ></div>&nbsp;<div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/9_5TUVDGIPQGrc6GfEbC5g==/6608578354864255175.png"   ></div>&nbsp;<div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/iifOQ_bDNbAqsXfP7lFqqQ==/6608502488561939651.png"   ></div>说明缺少php的gd模块和mbstring模块.</div><div>安装即可</div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum install -y php-gd php-mbstring</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >查看GD库是否启用, 现在不需要配置在php.ini, 这些配置在/etc/php.d中:</span></div><div># less /etc/php.ini</div><div><div>;;;;</div><div>; Note: packaged extension modules are now loaded via the .ini files</div><div>; found in the directory /etc/php.d; these are loaded by default.</div><div>;;;;</div></div><div>查看当前加载的配置文件.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># php --ini</font></div><div><font size="2"   >Configuration File (php.ini) Path: /etc</font></div><div><font size="2"   >Loaded Configuration File: &nbsp; &nbsp; &nbsp; &nbsp; /etc/php.ini</font></div><div><font size="2"   >Scan for additional .ini files in: /etc/php.d</font></div><div><font size="2"   >Additional .ini files parsed: &nbsp; &nbsp; &nbsp;/etc/php.d/curl.ini,</font></div><div><font size="2"   >/etc/php.d/dom.ini,</font></div><div><font size="2"   >/etc/php.d/fileinfo.ini,</font></div><div><font size="2"   >/etc/php.d/gd.ini,</font></div><div><font size="2"   >/etc/php.d/intl.ini,</font></div><div><font size="2"   >/etc/php.d/json.ini,</font></div><div><font size="2"   >/etc/php.d/mbstring.ini,</font></div><div><font size="2"   >/etc/php.d/pdo.ini,</font></div><div><font size="2"   >/etc/php.d/pdo_pgsql.ini,</font></div><div><font size="2"   >/etc/php.d/pdo_sqlite.ini,</font></div><div><font size="2"   >/etc/php.d/pgsql.ini,</font></div><div><font size="2"   >/etc/php.d/phar.ini,</font></div><div><font size="2"   >/etc/php.d/sqlite3.ini,</font></div><div><font size="2"   >/etc/php.d/wddx.ini,</font></div><div><font size="2"   >/etc/php.d/xmlreader.ini,</font></div><div><font size="2"   >/etc/php.d/xmlwriter.ini,</font></div><div><font size="2"   >/etc/php.d/xsl.ini,</font></div><div><font size="2"   >/etc/php.d/zip.ini</font></div></div><div><font size="2"   >查看是否启用gd和mbstring库</font></div><div><div><font size="2"   >[root@db-172-16-3-150 drupal]# cat /etc/php.d/gd.ini</font></div><div><font size="2"   >; Enable gd extension module</font></div><div><font size="2"   >extension=gd.so</font></div><div><font size="2"   >[root@db-172-16-3-150 drupal]# cat /etc/php.d/mbstring.ini&nbsp;</font></div><div><font size="2"   >; Enable mbstring extension module</font></div><div><font size="2"   >extension=mbstring.so</font></div></div><p></p></pre></div><div><br></div><div>现在要重启php-fpm服务来生效新安装的php模块.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >service php-fpm restart</font></div><div></div><p></p></pre></div><div>点击"进行安装", 检测全部通过, 进行下一步, 数据库配置.</div><div>注意这里配置的Table prefix不是schema, 而且表的前缀, 防止一个schema下有多个Drupal实例存在的情况造成表名重复.</div><div>如果不可能重复的话, 建议字母+下划线的前缀. 或者不要前缀.</div><div><div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/vJHxptQSWTtcmecMk9ZHIA==/6608797157678185006.png"   ></div><br></div><div>开始安装, 提示需要配置bytea output参数 :&nbsp;</div><div><div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/zYauD0R2On7I2zUnvBhZUA==/6608801555724696316.png"   ></div>配置方法很多, 随便选一种.</div><div>配置连接数据库的用户的默认参数,&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# alter role drupal set bytea_output = 'escape';</font></div><div><font size="2"   >ALTER ROLE</font></div><div><font size="2"   >或者配置drupal728数据库的参数,</font></div><div><font size="2"   >digoal=# alter database drupal728 set bytea_output = 'escape';</font></div><div><font size="2"   >ALTER DATABASE</font></div></div><div><font size="2"   >或者配置PG集群的默认参数.</font></div><div><font size="2"   >vi $PGDATA/postgresql.conf</font></div><div><span style="line-height: 28px;"   ><font size="2"   >bytea_output = 'escape';</font></span></div><div><font size="2"   >pg_ctl reload</font></div><p></p></pre></div><div><br></div><div>接下来安装过程出错, 违反非空约束如下,&nbsp;</div><div><div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/3cwSHASNcnCzXfMzsrApHQ==/6608492592957290899.png"   ></div><br></div><div>但是表已经安装好了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >drupal728=&gt; \dt</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of relations</font></div><div><font size="2"   >&nbsp;Schema | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Type &nbsp;| Owner &nbsp;</font></div><div><font size="2"   >--------+-----------------------------------+-------+--------</font></div><div><font size="2"   >&nbsp;drupal | drupalactions &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalauthmap &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalbatch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalblock &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalblock_custom &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalblock_node_type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalblock_role &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalblocked_ips &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcache &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcache_block &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcache_bootstrap &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcache_field &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcache_filter &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcache_form &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcache_image &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcache_menu &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcache_page &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcache_path &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalcomment &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupaldate_format_locale &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupaldate_format_type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupaldate_formats &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfield_config &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfield_config_instance &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfield_data_body &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfield_data_comment_body &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfield_data_field_image &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfield_data_field_tags &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfield_revision_body &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfield_revision_comment_body | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfield_revision_field_image &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfield_revision_field_tags &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfile_managed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfile_usage &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfilter &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalfilter_format &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalflood &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalhistory &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalimage_effects &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalimage_styles &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalmenu_custom &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalmenu_links &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalmenu_router &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalnode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalnode_access &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalnode_comment_statistics &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalnode_revision &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalnode_type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalqueue &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalrdf_mapping &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalregistry &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalregistry_file &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalrole &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalrole_permission &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalsearch_dataset &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalsearch_index &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalsearch_node_links &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalsearch_total &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalsemaphore &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalsequences &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalsessions &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalshortcut_set &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalshortcut_set_users &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalsystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupaltaxonomy_index &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupaltaxonomy_term_data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupaltaxonomy_term_hierarchy &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupaltaxonomy_vocabulary &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalurl_alias &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalusers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalusers_roles &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalvariable &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >&nbsp;drupal | drupalwatchdog &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| table | drupal</font></div><div><font size="2"   >(73 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >drupal728=&gt; \df</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of functions</font></div><div><font size="2"   >&nbsp;Schema | &nbsp; &nbsp; &nbsp;Name &nbsp; &nbsp; &nbsp; | Result data type | &nbsp; &nbsp;Argument data types &nbsp; &nbsp;| &nbsp;Type &nbsp;</font></div><div><font size="2"   >--------+-----------------+------------------+---------------------------+--------</font></div><div><font size="2"   >&nbsp;drupal | concat &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | anynonarray, anynonarray &nbsp;| normal</font></div><div><font size="2"   >&nbsp;drupal | concat &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | anynonarray, text &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;drupal | concat &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | text, anynonarray &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;drupal | concat &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | text, text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;drupal | greatest &nbsp; &nbsp; &nbsp; &nbsp;| numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| numeric, numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;drupal | greatest &nbsp; &nbsp; &nbsp; &nbsp;| numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| numeric, numeric, numeric | normal</font></div><div><font size="2"   >&nbsp;drupal | rand &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| double precision | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >&nbsp;drupal | substring_index | text &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | text, text, integer &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"   >(8 rows)</font></div><p></p></pre></div><div><br></div><div>非空约束错误, 从postgresql查看日志 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >2014-07-11 21:54:12.543 CST,"drupal","drupal728",21209,"172.16.3.150:62904",53bfec82.52d9,150,"INSERT",2014-07-11 21:54:10 CST,3/290</font></div><div><font size="2"   >7,0,ERROR,23502,"null value in column ""rid"" violates not-null constraint","Failing row contains (null, administer blocks, block)."</font></div><div><font size="2"   >,,,,,"INSERT INTO drupalrole_permission (rid, permission, module) VALUES (NULL, 'administer blocks', 'block')",,"ExecConstraints, ex</font></div><div><font size="2"   >ecMain.c:1610",""</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >这个错误可以直接点击the error page, 跳到手工处理配置界面.</span></div><div><div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/gYqKyZ9f4ugKpRamU2cPmw==/6608207819446836867.png"   ></div>&nbsp;<div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/AUmkSx0vKv9XD4xiln2Eww==/6608637728492157768.png"   ></div><br></div><div>完成配置 :&nbsp;</div><div><div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/FXDXacGjuyR-OkC6Y3O0dg==/6608232008702646751.png"   ></div><div><br></div>现在可以打开drupal了.<br><div><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/paYxZ_T8TdpqFZRjnE5jtg==/6608195724818932264.png"   ></div>&nbsp;</div><div><br></div><div>执行完配置后改回权限</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >cd /opt/site/drupal/</font></span></div><div><div><font size="2"   >chmod 644&nbsp;<span style="line-height: 28px;"   >sites/default/settings.php</span></font></div><div><font size="2"   >chmod 755&nbsp;<span style="line-height: 28px;"   >sites/default</span></font></div></div><p></p></pre></div><div><br></div><div>配置自动开启这些服务.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >chkconfig nginx on</font></div><div><font size="2"   >chkconfig php-fpm on</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi /etc/rc.local</font></div><div><font size="2"   >pg_ctl start</font></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://www.drupal.org/start"   >https://www.drupal.org/start</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://www.drupal.org/project/drupal"   >https://www.drupal.org/project/drupal</a></div><div><div style="line-height: 28px;"   >3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.howtoforge.com/installing-nginx-with-php5-and-php-fpm-and-mysql-support-lemp-on-ubuntu-12.04-lts"   >http://www.howtoforge.com/installing-nginx-with-php5-and-php-fpm-and-mysql-support-lemp-on-ubuntu-12.04-lts</a></div><div style="line-height: 28px;"   >4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://wiki.nginx.org/NginxFullExample"   >http://wiki.nginx.org/NginxFullExample</a></div><div style="line-height: 28px;"   >5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://wiki.nginx.org/NginxFullExample2"   >http://wiki.nginx.org/NginxFullExample2</a></div></div><div style="line-height: 28px;"   >6. INSTALL.txt</div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Drupal 7.28, Nginx 1.6, PostgreSQL 9.3.4, PHP 5.4, fpm  install on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>