<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">compile nginx 1.6.0 with all modules in CentOS 6.x x64 (when with openssl encount bug)</h2>
	<h5 id="">2014-07-18 15:54:43&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201461822210354/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>本文讲一下nginx 1.6.0的源码安装, 遇到一个bug, 开启openssl支持时, 因为make文件的问题, 导致make错误, 后面会有如何避免这个错误的方法, 需要修改nginx代码中openssl的conf文件.</div><div><br></div><div>编译环境 :&nbsp;</div><div>CentOS 6.x x64</div><div>依赖包大部分通过yum安装(除了google performance a tools,pcre和zlib, zlib通过nginx配置的makefile来安装).</div><div><br></div><div>安装依赖包.</div><div>安装google performance analysis tools的依赖包</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum install -y libunwind-devel&nbsp;<span style="line-height: 28px;"   >libunwind</span></font></div><div></div><p></p></pre></div><div>安装<span style="line-height: 28px;"   >google performance analysis tools</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># wget&nbsp;https://googledrive.com/host/0B6NtGsLhIcf7MWxMMF9JdTN3UVk/gperftools-2.2.1.tar.gz</font></div><div><font size="2"   ># tar -zxvf&nbsp;<span style="line-height: 28px;"   >gperftools-2.2.1.tar.gz</span></font></div><div><font size="2"   ><span style="line-height: 28px;"   ># cd&nbsp;</span><span style="line-height: 28px;"   >gperftools-2.2.1</span></font></div><div><font size="2"   ># ./configure --prefix=/opt/gperftools-2.2.1</font></div><div><font size="2"   ># make</font></div><div><font size="2"   ># make install</font></div><div><span style="line-height: 28px;"   ><font size="2"   ><br></font></span></div><div><span style="line-height: 28px;"   ><font size="2"   ># vi /etc/profile</font></span></div><div><font size="2"   >export PATH=/opt/gperftools-2.2.1/bin:$PATH</font></div><div><font size="2"   >export MANPATH=/opt/gperftools-2.2.1/share/man:$MANPATH</font></div><div><font size="2"   ><br></font></div><div><span style="line-height: 28px;"   ><font size="2"   ># vi /etc/ld.so.conf</font></span></div><div><font size="2"   >/opt/gperftools-2.2.1/lib</font></div><div><font size="2"   ><br></font></div><div><span style="line-height: 28px;"   ><font size="2"   ># ldconfig</font></span></div><div><div><font size="2"   >[root@db-172-16-3-150 ~]# ldconfig -p|grep gper</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libtcmalloc_minimal_debug.so.4 (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libtcmalloc_minimal_debug.so.4</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libtcmalloc_minimal_debug.so (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libtcmalloc_minimal_debug.so</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libtcmalloc_minimal.so.4 (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libtcmalloc_minimal.so.4</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libtcmalloc_minimal.so (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libtcmalloc_minimal.so</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libtcmalloc_debug.so.4 (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libtcmalloc_debug.so.4</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libtcmalloc_debug.so (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libtcmalloc_debug.so</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libtcmalloc_and_profiler.so.4 (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libtcmalloc_and_profiler.so.4</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libtcmalloc_and_profiler.so (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libtcmalloc_and_profiler.so</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libtcmalloc.so.4 (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libtcmalloc.so.4</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libtcmalloc.so (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libtcmalloc.so</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libprofiler.so.0 (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libprofiler.so.0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; libprofiler.so (libc6,x86-64) =&gt; /opt/gperftools-2.2.1/lib/libprofiler.so</font></div></div><p></p></pre></div><div><span style="line-height: 28px;"   >手工安装的软件记得全部加到/etc/profile和/etc/ld.so.conf</span></div><div><br></div><div>安装nginx的依赖包, 其他依赖包系统已经安装了, 如果你编译时遇到缺少的lib库, 补上即可.</div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum install -y geoip-devel geoip&nbsp;libatomic_ops libatomic_ops-devel openssl openssl-devel gd gd-devel</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >查看openssl 相关的so文件, 因为nginx编译安装时加载openssl库有BUG, 需要修改编译文件.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 nginx-1.6.0]# rpm -ql openssl-devel|grep libssl</font></div><div><font size="2"   >/usr/lib64/libssl.so</font></div><p></p></pre></div><div><br></div><div>下载zlib源码</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># cd /opt/soft_bak</font></div><div><font size="2"   ># wget&nbsp;http://zlib.net/zlib-1.2.8.tar.gz</font></div><div><font size="2"   ># tar -zxvf zlib-1.2.8.tar.gz</font></div><p></p></pre></div><div>下载pcre源码.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># cd /opt/soft_bak</font></div><div><font size="2"   ># wget http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.zip?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fpcre%2Ffiles%2Fpcre%2F8.35%2F&amp;ts=1405687477&amp;use_mirror=jaist</font></div><div><font size="2"   ># unzip pcre-8.35.zip</font></div><p></p></pre></div><div><br></div><div><div style="line-height: 28px;"   >下载nginx最后的稳定版本.</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   ># wget http://nginx.org/download/nginx-1.6.0.tar.gz</font></div><div style="line-height: 28px;"   ><font size="2"   ># tar -zxvf&nbsp;<span style="line-height: 28px;"   >nginx-1.6.0.tar.gz</span></font></div><div style="line-height: 28px;"   ><font size="2"   ><span style="line-height: 28px;"   ># cd&nbsp;</span><span style="line-height: 28px;"   >nginx-1.6.0</span></font></div><p></p></pre></div><div style="line-height: 28px;"   >有个BUG, 必须先修改编译文件, 如果不修改会有BUG, 导致无法安装.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi auto/lib/openssl/conf</font></div><div><div><font size="2"   >	*)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; have=NGX_OPENSSL . auto/have</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; have=NGX_SSL . auto/have</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CORE_INCS="$CORE_INCS $OPENSSL/.openssl/include"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CORE_DEPS="$CORE_DEPS $OPENSSL/.openssl/include/openssl/ssl.h"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CORE_LIBS="$CORE_LIBS $OPENSSL/.openssl/lib/libssl.a"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CORE_LIBS="$CORE_LIBS $OPENSSL/.openssl/lib/libcrypto.a"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CORE_LIBS="$CORE_LIBS $NGX_LIBDL"</font></div><div><font size="2"   >改成</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; *)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; have=NGX_OPENSSL . auto/have</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; have=NGX_SSL . auto/have</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CORE_INCS="$CORE_INCS /usr/include/openssl"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CORE_DEPS="$CORE_DEPS $CORE_INCS/ssl.h"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CORE_LIBS="$CORE_LIBS /usr/lib64/libssl.so"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CORE_LIBS="$CORE_LIBS /usr/lib64/libcrypto.so"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CORE_LIBS="$CORE_LIBS $NGX_LIBDL"</font></div></div><p></p></pre></div><div style="line-height: 28px;"   >另, pcre 编译项定制.</div></div></div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >cd nginx-1.6.0</font></div><div style="line-height: 28px;"   ><font size="2"   >vi&nbsp;auto/lib/pcre/conf</font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; if [ $PCRE_JIT = YES ]; then</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; have=NGX_HAVE_PCRE_JIT . auto/have</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; PCRE_CONF_OPT="$PCRE_CONF_OPT --enable-jit --enable-unicode-properties --enable-utf --enable-pcre16 --enable-pcre32"</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; fi</font></div></div><p></p></pre></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   >并不是使用with-pcre-opt</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >./configure --help</font></div><div style="line-height: 28px;"   ><font size="2"   >library sources DIR指源码目录, 例如,&nbsp;<span style="line-height: 28px;"   >需要pcre下载的源码.</span></font></div><div style="line-height: 28px;"   ><font size="2"   >--with-pcre=DIR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set path to PCRE library sources</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; --with-pcre-opt=OPTIONS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set additional build options for PCRE</font></div><div style="line-height: 28px;"   ><font size="2"   >指编译pcre的CFLAGS可选项.</font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >[root@db-172-16-3-150 nginx-1.6.0]# grep -r with-pcre-opt *</font></div><div style="line-height: 28px;"   ><font size="2"   >auto/options: &nbsp; &nbsp; &nbsp; &nbsp;--with-pcre-opt=*) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PCRE_OPT="$value" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;</font></div><div style="line-height: 28px;"   ><font size="2"   >auto/options: &nbsp;--with-pcre-opt=OPTIONS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set additional build options for PCRE</font></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >[root@db-172-16-3-150 nginx-1.6.0]# grep -r PCRE_OPT *</font></div><div style="line-height: 28px;"   ><font size="2"   >auto/lib/pcre/make: &nbsp; &nbsp; &amp;&amp; CC="\$(CC)" CFLAGS="$PCRE_OPT" \\</font></div></div><p></p></pre></div></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >安装所有的模块, 全部静态连接到sbin/nginx.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># <span style="line-height: 21px;"   >./configure --prefix=/opt/nginx1.6.0 --without-select_module --without-poll_module --with-file-aio --with-http_ssl_module --with-http_spdy_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module --with-http_image_filter_module --with-http_geoip_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_stub_status_module --with-http_perl_module --with-mail --with-mail_ssl_module --with-google_perftools_module --with-cpp_test_module --with-pcre=/opt/soft_bak/pcre-8.35 --with-pcre-jit --with-md5-asm --with-sha1-asm --with-zlib=/opt/soft_bak/zlib-1.2.8 --with-libatomic --with-openssl=/usr/lib64 --with-cc-opt=-I/opt/gperftools-2.2.1/include --with-ld-opt=-L/opt/gperftools-2.2.1/lib</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Configuration summary<br>  + using PCRE library: /opt/soft_bak/pcre-8.35<br>  + using OpenSSL library: /usr/lib64<br>  + md5: using OpenSSL library<br>  + sha1: using OpenSSL library<br>  + using zlib library: /opt/soft_bak/zlib-1.2.8<br>  + using system libatomic_ops library<br><br>  nginx path prefix: "/opt/nginx1.6.0"<br>  nginx binary file: "/opt/nginx1.6.0/sbin/nginx"<br>  nginx configuration prefix: "/opt/nginx1.6.0/conf"<br>  nginx configuration file: "/opt/nginx1.6.0/conf/nginx.conf"<br>  nginx pid file: "/opt/nginx1.6.0/logs/nginx.pid"<br>  nginx error log file: "/opt/nginx1.6.0/logs/error.log"<br>  nginx http access log file: "/opt/nginx1.6.0/logs/access.log"<br>  nginx http client request body temporary files: "client_body_temp"<br>  nginx http proxy temporary files: "proxy_temp"<br>  nginx http fastcgi temporary files: "fastcgi_temp"<br>  nginx http uwsgi temporary files: "uwsgi_temp"<br>  nginx http scgi temporary files: "scgi_temp"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># make</font></div><div><font size="2"   ># make install</font></div><div><br></div><div><div><font size="2"   >[root@db-172-16-3-150 conf]# cd /opt/nginx1.6.0</font></div><div><font size="2"   >[root@db-172-16-3-150 nginx1.6.0]# ll</font></div><div><font size="2"   >total 16</font></div><div><font size="2"   >drwxr-xr-x 2 root root 4096 Jul 18 15:48 conf</font></div><div><font size="2"   >drwxr-xr-x 2 root root 4096 Jul 18 15:48 html</font></div><div><font size="2"   >drwxr-xr-x 2 root root 4096 Jul 18 15:48 logs</font></div><div><font size="2"   >drwxr-xr-x 2 root root 4096 Jul 18 15:48 sbin</font></div></div><div><div><font size="2"   >[root@db-172-16-3-150 nginx1.6.0]# cd conf/</font></div><div><font size="2"   >[root@db-172-16-3-150 conf]# ll</font></div><div><font size="2"   >total 60</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1034 Jul 18 15:48 fastcgi.conf</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1034 Jul 18 15:48 fastcgi.conf.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;964 Jul 18 15:48 fastcgi_params</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;964 Jul 18 15:48 fastcgi_params.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root 2837 Jul 18 15:48 koi-utf</font></div><div><font size="2"   >-rw-r--r-- 1 root root 2223 Jul 18 15:48 koi-win</font></div><div><font size="2"   >-rw-r--r-- 1 root root 3957 Jul 18 15:48 mime.types</font></div><div><font size="2"   >-rw-r--r-- 1 root root 3957 Jul 18 15:48 mime.types.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root 2656 Jul 18 15:48 nginx.conf</font></div><div><font size="2"   >-rw-r--r-- 1 root root 2656 Jul 18 15:48 nginx.conf.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;596 Jul 18 15:48 scgi_params</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;596 Jul 18 15:48 scgi_params.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;623 Jul 18 15:48 uwsgi_params</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;623 Jul 18 15:48 uwsgi_params.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root 3610 Jul 18 15:48 win-utf</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   ># vi /etc/profile</font></div><div><font size="2"   >export PATH=/opt/nginx1.6.0/sbin:/opt/gperftools-2.2.1/bin:$PATH</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@db-172-16-3-150 ~]# which nginx</font></div><div><font size="2"   >/opt/nginx1.6.0/sbin/nginx</font></div></div><p></p></pre></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >[其他]</div><div style="line-height: 28px;"   >1. 使用自编译的perl.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >http://www.perl.org/get.html#unix_like</font></div><div><font size="2"   ># wget http://www.cpan.org/src/5.0/perl-5.20.0.tar.gz</font></div><div><font size="2"   ># tar -xzf perl-5.20.0.tar.gz</font></div><div><font size="2"   ># cd perl-5.20.0</font></div><div><font size="2"   ># ./Configure --help</font></div><div><font size="2"   >Usage: Configure [-dehrsEKOSV] [-f config.sh] [-D symbol] [-D symbol=value]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[-U symbol] [-U symbol=] [-A command:symbol...]</font></div><div><font size="2"   >&nbsp; -d : use defaults for all answers.</font></div><div><font size="2"   >&nbsp; -e : go on without questioning past the production of config.sh.</font></div><div><font size="2"   >&nbsp; -f : specify an alternate default configuration file.</font></div><div><font size="2"   >&nbsp; -h : print this help message and exit (with an error status).</font></div><div><font size="2"   >&nbsp; -r : reuse C symbols value if possible (skips costly nm extraction).</font></div><div><font size="2"   >&nbsp; -s : silent mode, only echoes questions and essential information.</font></div><div><font size="2"   >&nbsp; -D : define symbol to have some value:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-D symbol &nbsp; &nbsp; &nbsp; &nbsp; symbol gets the value 'define'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-D symbol=value &nbsp; symbol gets the value 'value'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;common used examples (see INSTALL for more info):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-Duse64bitint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;use 64bit integers</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-Duse64bitall &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;use 64bit integers and pointers</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-Dusethreads &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; use thread support</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-Dinc_version_list=none &nbsp;do not include older perl trees in @INC</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-DEBUGGING=none &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DEBUGGING options</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-Dcc=gcc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; choose your compiler</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-Dprefix=/opt/perl5 &nbsp; &nbsp; &nbsp;choose your destination</font></div><div><font size="2"   >&nbsp; -E : stop at the end of questions, after having produced config.sh.</font></div><div><font size="2"   >&nbsp; -K : do not use unless you know what you are doing.</font></div><div><font size="2"   >&nbsp; -O : let -D and -U override definitions from loaded configuration file.</font></div><div><font size="2"   >&nbsp; -S : perform variable substitutions on all .SH files (can mix with -f)</font></div><div><font size="2"   >&nbsp; -U : undefine symbol:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-U symbol &nbsp; &nbsp;symbol gets the value 'undef'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-U symbol= &nbsp; symbol gets completely empty</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;e.g.: &nbsp;-Uversiononly</font></div><div><font size="2"   >&nbsp; -A : manipulate symbol after the platform specific hints have been applied:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A append:symbol=value &nbsp; append value to symbol</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A symbol=value &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;like append:, but with a separating space</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A define:symbol=value &nbsp; define symbol to have value</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A clear:symbol &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;define symbol to be ''</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A define:symbol &nbsp; &nbsp; &nbsp; &nbsp; define symbol to be 'define'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A eval:symbol=value &nbsp; &nbsp; define symbol to be eval of value</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A prepend:symbol=value &nbsp;prepend value to symbol</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A undef:symbol &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;define symbol to be 'undef'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A undef:symbol= &nbsp; &nbsp; &nbsp; &nbsp; define symbol to be ''</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;e.g.: &nbsp;-A prepend:libswanted='cl pthread '</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -A ccflags=-DSOME_MACRO</font></div><div><font size="2"   >&nbsp; -V : print version number and exit (with a zero status).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># ./Configure -des -Dprefix=/opt/perl5.20.0</font></div><div><font size="2"   ># make &amp;&amp; make test</font></div><div><font size="2"   ># make install</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># vi /etc/profile</font></div><div><font size="2"   >export PATH=/opt/perl5.20.0/bin:/opt/pcre-8.35/bin:$PATH</font></div><div><font size="2"   >export MANPATH=/opt/perl5.20.0/man:/opt/pcre-8.35/share/man:$MANPATH</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@dba ~]# which perl</font></div><div><font size="2"   >/opt/perl5.20.0/bin/perl</font></div><p></p></pre></div><div style="line-height: 28px;"   >配置项.</div><div style="line-height: 28px;"   ><p></p></div><div><pre class="prettyprint"   ><p><font size="2"   ><span style="line-height: 21px;"   >./configure --prefix=/opt/nginx1.6.0 --without-select_module --without-poll_module --with-file-aio --with-http_ssl_module --with-http_spdy_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module --with-http_image_filter_module --with-http_geoip_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_stub_status_module --with-http_perl_module --with-mail --with-mail_ssl_module --with-google_perftools_module --with-cpp_test_module --with-pcre=/opt/soft_bak/pcre-8.35 --with-pcre-jit --with-md5-asm --with-sha1-asm --with-zlib=/opt/soft_bak/zlib-1.2.8 --with-libatomic --with-openssl=/usr/lib64 --with-cc-opt=-I/opt/gperftools-2.2.1/include --with-ld-opt=-L/opt/gperftools-2.2.1/lib</span> --with-perl=/opt/perl5.20.0/bin/perl</font></p></pre></div><div><span style="line-height: 28px;"   >2. 如果要添加外部的模块, 编译时使用选项 :&nbsp;</span></div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >--add-module=PATH &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;enable an external module</font></span></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >3. 不建议使用</span><span style="line-height: 28px;"   >--with-select_module和</span><span style="line-height: 28px;"   >--with-poll_module.</span></div><div><span style="line-height: 28px;"   >在系统不支持更好的方法如kqueue, epool, rtsig或/dev/poll时会自动enable.&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >--with-select_module</font></div><div><font size="2"   >--without-select_module ― enables or disables building a module that allows the server to work with the select() method. This module is built automatically if the platform does not appear to support more appropriate methods such as kqueue, epoll, rtsig, or /dev/poll.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >--with-poll_module</font></div><div><font size="2"   >--without-poll_module ― enables or disables building a module that allows the server to work with the poll() method. This module is built automatically if the platform does not appear to support more appropriate methods such as kqueue, epoll, rtsig, or /dev/poll.</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; --with-rtsig_module &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;enable rtsig module</font></div><p></p></pre></div><div>Linux下有效的方法是epoll.</div><pre class="prettyprint"   ><p></p><div><font size="2"   >epoll ― efficient method used on Linux 2.6+.</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >参见</span></div><div><a target="_blank" rel="nofollow" href="http://nginx.org/en/docs/events.html"   >http://nginx.org/en/docs/events.html</a></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://nginx.org/en/download.html"   >http://nginx.org/en/download.html</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://nginx.org/en/docs/configure.html"   >http://nginx.org/en/docs/configure.html</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://nginx.org/en/docs/events.html"   >http://nginx.org/en/docs/events.html</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="compile nginx 1.6.0 in CentOS 6.x x64 (when with zlib and openssl encount bug) - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>