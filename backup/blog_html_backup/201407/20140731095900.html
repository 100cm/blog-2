<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">replace offline or FAULTED device in ZPOOL</h2>
	<h5 id="">2014-07-31 9:59:00&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020146319332759/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>今早发现一台zfsonlinux主机的zpool其中一块硬盘写错误次数过多变成FAULTED状态了, raidz1的话变成了DEGRADED状态.</div><div>但是hot spare还是AVAIL的状态, 也就是说hot spare没有自动用起来.</div><div>(后来发现确实如此, hot spare不会自动使用, 需要手工干预)</div><div>当前的zpool状态, sdl已经faulted了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-173-219 ~]# zpool status zp1</font></div><div><font size="2"   >&nbsp; pool: zp1</font></div><div><font size="2"   >&nbsp;state: DEGRADED</font></div><div><font size="2"   >status: One or more devices are faulted in response to persistent errors.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Sufficient replicas exist for the pool to continue functioning in a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; degraded state.</font></div><div><font size="2"   >action: Replace the faulted device, or use 'zpool clear' to mark the device</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; repaired.</font></div><div><font size="2"   >&nbsp; scan: none requested</font></div><div><font size="2"   >config:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STATE &nbsp; &nbsp; READ WRITE CKSUM</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; zp1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; raidz1-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sde &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdf &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdh &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdj &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdk &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FAULTED &nbsp; &nbsp; 11 &nbsp; 586 &nbsp; &nbsp; 0 &nbsp;too many errors</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; logs</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001af8e4ec0420e21f-part4 &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; spares</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001b32c5c61a48318a &nbsp; &nbsp; &nbsp; &nbsp;AVAIL &nbsp;&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >errors: No known data errors</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >从dmesge中可以读到大量的错误信息.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10): 28 00 68 93 be f0 00 00 08 00</font></div><div><font size="2"   >INFO: task txg_sync:25712 blocked for more than 120 seconds.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Tainted: P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------- &nbsp; &nbsp;2.6.32-431.el6.x86_64 #1</font></div><div><font size="2"   >"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</font></div><div><font size="2"   >txg_sync &nbsp; &nbsp; &nbsp;D 0000000000000000 &nbsp; &nbsp; 0 25712 &nbsp; &nbsp; &nbsp;2 0x00000080</font></div><div><font size="2"   >&nbsp;ffff8804ddaa7b70 0000000000000046 0000000000000001 ffff880232635530</font></div><div><font size="2"   >&nbsp;0000000000000000 0000000000000000 ffff8804ddaa7af0 ffffffff81065e02</font></div><div><font size="2"   >&nbsp;ffff8804ddb8b058 ffff8804ddaa7fd8 000000000000fbc8 ffff8804ddb8b058</font></div><div><font size="2"   >Call Trace:</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81065e02&gt;] ? default_wake_function+0x12/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810a70a1&gt;] ? ktime_get_ts+0xb1/0xf0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff815280a3&gt;] io_schedule+0x73/0xc0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177bcc&gt;] cv_wait_common+0xac/0x1c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e7480&gt;] ? zio_execute+0x0/0x140 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109b2a0&gt;] ? autoremove_wake_function+0x0/0x40</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177cf8&gt;] __cv_wait_io+0x18/0x20 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e76bb&gt;] zio_wait+0xfb/0x1b0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02787e3&gt;] dsl_pool_sync+0xb3/0x440 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa028c67b&gt;] spa_sync+0x40b/0xae0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02a0bb4&gt;] txg_sync_thread+0x384/0x5e0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81059329&gt;] ? set_user_nice+0xc9/0x130</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02a0830&gt;] ? txg_sync_thread+0x0/0x5e0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa016f948&gt;] thread_generic_wrapper+0x68/0x80 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa016f8e0&gt;] ? thread_generic_wrapper+0x0/0x80 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109aef6&gt;] kthread+0x96/0xa0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100c20a&gt;] child_rip+0xa/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109ae60&gt;] ? kthread+0x0/0xa0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100c200&gt;] ? child_rip+0x0/0x20</font></div><div><font size="2"   >INFO: task nfsd:28814 blocked for more than 120 seconds.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Tainted: P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------- &nbsp; &nbsp;2.6.32-431.el6.x86_64 #1</font></div><div><font size="2"   >"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</font></div><div><font size="2"   >nfsd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;D 0000000000000006 &nbsp; &nbsp; 0 28814 &nbsp; &nbsp; &nbsp;2 0x00000080</font></div><div><font size="2"   >&nbsp;ffff8806d77adab0 0000000000000046 0000000000000000 0000000000000003</font></div><div><font size="2"   >&nbsp;0000000000000001 0000000000000086 ffff8806d77ada60 ffffffff81058d53</font></div><div><font size="2"   >&nbsp;ffff8806d7497098 ffff8806d77adfd8 000000000000fbc8 ffff8806d7497098</font></div><div><font size="2"   >Call Trace:</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81058d53&gt;] ? __wake_up+0x53/0x70</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff815280a3&gt;] io_schedule+0x73/0xc0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177bcc&gt;] cv_wait_common+0xac/0x1c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109b2a0&gt;] ? autoremove_wake_function+0x0/0x40</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e8473&gt;] ? zio_nowait+0xb3/0x170 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177cf8&gt;] __cv_wait_io+0x18/0x20 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e76bb&gt;] zio_wait+0xfb/0x1b0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e39e0&gt;] zil_commit+0x3b0/0x700 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02d83e2&gt;] zfs_fsync+0x92/0x120 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ee8ee&gt;] zpl_commit_metadata+0x3e/0x60 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa04f8e10&gt;] commit_metadata+0x40/0x70 [nfsd]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8119775e&gt;] ? fsnotify_create+0x5e/0x80</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff811983dc&gt;] ? vfs_create+0xfc/0x110</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa04fc444&gt;] nfsd_create_v3+0x444/0x530 [nfsd]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0503c13&gt;] nfsd3_proc_create+0x123/0x1b0 [nfsd]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa04f4425&gt;] nfsd_dispatch+0xe5/0x230 [nfsd]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa04a37e4&gt;] svc_process_common+0x344/0x640 [sunrpc]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81065df0&gt;] ? default_wake_function+0x0/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa04a3e20&gt;] svc_process+0x110/0x160 [sunrpc]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa04f4b52&gt;] nfsd+0xc2/0x160 [nfsd]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa04f4a90&gt;] ? nfsd+0x0/0x160 [nfsd]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109aef6&gt;] kthread+0x96/0xa0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100c20a&gt;] child_rip+0xa/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109ae60&gt;] ? kthread+0x0/0xa0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100c200&gt;] ? child_rip+0x0/0x20</font></div><div><font size="2"   >INFO: task postgres:46313 blocked for more than 120 seconds.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Tainted: P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------- &nbsp; &nbsp;2.6.32-431.el6.x86_64 #1</font></div><div><font size="2"   >"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</font></div><div><font size="2"   >postgres &nbsp; &nbsp; &nbsp;D 0000000000000004 &nbsp; &nbsp; 0 46313 &nbsp;46300 0x00000080</font></div><div><font size="2"   >&nbsp;ffff8803806519b8 0000000000000082 0000000000000000 ffff880380651a08</font></div><div><font size="2"   >&nbsp;0000000000000001 ffff8800404c5930 ffff880623f52040 0000000000000000</font></div><div><font size="2"   >&nbsp;ffff8804270d3058 ffff880380651fd8 000000000000fbc8 ffff8804270d3058</font></div><div><font size="2"   >Call Trace:</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff815280a3&gt;] io_schedule+0x73/0xc0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177bcc&gt;] cv_wait_common+0xac/0x1c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109b2a0&gt;] ? autoremove_wake_function+0x0/0x40</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa024dde9&gt;] ? dbuf_rele_and_unlock+0x169/0x210 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177cf8&gt;] __cv_wait_io+0x18/0x20 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e76bb&gt;] zio_wait+0xfb/0x1b0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0264805&gt;] dmu_tx_count_write+0x695/0x6f0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8116fc6c&gt;] ? __kmalloc+0x20c/0x220</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa016e20f&gt;] ? kmem_alloc_debug+0x8f/0x4c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02648af&gt;] dmu_tx_hold_write+0x4f/0x70 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02dada6&gt;] zfs_write+0x406/0xcf0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8119938a&gt;] ? __link_path_walk+0x7ca/0xff0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81528f0e&gt;] ? mutex_lock+0x1e/0x50</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8122752f&gt;] ? security_inode_permission+0x1f/0x30</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef3f2&gt;] zpl_write_common+0x52/0x80 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef488&gt;] zpl_write+0x68/0xa0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff812263c6&gt;] ? security_file_permission+0x16/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81188f78&gt;] vfs_write+0xb8/0x1a0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81189871&gt;] sys_write+0x51/0x90</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810e1e5e&gt;] ? __audit_syscall_exit+0x25e/0x290</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100b072&gt;] system_call_fastpath+0x16/0x1b</font></div><div><font size="2"   >INFO: task postgres:46554 blocked for more than 120 seconds.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Tainted: P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------- &nbsp; &nbsp;2.6.32-431.el6.x86_64 #1</font></div><div><font size="2"   >"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</font></div><div><font size="2"   >postgres &nbsp; &nbsp; &nbsp;D 0000000000000005 &nbsp; &nbsp; 0 46554 &nbsp;46541 0x00000080</font></div><div><font size="2"   >&nbsp;ffff88048fc799b8 0000000000000082 0000000000000000 ffff88048fc79a08</font></div><div><font size="2"   >&nbsp;0000000000000001 ffff880240a8e4a0 ffff880606aa5750 0000000000000000</font></div><div><font size="2"   >&nbsp;ffff8806d775f058 ffff88048fc79fd8 000000000000fbc8 ffff8806d775f058</font></div><div><font size="2"   >Call Trace:</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff815280a3&gt;] io_schedule+0x73/0xc0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177bcc&gt;] cv_wait_common+0xac/0x1c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109b2a0&gt;] ? autoremove_wake_function+0x0/0x40</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa024dde9&gt;] ? dbuf_rele_and_unlock+0x169/0x210 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177cf8&gt;] __cv_wait_io+0x18/0x20 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e76bb&gt;] zio_wait+0xfb/0x1b0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0264805&gt;] dmu_tx_count_write+0x695/0x6f0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8116fc6c&gt;] ? __kmalloc+0x20c/0x220</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa016e20f&gt;] ? kmem_alloc_debug+0x8f/0x4c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02648af&gt;] dmu_tx_hold_write+0x4f/0x70 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02dada6&gt;] zfs_write+0x406/0xcf0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff814c5b8a&gt;] ? inet_sendmsg+0x4a/0xb0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81447e03&gt;] ? sock_sendmsg+0x123/0x150</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef3f2&gt;] zpl_write_common+0x52/0x80 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef488&gt;] zpl_write+0x68/0xa0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff812263c6&gt;] ? security_file_permission+0x16/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81188f78&gt;] vfs_write+0xb8/0x1a0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81189871&gt;] sys_write+0x51/0x90</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810e1e5e&gt;] ? __audit_syscall_exit+0x25e/0x290</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100b072&gt;] system_call_fastpath+0x16/0x1b</font></div><div><font size="2"   >INFO: task postgres:46555 blocked for more than 120 seconds.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Tainted: P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------- &nbsp; &nbsp;2.6.32-431.el6.x86_64 #1</font></div><div><font size="2"   >"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</font></div><div><font size="2"   >postgres &nbsp; &nbsp; &nbsp;D 0000000000000006 &nbsp; &nbsp; 0 46555 &nbsp;46541 0x00000080</font></div><div><font size="2"   >&nbsp;ffff8807c1cab9b8 0000000000000086 0000000000000000 ffff8807c1caba08</font></div><div><font size="2"   >&nbsp;0000000000000001 ffff8801e8ea73e0 ffff88063991f230 0000000000000000</font></div><div><font size="2"   >&nbsp;ffff880806b9c638 ffff8807c1cabfd8 000000000000fbc8 ffff880806b9c638</font></div><div><font size="2"   >Call Trace:</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff815280a3&gt;] io_schedule+0x73/0xc0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177bcc&gt;] cv_wait_common+0xac/0x1c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109b2a0&gt;] ? autoremove_wake_function+0x0/0x40</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa024dde9&gt;] ? dbuf_rele_and_unlock+0x169/0x210 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177cf8&gt;] __cv_wait_io+0x18/0x20 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e76bb&gt;] zio_wait+0xfb/0x1b0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0264805&gt;] dmu_tx_count_write+0x695/0x6f0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8116fc6c&gt;] ? __kmalloc+0x20c/0x220</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa016e20f&gt;] ? kmem_alloc_debug+0x8f/0x4c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02648af&gt;] dmu_tx_hold_write+0x4f/0x70 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02dada6&gt;] zfs_write+0x406/0xcf0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8119938a&gt;] ? __link_path_walk+0x7ca/0xff0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81528f0e&gt;] ? mutex_lock+0x1e/0x50</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8122752f&gt;] ? security_inode_permission+0x1f/0x30</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa017936f&gt;] ? tsd_exit+0x5f/0x2b0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef3f2&gt;] zpl_write_common+0x52/0x80 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef488&gt;] zpl_write+0x68/0xa0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff812263c6&gt;] ? security_file_permission+0x16/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81188f78&gt;] vfs_write+0xb8/0x1a0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81189871&gt;] sys_write+0x51/0x90</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810e1e5e&gt;] ? __audit_syscall_exit+0x25e/0x290</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100b072&gt;] system_call_fastpath+0x16/0x1b</font></div><div><font size="2"   >INFO: task postgres:47162 blocked for more than 120 seconds.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Tainted: P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------- &nbsp; &nbsp;2.6.32-431.el6.x86_64 #1</font></div><div><font size="2"   >"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</font></div><div><font size="2"   >postgres &nbsp; &nbsp; &nbsp;D 0000000000000005 &nbsp; &nbsp; 0 47162 &nbsp;47129 0x00000080</font></div><div><font size="2"   >&nbsp;ffff8802d1dbf9b8 0000000000000086 0000000000000000 ffff8802d1dbfa08</font></div><div><font size="2"   >&nbsp;0000000000000001 ffff8800bb012870 ffff880673838a80 0000000000000000</font></div><div><font size="2"   >&nbsp;ffff8804218f9058 ffff8802d1dbffd8 000000000000fbc8 ffff8804218f9058</font></div><div><font size="2"   >Call Trace:</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff815280a3&gt;] io_schedule+0x73/0xc0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177bcc&gt;] cv_wait_common+0xac/0x1c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109b2a0&gt;] ? autoremove_wake_function+0x0/0x40</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa024dde9&gt;] ? dbuf_rele_and_unlock+0x169/0x210 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177cf8&gt;] __cv_wait_io+0x18/0x20 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e76bb&gt;] zio_wait+0xfb/0x1b0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0264805&gt;] dmu_tx_count_write+0x695/0x6f0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8116fc6c&gt;] ? __kmalloc+0x20c/0x220</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa016e20f&gt;] ? kmem_alloc_debug+0x8f/0x4c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02648af&gt;] dmu_tx_hold_write+0x4f/0x70 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02dada6&gt;] zfs_write+0x406/0xcf0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff814c5b8a&gt;] ? inet_sendmsg+0x4a/0xb0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81528f0e&gt;] ? mutex_lock+0x1e/0x50</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81447e03&gt;] ? sock_sendmsg+0x123/0x150</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef3f2&gt;] zpl_write_common+0x52/0x80 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef488&gt;] zpl_write+0x68/0xa0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff812263c6&gt;] ? security_file_permission+0x16/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81188f78&gt;] vfs_write+0xb8/0x1a0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81189871&gt;] sys_write+0x51/0x90</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810e1e5e&gt;] ? __audit_syscall_exit+0x25e/0x290</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100b072&gt;] system_call_fastpath+0x16/0x1b</font></div><div><font size="2"   >INFO: task postgres:47184 blocked for more than 120 seconds.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Tainted: P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------- &nbsp; &nbsp;2.6.32-431.el6.x86_64 #1</font></div><div><font size="2"   >"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</font></div><div><font size="2"   >postgres &nbsp; &nbsp; &nbsp;D 0000000000000004 &nbsp; &nbsp; 0 47184 &nbsp;47129 0x00000080</font></div><div><font size="2"   >&nbsp;ffff8802afd519b8 0000000000000082 0000000000000000 ffff8802afd51a08</font></div><div><font size="2"   >&nbsp;0000000000000001 ffff88010ea124a0 ffff880373f1aa80 0000000000000000</font></div><div><font size="2"   >&nbsp;ffff8804260a9058 ffff8802afd51fd8 000000000000fbc8 ffff8804260a9058</font></div><div><font size="2"   >Call Trace:</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff815280a3&gt;] io_schedule+0x73/0xc0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177bcc&gt;] cv_wait_common+0xac/0x1c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109b2a0&gt;] ? autoremove_wake_function+0x0/0x40</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa024dde9&gt;] ? dbuf_rele_and_unlock+0x169/0x210 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177cf8&gt;] __cv_wait_io+0x18/0x20 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e76bb&gt;] zio_wait+0xfb/0x1b0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0264805&gt;] dmu_tx_count_write+0x695/0x6f0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8116fc6c&gt;] ? __kmalloc+0x20c/0x220</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa016e20f&gt;] ? kmem_alloc_debug+0x8f/0x4c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02648af&gt;] dmu_tx_hold_write+0x4f/0x70 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02dada6&gt;] zfs_write+0x406/0xcf0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81449ab3&gt;] ? sock_recvmsg+0x133/0x160</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8108b16e&gt;] ? send_signal+0x3e/0x90</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef3f2&gt;] zpl_write_common+0x52/0x80 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef488&gt;] zpl_write+0x68/0xa0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff812263c6&gt;] ? security_file_permission+0x16/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81188f78&gt;] vfs_write+0xb8/0x1a0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81189871&gt;] sys_write+0x51/0x90</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810e1e5e&gt;] ? __audit_syscall_exit+0x25e/0x290</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100b072&gt;] system_call_fastpath+0x16/0x1b</font></div><div><font size="2"   >INFO: task postgres:39751 blocked for more than 120 seconds.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Tainted: P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------- &nbsp; &nbsp;2.6.32-431.el6.x86_64 #1</font></div><div><font size="2"   >"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</font></div><div><font size="2"   >postgres &nbsp; &nbsp; &nbsp;D 0000000000000000 &nbsp; &nbsp; 0 39751 &nbsp;39591 0x00000080</font></div><div><font size="2"   >&nbsp;ffff8805dbd1b9b8 0000000000000082 0000000000000040 ffff8805dbd1ba08</font></div><div><font size="2"   >&nbsp;0000000000000001 ffff88020b036c40 ffff8804c9b02e58 0000000000000000</font></div><div><font size="2"   >&nbsp;ffff8808270125f8 ffff8805dbd1bfd8 000000000000fbc8 ffff8808270125f8</font></div><div><font size="2"   >Call Trace:</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810a70a1&gt;] ? ktime_get_ts+0xb1/0xf0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff815280a3&gt;] io_schedule+0x73/0xc0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177bcc&gt;] cv_wait_common+0xac/0x1c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109b2a0&gt;] ? autoremove_wake_function+0x0/0x40</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa024dde9&gt;] ? dbuf_rele_and_unlock+0x169/0x210 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177cf8&gt;] __cv_wait_io+0x18/0x20 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e76bb&gt;] zio_wait+0xfb/0x1b0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0264805&gt;] dmu_tx_count_write+0x695/0x6f0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8116fc6c&gt;] ? __kmalloc+0x20c/0x220</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa016e20f&gt;] ? kmem_alloc_debug+0x8f/0x4c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02648af&gt;] dmu_tx_hold_write+0x4f/0x70 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02dada6&gt;] zfs_write+0x406/0xcf0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810a70a1&gt;] ? ktime_get_ts+0xb1/0xf0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81447e03&gt;] ? sock_sendmsg+0x123/0x150</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef3f2&gt;] zpl_write_common+0x52/0x80 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef488&gt;] zpl_write+0x68/0xa0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff812263c6&gt;] ? security_file_permission+0x16/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81188f78&gt;] vfs_write+0xb8/0x1a0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81189871&gt;] sys_write+0x51/0x90</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810e1e5e&gt;] ? __audit_syscall_exit+0x25e/0x290</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100b072&gt;] system_call_fastpath+0x16/0x1b</font></div><div><font size="2"   >INFO: task postgres:12310 blocked for more than 120 seconds.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Tainted: P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------- &nbsp; &nbsp;2.6.32-431.el6.x86_64 #1</font></div><div><font size="2"   >"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</font></div><div><font size="2"   >postgres &nbsp; &nbsp; &nbsp;D 0000000000000000 &nbsp; &nbsp; 0 12310 &nbsp;39591 0x00000080</font></div><div><font size="2"   >&nbsp;ffff8804844bd9b8 0000000000000086 0000000000000040 ffff8804844bda08</font></div><div><font size="2"   >&nbsp;0000000000000001 ffff8803319737b0 ffff8803b97b06a8 0000000000000000</font></div><div><font size="2"   >&nbsp;ffff880583917af8 ffff8804844bdfd8 000000000000fbc8 ffff880583917af8</font></div><div><font size="2"   >Call Trace:</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810a70a1&gt;] ? ktime_get_ts+0xb1/0xf0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff815280a3&gt;] io_schedule+0x73/0xc0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177bcc&gt;] cv_wait_common+0xac/0x1c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109b2a0&gt;] ? autoremove_wake_function+0x0/0x40</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa024dde9&gt;] ? dbuf_rele_and_unlock+0x169/0x210 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177cf8&gt;] __cv_wait_io+0x18/0x20 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e76bb&gt;] zio_wait+0xfb/0x1b0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0264805&gt;] dmu_tx_count_write+0x695/0x6f0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8116fc6c&gt;] ? __kmalloc+0x20c/0x220</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa016e20f&gt;] ? kmem_alloc_debug+0x8f/0x4c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02648af&gt;] dmu_tx_hold_write+0x4f/0x70 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02dada6&gt;] zfs_write+0x406/0xcf0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81449ab3&gt;] ? sock_recvmsg+0x133/0x160</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef3f2&gt;] zpl_write_common+0x52/0x80 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef488&gt;] zpl_write+0x68/0xa0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff812263c6&gt;] ? security_file_permission+0x16/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81188f78&gt;] vfs_write+0xb8/0x1a0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81189871&gt;] sys_write+0x51/0x90</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810e1e5e&gt;] ? __audit_syscall_exit+0x25e/0x290</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100b072&gt;] system_call_fastpath+0x16/0x1b</font></div><div><font size="2"   >INFO: task postgres:19243 blocked for more than 120 seconds.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Tainted: P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------- &nbsp; &nbsp;2.6.32-431.el6.x86_64 #1</font></div><div><font size="2"   >"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs" disables this message.</font></div><div><font size="2"   >postgres &nbsp; &nbsp; &nbsp;D 0000000000000000 &nbsp; &nbsp; 0 19243 &nbsp;46300 0x00000080</font></div><div><font size="2"   >&nbsp;ffff8801c2fe59b8 0000000000000086 0000000000000000 ffff8801c2fe5a08</font></div><div><font size="2"   >&nbsp;0000000000000001 ffff88001beec250 ffff88021e804fa0 0000000000000000</font></div><div><font size="2"   >&nbsp;ffff880421903af8 ffff8801c2fe5fd8 000000000000fbc8 ffff880421903af8</font></div><div><font size="2"   >Call Trace:</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff815280a3&gt;] io_schedule+0x73/0xc0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177bcc&gt;] cv_wait_common+0xac/0x1c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8109b2a0&gt;] ? autoremove_wake_function+0x0/0x40</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa024dde9&gt;] ? dbuf_rele_and_unlock+0x169/0x210 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0177cf8&gt;] __cv_wait_io+0x18/0x20 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02e76bb&gt;] zio_wait+0xfb/0x1b0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa0264805&gt;] dmu_tx_count_write+0x695/0x6f0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8116fc6c&gt;] ? __kmalloc+0x20c/0x220</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa016e20f&gt;] ? kmem_alloc_debug+0x8f/0x4c0 [spl]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02648af&gt;] dmu_tx_hold_write+0x4f/0x70 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02dada6&gt;] zfs_write+0x406/0xcf0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81449ab3&gt;] ? sock_recvmsg+0x133/0x160</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8108b16e&gt;] ? send_signal+0x3e/0x90</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef3f2&gt;] zpl_write_common+0x52/0x80 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffffa02ef488&gt;] zpl_write+0x68/0xa0 [zfs]</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff812263c6&gt;] ? security_file_permission+0x16/0x20</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81188f78&gt;] vfs_write+0xb8/0x1a0</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff81189871&gt;] sys_write+0x51/0x90</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff810e1e5e&gt;] ? __audit_syscall_exit+0x25e/0x290</font></div><div><font size="2"   >&nbsp;[&lt;ffffffff8100b072&gt;] system_call_fastpath+0x16/0x1b</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10): 28 00 68 a4 ae 60 00 00 08 00</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10): 28 00 68 75 e4 08 00 00 08 00</font></div><div><font size="2"   >scanning ...</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10)</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10): 28 00 68 50 4a 60 00 00 10 00</font></div><div><font size="2"   >: 28 00 00 00 0a 10 00 00 10 00</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10): 28 00 67 e5 6d f8 00 00 08 00</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10): 28 00 66 95 36 98 00 00 10 00</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10): 28 00 68 7b fe 48 00 00 08 00</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(16): 88 00 00 00 00 01 d1 af b4 10 00 00 00 10 00 00</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10): 28 00 68 93 bd 78 00 00 08 00</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Write(10): 2a 00 68 ad 3d 20 00 00 28 00</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10): 28 00 5f 5c 66 48 00 00 08 00</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Unhandled error code</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] Result: hostbyte=DID_BAD_TARGET driverbyte=DRIVER_OK</font></div><div><font size="2"   >sd 0:2:11:0: [sdl] CDB: Read(10): 28 00 5f 5f 44 90 00 00 10 00</font></div><div><font size="2"   >end_request: I/O error, dev sdl, sector 1715667304</font></div><div><font size="2"   >end_request: I/O error, dev sdl, sector 7812920848</font></div><div><font size="2"   >end_request: I/O error, dev sdl, sector 1716598240</font></div><div><font size="2"   >end_request: I/O error, dev sdl, sector 2576</font></div><div><font size="2"   >end_request: I/O error, dev sdl, sector 7812920336</font></div><div><font size="2"   >end_request: I/O error, dev sdl, sector 7812920848</font></div><p></p></pre></div><div><br></div><div>手工将fautaled的硬盘replace为hot spare盘.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-173-219 ~]# zpool replace zp1 sdl scsi-36c81f660eb18e8001b32c5c61a48318a</font></div><div><div><font size="2"   >[root@db-192-168-173-219 ~]# zpool status -v</font></div><div><font size="2"   >&nbsp; pool: zp1</font></div><div><font size="2"   >&nbsp;state: DEGRADED</font></div><div><font size="2"   >status: One or more devices is currently being resilvered. &nbsp;The pool will</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; continue to function, possibly in a degraded state.</font></div><div><font size="2"   >action: Wait for the resilver to complete.</font></div><div><font size="2"   >&nbsp; scan: resilver in progress since Thu Jul 31 08:31:53 2014</font></div><div><font size="2"   >&nbsp; &nbsp; 3.41G scanned out of 8.62T at 17.4M/s, 144h42m to go</font></div><div><font size="2"   >&nbsp; &nbsp; 300M resilvered, 0.04% done</font></div><div><font size="2"   >config:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STATE &nbsp; &nbsp; READ WRITE CKSUM</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; zp1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; raidz1-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sde &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdf &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdh &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdj &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdk &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spare-10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FAULTED &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FAULTED &nbsp; &nbsp; 11 &nbsp; 586 &nbsp; &nbsp; 0 &nbsp;too many errors</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001b32c5c61a48318a &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp;(resilvering)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; logs</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001af8e4ec0420e21f-part4 &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; spares</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001b32c5c61a48318a &nbsp; &nbsp; &nbsp; &nbsp;INUSE &nbsp; &nbsp; currently in use</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >errors: No known data errors</font></div></div><p></p></pre></div><div><div>resilver的时间, 和扫描速度, 以及ZPOOL已使用的空间有关, 我们看到的这个例子, 已经使用的空间有8.62T, 扫描速度只有17.4M/s, 所以评估需要144小时42分钟.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; scan: resilver in progress since Thu Jul 31 08:31:53 2014</font></div><div><font size="2"   >&nbsp; &nbsp; 3.41G scanned out of 8.62T at 17.4M/s, 144h42m to go</font></div><div><font size="2"   >&nbsp; &nbsp; 300M resilvered, 0.04% done</font></div><p></p></pre></div></div><div><br></div><div>如果有硬盘更换上去, 在更换前, 最好先把硬盘改成offline的.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-173-219 test1]# zpool offline zp1 sdl</font></div><div><div><font size="2"   >[root@db-192-168-173-219 opt]# zpool status -v zp1</font></div><div><font size="2"   >&nbsp; pool: zp1</font></div><div><font size="2"   >&nbsp;state: DEGRADED</font></div><div><font size="2"   >status: One or more devices is currently being resilvered. &nbsp;The pool will</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; continue to function, possibly in a degraded state.</font></div><div><font size="2"   >action: Wait for the resilver to complete.</font></div><div><font size="2"   >&nbsp; scan: resilver in progress since Thu Jul 31 09:43:21 2014</font></div><div><font size="2"   >&nbsp; &nbsp; 246M scanned out of 8.63T at 12.3M/s, 204h27m to go</font></div><div><font size="2"   >&nbsp; &nbsp; 22.1M resilvered, 0.00% done</font></div><div><font size="2"   >config:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STATE &nbsp; &nbsp; READ WRITE CKSUM</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; zp1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; raidz1-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sde &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdf &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdh &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdj &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdk &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spare-10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OFFLINE &nbsp; &nbsp; 11 &nbsp; 586 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001b32c5c61a48318a &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp;(resilvering)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; logs</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001af8e4ec0420e21f-part4 &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; spares</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001b32c5c61a48318a &nbsp; &nbsp; &nbsp; &nbsp;INUSE &nbsp; &nbsp; currently in use</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >errors: No known data errors</font></div></div><p></p></pre></div><div>然后更换硬盘, 更换好后, 使用replace, 将spare盘释放出来.</div><div><pre class="prettyprint"   ><p><font size="2"   >zpool replace zp1 sdl sdl</font></p></pre></div><div>硬盘非常大, 所以resilvering过程很漫长, 从zpool status -v可以看到还需要多长时间.</div><div>更换过程如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@digoal ~]# MegaCli -CfgLdAdd -r0 [32:10] WB Direct -a0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Adapter 0: Configure Adapter Failed</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >FW error description:&nbsp;</font></div><div><font size="2"   >&nbsp; The current operation is not allowed because the controller has data in cache for offline or missing virtual drives. &nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Exit Code: 0x54</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@digoal ~]# MegaCli -GetPreservedCacheList -aALL</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >Adapter #0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Virtual Drive(Target ID 11): Missing.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Exit Code: 0x00</font></div><div><font size="2"   >[root@digoal ~]# MegaCli -DiscardPreservedCache -L11 -a0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >Adapter #0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Virtual Drive(Target ID 11): Preserved Cache Data Cleared.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Exit Code: 0x00</font></div><div><font size="2"   >[root@digoal ~]# MegaCli -CfgLdAdd -r0 [32:10] WT Direct -a0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >Adapter 0: Created VD 11</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Adapter 0: Configured the Adapter!!</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Exit Code: 0x00</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@digoal ~]# zpool replace zp1 /dev/sdl /dev/sdl</font></div><div><font size="2"   >invalid vdev specification</font></div><div><font size="2"   >use '-f' to override the following errors:</font></div><div><font size="2"   >/dev/sdl does not contain an EFI label but it may contain partition</font></div><div><font size="2"   >information in the MBR.</font></div><div><font size="2"   >[root@digoal ~]# zpool replace -f zp1 /dev/sdl /dev/sdl</font></div><div><font size="2"   >[root@digoal ~]# zpool status -v</font></div><div><font size="2"   >&nbsp; pool: zp1</font></div><div><font size="2"   >&nbsp;state: DEGRADED</font></div><div><font size="2"   >status: One or more devices is currently being resilvered. &nbsp;The pool will</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; continue to function, possibly in a degraded state.</font></div><div><font size="2"   >action: Wait for the resilver to complete.</font></div><div><font size="2"   >&nbsp; scan: resilver in progress since Tue Aug &nbsp;5 15:47:35 2014</font></div><div><font size="2"   >&nbsp; &nbsp; 100M scanned out of 9.45T at 16.7M/s, 165h6m to go</font></div><div><font size="2"   >&nbsp; &nbsp; 9.08M resilvered, 0.00% done</font></div><div><font size="2"   >config:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STATE &nbsp; &nbsp; READ WRITE CKSUM</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; zp1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; raidz1-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sde &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdf &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdh &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdj &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdk &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spare-10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; replacing-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OFFLINE &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; old &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OFFLINE &nbsp; &nbsp; 11 &nbsp; 586 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp;(resilvering)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001b32c5c61a48318a &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; logs</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001af8e4ec0420e21f-part4 &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; spares</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scsi-36c81f660eb18e8001b32c5c61a48318a &nbsp; &nbsp; &nbsp; &nbsp;INUSE &nbsp; &nbsp; currently in use</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >errors: No known data errors</font></div><p></p></pre></div><div><br></div><div>接下来模拟一下整个的过程, offline一个盘, 使用hot spare顶上去, 更换硬盘, 将更换后的硬盘顶替坏盘, hot spare盘自动释放回hot spare avail状态.</div><div>创建3个文件.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># dd if=/dev/zero of=/opt/zfs.disk1 bs=8192 count=102400</font></div><div><font size="2"   ># dd if=/dev/zero of=/opt/zfs.disk2 bs=8192 count=102400</font></div><div><font size="2"   ># dd if=/dev/zero of=/opt/zfs.disk3 bs=8192 count=102400</font></div><p></p></pre></div><div>创建zpool</div><div><div><pre class="prettyprint"   ><p><font size="2"   >[root@db-192-168-173-219 opt]# zpool create -o ashift=12 -o autoreplace=off zp2 mirror /opt/zfs.disk1 /opt/zfs.disk2 spare /opt/zfs.disk3</font></p></pre></div><div>查看当前状态</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-173-219 opt]# zpool status zp2</font></div><div><font size="2"   >&nbsp; pool: zp2</font></div><div><font size="2"   >&nbsp;state: ONLINE</font></div><div><font size="2"   >&nbsp; scan: none requested</font></div><div><font size="2"   >config:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STATE &nbsp; &nbsp; READ WRITE CKSUM</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; zp2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mirror-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk1 &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk2 &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; spares</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk3 &nbsp; &nbsp;AVAIL &nbsp;&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >errors: No known data errors</font></div><p></p></pre></div></div><div>手工offline一块盘.</div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-173-219 opt]# zpool offline zp2 /opt/zfs.disk1</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >查看当前状态</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-173-219 test1]# zpool status -v zp2</font></div><div><font size="2"   >&nbsp; pool: zp2</font></div><div><font size="2"   >&nbsp;state: DEGRADED</font></div><div><font size="2"   >status: One or more devices has been taken offline by the administrator.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Sufficient replicas exist for the pool to continue functioning in a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; degraded state.</font></div><div><font size="2"   >action: Online the device using 'zpool online' or replace the device with</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 'zpool replace'.</font></div><div><font size="2"   >&nbsp; scan: scrub repaired 0 in 0h0m with 0 errors on Thu Jul 31 09:20:25 2014</font></div><div><font size="2"   >config:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STATE &nbsp; &nbsp; READ WRITE CKSUM</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; zp2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mirror-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk1 &nbsp;OFFLINE &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk2 &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; spares</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk3 &nbsp; &nbsp;AVAIL &nbsp;&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >errors: No known data errors</font></div><p></p></pre></div><div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   >使用hot spare盘顶替offline的盘.</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-173-219 opt]# zpool replace zp2 /opt/zfs.disk1 /opt/zfs.disk3</font></div></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-192-168-173-219 opt]# zpool status zp2</font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >&nbsp; pool: zp2</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;state: DEGRADED</font></div><div style="line-height: 28px;"   ><font size="2"   >status: One or more devices has been taken offline by the administrator.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Sufficient replicas exist for the pool to continue functioning in a</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; degraded state.</font></div><div style="line-height: 28px;"   ><font size="2"   >action: Online the device using 'zpool online' or replace the device with</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 'zpool replace'.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; scan: resilvered 1000K in 0h0m with 0 errors on Thu Jul 31 09:26:25 2014</font></div><div style="line-height: 28px;"   ><font size="2"   >config:</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STATE &nbsp; &nbsp; READ WRITE CKSUM</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; zp2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mirror-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DEGRADED &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spare-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OFFLINE &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk1 &nbsp;OFFLINE &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk3 &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk2 &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; spares</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk3 &nbsp; &nbsp; &nbsp;INUSE &nbsp; &nbsp; currently in use</font></div></div><p></p></pre></div></div></div><div>接下来直接使用原盘替换时会报错, 因为这个盘目前有zpool的信息. 起到了保护作用.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-173-219 test1]# zpool replace zp2 /opt/zfs.disk1 /opt/zfs.disk1</font></div><div><font size="2"   >invalid vdev specification</font></div><div><font size="2"   >use '-f' to override the following errors:</font></div><div><font size="2"   >/opt/zfs.disk1 is part of active pool 'zp2'</font></div><p></p></pre></div><div>删除原盘对应的文件, 并新建一个文件来顶替</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-192-168-173-219 opt]# rm -f zfs.disk1</font></div><div><font size="2"   >[root@db-192-168-173-219 opt]# zpool replace zp2 /opt/zfs.disk1 /opt/zfs.disk1</font></div><div><font size="2"   >cannot resolve path '/opt/zfs.disk1'</font></div></div><div><div><font size="2"   >[root@db-192-168-173-219 opt]# dd if=/dev/zero of=/opt/zfs.disk1 bs=8192 count=102400&nbsp;</font></div><div><font size="2"   >102400+0 records in</font></div><div><font size="2"   >102400+0 records out</font></div><div><font size="2"   >838860800 bytes (839 MB) copied, 1.48687 s, 564 MB/s</font></div></div><p></p></pre></div><div>使用新建的文件定义offline的盘. hot spare盘回到avail状态.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-192-168-173-219 opt]# zpool replace zp2 /opt/zfs.disk1 /opt/zfs.disk1</font></div><div><font size="2"   >[root@db-192-168-173-219 opt]# zpool status -v zp2</font></div><div><font size="2"   >&nbsp; pool: zp2</font></div><div><font size="2"   >&nbsp;state: ONLINE</font></div><div><font size="2"   >&nbsp; scan: resilvered 1.05M in 0h0m with 0 errors on Thu Jul 31 09:27:28 2014</font></div><div><font size="2"   >config:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STATE &nbsp; &nbsp; READ WRITE CKSUM</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; zp2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mirror-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk1 &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk2 &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; spares</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /opt/zfs.disk3 &nbsp; &nbsp;AVAIL &nbsp;&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >errors: No known data errors</font></div><p></p></pre></div><div><br></div><div>[注意]</div><div>1. zpool的autoreplace和hot spare没有关系, 只和原盘有关, 当原盘被一个新的盘插入时自动加入原盘所在的vdev.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;autoreplace=on | off</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Controls automatic device replacement. If set to "off", device replacement must be initiated by the &nbsp;admin-</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;istrator &nbsp;by &nbsp;using the "zpool replace" command. If set to "on", any new device, found in the same physical</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;location as a device that previously belonged to the pool, is automatically &nbsp;formatted &nbsp;and &nbsp;replaced. &nbsp;The</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default behavior is "off". This property can also be referred to by its shortened column name, "replace".</font></div><p></p></pre></div><div>2. &nbsp;从下面的exp来看, 如果hot spare处于resilvering状态, 最好等resilver结束再replace到更换后的盘.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;zpool scrub [-s] pool ...</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Begins &nbsp;a &nbsp;scrub. The scrub examines all data in the specified pools to verify that it checksums correctly.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;For replicated (mirror or raidz) devices, ZFS automatically repairs any damage discovered during the scrub.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The &nbsp;"zpool &nbsp;status" command reports the progress of the scrub and summarizes the results of the scrub upon</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;completion.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Scrubbing and resilvering are very similar operations. The difference is &nbsp;that &nbsp;resilvering &nbsp;only &nbsp;examines</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;data that ZFS knows to be out of date (for example, when attaching a new device to a mirror or replacing an</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;existing device), whereas scrubbing examines all data to discover silent errors due to hardware &nbsp;faults &nbsp;or</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;disk failure.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Because &nbsp;scrubbing &nbsp;and resilvering are I/O-intensive operations, ZFS only allows one at a time. If a scrub</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;is already in progress, the "zpool scrub" command terminates it and starts a new scrub. If a resilver is in</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;progress, ZFS does not allow a scrub to be started until the resilver completes.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-s &nbsp; &nbsp;Stop scrubbing.</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Example 11 Managing Hot Spares</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The following command creates a new pool with an available hot spare:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# zpool create tank mirror sda sdb spare sdc</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;If one of the disks were to fail, the pool would be reduced to the degraded state. The &nbsp;failed &nbsp;device &nbsp;can &nbsp;be</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;replaced using the following command:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# zpool replace tank sda sdd</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Once &nbsp;the &nbsp;data &nbsp;has &nbsp;been &nbsp;resilvered, the spare is automatically removed and is made available for use should</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;another device fails. The hot spare can be permanently removed from the pool using the following command:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# zpool remove tank sdc</font></div></div><p></p></pre></div><div><br></div>[参考]<div>1. man zpool<br><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://zpool.org/"   >https://zpool.org/</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.zfsbuild.com/"   >http://www.zfsbuild.com/</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.minghao.hk/bbs/read.php?tid=757"   >http://www.minghao.hk/bbs/read.php?tid=757</a></div></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="replace offline or FAULTED device in ZPOOL - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>