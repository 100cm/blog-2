<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Postgres-XL single host cluster example</h2>
	<h5 id="">2014-07-24 21:55:33&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020146243755910/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>安装postgres-xl参考</div><div><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201462413626429/"   >http://blog.163.com/digoal@126/blog/static/163877040201462413626429/</a></div><div>本文在一台主机上创建多个datanode, coordinator node, gtm, gtm proxy, 搭建一个最简化的测试环境.</div><div>虽然我们这里使用了一台postgres-xl, 但是为了后期方便, 如果是多台主机的话, 环境必须一致, 例如安装的扩展插件, 依赖的库版本等.</div><div><br></div><div>简单步骤如下.</div><div>1. 规划目录</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >coordinator节点 [root@db-172-16-3-150 pgxl]# mkdir -p /ssd4/pgxl/c11921</font></div><div><font size="2"   >datanode节点 [root@db-172-16-3-150 pgxl]# mkdir -p /ssd4/pgxl/d11922</font></div><div><font size="2"   ><span style="line-height: 28px;"   >datanode节点</span><span style="line-height: 28px;"   >&nbsp;</span>[root@db-172-16-3-150 pgxl]# mkdir -p /ssd4/pgxl/d11923</font></div><div><font size="2"   ><span style="line-height: 28px;"   >datanode节点</span><span style="line-height: 28px;"   >&nbsp;</span>[root@db-172-16-3-150 pgxl]# mkdir -p /ssd4/pgxl/d11924</font></div><div><font size="2"   ><span style="line-height: 28px;"   >datanode节点</span><span style="line-height: 28px;"   >&nbsp;</span>[root@db-172-16-3-150 pgxl]# mkdir -p /ssd4/pgxl/d11925</font></div><div><font size="2"   >gtm 节点 [root@db-172-16-3-150 pgxl]# mkdir -p /ssd4/pgxl/g11926</font></div><div><font size="2"   >gtm proxy 节点 [root@db-172-16-3-150 pgxl]# mkdir -p /ssd4/pgxl/gp11927</font></div></div><div><font size="2"   >修改目录权限</font></div><div><font size="2"   ># chown -R pgxl:pgxl /ssd4/pgxl</font></div><p></p></pre></div><div><br></div><div>2. 初始化coordinator和datanode数据库节点</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># su - pgxl</font></div><div><font size="2"   >$ vi .bash_profile</font></div><div><div><font size="2"   >export PS1="$USER@`/bin/hostname -s`-&gt; "</font></div><div><font size="2"   >export PGDATA=/ssd4/pgxl/c11921/pg_root</font></div><div><font size="2"   >export LANG=en_US.utf8</font></div><div><font size="2"   >export PGHOME=/home/pgxl/pgxl9.2</font></div><div><font size="2"   >export LD_LIBRARY_PATH=$PGHOME/lib:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib:$LD_LIBRARY_PATH</font></div><div><font size="2"   >export DATE=`date +"%Y%m%d%H%M"`</font></div><div><font size="2"   >export PATH=$PGHOME/bin:$PATH:.</font></div><div><font size="2"   >export MANPATH=$PGHOME/share/man:$MANPATH</font></div><div><font size="2"   >export PGHOST=$PGDATA</font></div><div><font size="2"   >export PGPORT=11921</font></div><div><font size="2"   >export PGUSER=postgres</font></div><div><font size="2"   >export PGDATABASE=digoal</font></div><div><font size="2"   >alias rm='rm -i'</font></div><div><font size="2"   >alias ll='ls -lh'</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >$ . .bash_profile</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >initdb -D /ssd4/pgxl/c11921/pg_root --nodename=c11921 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   >initdb -D /ssd4/pgxl/d11922/pg_root --nodename=d11922 -E UTF8 --locale=C -U postgres -W</font></div><div><span style="line-height: 28px;"   ><font size="2"   >initdb -D /ssd4/pgxl/d11923/pg_root --nodename=d11923 -E UTF8 --locale=C -U postgres -W</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >initdb -D /ssd4/pgxl/d11924/pg_root --nodename=d11924 -E UTF8 --locale=C -U postgres -W</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >initdb -D /ssd4/pgxl/d11925/pg_root --nodename=d11925 -E UTF8 --locale=C -U postgres -W</font></span></div><p></p></pre></div><div><br></div><div>3. 配置datanode</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /ssd4/pgxl/d11922/pg_root/pg_hba.conf&nbsp;</font></div><div><font size="2"   >vi /ssd4/pgxl/d11923/pg_root/pg_hba.conf&nbsp;</font></div><div><font size="2"   >vi /ssd4/pgxl/d11924/pg_root/pg_hba.conf&nbsp;</font></div><div><font size="2"   >vi /ssd4/pgxl/d11925/pg_root/pg_hba.conf&nbsp;</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   ># "local" is for Unix domain socket connections only</font></div><div><font size="2"   >local &nbsp; all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trust</font></div><div><font size="2"   ># IPv4 local connections:</font></div><div><font size="2"   >host &nbsp; &nbsp;all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 127.0.0.1/32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;trust</font></div><div><font size="2"   ># IPv6 local connections:</font></div><div><font size="2"   >host &nbsp; &nbsp;all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::1/128 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trust</font></div></div><p></p></pre></div><div><br></div><div>参考</div><div><a target="_blank" rel="nofollow" href="http://files.postgres-xl.org/documentation/pg-xc-specifics.html"   >http://files.postgres-xl.org/documentation/pg-xc-specifics.html</a></div><div><span style="line-height: 28px;"   ><br></span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >vi /ssd4/pgxl/d11922/pg_root/postgresql.conf</font></span></div><div><div><font size="2"   >listen_addresses = '0.0.0.0' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# what IP address(es) to listen on;</font></div><div><font size="2"   >port = 11922 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# (change requires restart)</font></div><div><font size="2"   >max_connections = 500 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >superuser_reserved_connections = 13 &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >unix_socket_directory = '.' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >unix_socket_permissions = 0700 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# begin with 0 to use octal notation</font></div><div><font size="2"   >tcp_keepalives_idle = 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPIDLE, in seconds;</font></div><div><font size="2"   >tcp_keepalives_interval = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPINTVL, in seconds;</font></div><div><font size="2"   >tcp_keepalives_count = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # TCP_KEEPCNT;</font></div><div><font size="2"   >shared_buffers = 2048MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 128kB</font></div><div><font size="2"   >max_prepared_transactions = 500 &nbsp; &nbsp; &nbsp; &nbsp; # zero disables the feature</font></div><div><font size="2"   >shared_preload_libraries = 'pg_stat_statements' &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >vacuum_cost_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 0-100 milliseconds</font></div><div><font size="2"   >vacuum_cost_limit = 10000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 credits</font></div><div><font size="2"   >bgwriter_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 10-10000ms between rounds</font></div><div><font size="2"   >shared_queues = 64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# min 16 &nbsp;&nbsp;</font></div><div><font size="2"   >shared_queue_size = 262144 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 16KB</font></div><div><font size="2"   >wal_level = hot_standby &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # minimal, archive, or hot_standby</font></div><div><font size="2"   >synchronous_commit = off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# synchronization level;</font></div><div><font size="2"   >wal_sync_method = fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # the default is the first option</font></div><div><font size="2"   >wal_buffers = 16384kB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 32kB, -1 sets based on shared_buffers</font></div><div><font size="2"   >wal_writer_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 milliseconds</font></div><div><font size="2"   >checkpoint_segments = 128 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # in logfile segments, min 1, 16MB each</font></div><div><font size="2"   >archive_mode = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # allows archiving to be done</font></div><div><font size="2"   >archive_command = '/bin/date' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # command to use to archive a logfile segment</font></div><div><font size="2"   >max_wal_senders = 32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# max number of walsender processes</font></div><div><font size="2"   >hot_standby = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# "on" allows queries during recovery</font></div><div><font size="2"   >max_standby_archive_delay = 300s &nbsp; &nbsp; &nbsp; &nbsp;# max delay before canceling queries</font></div><div><font size="2"   >max_standby_streaming_delay = 300s &nbsp; &nbsp; &nbsp;# max delay before canceling queries</font></div><div><font size="2"   >wal_receiver_status_interval = 1s &nbsp; &nbsp; &nbsp; # send replies at least this often</font></div><div><font size="2"   >hot_standby_feedback = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # send info from standby to prevent</font></div><div><font size="2"   >remote_query_cost = 100.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # same scale as above</font></div><div><font size="2"   >effective_cache_size = 96000MB</font></div><div><font size="2"   >log_destination = 'csvlog' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Valid values are combinations of</font></div><div><font size="2"   >logging_collector = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Enable capturing of stderr and csvlog</font></div><div><font size="2"   >log_directory = 'pg_log' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# directory where log files are written,</font></div><div><font size="2"   >log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # log file name pattern,</font></div><div><font size="2"   >log_file_mode = 0600 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# creation mode for log files,</font></div><div><font size="2"   >log_truncate_on_rotation = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # If on, an existing log file with the</font></div><div><font size="2"   >log_min_duration_statement = 1s # -1 is disabled, 0 logs all statements</font></div><div><font size="2"   >log_checkpoints = on</font></div><div><font size="2"   >log_connections = on</font></div><div><font size="2"   >log_disconnections = on</font></div><div><font size="2"   >log_error_verbosity = verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # terse, default, or verbose messages</font></div><div><font size="2"   >log_lock_waits = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # log lock waits &gt;= deadlock_timeout</font></div><div><font size="2"   >log_statement = 'ddl' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # none, ddl, mod, all</font></div><div><font size="2"   >log_timezone = 'PRC'</font></div><div><font size="2"   >autovacuum = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Enable autovacuum subprocess? &nbsp;'on'</font></div><div><font size="2"   >log_autovacuum_min_duration = 0 # -1 disables, 0 logs all actions and</font></div><div><font size="2"   >autovacuum_vacuum_cost_delay = 10ms &nbsp; &nbsp; # default vacuum cost delay for</font></div><div><font size="2"   >datestyle = 'iso, mdy'</font></div><div><font size="2"   >timezone = 'PRC'</font></div><div><font size="2"   >lc_messages = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for system error message</font></div><div><font size="2"   >lc_monetary = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for monetary formatting</font></div><div><font size="2"   >lc_numeric = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# locale for number formatting</font></div><div><font size="2"   >lc_time = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for time formatting</font></div><div><font size="2"   >default_text_search_config = 'pg_catalog.english'</font></div><div><font size="2"   >pooler_port = 21922 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Pool Manager TCP port</font></div><div><font size="2"   >max_pool_size = 100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Maximum pool size</font></div><div><font size="2"   >pool_conn_keepalive = 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Close connections if they are idle</font></div><div><font size="2"   >pool_maintenance_timeout = 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Launch maintenance routine if pooler</font></div><div><font size="2"   >max_coordinators = 16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Maximum number of Coordinators</font></div><div><font size="2"   >max_datanodes = 16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Maximum number of Datanodes</font></div><div><font size="2"   >gtm_host = '127.0.0.1' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Host name or address of GTM</font></div><div><font size="2"   >gtm_port = 11927 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Port of GTM</font></div><div><font size="2"   >pgxc_node_name = 'd11922' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Coordinator or Datanode name</font></div></div><div><font size="2"   ><br></font></div><div><span style="line-height: 28px;"   ><font size="2"   >vi /ssd4/pgxl/d11923/pg_root/postgresql.conf</font></span></div><div><font size="2"   >其他同上</font></div><div><span style="line-height: 28px;"   ><font size="2"   >port = 11923 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# (change requires restart)</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >pooler_port = 21923 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Pool Manager TCP port</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >pgxc_node_name = 'd11923' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Coordinator or Datanode name</font></span></div><div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   ><br></font></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >vi /ssd4/pgxl/d11924/pg_root/postgresql.conf</font></span></div><div style="line-height: 28px;"   ><font size="2"   >其他同上</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >port = 11924 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# (change requires restart)</font></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >pooler_port = 21924 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Pool Manager TCP port</font></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >pgxc_node_name = 'd11924' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Coordinator or Datanode name</font></span></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   ><br></font></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >vi /ssd4/pgxl/d11925/pg_root/postgresql.conf</font></span></div><div style="line-height: 28px;"   ><font size="2"   >其他同上</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >port = 11925 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# (change requires restart)</font></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >pooler_port = 21925 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Pool Manager TCP port</font></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >pgxc_node_name = 'd11925' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Coordinator or Datanode name</font></span></div></div><p></p></pre></div><div><br></div><div>4. 配置coordinator</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 28px;"   >vi /ssd4/pgxl/c11921/pg_root/</span><span style="line-height: 28px;"   >pg_hba.conf</span></font></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi /ssd4/pgxl/c11921/pg_root/<span style="line-height: 28px;"   >postgresql.conf</span></font></div><div><div style="line-height: 28px;"   ><font size="2"   >其他同datanode节点配置</font></div><div><font size="2"   >listen_addresses = 'localhost'</font></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >port = 11921 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# (change requires restart)</font></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >pooler_port = 21921 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Pool Manager TCP port</font></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >pgxc_node_name = 'c11921' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Coordinator or Datanode name</font></span></div></div><div><font size="2"   >sequence_range = 10000</font></div><div></div><p></p></pre></div><div><br></div><div>5. 配置gtm</div><div>参考 man gtm</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /ssd4/pgxl/g11926/gtm.conf</font></div><div><font size="2"   >listen_addresses = '0.0.0.0'</font></div><div><font size="2"   >log_file = 'gtm.log'</font></div><div><font size="2"   >log_min_messages = WARNING</font></div><div><font size="2"   >nodename = 'g11926'</font></div><div><font size="2"   >port =&nbsp;<span style="line-height: 28px;"   >11926</span></font></div><div><font size="2"   >startup =&nbsp;act</font></div><p></p></pre></div><div><br></div><div>6. 配置gtm proxy</div><div>参考 man gtm_proxy</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >vi /ssd4/pgxl/gp11927/gtm_proxy.conf</font></span></div><div><font size="2"   >gtm_connect_retry_interval = 10</font></div><div><font size="2"   >gtm_host = '127.0.0.1'</font></div><div><font size="2"   >gtm_port =&nbsp;<span style="line-height: 28px;"   >11926</span></font></div><div><font size="2"   >keepalives_count = 10</font></div><div><font size="2"   >keepalives_idle = 60</font></div><div><font size="2"   >keepalives_interval = 10</font></div><div><font size="2"   >log_file = 'gtm_proxy.log'</font></div><div><font size="2"   >log_min_messages =&nbsp;WARNING</font></div><div><font size="2"   >listen_addresses = '0.0.0.0'</font></div><div><font size="2"   >nodename = 'gp11927'</font></div><div><font size="2"   >port = 11927</font></div><div><font size="2"   >worker_threads = 1</font></div><p></p></pre></div><div><br></div><div>7. 启动集群</div><div>7.1 gtm</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pgxl@db-172-16-3-150-&gt; gtm_ctl -Z gtm start -D /ssd4/pgxl/g11926</font></div><div><font size="2"   >server starting</font></div><div><font size="2"   >pgxl@db-172-16-3-150-&gt; netstat -anp|grep 11926</font></div><div><font size="2"   >(Not all processes could be identified, non-owned process info</font></div><div><font size="2"   >&nbsp;will not be shown, you would have to be root to see it all.)</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 0.0.0.0:11926 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;31690/gtm&nbsp;</font></div><p></p></pre></div><div><br></div><div>7.2 gtm_proxy</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pgxl@db-172-16-3-150-&gt; gtm_ctl start -Z gtm_proxy -D /ssd4/pgxl/gp11927</font></div><div><font size="2"   >server starting</font></div><div><font size="2"   >pgxl@db-172-16-3-150-&gt; netstat -anp|grep 11927</font></div><div><font size="2"   >(Not all processes could be identified, non-owned process info</font></div><div><font size="2"   >&nbsp;will not be shown, you would have to be root to see it all.)</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 0.0.0.0:11927 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;31790/gtm_proxy&nbsp;</font></div><p></p></pre></div><div><br></div><div>7.3 datanode</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg_ctl start -Z datanode -D /ssd4/pgxl/d11922/pg_root</font></div><div><font size="2"   >pg_ctl start -Z datanode -D /ssd4/pgxl/d11923/pg_root</font></div><div><font size="2"   >pg_ctl start -Z datanode -D /ssd4/pgxl/d11924/pg_root</font></div><div><font size="2"   >pg_ctl start -Z datanode -D /ssd4/pgxl/d11925/pg_root</font></div><p></p></pre></div><div><br></div><div>7.4 coordinator</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg_ctl start -Z coordinator -D /ssd4/pgxl/c11921/pg_root</font></div><div></div><p></p></pre></div><div><br></div><div>8. 配置所有节点的metadata, (coordinator, datanode都需要配置)</div><div>最终配置如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >pgxl@db-172-16-3-150-&gt; psql -h 127.0.0.1 -p 11921 postgres postgres -c "select * from pgxc_node order by 1"</font></div><div><font size="2"   >&nbsp;node_name | node_type | node_port | node_host | nodeis_primary | nodeis_preferred | &nbsp;node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-----------+-----------+-----------+-----------+----------------+------------------+------------</font></div><div><font size="2"   >&nbsp;c11921 &nbsp; &nbsp;| C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11921 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1123528383</font></div><div><font size="2"   >&nbsp;d11922 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11922 | 127.0.0.1 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -2834542</font></div><div><font size="2"   >&nbsp;d11923 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11923 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;958073426</font></div><div><font size="2"   >&nbsp;d11924 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11924 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -837906471</font></div><div><font size="2"   >&nbsp;d11925 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11925 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2143637084</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pgxl@db-172-16-3-150-&gt; psql -h 127.0.0.1 -p 11922 postgres postgres -c "select * from pgxc_node order by 1"</font></div><div><font size="2"   >&nbsp;node_name | node_type | node_port | node_host | nodeis_primary | nodeis_preferred | &nbsp;node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-----------+-----------+-----------+-----------+----------------+------------------+------------</font></div><div><font size="2"   >&nbsp;c11921 &nbsp; &nbsp;| C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11921 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1123528383</font></div><div><font size="2"   >&nbsp;d11922 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11922 | 127.0.0.1 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -2834542</font></div><div><font size="2"   >&nbsp;d11923 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11923 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;958073426</font></div><div><font size="2"   >&nbsp;d11924 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11924 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -837906471</font></div><div><font size="2"   >&nbsp;d11925 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11925 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2143637084</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pgxl@db-172-16-3-150-&gt; psql -h 127.0.0.1 -p 11923 postgres postgres -c "select * from pgxc_node order by 1"</font></div><div><font size="2"   >&nbsp;node_name | node_type | node_port | node_host | nodeis_primary | nodeis_preferred | &nbsp;node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-----------+-----------+-----------+-----------+----------------+------------------+------------</font></div><div><font size="2"   >&nbsp;c11921 &nbsp; &nbsp;| C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11921 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1123528383</font></div><div><font size="2"   >&nbsp;d11922 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11922 | 127.0.0.1 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -2834542</font></div><div><font size="2"   >&nbsp;d11923 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11923 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;958073426</font></div><div><font size="2"   >&nbsp;d11924 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11924 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -837906471</font></div><div><font size="2"   >&nbsp;d11925 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11925 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2143637084</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pgxl@db-172-16-3-150-&gt; psql -h 127.0.0.1 -p 11924 postgres postgres -c "select * from pgxc_node order by 1"</font></div><div><font size="2"   >&nbsp;node_name | node_type | node_port | node_host | nodeis_primary | nodeis_preferred | &nbsp;node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-----------+-----------+-----------+-----------+----------------+------------------+------------</font></div><div><font size="2"   >&nbsp;c11921 &nbsp; &nbsp;| C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11921 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1123528383</font></div><div><font size="2"   >&nbsp;d11922 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11922 | 127.0.0.1 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -2834542</font></div><div><font size="2"   >&nbsp;d11923 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11923 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;958073426</font></div><div><font size="2"   >&nbsp;d11924 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11924 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -837906471</font></div><div><font size="2"   >&nbsp;d11925 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11925 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2143637084</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pgxl@db-172-16-3-150-&gt; psql -h 127.0.0.1 -p 11925 postgres postgres -c "select * from pgxc_node order by 1"</font></div><div><font size="2"   >&nbsp;node_name | node_type | node_port | node_host | nodeis_primary | nodeis_preferred | &nbsp;node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-----------+-----------+-----------+-----------+----------------+------------------+------------</font></div><div><font size="2"   >&nbsp;c11921 &nbsp; &nbsp;| C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11921 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1123528383</font></div><div><font size="2"   >&nbsp;d11922 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11922 | 127.0.0.1 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -2834542</font></div><div><font size="2"   >&nbsp;d11923 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11923 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;958073426</font></div><div><font size="2"   >&nbsp;d11924 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11924 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -837906471</font></div><div><font size="2"   >&nbsp;d11925 &nbsp; &nbsp;| D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 11925 | 127.0.0.1 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2143637084</font></div><div><font size="2"   >(5 rows)</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   ><span style="line-height: 28px;"   >psql -h 127.0.0.1 -p 11921 postgres postgres -c "</span><span style="line-height: 28px;"   >create node group gp1 with(d11922,d11923,d11924,d11925)"</span></font></div><div><div style="line-height: 28px;"   ><font size="2"   ><span style="line-height: 28px;"   >psql -h 127.0.0.1 -p 11922 postgres postgres -c "</span><span style="line-height: 28px;"   >create node group gp1 with(d11922,d11923,d11924,d11925)"</span></font></div></div><div><div style="line-height: 28px;"   ><font size="2"   ><span style="line-height: 28px;"   >psql -h 127.0.0.1 -p 11923 postgres postgres -c "</span><span style="line-height: 28px;"   >create node group gp1 with(d11922,d11923,d11924,d11925)"</span></font></div></div><div><div style="line-height: 28px;"   ><font size="2"   ><span style="line-height: 28px;"   >psql -h 127.0.0.1 -p 11924 postgres postgres -c "</span><span style="line-height: 28px;"   >create node group gp1 with(d11922,d11923,d11924,d11925)"</span></font></div></div><div><div style="line-height: 28px;"   ><font size="2"   ><span style="line-height: 28px;"   >psql -h 127.0.0.1 -p 11925 postgres postgres -c "</span><span style="line-height: 28px;"   >create node group gp1 with(d11922,d11923,d11924,d11925)"</span></font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >psql -h 127.0.0.1 -p 11921 postgres postgres -c "select pgxc_pool_reload()"</font></div><div><font size="2"   >psql -h 127.0.0.1 -p 11922 postgres postgres -c "select pgxc_pool_reload()"</font></div><div><font size="2"   >psql -h 127.0.0.1 -p 11923 postgres postgres -c "select pgxc_pool_reload()"</font></div><div><font size="2"   >psql -h 127.0.0.1 -p 11924 postgres postgres -c "select pgxc_pool_reload()"</font></div><div><font size="2"   >psql -h 127.0.0.1 -p 11925 postgres postgres -c "select pgxc_pool_reload()"</font></div></div><p></p></pre></div><div><br></div><div>9. 测试数据</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql -h 127.0.0.1 -p 11921 postgres postgres</font></div><div><div><font size="2"   >postgres=# create table t1(id serial8 primary key, info text, crt_time timestamp) distribute by hash(id) to group gp1;</font></div><div><font size="2"   >NOTICE: &nbsp;CREATE TABLE will create implicit sequence "t1_id_seq" for serial column "t1.id"</font></div><div><font size="2"   >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "t1_pkey" for table "t1"</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >postgres=# \dt</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; List of relations</font></div><div><font size="2"   >&nbsp;Schema | Name | Type &nbsp;| &nbsp;Owner &nbsp;&nbsp;</font></div><div><font size="2"   >--------+------+-------+----------</font></div><div><font size="2"   >&nbsp;public | t1 &nbsp; | table | postgres</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >postgres=# \ds</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of relations</font></div><div><font size="2"   >&nbsp;Schema | &nbsp; Name &nbsp; &nbsp;| &nbsp; Type &nbsp; | &nbsp;Owner &nbsp;&nbsp;</font></div><div><font size="2"   >--------+-----------+----------+----------</font></div><div><font size="2"   >&nbsp;public | t1_id_seq | sequence | postgres</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >postgres=# insert into t1 (info, crt_time) select md5(random()::text), clock_timestamp() from generate_series(1,1000000);</font></div><div><font size="2"   >INSERT 0 1000000</font></div><div><font size="2"   >postgres=# \timing</font></div><div><font size="2"   >Timing is on.</font></div><div><font size="2"   >postgres=# select count(*) from t1;</font></div><div><font size="2"   >&nbsp; count &nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;1000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 69.302 ms</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >postgres=# create table t2(id int, info text, crt_time timestamp) distribute by roundrobin to group gp1;</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >Time: 35.572 ms</font></div></div><div><div><font size="2"   >postgres=# insert into t2 select generate_series(1,1000000),md5(random()::text), clock_timestamp();</font></div><div><font size="2"   >INSERT 0 1000000</font></div><div><font size="2"   >Time: 11240.192 ms</font></div></div><div><div><font size="2"   >postgres=# select count(*) from t2;</font></div><div><font size="2"   >&nbsp; count &nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;1000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 5079.048 ms</font></div><div><font size="2"   >postgres=# select count(*) from t2;</font></div><div><font size="2"   >&nbsp; count &nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;1000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 51.978 ms</font></div></div><div><div><font size="2"   >postgres=# \dt+</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List of relations</font></div><div><font size="2"   >&nbsp;Schema | Name | Type &nbsp;| &nbsp;Owner &nbsp; | Size &nbsp;| Description&nbsp;</font></div><div><font size="2"   >--------+------+-------+----------+-------+-------------</font></div><div><font size="2"   >&nbsp;public | t1 &nbsp; | table | postgres | 81 MB |&nbsp;</font></div><div><font size="2"   >&nbsp;public | t2 &nbsp; | table | postgres | 73 MB |&nbsp;</font></div><div><font size="2"   >(2 rows)</font></div><div><font size="2"   >postgres=# \q</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pgxl@db-172-16-3-150-&gt; psql -h 127.0.0.1 -p 11922 postgres postgres</font></div><div><font size="2"   >psql (PGXL 9.2.0, based on PG 9.2.4 (Postgres-XL 9.2.0))</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >postgres=# \dt+</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List of relations</font></div><div><font size="2"   >&nbsp;Schema | Name | Type &nbsp;| &nbsp;Owner &nbsp; | Size &nbsp;| Description&nbsp;</font></div><div><font size="2"   >--------+------+-------+----------+-------+-------------</font></div><div><font size="2"   >&nbsp;public | t1 &nbsp; | table | postgres | 20 MB |&nbsp;</font></div><div><font size="2"   >&nbsp;public | t2 &nbsp; | table | postgres | 18 MB |&nbsp;</font></div><div><font size="2"   >(2 rows)</font></div></div><p></p></pre></div><div><br></div><div>10. 关闭集群</div><div>关闭coordinator</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg_ctl stop -m fast -Z coordinator -D /ssd4/pgxl/c11921/pg_root</font></div><div></div><p></p></pre></div><div><span style="line-height: 28px;"   >关闭</span>datanode</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg_ctl stop -m fast -Z datanode -D /ssd4/pgxl/d11922/pg_root</font></div><div><font size="2"   >pg_ctl stop -m fast -Z datanode -D /ssd4/pgxl/d11923/pg_root</font></div><div><font size="2"   >pg_ctl stop -m fast -Z datanode -D /ssd4/pgxl/d11924/pg_root</font></div><div><font size="2"   >pg_ctl stop -m fast -Z datanode -D /ssd4/pgxl/d11925/pg_root</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >关闭</span>gtm_proxy</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >gtm_ctl stop -m fast -Z gtm_proxy -D /ssd4/pgxl/gp11927</font></div><div></div><p></p></pre></div><div><span style="line-height: 28px;"   >关闭</span>gtm</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >gtm_ctl stop -m fast -Z gtm -D /ssd4/pgxl/g11926</font></div><div></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201462413626429/"   >http://blog.163.com/digoal@126/blog/static/163877040201462413626429/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020145302935957/"   >http://blog.163.com/digoal@126/blog/static/16387704020145302935957/</a></div><div><p><br></p></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Postgres-XL single host cluster example - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">小猪.Sol - 2015-07-31 15:50:49</h5>
				<div>我把gtm单独安装在一台服务器上，在另一台服务器上初始化了cnode和dnode，配置的时候只改了port和ip相关信息，起了gtm_proxy后再起dnode（-p 5432），再起cnode（-p 3456），用"<span class="pln"  style=""  >psql </span><span class="pun"  style=""  >-</span><span class="pln"  style=""  >h </span><span class="lit"  style=""  >127.0</span><span class="pun"  style=""  >.</span><span class="lit"  style=""  >0.1</span><span class="pln"  style=""  > </span><span class="pun"  style=""  >-</span><span class="pln"  style=""  >p 3456</span><span class="pln"  style=""  > postgres postgres </span><span class="pun"  style=""  >-</span><span class="pln"  style=""  >c </span><span class="str"  style=""  >"select * from pgxc_node order by 1" "查看节点信息的时候发现只能看到cnode，-p 3456改成5432后发现只能看到dnode，而且node_type 都是C，请问这会是什么原因造成的呢？</span></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">小猪.Sol 回复 小猪.Sol - 2015-07-31 15:50:49</h5>
				<div style="width:600px;">用了你的配置，只修改了Port和IP相关的数据，起了服务后还是相同的问题。</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 小猪.Sol - 2015-07-31 15:50:49</h5>
				<div style="width:600px;">你可能连错节点了.</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">小猪.Sol 回复 德哥@Digoal - 2015-07-31 15:50:49</h5>
				<div style="width:600px;">你是指我用psql命令的时候连错节点了吗？我查看过postgres侦听的两个端口分别是3456和5432，连接5432的时候创建数据库提示read-only，连接3456的时候创建数据库提示没有datanode.</div>
			</div>
			<div id="">
				<h5 id="">Cutis_Dow - 2015-01-12 14:58:46</h5>
				<div>我在两台虚拟机上做了部署，但是部署后我在datanode1上建表，datanode2上能查询的到，datanode2上建表，datande1上也能看到，可是就是插入数据的时候只能在其中一台上看到，也就是说数据无法分布式的存储。配置上我和你上问说的差不多，出现这样的问题，您有什么建议吗？</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 Cutis_Dow - 2015-01-12 14:58:46</h5>
				<div style="width:600px;">创建表时需要指定如何分布, 分布到哪些节点或组.</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">Cutis_Dow 回复 德哥@Digoal - 2015-01-12 14:58:46</h5>
				<div style="width:600px;">我试过建表时制定分布节点和组，在其中一个协调上建表在所有的协调节点和数据节点都能看得到表，可是当我在协调节点上插入数据是insert into 根本无法插入数据。后来我用 pgadmin 3 登录链接协调节点的时候后台一直有一个警告"<span style=""  >repository configuration was invalid and could not be read",我仔细对过pgxl的配置目前和您设置不一样的是：数据节点和协调节点的端口是一样的（考虑到我在两台机子上安装的，所以就把端口弄一样了）。然后我在；两台机子上安装的postgresql数据库配置文件里端口是和其他的节点端口都不一样。</span></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 Cutis_Dow - 2015-01-12 14:58:46</h5>
				<div style="width:600px;">不能插入, 那是因为你没有在所有的节点创建组和节点信息(cnode and dnode).<div>pgadmin3的警告是读metacatalog失败造成的, 可以不用管. 就用命令行吧, 图形化光油外表, 不好用的.</div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">Cutis_Dow 回复 德哥@Digoal - 2015-01-12 14:58:46</h5>
				<div style="width:600px;">我后来仔细查找了注册节点，参考了社区里的QA，其实也就是一个小问题，datanode节点注册的时候默认类型是C，只要把它改成D 就ok了，谢谢您。</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 Cutis_Dow - 2015-01-12 14:58:46</h5>
				<div style="width:600px;">恩</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">Cutis_Dow 回复 德哥@Digoal - 2015-01-12 14:58:46</h5>
				<div style="width:600px;">麻烦再问一个问题配置节点的时候<span style=""  >nodeis_primary如果不设置为ture是不是集群正常运行有什么影响，如果不必须设置一个请问是随机设置的吗？</span></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 Cutis_Dow - 2015-01-12 14:58:46</h5>
				<div style="width:600px;">On the other hand, in the case of writing replicated tables, all the Coordinators choose the same Datanode to begin with to avoid update conflicts. This is called primary Datanode.<div>对于复制分布的表, 必须在datanode中设置一个primary, 避免更新冲突.</div><div>如果不设置, 肯定也是有一个 作为primary的, 你看看代码吧.</div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 Cutis_Dow - 2015-01-12 14:58:46</h5>
				<div style="width:600px;">另一个相对的是prefered node<div><span style=""  >In the case of reading replicated tables, Coordinator can choose any Datanode to read. The most efficient way is to select one running in the same hardware or virtual machine. This is called&nbsp;</span><span class="emphasis"  style=""  >preferred Datanode</span><span style=""  >&nbsp;and can be specified by a GUC local to each Coordinator.</span></div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">Cutis_Dow 回复 德哥@Digoal - 2015-01-12 14:58:46</h5>
				<div style="width:600px;">了解了，非常感谢</div>
			</div>
			<div id="">
				<h5 id="">renny - 2015-01-08 20:35:05</h5>
				<div><span style=""  >sequence_range = 10000</span><div><span style=""  >这个参数是什么用？我在初始化协调器后得到的postgresql.conf里没有看到这个参数。。</span></div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 renny - 2015-01-08 20:35:05</h5>
				<div style="width:600px;">sequence_range&nbsp;(integer)<p>This parameter is used to get several sequence values at once from GTM. This greatly speeds up COPY and INSERT SELECT operations where the target table uses sequences.&nbsp;<span class="PRODUCTNAME"  >Postgres-XL</span>&nbsp;will not use this entire amount at once, but will increase the request size over time if many requests are done in a short time frame in the same session. After a short time without any sequence requests, decreases back down to 1. Note that any settings here are overriden if the CACHE clause was used in&nbsp;CREATE SEQUENCE&nbsp;or&nbsp;ALTER SEQUENCE.</p></div>
			</div>
	</div>
</div>
</body>
</html>