<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">ssd alignment & unalignment partition performance test</h2>
	<h5 id="">2013-06-07 17:36:30&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020135753630439/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div><font face="arial"   >SSD 的对齐和非对齐分区性能的比较 :&nbsp;</font></div><div><font face="arial"   >测试的SSD型号为OCZ RevoDrive3X2 960GB.&nbsp;</font></div><div><font face="arial"   >测试软件为PostgreSQL带的pg_test_fsync命令.</font></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >操作系统版本 :&nbsp;</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[root@db-xx ~]# cat /etc/redhat-release&nbsp;</font></div><div><font face="arial"   size="2"   >CentOS release 5.8 (Final)</font></div><div><font face="arial"   size="2"   >[root@db-xx ~]# uname -a</font></div><div><font face="arial"   size="2"   >Linux db-xx.sky-mobi.com 2.6.18-308.el5 #1 SMP Tue Feb 21 20:06:06 EST 2012 x86_64 x86_64 x86_64 GNU/Linux</font></div><p></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >SSD信息 :&nbsp;</font></div><div><font face="arial"   >驱动ocz10xx.ko</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[root@db-xx ~]# lspci -k -v|less</font></div><div><font face="arial"   size="2"   >04:00.0 SCSI storage controller: OCZ Technology Group, Inc. RevoDrive 3 X2 PCI-Express SSD 240 GB (Marvell Controller) (rev 02)</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Subsystem: OCZ Technology Group, Inc. RevoDrive 3 X2 PCI-Express SSD 240 GB (Marvell Controller)</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Flags: bus master, fast devsel, latency 0, IRQ 122</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Memory at df1a0000 (64-bit, non-prefetchable) [size=128K]</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Memory at df1c0000 (64-bit, non-prefetchable) [size=256K]</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Expansion ROM at df100000 [disabled] [size=64K]</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [40] Power Management version 3</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [50] MSI: Enable- Count=1/1 Maskable- 64bit+</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [70] Express Endpoint, MSI 00</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [100] Advanced Error Reporting</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [140] Virtual Channel</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Kernel driver in use: ocz10xx</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Kernel modules: ocz10xx</font></div><p></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >驱动信息 :&nbsp;</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[root@db-xx ~]# modinfo ocz10xx</font></div><div><font face="arial"   size="2"   >filename: &nbsp; &nbsp; &nbsp; /lib/modules/2.6.18-308.el5/extra/ocz10xx.ko</font></div><div><font face="arial"   size="2"   >version: &nbsp; &nbsp; &nbsp; &nbsp;3.7.6.3912</font></div><div><font face="arial"   size="2"   >license: &nbsp; &nbsp; &nbsp; &nbsp;Proprietary</font></div><div><font face="arial"   size="2"   >description: &nbsp; &nbsp;OCZ Linux driver</font></div><div><font face="arial"   size="2"   >author: &nbsp; &nbsp; &nbsp; &nbsp; OCZ Technology Group, Inc.</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001084sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001083sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001044sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001043sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001042sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001041sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001022sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001021sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001080sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001184sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >alias: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pci:v00001B85d00001144sv*sd*bc*sc*i*</font></div><div><font face="arial"   size="2"   >depends: &nbsp; &nbsp; &nbsp; &nbsp;scsi_mod</font></div><div><font face="arial"   size="2"   >vermagic: &nbsp; &nbsp; &nbsp; 2.6.18-308.el5 SMP mod_unload gcc-4.1</font></div><div><font face="arial"   size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ocz_msi_enable: Enable MSI Support for OCZ VCA controllers (default=0) (int)</font></div><div><font face="arial"   size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ocz_debug_enable: Enable Debug (default=0) (int)</font></div><p></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >非对齐分区 :&nbsp;</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[root@db-xx ~]# fdisk /dev/sde</font></div><div><font face="arial"   size="2"   >The number of cylinders for this disk is set to 116741.</font></div><div><font face="arial"   size="2"   >There is nothing wrong with that, but this is larger than 1024,</font></div><div><font face="arial"   size="2"   >and could in certain setups cause problems with:</font></div><div><font face="arial"   size="2"   >1) software that runs at boot time (e.g., old versions of LILO)</font></div><div><font face="arial"   size="2"   >2) booting and partitioning software from other OSs</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp;(e.g., DOS FDISK, OS/2 FDISK)</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Command (m for help): n</font></div><div><font face="arial"   size="2"   >Command action</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp;e &nbsp; extended</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp;p &nbsp; primary partition (1-4)</font></div><div><font face="arial"   size="2"   >p</font></div><div><font face="arial"   size="2"   >Partition number (1-4): 1</font></div><div><font face="arial"   size="2"   >First cylinder (1-116741, default 1):&nbsp;</font></div><div><font face="arial"   size="2"   >Using default value 1</font></div><div><font face="arial"   size="2"   >Last cylinder or +size or +sizeM or +sizeK (1-116741, default 116741):&nbsp;</font></div><div><font face="arial"   size="2"   >Using default value 116741</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Command (m for help): w</font></div><div><font face="arial"   size="2"   >The partition table has been altered!</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Calling ioctl() to re-read partition table.</font></div><div><font face="arial"   size="2"   >Syncing disks.</font></div><p></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >查看起始和结束扇区位置.</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[root@db-xx ~]# fdisk -u -l /dev/sde</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Disk /dev/sde: 960.2 GB, 960229538304 bytes</font></div><div><font face="arial"   size="2"   >255 heads, 63 sectors/track, 116741 cylinders, total 1875448317 sectors</font></div><div><font face="arial"   size="2"   >Units = sectors of 1 * 512 = 512 bytes</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp;Device Boot &nbsp; &nbsp; &nbsp;Start &nbsp; &nbsp; &nbsp; &nbsp; End &nbsp; &nbsp; &nbsp;Blocks &nbsp; Id &nbsp;System</font></div><div><font face="arial"   size="2"   >/dev/sde1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;63 &nbsp;1875444164 &nbsp; 937722051 &nbsp; 83 &nbsp;Linux</font></div><p></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >格式化 :&nbsp;</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[root@db-xx ~]# partprobe&nbsp;</font></div><div><font face="arial"   size="2"   >[root@db-xx ~]# mkfs.ext4 -b 4096 /dev/sde1</font></div><p></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >对齐前的fsync测试结果 :&nbsp;</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[postgres@db-xx pgdata]$ pg_test_fsync</font></div><div><font face="arial"   size="2"   >5 seconds per test</font></div><div><font face="arial"   size="2"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Compare file sync methods using one 16kB write:</font></div><div><font face="arial"   size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font face="arial"   size="2"   >is Linux's default)</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9699.678 ops/sec &nbsp; &nbsp; 103 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7953.484 ops/sec &nbsp; &nbsp; 126 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 11947.938 ops/sec &nbsp; &nbsp; &nbsp;84 usecs/op</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Compare file sync methods using two 16kB writes:</font></div><div><font face="arial"   size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font face="arial"   size="2"   >is Linux's default)</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6623.739 ops/sec &nbsp; &nbsp; 151 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5428.723 ops/sec &nbsp; &nbsp; 184 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5984.738 ops/sec &nbsp; &nbsp; 167 usecs/op</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Compare open_sync with different write sizes:</font></div><div><font face="arial"   size="2"   >(This is designed to compare the cost of writing 16kB</font></div><div><font face="arial"   size="2"   >in different write open_sync sizes.)</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; 11944.803 ops/sec &nbsp; &nbsp; &nbsp;84 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp; 7001.228 ops/sec &nbsp; &nbsp; 143 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp; 3991.088 ops/sec &nbsp; &nbsp; 251 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp; 2241.544 ops/sec &nbsp; &nbsp; 446 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; 1183.734 ops/sec &nbsp; &nbsp; 845 usecs/op</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font face="arial"   size="2"   >(If the times are similar, fsync() can sync data written</font></div><div><font face="arial"   size="2"   >on a different descriptor.)</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7125.895 ops/sec &nbsp; &nbsp; 140 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7030.647 ops/sec &nbsp; &nbsp; 142 usecs/op</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Non-Sync'ed 16kB writes:</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 112601.709 ops/sec &nbsp; &nbsp; &nbsp; 9 usecs/op</font></div><p></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >对齐分区 :&nbsp;</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[root@db-xx ~]# fdisk -u /dev/sde</font></div><div><font face="arial"   size="2"   >Command (m for help): n</font></div><div><font face="arial"   size="2"   >Command action</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp;e &nbsp; extended</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp;p &nbsp; primary partition (1-4)</font></div><div><font face="arial"   size="2"   >p</font></div><div><font face="arial"   size="2"   >Partition number (1-4): 1</font></div><div><font face="arial"   size="2"   >First sector (63-1875448316, default 63): 2048</font></div><div><font face="arial"   size="2"   >Last sector or +size or +sizeM or +sizeK (2048-1875448316, default 1875448316): 1867775999</font></div><p></p></pre></div><div><font face="arial"   >对齐方式, fdisk -c -u 开始部分已经默认对齐(2048开始).</font></div><div><font face="arial"   >因为扇区编号从0开始. 开始扇区号取1MB的整数, 结束扇区号取1MB的整数-1.&nbsp;</font></div><div><font face="arial"   >这样得到的容量为1MB的倍数, 同时也是32k, 64k, 128k, 512k等的倍数.</font></div><div><font face="arial"   >简单的方法, 例如要分一个50GB的分区, 那么就是(50*1024*2048)-1</font></div><div><font face="arial"   >即在Last sector or +size or +sizeM or +sizeK (2048-1875448316, default 1875448316):这里输入+</font><span style="font-family: arial; line-height: 28px;"   >(50*1024*2048)-1</span></div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >postgres=# select 2048*512/1024/1024.0;</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ?column? &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font face="arial"   size="2"   >------------------------</font></div><div><font face="arial"   size="2"   >&nbsp;1.00000000000000000000</font></div><div><font face="arial"   size="2"   >(1 row)</font></div><div><font face="arial"   size="2"   >postgres=# select (1867775999::int8+1)*512/1024/1024.0;</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; ?column? &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font face="arial"   size="2"   >---------------------</font></div><div><font face="arial"   size="2"   >&nbsp;912000.000000000000</font></div><div><font face="arial"   size="2"   >(1 row)</font></div><p></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >查看起始和结束扇区 :&nbsp;</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[root@db-xx ~]# fdisk -u -l /dev/sde</font></div><div><font face="arial"   size="2"   >Disk /dev/sde: 960.2 GB, 960229538304 bytes</font></div><div><font face="arial"   size="2"   >255 heads, 63 sectors/track, 116741 cylinders, total 1875448317 sectors</font></div><div><font face="arial"   size="2"   >Units = sectors of 1 * 512 = 512 bytes</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp;Device Boot &nbsp; &nbsp; &nbsp;Start &nbsp; &nbsp; &nbsp; &nbsp; End &nbsp; &nbsp; &nbsp;Blocks &nbsp; Id &nbsp;System</font></div><div><font face="arial"   size="2"   >/dev/sde1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2048 &nbsp;1867775999 &nbsp; 933886976 &nbsp; 83 &nbsp;Linux</font></div><p></p></pre></div><div><span style="line-height: 22px; font-family: arial;"   >格式化 :&nbsp;</span></div><div><pre class="prettyprint"   ><p><font size="2"   >[root@db-xx ~]# mkfs.ext4 -b 4096 /dev/sde1</font></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >对齐后的fsync测试结果 :&nbsp;</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[postgres@db-xx pgdata]$ pg_test_fsync</font></div><div><font face="arial"   size="2"   >5 seconds per test</font></div><div><font face="arial"   size="2"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Compare file sync methods using one 16kB write:</font></div><div><font face="arial"   size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font face="arial"   size="2"   >is Linux's default)</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10478.848 ops/sec &nbsp; &nbsp; &nbsp;95 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9008.415 ops/sec &nbsp; &nbsp; 111 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 13100.546 ops/sec &nbsp; &nbsp; &nbsp;76 usecs/op</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Compare file sync methods using two 16kB writes:</font></div><div><font face="arial"   size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font face="arial"   size="2"   >is Linux's default)</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6995.627 ops/sec &nbsp; &nbsp; 143 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5997.840 ops/sec &nbsp; &nbsp; 167 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6672.413 ops/sec &nbsp; &nbsp; 150 usecs/op</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Compare open_sync with different write sizes:</font></div><div><font face="arial"   size="2"   >(This is designed to compare the cost of writing 16kB</font></div><div><font face="arial"   size="2"   >in different write open_sync sizes.)</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; 13157.005 ops/sec &nbsp; &nbsp; &nbsp;76 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp; 8713.243 ops/sec &nbsp; &nbsp; 115 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp; 4989.391 ops/sec &nbsp; &nbsp; 200 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp; 2383.124 ops/sec &nbsp; &nbsp; 420 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; 1240.352 ops/sec &nbsp; &nbsp; 806 usecs/op</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font face="arial"   size="2"   >(If the times are similar, fsync() can sync data written</font></div><div><font face="arial"   size="2"   >on a different descriptor.)</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8978.282 ops/sec &nbsp; &nbsp; 111 usecs/op</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8947.028 ops/sec &nbsp; &nbsp; 112 usecs/op</font></div><div><font face="arial"   size="2"   ><br></font></div><div><font face="arial"   size="2"   >Non-Sync'ed 16kB writes:</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 107073.134 ops/sec &nbsp; &nbsp; &nbsp; 9 usecs/op</font></div><p></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >[小结]</font></div><div><font face="arial"   >1. fdatasync对齐后的IO性能有8%左右的提升. 其他同步函数也有相应的提升.</font></div><div><font face="arial"   >2. 另外需要注意的影响是, OCZ SSD 在使用容量超过整块磁盘的一半后性能会急剧下降.</font></div><div><font face="arial"   >所以建议将磁盘分成2个区, 每个区不要超过整块磁盘的一半容量. 例如 :&nbsp;</font></div><div><pre class="prettyprint"   ><p></p><div><font face="arial"   size="2"   >[root@db-xx ~]# fdisk -u -l /dev/sde</font></div><div><font face="arial"   size="2"   >Disk /dev/sde: 960.2 GB, 960229538304 bytes</font></div><div><font face="arial"   size="2"   >255 heads, 63 sectors/track, 116741 cylinders, total 1875448317 sectors</font></div><div><font face="arial"   size="2"   >Units = sectors of 1 * 512 = 512 bytes</font></div><div><font face="arial"   size="2"   >&nbsp; &nbsp;Device Boot &nbsp; &nbsp; &nbsp;Start &nbsp; &nbsp; &nbsp; &nbsp; End &nbsp; &nbsp; &nbsp;Blocks &nbsp; Id &nbsp;System</font></div><div><font face="arial"   size="2"   >/dev/sde1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2048 &nbsp; 933887999 &nbsp; 466942976 &nbsp; 83 &nbsp;Linux</font></div><div><font face="arial"   size="2"   >/dev/sde2 &nbsp; &nbsp; &nbsp; 933888000 &nbsp;1867775999 &nbsp; 466944000 &nbsp; 83 &nbsp;Linux</font></div><p></p></pre></div><div><font face="arial"   ><br></font></div><div><font face="arial"   >[参考]</font></div><div><font face="arial"   >1.&nbsp;</font><a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://wiki.centos.org/HowTos/Disk_Optimization"   >http://wiki.centos.org/HowTos/Disk_Optimization</a></div><div><font face="arial"   >2.&nbsp;</font><a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://apcmag.com/how-to-maximise-ssd-performance-with-linux.htm"   >http://apcmag.com/how-to-maximise-ssd-performance-with-linux.htm</a></div><div><font face="arial"   >3.&nbsp;</font><a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://lifehacker.com/5837769/make-sure-your-partitions-are-correctly-aligned-for-optimal-solid-state-drive-performance"   >http://lifehacker.com/5837769/make-sure-your-partitions-are-correctly-aligned-for-optimal-solid-state-drive-performance</a></div><div><font face="arial"   >4.&nbsp;</font><a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://pof.eslack.org/2013/01/12/ssd-alignment-on-linux-with-ext4-and-lvm/"   >http://pof.eslack.org/2013/01/12/ssd-alignment-on-linux-with-ext4-and-lvm/</a></div><div><font face="arial"   >5.&nbsp;</font><a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://forums.linuxmint.com/viewtopic.php?f=90&amp;t=113399"   >http://forums.linuxmint.com/viewtopic.php?f=90&amp;t=113399</a></div><div><font face="arial"   >6.&nbsp;</font><a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://blog.nuclex-games.com/2009/12/aligning-an-ssd-on-linux/"   >http://blog.nuclex-games.com/2009/12/aligning-an-ssd-on-linux/</a></div><div><font face="arial"   >7.&nbsp;</font><a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://www.ocztechnologyforum.com/forum/showthread.php?48309-Partition-alignment-importance-under-Windows-XP-(32-bit-and-64-bit)-why-it-helps-with-stuttering-and-increases-drive-working-life"   >http://www.ocztechnologyforum.com/forum/showthread.php?48309-Partition-alignment-importance-under-Windows-XP-(32-bit-and-64-bit)-why-it-helps-with-stuttering-and-increases-drive-working-life</a></div><div><font face="arial"   >8.&nbsp;</font><a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/Advanced_format"   >http://en.wikipedia.org/wiki/Advanced_format</a></div></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="ssd alignment  unalignment partition performance test - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>