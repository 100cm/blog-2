<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL CATALOG_VERSION_NO check</h2>
	<h5 id="">2011-01-18 10:23:12&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402011018101959466/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">源码文件postgresql-9.0.2/src/include/catalog/catversion.h<br>内容如下:<br>/*-------------------------------------------------------------------------<br>&nbsp;*<br>&nbsp;* catversion.h<br>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Catalog version number" for PostgreSQL.<br>&nbsp;*<br>&nbsp;* The catalog version number is used to flag incompatible changes in<br>&nbsp;* the PostgreSQL system catalogs.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Whenever anyone changes the format of<br>&nbsp;* a system catalog relation, or adds, deletes, or modifies standard<br>&nbsp;* catalog entries in such a way that an updated backend wouldn't work<br>&nbsp;* with an old database (or vice versa), the catalog version number<br>&nbsp;* should be changed.&nbsp; The version number stored in pg_control by initdb<br>&nbsp;* is checked against the version number compiled into the backend at<br>&nbsp;* startup time, so that a backend can refuse to run in an incompatible<br>&nbsp;* database.<br>&nbsp;*<br>&nbsp;* The point of this feature is to provide a finer grain of compatibility<br>&nbsp;* checking than is possible from looking at the major version number<br>&nbsp;* stored in PG_VERSION.&nbsp; It shouldn't matter to end users, but during<br>&nbsp;* development cycles we usually make quite a few incompatible changes<br>&nbsp;* to the contents of the system catalogs, and we don't want to bump the<br>&nbsp;* major version number for each one.&nbsp; What we can do instead is bump<br>&nbsp;* this internal version number.&nbsp; This should save some grief for<br>&nbsp;* developers who might otherwise waste time tracking down "bugs" that<br>&nbsp;* are really just code-vs-database incompatibilities.<br>&nbsp;*<br>&nbsp;* The rule for developers is: if you commit a change that requires<br>&nbsp;* an initdb, you should update the catalog version number (as well as<br>&nbsp;* notifying the pghackers mailing list, which has been the informal<br>&nbsp;* practice for a long time).<br>&nbsp;*<br>&nbsp;* The catalog version number is placed here since modifying files in<br>&nbsp;* include/catalog is the most common kind of initdb-forcing change.<br>&nbsp;* But it could be used to protect any kind of incompatible change in<br>&nbsp;* database contents or layout, such as altering tuple headers.<br>&nbsp;*<br>&nbsp;*<br>&nbsp;* Portions Copyright (c) 1996-2010, PostgreSQL Global Development Group<br>&nbsp;* Portions Copyright (c) 1994, Regents of the University of California<br>&nbsp;*<br>&nbsp;* $PostgreSQL: pgsql/src/include/catalog/catversion.h,v 1.587.2.1 2010/08/05 18:21:29 tgl Exp $<br>&nbsp;*<br>&nbsp;*-------------------------------------------------------------------------<br>&nbsp;*/<br>#ifndef CATVERSION_H<br>#define CATVERSION_H<br><br>/*<br>&nbsp;* We could use anything we wanted for version numbers, but I recommend<br>&nbsp;* following the "YYYYMMDDN" style often used for DNS zone serial numbers.<br>&nbsp;* YYYYMMDD are the date of the change, and N is the number of the change<br>&nbsp;* on that day.&nbsp; (Hopefully we'll never commit ten independent sets of<br>&nbsp;* catalog changes on the same day...)<br>&nbsp;*/<br><br>/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yyyymmddN */<br>#define CATALOG_VERSION_NO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 201008051<br><br>#endif<br><br>使用pg_controldata可以查看到这部分信息:<br>postgres@wapportal-guize-db-&gt; pg_controldata /database/pgdata/pg_root<br>pg_control version number:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 903<br><font size="5">Catalog version number:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 201004261</font><br>Database system identifier:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5486854347216502005<br>Database cluster state:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in production<br>pg_control last modified:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tue 18 Jan 2011 10:19:10 AM CST<br>Latest checkpoint location:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 46/5CBA21A0<br>Prior checkpoint location:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 46/5C6DCCA0<br>Latest checkpoint's REDO location:&nbsp;&nbsp;&nbsp; 46/5C9181B0<br>Latest checkpoint's TimeLineID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>Latest checkpoint's NextXID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0/130050360<br>Latest checkpoint's NextOID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2919666<br>Latest checkpoint's NextMultiXactId:&nbsp; 652<br>Latest checkpoint's NextMultiOffset:&nbsp; 1318<br>Latest checkpoint's oldestXID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 655<br>Latest checkpoint's oldestXID's DB:&nbsp;&nbsp; 1<br>Latest checkpoint's oldestActiveXID:&nbsp; 130050360<br>Time of latest checkpoint:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tue 18 Jan 2011 10:16:53 AM CST<br>Minimum recovery ending location:&nbsp;&nbsp;&nbsp;&nbsp; 0/0<br>Backup start location:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0/0<br>Current wal_level setting:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hot_standby<br>Current max_connections setting:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1800<br>Current max_prepared_xacts setting:&nbsp;&nbsp; 0<br>Current max_locks_per_xact setting:&nbsp;&nbsp; 64<br>Maximum data alignment:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8<br>Database block size:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8192<br>Blocks per segment of large relation: 1048576<br>WAL block size:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 65536<br>Bytes per WAL segment:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 67108864<br>Maximum length of identifiers:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 64<br>Maximum columns in an index:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32<br>Maximum size of a TOAST chunk:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1996<br>Date/time type storage:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 64-bit integers<br>Float4 argument passing:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; by value<br>Float8 argument passing:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; by value<br><br>今天在升级postgresql 9beta2 到postgresql 9.0.2发生了如下错误:<br>2011-01-18 09:58:52 CST @ (PID:4455 SID:4d34f3dc.1167)&nbsp; DETAIL:&nbsp; The database cluster was initialized with CATALOG_VERSION_NO 201004261, but the server was compiled with CATALOG_VERSION_NO 201008051.<br>2011-01-18 09:58:52 CST @ (PID:4455 SID:4d34f3dc.1167)&nbsp; HINT:&nbsp; It looks like you need to initdb.<br><br>看完上面那个.h文件的解释就不难理解了。<br>看样子要用pg_dump升级了。</div>
	</div>
</div>
</body>
</html>