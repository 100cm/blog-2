<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">fgets vs scanf</h2>
	<h5 id="">2012-08-07 7:47:49&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020127774749335/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><img title="fgets vs scanf - 德哥@Digoal - The Heart,The World."  alt="fgets vs scanf - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img3.ph.126.net/xVeCAXRwd7GfBhaOAcefpg==/1561904645785190023.jpg"  ></div><div><br></div><div>fscanf 与scanf类似, 只是多了可选 数据流.</div><div>如stdin ,还是其他data stream.</div><div><br></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 zzz]# cat n.c</font></div><font size="2"  ><wbr></font><div><font size="2"  >#include &lt;stdio.h&gt;</font></div><div><font size="2"  >#include &lt;string.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >char a[10];</font></div><div><font size="2"  >int main() {</font></div><div><font size="2"  >&nbsp; printf("enter a word:");</font></div><div><font size="2"  >&nbsp; fgets(a,sizeof(a),stdin); &nbsp;// 使用stdin作为输入, fgets限定长度时使用sizeof(a) 不需要去除\0. scanf和fscanf使用%10s限定长度时表示存储10个字符(不包括\0, 所以要sizeof(a)-1)</font></div><div><font size="2"  >&nbsp; printf("a:%s\n", a);</font></div><div><font size="2"  >&nbsp; return 0;</font></div><div><font size="2"  >}</font></div><div><font size="2"  >结果</font></div><div><font size="2"  >[root@db-172-16-3-150 zzz]# gcc -O3 -Wall -Wextra -Werror -g ./n.c -o n &amp;&amp; ./n</font></div><div><font size="2"  >enter a word:abc def ghi</font></div><div><font size="2"  >a:abc def g</font></div><p></p></pre></div><div><pre class="prettyprint"  ><div><font size="2"  >[root@db-172-16-3-150 zzz]# cat n.c</font></div><div><font size="2"  >#include &lt;stdio.h&gt;</font></div><div><font size="2"  >#include &lt;string.h&gt;</font></div><div><font size="2"  >#include &lt;unistd.h&gt;</font></div><div><font size="2"  >#include &lt;stdlib.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >int main() {</font></div><div><font size="2"  >&nbsp; char a[10];</font></div><div><font size="2"  >&nbsp; char w_file[] = "/root/zzz/out.txt";</font></div><div><font size="2"  >&nbsp; char w_mode[] = "w";</font></div><div><font size="2"  >&nbsp; FILE *out = fopen(w_file,w_mode);</font></div><div><font size="2"  >&nbsp; printf("enter a word:");</font></div><div><font size="2"  >&nbsp; fgets(a,sizeof(a),stdin);</font></div><div><font size="2"  >&nbsp; fprintf(out,"a:%s\n", a); &nbsp;// 输出到文件</font></div><div><font size="2"  >&nbsp; return 0;</font></div><div><font size="2"  >}</font></div><div><font size="2"  >结果</font></div><div><font size="2"  >[root@db-172-16-3-150 zzz]# gcc -O3 -Wall -Wextra -Werror -g ./n.c -o n &amp;&amp; ./n</font></div><div><font size="2"  >enter a word:abcdefghijkl</font></div><div><font size="2"  >[root@db-172-16-3-150 zzz]# cat out.txt</font></div><div><font size="2"  >a:abcdefghi</font></div><p></p></pre></div>在测试时遇到几个问题, 请教了诸位C高手后,记录一下.<div><div>请教一个问题。</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >#include &lt;stdio.h&gt;</font></div><div><font size="2"  >#include &lt;string.h&gt;</font></div><div><font size="2"  >#include &lt;unistd.h&gt;</font></div><div><font size="2"  >#include &lt;stdlib.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >void output(FILE * out,char * a) {</font></div><div><font size="2"  >&nbsp; fprintf(out,"a:%s\n", a);</font></div><div><font size="2"  >&nbsp; close(fileno(out));</font></div><div><font size="2"  >}</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >char a[10];</font></div><div><font size="2"  >char w_file[] = "/root/zzz/out.txt";</font></div><div><font size="2"  >char w_mode[] = "w";</font></div><div><font size="2"  >//FILE *out = fopen(w_file,w_mode);</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >int main() {</font></div><div><font size="2"  >&nbsp; FILE *out = fopen(w_file,w_mode);</font></div><div><font size="2"  >&nbsp; printf("enter a word:");</font></div><div><font size="2"  >&nbsp; fgets(a,sizeof(a),stdin);</font></div><div><font size="2"  >&nbsp; output(out,a);</font></div><div><font size="2"  >&nbsp; return 0;</font></div><div><font size="2"  >}</font></div><p></p></pre></div><div><br></div><div>1. 这个怎么输出没有打到out.txt里面呢?</div><div>&nbsp; &nbsp;但是 把close(fileno(out)) 注释就可以输出到out.txt</div><div>A:</div><div>两个问题, 1. 关闭文件前先调用flush到磁盘 2. 使用close关闭对应的是open打开的. fopen打开的应该使用fclose关闭.</div><div>man fclose :&nbsp;</div><div><div>NOTES</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Note &nbsp;that &nbsp;fclose() &nbsp;only flushes the user space buffers provided by the C library. To ensure that the data is</div><div>&nbsp; &nbsp; &nbsp; &nbsp;physically stored on disk the kernel buffers must be flushed too, e.g. with sync(2) or fsync(2).</div></div><div><br></div><div>2. 如果把FILE *out = fopen(w_file,w_mode); 这个放在所有函数的外面就会报错</div><div>&nbsp; &nbsp;./n.c:14: error: initializer element is not constant</div><div>A:</div><div>C都是函数式语言，所有的可执行代码都必须在某个函数体内的，外部只能定义全局变量、常量等.</div><div>所以在全局变量初始化的地方都不能调用函数,&nbsp;</div><div>最后代码修改为 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >#include &lt;stdio.h&gt;</font></div><div><font size="2"  >#include &lt;string.h&gt;</font></div><div><font size="2"  >#include &lt;unistd.h&gt;</font></div><div><font size="2"  >#include &lt;stdlib.h&gt;</font></div><div><font size="2"  >#include &lt;errno.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >void output(FILE * lout,char * la) {</font></div><div><font size="2"  >&nbsp; fprintf(lout,"a:%s\n", la);</font></div><div><font size="2"  >&nbsp; if (fsync(fileno(lout))) {</font></div><div><font size="2"  >&nbsp; &nbsp; printf("error:%s\n", strerror(errno));</font></div><div><font size="2"  >&nbsp; }</font></div><div><font size="2"  >}</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >char a[10];</font></div><div><font size="2"  >char w_file[] = "/root/zzz/out.txt";</font></div><div><font size="2"  >char w_mode[] = "w";</font></div><div><font size="2"  >FILE *out;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >int main() {</font></div><div><font size="2"  >&nbsp; out = fopen(w_file,w_mode);</font></div><div><font size="2"  >&nbsp; printf("enter a word:");</font></div><div><font size="2"  >&nbsp; fgets(a,sizeof(a),stdin);</font></div><div><font size="2"  >&nbsp; output(out,a);</font></div><div><font size="2"  >&nbsp; fclose(out);</font></div><div><font size="2"  >&nbsp; return 0;</font></div><div><font size="2"  >}</font></div><p></p></pre></div></div></div>
	</div>
</div>
</body>
</html>