<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">linux rescue edit grub init=/bin/bash</h2>
	<h5 id="">2012-08-30 11:00:07&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402012730105118968/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">某机器的分区异常, 并且这个分区在/etc/fstab条目里面, 所以导致系统无法启动.&nbsp;<div>启动界面提升敲ROOT密码进入修复, 但是root密码过于复杂, 或者root密码忘记的话<span style="line-height: 22px;"  >(这里即使使用单用户也无法绕过输入root密码)</span>, 就苦逼了.</div><div><div>一般来说这个时候需要找到引导光盘或者通过网络引导, 进入rescue模式修改root密码或直接进行修复.</div><div>这里介绍一个更加快捷的解决方法, 不需要借助外界来引导, 不需要root密码直接进入.</div><div>我们知道进单用户模式, 在选择界面编辑如下 :&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; kernel /boot/vmlinuz-2.6.18-194.el5 ro root=LABEL=/ rhgb quiet</div><div>改成</div><div>&nbsp; &nbsp; &nbsp; &nbsp; kernel /boot/vmlinuz-2.6.18-194.el5 ro root=LABEL=/ rhgb quiet 1</div><div>然后按b引导.</div><div><br></div><div>这里我们需要改成</div><div>&nbsp; &nbsp; &nbsp; &nbsp; kernel /boot/vmlinuz-2.6.18-194.el5 rw root=LABEL=/ init=/bin/bash</div><div>然后按b引导.<br>这样就进入了挂载了/的一个bash环境, 可以使用passwd root修改密码. 执行/sbin/fsck等.</div></div><div><br></div><div>下面摘录几篇相关的文章 :&nbsp;</div><div>【Reset forgotten root password on linux boxes】</div><div><div>I had an old computer with linux installed and had forgotten the root password for it. Unfortunately, I did not have my favourite handy-dany knoppix cd around but did remember that I could get a shell access by appending "init=/bin/bash" to the lilo/grub boot loader, which should be enough to get in and reset the root password.</div><div><br></div><div>DISCLAIMER -- I do not take any responsibility for your actions if you go and try this on your friends machine!!</div><div><br></div><div>Press Ctrl-Alt-Del to shut down the system in an orderly fashion.</div><div>Reboot the system and when lilo/grub boot loader get to the point where you select the various installed kernels on the system, type the letter "a" for "append".</div><div>You will get a prompt like this to add boot options to the boot string found in your lilo/grub conf file:</div><div><pre class="prettyprint"  ><p><font size="2"  >grub append&gt; ro root=LABEL=/</font></p></pre></div><div>Append "init=/bin/bash" to it to look like this.</div><div><pre class="prettyprint"  ><p><font size="2"  >grub append&gt; ro root=LABEL=/ init=/bin/bash</font></p></pre></div><div>This tells the kernel to drop to a root prompt bash shell instead of starting the "/sbin/init" process.</div><div><br></div><div>The root filesystem is currently mounted read only which needs to be changed to read/write prior to resetting the password.</div><div><pre class="prettyprint"  ><p><font size="2"  ># mount -o remount,rw /</font></p></pre></div><div>Now that the file-system is remounted read-write, go ahead and type `passwd` to change the root password.</div><div><pre class="prettyprint"  ><p><font size="2"  ># passwd</font></p></pre></div><div>Since "init" isn't running to safely take down the system, remount the system to read only prior to shutting down the system.</div><div><pre class="prettyprint"  ><p><font size="2"  ># mount -o remount,ro /</font></p></pre></div><div>You can now safely press on the power button to shutdown the sytem.</div></div><div><br></div><div>【Why does Linux allow ‘init=/bin/bash’?】</div><div><div>I recently found out that if I edit GRUB before booting and I add rw init=/bin/bash I end up with a root shell.</div><div><br></div><div>Being in a condition that I want to understand everything I would like to know why this happens. I mean is it a bug? is it a feature? is it there to help admins to fix things as it only works if you have physical access to a computer?</div><div><br></div><div>Is it provided by GRUB or the actual kernel?</div><div><br></div><div>linux boot grub</div></div><div><br></div><div>Answer1 :&nbsp;</div><div><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 15px; vertical-align: baseline; clear: both; word-wrap: break-word; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 20px;"  >This is a feature, and is used for system maintainance: it allows a sysadmin to recover a system from messed-up initialization files or change a forgotten password.</p><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 15px; vertical-align: baseline; clear: both; word-wrap: break-word; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 20px;"  ><a style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; vertical-align: baseline; text-decoration: none; cursor: pointer; color: rgb(43, 109, 151); " rel="nofollow" href="https://www.redhat.com/archives/rhl-list/2005-March/msg04089.html"  >This post in the Red Hat mailing list</a>&nbsp;explains some things:</p><blockquote style="margin-top: 0px; margin-bottom: 10px; margin-left: 0px; padding-top: 10px; padding-right: 10px; padding-bottom: 1px; padding-left: 10px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 2px; border-style: initial; border-color: initial; border-image: initial; font-size: 15px; vertical-align: baseline; quotes: none; background-color: rgb(240, 240, 240); border-left-style: dotted; border-left-color: rgb(204, 204, 204); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 20px;"  ><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; vertical-align: baseline; clear: both; word-wrap: break-word;"  >In Unix-like systems, init is the first process to be run, and the ultimate ancestor of all processes ever run. It's responsible for running all the init scripts.</p><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; vertical-align: baseline; clear: both; word-wrap: break-word;"  >You're telling the Linux kernel to run /bin/bash as init, rather than the system init. [...]</p></blockquote><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 15px; vertical-align: baseline; clear: both; word-wrap: break-word; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 20px;"  >Thus, you are not exploiting anything, you are just using a standard kernel feature.</p><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 15px; vertical-align: baseline; clear: both; word-wrap: break-word; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 20px;"  >Besides, as noted in a comment, the&nbsp;<code style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 1px; padding-right: 5px; padding-bottom: 1px; padding-left: 5px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 13px; vertical-align: baseline; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; color: rgb(34, 34, 34); background-color: rgb(238, 238, 238);"  >rw</code>&nbsp;flag is separate from&nbsp;<code style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 1px; padding-right: 5px; padding-bottom: 1px; padding-left: 5px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 13px; vertical-align: baseline; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; color: rgb(34, 34, 34); background-color: rgb(238, 238, 238);"  >init=</code>, it just tells the system to mount the root file system as read-write (so you can e.g. edit the misconfigured file or change a password).</p></div><div><span style="color: rgb(68, 68, 68); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 13px; line-height: 17px;"  >Also,&nbsp;</span><code style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 1px; padding-right: 5px; padding-bottom: 1px; padding-left: 5px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 13px; vertical-align: baseline; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; color: rgb(34, 34, 34); background-color: rgb(238, 238, 238); line-height: 17px;"  >rw</code><span style="color: rgb(68, 68, 68); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 13px; line-height: 17px;"  >&nbsp;is completely separate from&nbsp;</span><code style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 1px; padding-right: 5px; padding-bottom: 1px; padding-left: 5px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 13px; vertical-align: baseline; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; color: rgb(34, 34, 34); background-color: rgb(238, 238, 238); line-height: 17px;"  >init=</code><span style="color: rgb(68, 68, 68); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 13px; line-height: 17px;"  >. The former just tells the kernel to mount the root filesystem read-write.</span> </div><div><br></div><div>Answer2 :&nbsp;</div><div><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 15px; vertical-align: baseline; clear: both; word-wrap: break-word; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 20px;"  >When the computer starts, it runs a program called "init", usually found at&nbsp;<code style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 1px; padding-right: 5px; padding-bottom: 1px; padding-left: 5px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 13px; vertical-align: baseline; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; color: rgb(34, 34, 34); background-color: rgb(238, 238, 238);"  >/bin/init</code>&nbsp;or&nbsp;<code style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 1px; padding-right: 5px; padding-bottom: 1px; padding-left: 5px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 13px; vertical-align: baseline; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; color: rgb(34, 34, 34); background-color: rgb(238, 238, 238);"  >/sbin/init</code>. This program is responsible for all the system startup and creating a usable environment.</p><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 15px; vertical-align: baseline; clear: both; word-wrap: break-word; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 20px;"  >Specifying&nbsp;<code style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 1px; padding-right: 5px; padding-bottom: 1px; padding-left: 5px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 13px; vertical-align: baseline; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; color: rgb(34, 34, 34); background-color: rgb(238, 238, 238);"  >init=/bin/bash</code>&nbsp;tells the kernel to run&nbsp;<code style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 1px; padding-right: 5px; padding-bottom: 1px; padding-left: 5px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 13px; vertical-align: baseline; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; color: rgb(34, 34, 34); background-color: rgb(238, 238, 238);"  >/bin/bash</code>&nbsp;instead (which is a shell). Specifying<code style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 1px; padding-right: 5px; padding-bottom: 1px; padding-left: 5px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 13px; vertical-align: baseline; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; color: rgb(34, 34, 34); background-color: rgb(238, 238, 238);"  >rw</code>&nbsp;tells the kernel to boot with the hard disk in read-write mode instead of read-only mode. Traditionally the kernel starts with the disk in read-only mode and a process later on checks the integrity of the disk before switching to read-write.</p><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 15px; vertical-align: baseline; clear: both; word-wrap: break-word; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 20px;"  ><span style="line-height: 20px;"  >Answer3 :&nbsp;</span></p><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 15px; vertical-align: baseline; clear: both; word-wrap: break-word; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 20px;"  ></p><p style="margin-top: 0px; margin-bottom: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; vertical-align: baseline; clear: both; word-wrap: break-word; line-height: 20px;"  >Pieced together from&nbsp;<a style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; vertical-align: baseline; text-decoration: none; cursor: pointer; color: rgb(43, 109, 151); " rel="nofollow" href="http://kernel.org/doc/Documentation/kernel-parameters.txt"  >http://kernel.org/doc/Documentation/kernel-parameters.txt</a></p><pre style="margin-top: 0px; margin-bottom: 10px; padding-top: 5px; padding-right: 5px; padding-bottom: 5px; padding-left: 5px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 13px; vertical-align: baseline; overflow-x: auto; overflow-y: auto; width: auto; max-height: 600px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; background-color: rgb(238, 238, 238); line-height: 20px;"  ><code style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; vertical-align: baseline; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; color: rgb(34, 34, 34);"  >KNL     Is a kernel start-up parameter.  init=   [KNL]         Format: &lt;full_path&gt;         Run specified binary instead of /sbin/init as init         process.  rw      [KNL] Mount root device read-write on boot</code></pre></div><div><br></div><div>【Linux不能正常启动---BASH应对】</div><div><div>如果您确实碰巧发现系统因为 init 脚本或 /sbin/init 本身的问题而不能引导，就可以使用这个紧急引导过程。</div><div><br></div><div>启动时，在LILO或GRUB中向内核传递以下参数：init=/bin/bash</div><div><br></div><div><br></div><div>&nbsp;</div><div>紧急 bash 救援</div><div><br></div><div><br></div><div>在下篇文章中，我们将更改 Linux 系统中对启动至关重要的部分。既然完全可能因某个错误而使您偶尔搞糟引导过程，我将在本文首先讲述：如何用紧急 bash shell 命令启动和运行系统。如果您确实碰巧发现系统因为 init 脚本或 /sbin/init 本身的问题而不能引导，就可以使用这个紧急引导过程。</div><div><br></div><div>进行紧急引导最简单的方法是：在引导时刻使用 GRUB 或 LILO 把 init=/bin/bash 选项传递给内核。 如果使用 GRUB，您应该能够通过点击 e 来实时地编辑当前菜单项，从而在需要时交互地传递该选项。如果使用 LILO，则确保在继续下一步之前，您已知道如何向内核传递启动选项，必要时，还要创建一个新的"紧急"LILO 启动选项。</div><div><br></div><div>过程</div><div>这样，基本的"救援"过程如下。首先，将 init=/bin/bash 作为一个内核引导选项传递给内核。当内核引导时，它将以 /bin/bash 而不是通常的 /sbin/init 作为第一个进程启动。 您不会被提示进行登录就看到一个 root 用户 bash 提示符：</div><div><br></div><div>#</div><div><br></div><div>然而，尽管您看到一个 root bash 提示符，实际上只安装了根文件系统，而且仅以只读的形式安装。下面介绍在这之后如何启动和运行您的系统。如果文件系统没有卸装干净的话，应该首先对它们进行 fsck。首先对根文件系统执行 fsck -a，然后 fsck -R -A -a 就会负责处理所有其它的文件系统：</div><div><br></div><div># fsck -a /dev/hda1</div><div># fsck -R -A -a</div><div><br></div><div>既然文件系统已经一致（或者，如果文件系统在系统重引导时已经卸装干净，并且您跳过了上一步骤），我们可以简单地以可读写方式重新安装根文件系统并且安装 /proc，如下所示：</div><div><br></div><div># mount / -o remount,rw</div><div># mount /proc</div><div><br></div><div>然后，安装可能位于其它分区中的所有重要的文件系统树。例如，如果在另一个分区上有 /usr，则还要输入：</div><div><br></div><div># mount /usr</div><div><br></div><div>如果您想做的不仅仅只是打开一个编辑器的话，则最好是激活交换分区。如果您使用 emacs，您可能会需要它:)</div><div><br></div><div># swapon -a</div><div><br></div><div>现在，您应该能够使用您喜爱的编辑器来编辑任何需要编辑的文件，以便修复现有的引导问题。一旦完成，只需按安装时的顺序，以只读方式重新安装分区即可。例如，如果有一个单独的 /usr 分区，为使所有的文件系统处于一致的状态（准备重新引导），可以输入：</div><div><br></div><div># mount /usr -o remount,ro</div><div># mount / -o remount,ro</div><div><br></div><div>现在，您可以安全地重新引导了。但愿现在已经解决了引导问题，并且可以使用正常的 LILO 或 GRUB 选项启动和运行系统。</div><div><br></div><div># /sbin/reboot -nfi</div></div><br><div>【参考】</div><div><a rel="nofollow" href="http://kernel.org/doc/Documentation/kernel-parameters.txt"  >http://kernel.org/doc/Documentation/kernel-parameters.txt</a> </div></div>
	</div>
</div>
</body>
</html>