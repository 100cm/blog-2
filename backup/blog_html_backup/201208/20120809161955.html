<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">function name address vs array name address</h2>
	<h5 id="">2012-08-09 16:19:55&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020127941729638/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">array 变量在编译时会替换成存储ARRAY数据的内存首地址。<div>所以 array:%p == &amp;array:%p .&nbsp;</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 zzz]# cat f.c</font></div><div><font size="2"  >#include &lt;stdio.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >char a[10] = "abcde";</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >int main() {</font></div><div><font size="2"  >&nbsp; fprintf(stdout, "a:%p, &amp;a:%p\n", a, &amp;a);</font></div><div><font size="2"  >&nbsp; return 0;</font></div><div><font size="2"  >}</font></div><div><font size="2"  >结果</font></div><div><font size="2"  >[root@db-172-16-3-150 zzz]# gcc -O3 -Wall -Wextra -Werror -g ./f.c -o f &amp;&amp; ./f</font></div><div><font size="2"  >a:0x6008bc, &amp;a:0x6008bc</font></div><p></p></pre></div><div><br></div><div><div>function 名则更猛.</div><div>function:%p == &amp;function:%p == *function:%p</div><div>说明函数名是个指针, 指针的内容就是这个指针的地址本身.</div><div>因此使用函数名, 或者*function 或者&amp;function都可以调用这个函数.</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 zzz]# cat f.c</font></div><div><font size="2"  >#include &lt;stdio.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >int test() {</font></div><div><font size="2"  >&nbsp; fprintf(stdout, "test output\n");</font></div><div><font size="2"  >&nbsp; return 1;</font></div><div><font size="2"  >}</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >int main() {</font></div><div><font size="2"  >&nbsp; int test1() {</font></div><div><font size="2"  >&nbsp; &nbsp; return 2;</font></div><div><font size="2"  >&nbsp; }</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; int a = test1();</font></div><div><font size="2"  >&nbsp; int b = (&amp;test)();  // 使用&amp;test调用这个函数</font></div><div><font size="2"  >&nbsp; int c = (*test)();  </font><span style="font-size: small; line-height: 19px;"  >// 使用*test调用这个函数</span></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; fprintf(stdout, "a:%i, b:%i, c:%i\n", a, b, c);</font></div><div><font size="2"  >&nbsp; fprintf(stdout, "test:%p, &amp;test:%p, *test:%p\n", test, &amp;test, *test);</font></div><div><font size="2"  >&nbsp; fprintf(stdout, "test1:%p, &amp;test1:%p, *test1:%p\n", test1, &amp;test1, *test1);</font></div><div><font size="2"  >  fprintf(stdout, "test1+1:%p, (&amp;test1)+1:%p, (*test1)+1:%p\n", test1+1, (&amp;test1)+1, (*test1)+1);</font></div><div><font size="2"  >&nbsp; return a;</font></div><div><font size="2"  >}</font></div><div><font size="2"  >结果</font></div><div><font size="2"  >[root@db-172-16-3-150 zzz]# gcc -O3 -Wall -Wextra -Werror -g ./f.c -o f &amp;&amp; ./f</font></div><div><font size="2"  >test output</font></div><div><font size="2"  >test output</font></div><div><font size="2"  >a:2, b:1, c:1</font></div><div><font size="2"  >test:0x400540, &amp;test:0x400540, *test:0x400540</font></div><div><font size="2"  >test1:0x400530, &amp;test1:0x400530, *test1:0x400530</font></div><div><font size="2"  >test1+1:0x400531, (&amp;test1)+1:0x400531, (*test1)+1:0x400531  // 这里+1都加了一个字节, 而存储</font><span style="font-size: small; line-height: 19px;"  >0x400531这个值需要2个字节, 所以看起来就不对劲了.</span></div><div><span style="font-size: small; line-height: 19px;"  >// 这些可能都是编译器使的障眼法. 函数指针可能另有所指, 那就是code区域. </span></div><p></p></pre></div><div>函数创建时, 这个函数指针将在内存的constants区域创建. &nbsp;</div><div>从打印结构来看,&nbsp;<span style="line-height: 22px;"  >function:%p == &amp;function:%p == *function:%p .但是这可能是编译器搞的鬼. 函数指针肯定是要执行函数体的code区域的,&nbsp;</span></div><div><span style="line-height: 22px;"  >来看一幅图 :&nbsp;</span></div></div><div><div><img title="function name address vs array name address - 德哥@Digoal - The Heart,The World."  alt="function name address vs array name address - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img1.ph.126.net/Io9xQvGQuT9p5dRvpspD6A==/2725240724530241631.jpg"  ></div>&nbsp;</div></div>
	</div>
</div>
</body>
</html>