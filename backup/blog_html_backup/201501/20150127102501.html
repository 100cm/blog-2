<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">python file operate example - 1</h2>
	<h5 id="">2015-01-27 10:25:01&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402015027102245601/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>本文示例, python对文本的操作.</div><div>先从数据库搞一些测试数据到文件中</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# copy (select generate_series(1,1000)||','||md5(random()::text)) to '/home/postgres/test.txt';</font></div><div><font size="2"   >COPY 1000</font></div><p></p></pre></div><div>内容示例</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@localhost-&gt; less /home/postgres/test.txt</font></div><div><font size="2"   >1,891ca83e2c0971a8a0dc8d7e5edda338</font></div><div><font size="2"   >2,75f9acd8d195f905b6ab6014ccef3a6b</font></div><div><font size="2"   >3,ac4c2dc4d9de3461614d26a132f9c82f</font></div><div><font size="2"   >4,41d48a6a19a061e1297339681173c491</font></div><div><font size="2"   >5,756f8ed2d4dce954bb5af9793fbb6581</font></div><div><font size="2"   >6,0f33bd2eae60c9f00a2824e777c27d02</font></div><div><font size="2"   >7,24a75602d88008760ecb4043f1e47fa6</font></div><div><font size="2"   >8,c51474a7d2f939ed97976ea67fdc554e</font></div><p></p></pre></div><div><br></div><div>编写一个测试脚本, 将文件分割成2部分, 重新组合成其他格式</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@localhost-&gt; vi test.py</font></div><div><font size="2"   >import os</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >print(os.getcwd()) &nbsp;# 打印当前工作目录</font></div><div><font size="2"   >os.chdir('/home/postgres') &nbsp;# 修改当前工作目录</font></div><div><font size="2"   >print(os.getcwd())</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >try:</font></div><div><font size="2"   >&nbsp; data=open('test.txt') &nbsp;# 打开文件</font></div><div><font size="2"   >&nbsp; print(data.readline()) # 打印一行</font></div><div><font size="2"   >&nbsp; data.seek(0) &nbsp;# 跳到文件开头</font></div><div><font size="2"   >&nbsp; for each_line in data: &nbsp;# 每次读取一行</font></div><div><font size="2"   >&nbsp; &nbsp; try:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; (key,value)=each_line.split(',', 1) &nbsp;# 使用第一个逗号作为分隔符, 分割成2个值</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; print(key, end='')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; print(' is: ', end='')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; print(value, end='')</font></div><div><font size="2"   >&nbsp; &nbsp; except:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; pass</font></div><div><font size="2"   >&nbsp; data.close() &nbsp;# 关闭文件</font></div><div><font size="2"   >except:</font></div><div><font size="2"   >&nbsp; print('The file not exists')</font></div><p></p></pre></div><div><br></div><div>其他,&nbsp;</div><div>使用错误分类</div><div>except ValueError:</div><div>判断文件是否存在</div><div>os.path.exists('file')</div><div><br></div><div><br></div><div>测试结果如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@localhost-&gt; python test.py |less</font></div><div><font size="2"   >/home/postgres</font></div><div><font size="2"   >/home/postgres</font></div><div><font size="2"   >1,891ca83e2c0971a8a0dc8d7e5edda338</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >1 is: 891ca83e2c0971a8a0dc8d7e5edda338</font></div><div><font size="2"   >2 is: 75f9acd8d195f905b6ab6014ccef3a6b</font></div><div><font size="2"   >3 is: ac4c2dc4d9de3461614d26a132f9c82f</font></div><div><font size="2"   >....</font></div><div><font size="2"   >999 is: 44360dbdce1484cb8381f693e5f3237f</font></div><div><font size="2"   >1000 is: 8bf252d6ba4d30ff18e7c5e3b067ef3e</font></div><p></p></pre></div><div><br></div><div>小结 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   > Use the open() &nbsp;BIF to open a disk file,&nbsp;<span style="line-height: 28px;"   >creating an iterator that reads data from&nbsp;</span><span style="line-height: 28px;"   >the file one line at a time.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   > The readline() &nbsp;method reads a&nbsp;<span style="line-height: 28px;"   >single line from an opened file.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   > The seek() &nbsp;method can be used to&nbsp;<span style="line-height: 28px;"   >“rewind” a file to the beginning.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   > The close() &nbsp;method closes a&nbsp;<span style="line-height: 28px;"   >previously opened file.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   > The split() &nbsp;method can break a&nbsp;<span style="line-height: 28px;"   >string into a list of parts.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   > An unchangeable, constant list in Python&nbsp;<span style="line-height: 28px;"   >is called a tuple. Once list data is&nbsp;</span><span style="line-height: 28px;"   >assigned to a tuple, it cannot be changed.</span></font></div><div><font size="2"   >&nbsp;Tuples are immutable.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   > A ValueError occurs when your data&nbsp;<span style="line-height: 28px;"   >does not conform to an expected format.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   > An IOError occurs when your data&nbsp;<span style="line-height: 28px;"   >cannot be accessed properly (e.g.,&nbsp;</span><span style="line-height: 28px;"   >perhaps your data file has been moved or&nbsp;</span><span style="line-height: 28px;"   >renamed).</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   > The help() &nbsp;BIF provides access to&nbsp;<span style="line-height: 28px;"   >Python’s documentation within the IDLE&nbsp;</span><span style="line-height: 28px;"   >shell.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   > The find() &nbsp;method locates a specific&nbsp;<span style="line-height: 28px;"   >substring within another string.</span></font></div><div><span style="line-height: 28px;"   ><font size="2"   >&nbsp; 查找字符串中包含某字符串的位置, -1表示未找到.</font></span></div><div><font size="2"   ><br></font></div><div><font size="2"   > The not keyword negates a condition.&nbsp;</font></div><div><font size="2"   >&nbsp; 条件非, 例如 if not each_line.find(':') == -1&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   > The try/except statement provides&nbsp;<span style="line-height: 28px;"   >an exception-handling mechanism,&nbsp;</span><span style="line-height: 28px;"   >allowing you to protect lines of code that&nbsp;</span><span style="line-height: 28px;"   >might result in a runtime error.</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   > The pass statement is Python’s empty&nbsp;<span style="line-height: 28px;"   >or null statement; it does nothing.</span></font></div><p></p></pre></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   ><br></span></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="python file operate exp - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>