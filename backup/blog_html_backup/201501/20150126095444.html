<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">add your python module to pypi.python.org</h2>
	<h5 id="">2015-01-26 9:54:44&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201502693447397/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>本文将描述一下如何将我们自己写的模块加入到pypi.python.org.</div><div>创建一个空目录, 用来放将要上传的代码</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost ~]# mkdir pydigoal</font></div><div><font size="2"   >[root@localhost ~]# cd pydigoal/</font></div><p></p></pre></div><div>创建一个py文件, 存放你要上传的代码. 例如我这里要上传一个输出列表的函数.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost pydigoal]# vi nester.py</font></div><div><font size="2"   >"""this is comment</font></div><div><font size="2"   >comment end"""</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >def print_lol(the_list):</font></div><div><font size="2"   >&nbsp; """this is function comment</font></div><div><font size="2"   >&nbsp; comment end"""</font></div><div><font size="2"   >&nbsp; for each_item in the_list:</font></div><div><font size="2"   >&nbsp; &nbsp; if isinstance(each_item, list):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; print_lol(each_item)</font></div><div><font size="2"   >&nbsp; &nbsp; else:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; print(each_item)</font></div><p></p></pre></div><div><br></div><div>编写setup.py, 格式如下. 从distutils.core中导入setup函数.</div><div>这种导入的函数不需要写全路径, 如果是import distutils.core, 则需要写全路径distutils.core.setup</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost pydigoal]# vi setup.py</font></div><div><font size="2"   >from distutils.core import setup</font></div><div><font size="2"   >setup(</font></div><div><font size="2"   >&nbsp; &nbsp; name = 'nester',</font></div><div><font size="2"   >&nbsp; &nbsp; version = '1.0.0',</font></div><div><font size="2"   >&nbsp; &nbsp; py_modules = ['nester'],</font></div><div><font size="2"   >&nbsp; &nbsp; author = 'digoal',</font></div><div><font size="2"   >&nbsp; &nbsp; author_email = 'digoal@126.com',</font></div><div><font size="2"   >&nbsp; &nbsp; url = 'http://blog.163.com/digoal@126',</font></div><div><font size="2"   >&nbsp; &nbsp; description = 'a test module by digoal'</font></div><div><font size="2"   >)</font></div><p></p></pre></div><div>执行python setup.py sdist打包</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost pydigoal]# python setup.py sdist</font></div><div><font size="2"   >running sdist</font></div><div><font size="2"   >running check</font></div><div><font size="2"   >warning: sdist: manifest template 'MANIFEST.in' does not exist (using default file list)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >warning: sdist: standard file not found: should have one of README, README.txt</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >writing manifest file 'MANIFEST'</font></div><div><font size="2"   >creating nester-1.0.0</font></div><div><font size="2"   >making hard links in nester-1.0.0...</font></div><div><font size="2"   >hard linking nester.py -&gt; nester-1.0.0</font></div><div><font size="2"   >hard linking setup.py -&gt; nester-1.0.0</font></div><div><font size="2"   >creating dist</font></div><div><font size="2"   >Creating tar archive</font></div><div><font size="2"   >removing 'nester-1.0.0' (and everything under it)</font></div><p></p></pre></div><div>打包后如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost pydigoal]# ll -R</font></div><div><font size="2"   >.:</font></div><div><font size="2"   >total 12</font></div><div><font size="2"   >drwxr-xr-x 2 root root &nbsp;32 Jan 26 17:25 dist</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;62 Jan 26 17:25 MANIFEST</font></div><div><font size="2"   >-rw-r--r-- 1 root root 232 Jan 26 17:22 nester.py</font></div><div><font size="2"   >-rw-r--r-- 1 root root 263 Jan 26 17:24 setup.py</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >./dist:</font></div><div><font size="2"   >total 4</font></div><div><font size="2"   >-rw-r--r-- 1 root root 586 Jan 26 17:25 nester-1.0.0.tar.gz</font></div><p></p></pre></div><div>打包好模块后, 可以在本地安装这个模块</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost pydigoal]# python setup.py install</font></div><div><font size="2"   >running install</font></div><div><font size="2"   >running build</font></div><div><font size="2"   >running build_py</font></div><div><font size="2"   >creating build</font></div><div><font size="2"   >creating build/lib</font></div><div><font size="2"   >copying nester.py -&gt; build/lib</font></div><div><font size="2"   >running install_lib</font></div><div><font size="2"   >copying build/lib/nester.py -&gt; /usr/lib/python2.7/site-packages</font></div><div><font size="2"   >byte-compiling /usr/lib/python2.7/site-packages/nester.py to nester.pyc</font></div><div><font size="2"   >running install_egg_info</font></div><div><font size="2"   >Writing /usr/lib/python2.7/site-packages/nester-1.0.0-py2.7.egg-info</font></div><p></p></pre></div><div>如何使用本地已安装的模块呢?</div><div>很简单, 导入即可, 导入有两种方式, 一种是from, 另一种是直接import</div><div>一个要写全路径, 一个不需要写全路径</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@localhost pydigoal]# cd</font></div><div><font size="2"   >[root@localhost ~]# vi test.py</font></div><div><font size="2"   >from nester import print_lol</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >list = ['hello',['i',['am','digoal']]]</font></div><div><font size="2"   >print_lol(list)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@localhost ~]# python ./test.py</font></div><div><font size="2"   >hello</font></div><div><font size="2"   >i</font></div><div><font size="2"   >am</font></div><div><font size="2"   >digoal</font></div></div><p></p></pre></div><div><br></div><div>以下方式导入的模块, 调用模块中的函数时, 需要写全路径</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@localhost ~]# vi test.py</font></div><div><font size="2"   >import nester</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >list = ['hello',['i',['am','digoal']]]</font></div><div><font size="2"   >nester.print_lol(list)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@localhost ~]# python ./test.py</font></div><div><font size="2"   >hello</font></div><div><font size="2"   >i</font></div><div><font size="2"   >am</font></div><div><font size="2"   >digoal</font></div></div><p></p></pre></div><div><br></div><div>接下来是将模块导入pypi.python.org</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost pydigoal]# python setup.py register</font></div><div><font size="2"   >running register</font></div><div><font size="2"   >running check</font></div><div><font size="2"   >We need to know who you are, so please choose either:</font></div><div><font size="2"   >&nbsp;1. use your existing login,</font></div><div><font size="2"   >&nbsp;2. register as a new user,</font></div><div><font size="2"   >&nbsp;3. have the server generate a new password for you (and email it to you), or</font></div><div><font size="2"   >&nbsp;4. quit</font></div><div><font size="2"   >Your selection [default 1]:&nbsp;</font></div><div><font size="2"   >1</font></div><div><font size="2"   >Username: digoal</font></div><div><font size="2"   >Password:&nbsp;</font></div><div><font size="2"   >Registering nester to http://pypi.python.org/pypi</font></div><div><font size="2"   >Server response (403): You are not allowed to store 'nester' package information</font></div><p></p></pre></div><div>注意nester这个模块名已经被占用了, 所以需要改给名字再上传.</div><div>更改为digoal_nester</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost pydigoal]# vi setup.py&nbsp;</font></div><div><font size="2"   >from distutils.core import setup</font></div><div><font size="2"   >setup(</font></div><div><font size="2"   >&nbsp; &nbsp; name = 'digoal_nester',</font></div><div><font size="2"   >&nbsp; &nbsp; version = '1.0.0',</font></div><div><font size="2"   >&nbsp; &nbsp; py_modules = ['digoal_nester'],</font></div><div><font size="2"   >&nbsp; &nbsp; author = 'digoal',</font></div><div><font size="2"   >&nbsp; &nbsp; author_email = 'digoal@126.com',</font></div><div><font size="2"   >&nbsp; &nbsp; url = 'http://blog.163.com/digoal@126',</font></div><div><font size="2"   >&nbsp; &nbsp; description = 'a test module by digoal'</font></div><div><font size="2"   >)</font></div><p></p></pre></div><div>文件名也改一下</div><div><pre class="prettyprint"   ><p><font size="2"   >[root@localhost pydigoal]# mv nester.py digoal_nester.py&nbsp;</font></p></pre></div><div>再次上传, 通过.&nbsp;</div><div>第一次上传时, 需要输入在pypi注册的用户名密码.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost pydigoal]# python setup.py register</font></div><div><font size="2"   >running register</font></div><div><font size="2"   >running check</font></div><div><font size="2"   >We need to know who you are, so please choose either:</font></div><div><font size="2"   >&nbsp;1. use your existing login,</font></div><div><font size="2"   >&nbsp;2. register as a new user,</font></div><div><font size="2"   >&nbsp;3. have the server generate a new password for you (and email it to you), or</font></div><div><font size="2"   >&nbsp;4. quit</font></div><div><font size="2"   >Your selection [default 1]:&nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Username: digoal</font></div><div><font size="2"   >Password:&nbsp;</font></div><div><font size="2"   >Registering digoal_nester to http://pypi.python.org/pypi</font></div><div><font size="2"   >Server response (200): OK</font></div><div><font size="2"   >I can store your PyPI login so future submissions will be faster.</font></div><div><font size="2"   >(the login will be stored in /root/.pypirc)</font></div><div><font size="2"   >Save your login (y/N)?y</font></div><p></p></pre></div><div><br></div><div>上传完以后, 就可以在pypi搜索到刚上传的模块了.</div><div><a target="_blank" rel="nofollow" href="https://pypi.python.org/pypi/digoal_nester/1.0.0"   >https://pypi.python.org/pypi/digoal_nester/1.0.0</a></div><div><div><img title="add your python module to pypi.python.org - 德哥@Digoal - PostgreSQL research"   alt="add your python module to pypi.python.org - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/_XN8AqSCSqlyL33G2bNo0Q==/6597535959588747266.png"   ></div></div><div><br></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="add your python module to pypi.python.org - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>