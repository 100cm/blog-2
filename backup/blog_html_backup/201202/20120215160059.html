<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Ruby's Enumerable Module and yield method</h2>
	<h5 id="">2012-02-15 16:00:59&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402012115347486/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>Hash, Array, Range, Set 类的对象为什么可以使用include?, min, max等方法, 原因是这些CLASS包含了Enumerable模块.</div><div>这个模块的详细介绍可以在Ruby Core API Reference中查询.</div><div>下面对某些方法举例说明 :&nbsp;</div><div>测试版本1.9.3-p0</div><div>一、内建类型的Enumerable方法调用</div><div>1. min</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >a = Array.new(['z','abc','bc','d1','efg'])</font></div><div><font size="2"  >p(a.min) &nbsp; #=&gt;"abc" , 默认情况下min 判断的是ascii码</font></div><div><font size="2"  >p(a.min{</font></div><div><font size="2"  > |x|</font></div><div><font size="2"  > x.length</font></div><div><font size="2"  > }) &nbsp;#=&gt;"z" , 这里判断的是字符长度.</font></div><p></p></pre></div><div><br></div><div>2. max</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >a = {'z'=&gt;'digoal',</font></div><div><font size="2"  > 'abc'=&gt;'francs',</font></div><div><font size="2"  > 'bc'=&gt;'dage',</font></div><div><font size="2"  > 'd1'=&gt;'hank',</font></div><div><font size="2"  > 'efg'=&gt;'new'}</font></div><div><font size="2"  >p(a) #=&gt;{"z"=&gt;"digoal", "abc"=&gt;"francs", "bc"=&gt;"dage", "d1"=&gt;"hank", "efg"=&gt;"new"}</font></div><div><font size="2"  >p(a.max) #=&gt;["z", "digoal"]</font></div><div><font size="2"  >p(a.max{</font></div><div><font size="2"  > |x|</font></div><div><font size="2"  > x.length</font></div><div><font size="2"  > }) #=&gt;["efg", "new"]&nbsp;<span style="line-height: 22px;"  >, 这里判断的是hash key的字符长度.</span></font></div><p></p></pre></div><div><br></div><div>3. sort</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >a = {'z'=&gt;'digoal',</font></div><div><font size="2"  > 'abc'=&gt;'francs',</font></div><div><font size="2"  > 'bc'=&gt;'dage',</font></div><div><font size="2"  > 'd1'=&gt;'hank',</font></div><div><font size="2"  > 'efg'=&gt;'new'}</font></div><div><font size="2"  >p(a) #=&gt;&nbsp;{"z"=&gt;"digoal", "abc"=&gt;"francs", "bc"=&gt;"dage", "d1"=&gt;"hank", "efg"=&gt;"new"}</font></div><div><font size="2"  >p(a.sort) #=&gt;&nbsp;[["abc", "francs"], ["bc", "dage"], ["d1", "hank"], ["efg", "new"], ["z", "digoal"]] , 默认按ASCII排序</font></div><div><font size="2"  >p(a.sort{</font></div><div><font size="2"  > |x,y|</font></div><div><font size="2"  > x[0].length &lt;=&gt; y[0].length</font></div><div><font size="2"  > }) #=&gt;&nbsp;[["z", "digoal"], ["d1", "hank"], ["bc", "dage"], ["abc", "francs"], ["efg", "new"]] &nbsp;, 这里按照Hash key的长度排序</font></div><div><font size="2"  >p(a.sort{</font></div><div><font size="2"  > |x,y|</font></div><div><font size="2"  > x[1].length &lt;=&gt; y[1].length</font></div><div><font size="2"  > }) #=&gt;&nbsp;[["efg", "new"], ["d1", "hank"], ["bc", "dage"], ["abc", "francs"], ["z", "digoal"]]&nbsp;<span style="line-height: 22px;"  >, 这里按照Hash value的长度排序</span></font></div><p></p></pre></div><div><br></div><div>4. collect</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >a = [1,2,3,4,5,6]</font></div><div><font size="2"  >b = a.collect {</font></div><div><font size="2"  > |x|</font></div><div><font size="2"  > x * x</font></div><div><font size="2"  >}</font></div><div><font size="2"  >p(a) #=&gt;&nbsp;<span style="line-height: 22px;"  >[1, 2, 3, 4, 5, 6]</span></font></div><div><font size="2"  >p(b) #=&gt;&nbsp;<span style="line-height: 22px;"  >[1, 4, 9, 16, 25, 36] , collect方法重新构造一组数据.</span></font></div><p></p></pre></div><div><div><br></div><div>5. include?</div></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >a = [1,2,3,4,5,6]</font></div><div><font size="2"  >p(a.include?(1)) #=&gt; true , 判断是否包含1</font></div><div><font size="2"  >p(a.include?(7)) #=&gt; false<span style="line-height: 22px;"  >&nbsp;</span><span style="line-height: 22px;"  >, 判断是否包含7</span></font></div><p></p></pre></div><div><br></div><div>二、自定义CLASS中包含Enumerable模块举例 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >class MyClass</font></div><div><font size="2"  > include Enumerable # 这个指包含Enumerable模块</font></div><div><font size="2"  > def initialize( someItems )</font></div><div><font size="2"  >  @items = someItems</font></div><div><font size="2"  > end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  > def each # 要在自定义类中使用Enumerable模块中的方法, 必须写一个each 方法, 告诉其他要调用的Enumerable方法每次传什么值进去.</font></div><div><font size="2"  >  @items.each{</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|i|</font></div><div><font size="2"  >   yield(i) &nbsp;# yield方法里面的参数, 就是表示<span style="line-height: 22px;"  >其他要调用的Enumerable方法每次传什么值进去.这里每次传的就是i</span></font></div><div><font size="2"  >  }</font></div><div><font size="2"  > end</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >a = MyClass.new(['c','bda1a','baz','ce','zwfg'])</font></div><div><font size="2"  >p(a) #=&gt;&nbsp;#&lt;MyClass:0x1ef0db0 @items=["c", "bda1a", "baz", "ce", "zwfg"]&gt;</font></div></div><div><font size="2"  >p(a.sort) #=&gt;&nbsp;["baz", "bda1a", "c", "ce", "zwfg"]</font></div><div><font size="2"  ><br></font></div><div><div><font size="2"  >class MyClass</font></div><div><font size="2"  > include Enumerable</font></div><div><font size="2"  > def initialize( someItems )</font></div><div><font size="2"  >  @items = someItems</font></div><div><font size="2"  > end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  > def each</font></div><div><font size="2"  >  @items.each{</font></div><div><font size="2"  >   |i|</font></div><div><font size="2"  >   yield(i.to_s.length) #这里每次传的是i.to_s.length</font></div><div><font size="2"  >  }</font></div><div><font size="2"  > end</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >a = MyClass.new(['c','bda1a','baz','ce','zwfg'])</font></div><div><font size="2"  >p(a) # =&gt;&nbsp;<span style="line-height: 22px;"  >#&lt;MyClass:0x1e90c90 @items=["c", "bda1a", "baz", "ce", "zwfg"]&gt;</span></font></div><div><font size="2"  >p(a.sort) # =&gt;&nbsp;<span style="line-height: 22px;"  >[1, 2, 3, 4, 5]</span></font></div></div><p></p></pre></div><div><span style="line-height: 22px;"  ># 自定义类型中如果没有定义each方法, 但是调用了Enumerable中的方法会报错, 例如 :&nbsp;</span></div><div>`sort': undefined method `each' for #&lt;MyClass:0x1ebfb08 @items=["c", "bda1a", "baz", "ce", "zwfg"]&gt; (NoMethodError)</div><div><br></div>【参考】<div>Ruby Core API Reference : Enumerable</div><div>The Book of Ruby : Page 100 - 105<br><br><wbr></div></div>
	</div>
</div>
</body>
</html>