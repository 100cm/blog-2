<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Oracle SQL : delete from (query), delete which table's row?</h2>
	<h5 id="">2012-02-14 17:33:36&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201211453336358/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">今天群里面一位朋友问了一个问题如下 :&nbsp;<div><div><pre class="prettyprint"   ><p>&nbsp;DELETE&nbsp;FROM&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(SELECT&nbsp;*&nbsp;FROM&nbsp;EPAD_MENU&nbsp;EM,&nbsp;MSG_DESC&nbsp;MD&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MD.MD_TABLE&nbsp;=&nbsp;'epad_menu'&nbsp;AND&nbsp;MD.MD_FIELD&nbsp;=&nbsp;'em_id'&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;MD.MD_VALUE&nbsp;=&nbsp;EM.EM_ID&nbsp;AND&nbsp;EM.EM_BOOK_CODE&nbsp;=&nbsp;'aa'）</p></pre>为什么删除的是&nbsp;MSG_DESC的数据？</div><div><br></div><div>于是找了个测试库测试一下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SQL&gt; create table t1(id int primary key,info varchar2(10));</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Table created.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; create table t2(id int primary key,info varchar2(10));</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Table created.&nbsp;</font></div><div><div><font size="2"   >SQL&gt; insert into t1 values (1,'digoal');</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >1 row created.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; insert into t1 values (2,'digoal');</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >1 row created.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; insert into t2 values (1,'digoal');</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >1 row created.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; insert into t2 values (2,'digoal');</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >1 row created.</font></div></div><div><div><font size="2"   >SQL&gt; commit;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Commit complete.</font></div></div><p></p></pre></div><div>下面来写个类似的delete语句 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SQL&gt; delete from (select * from t1,t2 where t1.id=1 and t2.id=t1.id and t2.info='digoal');</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >1 row deleted.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; select * from t2;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ID INFO</font></div><div><font size="2"   >---------- ----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 digoal</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 digoal</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; select * from t1;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ID INFO</font></div><div><font size="2"   >---------- ----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 digoal</font></div><p></p></pre></div><div>把t1.数据删了, t2的没有动.</div><div><br></div><div>下面把t1和t2的顺序换一下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SQL&gt; rollback;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Rollback complete.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; delete from (select * from t2,t1 where t1.id=1 and t2.id=t1.id and t2.info='digoal');</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >1 row deleted.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; select * from t1;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ID INFO</font></div><div><font size="2"   >---------- ----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 digoal</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 digoal</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; select * from t2;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ID INFO</font></div><div><font size="2"   >---------- ----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 digoal</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; rollback;</font></div><p></p></pre></div><div>结果把t2的数据删了, t1没动.</div><div><br></div><div>来从执行计划看看是啥原因 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SQL&gt; explain plan for delete from (select * from t2,t1 where t1.id=1 and t2.id=t1.id and t2.info='digoal');</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Explained.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; select * from table(dbms_xplan.display);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >PLAN_TABLE_OUTPUT</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >Plan hash value: 1934688782</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >----------------------------------------------------------------------------------------------</font></div><div><font size="2"   >| Id &nbsp;| Operation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Name &nbsp; &nbsp; &nbsp; &nbsp; | Rows &nbsp;| Bytes | Cost (%CPU)| Time &nbsp; &nbsp; |</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------</font></div><div><font size="2"   >| &nbsp; 0 | DELETE STATEMENT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 1 | &nbsp; &nbsp;33 | &nbsp; &nbsp; 1 &nbsp; (0)| 00:00:01 |</font></div><div><font size="2"   >| &nbsp; 1 | &nbsp;DELETE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | T2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div><div><font size="2"   >| &nbsp; 2 | &nbsp; NESTED LOOPS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 1 | &nbsp; &nbsp;33 | &nbsp; &nbsp; 1 &nbsp; (0)| 00:00:01 |</font></div><div><font size="2"   >|* &nbsp;3 | &nbsp; &nbsp;TABLE ACCESS BY INDEX ROWID| T2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 1 | &nbsp; &nbsp;20 | &nbsp; &nbsp; 1 &nbsp; (0)| 00:00:01 |</font></div><div><font size="2"   >|* &nbsp;4 | &nbsp; &nbsp; INDEX UNIQUE SCAN &nbsp; &nbsp; &nbsp; &nbsp; | SYS_C0065664 | &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 1 &nbsp; (0)| 00:00:01 |</font></div><div><font size="2"   >|* &nbsp;5 | &nbsp; &nbsp;INDEX UNIQUE SCAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| SYS_C0065663 | &nbsp; &nbsp; 1 | &nbsp; &nbsp;13 | &nbsp; &nbsp; 0 &nbsp; (0)| 00:00:01 |</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Predicate Information (identified by operation id):</font></div><div><font size="2"   >---------------------------------------------------</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp;3 - filter("T2"."INFO"='digoal')</font></div><div><font size="2"   >&nbsp; &nbsp;4 - access("T2"."ID"=1)</font></div><div><font size="2"   >&nbsp; &nbsp;5 - access("T1"."ID"=1)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >19 rows selected.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; explain plan for delete from (select * from t1,t2 where t1.id=1 and t2.id=t1.id and t2.info='digoal');</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Explained.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; select * from table(dbms_xplan.display);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >PLAN_TABLE_OUTPUT</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >Plan hash value: 2064908203</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >----------------------------------------------------------------------------------------------</font></div><div><font size="2"   >| Id &nbsp;| Operation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Name &nbsp; &nbsp; &nbsp; &nbsp; | Rows &nbsp;| Bytes | Cost (%CPU)| Time &nbsp; &nbsp; |</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------</font></div><div><font size="2"   >| &nbsp; 0 | DELETE STATEMENT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 1 | &nbsp; &nbsp;33 | &nbsp; &nbsp; 2 &nbsp; (0)| 00:00:01 |</font></div><div><font size="2"   >| &nbsp; 1 | &nbsp;DELETE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | T1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div><div><font size="2"   >| &nbsp; 2 | &nbsp; NESTED LOOPS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 1 | &nbsp; &nbsp;33 | &nbsp; &nbsp; 2 &nbsp; (0)| 00:00:01 |</font></div><div><font size="2"   >|* &nbsp;3 | &nbsp; &nbsp;INDEX UNIQUE SCAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| SYS_C0065663 | &nbsp; &nbsp; 1 | &nbsp; &nbsp;13 | &nbsp; &nbsp; 1 &nbsp; (0)| 00:00:01 |</font></div><div><font size="2"   >|* &nbsp;4 | &nbsp; &nbsp;TABLE ACCESS BY INDEX ROWID| T2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 1 | &nbsp; &nbsp;20 | &nbsp; &nbsp; 1 &nbsp; (0)| 00:00:01 |</font></div><div><font size="2"   >|* &nbsp;5 | &nbsp; &nbsp; INDEX UNIQUE SCAN &nbsp; &nbsp; &nbsp; &nbsp; | SYS_C0065664 | &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 0 &nbsp; (0)| 00:00:01 |</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Predicate Information (identified by operation id):</font></div><div><font size="2"   >---------------------------------------------------</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp;3 - access("T1"."ID"=1)</font></div><div><font size="2"   >&nbsp; &nbsp;4 - filter("T2"."INFO"='digoal')</font></div><div><font size="2"   >&nbsp; &nbsp;5 - access("T2"."ID"=1)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >19 rows selected.</font></div><p></p></pre></div><div><br></div><br><wbr></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Oracle SQL : delete from (query), delete which tables row? - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>