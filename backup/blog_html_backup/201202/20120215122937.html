<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.2devel add JSON type and some functions</h2>
	<h5 id="">2012-02-15 12:29:37&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020121150212379/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">PostgreSQL 9.2 可能增加json类型.<div>目前已提交的patch测试如下 :&nbsp;</div><div>新增类型查询 :&nbsp;<br><wbr><div><pre class="prettyprint"  ><p></p><div><font size="2"  >pg9.2devel=&gt; select * from pg_type where typname ~* 'json';</font></div><div><font size="2"  >&nbsp;typname | typnamespace | typowner | typlen | typbyval | typtype | typcategory | typispreferred | typisdefined | typdelim | typrelid</font></div><div><font size="2"  >&nbsp;| typelem | typarray | typinput | typoutput | typreceive | &nbsp;typsend &nbsp; | typmodin | typmodout | typanalyze | typalign | typstorage |</font></div><div><font size="2"  >&nbsp;typnotnull | typbasetype | typtypmod | typndims | typcollation | typdefaultbin | typdefault | typacl&nbsp;</font></div><div><font size="2"  >---------+--------------+----------+--------+----------+---------+-------------+----------------+--------------+----------+---------</font></div><div><font size="2"  >-+---------+----------+----------+-----------+------------+------------+----------+-----------+------------+----------+------------+</font></div><div><font size="2"  >------------+-------------+-----------+----------+--------------+---------------+------------+--------</font></div><div><font size="2"  >&nbsp;json &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 11 | &nbsp; &nbsp; &nbsp; 10 | &nbsp; &nbsp; -1 | f &nbsp; &nbsp; &nbsp; &nbsp;| b &nbsp; &nbsp; &nbsp; | U &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| , &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"  >&nbsp;| &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp;199 | json_in &nbsp;| json_out &nbsp;| json_recv &nbsp;| json_send &nbsp;| - &nbsp; &nbsp; &nbsp; &nbsp;| - &nbsp; &nbsp; &nbsp; &nbsp; | - &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp; &nbsp; &nbsp; &nbsp;| x &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div><div><font size="2"  >&nbsp;f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"  >&nbsp;_json &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 11 | &nbsp; &nbsp; &nbsp; 10 | &nbsp; &nbsp; -1 | f &nbsp; &nbsp; &nbsp; &nbsp;| b &nbsp; &nbsp; &nbsp; | A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| , &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"  >&nbsp;| &nbsp; &nbsp; 114 | &nbsp; &nbsp; &nbsp; &nbsp;0 | array_in | array_out | array_recv | array_send | - &nbsp; &nbsp; &nbsp; &nbsp;| - &nbsp; &nbsp; &nbsp; &nbsp; | - &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp; &nbsp; &nbsp; &nbsp;| x &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div><div><font size="2"  >&nbsp;f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"  >(2 rows)</font></div><p></p></pre></div><div><br></div><div>新增函数 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >pg9.2devel=&gt; \df *.*json*</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of functions</font></div><div><font size="2"  >&nbsp; &nbsp;Schema &nbsp; | &nbsp; &nbsp; Name &nbsp; &nbsp; &nbsp;| Result data type | Argument data types | &nbsp;Type &nbsp;</font></div><div><font size="2"  >------------+---------------+------------------+---------------------+--------</font></div><div><font size="2"  >&nbsp;pg_catalog | array_to_json | json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | anyarray &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"  >&nbsp;pg_catalog | array_to_json | json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | anyarray, boolean &nbsp; | normal</font></div><div><font size="2"  >&nbsp;pg_catalog | json_in &nbsp; &nbsp; &nbsp; | json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | cstring &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal</font></div><div><font size="2"  >&nbsp;pg_catalog | json_out &nbsp; &nbsp; &nbsp;| cstring &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"  >&nbsp;pg_catalog | json_recv &nbsp; &nbsp; | json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | internal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"  >&nbsp;pg_catalog | json_send &nbsp; &nbsp; | bytea &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"  >&nbsp;pg_catalog | row_to_json &nbsp; | json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | record &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| normal</font></div><div><font size="2"  >&nbsp;pg_catalog | row_to_json &nbsp; | json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | record, boolean &nbsp; &nbsp; | normal</font></div><p></p></pre></div><div><br></div><div>row_to_json函数测试 :&nbsp;</div><div>创建测试表 ：</div><div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; create table t1 (id int,info text);</font></div><div><font size="2"  >CREATE TABLE</font></div><p></p></pre></div><div>插入测试数据 ：</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; insert into t1 select generate_series(1,10),'digoal'||generate_series(1,10);</font></div><div><font size="2"  >INSERT 0 10</font></div><p></p></pre></div><div>输出测试, key为列名或alias.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; select row_to_json(t) from (select id,info from t1) t;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;row_to_json &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >-----------------------------</font></div><div><font size="2"  >&nbsp;{"id":1,"info":"digoal1"}</font></div><div><font size="2"  >&nbsp;{"id":2,"info":"digoal2"}</font></div><div><font size="2"  >&nbsp;{"id":3,"info":"digoal3"}</font></div><div><font size="2"  >&nbsp;{"id":4,"info":"digoal4"}</font></div><div><font size="2"  >&nbsp;{"id":5,"info":"digoal5"}</font></div><div><font size="2"  >&nbsp;{"id":6,"info":"digoal6"}</font></div><div><font size="2"  >&nbsp;{"id":7,"info":"digoal7"}</font></div><div><font size="2"  >&nbsp;{"id":8,"info":"digoal8"}</font></div><div><font size="2"  >&nbsp;{"id":9,"info":"digoal9"}</font></div><div><font size="2"  >&nbsp;{"id":10,"info":"digoal10"}</font></div><div><font size="2"  >(10 rows)</font></div><div><font size="2"  >digoal=&gt; select row_to_json(t) from (select id as userid,info as nick from t1) t;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;row_to_json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >---------------------------------</font></div><div><font size="2"  >&nbsp;{"userid":1,"nick":"digoal1"}</font></div><div><font size="2"  >&nbsp;{"userid":2,"nick":"digoal2"}</font></div><div><font size="2"  >&nbsp;{"userid":3,"nick":"digoal3"}</font></div><div><font size="2"  >&nbsp;{"userid":4,"nick":"digoal4"}</font></div><div><font size="2"  >&nbsp;{"userid":5,"nick":"digoal5"}</font></div><div><font size="2"  >&nbsp;{"userid":6,"nick":"digoal6"}</font></div><div><font size="2"  >&nbsp;{"userid":7,"nick":"digoal7"}</font></div><div><font size="2"  >&nbsp;{"userid":8,"nick":"digoal8"}</font></div><div><font size="2"  >&nbsp;{"userid":9,"nick":"digoal9"}</font></div><div><font size="2"  >&nbsp;{"userid":10,"nick":"digoal10"}</font></div><div><font size="2"  >(10 rows)</font></div><p></p></pre></div></div><div><br></div><div>array_to_json函数测试 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; select array_to_json('{{firstname,zhou},{lastname,digoal},{job,dba}}'::text[]);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;array_to_json &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >------------------------------------------------------------</font></div><div><font size="2"  >&nbsp;[["firstname","zhou"],["lastname","digoal"],["job","dba"]]</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div><br></div><div>【参考】</div><div><div>http://www.postgresql.org/docs/devel/static/functions-json.html</div><div>http://www.postgresql.org/docs/devel/static/datatype-json.html</div></div><div><br></div><div><br></div></div></div>
	</div>
</div>
</body>
</html>