<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Ruby Study 2 : CLASS HIERARCHIES,  ATTRIBUTES, AND CLASS  VARIABLES</h2>
	<h5 id="">2012-02-27 17:23:34&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201212731550518/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >1. Class Hierarchies</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >熟悉PostgreSQL的朋友一定深知它的inherit表. 在Ruby中也有类似的结构, 例如前一篇BLOG最后的代码部分有举例.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >如下 :&nbsp;</span></font></div><div><pre><pre class="prettyprint"  ><p></p><div><img title="Ruby Study 2 : CLASS HIERARCHIES,  ATTRIBUTES, AND CLASS  VARIABLES - 德哥@Digoal - The Heart,The World."  alt="Ruby Study 2 : CLASS HIERARCHIES,  ATTRIBUTES, AND CLASS  VARIABLES - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img6.ph.126.net/_pVNp84DF2bBhhy6eBJ0cA==/1176002452714405746.png"  ></div></pre></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >OtherClass 继承自Object</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >Object继承自BasicObject</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >Class继承自Module</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >Module继承自Object</span></font></div><div><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >我们可以从以下代码验证 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >class Myclass</font></div><div><font size="2"  >end</font></div><div><font size="2"  >class Mysubclass &lt; Myclass</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br><span style="line-height: 22px;"  >puts(Mysubclass.superclass) # superclass方法用于查找超类. 查找Mysubclass的超类</span><br></font></div><div><font size="2"  >puts(Myclass.superclass) # superclass方法用于查找超类. 查找Myclass的超类</font></div><div><font size="2"  >puts(Class.superclass)  # <span style="line-height: 22px;"  >查找Class的超类</span></font></div><div><font size="2"  >puts(Module.superclass)</font></div><div><font size="2"  >puts(Object.class)</font></div><div><font size="2"  >p(BasicObject.superclass) # BasicObject没有超类, 可以认为是ROOT Class, 1.9的Object和BasicObject是从1.8的Object拆分而来. 1.8中没有BasicObject.</font></div><p></p></pre></div><div><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >执行结果 :&nbsp;</span></div><div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><pre class="prettyprint"  ><p></p><div><font size="2"  >Myclass</font></div><div><font size="2"  >Object</font></div><div><font size="2"  >Module</font></div><div><font size="2"  >Object</font></div><div><font size="2"  >Class</font></div><div><font size="2"  >nil</font></div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"  >subclass继承了superclass的attribute和method. 并且subclass可以复写superclass的方法. 新增superclass中不存在的方法和attribute等.</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"  >从一个书本上的例子可以得到验证 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >class Thing  # 本例中Thing是Treasure的superclass</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; def initialize( aName, aDescription )</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp; @name &nbsp; &nbsp; &nbsp; &nbsp; = aName</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp; @description &nbsp;= aDescription</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; def get_name</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; return @name</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; def set_name( aName )</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; @name = aName</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; def get_description</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; return @description</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; def set_description( aDescription )</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; @description = aDescription&nbsp;</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><br></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >class Treasure &lt; Thing   # 定义Treasure类继承自Thing</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; def initialize( aName, aDescription, aValue )  # 复写superclass的initialize</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; super( aName, aDescription )   # 调用superclass的同名方法(initialize).super表示传递所有参数调用superclass的同名方法, super()表示不传递任何参数</font><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 20px; font-size: small;"  >调用superclass的同名方法</span><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >, super(</font><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 20px; font-size: small;"  >aName, aDescription</span><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small;"  >) 表示传递两个参数</span><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 20px; font-size: small;"  >调用superclass的同名方法</span><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small;"  >.</span></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; @value = aValue  # 复写的initialize方法中新增了一个实例变量@value.</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; def get_value   # 比superclass新增的方法.</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; return @value</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; def set_value( aValue )  </font><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small; line-height: 20px;"  ># 比superclass新增的方法.</span></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; @value = aValue</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >&nbsp; &nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><br></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >thing = Thing.new('digoal','a lucky dba')<br>treasure = Treasure.new('digoal','a lucky dba','1983')<br>puts(thing.inspect)<br>puts(treasure.inspect)</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >treasure.set_description('DBA') # 调用superclass中的method</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >puts(treasure.inspect) # 查看@description是否更改.</font></div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"  >执行结果 :&nbsp;</div></div><div><pre class="prettyprint"  ><p></p><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >#&lt;Thing:0x1b46f68 @name="digoal", @description="a lucky dba"&gt;</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >#&lt;Treasure:0x1b46e30 @name="digoal", @description="a lucky dba", @value="1983"&gt;</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >#&lt;Treasure:0x1426a40 @name="digoal", @description="DBA", @value="1983"&gt;</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >2. Superclasses and Subclasses</span></div><div><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >在第一点中已经讲得比较详细, 下面再举一个super的例子.</span></div><div><pre class="prettyprint"  ><p></p><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >class A<br>  def to_s<br>    puts("it's class A")<br>  end<br>  def amethod<br>    puts("it's class A's amethod")<br>  end<br>end<br>class B &lt; A<br>  def to_s<br>    super()  # super在这里将执行A中的to_s方法.<br>    puts("it's class B")<br>  end<br>end<br>class C &lt; B<br>  def to_s<br>    puts("it's class C")<br>  end<br>  def amethod<br>    super()  </font><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 20px; font-size: small;"  ># super在这里将执行A中的</span><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 20px; font-size: small;"  >amethod</span><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 20px; font-size: small;"  >方法. 因为C继承自B, B继承自A. 虽然B中没有定义amethod方法, 但是从A中继承了. 所以B的实例可以调用amethod, C的实例也可以调用amethod.</span><br><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >  end<br>end<br><br>b = B.new<br>b.to_s</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >b.amethod<br>puts("next..")<br>c = C.new<br>c.to_s<br>c.amethod</font></div><p></p></pre></div><div><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >执行结果 &nbsp;:&nbsp;</span></div><div><div><pre class="prettyprint"  ><p style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ></p><div><font color="#333333"  size="2"  ><span style="line-height: 19px;"  >it's class A<br>it's class B</span></font></div><div><font color="#333333"  size="2"  >it's class A's amethod<br>next..<br>it's class C<br>it's class A's amethod</font></div><p style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"  ><br></div></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >3. Passing Attribute value to Superclass</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >这个在前面的例子也讲到了, 传递attribute给superclass.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >实际上就是在subclass的initialize方法中调用super方法.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >例如 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div># This passes a, b, c to the superclass</div><div>def initialize( a, b, c, d, e, f )</div><div>&nbsp; &nbsp;super( a, b, c )</div><div>end</div><div># This passes a, b, c to the superclass</div><div>def initialize( a, b, c )</div><div>&nbsp; &nbsp;super</div><div>end</div><div># This passes no arguments to the superclass</div><div>def initialize( a, b, c)</div><div>&nbsp; &nbsp;super()</div><div>end</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >4. Accessor Methods</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >前面多个例子中都提到了对实例的变量进行初始化, 获取实例变量以及修改实例变量的值.&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >但是由于实例变量只允许在实例内访问, 不能直接从外面访问. 所以每次获取和修改实例变量都需要写对应的类方法来实现.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >下面我们来看个例子, 如何更加简洁的来获取和修改实例变量的值.</span></font></div><div><pre class="prettyprint"  ><p></p><div>class A</div><div>&nbsp; def initialize(a,b)</div><div>&nbsp; &nbsp; @x = a</div><div>&nbsp; &nbsp; @y = b</div><div>&nbsp; end</div><div>&nbsp; def x # 定义一个与实例变量x同名的方法</div><div>&nbsp; &nbsp; return @x</div><div>&nbsp; end</div><div>&nbsp; def x=(a) <span style="line-height: 22px;"  ># 定义一个包含实例变量,x= 的方法. 注意x=之间没有空格. </span></div><div>&nbsp; &nbsp; @x = a</div><div>&nbsp; end</div><div>&nbsp; def y</div><div>&nbsp; &nbsp; return @y</div><div>&nbsp; end</div><div>&nbsp; def y=(a)</div><div>&nbsp; &nbsp; @y = a</div><div>&nbsp; end</div><div>end</div><div><br></div><div>a = A.new('digoal','zhou')</div><div>p a</div><div>a.x = 'DIGOAL' # 使用a.x = 对@x进行修改或赋值.</div><div>a.y = 'ZHOU'</div><div>puts(a.x) <span style="line-height: 22px;"  ># 使用a.x 获取@x的返回值.</span></div><div>puts(a.y)</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >执行结果 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><pre class="prettyprint"  ><p></p><div><font size="2"  >#&lt;A:0x757ab8 @x="digoal", @y="zhou"&gt;</font></div><div><font size="2"  >DIGOAL</font></div><div><font size="2"  >ZHOU</font></div><p></p></pre></div><div style="line-height: 25px;"  ><br></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >5. Attribute Readers and Writers</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >我们注意到上面的写法还是太繁琐, 下面来看一个更简单的例子 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><pre class="prettyprint"  ><p></p><div><font size="2"  >class A</font></div><div><font size="2"  >&nbsp; def initialize(a,b)</font></div><div><font size="2"  >&nbsp; &nbsp; @x = a</font></div><div><font size="2"  >&nbsp; &nbsp; @y = b</font></div><div><font size="2"  >&nbsp; end</font></div><div><font size="2"  >&nbsp; attr_reader( :x, :y ) # attr_reader方法, 参数是Symbol, 与实例变量同名的Symbol. 相当于前面例子中定义的x,y方法.</font></div><div><font size="2"  >&nbsp; attr_writer( :x, :y ) <span style="line-height: 19px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ># attr_writer方法, 参数是Symbol, 与实例变量同名的Symbol. 相当于前面例子中定义的x=,y=方法. 如果这里是attr_writer( :x ), 那么就没有定义y=方法.</span></font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >a = A.new('digoal','zhou')</font></div><div><font size="2"  >p a</font></div><div><font size="2"  >a.x = 'DIGOAL'</font></div><div><font size="2"  >a.y = 'ZHOU'</font></div><div><font size="2"  >puts(a.x)</font></div><div><font size="2"  >puts(a.y)</font></div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >#&lt;A:0x1ee0340 @x="digoal", @y="zhou"&gt;</font></div><div><font size="2"  >DIGOAL</font></div><div><font size="2"  >ZHOU</font></div><p></p></pre></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >注意attr_writer和attr_reader方法会自动创建对应名字的实例变量, 即使在initialize方法中没有传入.如下 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div>class A</div><div>&nbsp; def initialize(a,b)</div><div>&nbsp; &nbsp; @x = a</div><div>&nbsp; &nbsp; @y = b</div><div>&nbsp; end</div><div>&nbsp; attr_reader( :x, :y, :z )  </div><div>&nbsp; attr_writer( :x, :y, :z )  <span style="line-height: 22px;"  ># 调用 z= 方法后将创建@z变量.</span></div><div>end</div><div><br></div><div>a = A.new('digoal','zhou')</div><div>p a</div><div>a.x = 'DIGOAL'</div><div>a.y = 'ZHOU'</div><div>puts(a.x)</div><div>puts(a.y)</div><div>a.z = 'it\'s Z'</div><div>puts(a.z)</div><div>p a</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >执行结果 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><pre class="prettyprint"  ><p></p><div><font size="2"  >#&lt;A:0x1ab7fb8 @x="digoal", @y="zhou"&gt;</font></div><div><font size="2"  >DIGOAL</font></div><div><font size="2"  >ZHOU</font></div><div><font size="2"  >it's Z</font></div><div><font size="2"  >#&lt;A:0x1ab7fb8 @x="DIGOAL", @y="ZHOU", @z="it's Z"&gt;</font></div><p></p></pre></div><div style="line-height: 25px;"  ><br></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >另外, 使用非标准的attr_reader举例, 例如需要在获取实例变量时需要转换成大写 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div>class A</div><div>&nbsp; def initialize(a,b)</div><div>&nbsp; &nbsp; @x = a</div><div>&nbsp; &nbsp; @y = b</div><div>&nbsp; end</div><div>&nbsp; attr_reader( :x )  # 这里未传入 :y Symbol.</div><div>&nbsp; attr_writer( :x, :y )</div><div>&nbsp; def y  # y方法用于输出首字母大写的@y</div><div>&nbsp; &nbsp; return @y.capitalize</div><div>&nbsp; end</div><div><br></div><div>end</div><div><br></div><div>a = A.new('digoal','zhou')</div><div>p a</div><div>puts(a.y)</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >执行结果 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div>#&lt;A:0x1da0348 @x="digoal", @y="zhou"&gt;</div><div>Zhou</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >但是使用attr_reader和attr_writer还是闲麻烦怎么办.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >还可以有更方便的吗?</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >如下 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div>class A</div><div>&nbsp; def initialize(a,b)</div><div>&nbsp; &nbsp; @x = a</div><div>&nbsp; &nbsp; @y = b</div><div>&nbsp; end</div><div>&nbsp; attr_accessor( :x, :y )</div><div>end</div><div><br></div><div>a = A.new('digoal','zhou')</div><div>p a</div><div>puts(a.x)</div><div>puts(a.y)</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >执行结果 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div>#&lt;A:0x1e50508 @x="digoal", @y="zhou"&gt;</div><div>digoal</div><div>zhou</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >attr_accessor 相当于同时执行了attr_reader和attr_writer</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >6. Calling Methods of a Superclass</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >这个在前面已经列举过了, 在subclass的方法中, 使用super方法调用superclass的同名方法.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >7. Class Variables</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >前面我们接触到了localvar, globalvar, instance variable.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >接下来引入class variable, 以</span></font><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >@@开头.</span></div><div><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >例如我们有一个Student类, 每新增一个同学班上的同学总数就加1 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div>class Student</div><div>&nbsp; @@count = 0  # 定义一个class variable, 初始值=0</div><div>&nbsp; def initialize(a,b)</div><div>&nbsp; &nbsp; @@count += 1  # 每次调用initialize方法时, @@count自增1.</div><div>&nbsp; &nbsp; @firstname = a</div><div>&nbsp; &nbsp; @lastname = b</div><div>&nbsp; end</div><div>&nbsp; def self.count # 定义一个属于Student这个类的方法.</div><div>&nbsp; &nbsp; return @@count</div><div>&nbsp; end</div><div>&nbsp; def count # 定义一个instance 方法. 这两个方法虽然都叫count, 但是一个只能用Student调用, 一个只能在新建了Student实例后通过实例调用, 以后会将到这个. 我们可以定义属于类的方法, 还可以定义属于对象的方法. 通过Student.singleton_methods可以查看它的类方法.</div><div>&nbsp; &nbsp; return @@count</div><div>&nbsp; end</div><div>end</div><div><br></div><div>puts( Student.count )<br>a = Student.new('Zhou','Digoal')<br>puts( Student.count ) # 通过Student类调用count方法<br>puts( a.count ) # 通过a对象调用count方法.<br>b = Student.new('Zhou','Digoal')<br>puts( Student.count )<br>puts( a.count )<br>puts( b.count )<br>c = Student.new('Zhou','Digoal')<br>puts( Student.count )<br>puts( a.count )<br>puts( b.count )<br>puts( c.count )</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >执行结果 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div>0<br>1<br>1<br>2<br>2<br>2<br>3<br>3<br>3<br>3</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >查看Student的类方法 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >puts( Student.singleton_methods )</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 25px;"  >返回</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >count</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >8. The Root of All Classes</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >最开始已经讲过了.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >1.9 中所有类的根类都是BasicObject</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >1.8 则为Object.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >9. Nested Class</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >内嵌class, 这个用法比较特殊, 但是可以说明一个问题, 通过 :: 可以调用内嵌类或常量.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >举例 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div>class A</div><div>&nbsp; class NestedA # 这里定义了一个A的内嵌类NestedA</div><div>&nbsp; &nbsp; def initialize(a) # 这里是内嵌类的内容</div><div>&nbsp; &nbsp; &nbsp; @x = a</div><div>&nbsp; &nbsp; end</div><div>&nbsp; &nbsp; attr_accessor( :x )</div><div>&nbsp; end</div><div>&nbsp; def initialize(b) # 这里是A类的内容</div><div>&nbsp; &nbsp; @y = b</div><div>&nbsp; end</div><div>&nbsp; attr_accessor( :y )</div><div>end</div><div><br></div><div>a = A::NestedA.new('digoal')  # 定义一个内嵌类的对象</div><div>p a</div><div>b = A.new('DIGOAL') # 非内嵌类的对象</div><div>p b</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >执行结果 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div>#&lt;A::NestedA:0x1e40c98 @x="digoal"&gt;</div><div>#&lt;A:0x1e40bc0 @y="DIGOAL"&gt;</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >10. Extend Class or Partial Class</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >注意, Ruby的Class的定义非常灵活, 所以扩展性非常强, Class的内容可以不需要写在一个</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >class A</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >end</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >块内.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >因此 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div>class A</div><div>&nbsp; def initialize( a, b )</div><div>&nbsp; &nbsp; @x = a</div><div>&nbsp; &nbsp; @y = b</div><div>&nbsp; end</div><div>end</div><div># 这中间可以写其他代码, 如定义class B end. 没有关系.</div><div>class A</div><div>&nbsp; attr_accessor( :x, :y )</div><div>end</div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >等同于 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div>class A</div><div>&nbsp; def initialize( a, b )</div><div>&nbsp; &nbsp; @x = a</div><div>&nbsp; &nbsp; @y = b</div><div>&nbsp; end</div><div>&nbsp; attr_accessor( :x, :y )</div><div>end</div></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >正因为这样, RUBY的扩展性很强, 例如系统自带的Array类, 我想给它加个方法, 如下 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><pre class="prettyprint"  ><p></p><div><font size="2"  >class Array</font></div><div><font size="2"  >&nbsp; def mymethod # 给Array类新增一个mymethod方法.</font></div><div><font size="2"  >&nbsp; &nbsp; puts('my Array\' mymethod')</font></div><div><font size="2"  >&nbsp; end</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >[1,2,3].mymethod</font></div><p></p></pre></div><div>输出 :&nbsp;</div><div><pre class="prettyprint"  ><p>my Array' mymethod</p></pre></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >11. Constants Inside Classes</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  >常量以大写开头, 从外部访问也是使用 :: .</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><pre class="prettyprint"  ><p></p><div><font size="2"  >class A</font></div><div><font size="2"  >&nbsp; Count = 1</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >puts( A::Count )</font></div><p></p></pre></div><div>输出 :&nbsp;</div><div><pre class="prettyprint"  ><p>1</p></pre></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="line-height: 25px;"  ><br></span></font></div><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"  >【参考】</span><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >The Book Of Ruby</div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >Ruby 1.9.3 API</div><wbr></div>
	</div>
</div>
</body>
</html>