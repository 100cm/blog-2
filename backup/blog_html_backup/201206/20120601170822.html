<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostGIS 2.0 Install</h2>
	<h5 id="">2012-06-01 17:08:22&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402012513055140/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>应同事需求, 写一篇PostGIS的安装文档.</div><div>安装环境 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >CentOS 5.x 64位</font></div><div><font size="2"  >PostgreSQL 9.1.3</font></div><div><font size="2"  >PostGIS 2.0</font></div><p></p></pre></div><div><br></div>一、安装PostgreSQL<div><span style="line-height: 22px;"  >新建用户(用户名随意)</span></div><div><pre class="prettyprint"  ><p><font size="2"  >useradd postgis</font></p></pre></div><div><span style="line-height: 22px;"  >配置环境变量</span></div><div><pre class="prettyprint"  ><p></p><div><span style="line-height: 22px;"  ><font size="2"  >vi /home/postgis/.bash_profile</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  ># add by digoal</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  ><div>export PS1="$USER@`/bin/hostname -s`-&gt; "</div><div>export PGPORT=1997</div><div>export PGDATA=/home/postgis/pg_root</div><div>export LANG=en_US.utf8</div><div>export PGHOME=/home/postgis/pgsql</div><div>export LD_LIBRARY_PATH=$PGHOME/lib:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib</div><div>export DATE=`date +"%Y%m%d%H%M"`</div><div>export PATH=$PGHOME/bin:$PATH:.</div><div>export MANPATH=$PGHOME/share/man:$MANPATH</div><div>alias rm='rm -i'</div><div>alias ll='ls -lh'</div></font></span></div><p></p></pre></div><div><span style="line-height: 22px;"  ><br></span></div><div><div>下载PostgreSQL源码包</div><div><pre class="prettyprint"  ><p><font size="2"  >wget http://ftp.postgresql.org/pub/source/v9.1.3/postgresql-9.1.3.tar.bz2</font></p></pre></div><div><br></div><div>解压</div><div><pre class="prettyprint"  ><p><font size="2"  >tar -jxvf postgresql-9.1.3.tar.bz2</font></p></pre></div><div><br></div><div>编译</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgis@db-172-16-3-33-&gt; cd postgresql-9.1.3</font></div><div><font size="2"  >postgis@db-172-16-3-33-&gt; ./configure --prefix=/home/postgis/pgsql --with-pgport=1997 --with-perl --with-python --with-openssl --with-pam --without-ldap --with-libxml --with-libxslt --enable-thread-safety --with-wal-blocksize=16 &amp;&amp; gmake world</font></div><p></p></pre></div><div><br></div><div>安装</div><div><pre class="prettyprint"  ><p><font size="2"  >sudo gmake install-world</font></p></pre></div><div><br></div><div>初始化数据库</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgis@db-172-16-3-33-&gt; mkdir $PGDATA</font></div><div><font size="2"  >postgis@db-172-16-3-33-&gt; initdb -D $PGDATA -E UTF8 --locale=C -W</font></div><p></p></pre></div><div><br></div><div>修改配置文件</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgis@db-172-16-3-33-&gt; vi $PGDATA/pg_hba.conf</font></div><div><div><font size="2"  ># add by digoal</font></div><div><font size="2"  >host all all 0.0.0.0/0 md5</font></div></div><p></p></pre></div><div><br></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgis@db-172-16-3-33-&gt; vi $PGDATA/postgresql.conf</font></div><div><font size="2"  >listen_addresses = '0.0.0.0'</font></div><div><font size="2"  >max_connections = 2000</font></div><div><font size="2"  >unix_socket_directory = '.'</font></div><div><font size="2"  >unix_socket_permissions = 0700</font></div><div><font size="2"  >tcp_keepalives_idle = 60</font></div><div><font size="2"  >tcp_keepalives_interval = 10</font></div><div><font size="2"  >tcp_keepalives_count = 10</font></div><div><font size="2"  >shared_buffers = 2048MB</font></div><div><font size="2"  >maintenance_work_mem = 512MB</font></div><div><font size="2"  >max_stack_depth = 8MB</font></div><div><font size="2"  >shared_preload_libraries = 'pg_stat_statements'</font></div><div><font size="2"  >vacuum_cost_delay = 10ms</font></div><div><font size="2"  >bgwriter_delay = 10ms</font></div><div><font size="2"  >wal_level = hot_standby</font></div><div><font size="2"  >synchronous_commit = off</font></div><div><font size="2"  >wal_sync_method = fdatasync</font></div><div><font size="2"  >wal_buffers = 16384kB</font></div><div><font size="2"  >wal_writer_delay = 10ms</font></div><div><font size="2"  >checkpoint_segments = 128</font></div><div><font size="2"  >archive_mode = on</font></div><div><font size="2"  >archive_command = '/bin/date'</font></div><div><font size="2"  >max_wal_senders = 32</font></div><div><font size="2"  >wal_sender_delay = 10ms</font></div><div><font size="2"  >wal_keep_segments = 256</font></div><div><font size="2"  >hot_standby = on</font></div><div><font size="2"  >max_standby_archive_delay = 900s</font></div><div><font size="2"  >max_standby_streaming_delay = 900s</font></div><div><font size="2"  >wal_receiver_status_interval = 10s</font></div><div><font size="2"  >hot_standby_feedback = on</font></div><div><font size="2"  >random_page_cost = 1.5</font></div><div><font size="2"  >effective_cache_size = 16384MB # 与内存大小一致</font></div><div><font size="2"  >log_destination = 'csvlog'</font></div><div><font size="2"  >logging_collector = on</font></div><div><font size="2"  >log_directory = '/var/applog/pg_log/postgis/1997'</font></div><div><font size="2"  >log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'</font></div><div><font size="2"  >log_file_mode = 0600</font></div><div><font size="2"  >log_truncate_on_rotation = on</font></div><div><font size="2"  >log_rotation_age = 1d</font></div><div><font size="2"  >log_rotation_size = 10MB</font></div><div><font size="2"  >log_min_duration_statement = 1000ms</font></div><div><font size="2"  >log_checkpoints = on</font></div><div><font size="2"  >log_lock_waits = on</font></div><div><font size="2"  >log_statement = 'ddl'</font></div><div><font size="2"  >track_activity_query_size = 2048</font></div><div><font size="2"  >autovacuum = on</font></div><div><font size="2"  >log_autovacuum_min_duration = 0</font></div><div><font size="2"  >deadlock_timeout = 1s</font></div><div><div><font size="2"  >custom_variable_classes = 'pg_stat_statements'</font></div><div><font size="2"  >pg_stat_statements.max = 1000</font></div><div><font size="2"  >pg_stat_statements.track = all</font></div></div><p></p></pre></div><div><br></div><div>新建日志目录</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-33 postgresql-9.1.3]# mkdir -p /var/applog/pg_log/postgis/1997</font></div><div><font size="2"  >[root@db-172-16-3-33 postgresql-9.1.3]# chown -R postgis:postgis /var/applog/pg_log/postgis</font></div><p></p></pre></div><div><br></div><div>启动数据库</div><div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgis@db-172-16-3-33-&gt; pg_ctl start</font></div><div><font size="2"  >server starting</font></div><div><font size="2"  >postgis@db-172-16-3-33-&gt; LOG: &nbsp;loaded library "pg_stat_statements"</font></div><p></p></pre></div><div><br><div>二、安装PostGIS2.0依赖包</div><div>下载安装包</div><div><div><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><font size="2"  >[root@db-172-16-3-33 soft_bak]# wget&nbsp;<a target="_blank" rel="nofollow" href="ftp://ftp.remotesensing.org/gdal/gdal-1.9.1.tar.gz"  >ftp://ftp.remotesensing.org/gdal/gdal-1.9.1.tar.gz</a></font></div><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# wget&nbsp;<a target="_blank" rel="nofollow" href="http://download.osgeo.org/geos/geos-3.3.4.tar.bz2"  >http://download.osgeo.org/geos/geos-3.3.4.tar.bz2</a></font></div><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# wget&nbsp;<a target="_blank" rel="nofollow" href="http://download.osgeo.org/proj/proj-4.8.0.tar.gz"  >http://download.osgeo.org/proj/proj-4.8.0.tar.gz</a></font></div><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# wget&nbsp;<a target="_blank" rel="nofollow" href="http://oss.metaparadigm.com/json-c/json-c-0.9.tar.gz"  >http://oss.metaparadigm.com/json-c/json-c-0.9.tar.gz</a></font></div><p></p></pre></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><br></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >安装</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# tar -zxvf gdal-1.9.1.tar.gz</font></div><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# cd gdal-1.9.1</font></div><div><font size="2"  >[root@db-172-16-3-33 gdal-1.9.1]# ./configure --prefix=/opt/gdal-1.9.1</font></div><div><span style="line-height: 22px;"  ><font size="2"  >[root@db-172-16-3-33 gdal-1.9.1]#&nbsp;make</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  >[root@db-172-16-3-33 gdal-1.9.1]#&nbsp;make install</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  ><br></font></span></div><div><font size="2"  >[root@db-172-16-3-33 geos-3.3.4]# tar -jxvf geos-3.3.4.tar.bz2</font></div><div><font size="2"  >[root@db-172-16-3-33 geos-3.3.4]# cd geos-3.3.4</font></div><div><font size="2"  >[root@db-172-16-3-33 geos-3.3.4]# ./configure --prefix=/opt/geos-3.3.4</font></div><div><font size="2"  >[root@db-172-16-3-33 geos-3.3.4]# make</font></div><div><font size="2"  >[root@db-172-16-3-33 geos-3.3.4]# make install</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# tar -zxvf proj-4.8.0.tar.gz</font></div><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# cd proj-4.8.0</font></div><div><font size="2"  >[root@db-172-16-3-33 proj-4.8.0]# ./configure --prefix=/opt/proj-4.8.0</font></div><div><font size="2"  >[root@db-172-16-3-33 proj-4.8.0]# make</font></div><div><font size="2"  >[root@db-172-16-3-33 proj-4.8.0]# make install</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# tar -zxvf json-c-0.9.tar.gz</font></div><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# cd json-c-0.9</font></div><div><font size="2"  >[root@db-172-16-3-33 json-c-0.9]# ./configure --prefix=/opt/json-c-0.9</font></div><div><font size="2"  >[root@db-172-16-3-33 json-c-0.9]# make</font></div><div><font size="2"  >[root@db-172-16-3-33 json-c-0.9]# make install</font></div><p></p></pre></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><br></span></div><div style="line-height: 22px;"  ><span style="line-height: 22px;"  >-- 使用rpm安装以下包</span></div><div><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><span style="line-height: 22px;"  ><font size="2"  >libxml2-devel</font></span></div><div style="line-height: 22px;"  ><font size="2"  >libxml2</font></div><div style="line-height: 22px;"  ><font size="2"  >glibc-common (iconv)</font></div><div style="line-height: 22px;"  ><font size="2"  >GTK+2.0</font></div><p></p></pre></div><div style="line-height: 22px;"  >修改启动postgresql的系统用户环境变量, 把这些LIB加入到LD_LIBRARY_PATH中.</div></div><div><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><font size="2"  >vi /home/postgis/.bash_profile</font></div><div><font size="2"  >export LD_LIBRARY_PATH=/opt/gdal-1.9.1/lib:/opt/geos-3.3.4/lib:/opt/json-c-0.9/lib:/opt/proj-4.8.0/lib:$PGHOME/lib:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib</font></div><p></p></pre></div><div style="line-height: 22px;"  >这些修改好后, 需要应用环境变量并重启数据库.</div><div><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><font size="2"  >su - postgis</font></div><div style="line-height: 22px;"  ><font size="2"  >. ~/.bash_profile</font></div><div style="line-height: 22px;"  ><font size="2"  >pg_ctl stop -m fast</font></div><div style="line-height: 22px;"  ><font size="2"  >pg_ctl start</font></div><p></p></pre></div><div style="line-height: 22px;"  ><br></div><div style="line-height: 22px;"  >三、安装PostGIS 2.0</div><div style="line-height: 22px;"  >下载安装包</div><div><pre class="prettyprint"  ><p><font size="2"  >wget http://www.postgis.org/download/postgis-2.0.0.tar.gz</font></p></pre></div><div>安装</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# tar -zxvf postgis-2.0.0.tar.gz</font></div><div><font size="2"  >[root@db-172-16-3-33 soft_bak]# cd postgis-2.0.0</font></div><div><font size="2"  >[root@db-172-16-3-33 postgis-2.0.0]# ./configure --prefix=/opt/postgis-2.0.0 --with-pgconfig=/home/postgis/pgsql/bin/pg_config --with-gdalconfig=/opt/gdal-1.9.1/bin/gdal-config --with-geosconfig=/opt/geos-3.3.4/bin/geos-config --with-xml2config=/usr/bin/xml2-config --with-projdir=/opt/proj-4.8.0 --with-libiconv=/usr/bin --with-jsondir=/opt/json-c-0.9 --with-gui --with-raster --with-topology --with-gettext=no</font></div><div><span style="line-height: 22px;"  ><font size="2"  >[root@db-172-16-3-33 postgis-2.0.0]#&nbsp;gmake</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  >[root@db-172-16-3-33 postgis-2.0.0]#&nbsp;gmake install</font></span></div><p></p></pre></div><div>查看安装是否正确 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgis@db-172-16-3-33-&gt; cd $PGHOME/share/extension/</font></div><div><font size="2"  >postgis@db-172-16-3-33-&gt; ll|grep postgis</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0alpha1--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0alpha2--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0alpha3--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0alpha4--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0alpha5--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0alpha6--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0beta1--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0beta2--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0beta3--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0beta4--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0rc1--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 478K Jun &nbsp;1 17:44 postgis--2.0.0rc2--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 4.0M Jun &nbsp;1 17:44 postgis--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root &nbsp;185 Jun &nbsp;1 17:44 postgis.control</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0alpha1--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0alpha2--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0alpha3--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0alpha4--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0alpha5--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0alpha6--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0beta1--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0beta2--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0beta3--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0beta4--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0rc1--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 280K Jun &nbsp;1 17:44 postgis_topology--2.0.0rc2--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root 277K Jun &nbsp;1 17:44 postgis_topology--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root &nbsp;169 Jun &nbsp;1 17:44 postgis_topology.control</font></div><div><font size="2"  >-rw-r--r-- 1 root root 8.0K Jun &nbsp;1 17:44 postgis_topology--unpackaged--2.0.0.sql</font></div><div><font size="2"  >-rw-r--r-- 1 root root &nbsp;77K Jun &nbsp;1 17:44 postgis--unpackaged--2.0.0.sql</font></div><p></p></pre></div><div><br></div><div>四、使用PostGIS 2.0</div><div>创建一个空间测试库</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgis@db-172-16-3-33-&gt; psql postgres postgis -h 127.0.0.1</font></div><div><font size="2"  >psql (9.1.3)</font></div><div><font size="2"  >Type "help" for help.</font></div><div><font size="2"  >postgres=# create database digoal template template0 encoding 'UTF8' ;</font></div><div><font size="2"  >CREATE DATABASE</font></div><p></p></pre></div><div><br></div><div>在空间测试库中加载postgis 和 postgis_topology 模块</div><div>使用超级用户创建这两个模块</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# \c digoal postgres</font></div><div><font size="2"  >digoal=# create extension postgis;</font></div><div><font size="2"  >CREATE EXTENSION</font></div><div><font size="2"  >digoal=# create extension postgis_topology;</font></div><div><font size="2"  >CREATE EXTENSION</font></div><p></p></pre></div><div><br></div><div>现在就可以使用postgis 了.</div><div><br></div><div>【参考】</div><div><a rel="nofollow" href="http://www.postgis.org/"  >http://www.postgis.org</a> </div><div><a rel="nofollow" href="http://workshops.opengeo.org/postgis-intro"  >http://workshops.opengeo.org/postgis-intro</a> </div><div><br></div><div>【依赖包】</div><div><a rel="nofollow" href="http://www.gdal.org/index.html"  >http://www.gdal.org/index.html</a> </div><div><a rel="nofollow" href="http://trac.osgeo.org/geos/"  >http://trac.osgeo.org/geos/</a> </div><div><a rel="nofollow" href="http://trac.osgeo.org/proj/"  >http://trac.osgeo.org/proj/</a> </div><div>libxml2-devel</div><div>libxml2</div><div>glibc-common (iconv)</div><div>GTK+2.0</div><div><a rel="nofollow" href="http://oss.metaparadigm.com/json-c/"  >http://oss.metaparadigm.com/json-c/</a> </div><div><br></div><div><br></div><div><wbr></div></div></div></div></div>
	</div>
</div>
</body>
</html>