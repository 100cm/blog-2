<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">RHEL5_LVM_metadata copys bug</h2>
	<h5 id="">2010-09-27 12:01:58&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402010827115411728/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">LVM在LINUX的存储管理领域占据非常重要的地位。最近在看vg metadata的相关材料发现一个比较容易产生混淆的地方，METADATA的拷贝份数。原文如下：<div><span style="font-family: 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif; line-height: 15px; font-size: 12px;">Currently LVM allows you to store 0, 1 or 2 identical copies of its metadata on each physical volume. The default is 1 copy. Once you configure the number of metadata copies on the physical volume, you cannot change that number at a later time. The first copy is stored at the start of the device, shortly after the label. If there is a second copy, it is placed at the end of the device. If you accidentally overwrite the area at the beginning of your disk by writing to a different disk than you intend, a second copy of the metadata at the end of the device will allow you to recover the metadata.</span></div><div><span style="font-family: 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif; line-height: 15px; font-size: 12px;">COPY有副本，拷贝的意思。</span></div><div><span style="font-family: 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif; line-height: 15px; font-size: 12px;">所有就有点纳闷了，0到底是代表有METADATA没副本，还是代表没METADATA也没副本呢？带着这个问题找到了RHEL的技术支持，答复非常干脆：0表示没有METADATA也没有副本。</span></div><div><span style="font-family: 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif; line-height: 15px; font-size: 12px;">关于PV创建时可以指定这个值，原文如下:</span></div><div><span style="font-family: 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif; line-height: 15px; font-size: 12px;">If a volume group contains many physical volumes, having many redundant copies of the metadata is inefficient. It is possible to create a physical volume without any metadata copies by using the&nbsp;<code style="font-family: 'liberation mono', 'bitstream vera mono', 'dejavu mono', monospace; white-space: nowrap; font-weight: bold;">--metadatacopies 0</code>&nbsp;option of the<code style="font-family: 'liberation mono', 'bitstream vera mono', 'dejavu mono', monospace; white-space: nowrap; font-weight: bold;">pvcreate</code>&nbsp;command. Once you have selected the number of metadata copies the physical volume will contain, you cannot change that at a later point. Selecting 0 copies can result in faster updates on configuration changes. Note, however, that at all times every volume group must contain at least one physical volume with a metadata area (unless you are using the advanced configuration settings that allow you to store volume group metadata in a file system). If you intend to split the volume group in the future, every volume group needs at least one metadata copy.</span></div><div><span style="font-family: 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif; line-height: 15px; font-size: 12px;">也就是说除非使用额外的元数据管理，否则每个VG都需要至少一个元数据存储在PV中。由于选定后就不能修改了，所以当做VG拆分的时候显得尤为重要。</span></div><div><font face="'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif" size="3"><span style="font-size: 12px; line-height: 15px;">另外一段原文：</span></font></div><div><font face="'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif" size="3"><span style="font-size: 12px; line-height: 15px;">Metadata locations are stored as offset and size (in bytes). There is room in the label for about 15 locations, but the LVM tools currently use 3: a single data area plus up to two metadata areas.</span></font></div><div><font face="'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif" size="3"><span style="font-size: 12px; line-height: 15px;">这里和前面的</span></font><span style="font-family: 'liberation mono', 'bitstream vera mono', 'dejavu mono', monospace; font-size: 12px; font-weight: bold; line-height: 19px; white-space: nowrap;">--metadatacopies [0-2]也相互辉映.</span></div><div><span style="font-family: 'liberation mono', 'bitstream vera mono', 'dejavu mono', monospace; font-size: 12px; font-weight: bold; line-height: 19px; white-space: nowrap;"><br></span></div><div><span style="font-family: 'liberation mono', 'bitstream vera mono', 'dejavu mono', monospace; font-size: 12px; font-weight: bold; line-height: 19px; white-space: nowrap;">另外一段需要注意的原文:</span></div><div><span style="font-family: 'liberation mono', 'bitstream vera mono', 'dejavu mono', monospace; font-size: 12px; font-weight: bold; line-height: 19px; white-space: nowrap;"><span style="font-family: 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif; font-weight: normal; line-height: 15px; white-space: normal;">You can specify the size of metadata area with the&nbsp;<code style="font-family: 'liberation mono', 'bitstream vera mono', 'dejavu mono', monospace; white-space: nowrap; font-weight: bold;">--metadatasize</code>. option of the&nbsp;<code style="font-family: 'liberation mono', 'bitstream vera mono', 'dejavu mono', monospace; white-space: nowrap; font-weight: bold;">pvcreate</code>&nbsp;command. The default size is too small for volume groups with many logical volumes or physical volumes</span></span></div><div><font face="'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif" size="3"><span style="font-size: 12px; line-height: 15px;">虽然元数据是ASCII存储并且也是非常小的，但是当PV和LV很多的时候可能不够，需要在创建PV时指定一个大一点的值。</span></font></div><div><font face="'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif" size="3"><span style="font-size: 12px; line-height: 15px;"><br></span></font></div><div><font face="'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif" size="3"><span style="font-size: 12px; line-height: 15px;">下面是红帽的回复，他们认为这是一个BUG</span></font></div><div><font face="'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', 'Trebuchet MS', helvetica, verdana, arial, sans-serif" size="3"><span style="font-size: 12px; line-height: 15px;"><div>---------------------------------------&nbsp;</div><div>| &nbsp; &nbsp; &nbsp; &nbsp; Case Information &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</div><div>---------------------------------------&nbsp;</div><div>https://access.redhat.com/support/cases/00347957</div><div>Case Title &nbsp; &nbsp; &nbsp; : RHEL5 LVM metadata副本的问题&nbsp;</div><div>Case Number &nbsp; &nbsp; &nbsp;: 00347957&nbsp;</div><div>Case Open Date &nbsp; : 2010-09-27 09:16:38</div><div>Problem Type &nbsp; &nbsp; : Bug</div><div><br></div><div>Last update comment as of 2010-09-27 09:21:06:&nbsp;</div><div>请参考如下的文档：</div><div>http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Logical_Volume_Manager_Administration/lvm_metadata.html</div><div><br></div><div>如果使用0则意味着pv上不保存metadata, 但是注意整个VG中必须至少有一个PV包含metadata.&nbsp;</div></span></font></div></div>
	</div>
</div>
</body>
</html>