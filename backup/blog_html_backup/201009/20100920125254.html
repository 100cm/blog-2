<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">[RHCS] Using fence_ipmilan replace IBM fence_agent : fence_rsa [IBM X3550 M3 IMM failed problem]</h2>
	<h5 id="">2010-09-20 12:52:54&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402010820112718291/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>最近公司里面采购了一批 IBM X3550 m3,在配置RHCS 5.5时遇到一点小麻烦，以前配过IBM的管理设备RSA，这一批IBM的管理设备改名字了，叫做IMM。使用fence_rsa输入IP/HOSTNAME，登录名称密码去看服务器的状态，经常会报异常。但是有时候又可以成功。所以使用fence_rsa<span style="font-size: small;">作为服务器的FENCE agent带来不少麻烦，例如做HA FAILOVER测试时，某个节点一直都不能被FENCE掉，日志如下：</span></div><div><br></div><div>Sep 20 10:50:14 db_192_168_173_52_community fenced[29904]: fencing node "db_192_168_173_53_community"</div><div>Sep 20 10:50:17 db_192_168_173_52_community fenced[29904]: agent "fence_rsa" reports: Traceback (most recent call last): &nbsp; File "/sbin/fence_rsa", line 81, in ? &nbsp; &nbsp; main() &nbsp; File "/sbin/fence_rsa", line 67, in main &nbsp; &nbsp; fence_action(conn, options, set_power_status, get_power_status, None) &nbsp; File "/usr/lib/fence/fencing.py", line 726, in fen</div><div>Sep 20 10:50:17 db_192_168_173_52_community fenced[29904]: agent "fence_rsa" reports: ce_action &nbsp; &nbsp; status = get_power_fn(tn, options) &nbsp; File "/sbin/fence_rsa", line 29, in get_power_status &nbsp; &nbsp; status = re.compile("Power: (.*)", re.IGNORECASE).search(conn.before).group(1) AttributeError: 'NoneType' object has no attribute 'group'&nbsp;</div><div>Sep 20 10:50:17 db_192_168_173_52_community fenced[29904]: fence "db_192_168_173_53_community" failed</div><div><br></div><div>同时IMM的WEB页面也没有办法登录了，以前碰到这种情况需要把服务器电源拔掉重新启动服务器。IBM回复需要升级FIRMWARE。</div><div>除了使用FENCE_RSA还可以使用fence_ipmilan来作为服务器的fence agent.</div><div>下面来看看配置:</div><div>使用fence_rsa的配置:</div><div>&lt;fencedevice agent="fence_rsa" hostname="db_192_168_173_52_community_fence" login="xxxx" name="db_192_168_173_52_community_fence" passwd="xxxx"/&gt;</div><div>使用fence_ipmilan的配置：</div><div>&lt;fencedevice agent="fence_ipmilan" ipaddr="db_192_168_173_52_community_fence" login="xxxx" authtype="password" name="db_192_168_173_52_community_fence" passwd="xxxx"/&gt;</div><div>修改集群配置文件的版本重新加载，再次进行HA FAILOVER测试fence过程正常。</div><div><br></div><div>【备注】</div><div><div>[root@db_192_168_173_53_community ~]# fence_ipmilan -h</div><div>usage: fence_ipmilan &lt;options&gt;</div><div>&nbsp;&nbsp; -A &lt;authtype&gt; &nbsp;IPMI Lan Auth type (md5, password, or none)</div><div>&nbsp;&nbsp; -a &lt;ipaddr&gt; &nbsp; &nbsp;IPMI Lan IP to talk to</div><div>&nbsp;&nbsp; -i &lt;ipaddr&gt; &nbsp; &nbsp;IPMI Lan IP to talk to (deprecated, use -a)</div><div>&nbsp;&nbsp; -p &lt;password&gt; &nbsp;Password (if required) to control power on</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IPMI device</div><div>&nbsp;&nbsp; -P &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Use Lanplus</div><div>&nbsp;&nbsp; -S &lt;path&gt; &nbsp; &nbsp; &nbsp;Script to retrieve password (if required)</div><div>&nbsp;&nbsp; -l &lt;login&gt; &nbsp; &nbsp; Username/Login (if required) to control power</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;on IPMI device</div><div>&nbsp;&nbsp; -o &lt;op&gt; &nbsp; &nbsp; &nbsp; &nbsp;Operation to perform.</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Valid operations: on, off, reboot, status</div><div>&nbsp;&nbsp; -t &lt;timeout&gt; &nbsp; Timeout (sec) for IPMI operation (default 20)</div><div>&nbsp;&nbsp; -C &lt;cipher&gt; &nbsp; &nbsp;Ciphersuite to use (same as ipmitool -C parameter)</div><div>&nbsp;&nbsp; -M &lt;method&gt; &nbsp; &nbsp;Method to fence (onoff or cycle (default onoff)</div><div>&nbsp;&nbsp; -V &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Print version and exit</div><div>&nbsp;&nbsp; -v &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Verbose mode</div><div><br></div><div>If no options are specified, the following options will be read</div><div>from standard input (one per line):</div><div><br></div><div>&nbsp;&nbsp; auth=&lt;auth&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Same as -A</div><div>&nbsp;&nbsp; ipaddr=&lt;#&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Same as -a</div><div>&nbsp;&nbsp; passwd=&lt;pass&gt; &nbsp; &nbsp; &nbsp; &nbsp; Same as -p</div><div>&nbsp;&nbsp; passwd_script=&lt;path&gt; &nbsp;Same as -S</div><div>&nbsp;&nbsp; lanplus &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Same as -P</div><div>&nbsp;&nbsp; login=&lt;login&gt; &nbsp; &nbsp; &nbsp; &nbsp; Same as -u</div><div>&nbsp;&nbsp; option=&lt;op&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Same as -o</div><div>&nbsp;&nbsp; operation=&lt;op&gt; &nbsp; &nbsp; &nbsp; &nbsp;Same as -o</div><div>&nbsp;&nbsp; action=&lt;op&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Same as -o</div><div>&nbsp;&nbsp; timeout=&lt;timeout&gt; &nbsp; &nbsp; Same as -t</div><div>&nbsp;&nbsp; cipher=&lt;cipher&gt; &nbsp; &nbsp; &nbsp; Same as -C</div><div>&nbsp;&nbsp; method=&lt;method&gt; &nbsp; &nbsp; &nbsp; Same as -M</div><div>&nbsp;&nbsp; verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Same as -v</div></div><div><br></div><div>【参考】</div><div>http://gfs.wikidev.net/IPMI_Fencing</div><div>http://www.docin.com/p-40917012.html</div><div>【其他】</div><div>HP ILO支持ipmi需要配置通道运行IPMI。否则ipmitool print lan死都不会出信息</div></div>
	</div>
</div>
</body>
</html>