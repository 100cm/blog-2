<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">pgmemcache installation</h2>
	<h5 id="">2012-11-18 15:15:28&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201210172341257/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div><div>pgmemcache是一系列的PostgreSQL函数, 用于memcache的读写操作.&nbsp;</div><div>通过pgmemcache以及PostgreSQL的触发器可以方便的对数据库中的数据进行缓存.&nbsp;</div><div>当然缓存的操作也可以挪至应用程序自己来处理. pgmemcache只是一种选择.</div><div>本文涉及的环境如下 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >CentOS 5.7 x64</font></div><div><font size="2"  >PostgreSQL 9.2.0</font></div><div><font size="2"  >libevent&nbsp;2.0.20-stable</font></div><div><font size="2"  >memcached&nbsp;1.4.15</font></div><div><font size="2"  >libmemcache&nbsp;0.48</font></div><div><font size="2"  >pgmemcache&nbsp;2.0.6</font></div><p></p></pre></div><div><br></div><div>首先介绍一下pgmemcache的安装 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >pgmemcache 依赖 libmemcache和PostgreSQL</font></div><div><font size="2"  >libmemcache依赖libevent和memcache</font></div><div><font size="2"  >memcache依赖libevent.</font></div><p></p></pre></div><div>所以首先要安装的是libevent :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >wget https://github.com/downloads/libevent/libevent/libevent-2.0.20-stable.tar.gz</font></div><div><font size="2"  >tar -zxvf libevent-2.0.20-stable.tar.gz</font></div><div><font size="2"  >cd libevent-2.0.20-stable</font></div><div><font size="2"  >./configure</font></div><div><font size="2"  >make</font></div><div><font size="2"  >make install</font></div><p></p></pre></div><div>安装完后可以看到安装好后的libevent动态库文件.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >updatedb</font></div><div><font size="2"  >locate libevent-2.0.so</font></div><div><font size="2"  >/usr/local/lib/libevent-2.0.so.5</font></div><div><font size="2"  >/usr/local/lib/libevent-2.0.so.5.1.8</font></div><p></p></pre></div><div>将这个目录加入动态库配置文件 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >vi /etc/ld.so.conf</font></div><div><font size="2"  >/usr/local/lib</font></div><div><font size="2"  >ldconfig</font></div><p></p></pre></div><div>确认已经生效 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >ldconfig -p|grep libevent</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libevent_pthreads-2.0.so.5 (libc6,x86-64) =&gt; /usr/local/lib/libevent_pthreads-2.0.so.5</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libevent_openssl-2.0.so.5 (libc6,x86-64) =&gt; /usr/local/lib/libevent_openssl-2.0.so.5</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libevent_extra-2.0.so.5 (libc6,x86-64) =&gt; /usr/local/lib/libevent_extra-2.0.so.5</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libevent_core-2.0.so.5 (libc6,x86-64) =&gt; /usr/local/lib/libevent_core-2.0.so.5</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libevent-2.0.so.5 (libc6,x86-64) =&gt; /usr/local/lib/libevent-2.0.so.5</font></div><p></p></pre></div><div><br></div><div>接下来要安装memcached :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >wget http://memcached.googlecode.com/files/memcached-1.4.15.tar.gz</font></div><div><font size="2"  >tar -zxvf memcached-1.4.15.tar.gz</font></div><div><font size="2"  >cd memcached-1.4.15</font></div><div><font size="2"  >./configure --help</font></div><div><font size="2"  >./configure --prefix=/opt/memcached-1.4.15 --enable-sasl --enable-64bit</font></div><div><font size="2"  >make</font></div><div><font size="2"  >make install</font></div><div><font size="2"  >cd /opt/memcached-1.4.15/share/man/man1</font></div><div><font size="2"  >man ./memcached.1</font></div><p></p></pre></div><div><br></div><div>接下来安装libmemcached (找一个合适的版本, 例如CentOS 5.7 用到的是 libmemcached-0.48 ) :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >wget http://download.tangent.org/libmemcached-0.48.tar.gz</font></div><div><font size="2"  >tar -zxvf libmemcached-0.48.tar.gz</font></div><div><font size="2"  >cd libmemcached-0.48</font></div><div><font size="2"  >./configure --prefix=/opt/libmemcached-0.48 --with-memcached=/opt/memcached-1.4.15/bin/memcached</font></div><div><font size="2"  >make</font></div><div><font size="2"  >make install</font></div><p></p></pre></div><div><br></div><div>修改动态库配置文件, 并使之生效 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >vi /etc/ld.so.conf</font></div><div><font size="2"  >/opt/libmemcached-0.48/lib</font></div><div><font size="2"  >ldconfig</font></div><p></p></pre></div><div>查看新增的动态库<span style="line-height: 22px;"  >是否生效</span>&nbsp;:&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >ldconfig -p|grep libmemcache</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libmemcachedutil.so.1 (libc6,x86-64) =&gt; /opt/libmemcached-0.48/lib/libmemcachedutil.so.1</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libmemcachedutil.so (libc6,x86-64) =&gt; /opt/libmemcached-0.48/lib/libmemcachedutil.so</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libmemcachedprotocol.so.0 (libc6,x86-64) =&gt; /opt/libmemcached-0.48/lib/libmemcachedprotocol.so.0</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libmemcachedprotocol.so (libc6,x86-64) =&gt; /opt/libmemcached-0.48/lib/libmemcachedprotocol.so</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libmemcached.so.6 (libc6,x86-64) =&gt; /opt/libmemcached-0.48/lib/libmemcached.so.6</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libmemcached.so (libc6,x86-64) =&gt; /opt/libmemcached-0.48/lib/libmemcached.so</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libhashkit.so.0 (libc6,x86-64) =&gt; /opt/libmemcached-0.48/lib/libhashkit.so.0</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; libhashkit.so (libc6,x86-64) =&gt; /opt/libmemcached-0.48/lib/libhashkit.so</font></div><p></p></pre></div><div><br></div><div>最后要安装pgmemcache_2.0.6.tar.bz2</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >wget http://pgfoundry.org/frs/download.php/3018/pgmemcache_2.0.6.tar.bz2</font></div><div><font size="2"  >tar -jxvf pgmemcache_2.0.6.tar.bz2</font></div><div><font size="2"  >cd pgmemcache</font></div><p></p></pre></div><div>需要用到pg_config, 所以需要加入到PATH中.</div><div><pre class="prettyprint"  ><p><font size="2"  >. /home/pg9.2.0/.bash_profile</font></p></pre></div><div><br></div><div>pgmemcache的头文件中包含了libmemcached的一些头, 如下, 所以需要将这些头文件拷贝到pgmemcache的目录中来.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >less pgmemcache.h</font></div><div><font size="2"  >#include &lt;libmemcached/sasl.h&gt;</font></div><div><font size="2"  >#include &lt;libmemcached/memcached.h&gt;</font></div><div><font size="2"  >#include &lt;libmemcached/server.h&gt;</font></div><div><font size="2"  >#include &lt;sasl/sasl.h&gt;</font></div><p></p></pre></div><div><br></div><div>拷贝这些头文件到本地目录中,&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >cp -r /opt/libmemcached-0.48/include/libhashkit ./</font></div><div><font size="2"  >cp -r /opt/libmemcached-0.48/include/libmemcached ./</font></div><p></p></pre></div><div><br></div><div>同时编译时需要用到libmemcached.so, 如下Makefile :</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >less Makefile</font></div><div><font size="2"  >SHLIB_LINK = -lmemcached -lsasl2</font></div><p></p></pre></div><div><br></div><div>但是没有指定库目录, 所以需要修改一下</div><div><div style="line-height: 22px;"  ><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><font size="2"  >vi Makefile</font></div><div style="line-height: 22px;"  ><font size="2"  >SHLIB_LINK = -L/opt/libmemcached-0.48/lib -lmemcached -lsasl2</font></div><p></p></pre></div></div><div><br></div><div>接下来编译安装就可以了.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >gmake</font></div><div><font size="2"  >gmake install</font></div><p></p></pre></div><div><br></div><div>安装好pgmemcache后, 需要做的是修改PostgreSQL的配置文件以及重启数据库, 在需要用到pgmemcache函数的数据库中执行pgmemcache.sql.</div><div>这里假设172.16.3.150上已经启动了memcached.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >su - pg9.2.0</font></div><div><font size="2"  >cd $PGDATA</font></div><div><font size="2"  >vi postgresql.conf</font></div><div><font size="2"  >shared_preload_libraries = 'pgmemcache'</font></div><div><font size="2"  >pgmemcache.default_servers = '172.16.3.150:11211' &nbsp;#多个memcached可以用逗号隔开配置.</font></div><div><font size="2"  >pgmemcache.default_behavior = 'BINARY_PROTOCOL:1' &nbsp;<span style="line-height: 22px;"  >#多个配置可以用逗号隔开配置.&nbsp;</span></font></div><p></p></pre></div><div><br></div><div>重启数据库 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="1"  >pg_ctl stop -m fast</font></div><div><font size="1"  >pg_ctl start</font></div></pre></div><div>在加载pgmemcache.sql前, 需要对这个脚本修改一下, 否则会报语法错误.</div><div><pre class="prettyprint"  ><p></p><div><font size="1"  >cd $PGHOME/share/contrib</font></div><div><font size="1"  >vi pgmemcache.sql</font></div><div><font size="1"  >:%s/LANGUAGE\ 'C'/LANGUAGE\ C/g</font></div><div><font size="1"  >:x!</font></div><p></p></pre></div><div><br></div><div>在需要的库中执行脚本 :&nbsp;</div><div><pre class="prettyprint"  ><p><font size="2"  >psql -h 127.0.0.1 -U postgres digoal -f ./pgmemcache.sql</font></p></pre></div></div><div><br></div><div>好了简单的测试一下pgmemcache的函数 :&nbsp;</div><div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; select memcache_set('key1', '1');</font></div><div><font size="2"  >&nbsp;memcache_set&nbsp;</font></div><div><font size="2"  >--------------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >digoal=&gt; select memcache_get('key1');</font></div><div><font size="2"  >&nbsp;memcache_get&nbsp;</font></div><div><font size="2"  >--------------</font></div><div><font size="2"  >&nbsp;1</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >digoal=&gt; select memcache_incr('key1',99);</font></div><div><font size="2"  >&nbsp;memcache_incr&nbsp;</font></div><div><font size="2"  >---------------</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >digoal=&gt; select memcache_incr('key1',99);</font></div><div><font size="2"  >&nbsp;memcache_incr&nbsp;</font></div><div><font size="2"  >---------------</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;199</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >digoal=&gt; select memcache_stats();</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; memcache_stats &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >------------------------------</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;Server: 172.16.3.150 (11211)+</font></div><div><font size="2"  >&nbsp;pid: 1918 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;uptime: 13140 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;time: 1353222576 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;version: 1.4.15 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;pointer_size: 64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;rusage_user: 0.999 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;rusage_system: 0.1999 &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;curr_items: 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;total_items: 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;bytes: 72 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;curr_connections: 6 &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;total_connections: 10 &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;connection_structures: 7 &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;cmd_get: 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;cmd_set: 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;get_hits: 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;get_misses: 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;evictions: 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;bytes_read: 207 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;bytes_written: 3196 &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;limit_maxbytes: 67108864 &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;threads: 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  >digoal=&gt; select memcache_flush_all();</font></div><div><font size="2"  >&nbsp;memcache_flush_all&nbsp;</font></div><div><font size="2"  >--------------------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >digoal=&gt; select memcache_get('key1');</font></div><div><font size="2"  >&nbsp;memcache_get&nbsp;</font></div><div><font size="2"  >--------------</font></div><div><font size="2"  >&nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >digoal=&gt; select memcache_stats();</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; memcache_stats &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"  >------------------------------</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;Server: 172.16.3.150 (11211)+</font></div><div><font size="2"  >&nbsp;pid: 1918 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;uptime: 13165 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;time: 1353222601 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;version: 1.4.15 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;pointer_size: 64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;rusage_user: 0.999 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;rusage_system: 0.1999 &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;curr_items: 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;total_items: 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;bytes: 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;curr_connections: 6 &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;total_connections: 11 &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;connection_structures: 7 &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;cmd_get: 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;cmd_set: 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;get_hits: 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;get_misses: 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;evictions: 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;bytes_read: 276 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;bytes_written: 4278 &nbsp; &nbsp; &nbsp; &nbsp; +</font></div><div><font size="2"  >&nbsp;limit_maxbytes: 67108864 &nbsp; &nbsp;+</font></div><div><font size="2"  >&nbsp;threads: 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+</font></div><p></p></pre></div><div>【cache应用场景举例】</div><div>1. 测试表</div><div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; create table tbl_user_info (userid int8 primary key, pwd text);</font></div><div><font size="2"  >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "tbl_user_info_pkey" for table "tbl_user_info"</font></div><div><font size="2"  >CREATE TABLE</font></div><p></p></pre></div><div>2. 测试数据</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; insert into tbl_user_info select generate_series(1,10000000), md5(clock_timestamp()::text);</font></div><div><font size="2"  >INSERT 0 10000000</font></div><p></p></pre></div><div>3. 更新触发器(不安全)</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >CREATE OR REPLACE FUNCTION tbl_user_info_upd() RETURNS TRIGGER AS $$</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; BEGIN</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; IF OLD.pwd != NEW.pwd THEN</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PERFORM memcache_set('tbl_user_info_' || NEW.userid || '_pwd', NEW.pwd);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; END IF;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; RETURN NEW;</font></div><div><font size="2"  >END;</font></div><div><font size="2"  >$$ LANGUAGE 'plpgsql';</font></div><div><font size="2"  >CREATE TRIGGER tbl_user_info_upd AFTER UPDATE ON tbl_user_info FOR EACH ROW EXECUTE PROCEDURE tbl_user_info_upd();</font></div><p></p></pre></div><div><span style="line-height: 22px;"  >3. 插入触发器(不安全)</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >CREATE OR REPLACE FUNCTION tbl_user_info_ins() RETURNS TRIGGER AS $$</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; BEGIN</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; PERFORM memcache_set('tbl_user_info_' || NEW.userid || '_pwd', NEW.pwd);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; RETURN NEW;</font></div><div><font size="2"  >END;</font></div><div><font size="2"  >$$ LANGUAGE 'plpgsql';</font></div><div><font size="2"  >CREATE TRIGGER tbl_user_info_ins AFTER INSERT ON tbl_user_info FOR EACH ROW EXECUTE PROCEDURE tbl_user_info_ins();</font></div><p></p></pre></div><div>4. 删除触发器(安全, 因为无法命中cache是安全的, 但是cache数据和table数据不一致是不安全的)</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >CREATE OR REPLACE FUNCTION tbl_user_info_del() RETURNS TRIGGER AS $$</font></div><div><font size="2"  >BEGIN</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; PERFORM memcache_delete('tbl_user_info_' || NEW.userid || '_pwd');</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; RETURN OLD;</font></div><div><font size="2"  >END;</font></div><div><font size="2"  >$$ LANGUAGE 'plpgsql';</font></div><div><font size="2"  >CREATE TRIGGER tbl_user_info_del AFTER DELETE ON tbl_user_info FOR EACH ROW EXECUTE PROCEDURE tbl_user_info_del();</font></div><p></p></pre></div><div>5. 密码匹配函数 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >CREATE OR REPLACE FUNCTION auth (i_userid int8, i_pwd text) returns boolean as $$</font></div><div><font size="2"  >declare</font></div><div><font size="2"  >&nbsp; v_input_pwd_md5 text;</font></div><div><font size="2"  >&nbsp; v_user_pwd_md5 text;</font></div><div><font size="2"  >begin</font></div><div><font size="2"  >&nbsp; v_input_pwd_md5 := md5(i_pwd);</font></div><div><font size="2"  >&nbsp; select memcache_get('tbl_user_info_' || i_userid || '_pwd') into v_user_pwd_md5;</font></div><div><font size="2"  >&nbsp; if (v_user_pwd_md5 &lt;&gt; '' ) then</font></div><div><font size="2"  >&nbsp; &nbsp; raise notice 'hit in memcache.';</font></div><div><font size="2"  >&nbsp; &nbsp; if (v_input_pwd_md5 = v_user_pwd_md5) then</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; return true;</font></div><div><font size="2"  >&nbsp; &nbsp; else</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; return false;</font></div><div><font size="2"  >&nbsp; &nbsp; end if;</font></div><div><font size="2"  >&nbsp; else</font></div><div><font size="2"  >&nbsp; &nbsp; select pwd into v_user_pwd_md5 from tbl_user_info where userid=i_userid;</font></div><div><font size="2"  >&nbsp; &nbsp; if found then</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; raise notice 'hit in table.';</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; if (v_input_pwd_md5 = v_user_pwd_md5) then</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; return true;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; else</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; return false;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; end if;</font></div><div><font size="2"  >&nbsp; &nbsp; else</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; return false;</font></div><div><font size="2"  >&nbsp; &nbsp; end if;</font></div><div><font size="2"  >&nbsp; end if;</font></div><div><font size="2"  >exception</font></div><div><font size="2"  >when others then</font></div><div><font size="2"  >&nbsp; return false;</font></div><div><font size="2"  >end;</font></div><div><font size="2"  >$$ language plpgsql;</font></div><p></p></pre></div><div><br></div><div>6. 再次插入测试数据, 并且手动退出请求. 这样将导致PG回滚这条SQL, 但是memcache已经被操作了.&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; insert into tbl_user_info select generate_series(10000001,11000001), md5(clock_timestamp()::text);</font></div><div><font size="2"  >Cancel request sent</font></div><div><font size="2"  >ERROR: &nbsp;canceling statement due to user request</font></div><div><font size="2"  >CONTEXT: &nbsp;SQL statement "SELECT memcache_set('tbl_user_info_' || NEW.userid || '_pwd', NEW.pwd)"</font></div><div><font size="2"  >PL/pgSQL function tbl_user_info_ins() line 3 at PERFORM</font></div><p></p></pre></div><div><br></div><div>不要以为memcache也回滚了, 因为memcache启动时没有启用-M, 超出后将<span style="line-height: 22px;"  >removing items&nbsp;</span>, 所以我们查询这些KEY都不存在.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >-M &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return error on memory exhausted (rather than removing items)</font></div><div><div style="line-height: 22px;"  ><font size="2"  >digoal=&gt; select count(*) from tbl_user_info ;</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; count &nbsp;&nbsp;</font></div><div style="line-height: 22px;"  ><font size="2"  >----------</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp;10000001</font></div><div style="line-height: 22px;"  ><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div style="line-height: 22px;"  >这些KEY查不到数据, 不是因为memcache的操作回滚了, 而是发生了<span style="line-height: 22px;"  >removing items</span>&nbsp;的情况, 如上所述.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; select memcache_get('tbl_user_info_10000001_pwd');</font></div><div><font size="2"  >&nbsp;memcache_get&nbsp;</font></div><div><font size="2"  >--------------</font></div><div><font size="2"  >&nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=&gt; select memcache_get('tbl_user_info_10000002_pwd');</font></div><div><font size="2"  >&nbsp;memcache_get&nbsp;</font></div><div><font size="2"  >--------------</font></div><div><font size="2"  >&nbsp;</font></div><div><font size="2"  >(1 row)</font></div><div></div><p></p></pre></div><div><span style="line-height: 22px;"  >重启memcache, 并限制8MB的内存和开启-M.</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 ~]# ps -ewf|grep memcache</font></div><div><font size="2"  >pg9.2.0 &nbsp; 1918 &nbsp; &nbsp; 1 &nbsp;0 Nov18 ? &nbsp; &nbsp; &nbsp; &nbsp;00:01:06 ./memcached -d -u pg9.2.0</font></div><div><font size="2"  >root &nbsp; &nbsp; 20612 20581 &nbsp;0 08:43 pts/7 &nbsp; &nbsp;00:00:00 grep memcache</font></div><div><font size="2"  >[root@db-172-16-3-150 ~]# kill 1918</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >[root@db-172-16-3-150 bin]# ./memcached -d -u pg9.2.0 -M -m 8</font></div><p></p></pre></div><div>再次插入时, 内存使用完就开始报warning了, 但是SQL语句照常执行, 并没有回滚掉. 所以说是不安全的.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; insert into tbl_user_info select generate_series(10000001,11000001), md5(clock_timestamp()::text);</font></div><div><font size="2"  >WARNING: &nbsp;MEMORY ALLOCATION FAILURE</font></div><div><font size="2"  >CONTEXT: &nbsp;SQL statement "SELECT memcache_set('tbl_user_info_' || NEW.userid || '_pwd', NEW.pwd)"</font></div><div><font size="2"  >PL/pgSQL function tbl_user_info_ins() line 3 at PERFORM</font></div><p></p></pre></div><div>手工的CACNEL SQL请求, 这时PG将发生回滚, 但是这里注意memcache的数据已经写入了.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >ERROR: &nbsp;canceling statement due to user request</font></div><div><font size="2"  >CONTEXT: &nbsp;SQL statement "SELECT memcache_set('tbl_user_info_' || NEW.userid || '_pwd', NEW.pwd)"</font></div><div><font size="2"  >PL/pgSQL function tbl_user_info_ins() line 3 at PERFORM</font></div><p></p></pre></div><div><span style="line-height: 22px;"  >从这里看, memcache的数据已经写入了.</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; select memcache_get('tbl_user_info_10000001_pwd');</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;memcache_get &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >----------------------------------</font></div><div><font size="2"  >&nbsp;07e975fb5fc9a308760cb7711681635b</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div></div><div><br></div><div>【小结】</div></div><div>1. memcache可以选择是否编译64位版本.</div><div><pre class="prettyprint"  ><p><font size="2"  >&nbsp; &nbsp;&nbsp;--enable-64bit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;build 64bit version</font></p></pre></div><div>&nbsp; &nbsp; 64bit 对应pointer_size : 64, 所以将占用更多的空间. 如果没有超过20亿的key, 使用32位就够了.</div><div>2. 事务安全性</div><div>&nbsp; &nbsp; memcache_get是安全的.</div><div>&nbsp; &nbsp; 但是memcache_set, replace在事务中是不安全的. 因为事务回滚时, 这些函数不会回滚. 也就是说对memcache的更改无法回滚.</div><div>&nbsp; &nbsp; 在trigger function写exception就可以解决了么?</div><div>&nbsp; &nbsp; 例如:</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >CREATE OR REPLACE FUNCTION tbl_user_info_ins() RETURNS TRIGGER AS $$</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; BEGIN</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; PERFORM memcache_set('tbl_user_info_' || NEW.userid || '_pwd', NEW.pwd);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; RETURN NEW;</font></div><div><font size="2"  >EXCEPTION when others then</font></div><div><font size="2"  >&nbsp; PERFORM memcache_delete('tbl_user_info_' || NEW.userid || '_pwd');</font></div><div><font size="2"  >END;</font></div><div><font size="2"  >$$ LANGUAGE 'plpgsql';</font></div></pre></div><div>&nbsp; &nbsp; 经过测试只对第一条tuple有效.</div><div>3. 除了pgmemcache以外, pgredis也是类似的项目, 只不过是redis的一些封装好的API.</div><div>&nbsp; &nbsp; 参考:&nbsp;<a target="_blank" rel="nofollow" href="https://github.com/siavashg/pgredis"  >https://github.com/siavashg/pgredis</a></div><div><br></div><div>【参考】</div></div><div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://docs.libmemcached.org"  >http://docs.libmemcached.org</a></div><div>2.&nbsp;<a target="_blank" rel="nofollow" href="http://memcached.org/"  >http://memcached.org/</a></div><div>3.&nbsp;<a target="_blank" rel="nofollow" href="http://download.tangent.org/"  >http://download.tangent.org/</a></div><div>4.&nbsp;<a target="_blank" rel="nofollow" href="http://pgfoundry.org/frs/?group_id=1000052"  >http://pgfoundry.org/frs/?group_id=1000052</a></div><div>5.&nbsp;<a target="_blank" rel="nofollow" href="http://libmemcached.org/"  >http://libmemcached.org/</a></div><div>6.&nbsp;<a target="_blank" rel="nofollow" href="http://www.monkey.org/~provos/libevent/"  >http://www.monkey.org/~provos/libevent/</a></div><div>7.&nbsp;<a target="_blank" rel="nofollow" href="http://code.google.com/p/memcached/wiki/Clients"  >http://code.google.com/p/memcached/wiki/Clients</a></div><div>8.&nbsp;<a target="_blank" rel="nofollow" href="http://libevent.org/"  >http://libevent.org/</a><br><wbr><div>9. pgmemcache functions :&nbsp;</div></div><div><pre class="prettyprint"  ><p></p><div><div><span style="font-size: small;"  >-- $1 = server hostname - TEXT</span></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_server_add(TEXT) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_server_add' LANGUAGE C STRICT;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- $1 = key - TEXT</font></div><div><font size="2"  >-- $2 = val - TEXT (opt)</font></div><div><font size="2"  >-- $3 = expire - INTERVAL or TIMESTAMPTZ (opt)</font></div><div><font size="2"  >-- $4 = flags - INT4 (opt)</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_add(TEXT, TEXT, INTERVAL) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_add' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_add(TEXT, TEXT, TIMESTAMPTZ) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_add_absexpire' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_add(TEXT, TEXT) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_add' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_get(TEXT) RETURNS TEXT</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_get' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_get(BYTEA) RETURNS TEXT</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_get' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_get_multi(IN TEXT[], OUT key TEXT, OUT value TEXT) RETURNS SETOF record</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_get_multi' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_get_multi(IN BYTEA[], OUT key TEXT, OUT value TEXT) RETURNS SETOF record</font></div></div><div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_get_multi' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- $1 = key - TEXT</font></div><div><font size="2"  >-- $2 = decrement - INT4, default 1 (opt)</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_decr(TEXT, INT4) RETURNS INT4</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_decr' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_decr(TEXT) RETURNS INT4</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_decr' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- $1 = key - TEXT</font></div><div><font size="2"  >-- $2 = increment - INT4, default 1 (opt)</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_incr(TEXT, INT4) RETURNS INT4</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_incr' LANGUAGE C STRICT;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_incr(TEXT) RETURNS INT4</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_incr' LANGUAGE C STRICT;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- $1 = key - TEXT</font></div><div><font size="2"  >-- $2 = hold timer - INTERVAL (opt)</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_delete(TEXT, INTERVAL) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_delete' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_delete(TEXT) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_delete' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- Flush all servers in the cluster</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_flush_all() RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_flush_all0' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- $1 = key - TEXT</font></div><div><font size="2"  >-- $2 = val - TEXT</font></div><div><font size="2"  >-- $3 = expire - INTERVAL or TIMESTAMPTZ (opt)</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_replace(TEXT, TEXT, INTERVAL) RETURNS BOOL</font></div></div><div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_replace' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_replace(TEXT, TEXT, TIMESTAMPTZ) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_replace_absexpire' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_replace(TEXT, TEXT) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_replace' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- $1 = key - TEXT</font></div><div><font size="2"  >-- $2 = val - TEXT</font></div><div><font size="2"  >-- $3 = expire - INTERVAL or TIMESTAMPTZ (opt)</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_set(TEXT, TEXT, INTERVAL) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_set' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_set(TEXT, TEXT, TIMESTAMPTZ) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_set_absexpire' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_set(TEXT, TEXT) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_set' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_set(BYTEA, TEXT) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_set' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_set(TEXT, BYTEA) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_set' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- $1 = key - TEXT</font></div><div><font size="2"  >-- $2 = val - TEXT</font></div><div><font size="2"  >-- $3 = expire - INTERVAL or TIMESTAMPTZ (opt)</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_prepend(TEXT, TEXT, INTERVAL) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_prepend' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_prepend(TEXT, TEXT, TIMESTAMPTZ) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_prepend_absexpire' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_prepend(TEXT, TEXT) RETURNS BOOLAS '$libdir/pgmemcache', 'memcache_prepend' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- $1 = key - TEXT</font></div><div><font size="2"  >-- $2 = val - TEXT</font></div><div><font size="2"  >-- $3 = expire - INTERVAL or TIMESTAMPTZ (opt)</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_append(TEXT, TEXT, INTERVAL) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_append' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_append(TEXT, TEXT, TIMESTAMPTZ) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_append_absexpire' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_append(TEXT, TEXT) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_append' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- $1 = key - TEXT</font></div><div><font size="2"  >-- $2 = val - TEXT</font></div><div><font size="2"  >-- $3 = expire - INTERVAL or TIMESTAMPTZ (opt)</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_prepend(TEXT, TEXT, INTERVAL) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_prepend' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_prepend(TEXT, TEXT, TIMESTAMPTZ) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_prepend_absexpire' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_prepend(TEXT, TEXT) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_prepend' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >-- $1 = key - TEXT</font></div><div><font size="2"  >-- $2 = val - TEXT</font></div><div><font size="2"  >-- $3 = expire - INTERVAL or TIMESTAMPTZ (opt)</font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_append(TEXT, TEXT, INTERVAL) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_append' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_append(TEXT, TEXT, TIMESTAMPTZ) RETURNS BOOL</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_append_absexpire' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_append(TEXT, TEXT) RETURNS BOOL</font></div></div><div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_append' LANGUAGE C;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CREATE OR REPLACE FUNCTION memcache_stats() RETURNS TEXT</font></div><div><font size="2"  >AS '$libdir/pgmemcache', 'memcache_stats' LANGUAGE C;</font></div></div><p></p></pre></div></div>
	</div>
</div>
</body>
</html>