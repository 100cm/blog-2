<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">explain SMART Attributes</h2>
	<h5 id="">2012-11-30 16:18:18&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201210302359684/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>前一篇BLOG讲了一下smartmontools 工具的使用.</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020121028103934749/"  >http://blog.163.com/digoal@126/blog/static/16387704020121028103934749/</a></div><div>smartmontools的数据库在不断的更新, 如果你的硬盘还没有加入到smartmontools 的 drivedb.h数据库中, 那就再等等吧.</div><div>已经加入到这里的, 也不要欣喜若狂, 读取到的SMART Attributes你都读懂了么?</div><div>SMART Attributes的定义是硬盘厂商提供的, 没有一个统一的标准, 所以比较痛苦.</div><div>下面以OCZ PCI-E RevoDrive3为例, 来看看SMART Attribute的意思 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  ><span style="line-height: 19px;"  >[root@db-172-16-3-150 postgresql-9.2.1]# /opt/smartmontools-6.0/sbin/smartctl -A -f brief /dev/sdd<br>smartctl 6.0 2012-10-10 r3643 [x86_64-linux-2.6.18-274.el5] (local build)<br>Copyright (C) 2002-12, Bruce Allen, Christian Franke, www.smartmontools.org<br><br>=== START OF READ SMART DATA SECTION ===<br>SMART Attributes Data Structure revision number: 10<br>Vendor Specific SMART Attributes with Thresholds:<br>ID# ATTRIBUTE_NAME          FLAGS    VALUE WORST THRESH FAIL RAW_VALUE<br>  1 Raw_Read_Error_Rate     POSR--   089   089   050    -    0/113484753<br>  5 Retired_Block_Count     PO--CK   100   100   003    -    0<br>  9 Power_On_Hours_and_Msec -O--CK   100   100   000    -    170h+08m+29.325s<br> 12 Power_Cycle_Count       -O--CK   100   100   000    -    8<br>171 Program_Fail_Count      -O--CK   000   000   000    -    0<br>172 Erase_Fail_Count        -O--CK   000   000   000    -    0<br>174 Unexpect_Power_Loss_Ct  ----CK   000   000   000    -    7<br>177 Wear_Range_Delta        ------   000   000   000    -    2<br>181 Program_Fail_Count      -O--CK   000   000   000    -    0<br>182 Erase_Fail_Count        -O--CK   000   000   000    -    0<br>187 Reported_Uncorrect      -O--CK   100   100   000    -    0<br>194 Temperature_Celsius     -O---K   030   030   000    -    30 (Min/Max 30/30)<br>195 ECC_Uncorr_Error_Count  --SRC-   120   120   000    -    0/113484753<br>196 Reallocated_Event_Count PO--CK   100   100   003    -    0<br>201 Unc_Soft_Read_Err_Rate  --SRC-   120   120   000    -    0/113484753<br>204 Soft_ECC_Correct_Rate   --SRC-   120   120   000    -    0/113484753<br>230 Life_Curve_Status       PO--C-   100   100   000    -    100<br>231 SSD_Life_Left           PO--C-   100   100   010    -    0<br>233 SandForce_Internal      ------   000   000   000    -    0<br>234 SandForce_Internal      ------   000   000   000    -    0<br>241 Lifetime_Writes_GiB     -O--CK   000   000   000    -    44814<br>242 Lifetime_Reads_GiB      -O--CK   000   000   000    -    363<br>                            ||||||_ K auto-keep<br>                            |||||__ C event count<br>                            ||||___ R error rate<br>                            |||____ S speed/performance<br>                            ||_____ O updated online<br>                            |______ P prefailure warning</span></font></div><p></p></pre></div><div>解释一下每个属性的意思 :&nbsp;</div><div>请参看smartctl的帮助文件 -A 部分 :&nbsp;</div><div>ID# : &nbsp;属性ID, 从1到255.</div><div>ATTRIBUTE_NAME : 属性名.</div><div>FLAG : 表示这个属性携带的标记. 使用-f brief可以打印.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||||||_ K auto-keep</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |||||__ C event count</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||||___ R error rate</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |||____ S speed/performance</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||_____ O updated online</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |______ P prefailure warning</font></div><p></p></pre></div><div>VALUE : Normalized value, 取值范围1到254. 越低表示越差. 越高表示越好. (with 1 representing the worst case and 254 representing the best)</div><div>注意wiki上说的是1到253. 这个值是硬盘厂商根据RAW_VALUE转换来的, smartmontools工具不负责转换工作.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >Each &nbsp;Attribute &nbsp;has &nbsp;a &nbsp;"Raw" &nbsp;value, &nbsp;printed &nbsp;under the heading "RAW_VALUE", and a "Normalized" value printed under the heading "VALUE". &nbsp;</font></div><div><font size="2"  >[Note: smartctl prints these values in &nbsp;base-10.] &nbsp; In &nbsp;the &nbsp;example just &nbsp;given, the "Raw Value" for Attribute 12 would be the actual number of times that the disk has been power-cycled, for example 365 if the disk has been turned on once per day for exactly &nbsp;one &nbsp;year.</font></div><div><font size="2"  >Each vendor &nbsp;uses their own algorithm to convert this "Raw" value to a "Normalized" value in the range from 1 to 254. &nbsp;</font></div><div><font size="2"  >Please keep in mind that smartctl only reports &nbsp;the &nbsp;different &nbsp;Attribute &nbsp;types, &nbsp;values, &nbsp;andthresholds as read from the device. &nbsp;</font></div><div><font size="2"  >It does not carry out the conversion between "Raw" and "Normalized values: this is done by the disk's firmware.</font></div><div><font size="2"  >The conversion from Raw value to a quantity with physical units is not specified by the SMART &nbsp;standard.</font></div><div><font size="2"  >In &nbsp;most cases, the values printed by smartctl are sensible. &nbsp;</font></div><div><font size="2"  >For example the temperature Attribute generally has its raw value equal to the temperature in Celsius. &nbsp;However in some cases vendors use unusual conventions. &nbsp;&nbsp;</font></div><div><font size="2"  >For &nbsp;example &nbsp;the &nbsp;Hitachi &nbsp;disk &nbsp;on my laptop reports its power-on hours in minutes, not hours.&nbsp;</font></div><div><font size="2"  >Some IBM disks track three temperatures rather than one, in their raw values. &nbsp;And so on.</font></div><p></p></pre></div><div>WORST : 表示SMART开启以来的, 所有Normalized values的最低值. (which represents the lowest recorded normalized value.)</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Each Attribute also has a "Worst" value shown under the heading "WORST". &nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; This is the smallest &nbsp;(closest to &nbsp;failure) &nbsp;value &nbsp;that &nbsp;the disk has recorded at any time during its lifetime when SMART was enabled.</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [Note however that some vendors firmware may actually increase the "Worst" value &nbsp;for &nbsp;some &nbsp;"rate-type" Attributes.]</font></div><p></p></pre></div><div>THRESH : 阈值, 当Normalized value小于等于THRESH值时, 表示这项指标已经failed了.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Each Attribute also has a Threshold value (whose range is 0 to 255) which is printed under &nbsp;the &nbsp;heading "THRESH". &nbsp;&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If &nbsp;the Normalized value is less than or equal to the Threshold value, then the Attribute is said to have failed. &nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If the Attribute is a pre-failure Attribute, then disk failure is imminent.</font></div><p></p></pre></div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;注意这里提到, 如果这个属性是pre-failure的, 那么这项如果出现Normalized value&lt;=THRESH, 那么磁盘将马上failed掉.</div><div>TYPE : 这里存在两种TYPE类型, Pre-failed和Old_age.&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Pre-failed 类型的Normalized value可以用来预先知道磁盘是否要坏了. 例如Normalized value接近THRESH时, 就赶紧换硬盘吧.</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Old_age 类型的Normalized value是指正常的使用损耗值, 当Normalized value 接近THRESH时, 也需要注意, 但是比Pre-failed要好一点.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The &nbsp;Attribute &nbsp;table printed out by smartctl also shows the "TYPE" of the Attribute.&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Attributes are one of two possible types: Pre-failure or Old age. &nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Pre-failure Attributes are ones which, if Normalized value less &nbsp;than &nbsp;or equal &nbsp;to their threshold values, indicate pending disk failure.</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Old age, or usage Attributes, are ones which indicate end-of-product life from old-age or normal aging and wearout, if the Attribute's&nbsp;<span style="line-height: 22px;"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="line-height: 22px;"  >&nbsp; &nbsp;</span>Normalized value is less than or equal to the threshold.</font></div><div><font size="2"  ><span style="line-height: 22px;"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="line-height: 22px;"  >&nbsp;</span>Please note: the fact that an Attribute is of type ’Pre-fail’ does not mean that your disk is about to fail! &nbsp;</font></div><div><font size="2"  ><span style="line-height: 22px;"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="line-height: 22px;"  >&nbsp;</span>It only has this meaning if the Attribute′s &nbsp;current &nbsp;Normalized value is less than or equal to the threshold value.</font></div><p></p></pre></div><div>UPDATED : 这个字段表示这个属性的值在什么情况下会被更新. 一种是通常的操作和离线测试都更新(Always), 另一种是只在离线测试的情况下更新(Offline).</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The &nbsp;table &nbsp;column &nbsp;labeled "UPDATED" shows if the SMART Attribute values are updated during both normal operation and off-line testing, or only during offline testing. &nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The former are labeled "Always" and the latter are labeled "Offline".</font></div><p></p></pre></div><div>WHEN_FAILED : 这个字段表示当前这个属性的状态 : failing_now(normalized_value &lt;= THRESH), 或者in_the_past(WORST &lt;= THRESH), 或者 - , 正常(normalized_value以及wrost &gt;= THRESH).</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If &nbsp;the &nbsp;Attribute's &nbsp;current &nbsp;Normalized &nbsp;value &nbsp;is less than or equal to the threshold value, then the "WHEN_FAILED" column will display "FAILING_NOW".&nbsp;</font></div><div><font size="2"  ><span style="line-height: 22px;"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="line-height: 22px;"  >&nbsp;</span>If not, but the worst recorded value is &nbsp;less &nbsp;than &nbsp;or equal &nbsp;to the threshold value, then this column will display "In_the_past". &nbsp;</font></div><div><font size="2"  ><span style="line-height: 22px;"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="line-height: 22px;"  >&nbsp;</span>If the "WHEN_FAILED" column has no entry (indicated by a dash: '-') then this Attribute is OK now (not failing) and has &nbsp;also &nbsp;never failed in the past.</font></div><p></p></pre></div><div>RAW_VALUE : 表示这个属性的未转换前的RAW值, 可能是计数, 也可能是温度, 也可能是其他的.</div><div>注意RAW_VALUE转换成Normalized value是由厂商的firmware提供的, smartmontools不提供转换.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >So &nbsp;to &nbsp;summarize: the Raw Attribute values are the ones that might have a real physical interpretation,</font></div><div><font size="2"  >such as "Temperature Celsius", "Hours", or "Start-Stop Cycles". &nbsp;</font></div><div><font size="2"  >Each manufacturer converts these, using their &nbsp;detailed &nbsp;knowledge of the disk's operations and failure modes, to Normalized Attribute values in the range 1-254. &nbsp;</font></div><div><font size="2"  >The current and worst (lowest measured) &nbsp;of &nbsp;these &nbsp;Normalized &nbsp;Attribute &nbsp;values &nbsp;are stored on the disk, along with a Threshold value that the manufacturer has determined will indicate that the disk is going to fail, or that it has exceeded its design age or aging &nbsp;limit. smartctl &nbsp;does &nbsp;not calculate &nbsp;any of the Attribute values, thresholds, or types, it merely reports them from the SMART data on the device.</font></div><p></p></pre></div><div><br></div><div>其他注意事项 :&nbsp;</div><div>1. 当SSD磁盘不在smartmontools 数据库中时, 显示的attribute name可能不准. 因为硬盘厂商可能更改了attribute id的定义.</div><div><pre class="prettyprint"  ><p><font size="2"  >Solid-state drives use different meanings for some of the attributes. &nbsp;In this case the &nbsp;attribute &nbsp;name printed by smartctl is incorrect unless the drive is already in the smartmontools drive database.</font></p></pre></div><div>2. 注意有个FLAG是KEEP, 如果不带这个FLAG的属性, 值将不会KEEP在磁盘中, 可能出现WORST值被刷新的情况, 例如这里的ID=1的值, 已经89了, 重新执行又变成91了, 但是WORST的值并不是历史以来的最低89.</div><div>遇到这种情况的解决办法是找个地方存储这些值的历史值.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 ~]# /opt/smartmontools-6.0/sbin/smartctl -A -f brief /dev/sdd</font></div><div><font size="2"  >smartctl 6.0 2012-10-10 r3643 [x86_64-linux-2.6.18-274.el5] (local build)</font></div><div><font size="2"  >Copyright (C) 2002-12, Bruce Allen, Christian Franke, www.smartmontools.org</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >=== START OF READ SMART DATA SECTION ===</font></div><div><font size="2"  >SMART Attributes Data Structure revision number: 10</font></div><div><font size="2"  >Vendor Specific SMART Attributes with Thresholds:</font></div><div><font size="2"  >ID# ATTRIBUTE_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FLAGS &nbsp; &nbsp;VALUE WORST THRESH FAIL RAW_VALUE</font></div><div><font size="2"  >&nbsp; 1 Raw_Read_Error_Rate &nbsp; &nbsp; POSR-- &nbsp; 091 &nbsp; 091 &nbsp; 050 &nbsp; &nbsp;- &nbsp; &nbsp;0/113746865</font></div><div><font size="2"  >&nbsp; 5 Retired_Block_Count &nbsp; &nbsp; PO--CK &nbsp; 100 &nbsp; 100 &nbsp; 003 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >&nbsp; 9 Power_On_Hours_and_Msec -O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;170h+43m+38.270s</font></div><div><font size="2"  >&nbsp;12 Power_Cycle_Count &nbsp; &nbsp; &nbsp; -O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;8</font></div><div><font size="2"  >171 Program_Fail_Count &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >172 Erase_Fail_Count &nbsp; &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >174 Unexpect_Power_Loss_Ct &nbsp;----CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;7</font></div><div><font size="2"  >177 Wear_Range_Delta &nbsp; &nbsp; &nbsp; &nbsp;------ &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;2</font></div><div><font size="2"  >181 Program_Fail_Count &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >182 Erase_Fail_Count &nbsp; &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >187 Reported_Uncorrect &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >194 Temperature_Celsius &nbsp; &nbsp; -O---K &nbsp; 030 &nbsp; 030 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;30 (Min/Max 30/30)</font></div><div><font size="2"  >195 ECC_Uncorr_Error_Count &nbsp;--SRC- &nbsp; 120 &nbsp; 120 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0/113746865</font></div><div><font size="2"  >196 Reallocated_Event_Count PO--CK &nbsp; 100 &nbsp; 100 &nbsp; 003 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >201 Unc_Soft_Read_Err_Rate &nbsp;--SRC- &nbsp; 120 &nbsp; 120 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0/113746865</font></div><div><font size="2"  >204 Soft_ECC_Correct_Rate &nbsp; --SRC- &nbsp; 120 &nbsp; 120 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0/113746865</font></div><div><font size="2"  >230 Life_Curve_Status &nbsp; &nbsp; &nbsp; PO--C- &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;100</font></div><div><font size="2"  >231 SSD_Life_Left &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PO--C- &nbsp; 100 &nbsp; 100 &nbsp; 010 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >233 SandForce_Internal &nbsp; &nbsp; &nbsp;------ &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >234 SandForce_Internal &nbsp; &nbsp; &nbsp;------ &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >241 Lifetime_Writes_GiB &nbsp; &nbsp; -O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;45175</font></div><div><font size="2"  >242 Lifetime_Reads_GiB &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;363</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||||||_ K auto-keep</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |||||__ C event count</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||||___ R error rate</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |||____ S speed/performance</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||_____ O updated online</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |______ P prefailure warning</font></div><p></p></pre></div><div><br></div><div>因此监控磁盘的重点在哪里呢?</div><div>严重情况从上到下 :&nbsp;</div><div>1. 最严重的情况WHEN_FAILED =&nbsp;<span style="line-height: 22px;"  >FAILING_NOW 并且 TYPE=Pre-failed, 表示现在这个属性已经出问题了. 并且硬盘也已经failed了.</span></div><div><span style="line-height: 22px;"  >2. 次严重的情况</span><span style="line-height: 22px;"  >WHEN_FAILED =&nbsp;</span><span style="line-height: 22px;"  >in_the_past 并且 TYPE=Pre-failed, 表示这个属性曾经出问题了. 但是现在是正常的.</span></div><div><span style="line-height: 22px;"  >3.&nbsp;</span><span style="line-height: 22px;"  >WHEN_FAILED =&nbsp;</span><span style="line-height: 22px;"  >FAILING_NOW 并且 TYPE=Old_age, 表示现在这个属性已经出问题了. 但是硬盘可能还没有failed.</span></div><div><span style="line-height: 22px;"  >4.&nbsp;</span><span style="line-height: 22px;"  >WHEN_FAILED =&nbsp;</span><span style="line-height: 22px;"  >in_the_past 并且 TYPE=Old_age, 表示现在这个属性曾经出问题了. 但是现在是正常的.</span></div><div><span style="line-height: 22px;"  >为了避免这4种情况的发生.</span></div><div><span style="line-height: 22px;"  >1. 对于UPDATE=Offline的属性, 应该让smartd定期进行测试(smartd还可以发邮件). 或者crontab进行测试.&nbsp;</span></div><div><span style="line-height: 22px;"  >2. 应该时刻关注磁盘的Normalized value以及WORST的值是否接近THRESH的值了. 当有值要接近THRESH了, 提前更换硬盘.</span></div><div><span style="line-height: 22px;"  >3. 温度, 有些磁盘对温度比较敏感, 例如PCI-E SSD硬盘. 如果温度过高可能就挂了. 这里读取RAW_VALUE就比较可靠了.</span></div><div><br></div><div>监控手段,&nbsp;</div><div>1. 可以写nagios插件, 通过nagios来监控.</div><div>2. smartd, 它可以发邮件告警.</div><div>3. 定期收集smart数据, 分析每个属性的Normalized value的变化趋势, 更加精确的推算出磁盘的剩余使用寿命.</div><div><br></div><div>另一块SSD硬盘的输出 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 postgresql-9.2.1]# /opt/smartmontools-6.0/sbin/smartctl -A -f brief -d sat+megaraid,2 /dev/sdb</font></div><div><font size="2"  >smartctl 6.0 2012-10-10 r3643 [x86_64-linux-2.6.18-274.el5] (local build)</font></div><div><font size="2"  >Copyright (C) 2002-12, Bruce Allen, Christian Franke, www.smartmontools.org</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >=== START OF READ SMART DATA SECTION ===</font></div><div><font size="2"  >SMART Attributes Data Structure revision number: 1</font></div><div><font size="2"  >Vendor Specific SMART Attributes with Thresholds:</font></div><div><font size="2"  >ID# ATTRIBUTE_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FLAGS &nbsp; &nbsp;VALUE WORST THRESH FAIL RAW_VALUE</font></div><div><font size="2"  >&nbsp; 1 Raw_Read_Error_Rate &nbsp; &nbsp; -O-R-K &nbsp; 001 &nbsp; 001 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;16936932</font></div><div><font size="2"  >&nbsp; 5 Reallocated_Sector_Ct &nbsp; PO--CK &nbsp; 100 &nbsp; 100 &nbsp; 001 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >&nbsp; 9 Power_On_Hours &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 094 &nbsp; 094 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;2423</font></div><div><font size="2"  >&nbsp;12 Power_Cycle_Count &nbsp; &nbsp; &nbsp; -O--CK &nbsp; 099 &nbsp; 099 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;6</font></div><div><font size="2"  >&nbsp;13 Read_Soft_Error_Rate &nbsp; &nbsp;-O-R-K &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >175 Program_Fail_Count_Chip -O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >176 Erase_Fail_Count_Chip &nbsp; -O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >177 Wear_Leveling_Count &nbsp; &nbsp; -O--CK &nbsp; 099 &nbsp; 099 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;3</font></div><div><font size="2"  >178 Used_Rsvd_Blk_Cnt_Chip &nbsp;PO--CK &nbsp; 074 &nbsp; 074 &nbsp; 001 &nbsp; &nbsp;- &nbsp; &nbsp;43</font></div><div><font size="2"  >179 Used_Rsvd_Blk_Cnt_Tot &nbsp; PO--CK &nbsp; 091 &nbsp; 091 &nbsp; 001 &nbsp; &nbsp;- &nbsp; &nbsp;895</font></div><div><font size="2"  >180 Unused_Rsvd_Blk_Cnt_Tot -O--CK &nbsp; 091 &nbsp; 091 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;9734</font></div><div><font size="2"  >181 Program_Fail_Cnt_Total &nbsp;-O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >182 Erase_Fail_Count_Total &nbsp;-O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >183 Runtime_Bad_Block &nbsp; &nbsp; &nbsp; PO--CK &nbsp; 100 &nbsp; 100 &nbsp; 001 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >194 Temperature_Celsius &nbsp; &nbsp; -O---K &nbsp; 076 &nbsp; 071 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;24 (Min/Max 22/28)</font></div><div><font size="2"  >195 Hardware_ECC_Recovered &nbsp;-O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >198 Offline_Uncorrectable &nbsp; ----CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >199 UDMA_CRC_Error_Count &nbsp; &nbsp;-O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >202 Unknown_SSD_Attribute &nbsp; PO--CK &nbsp; 100 &nbsp; 100 &nbsp; 090 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >232 Available_Reservd_Space -O--CK &nbsp; 074 &nbsp; 074 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;123</font></div><div><font size="2"  >233 Media_Wearout_Indicator -O--CK &nbsp; 054 &nbsp; 054 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;1953821162</font></div><div><font size="2"  >240 Unknown_SSD_Attribute &nbsp; -O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||||||_ K auto-keep</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |||||__ C event count</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||||___ R error rate</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |||____ S speed/performance</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||_____ O updated online</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |______ P prefailure warning</font></div><p></p></pre></div><div>简单的分析一下上面这个输出,</div><div>1.&nbsp;Raw_Read_Error_Rate 这个值已经非常接近THRESH了, 但是它只是一个正常损耗值, 不一定会带来硬盘的failed.&nbsp;</div><div>2. 需要注意ID=202的这条, THRESH=90, 当前的Normalized value=100, 也有点接近了, 并且这个属性是Pre-failed的, 所以更加要注意它的变化.</div><div><br></div>【参考】<div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/Self-Monitoring%2C_Analysis%2C_and_Reporting_Technology"  >http://en.wikipedia.org/wiki/Self-Monitoring%2C_Analysis%2C_and_Reporting_Technology</a></div><div>2.&nbsp;<a target="_blank" rel="nofollow" href="http://www.ocztechnologyforum.com/forum/showthread.php?75786-SMART-Attributes-for-Sandforce-SSD-s-%28Agility2-Vertex2-VertexLE%29"  >http://www.ocztechnologyforum.com/forum/showthread.php?75786-SMART-Attributes-for-Sandforce-SSD-s-%28Agility2-Vertex2-VertexLE%29</a></div><div>3.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020121028103934749/"  >http://blog.163.com/digoal@126/blog/static/16387704020121028103934749/</a><br><br><wbr></div>【附】<div>1. (SMART Attributes define : OCZ Vertex2, Agility2, etc) :&nbsp;<div><div><img title="explain SMART Attributes - 德哥@Digoal - The Heart,The World."  alt="explain SMART Attributes - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img1.ph.126.net/9QN19Ys6c7HtppctpnfiZQ==/6597753662889103931.jpg"  ></div>&nbsp;</div><br></div>补充 :&nbsp;<div>245TB 写入后</div><div>SSD_Life_Left 的VALUE 降低到了96 .<br><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 ~]# /opt/smartmontools-6.0/sbin/smartctl -A -f brief /dev/sdd</font></div><div><font size="2"  >smartctl 6.0 2012-10-10 r3643 [x86_64-linux-2.6.18-274.el5] (local build)</font></div><div><font size="2"  >Copyright (C) 2002-12, Bruce Allen, Christian Franke, www.smartmontools.org</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >=== START OF READ SMART DATA SECTION ===</font></div><div><font size="2"  >SMART Attributes Data Structure revision number: 10</font></div><div><font size="2"  >Vendor Specific SMART Attributes with Thresholds:</font></div><div><font size="2"  >ID# ATTRIBUTE_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FLAGS &nbsp; &nbsp;VALUE WORST THRESH FAIL RAW_VALUE</font></div><div><font size="2"  >&nbsp; 1 Raw_Read_Error_Rate &nbsp; &nbsp; POSR-- &nbsp; 089 &nbsp; 089 &nbsp; 050 &nbsp; &nbsp;- &nbsp; &nbsp;0/150282048</font></div><div><font size="2"  >&nbsp; 5 Retired_Block_Count &nbsp; &nbsp; PO--CK &nbsp; 100 &nbsp; 100 &nbsp; 003 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >&nbsp; 9 Power_On_Hours_and_Msec -O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;516h+42m+05.505s</font></div><div><font size="2"  >&nbsp;12 Power_Cycle_Count &nbsp; &nbsp; &nbsp; -O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;10</font></div><div><font size="2"  >171 Program_Fail_Count &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >172 Erase_Fail_Count &nbsp; &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >174 Unexpect_Power_Loss_Ct &nbsp;----CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;9</font></div><div><font size="2"  >177 Wear_Range_Delta &nbsp; &nbsp; &nbsp; &nbsp;------ &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;9</font></div><div><font size="2"  >181 Program_Fail_Count &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >182 Erase_Fail_Count &nbsp; &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >187 Reported_Uncorrect &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >194 Temperature_Celsius &nbsp; &nbsp; -O---K &nbsp; 030 &nbsp; 030 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;30 (Min/Max 30/30)</font></div><div><font size="2"  >195 ECC_Uncorr_Error_Count &nbsp;--SRC- &nbsp; 120 &nbsp; 120 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0/150282048</font></div><div><font size="2"  >196 Reallocated_Event_Count PO--CK &nbsp; 100 &nbsp; 100 &nbsp; 003 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >201 Unc_Soft_Read_Err_Rate &nbsp;--SRC- &nbsp; 120 &nbsp; 120 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0/150282048</font></div><div><font size="2"  >204 Soft_ECC_Correct_Rate &nbsp; --SRC- &nbsp; 120 &nbsp; 120 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0/150282048</font></div><div><font size="2"  >230 Life_Curve_Status &nbsp; &nbsp; &nbsp; PO--C- &nbsp; 100 &nbsp; 100 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;100</font></div><div><font size="2"  >231 SSD_Life_Left &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PO--C- &nbsp; 096 &nbsp; 096 &nbsp; 010 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >233 SandForce_Internal &nbsp; &nbsp; &nbsp;------ &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >234 SandForce_Internal &nbsp; &nbsp; &nbsp;------ &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;0</font></div><div><font size="2"  >241 Lifetime_Writes_GiB &nbsp; &nbsp; -O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;245127</font></div><div><font size="2"  >242 Lifetime_Reads_GiB &nbsp; &nbsp; &nbsp;-O--CK &nbsp; 000 &nbsp; 000 &nbsp; 000 &nbsp; &nbsp;- &nbsp; &nbsp;6946</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||||||_ K auto-keep</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |||||__ C event count</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||||___ R error rate</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |||____ S speed/performance</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||_____ O updated online</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |______ P prefailure warning</font></div><p></p></pre></div></div></div>
	</div>
</div>
</body>
</html>