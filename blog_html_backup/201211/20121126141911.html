<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">OCZ REVODRIVE3 used in CentOS 5.x x64 on DELL R610 Server's PCI-E x4</h2>
	<h5 id="">2012-11-26 14:19:11&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402012102613815282/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>在6.x中的安装请参考<a style="line-height: 28px;" target="_blank" href="http://digoal.lofter.com/post/6ced3_450adf3"   >http://digoal.lofter.com/post/6ced3_450adf3</a></div><wbr><div><br></div>前段时间在DELL R610服务器<span style="line-height: 22px;"   >pci-e插槽</span>上插了1块OCZ的SSD硬盘(价格3000多RMB, 比较实惠).<div>型号 :&nbsp;OCZ REVODRIVE3</div><div>容量 : 240 GB</div><div>因为服务器是单电源的, 两个PCI-E插槽看起来不能同时使用, 所以把另一个槽位上插的HBA卡拔掉就能使用了.</div><div>另外就是, OCZ网站上没有提供这个型号的SSD的linux驱动.</div><div>但是用Z的可以, 下载地址 :&nbsp;</div><div><a target="_blank" rel="nofollow" href="http://www.oczenterprise.com/drivers.html"   >http://www.oczenterprise.com/drivers.html</a></div><div><div><img title="OCZ REVODRIVE3 used in CentOS 5.x x64 on DELL R610 Servers PCI-E x4 - 德哥@Digoal - The Heart,The World."   alt="OCZ REVODRIVE3 used in CentOS 5.x x64 on DELL R610 Servers PCI-E x4 - 德哥@Digoal - The Heart,The World."   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/8rpmULEoObVWtnzGayaqYA==/6597239091448574710.jpg"   ></div>&nbsp;</div><div>操作系统版本:</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# cat /etc/redhat-release&nbsp;</font></div><div><font size="2"   >CentOS release 5.7 (Final)</font></div><p></p></pre></div><div>内核</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# uname -a</font></div><div><font size="2"   >Linux db-172-16-3-150.sky-mobi.com 2.6.18-274.el5 #1 SMP Fri Jul 22 04:43:29 EDT 2011 x86_64 x86_64 x86_64 GNU/Linux</font></div><p></p></pre></div><div>驱动安装如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ><span style="line-height: 19px;"   >wget http://www.oczenterprise.com/files/drivers/OCZ%20Centos_5.7_64-Bit_r1480.tar.gz</span></font></div><div><font size="2"   ><span style="line-height: 19px;"   >tar -zxvf OCZ\ Centos_5.7_64-Bit_r1480.tar.gz</span></font></div></div><div><font size="2"   >cp ocz10xx.ko /lib/modules/2.6.18-274.el5/extra/</font></div><div><div><font size="2"   >depmod -a</font></div><div><font size="2"   >modprobe ocz10xx</font></div></div><p></p></pre></div><div>接下来使用fdisk -l就能看到这块新加的硬盘了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# fdisk -l</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Disk /dev/sda: 146.1 GB, 146163105792 bytes</font></div><div><font size="2"   >255 heads, 63 sectors/track, 17769 cylinders</font></div><div><font size="2"   >Units = cylinders of 16065 * 512 = 8225280 bytes</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp;Device Boot &nbsp; &nbsp; &nbsp;Start &nbsp; &nbsp; &nbsp; &nbsp; End &nbsp; &nbsp; &nbsp;Blocks &nbsp; Id &nbsp;System</font></div><div><font size="2"   >/dev/sda1 &nbsp; * &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp;3824 &nbsp; &nbsp;30716248+ &nbsp;83 &nbsp;Linux</font></div><div><font size="2"   >/dev/sda2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3825 &nbsp; &nbsp; &nbsp; &nbsp;4868 &nbsp; &nbsp; 8385930 &nbsp; 82 &nbsp;Linux swap / Solaris</font></div><div><font size="2"   >/dev/sda3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4869 &nbsp; &nbsp; &nbsp; 17769 &nbsp; 103627282+ &nbsp;83 &nbsp;Linux</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Disk /dev/sdb: 199.4 GB, 199447543808 bytes</font></div><div><font size="2"   >255 heads, 63 sectors/track, 24248 cylinders</font></div><div><font size="2"   >Units = cylinders of 16065 * 512 = 8225280 bytes</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Disk /dev/sdb doesn't contain a valid partition table</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Disk /dev/sdd: 240.0 GB, 240068197888 bytes</font></div><div><font size="2"   >255 heads, 63 sectors/track, 29186 cylinders</font></div><div><font size="2"   >Units = cylinders of 16065 * 512 = 8225280 bytes</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Disk /dev/sdd doesn't contain a valid partition table</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Disk /dev/dm-0: 199.4 GB, 199447543808 bytes</font></div><div><font size="2"   >255 heads, 63 sectors/track, 24248 cylinders</font></div><div><font size="2"   >Units = cylinders of 16065 * 512 = 8225280 bytes</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Disk /dev/dm-0 doesn't contain a valid partition table</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Disk /dev/dm-1: 240.0 GB, 240068197888 bytes</font></div><div><font size="2"   >255 heads, 63 sectors/track, 29186 cylinders</font></div><div><font size="2"   >Units = cylinders of 16065 * 512 = 8225280 bytes</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Disk /dev/dm-1 doesn't contain a valid partition table</font></div><p></p></pre></div><div>是个多路径设备 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# multipath -ll</font></div><div><font size="2"   >mpath1 (SATA_OCZ-REVODRIVE3_OCZ-Z2134R0TLQBNE659) dm-1 ATA,OCZ-REVODRIVE3</font></div><div><font size="2"   >[size=224G][features=0][hwhandler=0][rw]</font></div><div><font size="2"   >\_ round-robin 0 [prio=0][active]</font></div><div><font size="2"   >&nbsp;\_ 4:0:126:0 sdd 8:48 &nbsp;[active][ready]</font></div><div><font size="2"   >mpath0 (360026b902fe2ce0017c654500ba7cfad) dm-0 DELL,PERC 6/i</font></div><div><font size="2"   >[size=186G][features=0][hwhandler=0][rw]</font></div><div><font size="2"   >\_ round-robin 0 [prio=0][active]</font></div><div><font size="2"   >&nbsp;\_ 0:2:1:0 &nbsp; sdb 8:16 &nbsp;[active][ready]</font></div><p></p></pre></div><div>其中mpath0也是一块SSD, 只是这块不是PCI-E的, 是SATA接口的, DELL品牌硬盘(大概2万元1块), 插在DELL服务器自带的RAID卡上. 后面会对比一下两个SSD以及机械盘的FSYNC性能差异.</div><div>(mpath0这块SSD 硬盘: 200GB Solid State Drive SATA MLC 3G 2.5in Hot-plug Hard Drive-Limited Warranty Only)</div><div><br></div><div>查看这块OCZ SSD硬盘的信息 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# hdparm -I /dev/sdd</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >/dev/sdd:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >ATA device, with non-removable media</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Model Number: &nbsp; &nbsp; &nbsp; OCZ-REVODRIVE3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Serial Number: &nbsp; &nbsp; &nbsp;OCZ-Z2134R0TLQBNE659</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Firmware Revision: &nbsp;2.15 &nbsp; &nbsp;</font></div><div><font size="2"   >Transport: Serial, ATA8-AST, SATA 1.0a, SATA II Extensions, SATA Rev 2.5</font></div><div><font size="2"   >Standards:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Supported: 8 7 6 5&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Likely used: 8</font></div><div><font size="2"   >Configuration:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Logical &nbsp; &nbsp; &nbsp; &nbsp; max &nbsp; &nbsp; current</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; cylinders &nbsp; &nbsp; &nbsp; 16383 &nbsp; 16383</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; heads &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16 &nbsp; &nbsp; &nbsp;16</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; sectors/track &nbsp; 63 &nbsp; &nbsp; &nbsp;63</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; --</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; CHS current addressable sectors: &nbsp; 16514064</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; LBA &nbsp; &nbsp;user addressable sectors: &nbsp;468883199</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; LBA48 &nbsp;user addressable sectors: &nbsp;468883199</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; device size with M = 1024*1024: &nbsp; &nbsp; &nbsp;228946 MBytes</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; device size with M = 1000*1000: &nbsp; &nbsp; &nbsp;240068 MBytes (240 GB)</font></div><div><font size="2"   >Capabilities:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; LBA, IORDY(can be disabled)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Queue depth: 32</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Standby timer values: spec'd by Standard, no device specific minimum</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; R/W multiple sector transfer: Max = 16 &nbsp;Current = 16</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Advanced power management level: unknown setting (0x00fe)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; DMA: mdma0 mdma1 mdma2 udma0 udma1 udma2 udma3 udma4 udma5 *udma6&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Cycle time: min=120ns recommended=120ns</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; PIO: pio0 pio1 pio2 pio3 pio4&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Cycle time: no flow control=120ns &nbsp;IORDY flow control=120ns</font></div><div><font size="2"   >Commands/features:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Enabled Supported:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;SMART feature set</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Security Mode feature set</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Power Management feature set</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Write cache</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Look-ahead</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Host Protected Area feature set</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;WRITE_BUFFER command</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;READ_BUFFER command</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;NOP cmd</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;DOWNLOAD_MICROCODE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Advanced Power Management feature set</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Power-Up In Standby feature set</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;SET_FEATURES required to spinup after power up</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;48-bit Address feature set</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Mandatory FLUSH_CACHE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;FLUSH_CACHE_EXT</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;SMART error logging</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;SMART self-test</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;General Purpose Logging feature set</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;WRITE_{DMA|MULTIPLE}_FUA_EXT</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;64-bit World wide name</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;IDLE_IMMEDIATE with UNLOAD</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Read-Verify feature set</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;WRITE_UNCORRECTABLE command</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;{READ,WRITE}_DMA_EXT_GPL commands</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Segmented DOWNLOAD_MICROCODE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;SATA-I signaling speed (1.5Gb/s)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;SATA-II signaling speed (3.0Gb/s)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;unknown 76[3]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Native Command Queueing (NCQ)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Host-initiated interface power management</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Phy event counters</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;unknown 76[14]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;unknown 76[15]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DMA Setup Auto-Activate optimization</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Device-initiated interface power management</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Software settings preservation</font></div><div><font size="2"   >Security:&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Master password revision code = 65534</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; supported</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; not &nbsp; &nbsp; enabled</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; not &nbsp; &nbsp; locked</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; not &nbsp; &nbsp; frozen</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; not &nbsp; &nbsp; expired: security count</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; not &nbsp; &nbsp; supported: enhanced erase</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 2min for SECURITY ERASE UNIT.&nbsp;</font></div><div><font size="2"   >Checksum: correct</font></div><p></p></pre></div><div>注意这块盘默认的WRITE CACHE是打开了, 为了安全建议关闭.</div><div>关闭<span style="line-height: 22px;"   >Write cache</span>前 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# hdparm -I /dev/sdd|grep cache</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp;Write cache</font></div><p></p></pre></div><div>关闭<span style="line-height: 22px;"   >Write cache</span>&nbsp;:&nbsp;</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# hdparm -W 0 /dev/mapper/mpath1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >/dev/mapper/mpath1:</font></div><div><font size="2"   >&nbsp;setting drive write-caching to 0 (off)</font></div><div><font size="2"   >&nbsp;HDIO_DRIVE_CMD(setcache) failed: Input/output error</font></div><p></p></pre></div><div>关闭<span style="line-height: 22px;"   >Write cache</span>后 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# hdparm -I /dev/mapper/mpath1|grep cache</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write cache</font></div><p></p></pre></div></div><div>接下来简单的测试了一下fsync的能力, 为了比较方便, 到DELL服务器的RAID配置中, 关闭write back. 改为write through. 这样在测试DELL服务器自带的SAS 146GB 10k转硬盘以及SSD SATA硬盘时将不会使用RAID卡的写cache. 而是直接写到磁盘. 这样与OCZ的PCI-E SSD才有得好比.</div><div>1. 关闭RAID 写cache的详细操作略.</div><div>2. 将OCZ PCI-E SSD的写cache关闭.</div><div><pre class="prettyprint"   ><p><font size="2"   >hdparm -W 0 /dev/mapper/mpath1</font></p></pre></div><div><span style="line-height: 22px;"   >放到rc.local, 否则重启后又会开启write cache.</span></div><div><div><img title="OCZ REVODRIVE3 used in CentOS 5.x x64 on DELL R610 Servers PCI-E x4 - 德哥@Digoal - The Heart,The World."   alt="OCZ REVODRIVE3 used in CentOS 5.x x64 on DELL R610 Servers PCI-E x4 - 德哥@Digoal - The Heart,The World."   style="margin:0 10px 0 0;"   src="http://img4.ph.126.net/9IQZeUEQJ75VmigwmC503g==/6598071421749337414.jpg"   ></div>&nbsp;</div><div><span style="line-height: 22px;"   >3. 使用PostgreSQL 9.2.x带的pg_test_fsync测试fsync能力.</span></div><div><span style="line-height: 22px;"   >3.1 机械盘</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg9.2.0@db-172-16-3-150-&gt; pg_test_fsync&nbsp;</font></div><div><font size="2"   >2 seconds per test</font></div><div><font size="2"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using one 16kB write:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 146.169 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 161.802 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 166.520 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using two 16kB writes:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 166.658 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 162.162 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;83.330 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare open_sync with different write sizes:</font></div><div><font size="2"   >(This is designed to compare the cost of writing 16kB</font></div><div><font size="2"   >in different write open_sync sizes.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; &nbsp; 166.673 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; 82.329 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; 41.665 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; 20.832 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; 10.293 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font size="2"   >(If the times are similar, fsync() can sync data written</font></div><div><font size="2"   >on a different descriptor.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 161.665 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 163.661 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Non-Sync'ed 16kB writes:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 148617.025 ops/sec</font></div><p></p></pre></div><div>3.2 SSD SATA 2.5寸</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg9.2.0@db-172-16-3-150-&gt; pg_test_fsync&nbsp;</font></div><div><font size="2"   >2 seconds per test</font></div><div><font size="2"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using one 16kB write:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 264.964 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 245.810 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 266.335 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using two 16kB writes:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 135.904 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 131.025 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 132.228 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare open_sync with different write sizes:</font></div><div><font size="2"   >(This is designed to compare the cost of writing 16kB</font></div><div><font size="2"   >in different write open_sync sizes.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; &nbsp; 267.800 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp;251.967 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp;241.487 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp;221.293 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp;189.691 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font size="2"   >(If the times are similar, fsync() can sync data written</font></div><div><font size="2"   >on a different descriptor.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 245.371 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 245.360 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Non-Sync'ed 16kB writes:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 149532.140 ops/sec</font></div><p></p></pre></div><div>3.3 OCZ PCI-E SSD</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg9.2.0@db-172-16-3-150-&gt; pg_test_fsync&nbsp;</font></div><div><font size="2"   >2 seconds per test</font></div><div><font size="2"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using one 16kB write:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9466.480 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 261.271 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 12701.793 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using two 16kB writes:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6148.294 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 250.694 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6321.015 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare open_sync with different write sizes:</font></div><div><font size="2"   >(This is designed to compare the cost of writing 16kB</font></div><div><font size="2"   >in different write open_sync sizes.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; 12598.168 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp; 7976.631 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp; 4740.957 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp; 2232.638 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; 1138.060 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font size="2"   >(If the times are similar, fsync() can sync data written</font></div><div><font size="2"   >on a different descriptor.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 250.710 ops/sec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 250.055 ops/sec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Non-Sync'ed 16kB writes:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 149753.941 ops/sec</font></div><p></p></pre></div><div>【参考】</div><div><a target="_blank" rel="nofollow" href="http://www.oczenterprise.com/briefs/ocz-vca-technology.pdf"   >http://www.oczenterprise.com/briefs/ocz-vca-technology.pdf</a></div><div><wbr></div><a target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/TRIM"   >http://en.wikipedia.org/wiki/TRIM</a><div><a target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/S.M.A.R.T."   >http://en.wikipedia.org/wiki/S.M.A.R.T.</a></div><a target="_blank" rel="nofollow" href="http://serverascode.com/2012/05/08/ocz-zdrive-r4-installation-performance.html"   >http://serverascode.com/2012/05/08/ocz-zdrive-r4-installation-performance.html</a><div><a target="_blank" rel="nofollow" href="http://www.oczenterprise.com/downloads/solutions/z-driver4-installation-guide.pdf"   >http://www.oczenterprise.com/downloads/solutions/z-driver4-installation-guide.pdf</a></div><p></p><p></p><p><a target="_blank" rel="nofollow" href="http://chinese.ocztechnologyforum.com/forum/showthread.php?18-%E6%8A%80%E8%A1%93%E7%AF%87-%E5%90%91%E6%82%A8%E7%B0%A1%E5%96%AE%E4%BB%8B%E7%B4%B9SandForce%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E6%9E%B6%E6%A7%8B"   >http://chinese.ocztechnologyforum.com/forum/showthread.php?18-%E6%8A%80%E8%A1%93%E7%AF%87-%E5%90%91%E6%82%A8%E7%B0%A1%E5%96%AE%E4%BB%8B%E7%B4%B9SandForce%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E6%9E%B6%E6%A7%8B</a></p><p></p></div>
	</div>
</div>
</body>
</html>