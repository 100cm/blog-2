<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Oracle TO PostgreSQL case</h2>
	<h5 id="">2012-11-29 15:55:06&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402012102911143855/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>监控系统以前查询digoalment数据是在oracle的监控数据库进行的.</div><div>监控数据库的信息来自定时从生产系统中同步, 然后转成视图.</div><div>监听的查询SQL是基于这个视图进行的.</div><div>步骤如下:</div><div><br></div><div>第一,创建一个存储过程,把现网digoalment的digoalment.tbl_digoal_record表和digoalment.tbl_digoal_submit_log分别同步到监控系统的oracle的</div><div>tbl_digoal_record和tbl_digoal_submit_log表中</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >CREATE OR REPLACE PROCEDURE CMP.p_sync_deposit_thridp as</font></div><div><font size="2"   >&nbsp; v_max_id number;</font></div><div><font size="2"   >begin</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; select max(id) into v_max_id from tbl_digoal_record;</font></div><div><font size="2"   >&nbsp; delete from tbl_digoal_record nologging where id &lt; v_max_id-1000000 and CREATETIME&lt;sysdate-1/12;</font></div><div><font size="2"   >&nbsp; commit;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; insert into tbl_digoal_record nologging (digoalORDERID,ID,CARDTYPE,digoalTIME,digoalRESULT,digoalTYPE,digoalAMOUNT,CREATETIME)</font></div><div><font size="2"   >&nbsp; &nbsp; select digoalORDERID,ID,CARDTYPE,digoalTIME,digoalRESULT,digoalTYPE,digoalAMOUNT,CREATETIME</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; from digoalment.tbl_digoal_record@skyoss2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;where id &gt; v_max_id and CREATETIME&lt;=(sysdate-1/144);</font></div><div><font size="2"   >&nbsp; commit;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; select max(id) into v_max_id from tbl_digoal_submit_log;</font></div><div><font size="2"   >&nbsp; delete from tbl_digoal_submit_log nologging where id &lt; v_max_id-1000000 and SUBMITTIME&lt;sysdate-1/12;</font></div><div><font size="2"   >&nbsp; commit;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; insert into tbl_digoal_submit_log nologging (digoalORDERID,ID,THIRID,SUBMITTIME)</font></div><div><font size="2"   >&nbsp; &nbsp; select digoalORDERID,ID,THIRID,SUBMITTIME</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; from digoalment.tbl_digoal_submit_log@skyoss2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;where id &gt; v_max_id;</font></div><div><font size="2"   >&nbsp; commit;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >END p_sync_deposit_thridp;</font></div><p></p></pre></div><div><br></div><div>过程分析 :&nbsp;</div><div>1. 10分钟同步一次</div><div>2. 为确保监控系统的ORACLE中数据不会太大. 同步时需要删除老记录, 表中至少保留100W条或者CREATETIME值是2小时的记录.</div><div>3. 同步id大于本地表中最大ID的记录, 同时保证记录的CREATETIME值是10分钟以前的.</div><div>&nbsp; &nbsp;是否担心批量提交, 会造成部分ID已经CACHE掉了, 将同步不到. 所以取了10分钟以前的记录(这里假设批量提交的延时最大小于10分钟) ?</div><div>&nbsp; &nbsp;后面会讲到, 同步的数据确实不准确, 有缺失, 可能由于是监控系统一直未发现这个问题.</div><div><br></div><div>第二,创建一个视图,这个试图的数据来源于上面同步好的tbl_digoal_record和tbl_digoal_submit_log</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >CREATE OR REPLACE VIEW TBL_DEPOSIT_QUDAO_RESP</font></div><div><font size="2"   >(ID, QUDAOTYPE, CARDTYPE, SUBMITTIME, digoalTIME, digoalRESULT, digoalTYPE, digoalAMOUNT)</font></div><div><font size="2"   >AS&nbsp;</font></div><div><font size="2"   >select&nbsp;</font></div><div><font size="2"   >&nbsp; t2.id,&nbsp;</font></div><div><font size="2"   >&nbsp; t2.thirid qudaotype,&nbsp;</font></div><div><font size="2"   >&nbsp; t1.cardtype,&nbsp;</font></div><div><font size="2"   >&nbsp; t2.submittime,</font></div><div><font size="2"   >&nbsp; t1.digoaltime,</font></div><div><font size="2"   >&nbsp; t1.digoalresult,</font></div><div><font size="2"   >&nbsp; t1.digoaltype,</font></div><div><font size="2"   >&nbsp; t1.digoalamount</font></div><div><font size="2"   >from tbl_digoal_record t1 inner join tbl_digoal_submit_log t2</font></div><div><font size="2"   >on t1.digoalorderid=t2.digoalorderid;</font></div><p></p></pre></div><div><br></div><div>第三,监控系统去视图中获取数据</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >select&nbsp;</font></div><div><font size="2"   >&nbsp; t1.qudaotype,</font></div><div><font size="2"   >&nbsp; t1.totalcount,</font></div><div><font size="2"   >&nbsp; t2.notrespcount&nbsp;</font></div><div><font size="2"   >from&nbsp;</font></div><div><font size="2"   >(select&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;qudaotype,</font></div><div><font size="2"   >&nbsp; &nbsp;count(0) as totalcount&nbsp;</font></div><div><font size="2"   >&nbsp;from tbl_deposit_qudao_resp&nbsp;</font></div><div><font size="2"   >&nbsp;where substr(to_char(submittime,'yyyyMMddHH24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >&nbsp;group by qudaotype</font></div><div><font size="2"   >) t1&nbsp;</font></div><div><font size="2"   >left join&nbsp;</font></div><div><font size="2"   >(select&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;qudaotype,</font></div><div><font size="2"   >&nbsp; &nbsp;count(0) as notrespcount&nbsp;</font></div><div><font size="2"   >&nbsp;from tbl_deposit_qudao_resp&nbsp;</font></div><div><font size="2"   >&nbsp;where substr(to_char(submittime,'yyyyMMddHH24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >&nbsp;and (digoaltime is null or (digoaltime-submittime)*24*60 &gt; 10)&nbsp;</font></div><div><font size="2"   >&nbsp;group by qudaotype</font></div><div><font size="2"   >) t2 &nbsp;</font></div><div><font size="2"   >on t1.qudaotype=t2.qudaotype;</font></div><p></p></pre></div><div><br></div><div>转换到PostgreSQL中后, 将直接在生产的HOT STANDBY数据库中执行查询, 省去同步数据的过程.</div><div>反向分析, 先看视图.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >CREATE OR REPLACE VIEW TBL_DEPOSIT_QUDAO_RESP</font></div><div><font size="2"   >(ID, QUDAOTYPE, CARDTYPE, SUBMITTIME, digoalTIME, digoalRESULT, digoalTYPE, digoalAMOUNT)</font></div><div><font size="2"   >AS&nbsp;</font></div><div><font size="2"   >select&nbsp;</font></div><div><font size="2"   >&nbsp; t2.id,</font></div><div><font size="2"   >&nbsp; t2.thirid qudaotype,</font></div><div><font size="2"   >&nbsp; t1.cardtype,</font></div><div><font size="2"   >&nbsp; t2.submittime,</font></div><div><font size="2"   >&nbsp; t1.digoaltime,</font></div><div><font size="2"   >&nbsp; t1.digoalresult,</font></div><div><font size="2"   >&nbsp; t1.digoaltype,</font></div><div><font size="2"   >&nbsp; t1.digoalamount</font></div><div><font size="2"   >from tbl_digoal_record t1 inner join tbl_digoal_submit_log t2</font></div><div><font size="2"   >on t1.digoalorderid=t2.digoalorderid;</font></div><p></p></pre></div><div>实际只用到了生产表的这几个字段 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >tbl_digoal_record: (digoalorderid, cardtype, digoaltime, digoalresult, digoaltype, digoalamount)</font></div><div><font size="2"   >tbl_digoal_submit_log: (digoalorderid, id, thirid, submittime)</font></div><p></p></pre></div><div>其中tbl_digoal_submit_log.thirid使用了qudaotype别名.</div><div><br></div><div>再看监控的查询SQL :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >select&nbsp;</font></div><div><font size="2"   >&nbsp; t1.qudaotype,</font></div><div><font size="2"   >&nbsp; t1.totalcount,</font></div><div><font size="2"   >&nbsp; t2.notrespcount&nbsp;</font></div><div><font size="2"   >from&nbsp;</font></div><div><font size="2"   >(select&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;qudaotype,</font></div><div><font size="2"   >&nbsp; &nbsp;count(0) as totalcount&nbsp;</font></div><div><font size="2"   >&nbsp;from tbl_deposit_qudao_resp&nbsp;</font></div><div><font size="2"   >&nbsp;where substr(to_char(submittime,'yyyyMMddHH24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >&nbsp;group by qudaotype</font></div><div><font size="2"   >) t1&nbsp;</font></div><div><font size="2"   >left join&nbsp;</font></div><div><font size="2"   >(select&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;qudaotype,</font></div><div><font size="2"   >&nbsp; &nbsp;count(0) as notrespcount&nbsp;</font></div><div><font size="2"   >&nbsp;from tbl_deposit_qudao_resp&nbsp;</font></div><div><font size="2"   >&nbsp;where substr(to_char(submittime,'yyyyMMddHH24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >&nbsp;and (digoaltime is null or (digoaltime-submittime)*24*60 &gt; 10)&nbsp;</font></div><div><font size="2"   >&nbsp;group by qudaotype</font></div><div><font size="2"   >) t2 &nbsp;</font></div><div><font size="2"   >on t1.qudaotype=t2.qudaotype;</font></div><p></p></pre></div><div>这里用到了left join, 来看看这两个JOIN的子查询.</div><div>1.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >select&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;qudaotype,</font></div><div><font size="2"   >&nbsp; &nbsp;count(0) as totalcount&nbsp;</font></div><div><font size="2"   >&nbsp;from tbl_deposit_qudao_resp&nbsp;</font></div><div><font size="2"   >&nbsp;where substr(to_char(submittime,'yyyyMMddHH24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >&nbsp;group by qudaotype</font></div><p></p></pre></div><div><br></div><div>2.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >select&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;qudaotype,</font></div><div><font size="2"   >&nbsp; &nbsp;count(0) as notrespcount&nbsp;</font></div><div><font size="2"   >&nbsp;from tbl_deposit_qudao_resp&nbsp;</font></div><div><font size="2"   >&nbsp;where substr(to_char(submittime,'yyyyMMddHH24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >&nbsp;and (digoaltime is null or (digoaltime-submittime)*24*60 &gt; 10)&nbsp;</font></div><div><font size="2"   >&nbsp;group by qudaotype</font></div><p></p></pre></div><div><br></div><div>关联条件t1.qudaotype=t2.qudaotype</div><div>原来最终要的是按照tbl_digoal_submit_log.thirid进行的分组, 只是2的分组多了个附加条件. 所以在这里用到了很多个JOIN.</div><div>其实没有必要, 用case when then else end转成SUM就好了.</div><div>下面是转成PostgreSQL后的SQL :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >select&nbsp;</font></div><div><font size="2"   >t2.thirid as qudaotype,</font></div><div><font size="2"   >count(*) as totalcount,</font></div><div><font size="2"   >sum(</font></div><div><font size="2"   >&nbsp; case&nbsp;</font></div><div><font size="2"   >&nbsp; when ( t1.digoaltime is null or (t1.digoaltime-t2.submittime) &gt; interval '10 min' )</font></div><div><font size="2"   >&nbsp; then 1</font></div><div><font size="2"   >&nbsp; else 0</font></div><div><font size="2"   >&nbsp; end</font></div><div><font size="2"   >) as notrespcount</font></div><div><font size="2"   >from</font></div><div><font size="2"   >tbl_digoal_record t1</font></div><div><font size="2"   >join</font></div><div><font size="2"   >tbl_digoal_submit_log t2</font></div><div><font size="2"   >on&nbsp;</font></div><div><font size="2"   >(t1.digoalorderid=t2.digoalorderid</font></div><div><font size="2"   >and substr(to_char(t2.submittime,'yyyymmddhh24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >-- 以下限制条件可以根据业务逻辑进行修改.</font></div><div><font size="2"   >-- 因为在监控数据库中, tbl_digoal_record表只保留了符合以下条件的数据.</font></div><div><font size="2"   >-- and ( t1.createtime &gt;= now()- interval '2 hour'</font></div><div><font size="2"   >-- &nbsp; &nbsp; &nbsp;or</font></div><div><font size="2"   >-- &nbsp; &nbsp; &nbsp;t1.id &gt; (select max(id)-1000000 from tbl_digoal_record)</font></div><div><font size="2"   >-- &nbsp; &nbsp; )</font></div><div><font size="2"   >)</font></div><div><font size="2"   >group by qudaotype</font></div><div><font size="2"   >order by qudaotype;</font></div><p></p></pre></div><div><br></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp;qudaotype | totalcount | notrespcount&nbsp;</font></div><div><font size="2"   >-----------+------------+--------------</font></div><div><font size="2"   >&nbsp;10 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;11 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;12 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 38 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;13 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 25 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;22 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 14 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;26 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;42 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >&nbsp;45 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;47 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 15 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;48 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >(10 rows)</font></div><div><font size="2"   >Time: 52067.600 ms</font></div><p></p></pre></div><div>耗时较长, 执行计划 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoalment=&gt; explain select</font></div><div><font size="2"   >t2.thirid as qudaotype,</font></div><div><font size="2"   >count(*) as totalcount,</font></div><div><font size="2"   >sum(</font></div><div><font size="2"   >&nbsp; case</font></div><div><font size="2"   >&nbsp; when ( t1.digoaltime is null or (t1.digoaltime-t2.submittime) &gt; interval '10 min' )</font></div><div><font size="2"   >&nbsp; then 1</font></div><div><font size="2"   >&nbsp; else 0</font></div><div><font size="2"   >&nbsp; end</font></div><div><font size="2"   >) as notrespcount</font></div><div><font size="2"   >from</font></div><div><font size="2"   >tbl_digoal_record t1</font></div><div><font size="2"   >join</font></div><div><font size="2"   >tbl_digoal_submit_log t2</font></div><div><font size="2"   >on&nbsp;</font></div><div><font size="2"   >(t1.digoalorderid=t2.digoalorderid</font></div><div><font size="2"   >and substr(to_char(t2.submittime,'yyyymmddhh24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >-- 以下这个限制条件可以根据业务逻辑进行修改.</font></div><div><font size="2"   >-- 因为在监控数据库中, tbl_digoal_record表只保留了符合以下条件的数据.</font></div><div><font size="2"   >-- and ( t1.createtime &gt;= now()- interval '2 hour'</font></div><div><font size="2"   >-- &nbsp; &nbsp; &nbsp;or</font></div><div><font size="2"   >-- &nbsp; &nbsp; &nbsp;t1.id &gt; (select max(id)-1000000 from tbl_digoal_record)</font></div><div><font size="2"   >-- &nbsp; &nbsp; )</font></div><div><font size="2"   >)</font></div><div><font size="2"   >group by qudaotype</font></div><div><font size="2"   >order by qudaotype;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Sort &nbsp;(cost=1299097.44..1299097.94 rows=200 width=19)</font></div><div><font size="2"   >&nbsp; &nbsp;Sort Key: t2.thirid</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;HashAggregate &nbsp;(cost=1299087.79..1299089.79 rows=200 width=19)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Hash Join &nbsp;(cost=837533.07..1298266.41 rows=65711 width=19)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hash Cond: ((t2.digoalorderid)::text = (t1.digoalorderid)::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..367935.14 rows=65711 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log t2 &nbsp;(cost=0.00..0.00 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201004 t2 &nbsp;(cost=0.00..1981.86 rows=356 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201005 t2 &nbsp;(cost=0.00..3692.95 rows=663 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201006 t2 &nbsp;(cost=0.00..4366.18 rows=784 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201007 t2 &nbsp;(cost=0.00..6107.97 rows=1094 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201008 t2 &nbsp;(cost=0.00..7398.18 rows=1325 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201009 t2 &nbsp;(cost=0.00..10064.09 rows=1803 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201010 t2 &nbsp;(cost=0.00..10031.96 rows=1797 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201011 t2 &nbsp;(cost=0.00..10232.05 rows=1834 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201012 t2 &nbsp;(cost=0.00..9291.40 rows=1665 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201101 t2 &nbsp;(cost=0.00..9579.05 rows=1715 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201102 t2 &nbsp;(cost=0.00..9092.85 rows=1629 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201103 t2 &nbsp;(cost=0.00..11161.13 rows=1999 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201104 t2 &nbsp;(cost=0.00..10596.52 rows=1899 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201105 t2 &nbsp;(cost=0.00..10921.26 rows=1956 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201106 t2 &nbsp;(cost=0.00..10074.33 rows=1804 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201107 t2 &nbsp;(cost=0.00..11124.31 rows=1989 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201108 t2 &nbsp;(cost=0.00..12350.01 rows=2209 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201109 t2 &nbsp;(cost=0.00..11422.37 rows=2044 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201110 t2 &nbsp;(cost=0.00..13422.94 rows=2401 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201111 t2 &nbsp;(cost=0.00..13245.23 rows=2370 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201112 t2 &nbsp;(cost=0.00..12422.96 rows=2223 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201201 t2 &nbsp;(cost=0.00..12630.75 rows=2259 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201202 t2 &nbsp;(cost=0.00..12795.73 rows=2287 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201203 t2 &nbsp;(cost=0.00..14068.72 rows=2516 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201204 t2 &nbsp;(cost=0.00..14528.59 rows=2593 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201205 t2 &nbsp;(cost=0.00..15074.83 rows=2689 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201206 t2 &nbsp;(cost=0.00..16346.38 rows=2907 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201207 t2 &nbsp;(cost=0.00..18151.91 rows=3224 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201208 t2 &nbsp;(cost=0.00..18341.61 rows=3263 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201209 t2 &nbsp;(cost=0.00..14528.79 rows=2586 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201210 t2 &nbsp;(cost=0.00..16018.38 rows=2853 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201211 t2 &nbsp;(cost=0.00..16701.58 rows=2962 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201212 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201302 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201303 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201304 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201305 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201306 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201307 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201308 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201309 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201310 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201311 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201312 t2 &nbsp;(cost=0.00..14.03 rows=1 width=146)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Hash &nbsp;(cost=582936.25..582936.25 rows=13167026 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..582936.25 rows=13167026 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record t1 &nbsp;(cost=0.00..0.00 rows=1 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201004 t1 &nbsp;(cost=0.00..2543.65 rows=71165 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201005 t1 &nbsp;(cost=0.00..4637.48 rows=131548 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201006 t1 &nbsp;(cost=0.00..5335.37 rows=156137 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201007 t1 &nbsp;(cost=0.00..7728.89 rows=216989 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201008 t1 &nbsp;(cost=0.00..10287.95 rows=262295 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201009 t1 &nbsp;(cost=0.00..14792.37 rows=359237 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201010 t1 &nbsp;(cost=0.00..15018.00 rows=353400 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201011 t1 &nbsp;(cost=0.00..15145.33 rows=364933 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201012 t1 &nbsp;(cost=0.00..13511.94 rows=331094 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201101 t1 &nbsp;(cost=0.00..14035.27 rows=340727 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201102 t1 &nbsp;(cost=0.00..13414.78 rows=324878 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201103 t1 &nbsp;(cost=0.00..16720.57 rows=398557 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201104 t1 &nbsp;(cost=0.00..16079.41 rows=379241 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201105 t1 &nbsp;(cost=0.00..16623.41 rows=390341 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201106 t1 &nbsp;(cost=0.00..15164.98 rows=359598 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201107 t1 &nbsp;(cost=0.00..16441.32 rows=397232 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201108 t1 &nbsp;(cost=0.00..19443.66 rows=440266 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201109 t1 &nbsp;(cost=0.00..18199.55 rows=410455 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201110 t1 &nbsp;(cost=0.00..21318.33 rows=479133 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201111 t1 &nbsp;(cost=0.00..21326.38 rows=472838 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201112 t1 &nbsp;(cost=0.00..20334.76 rows=448176 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201201 t1 &nbsp;(cost=0.00..20776.35 rows=453835 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201202 t1 &nbsp;(cost=0.00..21708.77 rows=470877 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201203 t1 &nbsp;(cost=0.00..24344.13 rows=523613 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201204 t1 &nbsp;(cost=0.00..25049.67 rows=536467 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201205 t1 &nbsp;(cost=0.00..25648.66 rows=544666 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201206 t1 &nbsp;(cost=0.00..26343.59 rows=580159 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201207 t1 &nbsp;(cost=0.00..30284.35 rows=640635 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201208 t1 &nbsp;(cost=0.00..30983.93 rows=647593 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201209 t1 &nbsp;(cost=0.00..25258.46 rows=526246 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201210 t1 &nbsp;(cost=0.00..26713.79 rows=565079 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201211 t1 &nbsp;(cost=0.00..27588.55 rows=589355 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201212 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201301 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201302 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201303 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201304 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201305 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201306 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201307 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201308 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201309 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201310 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201311 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_record_201312 t1 &nbsp;(cost=0.00..10.20 rows=20 width=126)</font></div><div><font size="2"   >(144 rows)</font></div><p></p></pre></div><div><br></div><div>优化, 增加一个查询条件.</div><div><pre class="prettyprint"   ><p><font size="2"   >and t1.createtime &gt;= '2012-11-28'</font></p></pre></div><div>因为提交时间肯定比支付时间早, 所以这么做逻辑上是允许的.</div><div>优化后,</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >select&nbsp;</font></div><div><font size="2"   >t2.thirid as qudaotype,</font></div><div><font size="2"   >count(*) as totalcount,</font></div><div><font size="2"   >sum(</font></div><div><font size="2"   >&nbsp; case&nbsp;</font></div><div><font size="2"   >&nbsp; when ( t1.digoaltime is null or (t1.digoaltime-t2.submittime) &gt; interval '10 min' )</font></div><div><font size="2"   >&nbsp; then 1</font></div><div><font size="2"   >&nbsp; else 0</font></div><div><font size="2"   >&nbsp; end</font></div><div><font size="2"   >) as notrespcount</font></div><div><font size="2"   >from</font></div><div><font size="2"   >tbl_digoal_record_201211 t1</font></div><div><font size="2"   >join</font></div><div><font size="2"   >tbl_digoal_submit_log_201211 t2</font></div><div><font size="2"   >on&nbsp;</font></div><div><font size="2"   >(t1.digoalorderid=t2.digoalorderid</font></div><div><font size="2"   >and substr(to_char(t2.submittime,'yyyymmddhh24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >and t1.createtime &gt;= '2012-11-28'</font></div><div><font size="2"   >)</font></div><div><font size="2"   >group by qudaotype</font></div><div><font size="2"   >order by qudaotype;</font></div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp;qudaotype | totalcount | notrespcount&nbsp;</font></div><div><font size="2"   >-----------+------------+--------------</font></div><div><font size="2"   >&nbsp;10 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;11 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;12 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 38 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;13 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 25 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;22 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 14 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;26 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;42 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >&nbsp;45 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;47 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 15 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;48 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >(10 rows)</font></div><div><font size="2"   >Time: 1127.975 ms</font></div><p></p></pre></div><div>执行计划 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoalment=&gt; explain select&nbsp;</font></div><div><font size="2"   >t2.thirid as qudaotype,</font></div><div><font size="2"   >count(*) as totalcount,</font></div><div><font size="2"   >sum(</font></div><div><font size="2"   >&nbsp; case&nbsp;</font></div><div><font size="2"   >&nbsp; when ( t1.digoaltime is null or (t1.digoaltime-t2.submittime) &gt; interval '10 min' )</font></div><div><font size="2"   >&nbsp; then 1</font></div><div><font size="2"   >&nbsp; else 0</font></div><div><font size="2"   >&nbsp; end</font></div><div><font size="2"   >) as notrespcount</font></div><div><font size="2"   >from</font></div><div><font size="2"   >tbl_digoal_record_201211 t1</font></div><div><font size="2"   >join</font></div><div><font size="2"   >tbl_digoal_submit_log_201211 t2</font></div><div><font size="2"   >on&nbsp;</font></div><div><font size="2"   >(t1.digoalorderid=t2.digoalorderid</font></div><div><font size="2"   >and substr(to_char(t2.submittime,'yyyymmddhh24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >and t1.createtime &gt;= '2012-11-28' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >group by qudaotype &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >order by qudaotype;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >-----------------</font></div><div><font size="2"   >&nbsp;Sort &nbsp;(cost=22579.90..22579.90 rows=1 width=19)</font></div><div><font size="2"   >&nbsp; &nbsp;Sort Key: t2.thirid</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;HashAggregate &nbsp;(cost=22579.88..22579.89 rows=1 width=19)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Hash Join &nbsp;(cost=5699.22..22578.84 rows=83 width=19)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hash Cond: ((t2.digoalorderid)::text = (t1.digoalorderid)::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Seq Scan on tbl_digoal_submit_log_201211 t2 &nbsp;(cost=0.00..16701.58 rows=2962 width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: (substr(to_char(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Hash &nbsp;(cost=5379.71..5379.71 rows=16521 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Index Scan using tbl_digoal_record_201211_createtime_idx on tbl_digoal_record_201211 t1 &nbsp;(cost=0.00..5379.71 rows</font></div><div><font size="2"   >=16521 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (createtime &gt;= '2012-11-28 00:00:00'::timestamp without time zone)</font></div><div><font size="2"   >(10 rows)</font></div><p></p></pre></div><div>加个immutable函数并建立相关索引后 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >CREATE OR REPLACE FUNCTION ts_to_char_immutable(i_time timestamp without time zone, i_format text)</font></div><div><font size="2"   >&nbsp;RETURNS text</font></div><div><font size="2"   >&nbsp;LANGUAGE sql</font></div><div><font size="2"   >&nbsp;IMMUTABLE</font></div><div><font size="2"   >AS $function$</font></div><div><font size="2"   >&nbsp; &nbsp; select to_char($1, $2);</font></div><div><font size="2"   >$function$;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >create index idx_tbl_digoal_submit_log_201211_ts1 on tbl_digoal_submit_log_201211 (substr(ts_to_char_immutable(submittime, 'yyyymmddhh24mi'::text), 1, 11));</font></div><p></p></pre></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >and substr(to_char(t2.submittime,'yyyymmddhh24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >改成</font></div><div><font size="2"   >and substr(ts_to_char_immutable(t2.submittime,'yyyymmddhh24mi'),1,11) = '20121128101'</font></div><p></p></pre></div><div>优化SQL后 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >select&nbsp;</font></div><div><font size="2"   >t2.thirid as qudaotype,</font></div><div><font size="2"   >count(*) as totalcount,</font></div><div><font size="2"   >sum(</font></div><div><font size="2"   >&nbsp; case&nbsp;</font></div><div><font size="2"   >&nbsp; when ( t1.digoaltime is null or (t1.digoaltime-t2.submittime) &gt; interval '10 min' )</font></div><div><font size="2"   >&nbsp; then 1</font></div><div><font size="2"   >&nbsp; else 0</font></div><div><font size="2"   >&nbsp; end</font></div><div><font size="2"   >) as notrespcount</font></div><div><font size="2"   >from</font></div><div><font size="2"   >tbl_digoal_record_201211 t1</font></div><div><font size="2"   >join</font></div><div><font size="2"   >tbl_digoal_submit_log_201211 t2</font></div><div><font size="2"   >on&nbsp;</font></div><div><font size="2"   >(t1.digoalorderid=t2.digoalorderid</font></div><div><font size="2"   >and substr(ts_to_char_immutable(t2.submittime,'yyyymmddhh24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >and t1.createtime &gt;= '2012-11-28'</font></div><div><font size="2"   >)</font></div><div><font size="2"   >group by qudaotype</font></div><div><font size="2"   >order by qudaotype;</font></div><div><font size="2"   >&nbsp;qudaotype | totalcount | notrespcount&nbsp;</font></div><div><font size="2"   >-----------+------------+--------------</font></div><div><font size="2"   >&nbsp;10 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;11 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;12 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 38 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;13 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 25 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;22 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 14 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;26 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;42 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >&nbsp;45 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;47 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 15 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;48 &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >(10 rows)</font></div><div><font size="2"   >Time: 46.675 ms</font></div><p></p></pre></div><div>执行时间目前可以接受.</div><div>执行计划 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoalment=&gt; explain select&nbsp;</font></div><div><font size="2"   >t2.thirid as qudaotype,</font></div><div><font size="2"   >count(*) as totalcount,</font></div><div><font size="2"   >sum(</font></div><div><font size="2"   >&nbsp; case&nbsp;</font></div><div><font size="2"   >&nbsp; when ( t1.digoaltime is null or (t1.digoaltime-t2.submittime) &gt; interval '10 min' )</font></div><div><font size="2"   >&nbsp; then 1</font></div><div><font size="2"   >&nbsp; else 0</font></div><div><font size="2"   >&nbsp; end</font></div><div><font size="2"   >) as notrespcount</font></div><div><font size="2"   >from</font></div><div><font size="2"   >tbl_digoal_record_201211 t1</font></div><div><font size="2"   >join</font></div><div><font size="2"   >tbl_digoal_submit_log_201211 t2</font></div><div><font size="2"   >on&nbsp;</font></div><div><font size="2"   >(t1.digoalorderid=t2.digoalorderid</font></div><div><font size="2"   >and substr(ts_to_char_immutable(t2.submittime,'yyyymmddhh24mi'),1,11) = '20121128101'</font></div><div><font size="2"   >and t1.createtime &gt;= '2012-11-28'</font></div><div><font size="2"   >)</font></div><div><font size="2"   >group by qudaotype</font></div><div><font size="2"   >order by qudaotype;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >-----------------</font></div><div><font size="2"   >&nbsp;Sort &nbsp;(cost=9554.57..9554.58 rows=1 width=19)</font></div><div><font size="2"   >&nbsp; &nbsp;Sort Key: t2.thirid</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;HashAggregate &nbsp;(cost=9554.55..9554.56 rows=1 width=19)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Hash Join &nbsp;(cost=5702.02..9553.52 rows=83 width=19)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hash Cond: ((t2.digoalorderid)::text = (t1.digoalorderid)::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Index Scan using idx_tbl_digoal_submit_log_201211_ts1 on tbl_digoal_submit_log_201211 t2 &nbsp;(cost=0.25..3673.70 rows=2963</font></div><div><font size="2"   >&nbsp;width=32)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (substr(ts_to_char_immutable(submittime, 'yyyymmddhh24mi'::text), 1, 11) = '20121128101'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Hash &nbsp;(cost=5382.14..5382.14 rows=16530 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Index Scan using tbl_digoal_record_201211_createtime_idx on tbl_digoal_record_201211 t1 &nbsp;(cost=0.00..5382.14 rows</font></div><div><font size="2"   >=16530 width=29)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (createtime &gt;= '2012-11-28 00:00:00'::timestamp without time zone)</font></div><div><font size="2"   >(10 rows)</font></div><p></p></pre></div></div></div>
	</div>
</div>
</body>
</html>