<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">rsync bwlimit</h2>
	<h5 id="">2011-07-25 16:34:32&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201162541727318/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>事实证明rsync不能控制服务端的总带宽，只能控制发起端的带宽。</div><div><br></div><div>1.&nbsp;</div><div>cat /etc/rsyncd.conf</div><div>port = 873</div><div>hosts deny = 0.0.0.0/0</div><div>read only = false</div><div>write only = false</div><div>gid = 0</div><div>uid = 0</div><div>use chroot = no</div><div>max connections = 10</div><div>pid file = /var/run/rsync.pid</div><div>lock file = /var/run/rsync.lock</div><div>log file = /var/log/rsync.log</div><div><font size="4"   >bwlimit = 1024</font></div><div><br></div><div>[dbbak_sh]</div><div>path = /dbbak_sh</div><div>comment = Database Backup from shanghai.</div><div>hosts allow = 172.16.3.33,172.16.3.40</div><div><br></div><div>服务端命令 rsync -v --daemon --config=/etc/rsyncd.conf</div><div>客户端命令&nbsp;rsync -acvz &nbsp;--delete --delete-after /root/SLES-11-SP1-DVD-x86_64-GM-DVD2.iso1 172.16.3.176::dbbak_sh</div><div><div>客户端输出</div><div>building file list ... done</div><div>SLES-11-SP1-DVD-x86_64-GM-DVD2.iso1</div><div><br></div><div>sent 4594258875 bytes &nbsp;received 38 bytes &nbsp;18713885.59 bytes/sec</div><div>total size is 4605421568 &nbsp;speedup is 1.00</div></div><div>限速无效</div><div><br></div><div>2.&nbsp;</div><div><div style="line-height: 22px;"   >cat /etc/rsyncd.conf</div><div style="line-height: 22px;"   >port = 873</div><div style="line-height: 22px;"   >hosts deny = 0.0.0.0/0</div><div style="line-height: 22px;"   >read only = false</div><div style="line-height: 22px;"   >write only = false</div><div style="line-height: 22px;"   >gid = 0</div><div style="line-height: 22px;"   >uid = 0</div><div style="line-height: 22px;"   >use chroot = no</div><div style="line-height: 22px;"   >max connections = 10</div><div style="line-height: 22px;"   >pid file = /var/run/rsync.pid</div><div style="line-height: 22px;"   >lock file = /var/run/rsync.lock</div><div style="line-height: 22px;"   >log file = /var/log/rsync.log</div><div style="line-height: 22px;"   ><br style="line-height: 22px;"   ></div><div style="line-height: 22px;"   >[dbbak_sh]</div><div style="line-height: 22px;"   >path = /dbbak_sh</div><div style="line-height: 22px;"   >comment = Database Backup from shanghai.</div><div style="line-height: 22px;"   >hosts allow = 172.16.3.33,172.16.3.40</div><div style="line-height: 22px;"   ><br style="line-height: 22px;"   ></div><div style="line-height: 22px;"   >服务端命令&nbsp;rsync -v --daemon <font size="4"   >--bwlimit=1024</font> --config=/etc/rsyncd.conf</div></div><div><div style="line-height: 22px;"   >客户端命令&nbsp;rsync -acvz &nbsp;--delete --delete-after /root/SLES-11-SP1-DVD-x86_64-GM-DVD2.iso1 172.16.3.176::dbbak_sh</div><div><div style="line-height: 22px;"   >客户端输出</div><div><div>building file list ... done</div><div>SLES-11-SP1-DVD-x86_64-GM-DVD2.iso1</div><div><br></div><div>sent 4594258859 bytes &nbsp;received 38 bytes &nbsp;17110833.88 bytes/sec</div><div>total size is 4605421568 &nbsp;speedup is 1.00</div></div></div><div style="line-height: 22px;"   >限速无效</div><div style="line-height: 22px;"   ><br></div></div><div style="line-height: 22px;"   >3.&nbsp;</div><div><div style="line-height: 22px;"   >cat /etc/rsyncd.conf</div><div style="line-height: 22px;"   >port = 873</div><div style="line-height: 22px;"   >hosts deny = 0.0.0.0/0</div><div style="line-height: 22px;"   >read only = false</div><div style="line-height: 22px;"   >write only = false</div><div style="line-height: 22px;"   >gid = 0</div><div style="line-height: 22px;"   >uid = 0</div><div style="line-height: 22px;"   >use chroot = no</div><div style="line-height: 22px;"   >max connections = 10</div><div style="line-height: 22px;"   >pid file = /var/run/rsync.pid</div><div style="line-height: 22px;"   >lock file = /var/run/rsync.lock</div><div style="line-height: 22px;"   >log file = /var/log/rsync.log</div><div style="line-height: 22px;"   ><br style="line-height: 22px;"   ></div><div style="line-height: 22px;"   >[dbbak_sh]</div><div style="line-height: 22px;"   >path = /dbbak_sh</div><div style="line-height: 22px;"   >comment = Database Backup from shanghai.</div><div style="line-height: 22px;"   >hosts allow = 172.16.3.33,172.16.3.40</div><div style="line-height: 22px;"   ><br></div><div style="line-height: 22px;"   >服务端命令 rsync -v --daemon --config=/etc/rsyncd.conf</div><div style="line-height: 22px;"   >客户端命令 rsync -acvz --daemon --bwlimit=5000 --delete --delete-after /root/SLES-11-SP1-DVD-x86_64-GM-DVD2.iso1 172.16.3.176::dbbak_sh</div><div style="line-height: 22px;"   >客户端报错 :&nbsp;</div><div><div>rsync: -acvz: unknown option (in daemon mode)</div><div>(Type "rsync --daemon --help" for assistance with daemon mode.)</div><div>rsync error: syntax or usage error (code 1) at options.c(879) [client=2.6.8]</div></div></div><div>限速失败.</div><div><br></div><div>客户端命令&nbsp; rsync -acvz --bwlimit=5000 --delete --delete-after /root/SLES-11-SP1-DVD-x86_64-GM-DVD2.iso1 172.16.3.176::dbbak_sh</div><div><div><div><div>building file list ... done</div><div>SLES-11-SP1-DVD-x86_64-GM-DVD2.iso1</div><div><br></div><div>sent 4594258875 bytes &nbsp;received 38 bytes &nbsp;5023793.23 bytes/sec</div><div>total size is 4605421568 &nbsp;speedup is 1.00</div></div></div><div><font size="4"   >限速成功。</font></div><div style="line-height: 22px;"   ><br style="line-height: 22px;"   ></div><div style="line-height: 22px;"   >【参考】</div></div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --bwlimit=KBPS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;limit I/O bandwidth; KBytes per second</div><div><div>Rsync can also be run as a daemon, in which case the following options are accepted:</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --daemon &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;run as an rsync daemon</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --address=ADDRESS &nbsp; &nbsp; &nbsp; bind to the specified address</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --bwlimit=KBPS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;limit I/O bandwidth; KBytes per second &nbsp;(这里应该是说服务端限速,不过显然没有生效)</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --config=FILE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; specify alternate rsyncd.conf file</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --no-detach &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; do not detach from the parent</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --port=PORT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; listen on alternate port number</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --sockopts=OPTIONS &nbsp; &nbsp; &nbsp;specify custom TCP options</div><div>&nbsp; &nbsp; &nbsp; &nbsp; -v, --verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; increase verbosity</div><div>&nbsp; &nbsp; &nbsp; &nbsp; -4, --ipv4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;prefer IPv4</div><div>&nbsp; &nbsp; &nbsp; &nbsp; -6, --ipv6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;prefer IPv6</div><div>&nbsp; &nbsp; &nbsp; &nbsp; -h, --help &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;show this help (if used after --daemon)</div></div><div><br></div><div><div><br></div></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="rsync bwlimit - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>