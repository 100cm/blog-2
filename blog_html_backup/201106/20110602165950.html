<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">use parted create GPT on DISK Larger than 2TB</h2>
	<h5 id="">2011-06-02 16:59:50&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020115245346471/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">当磁盘大于2TB时，在linux下面使用fdisk分区是会发出警告:<div><div>WARNING: The size of this disk is 8.0 TB (7993526845440 bytes).</div><div>DOS partition table format can not be used on drives for volumes</div><div>larger than 2.2 TB (2199023255040 bytes). Use parted(1) and GUID&nbsp;</div><div>partition table format (GPT).</div><div><br></div><div>[转载]</div><wbr><div><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;">MBR分区表：（MBR含义：主引导记录）</span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><br style="line-height: normal;"></span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;">所支持的最大卷：2T （T; terabytes,1TB=1024GB）</span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><br style="line-height: normal;"></span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;">对分区的设限：最多4个主分区或3个主分区加一个扩展分区（扩展分区中支持无限制的逻辑驱动器）</span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><br style="line-height: normal;"></span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><br style="line-height: normal;"></span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;">GPT分区表：（GPT含义：GUID分区表）</span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><br style="line-height: normal;"></span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;">支持最大卷：18EB，（E：exabytes,1EB=1024TB）</span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><br style="line-height: normal;"></span><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;">每个磁盘最多支持128个分区</span></div><div><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><br></span></div></div><div><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;">具体的做法是使用parted 修改分区表.</span></div><div><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;">1、进入系统执行：<br style="line-height: normal;">#parted /dev/sdb<br style="line-height: normal;"><br style="line-height: normal;">2、建立磁盘label：<br style="line-height: normal;"><br style="line-height: normal;">mklabel GPT<br style="line-height: normal;"><br style="line-height: normal;">3、按p键，查看磁盘可用空间，显示单位为M。6000G应该显示大致<br style="line-height: normal;"><br style="line-height: normal;">为: /dev/sdb 的磁盘几何结构：0.000-6000000.000 兆字节<br style="line-height: normal;"><br style="line-height: normal;">4、创建分区:<br style="line-height: normal;">在(parted)后输入：<br style="line-height: normal;">mkpart并按照提示操作<br style="line-height: normal;"><br style="line-height: normal;">分区类型？ primary/主分区/extended/扩展分区? p （如果要创建扩展分区 此处<br style="line-height: normal;">输入e）<br style="line-height: normal;">文件系统类型？ [ext2]? (这里直接回车，分区创建完毕后通过mkfs.ext3<br style="line-height: normal;">/dev/sdb*建立文件系统)<br style="line-height: normal;">起始点？0<br style="line-height: normal;">结束点？-1<br style="line-height: normal;"><br style="line-height: normal;">5、按p键查看刚创建的分区是否已经成功。<br style="line-height: normal;"><br style="line-height: normal;">6、如果成功，键入quit退出parted。<br style="line-height: normal;"><br style="line-height: normal;">7、使用mkfs.ext3 /dev/sdb1 来创建文件系统<br style="line-height: normal;"><br style="line-height: normal;"><br style="line-height: normal;">fdisk命令虽然很交互，操作也方便，但是对于大于2T的磁盘无法操作，如果我们想用大于2T的磁盘怎么办?可以把磁盘转化为GPT格式。<br style="line-height: normal;"><br style="line-height: normal;"><br style="line-height: normal;">GPT格式的磁盘相当于原来MBR磁盘中原来保留4个partition table的4*16个字节只留第一个16个字节，类似于扩展分区，真正的partition table在512字节之后，GPT磁盘没有四个主分区的限制。<br style="line-height: normal;"><br style="line-height: normal;"><br style="line-height: normal;">但fdisk不支持GPT，我们可以使用parted来对GPT磁盘操作。<br style="line-height: normal;"><br style="line-height: normal;">parted功能很强大，既可用命令行也可以用于交互式<br style="line-height: normal;"><br style="line-height: normal;"><br style="line-height: normal;">在提示符下输入parted就会进入交互式模式,如果有多个磁盘的话，我们需要运行select sdx x为磁盘，来进行磁盘的选择<br style="line-height: normal;"><br style="line-height: normal;">parted&gt;<br style="line-height: normal;"><br style="line-height: normal;">parted&gt;select sdb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 假设磁盘为sdb<br style="line-height: normal;"><br style="line-height: normal;">parted&gt;mklable gpt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 将MBR磁盘格式化为GPT<br style="line-height: normal;"><br style="line-height: normal;">parted&gt;mklable msdos&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 将GPT磁盘转化为MBR磁盘<br style="line-height: normal;"><br style="line-height: normal;">parted&gt;mkpart primary 0 100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 划分一个起始位置为0大小为100M的主分区<br style="line-height: normal;"><br style="line-height: normal;">parted&gt;mkpart primary 100 200&nbsp;&nbsp;&nbsp; 划分一个起始位置为100M大小为100M的主分区<br style="line-height: normal;"><br style="line-height: normal;">parted&gt;print&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 打印当前分区<br style="line-height: normal;"><br style="line-height: normal;"><br style="line-height: normal;"><br style="line-height: normal;">在parted里边不支持ext3的文件系统，所以如果要使用的话，要退出parted进行格式话<br style="line-height: normal;"><br style="line-height: normal;">mkfs.ext3 /dev/sdx1<br style="line-height: normal;"><br style="line-height: normal;">因为fdisk是不支持GPT磁盘，所以不要使用fdisk -l来查看X磁盘刚才分好的区，看不到的。<br style="line-height: normal;"><br style="line-height: normal;"><br style="line-height: normal;">命令行的模式：<br style="line-height: normal;">将硬盘转化为GPT磁盘后，执行下列命令<br style="line-height: normal;"><br style="line-height: normal;">parted /dev/sdx mkpart primary 0 100&nbsp;&nbsp; 划分一个起始位置为0大小为100M的主分区<br style="line-height: normal;"><br style="line-height: normal;">Acronym for GUID Partition Table<br style="line-height: normal;"><br style="line-height: normal;">GPT was introduced for iA64 systems, to get around a fixed 32 bit issue (2 to the power of 32 is 4 billion times a 512 byte block equals 2 Terabytes) in the PC-BIOS Partition table. Partitions larger than 2 TB require using a GPT disklabel, which differs from the PC-BIOS Partition table in a number of ways:<br style="line-height: normal;"><br style="line-height: normal;">&nbsp;&nbsp;&nbsp; * Is easily extensible.<br style="line-height: normal;">&nbsp;&nbsp;&nbsp; * Can contain up to 128 primary partitions, as opposed to 4, so there's no need for extended partitions.<br style="line-height: normal;">&nbsp;&nbsp;&nbsp; * Allows Partitions larger than 2 TB.<br style="line-height: normal;">&nbsp;&nbsp;&nbsp; * Identifies Partitions with a GUID so you can reference that Partition even if disks are moved around.<br style="line-height: normal;">&nbsp;&nbsp;&nbsp; * Identifies Partition type with a GUID, thus avoiding the type conflicts that plague the PC-BIOS Partition table format.<br style="line-height: normal;">&nbsp;&nbsp;&nbsp; * Provides a 46(?) character UTF-16 partition label to identify Partitions.<br style="line-height: normal;">&nbsp;&nbsp;&nbsp; * Has a "fake" MBR for backwards compatibility.<br style="line-height: normal;">&nbsp;&nbsp;&nbsp; * Includes a CRC32 to detect corrupt Partition tables.<br style="line-height: normal;">&nbsp;&nbsp;&nbsp; * Stores a backup Partition table at the end of the disk.<br style="line-height: normal;"><br style="line-height: normal;">Most partitioning tools under Linux will fail to do anything sensible with a &gt; 2 TB Partition. As of this writing, parted(8) is the only one that understands them and will let you set the GPT label on the disk.<br style="line-height: normal;"><br style="line-height: normal;">There is a lot of information stating that you cannot boot off a GPT enabled device. Most of the claims imply that the fault is with LILO or GRUB not understanding GPT devices. We've not tested this, but GPT and traditional MBRs will coexist.<br style="line-height: normal;"><br style="line-height: normal;">See also:<br style="line-height: normal;"><br style="line-height: normal;">&nbsp;&nbsp;&nbsp; * Disk Sectors on GPT Disks from the MS Knowledge Base<br style="line-height: normal;"><br style="line-height: normal;">所以在超过2TB时,我不能使用交互很好的Fdisk命令,只能磁盘转化为GPT格式。由于GPT格式的磁盘相当于原来MBR磁盘中原来保留4个 partition table的4*16个字节只留第一个16个字节，其它的类似于扩展分区，真正的partition table在512字节之后，所以对GPT磁盘表来讲没有四个主分区的限制。<br style="line-height: normal;"><br style="line-height: normal;">对GPT磁盘分区表进行操作，我们要使用parted命令。其实parted功能很强大，它可以象fdisk一样既可用命令行也可以用于交互式.<br style="line-height: normal;">下面我们就来实际操作吧，在提示符下输入parted就会进入交互式模式<br style="line-height: normal;"><br style="line-height: normal;"># parted /dev/sdb<br style="line-height: normal;">GNU Parted 1.8.1<br style="line-height: normal;">Using /dev/sdb<br style="line-height: normal;">Welcome to GNU Parted! Type 'help' to view a list of commands.<br style="line-height: normal;"><br style="line-height: normal;">(parted) mklabel gpt<br style="line-height: normal;">将MBR磁盘格式化为GPT<br style="line-height: normal;"><br style="line-height: normal;">(parted) mkpart primary 0 100<br style="line-height: normal;">划分一个起始位置为0大小为100M的主分区<br style="line-height: normal;"><br style="line-height: normal;">(parted) mkpart primary 100 200<br style="line-height: normal;">划分一个起始位置为100M大小为100M的主分区<br style="line-height: normal;"><br style="line-height: normal;">(parted) mkpart primary 0 -1<br style="line-height: normal;"><br style="line-height: normal;">划分所有空间到一个分区<br style="line-height: normal;"><br style="line-height: normal;">(parted) print<br style="line-height: normal;">打印当前分区<br style="line-height: normal;"><br style="line-height: normal;">(parted) quit<br style="line-height: normal;"><br style="line-height: normal;">可能还会用到的一些命令<br style="line-height: normal;"><br style="line-height: normal;">(parted) mklable msdos<br style="line-height: normal;">如果要反过来.将GPT磁盘转化为MBR磁盘<br style="line-height: normal;"><br style="line-height: normal;">在这样分完分区后,还要使用mkfs.ext3来进行格式化<br style="line-height: normal;">#partprobe<br style="line-height: normal;">#mkfs.ext3 -F /dev/sdb1<br style="line-height: normal;"><br style="line-height: normal;">记的哦，因为fdisk是不支持GPT磁盘，所以使用fdisk -l来查看磁盘刚才的分区是没有用的.<br style="line-height: normal;"><br style="line-height: normal;">命令行的模式：<br style="line-height: normal;"><br style="line-height: normal;">将硬盘转化为GPT磁盘后，执行下列命令<br style="line-height: normal;"><br style="line-height: normal;">parted /dev/sdx mkpart primary 0 100&nbsp;<br style="line-height: normal;">##划分一个起始位置为0大小为100M的主分区</span></div><div><span style="color: rgb(42, 41, 41); font-family: Arial; font-size: 12px; line-height: 18px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px;"><br></span></div></div>
	</div>
</div>
</body>
</html>