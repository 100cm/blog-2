<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">SSH Tunnels Compression speed up  PostgreSQL data transport in WAN environment</h2>
	<h5 id="">2011-06-27 17:44:12&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201152753352356/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">今天一位海外的同事问我从国外抽取数据比较慢，有没有好的解决办法？<div>这个问题其实以前也遇到过，我是通过SSH建立隧道，并且开启协议压缩来解决的，不过对于应用程序不太适用。如果PG支持协议级的压缩就更好了。</div><div><br></div><div>首先在本地服务器建立远程数据库服务器隧道 :&nbsp;</div><div>ssh -C -L 6666:127.0.0.1:1921 postgres@remote_ip</div><div>在另外一个本地的Shell里面执行如下命令:</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres@db-172-16-3-33-&gt; date +%F%T;psql -h 127.0.0.1 -p 6666 -U postgres db_remote -c "copy schema.tbl_log to stdout" &gt;./tbl_log.dmp;date +%F%T</font></div><div><font size="2"  >2011-06-2717:16:50</font></div><div><font size="2"  >2011-06-2717:17:08</font></div><p></p></pre></div><div>耗时18秒</div><div><br></div><div>不走隧道的话</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres@db-172-16-3-33-&gt; date +%F%T;psql -h remote_ip -p 1921 -U schema db_remote -c "copy schema.tbl_log to stdout" &gt;./tbl_log2.dmp;date +%F%T</font></div><div><font size="2"  >2011-06-2717:20:06</font></div><div><font size="2"  >2011-06-2717:22:29</font></div><p></p></pre></div><div>耗时143秒</div><div><br></div><div>速度提升非常惊人.</div><div><br></div><div>参考:</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >&nbsp; &nbsp; &nbsp;-L [bind_address:]port:host:hostport</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Specifies that the given port on the local (client) host is to be forwarded to the given host and port on</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;the remote side. &nbsp;This works by allocating a socket to listen to port on the local side, optionally bound</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to the specified bind_address. &nbsp;Whenever a connection is made to this port, the connection is forwarded</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;over the secure channel, and a connection is made to host port hostport from the remote machine. &nbsp;Port</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;forwardings can also be specified in the configuration file. &nbsp;IPv6 addresses can be specified with an</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alternative syntax: [bind_address/]port/host/hostport or by enclosing the address in square brackets.</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Only the superuser can forward privileged ports. &nbsp;By default, the local port is bound in accordance with</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;the GatewayPorts setting. &nbsp;However, an explicit bind_address may be used to bind the connection to a spe-</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cific address. &nbsp;The bind_address of “localhost” indicates that the listening port be bound for local use</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;only, while an empty address or ‘*’ indicates that the port should be available from all interfaces.</font></div></div><div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp;-C &nbsp; &nbsp; &nbsp;Requests compression of all data (including stdin, stdout, stderr, and data for forwarded X11 and TCP</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;connections). &nbsp;The compression algorithm is the same used by gzip(1), and the “level” can be controlled</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;by the CompressionLevel option for protocol version 1. &nbsp;Compression is desirable on modem lines and other</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;slow connections, but will only slow down things on fast networks. &nbsp;The default value can be set on a</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;host-by-host basis in the configuration files; see the Compression option.</font></div></div><p></p></pre></div><div><br></div><div><wbr><div><br></div></div>LINUX :&nbsp;<div><div>linux 通过ssh代理上网</div><div>本网段上网需计费,想到通过另一网段的linux服务器做代理免费上网</div><div>前提是你有那台linux主机的帐户</div><div>然后打开终端输入</div><div>ssh -qTfnN -D 7070 user@host</div><div><br></div><div>说明: user是你的帐号,host指对方linux主机的ip</div><div>-q Quiet mode. 安静模式，忽略一切对话和错误提示。</div><div>-T Disable pseudo-tty allocation. 不占用 shell 了。</div><div>-f Requests ssh to go to background just before command execution. 后台运行，并推荐加上 -n 参数。</div><div>-n Redirects stdin from /dev/null (actually, prevents reading from stdin). -f 推荐的，不加这条参数应该也行。</div><div>-N Do not execute a remote command. 不执行远程命令，专为端口转发度身打造。</div><div><br></div><div><br></div><div>然后在浏览器中</div><div>如果是firefox:安装autoproxy插件，在代理中选择SSH -D即可。默认情况下的配置就是7070端口，所以可以不用修改配置，否则在首选项中更改服务器设置。</div><div>如果是Chrome:安装proxy switchy扩展，添加Proxy Profile，在右侧的socks host中输入127.0.0.1和7070，下方选中socks v5，保存，然后切换至该profile即可。</div></div><br><div>【其他】</div><div>1.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020115294425540/"  >http://blog.163.com/digoal@126/blog/static/16387704020115294425540/</a></div></div>
	</div>
</div>
</body>
</html>