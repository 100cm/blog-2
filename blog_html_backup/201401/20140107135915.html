<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Function is a data type in Lua</h2>
	<h5 id="">2014-01-07 13:59:15&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020140715115517/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">在Lua中, 我们用到的函数, 其实是一个数据类型, 例如 :&nbsp;<div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-150 ~]# lua</font></div><div><font size="2"   >Lua 5.2.3 &nbsp;Copyright (C) 1994-2013 Lua.org, PUC-Rio</font></div><div><font size="2"   >&gt; print(type(print))</font></div><div><font size="2"   >function</font></div><div><font size="2"   >&gt; print(type(function() end))</font></div><div><font size="2"   >function</font></div></div><div><div><font size="2"   >&gt; print(type({}))</font></div><div><font size="2"   >table</font></div></div><div><div><font size="2"   >&gt; print(type("hello"))</font></div><div><font size="2"   >string</font></div><div><font size="2"   >&gt; print(type(1.2))</font></div><div><font size="2"   >number</font></div></div><p></p></pre></div><div>函数的定义构造器function () end, 和表的构造器{}一样. 都只是个构造器.</div><div>所以函数可以存储在变量中, 本地变量或者全局变量或者表的元素中都可以. 因此函数的定义实际上是匿名的, 如果没有赋值的过程.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >function (x)&nbsp;</font></div><div><font size="2"   >&nbsp; return x*2&nbsp;</font></div><div><font size="2"   >end</font></div><p></p></pre></div><div>这其实是个匿名函数.</div><div>赋值给一个变量的写法 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >double =&nbsp;</font></div><div><div style="line-height: 28px;"   ><font size="2"   >function (x)&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; return x*2&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >end</font></div></div><div style="line-height: 28px;"   ><font size="2"   >或者</font></div><div style="line-height: 28px;"   ><font size="2"   >function double (x)</font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >&nbsp; return x*2&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >end</font></div></div><p></p></pre></div><div><br></div><div>同时, 系统自定义的函数变量, 也可以被覆盖: 例如, print函数.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; print = function() end</font></div><div><font size="2"   >&gt; print("hello")</font></div><p></p></pre></div><div>函数还可以作为返回值, 例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >function derivative(f, delta)</font></div><div><font size="2"   >&nbsp; delta = delta or 1e-4</font></div><div><font size="2"   >&nbsp; return function (x)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return ( f(x+delta) - f(x) ) / delta</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;end</font></div><div><font size="2"   >end</font></div></div><div><font size="2"   >这个函数的返回值为一个匿名函数,</font></div><div><div style="line-height: 28px;"   ><font size="2"   >function (x)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return ( f(x+delta) - f(x) ) / delta</font></div><div style="line-height: 28px;"   ><font size="2"   >end</font></div></div><div style="line-height: 28px;"   ><font size="2"   >所以如下表达式是把这个匿名函数赋予给一个变量.</font></div><div><font size="2"   >c = derivative(math.sin)</font></div><div><font size="2"   >即</font></div><div><div style="line-height: 28px;"   ><font size="2"   >c = function (x)</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; return (&nbsp;<span style="line-height: 28px;"   >math.sin</span>(x+delta) -&nbsp;<span style="line-height: 28px;"   >math.sin</span>(x) ) / 1e-4</font></div><div style="line-height: 28px;"   ><font size="2"   >end</font></div></div><div style="line-height: 28px;"   ><font size="2"   >例子 : </font></div><div><font size="2"   >&gt; = c(1)<br>0.54026023141862</font></div><div><font size="2"   ><br></font></div><p></p></pre></div><div>把函数存储在一个表的元素中的例子 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; arr = {}</font></div><div><font size="2"   >&gt; arr.x = c</font></div><div><font size="2"   >&gt; arr.x(1)</font></div><div><font size="2"   >&gt; = arr.x(1)</font></div><div><font size="2"   >0.54026023141862</font></div><p></p></pre></div></div>
	</div>
</div>
</body>
</html>