<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL use UDF combine NoSQL DB's Computing Power</h2>
	<h5 id="">2015-07-22 16:19:05&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402015622360849/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL数据库如何利用NoSQL数据库的强大计算能力或某些特性呢？</div><div>这个问题实际上是因为一种数据库不可能做到适合任何场景，一个企业的不同业务类型可能使用的数据产品也千差万别。昨天和一位朋友聊到一个应用场景，他们有部分数据是存储在aerospike的，在aerospike中做BIT运算是很快的，但是当需要多个条件的组合时（多级索引），可能就不是那么适合了。</div><div>这个时候PostgreSQL就派上用场了，将aerospike中的KEY存储到PostgreSQL中，还有多级索引涉及的字段内容也存储到PostgreSQL中，VALUE（bitmap）还是存储在aerospike中。</div><div>这么做之后，原来的查询就变成PostgreSQL中的查询了，但是如何才能结合aerospike中的bit运算结果呢？这个时候需要使用PostgreSQL的UDF功能，参考本文参考部分，例如aerospike支持python，那么我们就在PostgreSQL中使用PL/python语言来编写这个UDF。</div><div><div><img title="PostgreSQL use UDF combine NoSQL DBs Computing Power - 德哥@Digoal - PostgreSQL research"   alt="PostgreSQL use UDF combine NoSQL DBs Computing Power - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/ZY9ybSdlN59nNnq2FiKoDQ==/6608754276725451156.png"   ></div></div><div>使用UDF可以很好的调动外部数据源的计算能力。目前PostgreSQL支持多种语言的函数，例如C,python,perl,tcl,java,javascript,R等等。</div><div><br></div><div>当然除了UDF，实际上PostgreSQL还有FDW，只是不是所有的数据源目前都有开源的FDW，所以UDF使用起来门槛更低，还有一点，并不是所有的查询FDW都支持where条件的push down，所以这个时候还是要靠UDF。</div><div>目前PostgreSQL支持的FDW请参考：</div><div><a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://wiki.postgresql.org/wiki/Fdw"   >https://wiki.postgresql.org/wiki/Fdw</a></div><div><br></div><div>UDF这种用法，其实在其他产品中也屡见不鲜，例如R的pivotalR包，也可以认为是一种UDF包，它实际上是在Greenplum或HAWQ中执行相应的SQL语句，并将数据返回给R，这正是R利用MPP的数据处理能力的一种手段。与本文在PostgreSQL中使用UDF利用aerospike的计算能力的思路是一样的。</div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.4/static/plpython.html"   >http://www.postgresql.org/docs/9.4/static/plpython.html</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.4/static/server-programming.html"   >http://www.postgresql.org/docs/9.4/static/server-programming.html</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://wiki.postgresql.org/wiki/Fdw"   >https://wiki.postgresql.org/wiki/Fdw<br></a><span style="line-height: 28px;"   >
</span><a style="line-height: 28px;" rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL use UDF combine NoSQL DBs Computing Power - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div></div>
	</div>
</div>
</body>
</html>