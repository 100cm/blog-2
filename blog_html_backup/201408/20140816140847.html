<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL cstore_fdw column-ORI table VS MonetDB (with fixed-length width table)</h2>
	<h5 id="">2014-08-16 14:08:47&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201471691955155/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>前面测试了PostgreSQL 行存储引擎和MonetDB列存储的性能差别. 包括导入, 查询, 关联查询等.</div><div>本文将测试一下PostgreSQL使用cstore_fdw插件, 对比MonetDB的性能.</div><div>测试方法和性能数据见 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014715113449394/"   >http://blog.163.com/digoal@126/blog/static/1638770402014715113449394/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201471593653444/"   >http://blog.163.com/digoal@126/blog/static/163877040201471593653444/</a></div><div><br></div><div>汇总3种测试结果的对比</div><div><span style="line-height: 28px;"   >5000万 60个int型字段 宽表 导入速度</span>&nbsp;:&nbsp;</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   ><tbody><tr><td>&nbsp;MonetDB</td><td>&nbsp;PostgreSQL行引擎</td><td>&nbsp;PostgreSQL列引擎 (开启压缩)</td></tr><tr><td>&nbsp;320秒</td><td>&nbsp;1088秒</td><td>&nbsp;1344秒</td></tr></table><br></div><div>存储空间 :&nbsp;</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   ><tbody><tr><td>&nbsp;MonetDB</td><td>&nbsp;<span style="font-size: 16px; line-height: 28px;"   >PostgreSQL行引擎</span></td><td>&nbsp;<span style="font-size: 16px; line-height: 28px;"   >PostgreSQL列引擎</span></td></tr><tr><td>&nbsp;12G</td><td>&nbsp;13G</td><td>&nbsp;12G</td></tr></table>&nbsp; &nbsp;</div><div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >查询效率 :&nbsp;</span></div></div><div>1. select count(distinct c1) from t1;</div><div>50000000</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;1.8秒</td><td style="line-height: 28px;"   >&nbsp;60秒</td><td style="line-height: 28px;"   >&nbsp;42秒</td></tr></table></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >2. select count(distinct c1) from t2;</span></div><div>50000000</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;1.8秒</td><td style="line-height: 28px;"   >&nbsp;59秒</td><td style="line-height: 28px;"   >&nbsp;42秒</td></tr></table></div><div><br></div><div>3. select count(*) from (select c1,c11,c21,c31,c41,c51,c60 from t1 group by c1,c11,c21,c31,c41,c51,c60) as t;</div><div>50000000<br><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;2.3秒</td><td style="line-height: 28px;"   >&nbsp;113秒</td><td style="line-height: 28px;"   >&nbsp;73秒</td></tr></table></div><div><br></div><div>4. select count(*) from (select t1.c1 from t1 join t2 on t1.c2=t2.c3) as t;</div><div>49996801</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;28秒</td><td style="line-height: 28px;"   >&nbsp;328秒</td><td style="line-height: 28px;"   >&nbsp;279秒</td></tr></table></div><div><br></div><div>5. select count(*) from (select t1.c1 from t1 join t2 on t1.c2=t2.c3 join t3 on t1.c3=t3.c5) as t;</div><div>49995545</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;72秒</td><td style="line-height: 28px;"   >&nbsp;736秒</td><td style="line-height: 28px;"   >&nbsp;551秒</td></tr></table></div><div><br></div><div>6. select count(*) from (select t1.c1 from t1 join t2 on t1.c2=t2.c3 join t3 on t1.c3=t3.c5 join t4 on t3.c5=t4.c6) as t;</div><div>50001556</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;103秒</td><td style="line-height: 28px;"   >&nbsp;923秒</td><td style="line-height: 28px;"   >&nbsp;706秒</td></tr></table></div><div><br></div><div>7. count(*) from (select t1.c1 from t1 join t2 on t1.c2=t2.c3 join t3 on t2.c3=t3.c4 join t4 on t3.c4=t4.c5 join t5 on t4.c5=t5.c6) as t;</div><div>50024539</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;125秒</td><td style="line-height: 28px;"   >&nbsp;981秒</td><td style="line-height: 28px;"   >&nbsp;737秒</td></tr></table></div><div><br></div><div><div>8. select count(*) from (&nbsp;<span style="line-height: 28px;"   >select t1.c1 from t1&nbsp;</span><span style="line-height: 28px;"   >join t2 on t1.c2=t2.c3&nbsp;</span><span style="line-height: 28px;"   >join t3 on t2.c3=t3.c4&nbsp;</span><span style="line-height: 28px;"   >join t4 on t3.c4=t4.c5&nbsp;</span><span style="line-height: 28px;"   >join t5 on t4.c5=t5.c6&nbsp;</span><span style="line-height: 28px;"   >where t1.c60 &lt; 100000&nbsp;</span><span style="line-height: 28px;"   >) as t;</span></div><div>98744</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;13秒</td><td style="line-height: 28px;"   >&nbsp;212秒</td><td style="line-height: 28px;"   >&nbsp;233秒</td></tr></table></div><div><br></div><div><span style="line-height: 28px;"   >9. select count(*) from (</span></div><div>select t1.c1 from t1&nbsp;</div><div>join t2 on t1.c2=t2.c3&nbsp;</div><div>join t3 on t2.c3=t3.c4&nbsp;</div><div>join t4 on t3.c4=t4.c5</div><div>join t5 on t4.c5=t5.c6</div><div>join t6 on t5.c5=t6.c6</div><div>join t7 on t6.c5=t7.c6</div><div>join t8 on t7.c5=t8.c6</div><div>join t9 on t8.c5=t9.c6</div><div>join t10 on t9.c5=t10.c6</div><div>join t11 on t10.c5=t11.c6</div><div>join t12 on t11.c5=t12.c6</div><div>join t13 on t12.c5=t13.c6</div><div>join t14 on t13.c5=t14.c6</div><div>join t15 on t14.c5=t15.c6</div><div>join t16 on t15.c5=t16.c6</div><div>join t17 on t16.c5=t17.c6</div><div>) as t;</div><div>50304982</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;310秒</td><td style="line-height: 28px;"   >&nbsp;5306秒 (16表)</td><td style="line-height: 28px;"   >&nbsp;4059秒</td></tr></table></div><div><br></div><div>10. select count(*) from (</div><div>select t1.c1 from t1&nbsp;</div><div>join t2 on t1.c2=t2.c3&nbsp;</div><div>join t3 on t2.c3=t3.c4&nbsp;</div><div>join t4 on t3.c4=t4.c5</div><div>join t5 on t4.c5=t5.c6</div><div>join t6 on t5.c5=t6.c6</div><div>join t7 on t6.c5=t7.c6</div><div>join t8 on t7.c5=t8.c6</div><div>join t9 on t8.c5=t9.c6</div><div>join t10 on t9.c5=t10.c6</div><div>join t11 on t10.c5=t11.c6</div><div>join t12 on t11.c5=t12.c6</div><div>join t13 on t12.c5=t13.c6</div><div>join t14 on t13.c5=t14.c6</div><div>join t15 on t14.c5=t15.c6</div><div>join t16 on t15.c5=t16.c6</div><div><span style="line-height: 28px;"   >join t17 on t16.c5=t17.c6</span></div><div>where t1.c60 &lt; 100000</div><div>) as t;</div><div>93771</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;46秒</td><td style="line-height: 28px;"   >&nbsp;2199秒 (16表)</td><td style="line-height: 28px;"   >&nbsp;2872秒</td></tr></table></div><div><br></div><div>11. select count(*) from (</div><div>select t1.c1 from t1&nbsp;</div><div>join t2 on t1.c1=t2.c3&nbsp;</div><div>join t3 on t2.c3=t3.c4&nbsp;</div><div>join t4 on t3.c4=t4.c5</div><div>join t5 on t4.c5=t5.c6</div><div>join t6 on t5.c5=t6.c6</div><div>join t7 on t6.c5=t7.c6</div><div>join t8 on t7.c5=t8.c6</div><div>join t9 on t8.c5=t9.c6</div><div>join t10 on t9.c5=t10.c6</div><div>join t11 on t10.c5=t11.c6</div><div>join t12 on t11.c5=t12.c6</div><div>join t13 on t12.c5=t13.c6</div><div>join t14 on t13.c5=t14.c6</div><div>join t15 on t14.c5=t15.c6</div><div>join t16 on t15.c5=t16.c6</div><div><span style="line-height: 28px;"   >join t17 on t16.c5=t17.c6</span></div><div>) as t;</div><div>50183000</div><div><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;262秒</td><td style="line-height: 28px;"   >&nbsp;3980秒 (16表)</td><td style="line-height: 28px;"   >&nbsp;3562秒</td></tr></table></div><div><br></div></div><div>12.&nbsp;</div><div><div>select count(*) from (</div><div>select t1.c1 from t1&nbsp;</div><div>join t2 on t1.c2=t2.c3&nbsp;</div><div>join t3 on t2.c3=t3.c4&nbsp;</div><div>join t4 on t3.c4=t4.c5</div><div>join t5 on t4.c5=t5.c6</div><div>join t6 on t5.c6=t6.c7</div><div>join t7 on t6.c7=t7.c8</div><div>join t8 on t7.c8=t8.c9</div><div>join t9 on t8.c9=t9.c10</div><div>join t10 on t9.c10=t10.c11</div><div>join t11 on t10.c11=t11.c12</div><div>join t12 on t11.c12=t12.c13</div><div>join t13 on t12.c13=t13.c14</div><div>join t14 on t13.c14=t14.c15</div><div>join t15 on t14.c15=t15.c16</div><div>join t16 on t15.c16=t16.c17</div><div>join t17 on t16.c17=t17.c18</div><div>where t1.c1&lt;10</div><div>) as t;</div></div><div><div style="line-height: 28px;"   >0</div><div style="line-height: 28px;"   ><table width="80%"   border="1"   cellpadding="1"   cellspacing="1"   style="line-height: 28px;"   ><tbody style="line-height: 28px;"   ><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >MonetDB</td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL行引擎</span></td><td style="line-height: 28px;"   >&nbsp;<span style="line-height: 28px; font-size: 16px;"   >PostgreSQL列引擎</span></td></tr><tr style="line-height: 28px;"   ><td style="line-height: 28px;"   >&nbsp;5秒</td><td style="line-height: 28px;"   >&nbsp;640秒 (16表)</td><td style="line-height: 28px;"   >&nbsp;1403秒</td></tr></table></div></div><div><br></div><div>以下是PostgreSQL列引擎详细的测试过程和结果 :&nbsp;</div><div><div style="line-height: 28px;"   >cstore_fdw的介绍和安装方法见</div><div style="line-height: 28px;"   ><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020144141052312/"   >http://blog.163.com/digoal@126/blog/static/16387704020144141052312/</a></div></div><div>创建fdw handler和server</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# CREATE EXTENSION cstore_fdw;</font></div><div><font size="2"   >CREATE EXTENSION</font></div></div><div><div><font size="2"   >digoal=# CREATE SERVER cstore_server FOREIGN DATA WRAPPER cstore_fdw;</font></div><div><font size="2"   >CREATE SERVER</font></div></div><p></p></pre></div><div>创建外部表存储目录</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 cstore_fdw]# mkdir /data01/cstore_dir</font></div><div><font size="2"   >[root@db-172-16-3-221 cstore_fdw]# chown postgres:postgres /data01/cstore_dir</font></div><p></p></pre></div><div>接下来创建外部表(注意, 外部表目前不支持PK约束, 所以不创建PK约束) :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create foreign table ft1 (c1 int,</font></div><div><font size="2"   >c2 int,</font></div><div><font size="2"   >c3 int,</font></div><div><font size="2"   >c4 int,</font></div><div><font size="2"   >c5 int,</font></div><div><font size="2"   >c6 int,</font></div><div><font size="2"   >c7 int,</font></div><div><font size="2"   >c8 int,</font></div><div><font size="2"   >c9 int,</font></div><div><font size="2"   >c10 int,</font></div><div><font size="2"   >c11 int,</font></div><div><font size="2"   >c12 int,</font></div><div><font size="2"   >c13 int,</font></div><div><font size="2"   >c14 int,</font></div><div><font size="2"   >c15 int,</font></div><div><font size="2"   >c16 int,</font></div><div><font size="2"   >c17 int,</font></div><div><font size="2"   >c18 int,</font></div><div><font size="2"   >c19 int,</font></div><div><font size="2"   >c20 int,</font></div><div><font size="2"   >c21 int,</font></div><div><font size="2"   >c22 int,</font></div><div><font size="2"   >c23 int,</font></div><div><font size="2"   >c24 int,</font></div><div><font size="2"   >c25 int,</font></div><div><font size="2"   >c26 int,</font></div><div><font size="2"   >c27 int,</font></div><div><font size="2"   >c28 int,</font></div><div><font size="2"   >c29 int,</font></div><div><font size="2"   >c30 int,</font></div><div><font size="2"   >c31 int,</font></div><div><font size="2"   >c32 int,</font></div><div><font size="2"   >c33 int,</font></div><div><font size="2"   >c34 int,</font></div><div><font size="2"   >c35 int,</font></div><div><font size="2"   >c36 int,</font></div><div><font size="2"   >c37 int,</font></div><div><font size="2"   >c38 int,</font></div><div><font size="2"   >c39 int,</font></div><div><font size="2"   >c40 int,</font></div><div><font size="2"   >c41 int,</font></div><div><font size="2"   >c42 int,</font></div><div><font size="2"   >c43 int,</font></div><div><font size="2"   >c44 int,</font></div><div><font size="2"   >c45 int,</font></div><div><font size="2"   >c46 int,</font></div><div><font size="2"   >c47 int,</font></div><div><font size="2"   >c48 int,</font></div><div><font size="2"   >c49 int,</font></div><div><font size="2"   >c50 int,</font></div><div><font size="2"   >c51 int,</font></div><div><font size="2"   >c52 int,</font></div><div><font size="2"   >c53 int,</font></div><div><font size="2"   >c54 int,</font></div><div><font size="2"   >c55 int,</font></div><div><font size="2"   >c56 int,</font></div><div><font size="2"   >c57 int,</font></div><div><font size="2"   >c58 int,</font></div><div><font size="2"   >c59 int,</font></div><div><font size="2"   >c60 int) server cstore_server&nbsp;</font></div><div><font size="2"   >options (filename '/data01/cstore_dir/ft1.cstore', compression 'pglz');</font></div><p></p></pre></div><div>导入测试数据, 测试数据生成方法见</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014715113449394/"   >http://blog.163.com/digoal@126/blog/static/1638770402014715113449394/</a></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 testsql2]# ll</font></div><div><font size="2"   >total 25716276</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646532347 Aug 15 15:54 10.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646537517 Aug 15 15:55 11.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646522483 Aug 15 15:55 12.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646524530 Aug 15 15:55 13.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646534753 Aug 15 15:56 14.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646527810 Aug 15 15:56 15.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646535257 Aug 15 15:57 16.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1642296488 Aug 15 15:57 1.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1643393480 Aug 15 15:57 2.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1643415513 Aug 15 15:58 3.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1645910749 Aug 15 15:58 4.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646517090 Aug 15 15:59 5.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646526742 Aug 15 15:59 6.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646523866 Aug 15 15:59 7.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646531161 Aug 15 16:00 8.sql</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1646529088 Aug 15 16:00 9.sql</font></div><div><font size="2"   >[root@db-172-16-3-221 testsql2]# less 1.sql</font></div><div><font size="2"   >1|33323037|7973589|30570956|1817394|19184567|44691789|34510510|33979891|13926060|34242436|19034544|16183332|43653270|41510685|1826245|39039193|45247300|13238287|32402570|22203231|27234075|11087825|6221607|13725964|23752712|10179671|9717751|43518783|29456195|22325774|3996169|12779233|30299364|34567126|14596627|49483931|29258916|49107138|33463823|43184976|33349574|2498367|9368309|27002845|44009052|11194555|16042038|39256353|24432842|48444609|11459584|1666918|9532434|17681192|15392882|33285146|27860863|25110633|26803929</font></div><div><font size="2"   >2|7317059|47436408|30800099|20096292|27735772|15367226|34692920|27219704|44626142|33800058|10683527|37811119|17149632|13181894|47179428|44152477|7190947|8373984|10194516|46447300|32806827|8639125|7906885|34473745|18171559|25588077|49866628|1456706|3448940|24977262|28260636|10766000|22413670|9060735|30862292|149442|24427961|15555213|27369147|19054104|49355271|38052674|6865223|16504903|1234569|4044652|10657381|8425516|12418636|20851897|4872817|45225464|29491023|12779702|29699209|47662583|38367779|29565837|49119289</font></div><div><font size="2"   >.......</font></div><p></p></pre></div><div>导入脚本 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >#!/bin/bash</font></div><div><font size="2"   >psql &lt;&lt;EOF</font></div><div><font size="2"   >\timing</font></div><div><span style="line-height: 28px;"   ><font size="2"   >copy ft1 from '/opt/testsql2/1.sql' with csv delimiter '|';</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >copy ft1 from '/opt/testsql2/2.sql' with csv delimiter '|';</font></span></div><div><font size="2"   >copy ft1 from '/opt/testsql2/3.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/4.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/5.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/6.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/7.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/8.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/9.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/10.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/11.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/12.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/13.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/14.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/15.sql' with csv delimiter '|';</font></div><div><font size="2"   >copy ft1 from '/opt/testsql2/16.sql' with csv delimiter '|';</font></div><div><font size="2"   >\q</font></div><div><font size="2"   >EOF</font></div><p></p></pre></div><div>导入效率 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 87673.278 ms</font></div></div><div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 86130.378 ms</font></div></div><div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 85473.444 ms</font></div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 83736.891 ms</font></div></div><div><span style="line-height: 28px;"   ><font size="2"   >COPY 3125000</font></span></div><div><div><font size="2"   >Time: 84052.830 ms</font></div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 84130.955 ms</font></div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 84063.729 ms</font></div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 84073.529 ms</font></div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 84470.295 ms</font></div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 85204.964 ms</font></div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 87938.947 ms</font></div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 85290.653 ms</font></div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 84120.752 ms</font></div></div><div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 84354.485 ms</font></div></div><div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 83958.781 ms</font></div></div><div><div><font size="2"   >COPY 3125000</font></div><div><font size="2"   >Time: 84603.499 ms</font></div></div><p></p></pre></div><div><br></div><div>空间占用 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 cstore_dir]# ll -h</font></div><div><font size="2"   >total 20G</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 09:56 ft1.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 09:56 ft1.cstore.footer</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >再创建16张同样的测试表 :&nbsp;</span></div><div>因为这里只是测试, 所以用复制文件的方法创建16个一样的表.&nbsp;</div><div>其实用软连接或者改options的方法更快.而且省空间.</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201471662253548/"   >http://blog.163.com/digoal@126/blog/static/163877040201471662253548/</a></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >create foreign table ft2 (c1 int,</font></div><div><font size="2"   >c2 int,</font></div><div><font size="2"   >c3 int,</font></div><div><font size="2"   >c4 int,</font></div><div><font size="2"   >c5 int,</font></div><div><font size="2"   >c6 int,</font></div><div><font size="2"   >c7 int,</font></div><div><font size="2"   >c8 int,</font></div><div><font size="2"   >c9 int,</font></div><div><font size="2"   >c10 int,</font></div><div><font size="2"   >c11 int,</font></div><div><font size="2"   >c12 int,</font></div><div><font size="2"   >c13 int,</font></div><div><font size="2"   >c14 int,</font></div><div><font size="2"   >c15 int,</font></div><div><font size="2"   >c16 int,</font></div><div><font size="2"   >c17 int,</font></div><div><font size="2"   >c18 int,</font></div><div><font size="2"   >c19 int,</font></div><div><font size="2"   >c20 int,</font></div><div><font size="2"   >c21 int,</font></div><div><font size="2"   >c22 int,</font></div><div><font size="2"   >c23 int,</font></div><div><font size="2"   >c24 int,</font></div><div><font size="2"   >c25 int,</font></div><div><font size="2"   >c26 int,</font></div><div><font size="2"   >c27 int,</font></div><div><font size="2"   >c28 int,</font></div><div><font size="2"   >c29 int,</font></div><div><font size="2"   >c30 int,</font></div><div><font size="2"   >c31 int,</font></div><div><font size="2"   >c32 int,</font></div><div><font size="2"   >c33 int,</font></div><div><font size="2"   >c34 int,</font></div><div><font size="2"   >c35 int,</font></div><div><font size="2"   >c36 int,</font></div><div><font size="2"   >c37 int,</font></div><div><font size="2"   >c38 int,</font></div><div><font size="2"   >c39 int,</font></div><div><font size="2"   >c40 int,</font></div><div><font size="2"   >c41 int,</font></div><div><font size="2"   >c42 int,</font></div><div><font size="2"   >c43 int,</font></div><div><font size="2"   >c44 int,</font></div><div><font size="2"   >c45 int,</font></div><div><font size="2"   >c46 int,</font></div><div><font size="2"   >c47 int,</font></div><div><font size="2"   >c48 int,</font></div><div><font size="2"   >c49 int,</font></div><div><font size="2"   >c50 int,</font></div><div><font size="2"   >c51 int,</font></div><div><font size="2"   >c52 int,</font></div><div><font size="2"   >c53 int,</font></div><div><font size="2"   >c54 int,</font></div><div><font size="2"   >c55 int,</font></div><div><font size="2"   >c56 int,</font></div><div><font size="2"   >c57 int,</font></div><div><font size="2"   >c58 int,</font></div><div><font size="2"   >c59 int,</font></div><div><font size="2"   >c60 int) server cstore_server&nbsp;</font></div><div><font size="2"   >options (filename '/data01/cstore_dir/ft2.cstore', compression 'pglz');</font></div></div><div><div><font size="2"   >postgres@db-172-16-3-221-&gt; cd /data01/cstore_dir/</font></div><div><font size="2"   >postgres@db-172-16-3-221-&gt; ll</font></div><div><font size="2"   >total 20G</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 09:56 ft1.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 09:56 ft1.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp; &nbsp;0 Aug 16 09:58 ft2.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp; 26 Aug 16 09:58 ft2.cstore.footer</font></div><div><font size="2"   >postgres@db-172-16-3-221-&gt; mv ft2.cstore ft2.cstore.bak</font></div><div><font size="2"   >postgres@db-172-16-3-221-&gt; mv ft2.cstore.footer ft2.cstore.footer.bak</font></div><div><font size="2"   >postgres@db-172-16-3-221-&gt; cp ft1.cstore ft2.cstore</font></div><div><font size="2"   >postgres@db-172-16-3-221-&gt; cp ft1.cstore.footer ft2.cstore.footer&nbsp;</font></div></div><p></p></pre></div><div>其他同上, 创建其他15个表, 并复制数据文件, 略.</div><div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# \det+</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List of foreign tables</font></div><div><font size="2"   >&nbsp;Schema | Table | &nbsp; &nbsp;Server &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FDW Options &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Description&nbsp;</font></div><div><font size="2"   >--------+-------+---------------+-----------------------------------------------------------------+-------------</font></div><div><font size="2"   >&nbsp;public | ft1 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft1.cstore', compression 'pglz') &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft10 &nbsp;| cstore_server | (filename '/data01/cstore_dir/ft10.cstore', compression 'pglz') |&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft11 &nbsp;| cstore_server | (filename '/data01/cstore_dir/ft11.cstore', compression 'pglz') |&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft12 &nbsp;| cstore_server | (filename '/data01/cstore_dir/ft12.cstore', compression 'pglz') |&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft13 &nbsp;| cstore_server | (filename '/data01/cstore_dir/ft13.cstore', compression 'pglz') |&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft14 &nbsp;| cstore_server | (filename '/data01/cstore_dir/ft14.cstore', compression 'pglz') |&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft15 &nbsp;| cstore_server | (filename '/data01/cstore_dir/ft15.cstore', compression 'pglz') |&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft16 &nbsp;| cstore_server | (filename '/data01/cstore_dir/ft16.cstore', compression 'pglz') |&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft17 &nbsp;| cstore_server | (filename '/data01/cstore_dir/ft17.cstore', compression 'pglz') |&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft2 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft2.cstore', compression 'pglz') &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft3 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft3.cstore', compression 'pglz') &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft4 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft4.cstore', compression 'pglz') &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft5 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft5.cstore', compression 'pglz') &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft6 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft6.cstore', compression 'pglz') &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft7 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft7.cstore', compression 'pglz') &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft8 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft8.cstore', compression 'pglz') &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;public | ft9 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft9.cstore', compression 'pglz') &nbsp;|&nbsp;</font></div><div><font size="2"   >(17 rows)</font></div><p></p></pre></div></div><div><br></div><div><div style="line-height: 28px;"   >分析所有外部表 :&nbsp;</div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >digoal=# analyze ft1;</font></div><div style="line-height: 28px;"   ><font size="2"   >ANALYZE</font></div><div style="line-height: 28px;"   ><font size="2"   >Time: 148885.149 ms</font></div><div style="line-height: 28px;"   ><font size="2"   >...</font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >digoal=# analyze ft17;</font></div><div style="line-height: 28px;"   ><font size="2"   >ANALYZE</font></div></div><p></p></pre></div></div></div><div><br></div><div>查询测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# select count(distinct c1) from ft1;</font></div><div><font size="2"   >&nbsp; count &nbsp;&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;50000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 41536.070 ms</font></div></div><div><div><font size="2"   >digoal=# select count(*) from (select c1,c11,c21,c31,c41,c51,c60 from ft1 group by c1,c11,c21,c31,c41,c51,c60) as t;</font></div><div><font size="2"   >&nbsp; count &nbsp;&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;50000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 73486.646 ms</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=# select count(*) from (select ft1.c1 from ft1 join ft2 on ft1.c2=ft2.c3) as t;</font></div><div><font size="2"   >&nbsp; count &nbsp;&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;49996801</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 279239.085 ms</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=# select count(*) from (select ft1.c1 from ft1 join ft2 on ft1.c2=ft2.c3 join ft3 on ft1.c3=ft3.c5) as t;</font></div><div><font size="2"   >&nbsp; count &nbsp;&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;49995545</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 551466.035 ms</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=# select count(*) from (select ft1.c1 from ft1 join ft2 on ft1.c2=ft2.c3 join ft3 on ft1.c3=ft3.c5 join ft4 on ft3.c5=ft4.c6) as t;</font></div><div><font size="2"   >&nbsp; count &nbsp;&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;50001556</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 706267.651 ms</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=# select count(*) from (select ft1.c1 from ft1 join ft2 on ft1.c2=ft2.c3 join ft3 on ft2.c3=ft3.c4 join ft4 on ft3.c4=ft4.c5 join ft5 on ft4.c5=ft5.c6) as t;</font></div><div><font size="2"   >&nbsp; count &nbsp;&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;50024539</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 736699.900 ms</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=# select count(*) from (</font></div><div><font size="2"   >select ft1.c1 from ft1&nbsp;</font></div><div><font size="2"   >join ft2 on ft1.c2=ft2.c3&nbsp;</font></div><div><font size="2"   >join ft3 on ft2.c3=ft3.c4&nbsp;</font></div><div><font size="2"   >join ft4 on ft3.c4=ft4.c5</font></div><div><font size="2"   >join ft5 on ft4.c5=ft5.c6</font></div><div><font size="2"   >where ft1.c60 &lt; 100000</font></div><div><font size="2"   >) as t;</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp;98744</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 232810.249 ms</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select count(*) from (<br>select ft1.c1 from ft1 <br>join ft2 on ft1.c2=ft2.c3 <br>join ft3 on ft2.c3=ft3.c4 <br>join ft4 on ft3.c4=ft4.c5<br>join ft5 on ft4.c5=ft5.c6<br>join ft6 on ft5.c5=ft6.c6<br>join ft7 on ft6.c5=ft7.c6<br>join ft8 on ft7.c5=ft8.c6<br>join ft9 on ft8.c5=ft9.c6<br>join ft10 on ft9.c5=ft10.c6<br>join ft11 on ft10.c5=ft11.c6<br>join ft12 on ft11.c5=ft12.c6<br>join ft13 on ft12.c5=ft13.c6<br>join ft14 on ft13.c5=ft14.c6<br>join ft15 on ft14.c5=ft15.c6<br>join ft16 on ft15.c5=ft16.c6<br>join ft17 on ft16.c5=ft17.c6<br>) as t;</font></div><div><font size="2"   >  count   <br>----------<br> 50338741<br>(1 row)<br>Time: 4059635.466 ms</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select count(*) from (<br>select ft1.c1 from ft1 <br>join ft2 on ft1.c2=ft2.c3 <br>join ft3 on ft2.c3=ft3.c4 <br>join ft4 on ft3.c4=ft4.c5<br>join ft5 on ft4.c5=ft5.c6<br>join ft6 on ft5.c5=ft6.c6<br>join ft7 on ft6.c5=ft7.c6<br>join ft8 on ft7.c5=ft8.c6<br>join ft9 on ft8.c5=ft9.c6<br>join ft10 on ft9.c5=ft10.c6<br>join ft11 on ft10.c5=ft11.c6<br>join ft12 on ft11.c5=ft12.c6<br>join ft13 on ft12.c5=ft13.c6<br>join ft14 on ft13.c5=ft14.c6<br>join ft15 on ft14.c5=ft15.c6<br>join ft16 on ft15.c5=ft16.c6<br>join ft17 on ft16.c5=ft17.c6<br>where ft1.c60 &lt; 100000<br>) as t;<br> count <br>-------<br> 94635<br>(1 row)<br>Time: 2872032.780 ms</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select count(*) from (<br>select ft1.c1 from ft1 <br>join ft2 on ft1.c1=ft2.c3 <br>join ft3 on ft2.c3=ft3.c4 <br>join ft4 on ft3.c4=ft4.c5<br>join ft5 on ft4.c5=ft5.c6<br>join ft6 on ft5.c5=ft6.c6<br>join ft7 on ft6.c5=ft7.c6<br>join ft8 on ft7.c5=ft8.c6<br>join ft9 on ft8.c5=ft9.c6<br>join ft10 on ft9.c5=ft10.c6<br>join ft11 on ft10.c5=ft11.c6<br>join ft12 on ft11.c5=ft12.c6<br>join ft13 on ft12.c5=ft13.c6<br>join ft14 on ft13.c5=ft14.c6<br>join ft15 on ft14.c5=ft15.c6<br>join ft16 on ft15.c5=ft16.c6<br>join ft17 on ft16.c5=ft17.c6<br>) as t;<br>  count   <br>----------<br> 50222475<br>(1 row)<br>Time: 3562364.934 ms</font></div><p></p></pre></div><div><br></div><div>[小结]</div><div>1. cstore存储性能好在于它的block index, 在使用where条件的情况下, 可以减少块的扫描.</div><div>显然对于全表扫没有作用.</div><div><p></p><div><div><span style="line-height: 28px;"   ><font size="2"   >block_row_count (optional): Number of rows per column block. The default is 10000. cstore_fdw compresses, creates skip indexes, and reads from disk at the block granularity. Increasing this value helps with compression and results in fewer reads from disk. However, higher values also reduce the probability of skipping over unrelated row blocks.</font></span></div></div><div><div><font size="2"   >Using Skip Indexes</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >cstore_fdw partitions each column into multiple blocks. Skip indexes store minimum and maximum values for each of these blocks. While scanning the table, if min/max values of the block contradict the WHERE clause, then the block is completely skipped. This way, the query processes less data and hence finishes faster.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >To use skip indexes more efficiently, you should load the data after sorting it on a column that is commonly used in the WHERE clause. This ensures that there is a minimum overlap between blocks and the chance of them being skipped is higher.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >In practice, the data generally has an inherent dimension (for example a time field) on which it is naturally sorted. Usually, the queries also have a filter clause on that column (for example you want to query only the last week's data), and hence you don't need to sort the data in such cases.</font></div></div><p></p></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020144141052312/"   >http://blog.163.com/digoal@126/blog/static/16387704020144141052312/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/citusdata/cstore_fdw"   >https://github.com/citusdata/cstore_fdw</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.rackspace.com/knowledge_center/article/installing-rhel-epel-repo-on-centos-5x-or-6x"   >http://www.rackspace.com/knowledge_center/article/installing-rhel-epel-repo-on-centos-5x-or-6x</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201471593653444/"   >http://blog.163.com/digoal@126/blog/static/163877040201471593653444/</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL cstore_fdw column-ORI table VS MonetDB (with fixed-length width table) - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">byfei163 - 2014-08-20 16:15:29</h5>
				<div>monetdb性能确实非常好，但有几个担心的地方：（1）稳定性，用的过程中突然crash，我碰到过2次了；（2）monetdb充分利用cpu和IO，某个进程可能会占用过多的资源导致其他进程比较卡，如，大批量导入数据的同时，另外的进程在查询。</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 byfei163 - 2014-08-20 16:15:29</h5>
				<div style="width:600px;">HI, 离线系统和在线系统的稳定性要求没有那么高, 可以考虑一下使用场景. 可以配置线程数来减少CPU的使用率.</div>
			</div>
	</div>
</div>
</body>
</html>