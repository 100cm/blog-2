<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">we can porting cstore_fdw table by copy datafile freedom</h2>
	<h5 id="">2014-08-16 18:38:58&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201471662253548/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>在写MonetDB VS PostgreSQL cstore_fdw的文章时, 提到cstore_fdw的表, 当创建好一个以后, 如果需要复制同样的cstore_fdw表, 只需要拷贝文件即可, 这和文件外部表类似, 其实创建软链接也可以, 改options也可以, 这里只是为了快速的达到复制几个同样的外部表的目的.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres@db-172-16-3-221-&gt; cd /data01/cstore_dir/</font></div><div><font size="2"   >postgres@db-172-16-3-221-&gt; ll</font></div><div><font size="2"   >total 197G</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:26 ft10.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:26 ft10.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:27 ft11.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:27 ft11.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:27 ft12.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:27 ft12.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:27 ft13.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:27 ft13.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:28 ft14.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:28 ft14.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:28 ft15.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:28 ft15.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:28 ft16.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:28 ft16.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:29 ft17.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:29 ft17.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 09:56 ft1.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 09:56 ft1.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 09:59 ft2.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 09:59 ft2.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:29 ft3.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:24 ft3.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:24 ft4.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:24 ft4.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:25 ft5.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:25 ft5.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:25 ft6.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:25 ft6.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:25 ft7.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:25 ft7.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:26 ft8.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:26 ft8.cstore.footer</font></div><div><font size="2"   >-rw------- 1 postgres postgres &nbsp;12G Aug 16 10:26 ft9.cstore</font></div><div><font size="2"   >-rw------- 1 postgres postgres 6.6K Aug 16 10:26 ft9.cstore.footer</font></div><div><font size="2"   >postgres@db-172-16-3-221-&gt; mv ft9.cstore ft9.cstore.bak</font></div><div><font size="2"   >postgres@db-172-16-3-221-&gt; mv ft9.cstore.footer ft9.cstore.footer.bak</font></div><div><font size="2"   >postgres@db-172-16-3-221-&gt; ln -s /data01/cstore_dir/ft1.cstore ./ft9.cstore</font></div><div><font size="2"   >postgres@db-172-16-3-221-&gt; ln -s /data01/cstore_dir/ft1.cstore.footer ./ft9.cstore.footer</font></div></div><div><div><font size="2"   >postgres@db-172-16-3-221-&gt; psql</font></div><div><font size="2"   >psql (9.3.5)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select * from ft9 limit 1;</font></div><div><font size="2"   >&nbsp;c1 | &nbsp; &nbsp;c2 &nbsp; &nbsp;| &nbsp; c3 &nbsp; &nbsp;| &nbsp; &nbsp;c4 &nbsp; &nbsp;| &nbsp; c5 &nbsp; &nbsp;| &nbsp; &nbsp;c6 &nbsp; &nbsp;| &nbsp; &nbsp;c7 &nbsp; &nbsp;| &nbsp; &nbsp;c8 &nbsp; &nbsp;| &nbsp; &nbsp;c9 &nbsp; &nbsp;| &nbsp; c10 &nbsp; &nbsp;| &nbsp; c11 &nbsp; &nbsp;| &nbsp; c12 &nbsp; &nbsp;| &nbsp; c13 &nbsp;</font></div><div><font size="2"   >&nbsp; | &nbsp; c14 &nbsp; &nbsp;| &nbsp; c15 &nbsp; &nbsp;| &nbsp; c16 &nbsp; | &nbsp; c17 &nbsp; &nbsp;| &nbsp; c18 &nbsp; &nbsp;| &nbsp; c19 &nbsp; &nbsp;| &nbsp; c20 &nbsp; &nbsp;| &nbsp; c21 &nbsp; &nbsp;| &nbsp; c22 &nbsp; &nbsp;| &nbsp; c23 &nbsp; &nbsp;| &nbsp; c24 &nbsp; | &nbsp; c25 &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; c26 &nbsp; &nbsp;| &nbsp; c27 &nbsp; &nbsp;| &nbsp; c28 &nbsp; | &nbsp; c29 &nbsp; &nbsp;| &nbsp; c30 &nbsp; &nbsp;| &nbsp; c31 &nbsp; &nbsp;| &nbsp; c32 &nbsp; | &nbsp; c33 &nbsp; &nbsp;| &nbsp; c34 &nbsp; &nbsp;| &nbsp; c35 &nbsp; &nbsp;| &nbsp; c36 &nbsp; &nbsp;| &nbsp; c37 &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp; c38 &nbsp; &nbsp;| &nbsp; c39 &nbsp; &nbsp;| &nbsp; c40 &nbsp; &nbsp;| &nbsp; c41 &nbsp; &nbsp;| &nbsp; c42 &nbsp; &nbsp;| &nbsp; c43 &nbsp; | &nbsp; c44 &nbsp; | &nbsp; c45 &nbsp; &nbsp;| &nbsp; c46 &nbsp; &nbsp;| &nbsp; c47 &nbsp; &nbsp;| &nbsp; c48 &nbsp; &nbsp;| &nbsp; c49 &nbsp; &nbsp;| &nbsp;&nbsp;</font></div><div><font size="2"   >c50 &nbsp; &nbsp;| &nbsp; c51 &nbsp; &nbsp;| &nbsp; c52 &nbsp; &nbsp;| &nbsp; c53 &nbsp; | &nbsp; c54 &nbsp; | &nbsp; c55 &nbsp; &nbsp;| &nbsp; c56 &nbsp; &nbsp;| &nbsp; c57 &nbsp; &nbsp;| &nbsp; c58 &nbsp; &nbsp;| &nbsp; c59 &nbsp; &nbsp;| &nbsp; c60 &nbsp; &nbsp;</font></div><div><font size="2"   >----+----------+---------+----------+---------+----------+----------+----------+----------+----------+----------+----------+--------</font></div><div><font size="2"   >--+----------+----------+---------+----------+----------+----------+----------+----------+----------+----------+---------+----------</font></div><div><font size="2"   >+----------+----------+---------+----------+----------+----------+---------+----------+----------+----------+----------+----------+-</font></div><div><font size="2"   >---------+----------+----------+----------+----------+---------+---------+----------+----------+----------+----------+----------+---</font></div><div><font size="2"   >-------+----------+----------+---------+---------+----------+----------+----------+----------+----------+----------</font></div><div><font size="2"   >&nbsp; 1 | 33323037 | 7973589 | 30570956 | 1817394 | 19184567 | 44691789 | 34510510 | 33979891 | 13926060 | 34242436 | 19034544 | 1618333</font></div><div><font size="2"   >2 | 43653270 | 41510685 | 1826245 | 39039193 | 45247300 | 13238287 | 32402570 | 22203231 | 27234075 | 11087825 | 6221607 | 13725964&nbsp;</font></div><div><font size="2"   >| 23752712 | 10179671 | 9717751 | 43518783 | 29456195 | 22325774 | 3996169 | 12779233 | 30299364 | 34567126 | 14596627 | 49483931 |&nbsp;</font></div><div><font size="2"   >29258916 | 49107138 | 33463823 | 43184976 | 33349574 | 2498367 | 9368309 | 27002845 | 44009052 | 11194555 | 16042038 | 39256353 | 24</font></div><div><font size="2"   >432842 | 48444609 | 11459584 | 1666918 | 9532434 | 17681192 | 15392882 | 33285146 | 27860863 | 25110633 | 26803929</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# \det+ ft9</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of foreign tables</font></div><div><font size="2"   >&nbsp;Schema | Table | &nbsp; &nbsp;Server &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FDW Options &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Description&nbsp;</font></div><div><font size="2"   >--------+-------+---------------+----------------------------------------------------------------+-------------</font></div><div><font size="2"   >&nbsp;public | ft9 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft9.cstore', compression 'pglz') |&nbsp;</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><br></div><div>改options的方法, 多个外部表指向同一个文件.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# alter foreign table ft9 options(set filename '/data01/cstore_dir/ft1.cstore');</font></div><div><font size="2"   >ALTER FOREIGN TABLE</font></div><div><font size="2"   >digoal=# \det+ ft9</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of foreign tables</font></div><div><font size="2"   >&nbsp;Schema | Table | &nbsp; &nbsp;Server &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FDW Options &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Description&nbsp;</font></div><div><font size="2"   >--------+-------+---------------+----------------------------------------------------------------+-------------</font></div><div><font size="2"   >&nbsp;public | ft9 &nbsp; | cstore_server | (filename '/data01/cstore_dir/ft1.cstore', compression 'pglz') |&nbsp;</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select * from ft9 limit 1;</font></div><div><font size="2"   >&nbsp;c1 | &nbsp; &nbsp;c2 &nbsp; &nbsp;| &nbsp; c3 &nbsp; &nbsp;| &nbsp; &nbsp;c4 &nbsp; &nbsp;| &nbsp; c5 &nbsp; &nbsp;| &nbsp; &nbsp;c6 &nbsp; &nbsp;| &nbsp; &nbsp;c7 &nbsp; &nbsp;| &nbsp; &nbsp;c8 &nbsp; &nbsp;| &nbsp; &nbsp;c9 &nbsp; &nbsp;| &nbsp; c10 &nbsp; &nbsp;| &nbsp; c11 &nbsp; &nbsp;| &nbsp; c12 &nbsp; &nbsp;| &nbsp; c13 &nbsp;</font></div><div><font size="2"   >&nbsp; | &nbsp; c14 &nbsp; &nbsp;| &nbsp; c15 &nbsp; &nbsp;| &nbsp; c16 &nbsp; | &nbsp; c17 &nbsp; &nbsp;| &nbsp; c18 &nbsp; &nbsp;| &nbsp; c19 &nbsp; &nbsp;| &nbsp; c20 &nbsp; &nbsp;| &nbsp; c21 &nbsp; &nbsp;| &nbsp; c22 &nbsp; &nbsp;| &nbsp; c23 &nbsp; &nbsp;| &nbsp; c24 &nbsp; | &nbsp; c25 &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; c26 &nbsp; &nbsp;| &nbsp; c27 &nbsp; &nbsp;| &nbsp; c28 &nbsp; | &nbsp; c29 &nbsp; &nbsp;| &nbsp; c30 &nbsp; &nbsp;| &nbsp; c31 &nbsp; &nbsp;| &nbsp; c32 &nbsp; | &nbsp; c33 &nbsp; &nbsp;| &nbsp; c34 &nbsp; &nbsp;| &nbsp; c35 &nbsp; &nbsp;| &nbsp; c36 &nbsp; &nbsp;| &nbsp; c37 &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp; c38 &nbsp; &nbsp;| &nbsp; c39 &nbsp; &nbsp;| &nbsp; c40 &nbsp; &nbsp;| &nbsp; c41 &nbsp; &nbsp;| &nbsp; c42 &nbsp; &nbsp;| &nbsp; c43 &nbsp; | &nbsp; c44 &nbsp; | &nbsp; c45 &nbsp; &nbsp;| &nbsp; c46 &nbsp; &nbsp;| &nbsp; c47 &nbsp; &nbsp;| &nbsp; c48 &nbsp; &nbsp;| &nbsp; c49 &nbsp; &nbsp;| &nbsp;&nbsp;</font></div><div><font size="2"   >c50 &nbsp; &nbsp;| &nbsp; c51 &nbsp; &nbsp;| &nbsp; c52 &nbsp; &nbsp;| &nbsp; c53 &nbsp; | &nbsp; c54 &nbsp; | &nbsp; c55 &nbsp; &nbsp;| &nbsp; c56 &nbsp; &nbsp;| &nbsp; c57 &nbsp; &nbsp;| &nbsp; c58 &nbsp; &nbsp;| &nbsp; c59 &nbsp; &nbsp;| &nbsp; c60 &nbsp; &nbsp;</font></div><div><font size="2"   >----+----------+---------+----------+---------+----------+----------+----------+----------+----------+----------+----------+--------</font></div><div><font size="2"   >--+----------+----------+---------+----------+----------+----------+----------+----------+----------+----------+---------+----------</font></div><div><font size="2"   >+----------+----------+---------+----------+----------+----------+---------+----------+----------+----------+----------+----------+-</font></div><div><font size="2"   >---------+----------+----------+----------+----------+---------+---------+----------+----------+----------+----------+----------+---</font></div><div><font size="2"   >-------+----------+----------+---------+---------+----------+----------+----------+----------+----------+----------</font></div><div><font size="2"   >&nbsp; 1 | 33323037 | 7973589 | 30570956 | 1817394 | 19184567 | 44691789 | 34510510 | 33979891 | 13926060 | 34242436 | 19034544 | 1618333</font></div><div><font size="2"   >2 | 43653270 | 41510685 | 1826245 | 39039193 | 45247300 | 13238287 | 32402570 | 22203231 | 27234075 | 11087825 | 6221607 | 13725964&nbsp;</font></div><div><font size="2"   >| 23752712 | 10179671 | 9717751 | 43518783 | 29456195 | 22325774 | 3996169 | 12779233 | 30299364 | 34567126 | 14596627 | 49483931 |&nbsp;</font></div><div><font size="2"   >29258916 | 49107138 | 33463823 | 43184976 | 33349574 | 2498367 | 9368309 | 27002845 | 44009052 | 11194555 | 16042038 | 39256353 | 24</font></div><div><font size="2"   >432842 | 48444609 | 11459584 | 1666918 | 9532434 | 17681192 | 15392882 | 33285146 | 27860863 | 25110633 | 26803929</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div><br></div><div>如果要在多个数据库之间复制外部表的话, 拷贝文件是个不错的方法, 例如从一个机房拷贝到另一个机房的需求.</div><div>但是需要注意外部表的options要一致, 例如stripe和chunk size.</div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201471691955155/"   >http://blog.163.com/digoal@126/blog/static/163877040201471691955155/</a></div><div>2.&nbsp;<a style="line-height: 28px; text-decoration: none; color: rgb(85, 108, 136); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020144141052312/"   >http://blog.163.com/digoal@126/blog/static/16387704020144141052312/</a></div></div>
	</div>
</div>
</body>
</html>