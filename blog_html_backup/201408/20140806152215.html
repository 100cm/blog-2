<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">oVirt 3.4.3-1 cann't create disk image in GlusterFS DATA STORAGE BUG</h2>
	<h5 id="">2014-08-06 15:22:15&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020147632024869/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>前面刚遇到一个不能使用gluster的bug,&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020147623132332/"   >http://blog.163.com/digoal@126/blog/static/16387704020147623132332/</a></div><div>现在又一个, 现在这个是我手工创建的glusterfs volume, 然后在ovirt的storage中新建一个domain, 使用DATA/GlusterFS挂载, 挂载成功了.</div><div>但是在后面就出问题了, 创建虚拟机时, 如果选择使用GlusterFS的domain, 新建disk image会失败.</div><div>有其他的朋友也报过这个BUG:</div><a target="_blank" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=1102530"   >https://bugzilla.redhat.com/show_bug.cgi?id=1102530</a><br><wbr><div><br></div><div>engine.log错误如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >2014-08-06 15:11:28,764 INFO &nbsp;[org.ovirt.engine.core.bll.AddDiskCommand] (ajp--127.0.0.1-8702-4) [21988e55] Lock Acquired to object EngineLock [exclusiveLocks= key: dfa78f98-7662-4018-af87-feaf864f082d value: VM_DISK_BOOT</font></div><div><font size="2"   >, sharedLocks= key: dfa78f98-7662-4018-af87-feaf864f082d value: VM</font></div><div><font size="2"   >]</font></div><div><font size="2"   >2014-08-06 15:11:28,778 INFO &nbsp;[org.ovirt.engine.core.bll.AddDiskCommand] (ajp--127.0.0.1-8702-4) [21988e55] Running command: AddDiskCommand internal: false. Entities affected : &nbsp;ID: dfa78f98-7662-4018-af87-feaf864f082d Type: VM, &nbsp;ID: 1be971c4-a337-443e-b2b5-bb436a98db4c Type: Storage</font></div><div><font size="2"   >2014-08-06 15:11:28,800 INFO &nbsp;[org.ovirt.engine.core.bll.AddImageFromScratchCommand] (ajp--127.0.0.1-8702-4) [64290344] Running command: AddImageFromScratchCommand internal: true. Entities affected : &nbsp;ID: 1be971c4-a337-443e-b2b5-bb436a98db4c Type: Storage</font></div><div><font size="2"   >2014-08-06 15:11:28,806 INFO &nbsp;[org.ovirt.engine.core.bll.AddImageFromScratchCommand] (ajp--127.0.0.1-8702-4) [64290344] Lock freed to object EngineLock [exclusiveLocks= key: dfa78f98-7662-4018-af87-feaf864f082d value: VM_DISK_BOOT</font></div><div><font size="2"   >, sharedLocks= key: dfa78f98-7662-4018-af87-feaf864f082d value: VM</font></div><div><font size="2"   >]</font></div><div><font size="2"   >2014-08-06 15:11:28,808 INFO &nbsp;[org.ovirt.engine.core.vdsbroker.irsbroker.CreateImageVDSCommand] (ajp--127.0.0.1-8702-4) [64290344] START, CreateImageVDSCommand( storagePoolId = 00000002-0002-0002-0002-0000000000ec, ignoreFailoverLimit = false, storageDomainId = 1be971c4-a337-443e-b2b5-bb436a98db4c, imageGroupId = 90af4e49-9b09-4637-a258-60440bab8db9, imageSizeInBytes = 10737418240, volumeFormat = RAW, newImageId = 28092531-592a-4d78-be22-102567154868, newImageDescription = ), log id: 616376a0</font></div><div><font size="2"   >2014-08-06 15:11:28,811 INFO &nbsp;[org.ovirt.engine.core.vdsbroker.irsbroker.CreateImageVDSCommand] (ajp--127.0.0.1-8702-4) [64290344] -- executeIrsBrokerCommand: calling 'createVolume' with two new parameters: description and UUID</font></div><div><font size="2"   >2014-08-06 15:11:28,881 INFO &nbsp;[org.ovirt.engine.core.vdsbroker.irsbroker.CreateImageVDSCommand] (ajp--127.0.0.1-8702-4) [64290344] FINISH, CreateImageVDSCommand, return: 28092531-592a-4d78-be22-102567154868, log id: 616376a0</font></div><div><font size="2"   >2014-08-06 15:11:28,886 INFO &nbsp;[org.ovirt.engine.core.bll.CommandAsyncTask] (ajp--127.0.0.1-8702-4) [64290344] CommandAsyncTask::Adding CommandMultiAsyncTasks object for command f46b9b9c-5fd3-4b2a-afce-640ff9fc7901</font></div><div><font size="2"   >2014-08-06 15:11:28,888 INFO &nbsp;[org.ovirt.engine.core.bll.CommandMultiAsyncTasks] (ajp--127.0.0.1-8702-4) [64290344] CommandMultiAsyncTasks::AttachTask: Attaching task 38caf2ab-a11d-4f03-9c90-acefa37bd812 to command f46b9b9c-5fd3-4b2a-afce-640ff9fc7901.</font></div><div><font size="2"   >2014-08-06 15:11:28,893 INFO &nbsp;[org.ovirt.engine.core.bll.AsyncTaskManager] (ajp--127.0.0.1-8702-4) [64290344] Adding task 38caf2ab-a11d-4f03-9c90-acefa37bd812 (Parent Command AddDisk, Parameters Type org.ovirt.engine.core.common.asynctasks.AsyncTaskParameters), polling hasn't started yet..</font></div><div><font size="2"   >2014-08-06 15:11:28,923 INFO &nbsp;[org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector] (ajp--127.0.0.1-8702-4) [64290344] Correlation ID: 21988e55, Job ID: 6b55ff1d-767e-4483-b54a-e9d09850872a, Call Stack: null, Custom Event ID: -1, Message: Add-Disk operation of gv1_Disk1 was initiated on VM gv1 by admin.</font></div><div><font size="2"   >2014-08-06 15:11:28,925 INFO &nbsp;[org.ovirt.engine.core.bll.SPMAsyncTask] (ajp--127.0.0.1-8702-4) [64290344] BaseAsyncTask::startPollingTask: Starting to poll task 38caf2ab-a11d-4f03-9c90-acefa37bd812.</font></div><div><font size="2"   >2014-08-06 15:11:35,440 INFO &nbsp;[org.ovirt.engine.core.bll.AsyncTaskManager] (DefaultQuartzScheduler_Worker-18) Polling and updating Async Tasks: 3 tasks, 1 tasks to poll now</font></div><div><font size="2"   color="#ff0000"   ><b>2014-08-06 15:11:35,450 ERROR [org.ovirt.engine.core.vdsbroker.vdsbroker.HSMGetAllTasksStatusesVDSCommand] (DefaultQuartzScheduler_Worker-18) Failed in HSMGetAllTasksStatusesVDS method</b></font></div><div><font size="2"   >2014-08-06 15:11:35,451 INFO &nbsp;[org.ovirt.engine.core.bll.SPMAsyncTask] (DefaultQuartzScheduler_Worker-18) SPMAsyncTask::PollTask: Polling task 38caf2ab-a11d-4f03-9c90-acefa37bd812 (Parent Command AddDisk, Parameters Type org.ovirt.engine.core.common.asynctasks.AsyncTaskParameters) returned status finished, result 'cleanSuccess'.</font></div><div><font size="2"   color="#ff0000"   ><b>2014-08-06 15:11:35,455 ERROR [org.ovirt.engine.core.bll.SPMAsyncTask] (DefaultQuartzScheduler_Worker-18) BaseAsyncTask::LogEndTaskFailure: Task 38caf2ab-a11d-4f03-9c90-acefa37bd812 (Parent Command AddDisk, Parameters Type org.ovirt.engine.core.common.asynctasks.AsyncTaskParameters) ended with failure:</b></font></div><div><font size="2"   color="#ff0000"   ><b>-- Result: cleanSuccess</b></font></div><div><font size="2"   color="#ff0000"   ><b>-- Message: VDSGenericException: VDSErrorException: Failed to HSMGetAllTasksStatusesVDS, error = [Errno 2] No such file or directory: '/rhev/data-center/00000002-0002-0002-0002-0000000000ec/1be971c4-a337-443e-b2b5-bb436a98db4c/images/90af4e49-9b09-4637-a258-60440bab8db9', code = 100,</b></font></div><div><font size="2"   color="#ff0000"   ><b>-- Exception: VDSGenericException: VDSErrorException: Failed to HSMGetAllTasksStatusesVDS, error = [Errno 2] No such file or directory: '/rhev/data-center/00000002-0002-0002-0002-0000000000ec/1be971c4-a337-443e-b2b5-bb436a98db4c/images/90af4e49-9b09-4637-a258-60440bab8db9', code = 100</b></font></div><div><font size="2"   >2014-08-06 15:11:35,460 INFO &nbsp;[org.ovirt.engine.core.bll.CommandAsyncTask] (DefaultQuartzScheduler_Worker-18) CommandAsyncTask::EndActionIfNecessary: All tasks of command f46b9b9c-5fd3-4b2a-afce-640ff9fc7901 has ended -&gt; executing endAction</font></div><div><font size="2"   >2014-08-06 15:11:35,461 INFO &nbsp;[org.ovirt.engine.core.bll.CommandAsyncTask] (DefaultQuartzScheduler_Worker-18) CommandAsyncTask::endAction: Ending action for 1 tasks (command ID: f46b9b9c-5fd3-4b2a-afce-640ff9fc7901): calling endAction .</font></div><div><font size="2"   >2014-08-06 15:11:35,462 INFO &nbsp;[org.ovirt.engine.core.bll.CommandAsyncTask] (org.ovirt.thread.pool-6-thread-42) CommandAsyncTask::EndCommandAction [within thread] context: Attempting to endAction AddDisk, executionIndex: 0</font></div><div><font size="2"   color="#ff0000"   ><b>2014-08-06 15:11:35,468 ERROR [org.ovirt.engine.core.bll.AddDiskCommand] (org.ovirt.thread.pool-6-thread-42) [21988e55] Ending command with failure: org.ovirt.engine.core.bll.AddDiskCommand</b></font></div><div><font size="2"   >2014-08-06 15:11:35,472 ERROR [org.ovirt.engine.core.bll.AddImageFromScratchCommand] (org.ovirt.thread.pool-6-thread-42) [64290344] Ending command with failure: org.ovirt.engine.core.bll.AddImageFromScratchCommand</font></div><div><font size="2"   >2014-08-06 15:11:35,557 INFO &nbsp;[org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector] (org.ovirt.thread.pool-6-thread-42) Correlation ID: 21988e55, Job ID: 6b55ff1d-767e-4483-b54a-e9d09850872a, Call Stack: null, Custom Event ID: -1, Message: Operation Add-Disk failed to complete.</font></div><div><font size="2"   >2014-08-06 15:11:35,559 INFO &nbsp;[org.ovirt.engine.core.bll.CommandAsyncTask] (org.ovirt.thread.pool-6-thread-42) CommandAsyncTask::HandleEndActionResult [within thread]: endAction for action type AddDisk completed, handling the result.</font></div><div><font size="2"   >2014-08-06 15:11:35,561 INFO &nbsp;[org.ovirt.engine.core.bll.CommandAsyncTask] (org.ovirt.thread.pool-6-thread-42) CommandAsyncTask::HandleEndActionResult [within thread]: endAction for action type AddDisk succeeded, clearing tasks.</font></div><div><font size="2"   >2014-08-06 15:11:35,563 INFO &nbsp;[org.ovirt.engine.core.bll.SPMAsyncTask] (org.ovirt.thread.pool-6-thread-42) SPMAsyncTask::ClearAsyncTask: Attempting to clear task 38caf2ab-a11d-4f03-9c90-acefa37bd812</font></div><div><font size="2"   >2014-08-06 15:11:35,565 INFO &nbsp;[org.ovirt.engine.core.vdsbroker.irsbroker.SPMClearTaskVDSCommand] (org.ovirt.thread.pool-6-thread-42) START, SPMClearTaskVDSCommand( storagePoolId = 00000002-0002-0002-0002-0000000000ec, ignoreFailoverLimit = false, taskId = 38caf2ab-a11d-4f03-9c90-acefa37bd812), log id: 5e59ccce</font></div><div><font size="2"   >2014-08-06 15:11:35,590 INFO &nbsp;[org.ovirt.engine.core.vdsbroker.vdsbroker.HSMClearTaskVDSCommand] (org.ovirt.thread.pool-6-thread-42) START, HSMClearTaskVDSCommand(HostName = 150, HostId = 44379bb8-e87b-4e00-a18e-5df43922da82, taskId=38caf2ab-a11d-4f03-9c90-acefa37bd812), log id: 599518c6</font></div><div><font size="2"   >2014-08-06 15:11:35,604 INFO &nbsp;[org.ovirt.engine.core.vdsbroker.vdsbroker.HSMClearTaskVDSCommand] (org.ovirt.thread.pool-6-thread-42) FINISH, HSMClearTaskVDSCommand, log id: 599518c6</font></div><div><font size="2"   >2014-08-06 15:11:35,605 INFO &nbsp;[org.ovirt.engine.core.vdsbroker.irsbroker.SPMClearTaskVDSCommand] (org.ovirt.thread.pool-6-thread-42) FINISH, SPMClearTaskVDSCommand, log id: 5e59ccce</font></div><div><font size="2"   >2014-08-06 15:11:35,607 INFO &nbsp;[org.ovirt.engine.core.bll.SPMAsyncTask] (org.ovirt.thread.pool-6-thread-42) BaseAsyncTask::RemoveTaskFromDB: Removed task 38caf2ab-a11d-4f03-9c90-acefa37bd812 from DataBase</font></div><div><font size="2"   >2014-08-06 15:11:35,608 INFO &nbsp;[org.ovirt.engine.core.bll.CommandAsyncTask] (org.ovirt.thread.pool-6-thread-42) CommandAsyncTask::HandleEndActionResult [within thread]: Removing CommandMultiAsyncTasks object for entity f46b9b9c-5fd3-4b2a-afce-640ff9fc7901</font></div><div><font size="2"   >2014-08-06 15:11:45,199 INFO &nbsp;[org.ovirt.engine.core.bll.AsyncTaskManager] (DefaultQuartzScheduler_Worker-51) Setting new tasks map. The map contains now 1 tasks</font></div><p></p></pre></div><div>解决办法, 在oVirt的Storage中删除这个gfs , 并deatch. 然后重新加入oVirt. (可能是前面一个BUG的后遗症)</div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="oVirt 3.4.3-1 cannt create disk image in GlusterFS DATA STORAGE BUG - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>