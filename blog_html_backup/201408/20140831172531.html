<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64</h2>
	<h5 id="">2014-08-31 17:25:31&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014731111811804/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>首先要阅读requirement, 结合你的环境, 满足日后的使用, 需要合理的选择硬件, 以及需要的依赖组件或库.</div><div><a target="_blank" rel="nofollow" href="https://www.zabbix.com/documentation/2.2/manual/installation/requirements"   >https://www.zabbix.com/documentation/2.2/manual/installation/requirements</a></div><div>需要注意一下数据库大小的估算.</div><div>数据库里存放的数据包括, 配置信息, 历史数据, 报告数据(趋势数据), 事件数据.</div><div>这些数据量的评估, 首先和每秒server接收到的数据量有关, 例如我们配置了3000个监控条目, 每60秒监控一次, 那么每秒将受到3000/60=50条监控数据,&nbsp;</div><div>监控数据和监控配置有关, 可能存储的是数字, 或者字符串, 或者其他的值, 假设平均50个字节一条.</div><div>那么存放1年的历史数据需要50*24*60*60*365*50 bytes=73GB.</div><div>统计数据是指统计每小时的最大, 最小, 平均, COUNT值. 假设一个条目每小时需要128字节来存储统计信息.&nbsp;</div><div>同样假设有3000个监控条目, 那么存储1年的统计数据需要3000*24*365*128=16.8GB</div><div>最后是事件的存储, 事件指触发的事件, 这个比较难估算, 最坏来算每秒产生1个事件, 一个事件存储消耗130个字节, 那么保存3年的事件需要空间3*24*60*60*365*130=12.3GB</div><div><br></div><div>安装过程 :&nbsp;</div><div>下载稳定版本源码包</div><div><a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.zabbix.com/download.php"   >http://www.zabbix.com/download.php</a></div><div>zabbix-2.2.6.tar.gz</div><div><br></div><div>阅读安装说明</div><div><a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://www.zabbix.com/documentation/doku.php?id=2.2/manual/installation/install"   >https://www.zabbix.com/documentation/doku.php?id=2.2/manual/installation/install</a></div><div><br></div><div>1. 创建用户和组, 所有的zabbix daemon必须以普通用户运行来避免风险. 如果以root用于运行, 会自动切换到zabbix下运行. 如果以普通用户运行, 则<span style="line-height: 28px;"   >以运行daemon的普通用户运行. 除了不要以root来运行, 同时不要以有特权的任何普通用户运行daemon.</span></div><div>注意1: Running Zabbix as root, bin, or any other account with special rights is a security risk.</div><div>注意2: 如果server和agent在同一台机器的话, 务必使用不同的用户启动两个daemon, 因为如果使用同一个用户启动的话, agent很容易获取到server的配置文件, 所以建议使用不同的用户运行agent和server, 来分离权限.</div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 zabbix-2.2.6]# useradd zabbix</font></div><div><font size="2"   >[root@150 zabbix-2.2.6]# id zabbix</font></div><div><font size="2"   >uid=501(zabbix) gid=502(zabbix) groups=502(zabbix)</font></div><p></p></pre></div><div>如果同主机还需要运行agent, 建议再创建一个用户.</div><div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@150 soft_bak]# useradd zagent</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@150 soft_bak]# id zagent</font></div><div style="line-height: 28px;"   ><font size="2"   >uid=502(zagent) gid=503(zagent) groups=503(zagent)</font></div><p></p></pre></div></div></div><div><br></div><div>2. 创建数据库, zabbix server, proxy, WEB需要l连接数据库, agent不需要连接数据库.</div><div>同时zabbix server需要在数据库中生成一些数据, 而proxy只需要结构.</div><div>我们这里选用PostgreSQL 9.3.5, 编译安装一个, 安装过程和初始化数据库的过程略.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >useradd postgres</font></div><div><font size="2"   >tar -jxvf postgresql-9.3.5.tar.bz2</font></div><div><font size="2"   >cd postgresql-9.3.5</font></div><div><font size="2"   >./configure --prefix=/opt/pgsql9.3.5 --with-pgport=5432 --with-perl --with-tcl --with-python --with-openssl --with-pam --with-ldap --with-libxml --with-libxslt --enable-thread-safety</font></div><div><font size="2"   >gmake world &amp;&amp; gmake install-world</font></div><div><font size="2"   >ln -s /opt/pgsql9.3.5 /opt/pgsql</font></div><div><font size="2"   >vi /etc/profile</font></div><div><font size="2"   >export PATH=/opt/pgsql/bin:$PATH</font></div><div><font size="2"   >export MANPATH=/opt/pgsql/share/man:$MANPATH</font></div><div><font size="2"   >export&nbsp;LD_LIBRARY_PATH=/opt/pgsql/lib:$LD_LIBRARY_PATH</font></div><div><font size="2"   >mkdir -p /data03/pgdata/pg_root</font></div><div><font size="2"   >chown postgres:postgres&nbsp;<span style="line-height: 28px;"   >/data03/pgdata/pg_root</span></font></div><div><span style="line-height: 28px;"   ><font size="2"   >su - postgres</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >vi .bash_profile</font></span></div><div><div><font size="2"   >export PS1="$USER@`/bin/hostname -s`-&gt; "</font></div><div><font size="2"   >export PGPORT=5432</font></div><div><font size="2"   >export PGDATA=/data03/pgdata/pg_root</font></div><div><font size="2"   >export LANG=en_US.utf8</font></div><div><font size="2"   >export PGHOME=/opt/pgsql</font></div><div><font size="2"   >export LD_LIBRARY_PATH=$PGHOME/lib:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib:$LD_LIBRARY_PATH</font></div><div><font size="2"   >export DATE=`date +"%Y%m%d%H%M"`</font></div><div><font size="2"   >export PATH=$PGHOME/bin:$PATH:.</font></div><div><font size="2"   >export MANPATH=$PGHOME/share/man:$MANPATH</font></div><div><font size="2"   >export PGUSER=postgres</font></div><div><font size="2"   >export PGHOST=$PGDATA</font></div><div><font size="2"   >alias rm='rm -i'</font></div><div><font size="2"   >alias ll='ls -lh'</font></div><div><font size="2"   >export PGDATABASE=postgres</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   ><span style="line-height: 28px;"   >initdb -D&nbsp;</span><span style="line-height: 28px;"   >$PGDATA -E UTF8 --locale=C -U postgres -W</span></font></div><div><span style="line-height: 28px;"   ><font size="2"   >cd $PGDATA</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >vi postgresql.conf</font></span></div><div><div><font size="2"   >listen_addresses = '0.0.0.0' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# what IP address(es) to listen on;</font></div><div><font size="2"   >port = 5432 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >max_connections = 500 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >superuser_reserved_connections = 13 &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >unix_socket_directories = '.' &nbsp; # comma-separated list of directories</font></div><div><font size="2"   >unix_socket_permissions = 0700 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# begin with 0 to use octal notation</font></div><div><font size="2"   >tcp_keepalives_idle = 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPIDLE, in seconds;</font></div><div><font size="2"   >tcp_keepalives_interval = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPINTVL, in seconds;</font></div><div><font size="2"   >tcp_keepalives_count = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # TCP_KEEPCNT;</font></div><div><font size="2"   >shared_buffers = 2048MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 128kB</font></div><div><font size="2"   >maintenance_work_mem = 512MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# min 1MB</font></div><div><font size="2"   >shared_preload_libraries = 'pg_stat_statements' &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >vacuum_cost_delay = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 0-100 milliseconds</font></div><div><font size="2"   >vacuum_cost_limit = 10000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 credits</font></div><div><font size="2"   >bgwriter_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 10-10000ms between rounds</font></div><div><font size="2"   >wal_level = hot_standby &nbsp; &nbsp; # minimal, archive, or hot_standby</font></div><div><font size="2"   >synchronous_commit = off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# synchronization level;</font></div><div><font size="2"   >wal_buffers = 16384kB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 32kB, -1 sets based on shared_buffers</font></div><div><font size="2"   >wal_writer_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 milliseconds</font></div><div><font size="2"   >checkpoint_segments = 128 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # in logfile segments, min 1, 16MB each</font></div><div><font size="2"   >archive_mode = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # allows archiving to be done</font></div><div><font size="2"   >archive_command = '/bin/date' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # command to use to archive a logfile segment</font></div><div><font size="2"   >max_wal_senders = 32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# max number of walsender processes</font></div><div><font size="2"   >wal_keep_segments = 256 &nbsp; &nbsp; &nbsp; &nbsp; # in logfile segments, 16MB each; 0 disables</font></div><div><font size="2"   >hot_standby = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# "on" allows queries during recovery</font></div><div><font size="2"   >max_standby_archive_delay = 300s &nbsp; &nbsp; &nbsp; &nbsp;# max delay before canceling queries</font></div><div><font size="2"   >max_standby_streaming_delay = 300s &nbsp; &nbsp; &nbsp;# max delay before canceling queries</font></div><div><font size="2"   >wal_receiver_status_interval = 1s &nbsp; &nbsp; &nbsp; # send replies at least this often</font></div><div><font size="2"   >hot_standby_feedback = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # send info from standby to prevent</font></div><div><font size="2"   >effective_cache_size = 8192MB</font></div><div><font size="2"   >log_destination = 'csvlog' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Valid values are combinations of</font></div><div><font size="2"   >logging_collector = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Enable capturing of stderr and csvlog</font></div><div><font size="2"   >log_directory = 'pg_log' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# directory where log files are written,</font></div><div><font size="2"   >log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # log file name pattern,</font></div><div><font size="2"   >log_file_mode = 0600 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# creation mode for log files,</font></div><div><font size="2"   >log_truncate_on_rotation = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # If on, an existing log file with the</font></div><div><font size="2"   >log_rotation_age = 1d &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Automatic rotation of logfiles will</font></div><div><font size="2"   >log_rotation_size = 10MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Automatic rotation of logfiles will</font></div><div><font size="2"   >log_min_duration_statement = 1s # -1 is disabled, 0 logs all statements</font></div><div><font size="2"   >log_checkpoints = on</font></div><div><font size="2"   >log_connections = on</font></div><div><font size="2"   >log_disconnections = on</font></div><div><font size="2"   >log_error_verbosity = verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # terse, default, or verbose messages</font></div><div><font size="2"   >log_statement = 'ddl' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # none, ddl, mod, all</font></div><div><font size="2"   >log_timezone = 'PRC'</font></div><div><font size="2"   >log_autovacuum_min_duration = 0 # -1 disables, 0 logs all actions and</font></div><div><font size="2"   >autovacuum_vacuum_threshold = 50 &nbsp; &nbsp; &nbsp; &nbsp;# min number of row updates before</font></div><div><font size="2"   >autovacuum_analyze_threshold = 50 &nbsp; &nbsp; &nbsp; # min number of row updates before</font></div><div><font size="2"   >autovacuum_vacuum_scale_factor = 0.2 &nbsp; &nbsp;# fraction of table size before vacuum</font></div><div><font size="2"   >autovacuum_analyze_scale_factor = 0.1 &nbsp; # fraction of table size before analyze</font></div><div><font size="2"   >autovacuum_vacuum_cost_delay = 10ms &nbsp; &nbsp; # default vacuum cost delay for</font></div><div><font size="2"   >datestyle = 'iso, mdy'</font></div><div><font size="2"   >timezone = 'PRC'</font></div><div><font size="2"   >lc_messages = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for system error message</font></div><div><font size="2"   >lc_monetary = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for monetary formatting</font></div><div><font size="2"   >lc_numeric = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# locale for number formatting</font></div><div><font size="2"   >lc_time = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for time formatting</font></div><div><font size="2"   >default_text_search_config = 'pg_catalog.english'</font></div><div><font size="2"   >pg_stat_statements.max=1000</font></div><div><font size="2"   >pg_stat_statements.track=all</font></div><div><font size="2"   >pg_stat_statements.save=on</font></div></div><p></p></pre></div><div><br></div><div>3. 编译安装zabbix</div><div>查看详细的编译参数, 只有编译安装proxy和server时, 需要选择数据库类型.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 zabbix-2.2.6]# ./configure --help</font></div><div></div><p></p></pre></div><div>选择要安装的组件, (例如server, proxy, agent全部安装)编译安装 :&nbsp;</div><div><pre class="prettyprint"   ><p><font size="2"   >[root@150 zabbix-2.2.6]# ./configure --prefix=/opt/zabbix2.2.6 --enable-server --enable-proxy --enable-agent --enable-java --enable-ipv6 --with-postgresql=/opt/pgsql/bin/pg_config --with-net-snmp --with-ssh2 --with-openipmi --with-ldap --with-libcurl --with-iconv</font></p></pre></div><div><br></div><div>cnofigure时, 可能会因为缺少lib库报错,&nbsp;</div><div>例如</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >checking for SSH2 support... no</font></div><div><font size="2"   >configure: error: SSH2 library not found</font></div><p></p></pre></div><div>解决</div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 zabbix-2.2.6]# yum install -y libssh2-devel</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >例如</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >checking for OPENIPMI support... no</font></div><div><font size="2"   >configure: error: Invalid OPENIPMI directory - unable to find ipmiif.h</font></div><p></p></pre></div><div>解决</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 zabbix-2.2.6]# yum install -y OpenIPMI-devel</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># make &amp;&amp; make install</font></div><div><font size="2"   >[root@150 zabbix-2.2.6]# ln -s /opt/zabbix2.2.6 /opt/zabbix</font></div><div><div><font size="2"   >[root@150 zabbix-2.2.6]# cd /opt/zabbix</font></div><div><font size="2"   >[root@150 zabbix]# ll</font></div><div><font size="2"   >total 20</font></div><div><font size="2"   >drwxr-xr-x 2 root root 4096 Aug 31 12:10 bin</font></div><div><font size="2"   >drwxr-xr-x 6 root root 4096 Aug 31 12:10 etc</font></div><div><font size="2"   >drwxr-xr-x 2 root root 4096 Aug 31 12:10 lib</font></div><div><font size="2"   >drwxr-xr-x 3 root root 4096 Aug 31 12:10 sbin</font></div><div><font size="2"   >drwxr-xr-x 4 root root 4096 Aug 31 12:10 share</font></div></div><p></p></pre></div><div>配置/etc/profile</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /etc/profile</font></div><div><div><font size="2"   >export PATH=/opt/zabbix/bin:/opt/zabbix/sbin:$PATH</font></div><div><font size="2"   >export MANPATH=/opt/zabbix/share/man:$MANPATH</font></div><div><font size="2"   >export LD_LIBRARY_PATH=/opt/zabbix/lib:$LD_LIBRARY_PATH</font></div></div><p></p></pre></div><div><br></div><div>其他,</div><div>1. 如果你要分发你编译好的binary, 那么可以使用静态链接库把依赖的动态库编辑进来, 那么就可以直接分发给其他OS使用了.</div><div>选项 &nbsp;--enable-static .</div><div>2. 如果添加了--enable-proxy, 那么会生成get和sender两条命令. 如下, 用于接收agent发生过来的信息, 同时发送给server.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 zabbix]# ll bin/</font></div><div><font size="2"   >total 560</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 256830 Aug 31 12:10 zabbix_get</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 314325 Aug 31 12:10 zabbix_sender</font></div><p></p></pre></div><div><br></div><div>4. 安装nginx, php, php-fpm</div><div>参考</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201461822210354/"   >http://blog.163.com/digoal@126/blog/static/163877040201461822210354/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201461391320568/"   >http://blog.163.com/digoal@126/blog/static/163877040201461391320568/</a></div><div><br></div><div>配置并启动php-fpm</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi /etc/profile</font></div><div><font size="2"   >export PATH=/opt/php5.5.14/bin:/opt/php5.5.14/sbin:$PATH</font></div><div><font size="2"   >export MANPATH=/opt/php5.5.14/php/man:$MANPATH</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@150 ~]# php --ini<br>Configuration File (php.ini) Path: /opt/php5.5.14/lib<br>Loaded Configuration File:         (none)<br>Scan for additional .ini files in: (none)<br>Additional .ini files parsed:      (none)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># . /etc/profile</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >注意拷贝到对应的配置目录</font></div><div><font size="2"   ># cp&nbsp;php-5.5.14/php.ini-production /opt/php5.5.14/lib/php.ini</font></div><div><font size="2"   ># cp /opt/php5.5.14/etc/php-fpm.conf.default /opt/php5.5.14/etc/php-fpm.conf</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@150 zabbix]# which php-fpm</font></div><div><font size="2"   >/opt/php5.5.14/sbin/php-fpm</font></div></div><div><font size="2"   >[root@150 zabbix]<span style="line-height: 21px;"   ># php-fpm -R -c /opt/php5.5.14/etc</span></font></div><div><div><font size="2"   >[root@150 zabbix]# netstat -anp|grep 9000</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 127.0.0.1:9000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;26627/php-fpm &nbsp;</font></div></div><p></p></pre></div><div><br></div><div>配置并启动nginx</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@150 conf]# pwd</font></div><div><font size="2"   >/opt/nginx1.6.0/conf</font></div><div><font size="2"   >[root@150 conf]# ll</font></div><div><font size="2"   >total 60</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1034 Aug 31 15:08 fastcgi.conf</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1034 Aug 31 15:08 fastcgi.conf.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;964 Aug 31 15:08 fastcgi_params</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;964 Aug 31 15:08 fastcgi_params.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root 2837 Aug 31 15:08 koi-utf</font></div><div><font size="2"   >-rw-r--r-- 1 root root 2223 Aug 31 15:08 koi-win</font></div><div><font size="2"   >-rw-r--r-- 1 root root 3957 Aug 31 15:08 mime.types</font></div><div><font size="2"   >-rw-r--r-- 1 root root 3957 Aug 31 15:08 mime.types.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root 2639 Aug 31 15:12 nginx.conf</font></div><div><font size="2"   >-rw-r--r-- 1 root root 2656 Aug 31 15:08 nginx.conf.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;596 Aug 31 15:08 scgi_params</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;596 Aug 31 15:08 scgi_params.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;623 Aug 31 15:08 uwsgi_params</font></div><div><font size="2"   >-rw-r--r-- 1 root root &nbsp;623 Aug 31 15:08 uwsgi_params.default</font></div><div><font size="2"   >-rw-r--r-- 1 root root 3610 Aug 31 15:08 win-utf</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@150 conf]# pwd</font></div><div><font size="2"   >/opt/nginx1.6.0/conf</font></div><div><font size="2"   >[root@150 conf]# cat nginx.conf</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >user &nbsp;nobody;</font></div><div><font size="2"   >worker_processes &nbsp;2;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >#error_log &nbsp;logs/error.log;</font></div><div><font size="2"   >#error_log &nbsp;logs/error.log &nbsp;notice;</font></div><div><font size="2"   >#error_log &nbsp;logs/error.log &nbsp;info;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >#pid &nbsp; &nbsp; &nbsp; &nbsp;logs/nginx.pid;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >events {</font></div><div><font size="2"   >&nbsp; &nbsp; worker_connections &nbsp;1024;</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >http {</font></div><div><font size="2"   >&nbsp; &nbsp; include &nbsp; &nbsp; &nbsp; mime.types;</font></div><div><font size="2"   >&nbsp; &nbsp; default_type &nbsp;application/octet-stream;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; #log_format &nbsp;main &nbsp;'$remote_addr - $remote_user [$time_local] "$request" '</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'$status $body_bytes_sent "$http_referer" '</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"$http_user_agent" "$http_x_forwarded_for"';</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; #access_log &nbsp;logs/access.log &nbsp;main;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; sendfile &nbsp; &nbsp; &nbsp; &nbsp;on;</font></div><div><font size="2"   >&nbsp; &nbsp; #tcp_nopush &nbsp; &nbsp; on;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; #keepalive_timeout &nbsp;0;</font></div><div><font size="2"   >&nbsp; &nbsp; keepalive_timeout &nbsp;65;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; #gzip &nbsp;on;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; server {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; listen &nbsp; &nbsp; &nbsp; 8080;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; server_name &nbsp;digoal;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; root /opt/www/zabbix;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #charset koi8-r;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #access_log &nbsp;logs/host.access.log &nbsp;main;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; location / {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; index &nbsp;index.html index.htm index.php;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #error_page &nbsp;404 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/404.html;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # redirect server error pages to the static page /50x.html</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; error_page &nbsp; 500 502 503 504 &nbsp;/50x.html;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; location = /50x.html {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; root &nbsp; html;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # proxy the PHP scripts to Apache listening on 127.0.0.1:80</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #location ~ \.php$ {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # &nbsp; &nbsp;proxy_pass &nbsp; http://127.0.0.1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; location ~ \.php$ {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_pass &nbsp; 127.0.0.1:9000;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_index &nbsp;index.php;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_param &nbsp;SCRIPT_FILENAME &nbsp;$document_root$fastcgi_script_name;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; include &nbsp; &nbsp; &nbsp; &nbsp;fastcgi_params;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # deny access to .htaccess files, if Apache's document root</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # concurs with nginx's one</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #location ~ /\.ht {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # &nbsp; &nbsp;deny &nbsp;all;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #}</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # another virtual host using mix of IP-, name-, and port-based configuration</font></div><div><font size="2"   >&nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; #server {</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;listen &nbsp; &nbsp; &nbsp; 8000;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;listen &nbsp; &nbsp; &nbsp; somename:8080;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;server_name &nbsp;somename &nbsp;alias &nbsp;another.alias;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;location / {</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp; &nbsp; &nbsp;root &nbsp; html;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp; &nbsp; &nbsp;index &nbsp;index.html index.htm;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;}</font></div><div><font size="2"   >&nbsp; &nbsp; #}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # HTTPS server</font></div><div><font size="2"   >&nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; #server {</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;listen &nbsp; &nbsp; &nbsp; 443 ssl;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;server_name &nbsp;localhost;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;ssl_certificate &nbsp; &nbsp; &nbsp;cert.pem;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;ssl_certificate_key &nbsp;cert.key;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;ssl_session_cache &nbsp; &nbsp;shared:SSL:1m;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;ssl_session_timeout &nbsp;5m;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;ssl_ciphers &nbsp;HIGH:!aNULL:!MD5;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;ssl_prefer_server_ciphers &nbsp;on;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;location / {</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp; &nbsp; &nbsp;root &nbsp; html;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp; &nbsp; &nbsp;index &nbsp;index.html index.htm;</font></div><div><font size="2"   >&nbsp; &nbsp; # &nbsp; &nbsp;}</font></div><div><font size="2"   >&nbsp; &nbsp; #}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >}</font></div></div><div><font size="2"   >启动</font></div><div><font size="2"   >[root@150 conf]# /opt/nginx1.6.0/sbin/nginx -c /opt/nginx1.6.0/conf/nginx.conf</font></div><p></p></pre></div><div><br></div><div>5. 配置WEB</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@150 php]# pwd</font></div><div><font size="2"   >/opt/soft_bak/zabbix-2.2.6/frontends/php</font></div></div><div><font size="2"   >将php目录中的所有文件拷贝到<span style="line-height: 28px;"   >/opt/www/zabbix</span></font></div><div><font size="2"   >[root@150 frontends]# mkdir -p /opt/www/zabbix</font></div><div><font size="2"   >[root@150 php]# cp -a . /opt/www/zabbix/</font></div><p></p></pre></div><div><br></div><div><div><img title="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/UTX3Xuj8fPtlzDNKKwawZQ==/6619289797141903790.png"   ></div></div><div>搞定所有的检查未通过问题.</div><div><div><img title="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/lD23BZxlnRF5NzH0gdcDRA==/6599329263052922106.png"   ></div><div>有一些默认配置要修改.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi /opt/php5.5.14/lib/php.ini</font></div><div><font size="2"   >post_max_size = 16M</font></div><div><font size="2"   >date.timezone = Asia/Shanghai</font></div><div><font size="2"   >max_execution_time = 300</font></div><div><font size="2"   >max_input_time = 300</font></div><div><div><font size="2"   >[root@150 etc]# ps -ewf|grep php</font></div><div><font size="2"   >root &nbsp; &nbsp; 14100 &nbsp; &nbsp; 1 &nbsp;0 09:25 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 php-fpm: master process (/opt/php5.5.14/etc/php-fpm.conf)</font></div><div><font size="2"   >nobody &nbsp; 14101 14100 &nbsp;0 09:25 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 php-fpm: pool www</font></div><div><font size="2"   >nobody &nbsp; 14102 14100 &nbsp;0 09:25 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 php-fpm: pool www</font></div><div><font size="2"   >root &nbsp; &nbsp; 14604 &nbsp; 504 &nbsp;0 09:32 pts/0 &nbsp; &nbsp;00:00:00 grep php</font></div><div><font size="2"   >[root@150 etc]# kill -9 14100</font></div><div><font size="2"   >[root@150 etc]# kill -9 14101</font></div><div><font size="2"   >[root@150 etc]# kill -9 14102</font></div><div><font size="2"   >[root@150 etc]# php-fpm -R</font></div></div><p></p></pre></div><div>同时, 如果要使用新版本的lib, 需要重新编译.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># wget http://download.savannah.gnu.org/releases/freetype/freetype-2.5.3.tar.bz2</font></div><div><font size="2"   ># tar -jxvf freetype-2.5.3.tar.bz2</font></div><div><font size="2"   ># cd freetype-2.5.3</font></div><div><font size="2"   ># ./configure --prefix=/opt/freetype2.5.3</font></div><div><font size="2"   ># make &amp;&amp; make install</font></div><div><font size="2"   ><br></font></div><font size="2"   ># <span style="line-height: 21px;"   >./configure --prefix=/opt/php5.5.14 --with-pcre-regex=/usr/lib64 --enable-fpm --enable-opcache --with-pdo-pgsql=/opt/pgsql/bin --with-pgsql=/opt/pgsql/bin --enable-bcmath --enable-mbstring --enable-sockets --with-gd --with-gettext --with-libdir=lib64 --with-jpeg-dir --with-png-dir --with-freetype-dir=/opt/freetype2.5.3</span></font></div><div><font size="2"   ># make &amp;&amp; make install</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >注意php 5.5.14的gd库是随php源码包绑定的, 所以就是2.1的版本.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># 重启php-fpm</font></div><div><font size="2"   ># php-fpm -R -c /usr/local/etc</font></div><p></p></pre></div></div><div><br></div><div>6. 创建数据库</div><div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@150 etc]# su - postgres</font></div><div><font size="2"   >postgres@150-&gt; psql</font></div><div><font size="2"   >psql (9.3.5)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# create role zabbix nosuperuser login encrypted password 'digoal';</font></div><div><font size="2"   >CREATE ROLE</font></div><div><font size="2"   >postgres=# create database zabbix with template template0 encoding 'UTF8' ;</font></div><div><font size="2"   >CREATE DATABASE</font></div><div><div><font size="2"   >postgres=# grant all on database zabbix to zabbix;</font></div><div><font size="2"   >GRANT</font></div></div></div><div></div><p></p></pre></div></div><div>7. 创建schema</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >shell&gt; psql -U &lt;username&gt;</font></div><div><font size="2"   >psql&gt; create database zabbix;&nbsp;</font></div><div><font size="2"   >psql&gt; \q&nbsp;</font></div><div><font size="2"   >shell&gt; cd database/postgresql</font></div><div><font size="2"   >shell&gt; psql -U &lt;username&gt; zabbix &lt; schema.sql</font></div><div><font size="2"   ># stop here if you are creating database for Zabbix proxy &nbsp;, 如果是代理的话, 只需要创建schema.</font></div><div><font size="2"   >shell&gt; psql -U &lt;username&gt; zabbix &lt; images.sql</font></div><div><font size="2"   >shell&gt; psql -U &lt;username&gt; zabbix &lt; data.sql</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@150 postgresql]# pwd</font></div><div><font size="2"   >/opt/soft_bak/zabbix-2.2.6/database/postgresql</font></div><div><font size="2"   >[root@150 postgresql]# ll</font></div><div><font size="2"   >total 2896</font></div><div><font size="2"   >-rw-rw-r-- 1 1000 1000 &nbsp;873252 Aug 27 21:08 data.sql</font></div><div><font size="2"   >-rw-rw-r-- 1 1000 1000 1979089 Aug 27 21:07 images.sql</font></div><div><font size="2"   >-rw-rw-r-- 1 1000 1000 &nbsp;102928 Aug 27 21:08 schema.sql</font></div></div><div><div><font size="2"   >[root@150 postgresql]# su - postgres</font></div><div><font size="2"   >postgres@150-&gt; cd /opt/soft_bak/zabbix-2.2.6/database/postgresql/</font></div></div><div><font size="2"   >postgres@150-&gt; psql -h 127.0.0.1 -U zabbix zabbix -f ./schema.sql</font></div><div><div style="line-height: 28px;"   ><font size="2"   >postgres@150-&gt; psql -h 127.0.0.1 -U zabbix zabbix -f ./images.sql</font></div></div><div><div style="line-height: 28px;"   ><font size="2"   >postgres@150-&gt; psql -h 127.0.0.1 -U zabbix zabbix -f ./data.sql</font></div></div><p></p></pre></div><div style="line-height: 28px;"   >确保没有任何报错, 注意我们这里使用了public schema, 因为不了解zabbix是否写了schema name, 所以就用public吧.</div><div><br></div><div>8. 继续web配置</div><div><div><img title="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/rLl9Q6TYA9gi68DwzfrNCw==/3134786815727242010.png"   ></div><br></div><div><div><img title="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/sZn1wrfzZE0SS1Z7mzuWfQ==/6599288581122697513.png"   ></div><div>这里需要配置zabbix server的主机名IP, 以及zabbix server的监听端口, 后面还可以通过配置文件来修改.</div>&nbsp;<div><img title="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/L6b5tCVnMe1cFX1mSyTK9g==/870039153112911113.png"   ></div>&nbsp;<div><img title="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/cSKQvmipPSTbv4Fxzsi4rA==/6619197438165174506.png"   ></div><div>这里需要<span style="line-height: 28px;"   >下载配置文件到/opt/www/zabbix/conf</span></div><div><span style="line-height: 28px;"   >配置文件里可以修改zabbix server的连接IP, 端口.</span></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><div style="line-height: 28px;"   ><font size="2"   >[root@150 conf]# cat zabbix.conf.php</font></div><div style="line-height: 28px;"   ><font size="2"   >&lt;?php</font></div><div style="line-height: 28px;"   ><font size="2"   >// Zabbix GUI configuration file</font></div><div style="line-height: 28px;"   ><font size="2"   >global $DB;</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >$DB['TYPE'] &nbsp; &nbsp; = 'POSTGRESQL';</font></div><div style="line-height: 28px;"   ><font size="2"   >$DB['SERVER'] &nbsp; = '127.0.0.1';</font></div><div style="line-height: 28px;"   ><font size="2"   >$DB['PORT'] &nbsp; &nbsp; = '5432';</font></div><div style="line-height: 28px;"   ><font size="2"   >$DB['DATABASE'] = 'zabbix';</font></div><div style="line-height: 28px;"   ><font size="2"   >$DB['USER'] &nbsp; &nbsp; = 'zabbix';</font></div><div style="line-height: 28px;"   ><font size="2"   >$DB['PASSWORD'] = 'digoal';</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >// SCHEMA is relevant only for IBM_DB2 database</font></div><div style="line-height: 28px;"   ><font size="2"   >$DB['SCHEMA'] = '';</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >$ZBX_SERVER &nbsp; &nbsp; &nbsp;= '0.0.0.0';</font></div><div style="line-height: 28px;"   ><font size="2"   >$ZBX_SERVER_PORT = '10051';</font></div><div style="line-height: 28px;"   ><font size="2"   >$ZBX_SERVER_NAME = 'digoal';</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >$IMAGE_FORMAT_DEFAULT = IMAGE_FORMAT_PNG;</font></div><div style="line-height: 28px;"   ><font size="2"   >?&gt;</font></div><p></p></pre></div></div>&nbsp;<div><img title="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/TBC-IfkG_83iQ-B2lGQ9hg==/2979975578536027896.png"   ></div>&nbsp;<div><img title="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/Z3TAx6VXV1BrtquWdzY1WA==/1490691476759888332.png"   ></div></div><div>用户密码存在数据库里面, 密码已经加密了.</div><div>用户Admin默认密码zabbix</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >zabbix=&gt; select * from users;</font></div><div><font size="2"   >-[ RECORD 1 ]--+---------------------------------</font></div><div><font size="2"   >userid &nbsp; &nbsp; &nbsp; &nbsp; | 1</font></div><div><font size="2"   >alias &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Admin</font></div><div><font size="2"   >name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Zabbix</font></div><div><font size="2"   >surname &nbsp; &nbsp; &nbsp; &nbsp;| Administrator</font></div><div><font size="2"   >passwd &nbsp; &nbsp; &nbsp; &nbsp; | 5fce1b3e34b520afeffb37ce08c7cd66</font></div><div><font size="2"   >url &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >autologin &nbsp; &nbsp; &nbsp;| 1</font></div><div><font size="2"   >autologout &nbsp; &nbsp; | 0</font></div><div><font size="2"   >lang &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | en_GB</font></div><div><font size="2"   >refresh &nbsp; &nbsp; &nbsp; &nbsp;| 30</font></div><div><font size="2"   >type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 3</font></div><div><font size="2"   >theme &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| default</font></div><div><font size="2"   >attempt_failed | 0</font></div><div><font size="2"   >attempt_ip &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >attempt_clock &nbsp;| 0</font></div><div><font size="2"   >rows_per_page &nbsp;| 50</font></div><div><font size="2"   >-[ RECORD 2 ]--+---------------------------------</font></div><div><font size="2"   >userid &nbsp; &nbsp; &nbsp; &nbsp; | 2</font></div><div><font size="2"   >alias &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| guest</font></div><div><font size="2"   >name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >surname &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >passwd &nbsp; &nbsp; &nbsp; &nbsp; | d41d8cd98f00b204e9800998ecf8427e</font></div><div><font size="2"   >url &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >autologin &nbsp; &nbsp; &nbsp;| 0</font></div><div><font size="2"   >autologout &nbsp; &nbsp; | 900</font></div><div><font size="2"   >lang &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | en_GB</font></div><div><font size="2"   >refresh &nbsp; &nbsp; &nbsp; &nbsp;| 30</font></div><div><font size="2"   >type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 1</font></div><div><font size="2"   >theme &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| default</font></div><div><font size="2"   >attempt_failed | 0</font></div><div><font size="2"   >attempt_ip &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >attempt_clock &nbsp;| 0</font></div><div><font size="2"   >rows_per_page &nbsp;| 50</font></div><p></p></pre></div><div><br></div><div>[问题]</div><div>1. gd jpeg, freetype的支持问题,&nbsp;</div><div>在zabbix WEB配置时一直显示不通过,&nbsp;</div><div><div><img title="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   alt="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/E7I1wyrDax63ESCDRc4yRQ==/6608413428121423262.png"   ></div><br></div><div>检测代码如下 :&nbsp;</div><div>/opt/www/zabbix/include/classes/class.frontendsetup.php</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /**</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* Checks for PHP GD JPEG support.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @return array</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; public function checkPhpGdJpeg() {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_callable('gd_info')) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $gdInfo = gd_info();</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // check for PHP prior 5.3.0, it returns 'JPG Support' key.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $current = isset($gdInfo['JPG Support']) ? $gdInfo['JPG Support'] : $gdInfo['JPEG Support'];</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $current = false;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return array(</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'name' =&gt; _('PHP gd JPEG support'),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'current' =&gt; $current ? _('on') : _('off'),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'required' =&gt; null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'result' =&gt; $current ? self::CHECK_OK : self::CHECK_FATAL,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'error' =&gt; _('PHP gd JPEG image support missing.')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /**</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* Checks for PHP GD FreeType support.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @return array</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; public function checkPhpGdFreeType() {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_callable('gd_info')) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $gdInfo = gd_info();</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $current = $gdInfo['FreeType Support'];</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $current = false;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return array(</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'name' =&gt; _('PHP gd FreeType support'),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'current' =&gt; $current ? _('on') : _('off'),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'required' =&gt; null,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'result' =&gt; $current ? self::CHECK_OK : self::CHECK_FATAL,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'error' =&gt; _('PHP gd FreeType support missing.')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div></div><p></p></pre></div><div>配置代码如下 :&nbsp;</div><div><div>php-5.5.14/configure</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&nbsp; if test "$PHP_JPEG_DIR" != "no"; then</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; for i in $PHP_JPEG_DIR /usr/local /usr; do</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; test -f $i/include/jpeglib.h &amp;&amp; GD_JPEG_DIR=$i &amp;&amp; break</font></div><div><font size="2"   >&nbsp; &nbsp; done</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; if test -z "$GD_JPEG_DIR"; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; as_fn_error $? "jpeglib.h not found." "$LINENO" 5</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >....</font></div><div><div><font size="2"   >&nbsp; if test "$PHP_FREETYPE_DIR" != "no"; then</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; for i in $PHP_FREETYPE_DIR /usr/local /usr; do</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if test -f "$i/bin/freetype-config"; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; FREETYPE2_DIR=$i</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; FREETYPE2_CONFIG="$i/bin/freetype-config"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; break</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; done</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; if test -z "$FREETYPE2_DIR"; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; as_fn_error $? "freetype-config not found." "$LINENO" 5</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div></div><p></p></pre></div></div><div>解决办法, 把源码包删掉重新编译.</div><div>可能是原来的configure遗留的问题. 一直在此基础上做编译安装导致的.</div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.zabbix.com/download.php"   >http://www.zabbix.com/download.php</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://www.zabbix.com/documentation/doku.php?id=2.2/manual/installation/install"   >https://www.zabbix.com/documentation/doku.php?id=2.2/manual/installation/install</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Install zabbix 2.2 + PostgreSQL + nginx + php on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">吟海 - 2015-07-01 6:45:44</h5>
				<div>为什么第7步有两遍导入sql的操作？<div><span style=""  >postgres=#&nbsp;create&nbsp;role&nbsp;zabbix&nbsp;nosuperuser&nbsp;login&nbsp;encrypted&nbsp;password&nbsp;'Itsms4ZBX';</span><br style=""  ><span style=""  >CREATE&nbsp;ROLE</span><br style=""  ><span style=""  >postgres=#&nbsp;create&nbsp;database&nbsp;zabbix&nbsp;with&nbsp;template&nbsp;template0&nbsp;encoding&nbsp;'UTF8'&nbsp;;</span><br style=""  ><span style=""  >CREATE&nbsp;DATABASE</span><br style=""  ><span style=""  >postgres=#&nbsp;grant&nbsp;all&nbsp;on&nbsp;database&nbsp;zabbix&nbsp;to&nbsp;zabbix;</span><br style=""  ><span style=""  >GRANT</span></div><div><span style=""  ><br></span></div><div><span style=""  ><div>sudo -u postgres psql -U postgres -p 5432 zabbix &lt; schema.sql</div><div>sudo -u postgres psql -U postgres -p 5432 zabbix &lt; images.sql</div><div>sudo -u postgres psql -U postgres -p 5432 zabbix &lt; data.sql</div><div><br></div><div>结果网页上报无法连接数据库</div></span></div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 吟海 - 2015-07-01 6:45:44</h5>
				<div style="width:600px;">agent,server</div>
			</div>
	</div>
</div>
</body>
</html>