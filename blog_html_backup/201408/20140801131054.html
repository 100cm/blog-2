<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Install OpenVSwitch on CentOS 6.x x64</h2>
	<h5 id="">2014-08-01 13:10:54&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020147111358858/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div><div><div>本文包含openvswitch的模块安装, 管理软件安装.</div><div>安装依赖包, 注意内核版本匹配 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># uname -r</font></div><div><font size="2"   >2.6.32-431.el6.x86_64</font></div></div><div><font size="2"   ># yum install -y rpm-build&nbsp;redhat-rpm-config&nbsp;kernel-devel-<span style="line-height: 28px;"   >2.6.32-431.el6.x86_64</span></font></div><p></p></pre></div></div><div><br></div><div>下载openvswitch LTS版本 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@176 ~]# mkdir /opt/soft_bak</font></div><div><font size="2"   >[root@176 ~]# cd /opt/soft_bak/</font></div></div><div><font size="2"   ># wget http://openvswitch.org/releases/openvswitch-1.9.3.tar.gz</font></div><p></p></pre></div></div><div><br></div><div>解压, 并将源码包放到RHEL的rpm building SOURCES目录.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># tar -zxvf openvswitch-1.9.3.tar.gz&nbsp;</font></div><div><font size="2"   ># mkdir -p /root/rpmbuild/SOURCES</font></div><div><font size="2"   ># cp openvswitch-1.9.3.tar.gz /root/rpmbuild/SOURCES/</font></div><div><font size="2"   ># cd openvswitch-1.9.3</font></div><div><font size="2"   ># less INSTALL.RHEL &nbsp;查看安装步骤.</font></div><p></p></pre></div><div><br></div><div>生成软件rpm包,</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># rpmbuild -bb rhel/openvswitch.spec</font></div><div><font size="2"   ># cp rhel/openvswitch-kmod.files /root/rpmbuild/SOURCES/</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >生成内核模块</span><span style="line-height: 28px;"   >重新执行</span><span style="line-height: 28px;"   >重新执行</span><span style="line-height: 28px;"   >包 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@176 openvswitch-1.9.3]# uname -r</font></div><div><font size="2"   >2.6.32-431.el6.x86_64</font></div></div><div><font size="2"   ># rpmbuild -bb -D "kversion&nbsp;<span style="line-height: 28px;"   >2.6.32-431.el6.x86_64</span>" -D "kflavors default" rhel/openvswitch-kmod-rhel6.spec</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >********************************************************************************</font></div><div><font size="2"   >*********************** KERNEL ABI COMPATIBILITY WARNING ***********************</font></div><div><font size="2"   >********************************************************************************</font></div><div><font size="2"   >The kernel ABI reference files (provided by kabi-whitelists) were not found.</font></div><div><font size="2"   >No compatibility check was performed. Please install the kABI reference files</font></div><div><font size="2"   >and rebuild if you would like to verify compatibility with kernel ABI.</font></div><p></p></pre></div><div><br></div><div>以上信息, 表示没有合适的kabi-whitelists包来检查兼容性, 可以忽略, 或者你安装一下这个包, 但是可能包太老, 新的内核没有加进来.</div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum install -y kabi-whitelists</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >然后重新执行, (如果不需要检测的话, 不需要重新执行这个) :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># rpmbuild -bb -D "kversion&nbsp;<span style="line-height: 28px;"   >2.6.32-431.el6.x86_64</span>" -D "kflavors default" rhel/openvswitch-kmod-rhel6.spec</font></div><div></div><p></p></pre></div><div>使用build的rpm包安装 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@176 openvswitch-1.9.3]# cd /root/rpmbuild/RPMS/x86_64/</font></div><div><font size="2"   >[root@176 x86_64]# ll</font></div><div><font size="2"   >total 4080</font></div><div><font size="2"   >-rw-r--r-- 1 root root 1199928 Aug &nbsp;1 11:44 kmod-openvswitch-1.9.3-1.el6.x86_64.rpm</font></div><div><font size="2"   >-rw-r--r-- 1 root root 2975203 Aug &nbsp;1 11:39 openvswitch-1.9.3-1.x86_64.rpm</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@176 x86_64]# rpm -ivh kmod-openvswitch-1.9.3-1.el6.x86_64.rpm</font></div><div><font size="2"   >Preparing... &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;########################################### [100%]</font></div><div><font size="2"   >&nbsp; &nbsp;1:kmod-openvswitch &nbsp; &nbsp; &nbsp; ########################################### [100%]</font></div><div><font size="2"   >[root@176 x86_64]# rpm -ivh openvswitch-1.9.3-1.x86_64.rpm</font></div><div><font size="2"   >Preparing... &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;########################################### [100%]</font></div><div><font size="2"   >&nbsp; &nbsp;1:openvswitch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;########################################### [100%]</font></div></div><p></p></pre></div><div><br></div><div>安装完之后, 开启了一个服务.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 x86_64]# chkconfig --list|grep openv</font></div><div><font size="2"   >openvswitch &nbsp; &nbsp; 0:off &nbsp; 1:off &nbsp; 2:on &nbsp; &nbsp;3:on &nbsp; &nbsp;4:on &nbsp; &nbsp;5:on &nbsp; &nbsp;6:off</font></div><p></p></pre></div><div><br></div><div>安装的两个包的内容 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 x86_64]# rpm -ql kmod-openvswitch</font></div><div><font size="2"   >/etc/depmod.d/openvswitch.conf</font></div><div><font size="2"   >/lib/modules/2.6.32-431.el6.x86_64</font></div><div><font size="2"   >/lib/modules/2.6.32-431.el6.x86_64/extra</font></div><div><font size="2"   >/lib/modules/2.6.32-431.el6.x86_64/extra/openvswitch</font></div><div><font size="2"   >/lib/modules/2.6.32-431.el6.x86_64/extra/openvswitch/brcompat.ko</font></div><div><font size="2"   >/lib/modules/2.6.32-431.el6.x86_64/extra/openvswitch/openvswitch.ko</font></div><div><font size="2"   >[root@176 x86_64]# rpm -ql openvswitch</font></div><div><font size="2"   >/etc/init.d/openvswitch</font></div><div><font size="2"   >/etc/logrotate.d/openvswitch</font></div><div><font size="2"   >/etc/sysconfig/network-scripts/ifdown-ovs</font></div><div><font size="2"   >/etc/sysconfig/network-scripts/ifup-ovs</font></div><div><font size="2"   >/usr/bin/ovs-appctl</font></div><div><font size="2"   >/usr/bin/ovs-benchmark</font></div><div><font size="2"   >/usr/bin/ovs-dpctl</font></div><div><font size="2"   >/usr/bin/ovs-ofctl</font></div><div><font size="2"   >/usr/bin/ovs-parse-backtrace</font></div><div><font size="2"   >/usr/bin/ovs-parse-leaks</font></div><div><font size="2"   >/usr/bin/ovs-pcap</font></div><div><font size="2"   >/usr/bin/ovs-pki</font></div><div><font size="2"   >/usr/bin/ovs-tcpundump</font></div><div><font size="2"   >/usr/bin/ovs-vlan-test</font></div><div><font size="2"   >/usr/bin/ovs-vsctl</font></div><div><font size="2"   >/usr/bin/ovsdb-client</font></div><div><font size="2"   >/usr/bin/ovsdb-tool</font></div><div><font size="2"   >/usr/sbin/ovs-brcompatd</font></div><div><font size="2"   >/usr/sbin/ovs-bugtool</font></div><div><font size="2"   >/usr/sbin/ovs-vswitchd</font></div><div><font size="2"   >/usr/sbin/ovsdb-server</font></div><div><font size="2"   >/usr/share/doc/openvswitch-1.9.3/FAQ</font></div><div><font size="2"   >/usr/share/doc/openvswitch-1.9.3/README.RHEL</font></div><div><font size="2"   >/usr/share/man/man1/ovs-benchmark.1.gz</font></div><div><font size="2"   >/usr/share/man/man1/ovs-pcap.1.gz</font></div><div><font size="2"   >/usr/share/man/man1/ovs-tcpundump.1.gz</font></div><div><font size="2"   >/usr/share/man/man1/ovsdb-client.1.gz</font></div><div><font size="2"   >/usr/share/man/man1/ovsdb-server.1.gz</font></div><div><font size="2"   >/usr/share/man/man1/ovsdb-tool.1.gz</font></div><div><font size="2"   >/usr/share/man/man5/ovs-vswitchd.conf.db.5.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-appctl.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-brcompatd.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-bugtool.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-ctl.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-dpctl.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-ofctl.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-parse-backtrace.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-parse-leaks.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-pki.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-vlan-test.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-vsctl.8.gz</font></div><div><font size="2"   >/usr/share/man/man8/ovs-vswitchd.8.gz</font></div><div><font size="2"   >/usr/share/openvswitch/bugtool-plugins</font></div><div><font size="2"   >/usr/share/openvswitch/bugtool-plugins/kernel-info</font></div><div><font size="2"   >/usr/share/openvswitch/bugtool-plugins/kernel-info/openvswitch.xml</font></div><div><font size="2"   >/usr/share/openvswitch/bugtool-plugins/network-status</font></div><div><font size="2"   >/usr/share/openvswitch/bugtool-plugins/network-status/openvswitch.xml</font></div><div><font size="2"   >/usr/share/openvswitch/bugtool-plugins/system-configuration</font></div><div><font size="2"   >/usr/share/openvswitch/bugtool-plugins/system-configuration.xml</font></div><div><font size="2"   >/usr/share/openvswitch/bugtool-plugins/system-configuration/openvswitch.xml</font></div><div><font size="2"   >/usr/share/openvswitch/bugtool-plugins/system-logs</font></div><div><font size="2"   >/usr/share/openvswitch/bugtool-plugins/system-logs/openvswitch.xml</font></div><div><font size="2"   >/usr/share/openvswitch/python</font></div><div><font size="2"   >/usr/share/openvswitch/python/argparse.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/__init__.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/daemon.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/db</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/db/__init__.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/db/data.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/db/error.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/db/idl.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/db/parser.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/db/schema.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/db/types.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/dirs.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/fatal_signal.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/json.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/jsonrpc.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/ovsuuid.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/poller.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/process.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/reconnect.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/socket_util.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/stream.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/timeval.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/unixctl</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/unixctl/__init__.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/unixctl/client.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/unixctl/server.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/util.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/version.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovs/vlog.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovstest</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovstest/__init__.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovstest/args.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovstest/rpcserver.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovstest/tcp.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovstest/tests.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovstest/udp.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovstest/util.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/ovstest/vswitch.py</font></div><div><font size="2"   >/usr/share/openvswitch/python/uuid.py</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-bugtool-bond-show</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-bugtool-cfm-show</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-bugtool-coverage-show</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-bugtool-daemons-ver</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-bugtool-lacp-show</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-bugtool-memory-show</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-bugtool-ovsdb-dump</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-bugtool-tc-class-show</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-bugtool-vsctl-show</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-check-dead-ifs</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-ctl</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-lib</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/ovs-save</font></div><div><font size="2"   >/usr/share/openvswitch/scripts/sysconfig.template</font></div><div><font size="2"   >/usr/share/openvswitch/vswitch.ovsschema</font></div><div><font size="2"   >/var/lib/openvswitch</font></div><div><font size="2"   >/var/lib/openvswitch/pki</font></div><p></p></pre></div><div><br></div><div>将bridge模块加入黑名单, 禁止自动加载bridge启动.&nbsp;</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   ># lsmod |grep bri</font></div><div style="line-height: 28px;"   ><font size="2"   ><br></font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >## Blacklist the bridge module &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >vi /etc/modprobe.d/blacklist.conf &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   ># Bridge, using openvswitch instead &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >blacklist bridge&nbsp;</font></div><div style="line-height: 28px;"   ></div></div><p></p></pre></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   >重启机器</div><pre class="prettyprint"   ><p></p><div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   ># reboot</font></div></div></div><div></div><p></p></pre><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >可以看到, 已经加载了openvswitch模块.</span></div></div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 ~]# lsmod|grep op<span style="line-height: 28px;"   >envs</span></font></div><div><font size="2"   >openvswitch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;96678 &nbsp;0&nbsp;</font></div><p></p></pre></div><div>当前没有建立虚拟交换机</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 ~]# ovs-vsctl show</font></div><div><font size="2"   >8901fd9e-3b91-48ff-b0e8-8aa926fd2617</font></div><div><font size="2"   >&nbsp; &nbsp; ovs_version: "1.9.3"</font></div><p></p></pre></div><div><br></div><div>创建一个网桥</div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 ~]# ovs-vsctl add-br br0</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >查看刚创建的网桥</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 ~]# ifconfig -a</font></div><div><font size="2"   >br0 &nbsp; &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 1A:E4:96:0B:24:43 &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >eth0 &nbsp; &nbsp; &nbsp;Link encap:Ethernet &nbsp;HWaddr 00:23:7D:A3:F0:4E &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:172.16.3.176 &nbsp;Bcast:172.16.3.255 &nbsp;Mask:255.255.255.0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::223:7dff:fea3:f04e/64 Scope:Link</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:7096 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:1311 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:784135 (765.7 KiB) &nbsp;TX bytes:101647 (99.2 KiB)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >eth1 &nbsp; &nbsp; &nbsp;Link encap:Ethernet &nbsp;HWaddr 00:23:7D:A3:F0:50 &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >lo &nbsp; &nbsp; &nbsp; &nbsp;Link encap:Local Loopback &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1 &nbsp;Mask:255.0.0.0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: ::1/128 Scope:Host</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING &nbsp;MTU:16436 &nbsp;Metric:1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:0 (0.0 b)</font></div><p></p></pre></div><div>当前br0链路是DOWN的.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 ~]# ip link</font></div><div><font size="2"   >1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</font></div><div><font size="2"   >2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</font></div><div><font size="2"   >&nbsp; &nbsp; link/ether 00:23:7d:a3:f0:4e brd ff:ff:ff:ff:ff:ff</font></div><div><font size="2"   >3: eth1: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN qlen 1000</font></div><div><font size="2"   >&nbsp; &nbsp; link/ether 00:23:7d:a3:f0:50 brd ff:ff:ff:ff:ff:ff</font></div><div><font size="2"   >5: br0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; link/ether 1a:e4:96:0b:24:43 brd ff:ff:ff:ff:ff:ff</font></div><p></p></pre></div><div><br></div><div>启动网桥</div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 ~]# ifconfig br0 up</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >现在可以看到这个接口已经起来了, 状态是up的</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@176 ~]# ifconfig</font></div><div><font size="2"   >br0 &nbsp; &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 1A:E4:96:0B:24:43 &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::18e4:96ff:fe0b:2443/64 Scope:Link</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:5 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b) &nbsp;TX bytes:398 (398.0 b)</font></div></div><div><div><font size="2"   >[root@176 ~]# ip link</font></div><div><font size="2"   >1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</font></div><div><font size="2"   >2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</font></div><div><font size="2"   >&nbsp; &nbsp; link/ether 00:23:7d:a3:f0:4e brd ff:ff:ff:ff:ff:ff</font></div><div><font size="2"   >3: eth1: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN qlen 1000</font></div><div><font size="2"   >&nbsp; &nbsp; link/ether 00:23:7d:a3:f0:50 brd ff:ff:ff:ff:ff:ff</font></div><div><font size="2"   >5: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; link/ether 1a:e4:96:0b:24:43 brd ff:ff:ff:ff:ff:ff</font></div></div><p></p></pre></div><div><br></div><div>现在IP地址还配置在ETH0上面, 因为我们eth1没有配置IP, 所以如果直接把eth0接口加入网桥br0的话, 服务器就不通了.</div><div>需要新建br配置文件, 把IP配置到网桥的管理接口上, ETH0的IP消掉. 同时把eth0加入网桥. eth1不管他, 以后可以加入网桥也可以不加入网桥, 看怎么个用法.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@176 ~]# cd /etc/sysconfig/network-scripts/</font></div><div><font size="2"   >[root@176 network-scripts]# cp ifcfg-eth0 ifcfg-br0</font></div><div><font size="2"   >[root@176 network-scripts]# vi ifcfg-br0&nbsp;</font></div></div><div><div><font size="2"   >DEVICE="br0"</font></div><div><font size="2"   >BOOTPROTO="static"</font></div><div><font size="2"   >BROADCAST="172.16.3.255"</font></div><div><font size="2"   >DNS1="202.101.172.35"</font></div><div><font size="2"   >GATEWAY="172.16.3.1"</font></div><div><font size="2"   >IPADDR="172.16.3.176"</font></div><div><font size="2"   >NETMASK="255.255.255.0"</font></div><div><font size="2"   >NM_CONTROLLED="no"</font></div><div><font size="2"   >ONBOOT="yes"</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@176 network-scripts]# vi ifcfg-eth0</font></div><div><div><font size="2"   >DEVICE="eth0"</font></div><div><font size="2"   >BOOTPROTO="static"</font></div><div><font size="2"   >HWADDR="00:23:7D:A3:F0:4E"</font></div><div><font size="2"   >NM_CONTROLLED="no"</font></div><div><font size="2"   >ONBOOT="yes"</font></div><div><font size="2"   >BRIDGE="br0"</font></div></div><p></p></pre></div><div>将eth0加入br0, 同时重启网络服务</div><div># ovs-vsctl add-port br0 eth0; service network restart</div><div>现在可以看到, eth0加入了网桥br0, 还有一个接口叫br0 , 是这个网桥默认的内部接口,不用管它.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 ~]# ovs-vsctl show</font></div><div><font size="2"   >8901fd9e-3b91-48ff-b0e8-8aa926fd2617</font></div><div><font size="2"   >&nbsp; &nbsp; Bridge "br0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Port "eth0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interface "eth0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Port "br0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interface "br0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; type: internal</font></div><div><font size="2"   >&nbsp; &nbsp; ovs_version: "1.9.3"</font></div><p></p></pre></div><div><br></div><div>虚拟机可以使用br0来创建虚拟接口了, 创建好虚拟接口后, 可以添加到ovs, 改vlan tag, 等操作.</div><div>参考</div><div><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020147111145122/"   >http://blog.163.com/digoal@126/blog/static/16387704020147111145122/</a>&nbsp;</div><div><br></div><div>还可以继续新建网桥</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 ~]# ovs-vsctl add-br br1</font></div><div><font size="2"   >[root@176 ~]# ifconfig br1 up</font></div><div><font size="2"   >[root@176 ~]# ovs-vsctl show</font></div><div><font size="2"   >8901fd9e-3b91-48ff-b0e8-8aa926fd2617</font></div><div><font size="2"   >&nbsp; &nbsp; Bridge "br1"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Port "br1"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interface "br1"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; type: internal</font></div><div><font size="2"   >&nbsp; &nbsp; Bridge "br0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Port "eth0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interface "eth0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Port "br0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interface "br0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; type: internal</font></div><div><font size="2"   >&nbsp; &nbsp; ovs_version: "1.9.3"</font></div><p></p></pre></div><div>删除网桥</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@176 ~]# ovs-vsctl del-br br1</font></div><div><font size="2"   >[root@176 ~]# ovs-vsctl show</font></div><div><font size="2"   >8901fd9e-3b91-48ff-b0e8-8aa926fd2617</font></div><div><font size="2"   >&nbsp; &nbsp; Bridge "br0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Port "eth0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interface "eth0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Port "br0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interface "br0"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; type: internal</font></div><div><font size="2"   >&nbsp; &nbsp; ovs_version: "1.9.3"</font></div><p></p></pre></div><div><br></div></div>[参考]<wbr><div>1. README</div><div>2. README.RHEL</div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020147111145122/"   >http://blog.163.com/digoal@126/blog/static/16387704020147111145122/</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Install OpenVSwitch on CentOS 6.x x64 - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>