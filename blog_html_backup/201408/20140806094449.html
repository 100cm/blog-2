<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">tunctl used  & bridge sub interface network used with multi-network env</h2>
	<h5 id="">2014-08-06 9:44:49&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020147693015754/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>虚拟网络接口的创建和使用, 另外如果使用了网桥的情况下, 虚拟机如果配置的网段和主机不同, 并且没有trunk口没有路由器的情况下, 虚拟机和主机之间通讯的方法.</div><div>安装tunctl</div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum install -y tunctl</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >添加一个虚拟网络设备</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   ># tunctl -u nobody -g nobody -t tap0 -p</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >将虚拟网络设备激活</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   ># ifconfig tap0 up</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >查看链路状态</span></div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   ># ip link&nbsp;</font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >15: tap0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 500</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; link/ether 5a:6c:f8:ee:ad:5b brd ff:ff:ff:ff:ff:ff</font></div></div><p></p></pre></div></div><div>将虚拟网络设备添加到网桥</div><pre class="prettyprint"   ><p></p><div><font size="2"   ># brctl addif ovirtmgmt tap0</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >将虚拟网络设备从网桥删除</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   ># brctl delif ovirtmgmt tap0</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >删除一个虚拟网络设备</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   ># tunctl -d tap0</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >当一个网桥中有多个IP段需要使用时, 并且没有路由器的情况下, 如果要通讯的话, 需要在主机上配置多个网段, 相同网段之间进行通讯.&nbsp;</span></div><div><span style="line-height: 28px;"   >配置网桥的子接口IP</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># cd /etc/sysconfig/network-scripts/</font></div><div><div><font size="2"   ># brctl show</font></div><div><font size="2"   >bridge name &nbsp; &nbsp; bridge id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STP enabled &nbsp; &nbsp; interfaces</font></div><div><font size="2"   >;vdsmdummy; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8000.000000000000 &nbsp; &nbsp; &nbsp; no</font></div><div><font size="2"   >ovirtmgmt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8000.00221960778f &nbsp; &nbsp; &nbsp; no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;em1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vnet0</font></div></div><div><font size="2"   ># cp ifcfg-ovirtmgmt ifcfg-ovirtmgmt:1</font></div><div><font size="2"   ># vi ifcfg-ovirtmgmt:1</font></div><div><div><font size="2"   >DEVICE=ovirtmgmt:1</font></div><div><font size="2"   >BOOTPROTO=static</font></div><div><font size="2"   >ONBOOT=yes</font></div><div><font size="2"   >BROADCAST=172.16.13.255</font></div><div><font size="2"   >IPADDR=172.16.13.150</font></div><div><font size="2"   >NETMASK=255.255.255.0</font></div><div><font size="2"   >NM_CONTROLLED=no</font></div></div><p></p></pre></div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >HOSTA - if0(172.16.3.0/24, 172.16.13.0/24)</font></div><div><span style="line-height: 28px;"   ><font size="2"   >HOSTB - if0(172.16.3.0/24, 172.16.13.0/24)</font></span></div><div><font size="2"   ><span style="line-height: 28px;"   >VMA</span><span style="line-height: 28px;"   >&nbsp;</span><span style="line-height: 28px;"   >- if0(172.16.13.0/24)</span></font></div><div><font size="2"   ><span style="line-height: 28px;"   >VMB&nbsp;</span><span style="line-height: 28px;"   >- if0(172.16.13.0/24)</span></font></div><p></p></pre></div><div>以上都可以相互通讯.</div><div><br></div><div>[参考]</div><div>1. man tunctl</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 network-scripts]# man tunctl</font></div><div><font size="2"   >TUNCTL(8) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TUNCTL(8)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >NAME</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;tunctl - create and manage persistent TUN/TAP interfaces</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SYNOPSIS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;tunctl [ OPTIONS ] &nbsp;[ -u owner ] &nbsp;[ -t device-name ]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;tunctl -d device-name</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >DESCRIPTION</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;tunctl allows the host sysadmin to preconfigure a TUN/TAP network interface for use by a particular user. &nbsp;That</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;user may open and use the network/write side of the interface, but may not change any aspects of the host &nbsp;side</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;of the interface.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >OPTIONS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-b &nbsp; &nbsp; Brief output, prints just the interface name</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-n &nbsp; &nbsp; Create &nbsp;a &nbsp;point-to-point &nbsp;TUN &nbsp;interface without Ethernet header. &nbsp;Automatically enabled if the desired</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; interface name starts with "tun".</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-p &nbsp; &nbsp; Create a TAP type interface with Ethernet header. Automatically selected if the desired interface starts</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; with "tap" or if no interface name is given.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-f tun-clone-device</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Specifies the tun clone device name. The default is /dev/net/tun, but some systems use /dev/misc/net/tun</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instead.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-d interfacename</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Delete the specified interfacename (set it to non-persistent)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-u user</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Specifies the owner of the interface. This user is allowed to attach to the "network/wire" side.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-g group</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Specifies the group of the interface. This group is allowed to attach to the "network/wire" side of &nbsp;the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; interface.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-t interface</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Specifies the desired interface name.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >USAGE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;To create an interface for use by a particular user, invoke tunctl without the -d option:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# tunctl -u someuser</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set ’tap0’ persistent and owned by ’someuser’</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Then, configure the interface as normal:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# ifconfig tap0 192.168.0.254 up</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# route add -host 192.168.0.253 dev tap0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# bash -c ’echo 1 &gt; /proc/sys/net/ipv4/conf/tap0/proxy_arp’</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# arp -Ds 192.168.0.253 eth0 pub</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;To delete the interface, use the -d option:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# tunctl -d tap0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set ’tap0’ nonpersistent</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SEE ALSO</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The UserModeLinux-HOWTO &lt;URL:http://user-mode-linux.sourceforge.net/old/UserModeLinux-HOWTO.html&gt;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >AUTHOR</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;tunctl &nbsp;was &nbsp;originally &nbsp;written by Jeff Dike &lt;jdike@karaya.com&gt; as part of the User Mode Linux tools. &nbsp;Current</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;version is maintained as a separate package by Henrik Nordstrom &lt;henrik@henriknordstrom.net&gt;.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;This manual page was originally written by Matt Zimmerman &lt;mdz@debian.org&gt; for &nbsp;the &nbsp;Debian &nbsp;GNU/Linux &nbsp;system,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;based &nbsp;on &nbsp;examples &nbsp;from &nbsp;Jeff &nbsp;Dike. &nbsp;Extended &nbsp;by Henrik Nordstrom &lt;henrik@henriknordstrom.net&gt; to cover all</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;options supported.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;July &nbsp;9, 2008 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TUNCTL(8)</font></div><p></p></pre></div>
<div><br></div><a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="tunctl used   bridge sub interface network used with multi-network env - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>