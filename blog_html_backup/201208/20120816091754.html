<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">why execl() and execle() dynamic arguments must end with NULL</h2>
	<h5 id="">2012-08-16 9:17:54&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201271685443161/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>exec() functions replace the current process :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >    A process is just a program running in memory. If you type taskmgr on Windows or ps -ef on most other machines, you’ll see the processes running on your system. The operating system tracks each process with a number called the process identifier (PID).&nbsp;</font></div><div><font size="2"  >    The exec() functions replace the current process by running some other program. You can say which command-line arguments or environment variables to use, and when the new program starts it will have exactly the same PID as the old one. It’s like a relay race, where your program hands over its process to the new program.</font></div><p></p></pre></div><div>如图 :&nbsp;</div><div><div><img title="why execl() and execle() dynamic arguments must end with NULL - 德哥@Digoal - The Heart,The World."  alt="why execl() and execle() dynamic arguments must end with NULL - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img0.ph.126.net/NdwWy8PsLhU_P44ybpjnaQ==/2505971717672747800.jpg"  ></div>&nbsp;</div><div><br></div><div>exec语法 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >NAME</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;execl, execlp, execle, execv, execvp - execute a file</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SYNOPSIS</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;#include &lt;unistd.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;extern char **environ;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;int execl(const char *path, const char *arg, ...);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;int execlp(const char *file, const char *arg, ...);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;int execle(const char *path, const char *arg,</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ..., char * const envp[]);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;int execv(const char *path, char *const argv[]);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;int execvp(const char *file, char *const argv[]);</font></div><p></p></pre></div><div>这几种exec的用法如图 :&nbsp;</div><div><div><img title="why execl() and execle() dynamic arguments must end with NULL - 德哥@Digoal - The Heart,The World."  alt="why execl() and execle() dynamic arguments must end with NULL - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img7.ph.126.net/lxe-nJi6djHsdIrqqB-Fkg==/2518919566601540137.jpg"  ></div>&nbsp;</div><div><br></div><div>可以看到execl, execlp, execle 都用到了... dynamic arguments. &nbsp;这些arguments必须以NULL结尾.</div><div>如 :&nbsp;</div><div><div><img title="why execl() and execle() dynamic arguments must end with NULL - 德哥@Digoal - The Heart,The World."  alt="why execl() and execle() dynamic arguments must end with NULL - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img1.ph.126.net/tMHTVQPdBM9yI6W2yv41Yw==/2612932208822788721.jpg"  ></div>&nbsp;</div><div><div><img title="why execl() and execle() dynamic arguments must end with NULL - 德哥@Digoal - The Heart,The World."  alt="why execl() and execle() dynamic arguments must end with NULL - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img5.ph.126.net/VFo4C8aJKNpzVEQ0y3dLjw==/3064699546443348975.jpg"  ></div>&nbsp;</div><div>那么为什么要以NULL结尾呢?</div><div>我认为是这个系统调用函数为了用NULL来分辨dynamic arguments是否结束的标记.</div><div>下面是一个以NULL为结束标记的例子.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 zzz]# cat a.c</font></div><div><font size="2"  >#include &lt;stdio.h&gt;</font></div><div><font size="2"  >#include &lt;string.h&gt;</font></div><div><font size="2"  >#include &lt;unistd.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >void display(char **a) {</font></div><div><font size="2"  >&nbsp; int i = 0;</font></div><div><font size="2"  >&nbsp; do {</font></div><div><font size="2"  >&nbsp; &nbsp; if( *(a+i) == NULL ) {&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; break;</font></div><div><font size="2"  >&nbsp; &nbsp; }</font></div><div><font size="2"  >&nbsp; &nbsp; fprintf(stdout, "*(a+%i):%s\n", i, *(a+i));</font></div><div><font size="2"  >&nbsp; &nbsp; i++;</font></div><div><font size="2"  >&nbsp; } while (1);</font></div><div><font size="2"  >}</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >int main() {</font></div><div><font size="2"  >&nbsp; char *city[] = {"hangzhou", "changsha", NULL};</font></div><div><font size="2"  >&nbsp; display(city);</font></div><div><font size="2"  >&nbsp; return 0;</font></div><div><font size="2"  >}</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >[root@db-172-16-3-150 zzz]# gcc -O3 -Wall -Wextra -Werror -g ./a.c -o a &amp;&amp; ./a</font></div><div><font size="2"  >*(a+0):hangzhou</font></div><div><font size="2"  >*(a+1):changsha</font></div><p></p></pre></div><div><br></div><div>下面来验证一下exec执行后如果成功的话,exec后面的代码都不会被执行.</div><div>而system这一点则与exec不一样, 它不会向接力棒一样交给另一个进程来完成.&nbsp;system() run programs in a separate process.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 zzz]# cat a.c</font></div><div><font size="2"  >#include &lt;unistd.h&gt;</font></div><div><font size="2"  >#include &lt;stdio.h&gt;</font></div><div><font size="2"  >#include &lt;stdlib.h&gt;</font></div><div><font size="2"  >#include &lt;errno.h&gt;</font></div><div><font size="2"  >#include &lt;string.h&gt;</font></div><div><font size="2"  >#include &lt;time.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >int main() {</font></div><div><font size="2"  >&nbsp; char cmd[100]="ls";</font></div><div><font size="2"  >&nbsp; execlp(cmd, cmd, "-la", "/tmp", NULL);</font></div><div><font size="2"  >&nbsp; fprintf(stdout,"error: %s\n", strerror(errno));</font></div><div><font size="2"  >&nbsp; return 0;</font></div><div><font size="2"  >}</font></div><div><font size="2"  >结果如下, execlp执行成功, 因此</font><span style="font-size: small; line-height: 19px;"  >fprintf(stdout,"error: %s\n", strerror(errno)); 不会执行.</span></div><div><font size="2"  >[root@db-172-16-3-150 zzz]# gcc -O3 -Wall -Wextra -Werror -g ./a.c -o a &amp;&amp; ./a</font></div><div><font size="2"  >total 92</font></div><div><font size="2"  >drwxrwxrwt 10 root root &nbsp;4096 Aug 16 15:36 .</font></div><div><font size="2"  >drwxr-xr-x 31 root root &nbsp;4096 Jun 14 12:42 ..</font></div><div><font size="2"  >-rw------- &nbsp;1 pg91 root &nbsp; 163 Aug &nbsp;8 14:07 crontab.XXXXVvpnuy</font></div><div><font size="2"  >drwxrwxrwt &nbsp;2 root root &nbsp;4096 Jun 14 12:42 .font-unix</font></div><div><font size="2"  >drwxr-xr-x &nbsp;2 root root &nbsp;4096 Jun 27 11:06 hsperfdata_root</font></div><div><font size="2"  >-rw-r--r-- &nbsp;1 root root &nbsp; &nbsp; 1 Aug 16 15:36 i4jdaemon__opt_soft_bak_teampostgresql_misc_teampostgresql-service</font></div><div><font size="2"  >drwxrwxrwt &nbsp;2 root root &nbsp;4096 Jun 14 12:42 .ICE-unix</font></div><div><font size="2"  >-rw-rw-r-- &nbsp;1 pg91 pg91 28660 Aug &nbsp;8 13:55 pgstatreport_francs_1_8.txt</font></div><div><font size="2"  >srwxrwxrwx &nbsp;1 pg91 pg91 &nbsp; &nbsp; 0 Aug 16 15:35 .s.PGSQL.1919</font></div><div><font size="2"  >-rw------- &nbsp;1 pg91 pg91 &nbsp; &nbsp;50 Aug 16 15:35 .s.PGSQL.1919.lock</font></div><div><font size="2"  >srwxrwxrwx &nbsp;1 pg92 pg92 &nbsp; &nbsp; 0 Aug 16 14:39 .s.PGSQL.1920</font></div><div><font size="2"  >-rw------- &nbsp;1 pg92 pg92 &nbsp; &nbsp;45 Aug 16 14:39 .s.PGSQL.1920.lock</font></div><div><font size="2"  >drwx------ &nbsp;2 root root &nbsp;4096 Aug 16 13:24 ssh-FyItEH8304</font></div><div><font size="2"  >drwx------ &nbsp;2 pg91 pg91 &nbsp;4096 Aug 16 14:16 ssh-gGHOMN9986</font></div><div><font size="2"  >drwx------ &nbsp;2 root root &nbsp;4096 Aug 15 13:19 ssh-HdpxR15412</font></div><div><font size="2"  >drwx------ &nbsp;2 root root &nbsp;4096 Aug 15 12:45 ssh-OeSDD14316</font></div><div><font size="2"  >drwx------ &nbsp;2 root root &nbsp;4096 Aug 16 12:52 ssh-xZxVDz7642</font></div><p></p></pre></div><div>当execlp执行异常时,&nbsp;<span style="line-height: 22px;"  >&nbsp; fprintf(stdout,"error: %s", strerror(errno));才会执行, 如下 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 zzz]# cat a.c</font></div><div><font size="2"  >#include &lt;unistd.h&gt;</font></div><div><font size="2"  >#include &lt;stdio.h&gt;</font></div><div><font size="2"  >#include &lt;stdlib.h&gt;</font></div><div><font size="2"  >#include &lt;errno.h&gt;</font></div><div><font size="2"  >#include &lt;string.h&gt;</font></div><div><font size="2"  >#include &lt;time.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >int main() {</font></div><div><font size="2"  >&nbsp; char cmd[100]="ls";</font></div><div><font size="2"  >&nbsp; execlp(cmd, cmd, "-la", "/tm", NULL);</font></div><div><font size="2"  >&nbsp; fprintf(stdout,"error: %s\n", strerror(errno));</font></div><div><font size="2"  >&nbsp; return 0;</font></div><div><font size="2"  >}</font></div><div><font size="2"  >结果 : </font></div><div><font size="2"  >[root@db-172-16-3-150 zzz]# gcc -O3 -Wall -Wextra -Werror -g ./a.c -o a &amp;&amp; ./a</font></div><div><font size="2"  >ls: /tm: No such file or directory</font></div><p></p></pre></div><div><br></div><div>system()不管执行是否成功, 后面的步骤继续走下去.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[root@db-172-16-3-150 zzz]# cat a.c</font></div><div><font size="2"  >#include &lt;unistd.h&gt;</font></div><div><font size="2"  >#include &lt;stdio.h&gt;</font></div><div><font size="2"  >#include &lt;stdlib.h&gt;</font></div><div><font size="2"  >#include &lt;errno.h&gt;</font></div><div><font size="2"  >#include &lt;string.h&gt;</font></div><div><font size="2"  >#include &lt;time.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >int main() {</font></div><div><font size="2"  >&nbsp; //execlp(cmd, cmd, "-la", "/tm", NULL);</font></div><div><font size="2"  >&nbsp; system("ls -la /tmp");</font></div><div><font size="2"  >&nbsp; fprintf(stdout,"error: %s\n", strerror(errno));</font></div><div><font size="2"  >&nbsp; return 0;</font></div><div><font size="2"  >}</font></div><div><font size="2"  >结果 : </font></div><div><font size="2"  >[root@db-172-16-3-150 zzz]# gcc -O3 -Wall -Wextra -Werror -g ./a.c -o a &amp;&amp; ./a</font></div><div><font size="2"  >total 92</font></div><div><font size="2"  >drwxrwxrwt 10 root root &nbsp;4096 Aug 16 15:38 .</font></div><div><font size="2"  >drwxr-xr-x 31 root root &nbsp;4096 Jun 14 12:42 ..</font></div><div><font size="2"  >-rw------- &nbsp;1 pg91 root &nbsp; 163 Aug &nbsp;8 14:07 crontab.XXXXVvpnuy</font></div><div><font size="2"  >drwxrwxrwt &nbsp;2 root root &nbsp;4096 Jun 14 12:42 .font-unix</font></div><div><font size="2"  >drwxr-xr-x &nbsp;2 root root &nbsp;4096 Jun 27 11:06 hsperfdata_root</font></div><div><font size="2"  >-rw-r--r-- &nbsp;1 root root &nbsp; &nbsp; 1 Aug 16 15:38 i4jdaemon__opt_soft_bak_teampostgresql_misc_teampostgresql-service</font></div><div><font size="2"  >drwxrwxrwt &nbsp;2 root root &nbsp;4096 Jun 14 12:42 .ICE-unix</font></div><div><font size="2"  >-rw-rw-r-- &nbsp;1 pg91 pg91 28660 Aug &nbsp;8 13:55 pgstatreport_francs_1_8.txt</font></div><div><font size="2"  >srwxrwxrwx &nbsp;1 pg91 pg91 &nbsp; &nbsp; 0 Aug 16 15:35 .s.PGSQL.1919</font></div><div><font size="2"  >-rw------- &nbsp;1 pg91 pg91 &nbsp; &nbsp;50 Aug 16 15:35 .s.PGSQL.1919.lock</font></div><div><font size="2"  >srwxrwxrwx &nbsp;1 pg92 pg92 &nbsp; &nbsp; 0 Aug 16 15:37 .s.PGSQL.1920</font></div><div><font size="2"  >-rw------- &nbsp;1 pg92 pg92 &nbsp; &nbsp;45 Aug 16 15:37 .s.PGSQL.1920.lock</font></div><div><font size="2"  >drwx------ &nbsp;2 root root &nbsp;4096 Aug 16 13:24 ssh-FyItEH8304</font></div><div><font size="2"  >drwx------ &nbsp;2 pg91 pg91 &nbsp;4096 Aug 16 14:16 ssh-gGHOMN9986</font></div><div><font size="2"  >drwx------ &nbsp;2 root root &nbsp;4096 Aug 15 13:19 ssh-HdpxR15412</font></div><div><font size="2"  >drwx------ &nbsp;2 root root &nbsp;4096 Aug 15 12:45 ssh-OeSDD14316</font></div><div><font size="2"  >drwx------ &nbsp;2 root root &nbsp;4096 Aug 16 12:52 ssh-xZxVDz7642</font></div><div><font size="2"  >error: Success</font></div><div><font size="2"  >[root@db-172-16-3-150 zzz]#&nbsp;</font></div><p></p></pre></div><div><br></div><div>【参考】</div><div>variable number of arguments :&nbsp;</div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402012714102818672/"  >http://blog.163.com/digoal@126/blog/static/1638770402012714102818672/</a> </div><div><div><br></div><div>环境变量相关函数 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >NAME</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;getenv - get an environment variable</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SYNOPSIS</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;#include &lt;stdlib.h&gt;</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;char *getenv(const char *name);</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >DESCRIPTION</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;The &nbsp;getenv() &nbsp;function &nbsp;searches the environment list for a string that matches the string pointed to by name.</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;The strings are of the form name = value.</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >RETURN VALUE</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;The getenv() function returns a pointer to the value in the environment, or NULL if there is no match.</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >CONFORMING TO</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;SVr4, POSIX.1-2001, 4.3BSD, C89</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >SEE ALSO</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;clearenv(3), putenv(3), setenv(3), unsetenv(3), environ(7)</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >GNU &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1993-04-03 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GETENV(3)</font></div><p></p></pre></div></div><wbr></div>
	</div>
</div>
</body>
</html>