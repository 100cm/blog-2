<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">deal with oracle ORA-600[4193]; ORA-600[4194/4193]; ORA-600[4194]</h2>
	<h5 id="">2010-08-02 17:19:55&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020107251955780/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><p>今天处理了一台开发数据库的600异常。</p> <p>记录一下处理过程：</p> <p>现象：</p> <p>服务器开起来之后，文件系统报错，提升ctl+D重启或输入ROOT密码登录。登录进去后看到的文件系统已经不正常了，变成了只读状态。并且有提升SELINUX相关的一些东西（具体忘记了，后来把SELINUX手工关掉了）。文件系统只读了，数据库的话当然也是起不来滴。</p> <p>处理过程：</p> <p>1. 由于进单用户之前也必须CHECK 文件系统，所以的话还是放弃了在单用户下修复。</p> <p>2. 进入linux rescue模式，fsck异常的文件系统,关闭selinux选项(modify /etc/selinux/config)。重启服务器，文件系统恢复正常。</p> <p>3. 启动数据库，发现起不来。报出了类似ORA-600[4193]; ORA-600[4194/4193]; ORA-600[4194]的经典错误</p> <p>4. 数据库恢复阶段：startup mount</p><p>recover database using backup controlfile;</p><p>输入所需的online redo log的path;</p><p>恢复完成。</p><p>重启数据库。开始报UNDO段错误，并且起来之后一会就重启。</p><p>查了metalink之后，建议重建UNDO表空间。</p><p>create undo tablespace undo_new datafile '' size ....;</p><p>alter system set undo_tablespace=undo_new scope=spfile;</p><p>restart database;</p><p>恢复正常。</p><p>删除掉老的UNDO表空间。</p><p><br></p><p><br></p><p>备注：</p><p>METALINK关于回滚段错误的CASE。</p><p><br></p><p></p><p><b>In this Document</b><br><font size="-1"  >&nbsp;&nbsp;<a rel="nofollow" href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;doctype=HOWTO&amp;id=281429.1#GOAL"  >Goal</a><br>&nbsp;&nbsp;<a rel="nofollow" href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;doctype=HOWTO&amp;id=281429.1#FIX"  >Solution</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a rel="nofollow" href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;doctype=HOWTO&amp;id=281429.1#aref1"  ><strong>&nbsp;Single  instance</strong></a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a rel="nofollow" href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;doctype=HOWTO&amp;id=281429.1#aref2"  ><strong>For Rac Instance(If one  instance is down and other is up and running)</strong></a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a rel="nofollow" href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;doctype=HOWTO&amp;id=281429.1#aref3"  ><strong><u>For 8i database and Below</u></strong></a><br>&nbsp;&nbsp;<a rel="nofollow" href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;doctype=HOWTO&amp;id=281429.1#REF"  >References</a><br></font> </p><hr size="1"  >  <p>Platforms: 1-914CU;  </p><p> <table border="1"  cellspacing="0"  cellpadding="4"  align="center"  > <tbody> <tr> <td><font size="-1"  ><em>This document is being delivered to you via Oracle  Support's Rapid Visibility (RaV) process and therefore has not been subject to  an independent technical review.</em></font></td></tr></table></p> <p> </p><h2>Applies to: </h2>Oracle Server - Enterprise Edition<br>Information  in this document applies to any platform.<br>Oracle Server Enterprise Edition  <h2><a name="GOAL" rel="nofollow"  ></a>Goal</h2>This note will give an Brief overview of  the steps to resolve ORA-600 [4194]/[4193]:-<br><br>This note is intended for  internal use only  <h2><a name="FIX" rel="nofollow"  ></a>Solution</h2> <p>Short Description of  ORA-00600[4194]<br><br>---------------------------------------<br><br>A mismatch  has been detected between Redo records and rollback (Undo)  <br>records.<br><br>ARGUMENTS:<br>Arg [a] Maximum Undo record number in Undo  block<br>Arg [b] Undo record number from Redo block<br><br><br></p> <p> </p><p><br>Refer to <a rel="nofollow" href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=39283.1"  >Note:39283.1</a>  for more details on the description of this error.<br></p> <p>Basic Steps that Need to be Followed to Solve an ORA-00600[4194]  Error<br><br>There are&nbsp;two Options to resolve this issue.<br><br>Options along  with their solutions are given below.</p> <p><strong></strong>&nbsp;</p> <div style="WIDTH: 95%;"  ><code></code> <p><strong>Option 1:- Support Method(Drop&nbsp;the&nbsp;undo&nbsp;tablespace).  <br><br><br><br></strong></p></div> <p><strong>&nbsp;</strong></p> <p><strong>&nbsp;@There is no need to use Unsupported parameter like  _offline_rollback_segments and @_corrupted_rollback_segments to resolve  ora-00600[4193]/[4194]</strong></p> <p><strong>&nbsp;</strong></p> <p><strong>Option 1 :- Supported Method <br>======================</strong></p> <p><strong><br></strong></p> <p><strong>Drop the undo tablespace.&nbsp;</strong></p> <p><strong>&nbsp;</strong></p> <div style="WIDTH: 95%;"  > <h3><code></code></h3> <h3><a name="aref1" rel="nofollow"  ></a><strong>&nbsp;Single instance<br></strong></h3> <p><strong>This error normally happens for a new transaction. The trace file  actually shows an active transaction for the undo segment because this is the  transaction created by the same  process.If&nbsp;the&nbsp;undo&nbsp;segment&nbsp;happens&nbsp;to&nbsp;have&nbsp;an&nbsp;active&nbsp;transaction&nbsp;,&nbsp;then&nbsp;Oracle<br>may&nbsp;recover&nbsp;it&nbsp;later&nbsp;with&nbsp;no&nbsp;problems  .<br><br>Normally if the header is dumped after the error, the active transactin  is gone.</strong></p> <p><strong>So a Simpler option to resolve this issue is.</strong></p> <p><strong>Step 1<br>--------</strong></p> <p><strong>SQL&gt; Startup nomount ;&nbsp;&nbsp;&nbsp; --&gt; using spfile</strong></p> <p><strong>SQL&gt; Create pfile='/tmp/corrupt.ora' from spfile ; <br><br>SQL&gt;  Shutdown immediate; <br></strong></p> <p><strong>Step 2<br>-------<br><br>Modify the corrupt.ora and set  Undo_managment=Manual <br><br>SQL&gt; Startup mount pfile='/tmp/corrupt.ora'  <br><br>SQL&gt; Show parameter undo <br><br>&nbsp;&nbsp; it should show manual  <br><br>SQL&gt; Alter database open ; <br><br>If it comes up <br><br>SQL&gt;  Create rollback segment r01 ; <br><br>SQL&gt; Alter rollback segment r01 online  ; <br><br>Create a new undo tablespace <br><br>SQL&gt; Create undo tablespace  undotbs_new datafile '&lt;&gt;' size &lt;&gt; M ; <br></strong></p> <p><strong>Drop the Old undo tablespace</strong></p> <p><strong>SQL&gt; Drop tablespace &lt;undo tablespace name&gt; including  contents and datafiles</strong></p> <p><strong>&nbsp;</strong></p> <p><strong>Step 3<br>-------</strong></p> <p><strong>SQL&gt; Shutdown immediate; <br><br>SQL&gt; Startup nomount ; ---&gt;  Using spfile <br><br>SQL&gt;Alter system set undo_tablespace=&lt;new Undo  tablespace created&gt; scope=spfile; <br><br>SQL&gt; Shutdown immediate ;  <br><br>SQL&gt; Startup <br></strong></p> <p><strong>Check if error is reported<br></strong></p> <p><strong>&nbsp;</strong></p> <h3><a name="aref2" rel="nofollow"  ></a><strong>For Rac Instance(If one instance is down  and other is up and running)<br></strong></h3> <p><strong>------------------------<br><br>If one node is up and running and  other node is failing with ORA-00600[4194]/[4193] then</strong></p> <p><strong>From the instance which is up and running create a new undo  tablespace and make it the default one for the other instance which is down with  the error.Startup the failing instance with<br>the new undo  tablespace.</strong></p> <p><br></p> <p><strong></strong></p> <div style="WIDTH: 95%;"  ><code></code> <p><strong>From Instance which is up and running <br></strong></p> <p><strong>Create undo tablespace undo_new datafile '&lt;filename&gt;' size  &lt;&gt; m ;<br></strong></p> <p><strong>Alter system set undo_tablespace=&lt;New undo tablespace name&gt;  sid=&lt;instance which has corrupt undo tablespace and is down&gt;&nbsp;  ;</strong></p> <p><strong>Now Startup the Instance which is down</strong></p> <p><strong>SQL&gt;Startup mount <br></strong></p> <p><strong>SQL&gt;Show parameter undo</strong></p> <p><strong>Should show the new undo tablespace created above</strong></p> <p><strong>SQL&gt;Alter database open ;</strong></p> <p><strong>SQL&gt;Drop tablespace &lt;Old undo tablespace of the failing  instance&gt; including contents and datafiles</strong></p></div> <p><br></p> <p>If all the Instance is down in the Rac due to this error then following the  instruction given for Single instance and&nbsp; create new undo tablespace.<br></p> <p><strong><br></strong></p> <p><strong><br></strong></p> <h3><a name="aref3" rel="nofollow"  ></a><strong><u>For 8i database and  Below</u></strong></h3> <p><strong></strong></p> <p><strong>SQL&gt;Startup restrict </strong></p> <p><strong></strong></p> <p><strong>Drop the Manual rollback segments and recreate it </strong></p> <p></p></div> <p><strong>&nbsp;</strong></p> <p><strong>&nbsp;</strong>&nbsp; </p> <div style="WIDTH: 95%;"  ><code></code> <p><strong>@Option 2 (Drop the Rollback segment)<br> </strong></p><strong><p><strong>@From the ora-00600[4194] trace file identify the undo segment  </strong></p> <p><strong>@For example </strong></p> <p><strong>@ORA-00600: internal error code, arguments: [4194], [19], [33], [],  [], [], </strong></p> <p><strong>@In the above example </strong></p> <p><strong>@ARGUMENTS: <br></strong></p> <p><strong>@a----&gt; 19&nbsp;</strong></p> <p><strong>@Search for UNDO BLK in the trace file</strong></p> <p><strong>@********************************************************************************<br> </strong></p><strong><p><strong>@cnt---&gt;0x13 --&gt; Decimal --&gt; 19</strong></p> <p> </p><p> </p><p> </p><p> </p><p> </p><p><br><br> </p><p></p> <p></p> <p>&nbsp;<br></p></strong></strong></div><strong><strong> <p>&nbsp;</p> <p>&nbsp;</p> <p><strong>@Option 3(System undo segment erroring with  Ora-00600[4194/4193]<br></strong></p><strong> <div style="WIDTH: 95%;"  ><code></code> <p><strong>@Option 1 would fail if the undo segment involved is System undo  segment.</strong></p> <p><strong>@Please refer the note given below for patching the  same.</strong></p> <p><strong>@<a rel="nofollow" href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=452620.1"  >Note.452620.1</a><br> </strong></p><strong><p><strong>&nbsp;</strong></p></strong></div><strong> <p><strong>&nbsp;</strong></p> <p><strong>&nbsp;</strong></p> <p><strong>&nbsp;</strong></p> <p><strong><br></strong></p> <h2><a name="REF" rel="nofollow"  ></a>References</h2><a rel="nofollow" href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=39283.1"  >NOTE:39283.1</a> -  ORA-600 [4194] "Undo Record Number Mismatch While Adding Undo Record"<br><br> <table width="100%"  > <tbody> <tr> <td colspan="2"  > <p><img title="deal with oracle ORA-600[4193]; ORA-600[4194/4193]; ORA-600[4194] - 德哥@Digoal - The Heart,The World."  style="CURSOR: pointer;"  id="collapseImg2"  alt="Show Related Information"  src="https://support.oracle.com/CSP/ui/images/collapse_white.png?MOS_3.3.1.0.0_GENERIC_100524"  >  <b>Related</b><br> </p><div style="WIDTH: 100%; DISPLAY: inline; MARGIN-LEFT: 20px;"  id="collapsibleRelatedData"  > <hr size="1"  > <b style="MARGIN-LEFT: 20px;"  >Products</b>  <hr style="MARGIN-LEFT: 20px;"  size="1"  >  <ul> <li>Oracle Database Products &gt; Oracle Database &gt; Oracle Database &gt;  Oracle Server - Enterprise Edition </li></ul><b style="MARGIN-LEFT: 20px;"  >Errors</b>  <hr style="MARGIN-LEFT: 20px;"  size="1"  >  <table style="MARGIN-LEFT: 30px;"  border="0"  cellspacing="2"  cellpadding="0"  > <tbody> <tr> <td valign="top"  >ORA-600[4193]; ORA-600[4194/4193];  ORA-600[4194]</td></tr></table></div></td></tr></table></strong></strong></strong></strong></div>
	</div>
</div>
</body>
</html>