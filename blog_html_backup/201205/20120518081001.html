<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.2 Something must aware when Migrate to it</h2>
	<h5 id="">2012-05-18 8:10:01&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201241874754900/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">PostgreSQL 9.2 放出Beta版后，列出了很多新特性，提高了性能等。<div>但是在迁移到PostgreSQL 9.2 前，请关注在兼容性这块与以往的版本有那些改变。</div><div>例如9.0放出的时候, 它把默认的bytea_output=escape改成了bytea_output=hex. 所以使用了bytea类型的应用就必须要注意了.</div><div>那么9.2有哪些需要注意的呢?</div><div><div>E.1.2. Migration to Version 9.2</div><div><br></div><div>A dump/restore using pg_dump, or use of pg_upgrade, is required for those wishing to migrate data from any previous release.</div><div>Version 9.2 contains a number of changes that may affect compatibility with previous releases. Observe the following incompatibilities:</div><div><br></div><div>E.1.2.1. Functions</div><div><br></div><div>-- Ensure that xpath() escapes special characters in string values (Florian Pflug, Radoslaw Smogura)</div><div>Without this it is possible to output illegal XML.</div><div><br></div><div>-- Remove hstore's =&gt; operator (Robert Haas, David Wheeler)</div><div>Users should now use hstore(text, text). Since PostgreSQL 9.0, a warning message is emitted when an operator named =&gt; is created because the SQL standard reserves that token for another use.</div><div><br></div><div>-- Have pg_relation_size() and friends return NULL if the object does not exist (Phil Sorber)</div><div>This prevents queries that call these functions from returning errors during concurrent drop operations.</div><div><br></div><div>-- Remove the spclocation field from pg_tablespace (Magnus Hagander, Tom Lane)</div><div>This field was duplicative of the symbolic links already present in the data directory. This allows tablespace directories to be moved while the server is down. Also add pg_tablespace_location() to allow querying of the symbolic links.</div><div><br></div><div>E.1.2.1.1. Temporal Functions</div><div><br></div><div>-- Have EXTRACT of a non-timezone-aware value measure the epoch from local midnight, not UTC midnight (Tom Lane)</div><div>Having these computations depend on UTC was inconsistent. The old behavior is available by casting the value to timestamp with time zone.</div><div>对于使用了此类场景的应用需要注意.</div><div><br></div><div>-- Properly parse time strings with trailing yesterday, today, and tomorrow (Dean Rasheed)</div><div>Previously, SELECT '04:00:00 yesterday'::timestamp returned yesterday's date at midnight.</div><div><br></div><div>-- Fix to_date() and to_timestamp() to wrap incomplete dates toward 2020 (Bruce Momjian)</div><div>Previously, supplied years and year masks of less than four digits wrapped inconsistently.</div><div><br></div><div>E.1.2.2. Object Modification</div><div><br></div><div>-- Prevent ALTER DOMAIN from working on non-domain types (Peter Eisentraut)</div><div>Owner and schema changes were previously possible on non-domain types.</div><div><br></div><div>-- No longer auto-lowercase procedural language names (Robert Haas)</div><div>While unquoted language identifiers are still lowercased, double and single-quoted identifiers are no longer down-cased.</div><div><br></div><div>E.1.2.3. Command-Line Tools</div><div><br></div><div>-- Provide consistent backquote, variable expansion, and quoted substring behavior in psql meta-command arguments (Tom Lane)</div><div>Previously, such usage was only properly expanded when isolated by whitespace, e.g. 'FOO'BAR was output as FOO BAR.</div><div><br></div><div>-- No longer treat clusterdb table names as double-quoted; no longer treat reindexdb table and index names as double-quoted (Bruce Momjian)</div><div>Users must supply double-quotes in the command arguments to accomplish double-quoting behavior.</div><div><br></div><div>-- Disable prompting for the user name in dropdb unless --interactive is specified (Peter Eisentraut, Josh Kupershmidt)</div><div><br></div><div>-- No longer have createuser prompt for settings (Peter Eisentraut, Josh Kupershmidt)</div><div>Previously createuser prompted regarding various user settings.</div><div><br></div><div>-- Remove initdb support for the crypt authentication method (Peter Eisentraut)</div><div>This was removed from the backend years ago.</div><div><br></div><div>E.1.2.4. Server Settings</div><div><br></div><div>-- Remove the postgresql.conf setting silent_mode (Heikki Linnakangas)</div><div>This behavior could already be accomplished with pg_ctl -l postmaster.log.</div><div><br></div><div>-- Remove GUC wal_sender_delay, as it is no longer needed (Tom Lane)</div><div>The new "latch" capability made this setting unnecessary.</div><div>之前在测试<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402012012361519/"  >9.2级联复制</a>的时候就发现这个参数没了, 原来是被新的latch取代了.</div><div><br></div><div>-- Remove the custom_variable_classes postgresql.conf parameter (Tom Lane)</div><div>The checking provided by this setting was dubious. Now any setting can be prefixed by any class name.</div><div>之前发现过没有配置<span style="line-height: 22px;"  >custom_variable_classes但是有配置了以class_name开头的定制参数时引致DOWN机的情况, 9.2去除了配置</span><span style="line-height: 22px;"  >custom_variable_classes, 可以随意配置定制化参数了.</span></div><div><br></div><div>-- Add GUC parameters for specifying the locations of server-side SSL files (Peter Eisentraut)</div><div>This allows changing the location of the files that were previously hard-coded to server.crt, server.key, root.crt, root.crl. CA (crt) and CRL files no longer have default names, and if specified, these files must exist.</div><div><br></div><div>E.1.2.5. Monitoring</div><div><br></div><div>-- Rename pg_stat_activity.procpid to pid, to match other system tables (Magnus Hagander)</div><div>server process进程号统一叫pid了.</div><div><br></div><div>-- Create a separate pg_stat_activity column to report state information, e.g. idle (Scott Mead, Magnus Hagander, Greg Smith)</div><div>The last query values are preserved, allowing for enhanced analysis.</div><div>pg_stat_activity增加了两列, 一列用于存储当前backend_process的状态, 另一列存储最后一次状态改变的时间.如下</div><div><div><img title="Something must aware when Migrate to PostgreSQL 9.2 - 德哥@Digoal - The Heart,The World."  alt="Something must aware when Migrate to PostgreSQL 9.2 - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img3.ph.126.net/CmzxVB7I6vu_Sp7HiHc0Kg==/1080582435609550413.jpg"  ></div>&nbsp;</div><div>-- Rename pg_stat_activity.current_query to query because it is not cleared when the query completes (Magnus Hagander)</div><div>current_query更名为query.</div><div><br></div><div>-- Change all SQL-level statistics timing values to float8-stored milliseconds (Tom Lane)</div><div>The columns affected are: pg_stat_user_functions.total_time, pg_stat_user_functions.self_time, pg_stat_xact_user_functions.total_time, pg_stat_xact_user_functions.self_time.</div><div><br></div><div>-- Change pg_stat_statements' total_time column to be measured in milliseconds (Tom Lane)</div></div><div>以前是秒, 用起来不太方便, 每次算都要乘以1000来转成毫秒.</div><div><br></div><div>【参考】</div><div><a rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/release-9-2.html"  >http://www.postgresql.org/docs/9.2/static/release-9-2.html</a> </div></div>
	</div>
</div>
</body>
</html>