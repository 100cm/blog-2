<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">OTRS in Nginx using FCGI (multiple users possible)</h2>
	<h5 id="">2014-07-16 17:05:01&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014616551718/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">原文<wbr><div><a target="_blank" rel="nofollow" href="http://wiki.otterhub.org/index.php?title=OTRS_in_Nginx_using_FCGI_(multiple_users_possible)"   >http://wiki.otterhub.org/index.php?title=OTRS_in_Nginx_using_FCGI_(multiple_users_possible)</a></div><div><br></div><div><div>OTRS in Nginx using FCGI (multiple users possible)</div><div>There might be a more up2date version of this how-to here.</div><div>OTRS is a very extensive Trouble Ticketing System. It is written in Perl, which has some advantages, but causes some issues performancewise.</div><div>One way to deal with it is by running OTRS in Apache with mod_perl. That definitely improves OTRS' performance but introduces another issue. You cannot combine mod_perl with mod_itk, a module to run various sites as various users. If you would choose to run OTRS in mod_perl, you must run all sites as www-data (or the equivalent of your distro).</div><div>I've been searching for a solution to run OTRS fast, but with the possibility to run OTRS as a seperate user.</div><div>OTRS has thought of the possibility to run it using fcgi, but documentation on howto setup fcgi properly was lacking. Running OTRS as a seperate user seemed to be a challenge.</div><div>I finally ended up with Nginx (any other webserver supporting fcgi will probably do fine too), combined with spawn-fcgi. This howto expects you to use Ubuntu and only covers installing OTRS and it's webserver.</div><div>Installation</div><div><br></div><div>Software:</div><div>Apart from software found in Ubuntu's repositories by default, we also use multiwatch which isn't available in Ubuntu itself, but it does have an apt-repository present. To add it to your system, run:</div><div>root@otrs:~# wget -O /etc/apt/sources.list.d/multiwatch.list http://www.tuxis.nl/uploads/howtos/otrs-fcgi/multiwatch.list</div><div>root@otrs:~# apt-key adv --keyserver keys.gnupg.net --recv-keys 80121CD2479689D8</div><div>root@otrs:~# apt-get update</div><div>Now install all software:</div><div>root@otrs:~# apt-get install mysql-server nginx spawn-fcgi libnet-dns-perl libio-socket-ssl-perl libnet-ldap-perl libgd-text-perl libgd-graph-perl libpdf-api2-perl libsoap-lite-perl libuser libcgi-fast-perl multiwatch</div><div>OTRS:</div><div>Create a new user for OTRS:</div><div>root@otrs:~# adduser otrs --disabled-login</div><div>Adding user `otrs' ...</div><div>Adding new group `otrs' (1001) ...</div><div>Adding new user `otrs' (1001) with group `otrs' ...</div><div>Creating home directory `/home/otrs' ...</div><div>Copying files from `/etc/skel' ...</div><div>Changing the user information for otrs</div><div>Enter the new value, or press ENTER for the default</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Full Name []: OTRS Webuser</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Room Number []:&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Work Phone []:&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Home Phone []:&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Other []:&nbsp;</div><div>Is the information correct? [Y/n] y</div><div>Now become the new user and download OTRS. Unpack the archive and make sure that you create a symlink named 'otrs' to the extracted directory. This will make upgrades easier. Also make sure that the file otrs/Kernel/Config.pm exists, and that the path to your OTRS-installation in that file is correct.</div><div>root@otrs:~# su - otrs</div><div>otrs@otrs:~$ wget http://ftp.otrs.org/pub/otrs/otrs-2.4.7.tar.bz2</div><div>otrs@otrs:~$ tar xjvf otrs-2.4.7.tar.bz2</div><div>otrs@otrs:~$ ln -s otrs-2.4.7 otrs</div><div>otrs@otrs:~$ mv otrs/Kernel/Config.pm.dist otrs/Kernel/Config.pm</div><div>Edit otrs/Kernel/Config.pm and configure the correct path, in this case "/home/otrs/otrs/"</div><div>Configuration</div><div><br></div><div>Spawn-fcgi isn't started upon request. The goal is to achieve better performance, and starting it over and over again isn't very efficient. So we need to start all processes ahead.</div><div>You can create your own script to fix that, but you can also download this script, or use it as an inspiration. It will arrange for the users you enter to configure Nginx and the Fcgi-setup. It expects Ubuntu's Upstart so if you're using another operatingsystem, this might not work as expected..</div><div>Now run the script for the user you created before. It's possible that the script asks for a hostname for the vhost that will be created:</div><div>root@otrs:~# ./ngfcgiotrs otrs</div><div>Created upstart config for customer.pl</div><div>Created upstart config for index.pl</div><div>Created upstart config for installer.pl</div><div>Created upstart config for public.pl</div><div>Starting service: customer.pl ... index.pl ... installer.pl ... public.pl ... Create vhost-config for otrs.tuxis.net</div><div>There is now a upstart job for every file found in the fcgi-bin directory. These will always be running, whether the webserver is running or not. If any of the processes crash, it will automatically be started again. You can find the created files here:</div><div>/etc/init/otrs/otrs/index.pl.conf</div><div>/etc/init/otrs/otrs/installer.pl.conf</div><div>/etc/init/otrs/otrs/customer.pl.conf</div><div>/etc/init/otrs/otrs/public.conf</div><div>/etc/nginx/sites-available/&lt;vhost-name&gt;</div><div>All that remains is enabling the website and installing OTRS:</div><div>root@otrs:~# cd /etc/nginx/sites-enabled/</div><div>root@otrs:/etc/nginx/sites-enabled# ln -s ../sites-available/otrs.tuxis.net&nbsp;</div><div>root@otrs:/etc/nginx/sites-enabled# /etc/init.d/nginx restart</div><div>Restarting nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</div><div>configuration file /etc/nginx/nginx.conf test is successful</div><div>nginx.</div><div>OTRS will be running completely after this install. When you need to stop or start any of the fcgi-services, you can do so by typing:</div><div>root@otrs:~# stop otrs/$username/index.pl</div><div>root@otrs:~# start otrs/$username/index.pl</div><div>Where $username is obviously the user for whom you want to restart the service.</div><div>installer.pl has an alternative version of the init-script, so it won't start automatically after the install. If you ever need to redo the install or run an upgrade, you can make the installer available by typing:</div><div>root@otrs:~# start otrs/$username/installer.pl</div></div><div><br></div><div><a style="line-height: 28px;" rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="OTRS in Nginx using FCGI (multiple users possible) - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div></div>
	</div>
</div>
</body>
</html>