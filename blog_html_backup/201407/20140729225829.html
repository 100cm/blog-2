<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">oVirt Reports Portal 3.4 added to ovirt-engine</h2>
	<h5 id="">2014-07-29 22:58:29&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201462942137640/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>配置完oVirt engine后, 可以进行用户管理和虚拟化平台的管理, 但是无法生成报告.</div><div>如图, 点击Reports Portal会告诉你没有安装report application.</div><div><div><img title="oVirt Reports Portal 3.4 - 德哥@Digoal - PostgreSQL research"   alt="oVirt Reports Portal 3.4 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/_oTYxcDrgoNx6My8thjusA==/6608604743143405021.png"   ></div><br></div><div>安装ovirt engine可参考昨天发的一篇文章.</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014628114756319/"   >http://blog.163.com/digoal@126/blog/static/1638770402014628114756319/</a></div><div>engine report建议在engine配置前就安装, 那么只需engine-setup时可以直接配置.</div><div>现在的话, 等于已经配置了engine, 再加一个engine report的功能.</div><div>步骤如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum install -y&nbsp;<span style="line-height: 28px;"   >ovirt-engine-reports</span></font></div><div><font size="2"   ><span style="line-height: 28px;"   ><br></span></font></div><div><div><font size="2"   >Installing:</font></div><div><font size="2"   >&nbsp;ovirt-engine-reports &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noarch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3.4.3-1.el6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ovirt-3.4-stable &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.1 M</font></div><div><font size="2"   >Installing for dependencies:</font></div><div><font size="2"   >&nbsp;jasperreports-server &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noarch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5.5.0-7.el6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ovirt-3.4-stable &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;423 M</font></div><div><font size="2"   >&nbsp;liberation-mono-fonts &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; noarch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.05.1.20090721-5.el6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C6.3-base &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 222 k</font></div><div><font size="2"   >&nbsp;ovirt-engine-dwh-setup &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noarch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3.4.3-1.el6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ovirt-3.4-stable &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 51 k</font></div><div><font size="2"   >&nbsp;ovirt-engine-reports-setup &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noarch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3.4.3-1.el6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ovirt-3.4-stable &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 54 k</font></div></div><p></p></pre></div><div>安装时可能遇到GPGCHECK的问题, 加这个参数处理<span style="line-height: 28px;"   >--nogpgcheck.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Package ovirt-engine-dwh-setup-3.4.3-1.el6.noarch.rpm is not signed</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >yum install&nbsp;<span style="line-height: 28px;"   >--nogpgcheck</span><span style="line-height: 28px;"   >&nbsp;-y ovirt-engine-reports</span></font></div><p></p></pre></div><div><span style="line-height: 28px;"   >然后执行engine-setup配置.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# engine-setup --help</font></div><div><font size="2"   >Usage: /usr/bin/engine-setup</font></div><div><font size="2"   >&nbsp; &nbsp; --log=file</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write log to this file.</font></div><div><font size="2"   >&nbsp; &nbsp; --config=file</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Load configuration files.</font></div><div><font size="2"   >&nbsp; &nbsp; --config-append=file</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Load extra configuration files or answer file.</font></div><div><font size="2"   >&nbsp; &nbsp; --offline</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Offline mode.</font></div><div><font size="2"   >&nbsp; &nbsp; --generate-answer=file</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Generate answer file.</font></div><div><font size="2"   >&nbsp; &nbsp; --jboss-home=dir</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Use this jboss.</font></div><p></p></pre></div><div><br></div><div>使用engine-setup过程中, 需要调用pg_dump备份数据库, 这个命令会调用/usr/bin/pg_dump, 而且尝试了几种办法没有办法修改为其他路径下的pg_dump(因为备份和服务端的版本不匹配会导致pg_dump失败). &nbsp;(见末尾)</div><div>所以使用了一个方法, 直接覆盖.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# cp /home/pg93/pgsql/bin/pg_dump /usr/bin</font></div><div><font size="2"   >cp: overwrite `/usr/bin/pg_dump'? y&nbsp;</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# cp /home/pg93/pgsql/bin/pg_restore /usr/bin</font></div><div><font size="2"   >cp: overwrite `/usr/bin/pg_restore'? y</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# cp /home/pg93/pgsql/bin/psql /usr/bin</font></div><div><font size="2"   >cp: overwrite `/usr/bin/psql'? y</font></div><p></p></pre></div><div>还需要修改数据库用户的权限, 备份时开启了read only事务, 必须超级用户.&nbsp;</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >2014-07-29 22:28:18 DEBUG otopi.plugins.**FILTERED**_engine_setup.**FILTERED**_engine.db.schema plugin.execute:866 execute-output: ('/usr/bin/pg_dump', '-E', 'UTF8', '--disable-dollar-quoting', '--disable-triggers', '--format=c', '-U', '**FILTERED**', '-h', 'localhost', '-p', '5432', '-f', '/var/lib/**FILTERED**-engine/backups/engine-20140729222818.Rbikl1.dump', '**FILTERED**') stderr:</font></div><div><font size="2"   >pg_dump: [archiver (db)] query failed: ERROR: &nbsp;permission denied to set parameter "transaction_read_only"</font></div><div><font size="2"   >pg_dump: [archiver (db)] query was: SET TRANSACTION ISOLATION LEVEL REPEATABLE READ, READ ONLY</font></div><p></p></pre></div><div>修改为超级用户.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# alter role ovirt superuser;</font></div><div><font size="2"   >ALTER ROLE</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >安装ovirt-report需要用到两个数据库, 一个历史库, 一个报告库.</span></div></div><div>需要新建. 用户使用ovirt同一个用户, 不一样也行, 无所谓.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># cd /ssd4/pg93</font></div><div><font size="2"   ># mkdir tbs_ovirt_eh</font></div><div><font size="2"   ># chown pg93:pg93 tbs_ovirt_eh</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 pg93]# su - pg93</font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# create tablespace tbs_ovirt_eh location '/ssd4/pg93/tbs_ovirt_eh';</font></div><div><font size="2"   >CREATE TABLESPACE</font></div><div><font size="2"   >digoal=# create database ovirt_eh with template template0 encoding 'UTF8' tablespace tbs_ovirt_eh owner ovirt;</font></div><div><font size="2"   >CREATE DATABASE</font></div><div><font size="2"   >digoal=# \c ovirt_eh ovirt</font></div><div><font size="2"   >You are now connected to database "ovirt_eh" as user "ovirt".</font></div><div><font size="2"   >-- ovirt_eh=&gt; create schema ovirt;  -- 不推荐自建schema, 建议使用public. 和ovirt engine原因一样 .</font></div><div><font size="2"   >-- CREATE SCHEMA</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; mkdir /ssd4/pg93/tbs_ovirt_er</font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# create tablespace tbs_ovirt_er location '/ssd4/pg93/tbs_ovirt_er';</font></div><div><font size="2"   >CREATE TABLESPACE</font></div><div><font size="2"   >digoal=# create database ovirt_er with template template0 encoding 'UTF8' tablespace tbs_ovirt_er owner ovirt;</font></div><div><font size="2"   >CREATE DATABASE</font></div><div><font size="2"   >digoal=# \c ovirt_er ovirt</font></div><div><font size="2"   >You are now connected to database "ovirt_er" as user "ovirt".</font></div><div><font size="2"   >-- ovirt_er=&gt; create schema ovirt;   </font><span style="line-height: 21px; font-size: small; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, 宋体;"   >-- 不推荐自建schema, 建议使用public. 和ovirt engine原因一样 .</span></div><div><font size="2"   >-- CREATE SCHEMA</font></div><div><font size="2"   >ovirt_er=&gt; \c postgres postgres</font></div><div><font size="2"   >You are now connected to database "postgres" as user "postgres".</font></div><div><font size="2"   >postgres=# grant all on tablespace tbs_ovirt_eh to ovirt;</font></div><div><font size="2"   >GRANT</font></div><div><font size="2"   >postgres=# grant all on tablespace tbs_ovirt_er to ovirt;</font></div><div><font size="2"   >GRANT</font></div><div><font size="2"   >postgres=# \q</font></div><p></p></pre></div><div><br></div><div>现在还不能执行engine-setup, 务必改一下yum, 因为某些依赖包可能需要签名认证, 如果没有签名会导致认证失败.</div><div>不推荐这么做, 建议导入KEY.</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014740018561/"   >http://blog.163.com/digoal@126/blog/static/1638770402014740018561/</a></div><div>关闭检测.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /etc/yum.repos.d/ovirt-3.4-dependencies.repo</font></div><div><font size="2"   ><span style="line-height: 28px;"   >vi /etc/yum.repos.d/</span>ovirt-3.4.repo</font></div><div><font size="2"   >修改所有的 gpgcheck=0.</font></div><p></p></pre></div><div><br></div><div>可以执行engine-setup了, 执行过程中会重启ovirt-engine服务, 不过不会影响host上跑的虚拟机, 所以可以放心在线配置.</div><div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@db-172-16-3-150 ~]# engine-setup</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Initializing</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Environment setup</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configuration files: ['/etc/ovirt-engine-setup.conf.d/10-packaging.conf', '/etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf']</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Log file: /var/log/ovirt-engine/setup/ovirt-engine-setup-20140729223458-tzk701.log</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Version: otopi-1.2.2 (otopi-1.2.2-1.el6)</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Environment packages setup</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Yum Downloading: ovirt-3.4-epel/metalink (0%)</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Yum Downloading: repomdydzDTUtmp.xml (0%)</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Yum Downloading: repomd3tKhg7tmp.xml (0%)</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Yum Downloading: repomdcWBV6Ttmp.xml (0%)</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Programs detection</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Environment setup</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Environment customization</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== PRODUCT OPTIONS ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configure Reports on this host (Yes, No) [Yes]:&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configure Data Warehouse on this host (Yes, No) [Yes]:&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== PACKAGES ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Checking for product updates...</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] No product updates found</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== NETWORK CONFIGURATION ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Setup can automatically configure the firewall on this system.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Note: automatic configuration of the firewall may overwrite current settings.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Do you want Setup to configure the firewall? (Yes, No) [Yes]: No</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== DATABASE CONFIGURATION ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Where is the DWH database located? (Local, Remote) [Local]:&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Setup can configure the local postgresql server automatically for the DWH to run. This may conflict with existing applications.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Would you like Setup to automatically configure postgresql and create DWH database, or prefer to perform that manually? (Automatic, Manual) [Automatic]: Manual</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ATTENTION</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Manual action required.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Please create database for ovirt-engine use. Use the following commands as an example:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; create role ovirt_engine_history with login encrypted password 'ovirt_engine_history';</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; create database ovirt_engine_history owner ovirt_engine_history</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;template template0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;encoding 'UTF8' lc_collate 'en_US.UTF-8'</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lc_ctype 'en_US.UTF-8';</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Make sure that database can be accessed remotely.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH database secured connection (Yes, No) [No]:&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH database name [ovirt_engine_history]: ovirt_eh</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH database user [ovirt_engine_history]: ovirt</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH database password:&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Where is the Reports database located? (Local, Remote) [Local]:&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Setup can configure the local postgresql server automatically for the Reports to run. This may conflict with existing applications.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Would you like Setup to automatically configure postgresql and create Reports database, or prefer to perform that manually? (Automatic, Manual) [Automatic]: Manual</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ATTENTION</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Manual action required.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Please create database for ovirt-engine use. Use the following commands as an example:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; create role ovirt_engine_reports with login encrypted password 'ovirt_engine_reports';</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; create database ovirt_engine_reports owner ovirt_engine_reports</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;template template0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;encoding 'UTF8' lc_collate 'en_US.UTF-8'</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lc_ctype 'en_US.UTF-8';</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Make sure that database can be accessed remotely.</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports database secured connection (Yes, No) [No]:&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports database name [ovirt_engine_reports]: ovirt_er</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports database user [ovirt_engine_reports]: ovirt</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports database password:&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== OVIRT ENGINE CONFIGURATION ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Skipping storing options as database already prepared</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== PKI CONFIGURATION ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PKI is already configured</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== APACHE CONFIGURATION ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== SYSTEM CONFIGURATION ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== MISC CONFIGURATION ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports power users password: 输入engien123</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Confirm Reports power users password: 输入<span style="line-height: 28px;"   >engien123</span></font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== END OF CONFIGURATION ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Setup validation</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Cleaning stale zombie tasks</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== CONFIGURATION PREVIEW ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Engine database name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: ovirt</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Engine database secured connection &nbsp; &nbsp; &nbsp;: False</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Engine database host &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: localhost</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Engine database user name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : ovirt</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Engine database host name validation &nbsp; &nbsp;: False</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Engine database port &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 5432</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Update Firewall &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : False</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configure WebSocket Proxy &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : False</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Host FQDN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : db-172-16-3-150.sky-mobi.com</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NFS mount point &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : /ssd4/ovirt/iso</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH installation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: True</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH database name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : ovirt_eh</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH database secured connection &nbsp; &nbsp; &nbsp; &nbsp; : False</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH database host &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : localhost</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH database user name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: ovirt</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH database host name validation &nbsp; &nbsp; &nbsp; : False</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWH database port &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 5432</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configure local DWH database &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: False</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports installation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: True</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports database name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : ovirt_er</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports database secured connection &nbsp; &nbsp; : False</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports database host &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : localhost</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports database user name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: ovirt</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports database host name validation &nbsp; : False</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reports database port &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 5432</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Configure local Reports database &nbsp; &nbsp; &nbsp; &nbsp;: False</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Please confirm installation settings (OK, Cancel) [OK]:&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Cleaning async tasks and compensations</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Checking the Engine database consistency</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Transaction setup</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stopping engine service</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stopping dwh service</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stopping websocket-proxy service</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Misc configuration</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Package installation</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Misc configuration</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Backing up database localhost:ovirt to '/var/lib/ovirt-engine/backups/engine-20140729223904.dQpGRz.dump'.</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Updating Engine database schema</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Creating/refreshing DWH database schema</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Deploying Jasper</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Importing data into Jasper</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Configuring Jasper Java resources</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Configuring Jasper Database resources</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Customizing Jasper</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Customizing Jasper metadata</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Generating post install configuration file '/etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf'</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Transaction commit</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Closing up</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== SUMMARY ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SSH fingerprint: 36:C7:7C:1F:6C:BA:8E:A1:C3:5E:30:1B:AB:07:CA:B7</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Internal CA 5D:77:8F:FF:12:7A:47:1A:20:D2:34:5E:83:8D:FB:7B:B3:78:68:55</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Web access is enabled at:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; http://db-172-16-3-150.sky-mobi.com:80/ovirt-engine</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; https://db-172-16-3-150.sky-mobi.com:443/ovirt-engine</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; In order to configure firewalld, copy the files from</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /etc/ovirt-engine/firewalld to /etc/firewalld/services</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and execute the following commands:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; firewall-cmd -service ovirt-postgres</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; firewall-cmd -service ovirt-https</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; firewall-cmd -service ovirt-http</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The following network ports should be opened:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp:443</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp:5432</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp:80</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; An example of the required configuration for iptables can be found at:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /etc/ovirt-engine/iptables.example</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --== END OF SUMMARY ==--</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Starting engine service</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Restarting httpd</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Starting dwh service</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Clean up</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Log file is located at /var/log/ovirt-engine/setup/ovirt-engine-setup-20140729223458-tzk701.log</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Generating answer file '/var/lib/ovirt-engine/setup/answers/20140729224557-setup.conf'</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Pre-termination</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Stage: Termination</font></div><div style="line-height: 28px;"   ><font size="2"   >[ INFO &nbsp;] Execution of setup completed successfully</font></div><p></p></pre></div></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >配置完, 修改回普通用户.</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >postgres=# alter role ovirt nosuperuser;</font></div><div style="line-height: 28px;"   ><font size="2"   >ALTER ROLE</font></div><p></p></pre></div></div><div style="line-height: 28px;"   >现在可以打开报告了, 从ovirt-engine或以下URL进入.</div><div>https://172.16.3.150/ovirt-engine-reports/</div><div style="line-height: 28px;"   ><div><img title="oVirt Reports Portal 3.4 added to ovirt-engine - 德哥@Digoal - PostgreSQL research"   alt="oVirt Reports Portal 3.4 added to ovirt-engine - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/CdgTCnyd7a86axmyaUeSsQ==/6608437617375983954.png"   ></div>&nbsp;</div><div style="line-height: 28px;"   ><br></div><div>[其他]</div><div>1. pg_dump备份问题的几种解决办法, 都无效.</div><div><div style="line-height: 28px;"   >如果数据库使用了ovirt打包的依赖版本, 例如9.3.5, 那么请把这个版本的bin路径加到/etc/profile, 因为执行engine-setup的时候可能用到pg_dump , 版本不对可能导致备份失败.</div><div style="line-height: 28px;"   ><pre class="prettyprint"   style="line-height: 28px;"   ><p style="line-height: 28px;"   ></p><div style="line-height: 28px;"   ><font size="2"   style="line-height: 21px;"   >vi /etc/profile</font></div><div style="line-height: 28px;"   ><font size="2"   style="line-height: 21px;"   >export PATH=/home/pg93/pgsql/bin:$PATH</font></div><p style="line-height: 28px;"   ></p></pre></div><div style="line-height: 28px;"   >退出shell重进, 确认pg_dump路径正确.</div><div style="line-height: 28px;"   ><pre class="prettyprint"   style="line-height: 28px;"   ><p style="line-height: 28px;"   ></p><div style="line-height: 28px;"   ><font size="2"   style="line-height: 21px;"   ># which psql</font></div><div style="line-height: 28px;"   ><font size="2"   style="line-height: 21px;"   >/home/pg93/pgsql/bin/psql</font></div><p style="line-height: 28px;"   ></p></pre></div><div style="line-height: 28px;"   >或者执行engine-setup时设置PATH也行.</div></div><div style="line-height: 28px;"   >或者修改ovirt-engine 的 python脚本.</div><div style="line-height: 28px;"   >报错信息</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[ INFO &nbsp;] Backing up database localhost:ovirt to '/var/lib/ovirt-engine/backups/engine-20140729213449.w8H6bH.dump'.</font></div><div><font size="2"   >[ ERROR ] Failed to execute stage 'Misc configuration': Command '/usr/bin/pg_dump' failed to execute</font></div><p></p></pre></div><div>日志中都报错信息, 说明了版本问题.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >2014-07-29 21:34:49 DEBUG otopi.plugins.**FILTERED**_engine_setup.**FILTERED**_engine.db.schema plugin.execute:866 execute-output: (</font></div><div><font size="2"   >'/usr/bin/pg_dump', '-E', 'UTF8', '--disable-dollar-quoting', '--disable-triggers', '--format=c', '-U', '**FILTERED**', '-h', 'local</font></div><div><font size="2"   >host', '-p', '5432', '-f', '/var/lib/**FILTERED**-engine/backups/engine-20140729213449.w8H6bH.dump', '**FILTERED**') stderr:</font></div><div><font size="2"   >pg_dump: server version: 9.3.3; pg_dump version: 8.4.20</font></div><div><font size="2"   >pg_dump: aborting because of server version mismatch</font></div><p></p></pre></div><div>修改ovirt-engine的python脚本, 还是没有效果.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.py</font></div><div><font size="2"   ><span>	</span>self._engineEnv.update({</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'PATH': (</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '/home/pg93/pgsql/bin:/usr/local/sbin:/usr/local/bin:'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '/usr/sbin:/usr/bin:/sbin:/bin'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ),</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >/usr/share/ovirt-engine/services/ovirt-engine/ovirt-engine.py</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; self._engineEnv = os.environ.copy()</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; self._engineEnv.update({</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'PATH': (</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '/home/pg93/pgsql/bin:/usr/local/sbin:/usr/local/bin:'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '/usr/sbin:/usr/bin:/sbin:/bin'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ),</font></div><p></p></pre></div><div>修改后, 日志依旧显示使用了/usr/bin/pg_dump</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/var/log/ovirt-engine/setup/</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:468 ENVIRONMENT DUMP - BEGIN</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/chkconfig=str:'/sbin/chkconfig'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/date=str:'/bin/date'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/hwclock=str:'/sbin/hwclock'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/initctl=str:'/sbin/initctl'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/ip=str:'/sbin/ip'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/ntpq=str:'/usr/sbin/ntpq'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/pg_dump=str:'/usr/bin/pg_dump'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/pg_restore=str:'/usr/bin/pg_restore'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/psql=str:'/usr/bin/psql'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/reboot=str:'/sbin/reboot'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/restorecon=str:'/sbin/restorecon'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:478 ENV COMMAND/service=str:'/sbin/service'</font></div><div><font size="2"   >2014-07-28 13:33:38 DEBUG otopi.context context.dumpEnvironment:482 ENVIRONMENT DUMP - END</font></div><p></p></pre></div></div><div style="line-height: 28px;"   >最终选择了覆盖.</div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@db-172-16-3-150 ~]# cp /home/pg93/pgsql/bin/pg_dump /usr/bin</font></div><div style="line-height: 28px;"   ><font size="2"   >cp: overwrite `/usr/bin/pg_dump'? y&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-172-16-3-150 ~]# cp /home/pg93/pgsql/bin/pg_restore /usr/bin</font></div><div style="line-height: 28px;"   ><font size="2"   >cp: overwrite `/usr/bin/pg_restore'? y</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@db-172-16-3-150 ~]# cp /home/pg93/pgsql/bin/psql /usr/bin</font></div><div style="line-height: 28px;"   ><font size="2"   >cp: overwrite `/usr/bin/psql'? y</font></div><p></p></pre></div></div><div><br></div><div>[参考]</div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://wiki.ovirt.org/Ovirt_Reports"   >http://wiki.ovirt.org/Ovirt_Reports</a><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.ovirt.org/How_to_setup_a_oVirt_Reports_development_environment"   >http://www.ovirt.org/How_to_setup_a_oVirt_Reports_development_environment</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014628114756319/"   >http://blog.163.com/digoal@126/blog/static/1638770402014628114756319/</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://wiki.centos.org/HowTos/oVirt"   >http://wiki.centos.org/HowTos/oVirt</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="oVirt Reports Portal 3.4 - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>