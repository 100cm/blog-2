<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Proc.new , proc , lambda and "store values of local variables within the scope in which the block was created"</h2>
	<h5 id="">2012-02-20 8:54:55&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201212084253871/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>Proc.new, proc, lambda 用于从block创建对象.</div><div>Ruby 1.8 中 , proc, lambda 都需要检查参数个数. Proc.new 不检查参数个数.</div><div><span style="line-height: 22px;"  >Ruby 1.9 中 , lambda 需要检查参数个数. Proc.new和proc 不检查参数个数.</span> </div><div>block中调用的本地变量, 取自创建这个块时所在的本地变量, 而不是调用块时的本地变量.</div><div>下面都是Ruby 1.9 中的举例,</div>&nbsp;举例一 :&nbsp;<div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >x = "hello world"</font></div><div><font size="2"  >ablock = lambda{ |y| puts(x) } &nbsp;</font></div><div><font size="2"  ># 如果上面这行改成&nbsp;<span style="line-height: 22px;"  >ablock = lambda{ puts(x) }, 调用ablock都将报错,&nbsp;</span>wrong number of arguments (1 for 0 (ArgumentError)</font></div><div><font size="2"  >def aMethod(ablockArg)</font></div><div><font size="2"  >&nbsp; x = "goodbye"</font></div><div><font size="2"  >&nbsp; ablockArg.call(x)</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >puts(x) #=&gt; "hello world"</font></div><div><font size="2"  >ablock.call(x) #=&gt; "hello world"</font></div><div><font size="2"  >aMethod(ablock) #=&gt; "hello world"</font></div><div><font size="2"  >ablock.call(x) #=&gt; "hello world"</font></div><div><font size="2"  >puts(x) #=&gt; "hello world"</font></div><div><font size="2"  >输出都是 "hello world" 没有一个是goodbye, 原因是 "&nbsp;<span style="line-height: 22px;"  >block中调用的本地变量, 取自创建这个块时所在的本地变量, 而不是调用块时的本地变量.&nbsp;</span>"</font></div><p></p></pre></div><wbr><div><span style="line-height: 22px;"  ><br></span></div><div><span style="line-height: 22px;"  >&nbsp;举例二 :&nbsp;</span><wbr style="line-height: 22px;"  ><br></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >x = "hello world"</font></div><div><font size="2"  >ablock = proc{ puts(x) }</font></div><div><font size="2"  ># proc 在1.9版本中不用检查参数个数, 所以不会报错</font></div><div><font size="2"  >def aMethod(ablockArg)</font></div><div><font size="2"  >&nbsp; x = "goodbye"</font></div><div><font size="2"  >&nbsp; ablockArg.call(x)</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >puts(x) #=&gt; "hello world"</font></div><div><font size="2"  >ablock.call(x) #=&gt; "hello world"</font></div><div><font size="2"  >aMethod(ablock) #=&gt; "hello world"</font></div><div><font size="2"  >ablock.call(x) #=&gt; "hello world"</font></div><div><font size="2"  >puts(x) #=&gt; "hello world"</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 22px;"  >&nbsp;举例三 :&nbsp;</span><wbr style="line-height: 22px;"  ><br></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >x = "hello world"</font></div><div><font size="2"  >ablock = Proc.new{ puts(x) }</font></div><div><font size="2"  >Proc.new创建的块对象在调用是也不用检查传入的参数个数.</font></div><div><font size="2"  >def aMethod(ablockArg)</font></div><div><font size="2"  >&nbsp; x = "goodbye"</font></div><div><font size="2"  >&nbsp; ablockArg.call(x)</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >puts(x) #=&gt; "hello world"</font></div><div><font size="2"  >ablock.call(x) #=&gt; "hello world"</font></div><div><font size="2"  >aMethod(ablock) #=&gt; "hello world"</font></div><div><font size="2"  >ablock.call(x) #=&gt; "hello world"</font></div><div><font size="2"  >puts(x) #=&gt; "hello world"</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 22px;"  >&nbsp;举例四 :&nbsp;</span><wbr style="line-height: 22px;"  ><br></div><div><span style="line-height: 22px;"  >严格来说, 上面的代码应该改成如下 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >x = "hello world"</font></div><div><font size="2"  >ablock = lambda{ || puts(x) } # 表示不需要传入参数</font></div><div><font size="2"  ># 或者 ablock = proc{ || puts(x) }</font></div><div><font size="2"  ># 或者 ablock = Proc.new{ || puts(x) }</font></div><div><font size="2"  >def aMethod(ablockArg)</font></div><div><font size="2"  >&nbsp; x = "goodbye"</font></div><div><font size="2"  >&nbsp; ablockArg.call()</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >puts(x) #=&gt; "hello world"</font></div><div><font size="2"  >ablock.call() #=&gt; "hello world" # 调用时没有传入参数, 所以检查参数个数时是正确的.</font></div><div><font size="2"  >aMethod(ablock) #=&gt; "hello world"</font></div><div><font size="2"  >ablock.call() #=&gt; "hello world"</font></div><div><font size="2"  >puts(x) #=&gt; "hello world"</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 22px;"  ><br></span></div></div></div>
	</div>
</div>
</body>
</html>