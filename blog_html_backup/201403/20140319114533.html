<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL customize inet_aton, inet_ntoa function in text type like MySQL.</h2>
	<h5 id="">2014-03-19 11:45:33&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014219104624856/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL的类型支持比较强大, 除了主流的文本, 日期, 时间, 数字, 还支持JSON, 货币, 网络, 几何, 枚举, 数组, 范围, XML, 布尔, 全文检索, 比特, 复合等数据类型.&nbsp;</div><div>MySQL的类型支持比较薄弱, MySQL里面没有专门的网络数据类型, 如果要存储网络信息, 一般的做法是转换成INT类型来处理.</div><div>PostgreSQL当然没有必要这么做, 因为已经支持inet和cidr类型了, 操作极为方便. 开发人员使用PostgreSQL会比较愉快.</div><div>例如</div><div><table border="1"   style=" border-spacing: 0px; color: rgb(0, 0, 0); font-size: 12px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 2px solid rgb(167, 198, 223); -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-collapse: collapse; background-color: rgb(224, 236, 239);margin: 2ex 0px 2ex 2ex; font-family: verdana, sans-serif; line-height: normal;"   ><tbody><tr><td style=" background-color: rgb(239, 239, 239);border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   ><tt>&gt;&gt;</tt></td><td style=" background-color: rgb(239, 239, 239);border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >contains</td><td style=" background-color: rgb(239, 239, 239);border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   ><tt>inet '192.168.1/24' &gt;&gt; inet '192.168.1.5'</tt></td></tr></table></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select inet '192.168.1/24' &gt;&gt; inet '192.168.2.1'</font></div><div><font size="2"   >digoal-# ;</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;f</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select inet '192.168.1/24' &gt;&gt; inet '192.168.2.1';</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;f</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select inet '192.168.1/24' &gt;&gt; inet '192.168.1.100';</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;t</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select inet '192.168.1.0/24' &gt;&gt; inet '192.168.1.100';</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;t</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select inet '192.168.1.128/25' &gt;&gt; inet '192.168.1.100';</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;f</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select inet '192.168.1.128/25' &gt;&gt; inet '192.168.1.129';</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;t</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>本文模拟在没有INET或者cidr类型的时候的使用方法.</div><div><br></div><div>那么我这里要说的是如果你是从mysql转到pg的, 并且前期不想改代码的话, 那么就需要写一些和MySQL兼容的函数.</div><div>例如MySQL里面的inet_aton , inet_ntoa.</div><div><ul style=" font-size: 15px; border: 0px; vertical-align: baseline;margin: 0px 4px 8px 16px; list-style-position: initial; font-family: Helvetica, Arial, sans-serif; line-height: 25.200000762939453px; outline: 0px;"   ><li style=" font-size: 14px; border: 0px; vertical-align: middle; list-style: disc outside none; background-position: initial initial; background-color: transparent;margin: 0px 0px 5px; line-height: 16.799999237060547px; padding: 0px; outline: 0px; background-repeat: initial initial;"   ><p style=" border: 0px; vertical-align: baseline; background-color: transparent;margin-top: 0px; line-height: 25.200000762939453px; max-width: 720px; outline: 0px;"   >&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(1, 90, 132);" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet-aton"   ><code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >INET_ATON(<em style=" border: 0px; vertical-align: baseline; background-color: transparent;margin: 0px; padding: 0px; outline: 0px;"   ><code style=" color: inherit; border: 0px; vertical-align: baseline; background-color: inherit;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 1px; outline: 0px;"   >expr</code></em>)</code></a></p><p style=" border: 0px; vertical-align: baseline; background-color: transparent;margin-top: 0px; line-height: 25.200000762939453px; max-width: 720px; outline: 0px;"   >Given the dotted-quad representation of an IPv4 network address as a string, returns an integer that represents the numeric value of the address in network byte order (big endian).&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(1, 90, 132);" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet-aton"   ><code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >INET_ATON()</code></a>&nbsp;returns&nbsp;<code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >NULL</code>&nbsp;if it does not understand its argument.</p><pre style=" font-size: 13px; border: 0px; vertical-align: baseline; margin-bottom: 0px; background-color: rgb(238, 238, 238);margin-top: 0px; font-family: 'Courier New', Courier, fixed, monospace; max-width: 720px; line-height: 20px; padding: 2px; outline: 0px;"   >mysql&gt; <strong style=" border: 0px; vertical-align: baseline; background-color: transparent;margin: 0px; padding: 0px; outline: 0px;"   ><code style=" color: inherit; font-size: 12px; border: 0px; vertical-align: baseline; background-color: inherit;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 1px; outline: 0px;"   >SELECT INET_ATON('10.0.5.9');</code></strong>
        -&gt; 167773449
</pre><p style=" border: 0px; vertical-align: baseline; background-color: transparent;margin-top: 0px; line-height: 25.200000762939453px; max-width: 720px; outline: 0px;"   >For this example, the return value is calculated as 10×256<sup style=" border: 0px; font-weight: bold; background-color: transparent;margin: 0px; padding: 0px; outline: 0px;"   >3</sup>&nbsp;+ 0×256<sup style=" border: 0px; font-weight: bold; background-color: transparent;margin: 0px; padding: 0px; outline: 0px;"   >2</sup>&nbsp;+ 5×256 + 9.</p><p style=" border: 0px; vertical-align: baseline; background-color: transparent;margin-top: 0px; line-height: 25.200000762939453px; max-width: 720px; outline: 0px;"   ><a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(1, 90, 132);" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet-aton"   ><code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >INET_ATON()</code></a>&nbsp;may or may not return a non-<code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >NULL</code>&nbsp;result for short-form IP addresses (such as&nbsp;<code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >'127.1'</code>&nbsp;as a representation of&nbsp;<code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >'127.0.0.1'</code>). Because of this,&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(1, 90, 132);" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet-aton"   ><code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >INET_ATON()</code></a>a should not be used for such addresses.</p><div style=" border-left-style: solid; vertical-align: baseline; border-width: 0px 0px 0px 5px; background-color: transparent;margin: 0px 0.5in; border-left-color: black; padding: 0px 0px 0px 5px; outline: 0px;"   ><div style=" font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold; background-color: transparent;margin: 0px; padding: 0px; outline: 0px;"   >Note</div><p style=" border: 0px; vertical-align: baseline; background-color: transparent;margin-top: 0px; line-height: 25.200000762939453px; max-width: 720px; outline: 0px;"   >To store values generated by&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(1, 90, 132);" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet-aton"   ><code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >INET_ATON()</code></a>, use an&nbsp;<code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >INT UNSIGNED</code>&nbsp;column rather than&nbsp;<a title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT" style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(1, 90, 132);" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.7/en/integer-types.html"   ><code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >INT</code></a>, which is signed. If you use a signed column, values corresponding to IP addresses for which the first octet is greater than 127 cannot be stored correctly. See&nbsp;<a title="11.2.6 Out-of-Range and Overflow Handling" style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(1, 90, 132);" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.7/en/out-of-range-and-overflow.html"   >Section&nbsp;11.2.6, “Out-of-Range and Overflow Handling”</a>.</p></div></li><li style=" font-size: 14px; border: 0px; vertical-align: middle; list-style: disc outside none; background-position: initial initial; background-color: transparent;margin: 0px 0px 5px; line-height: 16.799999237060547px; padding: 0px; outline: 0px; background-repeat: initial initial;"   ><a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent;" name="function_inet-ntoa" rel="nofollow"   ></a><p style=" border: 0px; vertical-align: baseline; background-color: transparent;margin-top: 0px; line-height: 25.200000762939453px; max-width: 720px; outline: 0px;"   ><a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent;" name="idm47148858798368" rel="nofollow"   ></a>&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(1, 90, 132);" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet-ntoa"   ><code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >INET_NTOA(<em style=" border: 0px; vertical-align: baseline; background-color: transparent;margin: 0px; padding: 0px; outline: 0px;"   ><code style=" color: inherit; border: 0px; vertical-align: baseline; background-color: inherit;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 1px; outline: 0px;"   >expr</code></em>)</code></a></p><p style=" border: 0px; vertical-align: baseline; background-color: transparent;margin-top: 0px; line-height: 25.200000762939453px; max-width: 720px; outline: 0px;"   >Given a numeric IPv4 network address in network byte order, returns the dotted-quad string representation of the address as a nonbinary string in the connection character set.&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(1, 90, 132);" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet-ntoa"   ><code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >INET_NTOA()</code></a>&nbsp;returns&nbsp;<code style=" color: rgb(2, 103, 137); font-size: 13px; border: 0px; vertical-align: baseline; font-weight: bold;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 0px; outline: 0px;"   >NULL</code>&nbsp;if it does not understand its argument.</p><pre style=" font-size: 13px; border: 0px; vertical-align: baseline; margin-bottom: 0px; background-color: rgb(238, 238, 238);margin-top: 0px; font-family: 'Courier New', Courier, fixed, monospace; max-width: 720px; line-height: 20px; padding: 2px; outline: 0px;"   >mysql&gt; <strong style=" border: 0px; vertical-align: baseline; background-color: transparent;margin: 0px; padding: 0px; outline: 0px;"   ><code style=" color: inherit; font-size: 12px; border: 0px; vertical-align: baseline; background-color: inherit;margin: 0px; font-family: 'Courier New', Courier, fixed, monospace; padding: 1px; outline: 0px;"   >SELECT INET_NTOA(167773449);</code></strong>
        -&gt; '10.0.5.9'</pre></li></ul></div><div>在PostgreSQL可以通过如下自定义函数来实现 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create or replace function inet_aton(ip text) returns int8 as $$</font></div><div><font size="2"   >declare</font></div><div><font size="2"   >&nbsp; v int;</font></div><div><font size="2"   >&nbsp; res int8 := 0;</font></div><div><font size="2"   >&nbsp; i int := 3;</font></div><div><font size="2"   >begin</font></div><div><font size="2"   >&nbsp; foreach v in array string_to_array(ip, '.') loop</font></div><div><font size="2"   >&nbsp; &nbsp; res := res+v*(256^i);</font></div><div><font size="2"   >&nbsp; &nbsp; i := i-1;</font></div><div><font size="2"   >&nbsp; end loop;</font></div><div><font size="2"   >&nbsp; return res;</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >$$ language plpgsql;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >create or replace function inet_ntoa(ip int8) returns text as $$</font></div><div><font size="2"   >declare</font></div><div><font size="2"   >&nbsp; res text := '';</font></div><div><font size="2"   >begin</font></div><div><font size="2"   >&nbsp; res := res || ((ip &gt;&gt; 24) &amp; (2^8-1)::int);</font></div><div><font size="2"   >&nbsp; res := res || '.' || ((ip &gt;&gt; 16) &amp; (2^8-1)::int);</font></div><div><font size="2"   >&nbsp; res := res || '.' || ((ip &gt;&gt; 8) &amp; (2^8-1)::int);</font></div><div><font size="2"   >&nbsp; res := res || '.' || (ip &amp; (2^8-1)::int);</font></div><div><font size="2"   >&nbsp; return res;</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >$$ language plpgsql;</font></div><p></p></pre></div><div><br></div><div>测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select inet_aton('192.168.9.100');</font></div><div><font size="2"   >&nbsp;inet_aton &nbsp;</font></div><div><font size="2"   >------------</font></div><div><font size="2"   >&nbsp;3232237924</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select inet_ntoa(3232237924);</font></div><div><font size="2"   >&nbsp; &nbsp;inet_ntoa &nbsp;&nbsp;</font></div><div><font size="2"   >---------------</font></div><div><font size="2"   >&nbsp;192.168.9.100</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div><br></div><div>在MySQL中假如存储了IP和子网掩码的值, 我们可以通过如下方法来判断IP是否在这个子网中.</div><div>1. 从IP和子网掩码运算得到net和broadcast, 然后转换成INT8.</div><div>2. 把要匹配的IP转换成INT8, 与第一步得到的值进行比较</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >192.168.9.0/24</font></div><div><font size="2"   >192.168.9.128/25</font></div><div><span style="line-height: 28px;"   ><font size="2"   >192.168.9.0/25</font></span></div><div><font size="2"   >192.168.0.0/16</font></div><p></p></pre></div><div>转换成net和broadcast</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >192.168.9.0,&nbsp;<span style="line-height: 28px;"   >192.168.9.255</span></font></div><div style="line-height: 28px;"   ><font size="2"   >192.168.9.128,&nbsp;<span style="line-height: 28px;"   >192.168.9.255</span></font></div><div style="line-height: 28px;"   ><font size="2"   ><span style="line-height: 28px;"   >192.168.9.0,&nbsp;</span><span style="line-height: 28px;"   >192.168.9.127</span></font></div><div style="line-height: 28px;"   ><font size="2"   >192.168.0.0,&nbsp;<span style="line-height: 28px;"   >192.168.255.255</span></font></div><p></p></pre></div></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >net的转换方法如下 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select substring('192.168.9.0/24','(.*)/\d*');</font></div><div><font size="2"   >&nbsp; substring &nbsp;</font></div><div><font size="2"   >-------------</font></div><div><font size="2"   >&nbsp;192.168.9.0</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >broadcast的转换方法如下 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select inet_ntoa((inet_aton(substring('192.168.9.0/24','(.*)/\d*')) + 2^(32-substring('192.168.9.0/24','.*/(\d*)')::int) -1)::int8);</font></div><div><font size="2"   >&nbsp; &nbsp;inet_ntoa &nbsp;&nbsp;</font></div><div><font size="2"   >---------------</font></div><div><font size="2"   >&nbsp;192.168.9.255</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>转换成数字就可以做比较了.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# create table t1 (ip text, inet text);</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=# insert into t1 values ('192.168.1.1','192.168.1.128/25');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# insert into t1 values ('192.168.1.10','192.168.1.0/25');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# insert into t1 values ('192.168.1.129','192.168.1.128/25');</font></div><div><font size="2"   >INSERT 0 1</font></div></div><div><div><font size="2"   >digoal=# select inet, substring(inet,'(.*)/\d*') as net, inet_ntoa((inet_aton(substring(inet,'(.*)/\d*')) + 2^(32-substring(inet,'.*/(\d*)')::int) -1)::int8) as broadcast from t1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;inet &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;net &nbsp; &nbsp; &nbsp;| &nbsp; broadcast &nbsp;&nbsp;</font></div><div><font size="2"   >------------------+---------------+---------------</font></div><div><font size="2"   >&nbsp;192.168.1.128/25 | 192.168.1.128 | 192.168.1.255</font></div><div><font size="2"   >&nbsp;192.168.1.0/25 &nbsp; | 192.168.1.0 &nbsp; | 192.168.1.127</font></div><div><font size="2"   >&nbsp;192.168.1.128/25 | 192.168.1.128 | 192.168.1.255</font></div><div><font size="2"   >(3 rows)</font></div></div><p></p></pre></div><div>查看IP是否落在IPNET范围内.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select * from (select ip, inet, substring(inet,'(.*)/\d*') as net, inet_ntoa((inet_aton(substring(inet,'(.*)/\d*')) + 2^(32-substring(inet,'.*/(\d*)')::int) -1)::int8) as broadcast from t1) t where inet_aton(ip) &gt; inet_aton(net) and inet_aton(ip) &lt; inet_aton(broadcast);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; ip &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; inet &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;net &nbsp; &nbsp; &nbsp;| &nbsp; broadcast &nbsp;&nbsp;</font></div><div><font size="2"   >---------------+------------------+---------------+---------------</font></div><div><font size="2"   >&nbsp;192.168.1.10 &nbsp;| 192.168.1.0/25 &nbsp; | 192.168.1.0 &nbsp; | 192.168.1.127</font></div><div><font size="2"   >&nbsp;192.168.1.129 | 192.168.1.128/25 | 192.168.1.128 | 192.168.1.255</font></div><div><font size="2"   >(2 rows)</font></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://dev.mysql.com/doc/refman/5.5/en/miscellaneous-functions.html#function_inet-aton"   >http://dev.mysql.com/doc/refman/5.5/en/miscellaneous-functions.html#function_inet-aton</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://doxygen.postgresql.org/inet__aton_8c_source.html#l00054"   >http://doxygen.postgresql.org/inet__aton_8c_source.html#l00054</a></div>3.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/datatype-net-types.html"   >http://www.postgresql.org/docs/9.3/static/datatype-net-types.html</a><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/functions-net.html"   >http://www.postgresql.org/docs/9.3/static/functions-net.html</a></div>5.&nbsp;<a target="_blank" rel="nofollow" href="http://doxygen.postgresql.org/inet__aton_8c_source.html#l00054"   >http://doxygen.postgresql.org/inet__aton_8c_source.html#l00054</a></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">liwb - 2014-03-20 15:04:37</h5>
				<div>支持了inet cidr类型就是方便，提供了轮子</div>
			</div>
	</div>
</div>
</body>
</html>