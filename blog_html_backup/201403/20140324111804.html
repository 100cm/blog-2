<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL chinese full text search 中文全文检索</h2>
	<h5 id="">2014-03-24 11:18:04&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201422410175698/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>首先要感谢amutu以及其他为中文检索贡献的兄弟们, 我在之前写过一些关于PG中文全文检索的文章, 比较繁琐.</div><div><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201252141010693/"   >http://blog.163.com/digoal@126/blog/static/163877040201252141010693/</a></div><div>使用amutu的zhparser就比较方便了, 分词的部署比以前简单很多. 具体可参看amutu 的BLOG,&nbsp;</div><div><a target="_blank" rel="nofollow" href="http://amutu.com/blog/zhparser/"   >http://amutu.com/blog/zhparser/</a></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >zhparser</font></div><div><font size="2"   >zhparser是什么</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >zhparser是一个PostgreSQL中文分词的插件，通过它，可以使PostgreSQL支持中文的全文检索（Full Text Search）。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >为什么需要zhparser</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >一般英语等语言分词比较简单，按照标点、空格切分语句即可获得有含义的词语，PostgreSQL自带的parser就是按照这个原理来分词的，比较简单。而中文就比较复杂，词语之间没有空格分割，长度也不固定，怎么分词有时还跟语句的语义有关，因此PG自带的parser不能用来做中文分词。使用zhparser这个插件，便可以使PG支持中文分词，继而可以使用PG做中文全文检索。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >zhparser原理是什么</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >zhparser用C语言实现了PostgreSQL TEXT SEARCH PARSER需要的接口，这些接口会调用SCWS中文分词引擎进行分词。</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >我这里在CentOS 6.x x64和PostgreSQL 9.3.3上面测试了一下, 非常好用.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 28px;"   >#</span><span style="line-height: 28px;"   >&nbsp;</span>wget http://www.xunsearch.com/scws/down/scws-1.2.2.tar.bz2</font></div><div><font size="2"   ><span style="line-height: 28px;"   >#</span><span style="line-height: 28px;"   >&nbsp;</span>tar -jxvf scws-1.2.2.tar.bz2</font></div><div><font size="2"   ><span style="line-height: 28px;"   >#</span><span style="line-height: 28px;"   >&nbsp;</span>cd scws-1.2.2</font></div><div><font size="2"   ><span style="line-height: 28px;"   >#</span><span style="line-height: 28px;"   >&nbsp;</span>./configure --prefix=/opt/scws-1.2.2</font></div><div><font size="2"   ><span style="line-height: 28px;"   >#</span><span style="line-height: 28px;"   >&nbsp;</span>make</font></div><div><font size="2"   ><span style="line-height: 28px;"   >#</span><span style="line-height: 28px;"   >&nbsp;</span>make install</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><span style="line-height: 28px;"   >#</span><span style="line-height: 28px;"   >&nbsp;</span>git clone https://github.com/amutu/zhparser.git</font></div><div><font size="2"   ><span style="line-height: 28px;"   >#</span><span style="line-height: 28px;"   >&nbsp;</span>cd zhparser/</font></div><div><div><font size="2"   >[root@db-172-16-3-150 zhparser]# export PATH=/home/pg93/pgsql/bin:$PATH</font></div><div><font size="2"   >[root@db-172-16-3-150 zhparser]# which pg_config</font></div><div><font size="2"   >/home/pg93/pgsql/bin/pg_config</font></div></div><div><font size="2"   ># SCWS_HOME=/opt/scws-1.2.2 make</font></div><div><font size="2"   ># make install</font></div><div><div><font size="2"   >[root@db-172-16-3-150 zhparser]# su - pg93</font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# create extension zhparser;</font></div><div><font size="2"   >CREATE EXTENSION</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=# select * from pg_ts_parser ;</font></div><div><font size="2"   >&nbsp;prsname &nbsp;| prsnamespace | &nbsp;prsstart &nbsp; | &nbsp; &nbsp;prstoken &nbsp; &nbsp; | &nbsp;prsend &nbsp; | &nbsp;prsheadline &nbsp;| &nbsp;prslextype &nbsp;&nbsp;</font></div><div><font size="2"   >----------+--------------+-------------+-----------------+-----------+---------------+---------------</font></div><div><font size="2"   >&nbsp;default &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 11 | prsd_start &nbsp;| prsd_nexttoken &nbsp;| prsd_end &nbsp;| prsd_headline | prsd_lextype</font></div><div><font size="2"   >&nbsp;zhparser | &nbsp; &nbsp; &nbsp; &nbsp;25956 | zhprs_start | zhprs_getlexeme | zhprs_end | prsd_headline | zhprs_lextype</font></div><div><font size="2"   >(2 rows)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=# CREATE TEXT SEARCH CONFIGURATION testzhcfg (PARSER = zhparser);</font></div><div><font size="2"   >CREATE TEXT SEARCH CONFIGURATION</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=# &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; select * from pg_ts_config where cfgname='testzhcfg';</font></div><div><font size="2"   >&nbsp; cfgname &nbsp;| cfgnamespace | cfgowner | cfgparser&nbsp;</font></div><div><font size="2"   >-----------+--------------+----------+-----------</font></div><div><font size="2"   >&nbsp;testzhcfg | &nbsp; &nbsp; &nbsp; &nbsp;25956 | &nbsp; &nbsp; &nbsp; 10 | &nbsp; &nbsp; 26134</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >配置token type, 参考</font><a style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, &#23435;&#20307;;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/textsearch-parsers.html"   >http://www.postgresql.org/docs/9.3/static/textsearch-parsers.html</a></div><div><div><font size="2"   >digoal=# ALTER TEXT SEARCH CONFIGURATION testzhcfg ADD MAPPING FOR n,v,a,i,e,l WITH simple;</font></div><div><font size="2"   >ALTER TEXT SEARCH CONFIGURATION</font></div><div><font size="2"   >digoal=# &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; select * from pg_ts_config_map where mapcfg=(select oid from pg_ts_config where cfgname='testzhcfg');</font></div><div><font size="2"   >&nbsp;mapcfg | maptokentype | mapseqno | mapdict&nbsp;</font></div><div><font size="2"   >--------+--------------+----------+---------</font></div><div><font size="2"   >&nbsp; 26135 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 97 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp;3765</font></div><div><font size="2"   >&nbsp; 26135 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;101 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp;3765</font></div><div><font size="2"   >&nbsp; 26135 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;105 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp;3765</font></div><div><font size="2"   >&nbsp; 26135 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;108 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp;3765</font></div><div><font size="2"   >&nbsp; 26135 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;110 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp;3765</font></div><div><font size="2"   >&nbsp; 26135 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;118 | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp;3765</font></div><div><font size="2"   >(6 rows)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >SELECT * FROM ts_parse('zhparser', 'hello world! 2010年保障房建设在全国范围内获全面启动，从中央到地方纷纷加大 了 保 障 房 的 建 设&nbsp;</font></div><div><font size="2"   >和 投 入 力 度 。2011年，保障房进入了更大规模的建设阶段。住房城乡建设部党组书记、部长姜伟新去年底在全国住房城乡建设工作会议上表示，</font></div><div><font size="2"   >要继续推进保障性安居工程建设。');</font></div><div><font size="2"   >&nbsp;tokid | &nbsp;token &nbsp;&nbsp;</font></div><div><font size="2"   >-------+----------</font></div><div><font size="2"   >&nbsp; &nbsp;101 | hello</font></div><div><font size="2"   >&nbsp; &nbsp;101 | world</font></div><div><font size="2"   >&nbsp; &nbsp;117 | !</font></div><div><font size="2"   >&nbsp; &nbsp;101 | 2010</font></div><div><font size="2"   >&nbsp; &nbsp;113 | 年</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 保障</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 房建</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 设在</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 全国</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 范围</font></div><div><font size="2"   >&nbsp; &nbsp;102 | 内</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 获</font></div><div><font size="2"   >&nbsp; &nbsp; 97 | 全面</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 启动</font></div><div><font size="2"   >&nbsp; &nbsp;117 | ，</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 从中</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 央</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 到</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 地方</font></div><div><font size="2"   >&nbsp; &nbsp;100 | 纷纷</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 加大</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 了</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 保</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 障</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 房</font></div><div><font size="2"   >&nbsp; &nbsp;117 | 的</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 建</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 设</font></div><div><font size="2"   >&nbsp; &nbsp; 99 | 和</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 投</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 入</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 力</font></div><div><font size="2"   >&nbsp; &nbsp;107 | 度</font></div><div><font size="2"   >&nbsp; &nbsp;117 | 。</font></div><div><font size="2"   >&nbsp; &nbsp;101 | 2011</font></div><div><font size="2"   >&nbsp; &nbsp;113 | 年</font></div><div><font size="2"   >&nbsp; &nbsp;117 | ，</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 保障</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 房</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 进入</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 了</font></div><div><font size="2"   >&nbsp; &nbsp;100 | 更</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 大规模</font></div><div><font size="2"   >&nbsp; &nbsp;117 | 的</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 建设</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 阶段</font></div><div><font size="2"   >&nbsp; &nbsp;117 | 。</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 住房</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 城乡建设</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 部党组</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 书记</font></div><div><font size="2"   >&nbsp; &nbsp;117 | 、</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 部长</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 姜伟新</font></div><div><font size="2"   >&nbsp; &nbsp;116 | 去年底</font></div><div><font size="2"   >&nbsp; &nbsp;112 | 在</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 全国</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 住房</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 城乡建设</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 工作</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 会议</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 上表</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 示</font></div><div><font size="2"   >&nbsp; &nbsp;117 | ，</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 要</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 继续</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 推进</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 保障性</font></div><div><font size="2"   >&nbsp; &nbsp;118 | 安居</font></div><div><font size="2"   >&nbsp; &nbsp;110 | 工程建设</font></div><div><font size="2"   >&nbsp; &nbsp;117 | 。</font></div><div><font size="2"   >(71 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SELECT to_tsvector('testzhcfg','“今年保障房新开工数量虽然有所下调，但实际的年度在建规模以及竣工规模会超以往年份，相对应的对资金的需</font></div><div><font size="2"   >求也会创历史纪录。”陈国强说。在他看来，与2011年相比，2012年的保障房建设在资金配套上的压力将更为严峻。');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; to_tsvector &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;'2011':27 '2012':29 '上':35 '下调':7 '严峻':37 '会':14 '会创':20 '保障':1,30 '历史':21 '压力':36 '国强':24 '在建':10 '实际':8 '对应':17 '年份':16 '年度':9 '开工':4 '房':2 '房建':31 '数量':5 '新':3 '有所':6 '相比':28 '看来':26 '竣工':12 '纪录':22 '规模':11,13 '设</font></div><div><font size="2"   >在':32 '说':25 '资金':18,33 '超':15 '配套':34 '陈':23 '需求':19</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SELECT to_tsquery('testzhcfg', '保障房资金压力');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to_tsquery &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >---------------------------------</font></div><div><font size="2"   >&nbsp;'保障' &amp; '房' &amp; '资金' &amp; '压力'</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://pgxn.org/dist/zhparser/"   >http://pgxn.org/dist/zhparser/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/hightman/scws"   >https://github.com/hightman/scws</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://amutu.com/blog/zhparser/"   >http://amutu.com/blog/zhparser/</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.xunsearch.com/scws/"   >http://www.xunsearch.com/scws/</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201252141010693/"   >http://blog.163.com/digoal@126/blog/static/163877040201252141010693/</a></div><div>6. http://<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.tudou.com/programs/view/X2U9f0s04h0"   >www.tudou.com/programs/view/X2U9f0s04h0</a></div><div>7.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/catalog-pg-ts-config-map.html"   >http://www.postgresql.org/docs/9.3/static/catalog-pg-ts-config-map.html</a></div><div>8.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/sql-altertsconfig.html"   >http://www.postgresql.org/docs/9.3/static/sql-altertsconfig.html</a></div><div>9.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/textsearch-parsers.html"   >http://www.postgresql.org/docs/9.3/static/textsearch-parsers.html</a></div></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">heibao326 - 2015-05-29 8:59:55</h5>
				<div>德哥 &nbsp;请教下 &nbsp;如何使用pgpool实现读写分离？有这方面的文件参开吗？嘿嘿</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-05-29 8:59:55</h5>
				<div style="width:600px;">搜索digoal postgresql pgpool-II</div>
			</div>
			<div id="">
				<h5 id="">heibao326 - 2015-05-19 15:15:28</h5>
				<div>德哥 &nbsp;请教下 &nbsp;我的default_text_search_config已经修改成'testzhcfg'<div>select to_tsvector('你好，我是中国人');--&gt;结果是"'中国人':3 '你好':1 '是':2"</div><div>但为何我insert into tbl_ts values ('我是中国人');,然后再select出来的却是"'你好，我是中国人'"，而不是分词形式？</div><div>如果insert into tbl_ts values ('hello i am heibao');然后select出来的是"'am' 'heibao' 'hello' 'i'"，这是为什么啊<img src="http://b.bst.126.net/common/portrait/face/preview/face2.gif"  ></div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-05-19 15:15:28</h5>
				<div style="width:600px;"><div><span style=""  >default_text_search_config这个参数只影响to_tsany函数(</span><span style=""  >src/backend/tsearch/to_tsany.c</span><span style=""  >)，而</span>你这种insert写法调用的是tsvectorin(自动转换)，在这个函数里面字符串转换为tsvector调用init_tsvector_parser，默认是空格分开的。</div><div>/*</div><div>&nbsp;* Initializes parser for the input string. If oprisdelim is set, the</div><div>&nbsp;* following characters are treated as delimiters in addition to whitespace:</div><div>&nbsp;* ! | &amp; ( )</div><div>&nbsp;*/</div><div>TSVectorParseState</div><div>init_tsvector_parser(char *input, bool oprisdelim, bool is_tsquery)</div><div>{</div><div>&nbsp; &nbsp; &nbsp; &nbsp; TSVectorParseState state;</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp; state = (TSVectorParseState) palloc(sizeof(struct TSVectorParseStateData));</div><div>&nbsp; &nbsp; &nbsp; &nbsp; state-&gt;prsbuf = input;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; state-&gt;bufstart = input;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; state-&gt;len = 32;</div><div>&nbsp; &nbsp;</div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-05-19 15:15:28</h5>
				<div style="width:600px;"><span style=""  >default_text_search_config</span>这个参数只影响<span style=""  >to_tsany，你可以去看一下代码。</span><div><span style=""  >insert into tbl_ts values ('hello i am heibao');这种写法，默认就是以空格为分隔符切分word的。不受</span><span style=""  >default_text_search_config影响</span></div></div>
			</div>
			<div id="">
				<h5 id="">heibao326 - 2015-05-12 15:56:58</h5>
				<div>德哥请教下，我使用的pg版本是9.3的，现在想要定义dblink函数，我看网上有的说是要在$PGHOME/share/contrib/dblink.sql，但是我在$PGHOME/share下找不到contrib目录，只有extension目录，是不是只要在数据库中执行"create extension dblink"也可以达到和"psql -d mydb -f dblink.sql"效果？<img src="http://b.bst.126.net/common/portrait/face/preview/face1.gif"  ></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-05-12 15:56:58</h5>
				<div style="width:600px;">是的</div>
			</div>
			<div id="">
				<h5 id="">heibao326 - 2015-04-27 14:32:43</h5>
				<div>德哥 请教下 sever.log如下<div><div>LOG: &nbsp;server process (PID 3417) was terminated by signal 11: Segmentation fault</div><div>DETAIL: &nbsp;Failed process was running: SELECT</div><div><span class="Apple-tab-span"  style=""  >	</span> &nbsp;(SELECT t.alias FROM pg_catalog.ts_token_type(cfgparser) AS t &nbsp; &nbsp;WHERE t.tokid = maptokentype) AS tokenalias,dictname &nbsp;FROM pg_ts_config_map</div><div><span class="Apple-tab-span"  style=""  >	</span> &nbsp;LEFT OUTER JOIN pg_ts_config ON mapcfg=pg_ts_config.oid</div><div><span class="Apple-tab-span"  style=""  >	</span> &nbsp;LEFT OUTER JOIN pg_ts_dict ON mapdict=pg_ts_dict.oid</div><div><span class="Apple-tab-span"  style=""  >	</span>WHERE mapcfg=24637::oid</div><div><span class="Apple-tab-span"  style=""  >	</span>ORDER BY 1, mapseqno</div><div>LOG: &nbsp;terminating any other active server processes</div><div>WARNING: &nbsp;terminating connection because of crash of another server process</div><div>DETAIL: &nbsp;The postmaster has commanded</div></div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">heibao326 回复 heibao326 - 2015-04-27 14:32:43</h5>
				<div style="width:600px;"><div>LOG: &nbsp;all server processes terminated; reinitializing</div><div>LOG: &nbsp;database system was interrupted; last known up at 2015-04-27 14:22:03 CST</div><div>LOG: &nbsp;database system was not properly shut down; automatic recovery in progress</div><div>LOG: &nbsp;record with zero length at 0/1FDE698</div><div>LOG: &nbsp;redo is not required &nbsp;</div><div>LOG: &nbsp;autovacuum launcher started &nbsp;LOG: &nbsp;database system is ready to accept connections</div><div>请德哥指点一二....</div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-04-27 14:32:43</h5>
				<div style="width:600px;">段错误原因很多,这个可能需要跟踪调试一下.</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-04-27 14:32:43</h5>
				<div style="width:600px;">关闭数据库时未完成检查点，重启需要恢复。</div>
			</div>
			<div id="">
				<h5 id="">heibao326 - 2015-04-27 13:54:11</h5>
				<div>德哥 请教下 在postgresql.conf 中的shared_buffers 和checkpoint_segments的大小设置一般依据什么标准而设定呢？pg是否可以像oracle那样 支持自动管理内存呢？先感谢德哥</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-04-27 13:54:11</h5>
				<div style="width:600px;">因为目前PG不支持对数据文件实施directio,所以有双重缓存,shared_buffer不建议超过系统内存的20%。<div>checkpoint_segments建议等于shared_buffers除以每个xlog文件的大小。</div></div>
			</div>
			<div id="">
				<h5 id="">heibao326 - 2015-04-24 13:06:01</h5>
				<div><span style=""  >德哥 请教下 pg函数有三态 &nbsp;有没有哪个系统表存放了关于函数状态的信息，实际情形中我们哪种状态用的最多呢？</span></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-04-24 13:06:01</h5>
				<div style="width:600px;">pg_proc, 按规则来。没有哪种最多的说法。</div>
			</div>
			<div id="">
				<h5 id="">heibao326 - 2015-04-24 8:39:36</h5>
				<div>德哥 请教下 &nbsp;pg的时间类型中timestamp是精确到微秒级别的，比如我select now();这样出来的时间都是到微秒的，其实我只是想精确到秒就行了，是有什么办法吗实现吗？</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-04-24 8:39:36</h5>
				<div style="width:600px;">now()::timestamp(0)</div>
			</div>
			<div id="">
				<h5 id="">heibao326 - 2015-04-17 15:39:21</h5>
				<div>德哥 &nbsp;请教下 &nbsp;如果使用连接池的话，只有数据库有一个程序使用到了绑定变量(如function),那就必须启用pgbouncer的会话模式吗？还有其他的解决方案吗？感觉几乎没有数据库程序是不使用绑定变量的哎。。</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-04-17 15:39:21</h5>
				<div style="width:600px;">是的,如果你要在事务模式使用绑定变量,那么必须确保取server process时必须取到上一个用过的server process.也就是说需要修改pgbouncer源码server process复用的部分.</div>
			</div>
			<div id="">
				<h5 id="">wupalm - 2014-09-12 17:12:43</h5>
				<div>pg自己的索引和sphinx或者其他全文索引那个更有效率。感谢德哥。</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 wupalm - 2014-09-12 17:12:43</h5>
				<div style="width:600px;">HI, sphinx不适合做大数据量和大量更新的数据的索引, 建索引的效率比较差.<div>重量级的可以考虑一下其他引擎.</div><div>pg的full text search适合轻量级的应用场景.</div></div>
			</div>
	</div>
</div>
</body>
</html>