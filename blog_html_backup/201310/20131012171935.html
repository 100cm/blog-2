<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Systemtap(1.8) BUG? : delete from statistics(aggregates) type stored in array elements</h2>
	<h5 id="">2013-10-12 17:19:35&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201391234023230/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>在使用systemtap分析数据库单条查询产生系统调用读和写信息时, 发现systemtap统计类型存在的一个BUG.</div><div>只要统计类型存储在数组的元素中, 就会触发这个BUG, 直接使用全局变量则不会发生这个BUG.</div><div>BUG的表现如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >var[1] &lt;&lt;&lt; 123</font></div><div><font size="2"   >delete var[1]</font></div><p></p></pre></div><div>表现为var[1]其中存储的统计流数据未被清除.</div><div>stap 版本</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# stap -V</font></div><div><font size="2"   >Systemtap translator/driver (version 1.8/0.152 non-git sources)</font></div><div><font size="2"   >Copyright (C) 2005-2012 Red Hat, Inc. and others</font></div><div><font size="2"   >This is free software; see the source for copying conditions.</font></div><div><font size="2"   >enabled features: AVAHI LIBRPM LIBSQLITE3 NSS BOOST_SHARED_PTR TR1_UNORDERED_MAP NLS</font></div><p></p></pre></div><div>经过测试发现2.4的版本已经修复了这个BUG, 请参考下一篇blog</div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201391391613269/"   >http://blog.163.com/digoal@126/blog/static/163877040201391391613269/</a></div><div><br></div><div>stap 1.8 触发BUG的测试如下 :&nbsp;</div><div>stap脚本 :&nbsp;</div><div><span style="line-height: 28px;"   >[root@db-172-16-3-39 ~]# vi test.stp</span></div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >global var1[50000], var2[50000], var3[50000]<br><br>probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("query__start") {<br>  pid=pid()<br>  delete var1[pid]<br>  delete var2[pid]<br>  delete var3[pid]<br>  var3[pid] = user_string($arg1)<br>  printf("pid:%u, query start: %s, read: %u,%u, write: %u,%u\n", pid, var3[pid], @sum(var1[pid]), @count(var1[pid]), @sum(var2[pid]), @count(var2[pid]))<br>}<br><br>probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("query__done") {<br>  pid=pid()<br>  printf("pid:%u, query done: %s, read: %u,%u, write: %u,%u\n", pid, var3[pid], @sum(var1[pid]), @count(var1[pid]), @sum(var2[pid]), @count(var2[pid]))<br>  delete var1[pid]<br>  delete var2[pid]<br>  delete var3[pid]<br>}<br><br>probe syscall.read.return {<br>  if (execname()=="postgres") {<br>    pid=pid()<br>    var1[pid] &lt;&lt;&lt; $count<br>  }<br>}<br><br>probe syscall.write.return {<br>  if (execname()=="postgres") {<br>    pid=pid()<br>    var2[pid] &lt;&lt;&lt; $count<br>  }<br>}<br><br>probe end {<br>  delete var1<br>  delete var2<br>  delete var3<br>}</span></font></div><p></p></pre></div><div>执行stap :&nbsp;</div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >[root@db-172-16-3-39 ~]# stap -D MAXSKIPPED=1 ./test.stp&nbsp;</font></span></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >在数据库中进行如下操作 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >digoal=# drop table t;<br>DROP TABLE<br>digoal=# create table t(id int, info text, crt_time timestamp);<br>CREATE TABLE<br>digoal=# insert into t select generate_series(1,1000000),md5(random()::text),now();<br>INSERT 0 1000000<br>digoal=# select count(*) from t;<br>  count  <br>---------<br> 1000000<br>(1 row)<br><br>digoal=# select count(*) from t;<br>  count  <br>---------<br> 1000000<br>(1 row)<br><br>digoal=# create index idx_t_1 on t(id);<br>CREATE INDEX<br>digoal=# select count(*) from t;<br>  count  <br>---------<br> 1000000<br>(1 row)<br><br>digoal=# select count(*) from t;<br>  count  <br>---------<br> 1000000<br>(1 row)<br><br>digoal=# select count(*) from t;<br>  count  <br>---------<br> 1000000<br>(1 row)<br><br>digoal=# checkpoint;<br>CHECKPOINT<br>digoal=# checkpoint;<br>CHECKPOINT</span></font></div><p></p></pre></div><div>stap的输出如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >pid:8981, query start: drop table t;, read: 0,0, write: 0,0<br>pid:8981, query done: drop table t;, read: 0,0, write: 65751,2<br>pid:8981, query start: create table t(id int, info text, crt_time timestamp);, read: 0,0, write: 65751,2<br>pid:8981, query done: create table t(id int, info text, crt_time timestamp);, read: 0,0, write: 82391,5<br>pid:8981, query start: insert into t select generate_series(1,1000000),md5(random()::text),now();, read: 0,0, write: 65751,2<br>pid:8981, query done: insert into t select generate_series(1,1000000),md5(random()::text),now();, read: 32768,4, write: 76669143,9353<br>pid:8981, query start: select count(*) from t;, read: 16384,2, write: 2129920,260<br>pid:8981, query done: select count(*) from t;, read: 16384,2, write: 2129920,260<br>pid:8981, query start: select count(*) from t;, read: 16384,2, write: 2129920,260<br>pid:8981, query done: select count(*) from t;, read: 16384,2, write: 2129920,260<br>pid:8981, query start: create index idx_t_1 on t(id);, read: 16384,2, write: 2129920,260<br>pid:8981, query done: create index idx_t_1 on t(id);, read: 16384,2, write: 24715496,3018<br>pid:8981, query start: select count(*) from t;, read: 16384,2, write: 2129920,260<br>pid:8981, query done: select count(*) from t;, read: 24576,3, write: 2129920,260<br>pid:8981, query start: select count(*) from t;, read: 16384,2, write: 2129920,260<br>pid:8981, query done: select count(*) from t;, read: 16384,2, write: 2129920,260<br>pid:8981, query start: select count(*) from t;, read: 16384,2, write: 2129920,260<br>pid:8981, query done: select count(*) from t;, read: 16384,2, write: 2129920,260<br>pid:8981, query start: checkpoint;, read: 16384,2, write: 2129920,260<br>pid:8981, query done: checkpoint;, read: 16384,2, write: 2129920,260<br>pid:8981, query start: checkpoint;, read: 16384,2, write: 2129920,260<br>pid:8981, query done: checkpoint;, read: 16384,2, write: 2129920,260</span></font></div><p></p></pre></div></div><div>显然, 后面的一些输出中read和write的统计信息都没有被清除.&nbsp;</div><div>如果直接使用全局变量的话, 就不会发生这样的问题.</div><div>修改后的stap脚本如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >global var1, var2, var3[50000]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("query__start") {</font></div><div><font size="2"   >&nbsp; pid=pid()</font></div><div><font size="2"   >&nbsp; delete var1</font></div><div><font size="2"   >&nbsp; delete var2</font></div><div><font size="2"   >&nbsp; delete var3[pid]</font></div><div><font size="2"   >&nbsp; var3[pid] = user_string($arg1)</font></div><div><font size="2"   >&nbsp; printf("pid:%u, query start: %s, read: %u,%u, write: %u,%u\n", pid, var3[pid], @sum(var1), @count(var1), @sum(var2), @count(var2))</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("query__done") {</font></div><div><font size="2"   >&nbsp; pid=pid()</font></div><div><font size="2"   >&nbsp; printf("pid:%u, query done: %s, read: %u,%u, write: %u,%u\n", pid, var3[pid], @sum(var1), @count(var1), @sum(var2), @count(var2))</font></div><div><font size="2"   >&nbsp; delete var1</font></div><div><font size="2"   >&nbsp; delete var2</font></div><div><font size="2"   >&nbsp; delete var3[pid]</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe syscall.read.return {</font></div><div><font size="2"   >&nbsp; pid=pid()</font></div><div><font size="2"   >&nbsp; if (pid==$1) {</font></div><div><font size="2"   >&nbsp; &nbsp; var1 &lt;&lt;&lt; $count</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe syscall.write.return {</font></div><div><font size="2"   >&nbsp; pid=pid()</font></div><div><font size="2"   >&nbsp; if (pid==$1) {</font></div><div><font size="2"   >&nbsp; &nbsp; var2 &lt;&lt;&lt; $count</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >probe end {</font></div><div><font size="2"   >&nbsp; delete var1</font></div><div><font size="2"   >&nbsp; delete var2</font></div><div><font size="2"   >&nbsp; delete var3</font></div><div><font size="2"   >}</font></div><p></p></pre></div><div><br></div><div>查询数据库当前连接的pid :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select pg_backend_pid();</font></div><div><font size="2"   >&nbsp;pg_backend_pid&nbsp;</font></div><div><font size="2"   >----------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8981</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div><br></div><div>将这个参数传给stap, 启动 :&nbsp;</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 ~]# stap -D MAXSKIPPED=1 ./test.stp 8981</font></div><div></div><p></p></pre></div><div>在数据库中执行如下操作 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# drop table t;</font></div><div><font size="2"   >DROP TABLE</font></div><div><font size="2"   >digoal=# create table t(id int, info text, crt_time timestamp);</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=# insert into t select generate_series(1,1000000),md5(random()::text),now();</font></div><div><font size="2"   >INSERT 0 1000000</font></div><div><font size="2"   >digoal=# select count(*) from t;</font></div><div><font size="2"   >&nbsp; count &nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;1000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select count(*) from t;</font></div><div><font size="2"   >&nbsp; count &nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;1000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# create index idx_t_1 on t(id);</font></div><div><font size="2"   >CREATE INDEX</font></div><div><font size="2"   >digoal=# select count(*) from t;</font></div><div><font size="2"   >&nbsp; count &nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;1000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select count(*) from t;</font></div><div><font size="2"   >&nbsp; count &nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;1000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select count(*) from t;</font></div><div><font size="2"   >&nbsp; count &nbsp;</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;1000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# checkpoint;</font></div><div><font size="2"   >CHECKPOINT</font></div><div><font size="2"   >digoal=# checkpoint;</font></div><div><font size="2"   >CHECKPOINT</font></div><p></p></pre></div><div><br></div><div>stap的输出如下, 已经正常了 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pid:8981, query start: drop table t;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: drop table t;, read: 0,0, write: 65751,2</font></div><div><font size="2"   >pid:8981, query start: create table t(id int, info text, crt_time timestamp);, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: create table t(id int, info text, crt_time timestamp);, read: 0,0, write: 8448,2</font></div><div><font size="2"   >pid:8981, query start: insert into t select generate_series(1,1000000),md5(random()::text),now();, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: insert into t select generate_series(1,1000000),md5(random()::text),now();, read: 32768,4, write: 76603392,9351</font></div><div><font size="2"   >pid:8981, query start: select count(*) from t;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: select count(*) from t;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query start: select count(*) from t;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: select count(*) from t;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query start: create index idx_t_1 on t(id);, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: create index idx_t_1 on t(id);, read: 0,0, write: 22585576,2758</font></div><div><font size="2"   >pid:8981, query start: select count(*) from t;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: select count(*) from t;, read: 8192,1, write: 0,0</font></div><div><font size="2"   >pid:8981, query start: select count(*) from t;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: select count(*) from t;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query start: select count(*) from t;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: select count(*) from t;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query start: checkpoint;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: checkpoint;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query start: checkpoint;, read: 0,0, write: 0,0</font></div><div><font size="2"   >pid:8981, query done: checkpoint;, read: 0,0, write: 0,0</font></div><p></p></pre></div></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/dynamic-trace.html"   >http://www.postgresql.org/docs/9.3/static/dynamic-trace.html</a></div><div>2.&nbsp;syscalls2.stp</div><div>3.&nbsp;fs/read_write.c</div><div>4.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >cd /usr/share/systemtap/tapset</font></div><div><font size="2"   >[root@db-172-16-3-39 tapset]# less syscalls2.stp</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># read _______________________________________________________</font></div><div><font size="2"   ># ssize_t sys_read(unsigned int fd, char __user * buf, size_t count)</font></div><div><font size="2"   >probe syscall.read = kernel.function("sys_read").call</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; name = "read"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fd = $fd</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; buf_uaddr = $buf</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; count = $count</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; argstr = sprintf("%d, %p, %d", $fd, $buf, $count)</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe syscall.read.return = kernel.function("sys_read").return</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; name = "read"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; retstr = return_str(1, $return)</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># write ______________________________________________________</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># ssize_t sys_write(unsigned int fd,</font></div><div><font size="2"   ># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const char __user * buf,</font></div><div><font size="2"   ># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;size_t count)</font></div><div><font size="2"   >#</font></div><div><font size="2"   >probe syscall.write = kernel.function("sys_write").call</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; name = "write"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fd = $fd</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; buf_uaddr = $buf</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; count = $count</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; argstr = sprintf("%d, %s, %d", $fd, text_strn(user_string($buf), syscall_string_trunc, 1), $count)</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe syscall.write.return = kernel.function("sys_write").return</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; name = "write"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; retstr = return_str(1, $return)</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-39 tapset]# stap -l 'kernel.function("sys_read")'</font></div><div><font size="2"   >kernel.function("sys_read@fs/read_write.c:379")</font></div><div><font size="2"   >[root@db-172-16-3-39 tapset]# stap -l 'kernel.function("sys_write")'</font></div><div><font size="2"   >kernel.function("sys_write@fs/read_write.c:397")</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-39 src]# locate read_write.c</font></div><div><font size="2"   >/usr/src/debug/kernel-2.6.18/linux-2.6.18-348.12.1.el5.x86_64/fs/read_write.c</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-39 src]# less /usr/src/debug/kernel-2.6.18/linux-2.6.18-348.12.1.el5.x86_64/fs/read_write.c</font></div><div><font size="2"   >asmlinkage ssize_t sys_read(unsigned int fd, char __user * buf, size_t count)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; struct file *file;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ssize_t ret = -EBADF;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int fput_needed;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; file = fget_light(fd, &amp;fput_needed);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (file) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loff_t pos = file_pos_read(file);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret = vfs_read(file, buf, count, &amp;pos);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; file_pos_write(file, pos);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fput_light(file, fput_needed);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return ret;</font></div><div><font size="2"   >}</font></div><div><font size="2"   >EXPORT_SYMBOL_GPL(sys_read);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >asmlinkage ssize_t sys_write(unsigned int fd, const char __user * buf, size_t count)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; struct file *file;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ssize_t ret = -EBADF;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int fput_needed;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; file = fget_light(fd, &amp;fput_needed);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (file) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loff_t pos = file_pos_read(file);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret = vfs_write(file, buf, count, &amp;pos);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; file_pos_write(file, pos);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fput_light(file, fput_needed);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return ret;</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >EXPORT_SYMBOL_GPL(sys_write);</font></div><p></p></pre></div></div>
	</div>
</div>
</body>
</html>