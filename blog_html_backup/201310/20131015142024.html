<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Systemtap EXP: Trace PostgreSQL iostat per SQL statement 2</h2>
	<h5 id="">2013-10-15 14:20:24&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020139152191581/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>本例为上一篇blog的扩展, 可输出到块设备, 以及区分os cache的io请求操作.</div><div>相当精细.</div>stp文件如下 :&nbsp;<div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >global io_stat1%[120000] // 非cache读写字节数(单SQL)<br>global io_stat11%[120000] // 非cache读写耗费时间(单SQL)<br>global io_stat2%[120000] // cache读写字节数(单SQL)<br>global io_stat22%[120000] // cache读写耗费时间(单SQL)<br>global io_stat3%[120000] // 非cache读取字节数(总,只关心设备号)<br>global io_stat33%[120000] // 非cache读写耗费时间(总,只关心设备号)<br>global io_stat4%[120000] // cache读写字节数(总,只关心设备号)<br>global io_stat44%[120000] // cache读写耗费时间(总,只关心设备号)<br>global del%[120000] // 因为foreach中不允许修改本数组, 所以需要使用另一个数组来存储索引, 方便删除<br><br>probe vfs.read.return {<br>try {<br>  if ($return&gt;0) {<br>    v_us=gettimeofday_us() - @entry(gettimeofday_us())<br>    if (devname!="N/A" &amp;&amp; execname()=="postgres") { /*skip read from cache, filter postgres otherwise*/<br>      io_stat1[pid(),execname(),"R",devname] &lt;&lt;&lt; $return   // 非cache读字节数(单SQL)<br>      io_stat11[pid(),execname(),"R",devname] &lt;&lt;&lt; v_us     // 非cache读耗费时间(单SQL)<br>      io_stat3["R",devname] &lt;&lt;&lt; $return   // 非cache读字节数(总,只关心设备号)<br>      io_stat33["R",devname] &lt;&lt;&lt; v_us     // 非cache读耗费时间(总,只关心设备号)<br>    }<br>    if (devname=="N/A" &amp;&amp; execname()=="postgres") {<br>      io_stat2[pid(),execname(),"R",devname] &lt;&lt;&lt; $return   // cache读字节数(单SQL)<br>      io_stat22[pid(),execname(),"R",devname] &lt;&lt;&lt; v_us     // cache读耗费时间(单SQL)<br>      io_stat4["R",devname] &lt;&lt;&lt; $return   // cache读字节数(总,只关心设备号)<br>      io_stat44["R",devname] &lt;&lt;&lt; v_us     // cache读耗费时间(总,只关心设备号)<br>    }<br>  }<br>}<br>catch(msg) {<br>  printdln("---", pn(), msg)<br>}<br>}<br><br>probe vfs.write.return {<br>try {<br>  if ($return&gt;0) {<br>    v_us=gettimeofday_us() - @entry(gettimeofday_us())<br>    if (devname!="N/A" &amp;&amp; execname()=="postgres") { /*skip read from cache, filter postgres otherwise*/<br>      io_stat1[pid(),execname(),"W",devname] &lt;&lt;&lt; $return<br>      io_stat11[pid(),execname(),"W",devname] &lt;&lt;&lt; v_us<br>      io_stat3["W",devname] &lt;&lt;&lt; $return<br>      io_stat33["W",devname] &lt;&lt;&lt; v_us<br>    }<br>    if (devname=="N/A" &amp;&amp; execname()=="postgres") {<br>      io_stat2[pid(),execname(),"W",devname] &lt;&lt;&lt; $return<br>      io_stat22[pid(),execname(),"W",devname] &lt;&lt;&lt; v_us<br>      io_stat4["W",devname] &lt;&lt;&lt; $return<br>      io_stat44["W",devname] &lt;&lt;&lt; v_us<br>    }<br>  }<br>}<br>catch(msg) {<br>  printdln("---", pn(), msg)<br>}<br>}<br><br>probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("query__start") {<br>try {<br>  // SQL开始前, 先清除之前SQL的统计变量存储的信息.<br>  // 清除非CACHE读写统计变量的信息.<br>  // 因为foreach中不允许修改本数组, 所以需要使用另一个数组来存储索引, 方便删除, 这里就是del的用意.<br>  foreach([a,b,c,d] in io_stat1) {<br>    if (a==pid() &amp;&amp; b==execname()) {<br>      del[a,b,c,d]=1   //  将a,b,c,d作为索引存储任意一个值到del数组. a,b,c,d就是一会需要清除的io_stat1,io_stat11的索引值.<br>    }<br>  }<br>  foreach([a,b,c,d] in del) {<br>    delete io_stat1[a,b,c,d]<br>    delete io_stat11[a,b,c,d]<br>  }<br>  delete del  // 用完del后, 记得清除del的值.<br><br>  // 清除CACHE读写统计变量的信息.<br>  foreach([a,b,c,d] in io_stat2) {<br>    if (a==pid() &amp;&amp; b==execname()) {<br>      del[a,b,c,d]=1<br>    }<br>  }<br>  foreach([a,b,c,d] in del) {<br>    delete io_stat2[a,b,c,d]<br>    delete io_stat22[a,b,c,d]<br>  }<br>  delete del<br>}<br>catch(msg) {<br>  printdln("---", pn(), msg)<br>}<br>}<br><br>probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("query__done") {<br>try {<br>  // 输出SQL语句<br>  printf("query: %s\n", user_string($arg1))<br><br>  // 非cache统计<br>  println("非cache输出")<br>  foreach([a,b,c,d] in io_stat1 @sum -) {<br>    if (c == "R" &amp;&amp; a==pid() &amp;&amp; b==execname()) {<br>      var1 = @count(io_stat1[a,b,c,d])  // 请求次数<br>      var2 = @sum(io_stat1[a,b,c,d]) / 1024  // 请求K字节数<br>      var3 = @sum(io_stat11[a,b,c,d])  // 请求时间, us<br>      spvar1 = ((var3!=0) ? ((1000000*var1)/var3) : 0)  // 请求次数每秒<br>      spvar2 = ((var3!=0) ? ((1000000*var2)/var3) : 0)  // 请求K字节数每秒<br>      printf("-%s-devname:%s, reqs:%d, reqKbytes:%d, reqs/s:%d, reqKbytes/s:%d\n", c, d, var1, var2, spvar1, spvar2)<br>    }<br>    if (c == "W" &amp;&amp; a==pid() &amp;&amp; b==execname()) {<br>      var4 = @count(io_stat1[a,b,c,d])  // 请求次数<br>      var5 = @sum(io_stat1[a,b,c,d]) / 1024  // 请求K字节数<br>      var6 = @sum(io_stat11[a,b,c,d])  // 请求时间<br>      spvar4 = ((var6!=0) ? ((1000000*var4)/var6) : 0)  // 请求次数每秒<br>      spvar5 = ((var6!=0) ? ((1000000*var5)/var6) : 0)  // 请求K字节数每秒<br>      printf("-%s-devname:%s, reqs:%d, reqKbytes:%d, reqs/s:%d, reqKbytes/s:%d\n", c, d, var4, var5, spvar4, spvar5)<br>    }<br>    del[a,b,c,d]=1    // 使用a,b,c,d填充del数组, 用于清除io_stat1, io_stat11.<br>  }<br>  foreach([a,b,c,d] in del) {<br>    delete io_stat1[a,b,c,d]<br>    delete io_stat11[a,b,c,d]<br>  }<br>  delete del   // 用完清除del<br><br>// 清除非cache统计用过的本地变量, 后面的cache统计需要继续使用.<br>  delete var1<br>  delete var2<br>  delete var3<br>  delete var4<br>  delete var5<br>  delete var6<br>  delete spvar1<br>  delete spvar2<br>  delete spvar4<br>  delete spvar5<br><br>  // cache统计<br>  println("cache输出")<br>  foreach([a,b,c,d] in io_stat2 @sum -) {<br>    if (c == "R" &amp;&amp; a==pid() &amp;&amp; b==execname()) {<br>      var1 = @count(io_stat2[a,b,c,d])  // 请求次数<br>      var2 = @sum(io_stat2[a,b,c,d]) / 1024  // 请求K字节数<br>      var3 = @sum(io_stat22[a,b,c,d])  // 请求时间<br>      spvar1 = ((var3!=0) ? ((1000000*var1)/var3) : 0)  // 请求次数每秒<br>      spvar2 = ((var3!=0) ? ((1000000*var2)/var3) : 0)  // 请求K字节数每秒<br>      printf("-%s-devname:%s, reqs:%d, reqKbytes:%d, reqs/s:%d, reqKbytes/s:%d\n", c, d, var1, var2, spvar1, spvar2)<br>    }<br>    if (c == "W" &amp;&amp; a==pid() &amp;&amp; b==execname()) {<br>      var4 = @count(io_stat2[a,b,c,d])  // 请求次数<br>      var5 = @sum(io_stat2[a,b,c,d]) / 1024  // 请求K字节数<br>      var6 = @sum(io_stat22[a,b,c,d])  // 请求时间<br>      spvar4 = ((var6!=0) ? ((1000000*var4)/var6) : 0)  // 请求次数每秒<br>      spvar5 = ((var6!=0) ? ((1000000*var5)/var6) : 0)  // 请求K字节数每秒<br>      printf("-%s-devname:%s, reqs:%d, reqKbytes:%d, reqs/s:%d, reqKbytes/s:%d\n", c, d, var4, var5, spvar4, spvar5)<br>    }<br>    del[a,b,c,d]=1<br>  }<br>  foreach([a,b,c,d] in del) {<br>    delete io_stat1[a,b,c,d]<br>    delete io_stat11[a,b,c,d]<br>  }<br>  delete del<br>}<br>catch(msg) {<br>  printdln("---", pn(), msg)<br>}<br>}<br><br>probe end{<br>try {<br>  println("----------END----------")<br>  // 非cache, 按设备的读写统计输出.<br>  println("非cache输出")<br>  foreach([c,d] in io_stat3 @sum -) {<br>    if (c == "R") {<br>      var1 = @count(io_stat3[c,d])  // 请求次数<br>      var2 = @sum(io_stat3[c,d]) / 1024  // 请求K字节数<br>      var3 = @sum(io_stat33[c,d])  // 请求时间<br>      spvar1 = ((var3!=0) ? ((1000000*var1)/var3) : 0)  // 请求次数每秒<br>      spvar2 = ((var3!=0) ? ((1000000*var2)/var3) : 0)  // 请求K字节数每秒<br>      printf("-%s-devname:%s, reqs:%d, reqKbytes:%d, reqs/s:%d, reqKbytes/s:%d\n", c, d, var1, var2, spvar1, spvar2)<br>    }<br>    if (c == "W") {<br>      var4 = @count(io_stat3[c,d])  // 请求次数<br>      var5 = @sum(io_stat3[c,d]) / 1024  // 请求K字节数<br>      var6 = @sum(io_stat33[c,d])  // 请求时间<br>      spvar4 = ((var6!=0) ? ((1000000*var4)/var6) : 0)  // 请求次数每秒<br>      spvar5 = ((var6!=0) ? ((1000000*var5)/var6) : 0)  // 请求K字节数每秒<br>      printf("-%s-devname:%s, reqs:%d, reqKbytes:%d, reqs/s:%d, reqKbytes/s:%d\n", c, d, var4, var5, spvar4, spvar5)<br>    }<br>  }<br><br>  delete var1<br>  delete var2<br>  delete var3<br>  delete var4<br>  delete var5<br>  delete var6<br>  delete spvar1<br>  delete spvar2<br>  delete spvar4<br>  delete spvar5<br><br>  // cache, 按设备的读写统计输出.<br>  println("cache输出")<br>  foreach([c,d] in io_stat4 @sum -) {<br>    if (c == "R") {<br>      var1 = @count(io_stat4[c,d])  // 请求次数<br>      var2 = @sum(io_stat4[c,d]) / 1024  // 请求K字节数<br>      var3 = @sum(io_stat44[c,d])  // 请求时间<br>      spvar1 = ((var3!=0) ? ((1000000*var1)/var3) : 0)  // 请求次数每秒<br>      spvar2 = ((var3!=0) ? ((1000000*var2)/var3) : 0)  // 请求K字节数每秒<br>      printf("-%s-devname:%s, reqs:%d, reqKbytes:%d, reqs/s:%d, reqKbytes/s:%d\n", c, d, var1, var2, spvar1, spvar2)<br>    }<br>    if (c == "W") {<br>      var4 = @count(io_stat4[c,d])  // 请求次数<br>      var5 = @sum(io_stat4[c,d]) / 1024  // 请求K字节数<br>      var6 = @sum(io_stat44[c,d])  // 请求时间<br>      spvar4 = ((var6!=0) ? ((1000000*var4)/var6) : 0)  // 请求次数每秒<br>      spvar5 = ((var6!=0) ? ((1000000*var5)/var6) : 0)  // 请求K字节数每秒<br>      printf("-%s-devname:%s, reqs:%d, reqKbytes:%d, reqs/s:%d, reqKbytes/s:%d\n", c, d, var4, var5, spvar4, spvar5)<br>    }<br>  }<br><br>// 结束后清除所有的全局变量的值.<br>  delete io_stat1<br>  delete io_stat11<br>  delete io_stat2<br>  delete io_stat22<br>  delete io_stat3<br>  delete io_stat33<br>  delete io_stat4<br>  delete io_stat44<br>  delete del<br>}<br>catch(msg) {<br>  printdln("---", pn(), msg)<br>}<br>}</span></font></div><p></p></pre></div><div><br></div><div>跟踪举例 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# /opt/systemtap/bin/stap test.stp&nbsp;</font></div><div></div><p></p></pre></div><div>SQL :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# drop table t;</font></div><div><font size="2"   >DROP TABLE</font></div><div><font size="2"   >digoal=# create table t(id int, info text, crt_time timestamp);</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=# insert into t select generate_series(1,1000000), md5(random()::text), clock_timestamp();</font></div><div><font size="2"   >INSERT 0 1000000</font></div><div><font size="2"   >digoal=# create index idx_t_1 on t(id);</font></div><div><font size="2"   >CREATE INDEX</font></div><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select count(*) from t;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Aggregate &nbsp;(cost=21846.00..21846.01 rows=1 width=0) (actual time=467.932..467.932 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: count(*)</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared hit=9346</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Seq Scan on public.t &nbsp;(cost=0.00..19346.00 rows=1000000 width=0) (actual time=0.011..253.487 rows=1000000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Buffers: shared hit=9346</font></div><div><font size="2"   >&nbsp;Total runtime: 467.978 ms</font></div><div><font size="2"   >(7 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select count(*) from t where id&lt;10000;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >-----</font></div><div><font size="2"   >&nbsp;Aggregate &nbsp;(cost=16928.08..16928.09 rows=1 width=0) (actual time=8.509..8.509 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: count(*)</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared hit=94 read=30</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Index Only Scan using idx_t_1 on public.t &nbsp;(cost=0.42..16094.75 rows=333333 width=0) (actual time=0.146..6.010 rows=9999 loop</font></div><div><font size="2"   >s=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: id</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Index Cond: (t.id &lt; 10000)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Heap Fetches: 9999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Buffers: shared hit=94 read=30</font></div><div><font size="2"   >&nbsp;Total runtime: 8.558 ms</font></div><div><font size="2"   >(9 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select count(*) from generate_series(1,1000000);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >---------</font></div><div><font size="2"   >&nbsp;Aggregate &nbsp;(cost=12.50..12.51 rows=1 width=0) (actual time=918.138..918.138 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: count(*)</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: temp read=1710 written=1709</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Function Scan on pg_catalog.generate_series &nbsp;(cost=0.00..10.00 rows=1000 width=0) (actual time=320.753..684.423 rows=1000000&nbsp;</font></div><div><font size="2"   >loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: generate_series</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Function Call: generate_series(1, 1000000)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Buffers: temp read=1710 written=1709</font></div><div><font size="2"   >&nbsp;Total runtime: 925.695 ms</font></div><div><font size="2"   >(8 rows)</font></div><p></p></pre></div><div><br></div><div>输出, 包含IO请求的设备名, 如果数据在shared buffer中命中的话, 就没有os cache的io请求操作也没有块设备额的io请求操作 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >query: drop table t;</font></div><div><font size="2"   >非cache输出</font></div><div><font size="2"   >cache输出</font></div><div><font size="2"   >query: create table t(id int, info text, crt_time timestamp);</font></div><div><font size="2"   >非cache输出</font></div><div><font size="2"   >cache输出</font></div><div><font size="2"   >query: insert into t select generate_series(1,1000000), md5(random()::text), clock_timestamp();</font></div><div><font size="2"   >非cache输出</font></div><div><font size="2"   >-R-devname:sdc1, reqs:4, reqKbytes:32, reqs/s:76923, reqKbytes/s:615384</font></div><div><font size="2"   >-W-devname:sdc1, reqs:4, reqKbytes:32, reqs/s:37735, reqKbytes/s:301886</font></div><div><font size="2"   >cache输出</font></div><div><font size="2"   >query: create index idx_t_1 on t(id);</font></div><div><font size="2"   >非cache输出</font></div><div><font size="2"   >-R-devname:sdc1, reqs:2, reqKbytes:16, reqs/s:105263, reqKbytes/s:842105</font></div><div><font size="2"   >-W-devname:sdc1, reqs:2, reqKbytes:16, reqs/s:51282, reqKbytes/s:410256</font></div><div><font size="2"   >cache输出</font></div><div><font size="2"   >query: explain (analyze,verbose,costs,buffers,timing) select count(*) from t;</font></div><div><font size="2"   >非cache输出</font></div><div><font size="2"   >-R-devname:sdc1, reqs:3, reqKbytes:24, reqs/s:90909, reqKbytes/s:727272</font></div><div><font size="2"   >-W-devname:sdc1, reqs:3, reqKbytes:24, reqs/s:46153, reqKbytes/s:369230</font></div><div><font size="2"   >cache输出</font></div><div><font size="2"   >query: explain (analyze,verbose,costs,buffers,timing) select count(*) from t where id&lt;10000;</font></div><div><font size="2"   >非cache输出</font></div><div><font size="2"   >-R-devname:sdc1, reqs:32, reqKbytes:256, reqs/s:101265, reqKbytes/s:810126</font></div><div><font size="2"   >-W-devname:sdc1, reqs:32, reqKbytes:256, reqs/s:64128, reqKbytes/s:513026</font></div><div><font size="2"   >cache输出</font></div><div><font size="2"   >query: explain (analyze,verbose,costs,buffers,timing) select count(*) from generate_series(1,1000000);</font></div><div><font size="2"   >非cache输出</font></div><div><font size="2"   >-R-devname:sdc1, reqs:1711, reqKbytes:13687, reqs/s:104969, reqKbytes/s:839693</font></div><div><font size="2"   >-W-devname:sdc1, reqs:1711, reqKbytes:13687, reqs/s:69103, reqKbytes/s:552786</font></div><div><font size="2"   >cache输出</font></div><div><font size="2"   >^C----------END----------</font></div><div><font size="2"   >非cache输出</font></div><div><font size="2"   >-R-devname:sdc1, reqs:1836, reqKbytes:14238, reqs/s:106477, reqKbytes/s:825726</font></div><div><font size="2"   >-W-devname:sdc1, reqs:1836, reqKbytes:14238, reqs/s:69445, reqKbytes/s:538543</font></div><div><font size="2"   >cache输出</font></div><div><font size="2"   >-W-devname:N/A, reqs:8, reqKbytes:0, reqs/s:5242, reqKbytes/s:0</font></div><div><font size="2"   >-R-devname:N/A, reqs:7, reqKbytes:0, reqs/s:20771, reqKbytes/s:0</font></div><p></p></pre></div>[参考]<wbr></div><div>1.&nbsp;<a style="line-height: 28px;" href="http://blog.163.com/digoal@126/blog/static/1638770402013915115254543/"   >http://blog.163.com/digoal@126/blog/static/1638770402013915115254543/</a></div></div>
	</div>
</div>
</body>
</html>