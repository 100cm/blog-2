<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Systemtap EXP: PostgreSQL IN-BUILD mark Class 3 - checkpoint</h2>
	<h5 id="">2013-10-16 15:56:28&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201391622459221/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>本文将讲一下PostgreSQL内建的checkpoint相关探针.</div><div>包含:&nbsp;</div><div>checkpoint开始, 完成;&nbsp;</div><div>checkpoin的clog部分开始,&nbsp;<span style="line-height: 28px;"   >完成;&nbsp;</span></div><div><span style="line-height: 28px;"   >checkpoin的subtransaction部分开始, 完成;&nbsp;</span></div><div><span style="line-height: 28px;"   >checkpoin的multixact部分开始, 完成;&nbsp;</span></div><div><span style="line-height: 28px;"   >checkpoin的buffer writting部分开始, 写脏页面开始, 单个脏页面写完成, 所有脏页面写完成,&nbsp;</span><span style="line-height: 28px;"   >checkpoin的buffer write</span><span style="line-height: 28px;"   >完成;&nbsp;</span></div><div><span style="line-height: 28px;"   >checkpoin的two phase部分开始, 完成;</span></div><div><br></div><div>从这些探针变量中可以获取到 :&nbsp;</div><div>1. checkpoint的类型,&nbsp;</div><div>2. checkpoint写了多少buffers, 一共有多少buffers, checkpoint过程中产生了多少xlog文件, 有多少xlog文件可以删除, 多少xlog文件可以重用.</div><div>3 .区分是normal checkpoint还是shutdown checkpoint</div><div>4. shared buffer中<span style="line-height: 28px;"   >一共有多少buffers(单位page), buffers中有多少脏数据要写</span></div><div><span style="line-height: 28px;"   >5. buffer ID, 当使用buffer_sync_written时得到, buffer id即当前正在同步shared buffer中的那个page.</span></div><div><span style="line-height: 28px;"   >6. 真实同步的buffers, 期望同步的buffers, 使用buffer__sync__done探针时得到. 如果两者不相等, 说明其他进程也在flush buffer.</span></div><div><br></div><div>checkpoint探针一般可用于收集checkpoint各个部分的时间开销. checkpoint频度. 各个部分的详细输出等.</div><div>结合内核探针, 可以得知checkpoint每个部分带来的io开销.</div><div>例子就不举了, 可以参考 :&nbsp;</div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201391684012713/"   >http://blog.163.com/digoal@126/blog/static/163877040201391684012713/</a></div><div><br></div><div>探针详情 :&nbsp;</div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; background-color: rgb(224, 236, 239); border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 13.333333969116211px; line-height: normal;"   ><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >checkpoint-start</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(int)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when a checkpoint is started. arg0 holds the bitwise flags used to distinguish different checkpoint types, such as shutdown, immediate or force.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >checkpoint-done</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(int, int, int, int, int)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when a checkpoint is complete. (The probes listed next fire in sequence during checkpoint processing.) arg0 is the number of buffers written. arg1 is the total number of buffers. arg2, arg3 and arg4 contain the number of xlog file(s) added, removed and recycled respectively.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >clog-checkpoint-start</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(bool)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when the CLOG portion of a checkpoint is started. arg0 is true for normal checkpoint, false for shutdown checkpoint.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >clog-checkpoint-done</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(bool)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when the CLOG portion of a checkpoint is complete. arg0 has the same meaning as for clog-checkpoint-start.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >subtrans-checkpoint-start</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(bool)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when the SUBTRANS portion of a checkpoint is started. arg0 is true for normal checkpoint, false for shutdown checkpoint.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >subtrans-checkpoint-done</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(bool)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when the SUBTRANS portion of a checkpoint is complete. arg0 has the same meaning as for subtrans-checkpoint-start.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >multixact-checkpoint-start</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(bool)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when the MultiXact portion of a checkpoint is started. arg0 is true for normal checkpoint, false for shutdown checkpoint.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >multixact-checkpoint-done</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(bool)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when the MultiXact portion of a checkpoint is complete. arg0 has the same meaning as for multixact-checkpoint-start.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >buffer-checkpoint-start</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(int)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when the buffer-writing portion of a checkpoint is started. arg0 holds the bitwise flags used to distinguish different checkpoint types, such as shutdown, immediate or force.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >buffer-sync-start</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(int, int)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when we begin to write dirty buffers during checkpoint (after identifying which buffers must be written). arg0 is the total number of buffers. arg1 is the number that are currently dirty and need to be written.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >buffer-sync-written</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(int)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires after each buffer is written during checkpoint. arg0 is the ID number of the buffer.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >buffer-sync-done</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >(int, int, int)</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when all dirty buffers have been written. arg0 is the total number of buffers. arg1 is the number of buffers actually written by the checkpoint process. arg2 is the number that were expected to be written (arg1 of buffer-sync-start); any difference reflects other processes flushing buffers during the checkpoint.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >buffer-checkpoint-sync-start</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >()</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires after dirty buffers have been written to the kernel, and before starting to issue fsync requests.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >buffer-checkpoint-done</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >()</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when syncing of buffers to disk is complete.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >twophase-checkpoint-start</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >()</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >Probe that fires when the two-phase portion of a checkpoint is started.</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >twophase-checkpoint-done</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >()</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Probe that fires when the two-phase portion of a checkpoint is complete.</td></tr></table></div><div><br></div><div>探针信息见本文末尾, 探针相关源码文件 :&nbsp;</div><div>src/backend/storage/buffer/bufmgr.c</div><div>src/backend/access/transam/xlog.c</div><div>src/backend/access/transam/clog.c</div><div>src/backend/access/transam/subtrans.c</div><div>src/backend/access/transam/multixact.c</div><div>src/backend/access/transam/twophase.c</div><div>针对探针中出现的变量, 从源码中抽取出来简单的解释一下 :&nbsp;</div><div>checkpoint的几种类型以bitwise形式定义区分, 源码如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* Perform a checkpoint --- either during shutdown, or on-the-fly</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* flags is a bitwise OR of the following:</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;CHECKPOINT_IS_SHUTDOWN: checkpoint is for database shutdown.</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;CHECKPOINT_END_OF_RECOVERY: checkpoint is for end of WAL recovery.</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;CHECKPOINT_IMMEDIATE: finish the checkpoint ASAP,</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ignoring checkpoint_completion_target parameter.</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;CHECKPOINT_FORCE: force a checkpoint even if no XLOG activity has occurred</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;since the last one (implied by CHECKPOINT_IS_SHUTDOWN or</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CHECKPOINT_END_OF_RECOVERY).</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Note: flags contains other bits, of interest here only for logging purposes.</font></div><div><font size="2"   >&nbsp;* In particular note that this routine is synchronous and does not pay</font></div><div><font size="2"   >&nbsp;* attention to CHECKPOINT_WAIT.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* If !shutdown then we are writing an online checkpoint. This is a very special</font></div><div><font size="2"   >&nbsp;* kind of operation and WAL record because the checkpoint action occurs over</font></div><div><font size="2"   >&nbsp;* a period of time yet logically occurs at just a single LSN. The logical</font></div><div><font size="2"   >&nbsp;* position of the WAL record (redo ptr) is the same or earlier than the</font></div><div><font size="2"   >&nbsp;* physical position. When we replay WAL we locate the checkpoint via its</font></div><div><font size="2"   >&nbsp;* physical position then read the redo ptr and actually start replay at the</font></div><div><font size="2"   >&nbsp;* earlier logical position. Note that we don't write *anything* to WAL at</font></div><div><font size="2"   >&nbsp;* the logical position, so that location could be any other kind of WAL record.</font></div><div><font size="2"   >&nbsp;* All of this mechanism allows us to continue working while we checkpoint.</font></div><div><font size="2"   >&nbsp;* As a result, timing of actions is critical here and be careful to note that</font></div><div><font size="2"   >&nbsp;* this function will likely take minutes to execute on a busy system.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >void</font></div><div><font size="2"   >CreateCheckPoint(int flags)</font></div><div><font size="2"   >{</font></div></div><div><font size="2"   >...</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TRACE_POSTGRESQL_CHECKPOINT_START(flags);</font></div><p></p></pre></div><div>checkpoint类型定义 :&nbsp;</div><div>src/include/access/xlog.h</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* OR-able request flag bits for checkpoints. &nbsp;The "cause" bits are used only</font></div><div><font size="2"   >&nbsp;* for logging purposes. &nbsp;Note: the flags must be defined so that it's</font></div><div><font size="2"   >&nbsp;* sensible to OR together request flags arising from different requestors.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >/* These directly affect the behavior of CreateCheckPoint and subsidiaries */</font></div><div><font size="2"   >#define CHECKPOINT_IS_SHUTDOWN &nbsp;0x0001 &nbsp;/* Checkpoint is for shutdown */</font></div><div><font size="2"   >#define CHECKPOINT_END_OF_RECOVERY &nbsp; &nbsp; &nbsp;0x0002 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* Like shutdown checkpoint,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* but issued at end of WAL</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* recovery */</font></div><div><font size="2"   >#define CHECKPOINT_IMMEDIATE &nbsp; &nbsp;0x0004 &nbsp;/* Do it without delays */</font></div><div><font size="2"   >#define CHECKPOINT_FORCE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0008 &nbsp;/* Force even if no activity */</font></div><div><font size="2"   >/* These are important to RequestCheckpoint */</font></div><div><font size="2"   >#define CHECKPOINT_WAIT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0010 &nbsp;/* Wait for completion */</font></div><div><font size="2"   >/* These indicate the cause of a checkpoint request */</font></div><div><font size="2"   >#define CHECKPOINT_CAUSE_XLOG &nbsp; 0x0020 &nbsp;/* XLOG consumption */</font></div><div><font size="2"   >#define CHECKPOINT_CAUSE_TIME &nbsp; 0x0040 &nbsp;/* Elapsed time */</font></div><p></p></pre></div><div><span style="line-height: 28px;"   >checkpoint__done</span><span style="line-height: 28px;"   >探针的变量信息 :&nbsp;</span></div><div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TRACE_POSTGRESQL_CHECKPOINT_DONE(CheckpointStats.ckpt_bufs_written,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NBuffers,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CheckpointStats.ckpt_segs_added,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CheckpointStats.ckpt_segs_removed,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CheckpointStats.ckpt_segs_recycled);</font></div></div><div><font size="2"   >src/include/storage/buf.h</font></div><div><font size="2"   >NBuffers指shared buffersz总的pages数. 使用gdb可以输出NBuffers的值, 可以证实这一点.</font></div><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* Buffer identifiers.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Zero is invalid, positive is the index of a shared buffer (1..NBuffers),</font></div><div><font size="2"   >&nbsp;* negative is the index of a local buffer (-1 .. -NLocBuffer).</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >typedef int Buffer;</font></div></div><p></p></pre></div></div><div><br></div><div>在测试过程中遇到1个BUG, 所有和<span style="line-height: 28px;"   >checkpoint__done探针中相关的变量, 只要输出就会报错. 缺乏对应的debuginfo.</span></div><div><span style="line-height: 28px;"   >已经提交bug报告, 等待回复.</span></div><div><span style="line-height: 28px;"   >例如 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-150 postgresql-9.3.1]# stap --vp 10000 -e 'probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {println($$vars)}'</font></div><div><font size="2"   >Pass 1: parsed user script and 96 library script(s) using 152024virt/25212res/2104shr/23932data kb, in 230usr/20sys/252real ms.</font></div><div><font size="2"   >WARNING: Can't parse SDT_V3 operand 'CheckpointStats+40(%rip)': identifier '$$vars' at &lt;input&gt;:1:87</font></div><div><font size="2"   >&nbsp;source: probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {println($$vars)}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >WARNING: Can't parse SDT_V3 operand 'NBuffers(%rip)': identifier '$$vars' at :1:87</font></div><div><font size="2"   >&nbsp;source: probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {println($$vars)}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >WARNING: Can't parse SDT_V3 operand 'CheckpointStats+44(%rip)': identifier '$$vars' at :1:87</font></div><div><font size="2"   >&nbsp;source: probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {println($$vars)}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >WARNING: Can't parse SDT_V3 operand 'CheckpointStats+48(%rip)': identifier '$$vars' at :1:87</font></div><div><font size="2"   >&nbsp;source: probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {println($$vars)}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >WARNING: Can't parse SDT_V3 operand 'CheckpointStats+52(%rip)': identifier '$$vars' at :1:87</font></div><div><font size="2"   >&nbsp;source: probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {println($$vars)}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >semantic error: unable to find local 'arg1', [man error::dwarf] dieoffset 0xd00f5 in /home/pg93/pgsql9.3.1/bin/postgres, near pc 0x4b9789 in CreateCheckPoint xlog.c (alternatives: $flags $shutdown $checkPoint $recptr $Insert $rdata $freespace $_logSegNo $vxids $nvxids $__func__): identifier '$$vars' at :1:87</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; source: probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {println($$vars)}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >semantic error: SDT asm not understood, requires debuginfo: identifier '$$vars' at :1:87</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; source: probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {println($$vars)}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Pass 2: analysis failed. &nbsp;[man error::pass2]</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@db-172-16-3-150 postgresql-9.3.1]# stap --vp 10000 -e 'probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("buffer__syn_done") {println($$vars)}'</font></div><div><font size="2"   >Pass 1: parsed user script and 96 library script(s) using 152024virt/25212res/2104shr/23932data kb, in 230usr/20sys/252real ms.</font></div><div><font size="2"   >WARNING: Can't parse SDT_V3 operand 'NBuffers(%rip)': identifier '$$vars' at &lt;input&gt;:1:89</font></div><div><font size="2"   >&nbsp;source: probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("buffer__sync__done") {println($$vars)}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >semantic error: unable to find local 'arg1', [man error::dwarf] dieoffset 0x43a1d1 in /home/pg93/pgsql9.3.1/bin/postgres, near pc 0x630697 in &lt;unknown&gt; bufmgr.c (alternatives: $buf_id $num_to_scan $num_to_write $num_written $mask): identifier '$$vars' at :1:89</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; source: probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("buffer__sync__done") {println($$vars)}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >semantic error: SDT asm not understood, requires debuginfo: identifier '$$vars' at :1:89</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; source: probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("buffer__sync__done") {println($$vars)}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Pass 2: analysis failed. &nbsp;[man error::pass2]</font></div></div><p></p></pre></div><div>CHECKPOINT_DONE探针中输出的CheckpointStats, 数据类型定义如下 :&nbsp;</div><div>src/include/access/xlog.h</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/* Checkpoint statistics */</font></div><div><font size="2"   >typedef struct CheckpointStatsData</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TimestampTz ckpt_start_t; &nbsp; &nbsp; &nbsp; /* start of checkpoint */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TimestampTz ckpt_write_t; &nbsp; &nbsp; &nbsp; /* start of flushing buffers */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TimestampTz ckpt_sync_t; &nbsp; &nbsp; &nbsp; &nbsp;/* start of fsyncs */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TimestampTz ckpt_sync_end_t; &nbsp; &nbsp;/* end of fsyncs */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TimestampTz ckpt_end_t; &nbsp; &nbsp; &nbsp; &nbsp; /* end of checkpoint */</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ckpt_bufs_written; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* # of buffers written */</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ckpt_segs_added; &nbsp; &nbsp; &nbsp; &nbsp;/* # of new xlog segments created */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ckpt_segs_removed; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* # of xlog segments deleted */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ckpt_segs_recycled; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* # of xlog segments recycled */</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ckpt_sync_rels; /* # of relations synced */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; uint64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ckpt_longest_sync; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* Longest sync for one relation */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; uint64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ckpt_agg_sync_time; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* The sum of all the individual sync</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* times, which is not necessarily the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* same as the total elapsed time for</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* the entire sync phase. */</font></div><div><font size="2"   >} CheckpointStatsData;</font></div><p></p></pre></div><div>使用$$locals可以输出一些本地变量的值.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# stap -e '</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {</font></div><div><font size="2"   >&nbsp; println($$locals)</font></div><div><font size="2"   >}'</font></div><div><font size="2"   >shutdown=? checkPoint={...} recptr=0x603d5cc58 Insert=0x7faaa73e7c00 rdata={...} freespace=? _logSegNo=? vxids=? nvxids=0x0 __func__=[...]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# stap -e '</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {</font></div><div><font size="2"   >&nbsp; println($recptr$$)</font></div><div><font size="2"   >}'</font></div><div><font size="2"   >25834147224</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# stap -e '</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.1/bin/postgres").mark("checkpoint__done") {</font></div><div><font size="2"   >&nbsp; println($Insert$$)</font></div><div><font size="2"   >}'</font></div><div><font size="2"   >{.PrevRecord=25834147760, .curridx=0, .currpage=0x7faaa73ec000, .currpos="", .RedoRecPtr=25834147704, .forcePageWrites='\000', .fullPageWrites='\001', .exclusiveBackup='\000', .nonExclusiveBackups=0, .lastBackupStart=0}</font></div><p></p></pre></div><div>对于这个BUG的处理请参考另一篇blog.</div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201391883345365/"   >http://blog.163.com/digoal@126/blog/static/163877040201391883345365/</a></div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402013918103315822/"   >http://blog.163.com/digoal@126/blog/static/1638770402013918103315822/</a></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/dynamic-trace.html"   >http://www.postgresql.org/docs/9.3/static/dynamic-trace.html</a></div><div>2.&nbsp;</div><div><div style="line-height: 28px;"   >src/backend/storage/buffer/bufmgr.c</div><div style="line-height: 28px;"   >src/backend/access/transam/xlog.c</div><div style="line-height: 28px;"   >src/backend/access/transam/clog.c</div><div style="line-height: 28px;"   >src/backend/access/transam/subtrans.c</div><div style="line-height: 28px;"   >src/backend/access/transam/multixact.c</div><div style="line-height: 28px;"   >src/backend/access/transam/twophase.c</div></div><div><span style="line-height: 28px;"   >src/include/access/xlog.h</span></div><div>2. checkpoint相关探针信息 :&nbsp;</div><div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_BUFFER_CHECKPOINT_START ( int) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_CHECKPOINT_START_ENABLED() __builtin_expect (buffer__checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_buffer__checkpoint__start_semaphore buffer__checkpoint__start_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_CHECKPOINT_START_ENABLED() __builtin_expect (postgresql_buffer__checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_buffer__checkpoint__start_semaphore __attribute__ ((unused)) __attribute__ ((section&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >(".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_CHECKPOINT_START(arg1) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE1(postgresql,buffer__checkpoint__start,arg1)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_BUFFER_CHECKPOINT_SYNC_START () */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_CHECKPOINT_SYNC_START_ENABLED() __builtin_expect (buffer__checkpoint__sync__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_buffer__checkpoint__sync__start_semaphore buffer__checkpoint__sync__start_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_CHECKPOINT_SYNC_START_ENABLED() __builtin_expect (postgresql_buffer__checkpoint__sync__start_semapho</font></div><div style="line-height: 28px;"   ><font size="2"   >re, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_buffer__checkpoint__sync__start_semaphore __attribute__ ((unused)) __attribute__ ((se</font></div><div style="line-height: 28px;"   ><font size="2"   >ction (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_CHECKPOINT_SYNC_START() \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE(postgresql,buffer__checkpoint__sync__start)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_BUFFER_CHECKPOINT_DONE () */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_CHECKPOINT_DONE_ENABLED() __builtin_expect (buffer__checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_buffer__checkpoint__done_semaphore buffer__checkpoint__done_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_CHECKPOINT_DONE_ENABLED() __builtin_expect (postgresql_buffer__checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_buffer__checkpoint__done_semaphore __attribute__ ((unused)) __attribute__ ((section (</font></div><div style="line-height: 28px;"   ><font size="2"   >".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_CHECKPOINT_DONE() \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE(postgresql,buffer__checkpoint__done)</font></div></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_CHECKPOINT_START ( int) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CHECKPOINT_START_ENABLED() __builtin_expect (checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_checkpoint__start_semaphore checkpoint__start_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CHECKPOINT_START_ENABLED() __builtin_expect (postgresql_checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_checkpoint__start_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CHECKPOINT_START(arg1) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE1(postgresql,checkpoint__start,arg1)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_CHECKPOINT_DONE ( int, int, int, int, int) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CHECKPOINT_DONE_ENABLED() __builtin_expect (checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_checkpoint__done_semaphore checkpoint__done_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CHECKPOINT_DONE_ENABLED() __builtin_expect (postgresql_checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_checkpoint__done_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CHECKPOINT_DONE(arg1,arg2,arg3,arg4,arg5) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE5(postgresql,checkpoint__done,arg1,arg2,arg3,arg4,arg5)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_CLOG_CHECKPOINT_START ( char) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CLOG_CHECKPOINT_START_ENABLED() __builtin_expect (clog__checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_clog__checkpoint__start_semaphore clog__checkpoint__start_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CLOG_CHECKPOINT_START_ENABLED() __builtin_expect (postgresql_clog__checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_clog__checkpoint__start_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CLOG_CHECKPOINT_START(arg1) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE1(postgresql,clog__checkpoint__start,arg1)</font></div></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_CLOG_CHECKPOINT_DONE ( char) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CLOG_CHECKPOINT_DONE_ENABLED() __builtin_expect (clog__checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_clog__checkpoint__done_semaphore clog__checkpoint__done_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CLOG_CHECKPOINT_DONE_ENABLED() __builtin_expect (postgresql_clog__checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_clog__checkpoint__done_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_CLOG_CHECKPOINT_DONE(arg1) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE1(postgresql,clog__checkpoint__done,arg1)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_SUBTRANS_CHECKPOINT_START ( char) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_SUBTRANS_CHECKPOINT_START_ENABLED() __builtin_expect (subtrans__checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_subtrans__checkpoint__start_semaphore subtrans__checkpoint__start_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_SUBTRANS_CHECKPOINT_START_ENABLED() __builtin_expect (postgresql_subtrans__checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_subtrans__checkpoint__start_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_SUBTRANS_CHECKPOINT_START(arg1) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE1(postgresql,subtrans__checkpoint__start,arg1)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_SUBTRANS_CHECKPOINT_DONE ( char) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_SUBTRANS_CHECKPOINT_DONE_ENABLED() __builtin_expect (subtrans__checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_subtrans__checkpoint__done_semaphore subtrans__checkpoint__done_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_SUBTRANS_CHECKPOINT_DONE_ENABLED() __builtin_expect (postgresql_subtrans__checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_subtrans__checkpoint__done_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_SUBTRANS_CHECKPOINT_DONE(arg1) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE1(postgresql,subtrans__checkpoint__done,arg1)</font></div></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_MULTIXACT_CHECKPOINT_START ( char) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_MULTIXACT_CHECKPOINT_START_ENABLED() __builtin_expect (multixact__checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_multixact__checkpoint__start_semaphore multixact__checkpoint__start_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_MULTIXACT_CHECKPOINT_START_ENABLED() __builtin_expect (postgresql_multixact__checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_multixact__checkpoint__start_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_MULTIXACT_CHECKPOINT_START(arg1) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE1(postgresql,multixact__checkpoint__start,arg1)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_MULTIXACT_CHECKPOINT_DONE ( char) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_MULTIXACT_CHECKPOINT_DONE_ENABLED() __builtin_expect (multixact__checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_multixact__checkpoint__done_semaphore multixact__checkpoint__done_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_MULTIXACT_CHECKPOINT_DONE_ENABLED() __builtin_expect (postgresql_multixact__checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_multixact__checkpoint__done_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_MULTIXACT_CHECKPOINT_DONE(arg1) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE1(postgresql,multixact__checkpoint__done,arg1)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_TWOPHASE_CHECKPOINT_START () */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_TWOPHASE_CHECKPOINT_START_ENABLED() __builtin_expect (twophase__checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_twophase__checkpoint__start_semaphore twophase__checkpoint__start_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_TWOPHASE_CHECKPOINT_START_ENABLED() __builtin_expect (postgresql_twophase__checkpoint__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_twophase__checkpoint__start_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_TWOPHASE_CHECKPOINT_START() \</font></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE(postgresql,twophase__checkpoint__start)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_TWOPHASE_CHECKPOINT_DONE () */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_TWOPHASE_CHECKPOINT_DONE_ENABLED() __builtin_expect (twophase__checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_twophase__checkpoint__done_semaphore twophase__checkpoint__done_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_TWOPHASE_CHECKPOINT_DONE_ENABLED() __builtin_expect (postgresql_twophase__checkpoint__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_twophase__checkpoint__done_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_TWOPHASE_CHECKPOINT_DONE() \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE(postgresql,twophase__checkpoint__done)</font></div></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_BUFFER_SYNC_START ( int, int) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_SYNC_START_ENABLED() __builtin_expect (buffer__sync__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_buffer__sync__start_semaphore buffer__sync__start_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_SYNC_START_ENABLED() __builtin_expect (postgresql_buffer__sync__start_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_buffer__sync__start_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_SYNC_START(arg1,arg2) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE2(postgresql,buffer__sync__start,arg1,arg2)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_BUFFER_SYNC_WRITTEN ( int) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_SYNC_WRITTEN_ENABLED() __builtin_expect (buffer__sync__written_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_buffer__sync__written_semaphore buffer__sync__written_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_SYNC_WRITTEN_ENABLED() __builtin_expect (postgresql_buffer__sync__written_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_buffer__sync__written_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_SYNC_WRITTEN(arg1) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE1(postgresql,buffer__sync__written,arg1)</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >/* TRACE_POSTGRESQL_BUFFER_SYNC_DONE ( int, int, int) */</font></div><div style="line-height: 28px;"   ><font size="2"   >#if defined STAP_SDT_V1</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_SYNC_DONE_ENABLED() __builtin_expect (buffer__sync__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#define postgresql_buffer__sync__done_semaphore buffer__sync__done_semaphore</font></div><div style="line-height: 28px;"   ><font size="2"   >#else</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_SYNC_DONE_ENABLED() __builtin_expect (postgresql_buffer__sync__done_semaphore, 0)</font></div><div style="line-height: 28px;"   ><font size="2"   >#endif</font></div><div style="line-height: 28px;"   ><font size="2"   >__extension__ extern unsigned short postgresql_buffer__sync__done_semaphore __attribute__ ((unused)) __attribute__ ((section (".probes")));</font></div><div style="line-height: 28px;"   ><font size="2"   >#define TRACE_POSTGRESQL_BUFFER_SYNC_DONE(arg1,arg2,arg3) \</font></div><div style="line-height: 28px;"   ><font size="2"   >DTRACE_PROBE3(postgresql,buffer__sync__done,arg1,arg2,arg3)</font></div></div><p></p></pre></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><br></div></div></div></div>
	</div>
</div>
</body>
</html>