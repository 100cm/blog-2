<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Postgres-XC table inherits use caveat</h2>
	<h5 id="">2013-04-10 12:48:24&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201331001855771/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">上一篇blog介绍了Postgres-XC 1.1 devel版本对limit的改进, 可以将limit 限制forward到datanode节点.<div>但是这种forward仅限于没有子表的查询. 如果有子表的话, 将会收集本表以及所有子表的数据到coordiantor节点, 然后在结果集上做limit.</div><div>同样很有可能造成coordinator节点崩溃.</div><div>例如 :&nbsp;</div><div>接上一个例子的环境 :&nbsp;</div><div><a href="http://blog.163.com/digoal@126/blog/static/16387704020133108138729/"   >http://blog.163.com/digoal@126/blog/static/16387704020133108138729/</a></div><div>一, 1.1devel :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[pgxc@db-192-168-122-172 ~]$ psql</font></div><div><font size="2"   >psql (PGXC 1.1devel, based on PG 9.2beta2)</font></div><div><font size="2"   >Type "help" for help.</font></div></div><div><div><font size="2"   >postgres=# create table test1 (like test including all) inherits(test) distribute by hash(id) to group gp0;</font></div><div><font size="2"   >NOTICE: &nbsp;merging column "id" with inherited definition</font></div><div><font size="2"   >NOTICE: &nbsp;merging column "info" with inherited definition</font></div><div><font size="2"   >NOTICE: &nbsp;merging column "crt_time" with inherited definition</font></div><div><font size="2"   >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "test1_pkey" for table "test1"</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >postgres=# insert into test1 select * from only test;</font></div><div><font size="2"   >INSERT 0 10000</font></div></div><p></p></pre></div><div>#在父表上使用limit, 无法forward limit到所有子表, 而是选择将所有数据收集到coordinator节点. not good.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# explain analyze verbose select * from test limit 1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >-------------</font></div><div><font size="2"   >&nbsp;Limit &nbsp;(cost=0.00..0.00 rows=1 width=44) (actual time=4.991..5.007 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: public.test.id, public.test.info, public.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Result &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=4.948..4.948 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: public.test.id, public.test.info, public.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=4.945..4.945 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test "_REMOTE_TABLE_QUERY_" &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=4.943..4.943 row</font></div><div><font size="2"   >s=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: public.test.id, public.test.info, public.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test WHERE true</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test1 "_REMOTE_TABLE_QUERY_" &nbsp;(cost=0.00..0.00 rows=1000 width=44) (never executed)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: public.test.id, public.test.info, public.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test1 test WHERE true</font></div><div><font size="2"   >&nbsp;Total runtime: 19.123 ms</font></div><div><font size="2"   >(14 rows)</font></div><p></p></pre></div><div># 加上only后, 只涉及父表本身的查询, limit会forward到datanode节点执行. good.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# explain analyze verbose select * from only test limit 1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Limit &nbsp;(cost=0.00..0.00 rows=1 width=44) (actual time=1.817..1.818 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: test.id, test.info, test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on "__REMOTE_LIMIT_QUERY__" &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=1.812..1.812 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: test.id, test.info, test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test WHERE true LIMIT 1::bigint</font></div><div><font size="2"   >&nbsp;Total runtime: 1.860 ms</font></div><div><font size="2"   >(7 rows)</font></div><p></p></pre></div><div># 直接查询没有子表的表,&nbsp;<span style="line-height: 22px;"   >limit会forward到datanode节点执行. good.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# explain analyze verbose select * from test1 limit 1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Limit &nbsp;(cost=0.00..0.00 rows=1 width=44) (actual time=1.359..1.360 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: test1.id, test1.info, test1.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on "__REMOTE_LIMIT_QUERY__" &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=1.355..1.355 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: test1.id, test1.info, test1.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test1 WHERE true LIMIT 1::bigint</font></div><div><font size="2"   >&nbsp;Total runtime: 1.411 ms</font></div><div><font size="2"   >(7 rows)</font></div><p></p></pre></div><div><br></div><div>group by, 聚合 :&nbsp;</div><div># 在父表上执行聚合函数, 会<span style="line-height: 22px;"   >将所有数据收集到coordinator节点. 然后在coordinator节点执行聚合. not good.</span></div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# explain analyze verbose select count(*) from test;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------</font></div><div><font size="2"   >&nbsp;Aggregate &nbsp;(cost=5.00..5.01 rows=1 width=0) (actual time=170.892..170.893 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: count(*)</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..0.00 rows=2000 width=0) (actual time=3.378..149.182 rows=20000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test "_REMOTE_TABLE_QUERY_" &nbsp;(cost=0.00..0.00 rows=1000 width=0) (actual time=3.376..74.922 rows=1000</font></div><div><font size="2"   >0 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT * FROM ONLY test WHERE true</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test1 "_REMOTE_TABLE_QUERY_" &nbsp;(cost=0.00..0.00 rows=1000 width=0) (actual time=1.674..37.833 rows=100</font></div><div><font size="2"   >00 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT * FROM ONLY test1 test WHERE true</font></div><div><font size="2"   >&nbsp;Total runtime: 172.398 ms</font></div><div><font size="2"   >(10 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# explain analyze verbose select id,count(*) from test group by id;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------</font></div><div><font size="2"   >&nbsp;HashAggregate &nbsp;(cost=10.00..10.20 rows=20 width=4) (actual time=75.885..83.446 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: public.test.id, count(*)</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..0.00 rows=2000 width=4) (actual time=1.736..53.459 rows=20000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test "_REMOTE_TABLE_QUERY_" &nbsp;(cost=0.00..0.00 rows=1000 width=4) (actual time=1.735..15.704 rows=1000</font></div><div><font size="2"   >0 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: public.test.id</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id FROM ONLY test WHERE true</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test1 "_REMOTE_TABLE_QUERY_" &nbsp;(cost=0.00..0.00 rows=1000 width=4) (actual time=1.046..15.357 rows=100</font></div><div><font size="2"   >00 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: public.test.id</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id FROM ONLY test1 test WHERE true</font></div><div><font size="2"   >&nbsp;Total runtime: 89.316 ms</font></div><div><font size="2"   >(12 rows)</font></div><p></p></pre></div><div><span style="line-height: 22px;"   ># 在父表加上only后, 执行聚合函数, 聚合函数将forward到子节点执行,</span><span style="line-height: 22px;"   >&nbsp;然后在coordinator节点计算聚合后的数据. good.</span></div><div><span style="line-height: 22px;"   ># 如果group by的不是分布列, 那么在coordinator节点还需要对datanode节点聚合后的数据再次聚合.&nbsp;</span></div><div><span style="line-height: 22px;"   ># 例如这里的test表的分布列为id, 当group by info时需要</span><span style="line-height: 22px;"   >对datanode节点聚合后的数据再次聚合.&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres=# explain analyze verbose select id,count(*) from only test group by id;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Data Node Scan on "__REMOTE_FQS_QUERY__" &nbsp;(cost=0.00..0.00 rows=0 width=0) (actual time=3.309..17.280 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: test.id, (count(*))</font></div><div><font size="2"   >&nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp;Remote query: SELECT id, count(*) AS count FROM ONLY test GROUP BY id</font></div><div><font size="2"   >&nbsp;Total runtime: 23.205 ms</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# explain analyze verbose select count(*) from only test;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >---------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Aggregate &nbsp;(cost=2.50..2.51 rows=1 width=0) (actual time=2.096..2.096 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: pg_catalog.count(*)</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on "__REMOTE_GROUP_QUERY__" &nbsp;(cost=0.00..0.00 rows=1000 width=0) (actual time=2.053..2.062 rows=6 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: (count(*))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT count(*) FROM ONLY test WHERE true</font></div><div><font size="2"   >&nbsp;Total runtime: 2.153 ms</font></div><div><font size="2"   >(7 rows)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >postgres=# explain analyze verbose select id,avg(hashtext(info)) from only test group by id;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Data Node Scan on "__REMOTE_FQS_QUERY__" &nbsp;(cost=0.00..0.00 rows=0 width=0) (actual time=9.025..29.709 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: test.id, (avg(hashtext(test.info)))</font></div><div><font size="2"   >&nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp;Remote query: SELECT id, pg_catalog.int8_avg(avg(hashtext(info))) AS avg FROM ONLY test GROUP BY id</font></div><div><font size="2"   >&nbsp;Total runtime: 35.809 ms</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# explain analyze verbose select info,avg(id) from only test group by info;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >---</font></div><div><font size="2"   >&nbsp;HashAggregate &nbsp;(cost=5.00..5.12 rows=10 width=36) (actual time=58.321..75.511 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: test.info, pg_catalog.avg((avg(test.id)))</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on "__REMOTE_GROUP_QUERY__" &nbsp;(cost=0.00..0.00 rows=1000 width=36) (actual time=3.433..39.408 rows=10000 loops=</font></div><div><font size="2"   >1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: test.info, (avg(test.id))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT info, avg(id) FROM ONLY test WHERE true GROUP BY 1</font></div><div><font size="2"   >&nbsp;Total runtime: 98.433 ms</font></div><div><font size="2"   >(7 rows)</font></div></div><p></p></pre></div></div><div><br></div><div>where条件 :&nbsp;</div><div># 在父表上执行SQL中包含where条件时, 可以forward到datanode节点. good.</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >postgres=# explain analyze verbose select * from test where id=1;</font></span></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >--------</font></div><div><font size="2"   >&nbsp;Result &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=3.211..4.404 rows=2 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: public.test.id, public.test.info, public.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=3.208..4.398 rows=2 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test "_REMOTE_TABLE_QUERY_" &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=3.206..3.207 rows=1 lo</font></div><div><font size="2"   >ops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: public.test.id, public.test.info, public.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_3</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test WHERE (id = 1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test1 "_REMOTE_TABLE_QUERY_" &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=1.181..1.183 rows=1 l</font></div><div><font size="2"   >oops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: public.test.id, public.test.info, public.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_3</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test1 test WHERE (id = 1)</font></div><div><font size="2"   >&nbsp;Total runtime: 4.449 ms</font></div><div><font size="2"   >(12 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# explain analyze verbose select * from test where info='abc';</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >--------</font></div><div><font size="2"   >&nbsp;Result &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=5.822..5.822 rows=0 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: public.test.id, public.test.info, public.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=5.819..5.819 rows=0 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test "_REMOTE_TABLE_QUERY_" &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=3.811..3.811 rows=0 lo</font></div><div><font size="2"   >ops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: public.test.id, public.test.info, public.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test WHERE (info = 'abc'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test1 "_REMOTE_TABLE_QUERY_" &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=2.005..2.005 rows=0 l</font></div><div><font size="2"   >oops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: public.test.id, public.test.info, public.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test1 test WHERE (info = 'abc'::text)</font></div><div><font size="2"   >&nbsp;Total runtime: 5.863 ms</font></div><div><font size="2"   >(12 rows)</font></div></div><p></p></pre></div><div><br></div><div>二, 1.0.2 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[postgres@db-172-16-19-13 ~]$ psql</font></div><div><font size="2"   >psql (PGXC 1.0.2, based on PG 9.1.7)</font></div><div><font size="2"   >Type "help" for help.</font></div></div><div><div><font size="2"   >digoal=&gt; create table test1(like test including all) inherits(test) distribute by hash(id) to group gp0;</font></div><div><font size="2"   >NOTICE: &nbsp;merging column "id" with inherited definition</font></div><div><font size="2"   >NOTICE: &nbsp;merging column "info" with inherited definition</font></div><div><font size="2"   >NOTICE: &nbsp;merging column "crt_time" with inherited definition</font></div><div><font size="2"   >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "test1_pkey" for table "test1"</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=&gt; insert into test1 select * from only test;</font></div><div><font size="2"   >INSERT 0 10000</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"   >#在父表上使用limit, 无法forward limit到所有子表, 而是选择将所有数据收集到coordinator节点. not good.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; explain analyze verbose select * from test limit 1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Limit &nbsp;(cost=0.00..0.00 rows=1 width=44) (actual time=0.934..0.935 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: digoal.test.id, digoal.test.info, digoal.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Result &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=0.933..0.933 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: digoal.test.id, digoal.test.info, digoal.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=0.931..0.931 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=0.931..0.931 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: digoal.test.id, digoal.test.info, digoal.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test WHERE true</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=44) (never executed)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: digoal.test.id, digoal.test.info, digoal.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test1 test WHERE true</font></div><div><font size="2"   >&nbsp;Total runtime: 11.654 ms</font></div><div><font size="2"   >(14 rows)</font></div><p></p></pre></div><div><span style="line-height: 22px;"   ># 加上only后, 只涉及父表本身的查询, 1.1devel 的话limit会forward到datanode节点执行. 但是1.0.2版本不会. 所以1.0.2 这里not good.</span></div><div><span style="line-height: 22px;"   ># 对于1.0.2 可以选择使用 execute direct on datanode_1 $$</span><span style="line-height: 22px;"   >select * from only test limit 1</span><span style="line-height: 22px;"   >$$;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; explain analyze verbose select * from only test limit 1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Limit &nbsp;(cost=0.00..0.00 rows=1 width=44) (actual time=0.870..0.870 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Result &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=0.869..0.869 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=0.868..0.868 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test WHERE true</font></div><div><font size="2"   >&nbsp;Total runtime: 12.637 ms</font></div><div><font size="2"   >(9 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; explain analyze verbose select * from test1 limit 1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >---------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Limit &nbsp;(cost=0.00..0.00 rows=1 width=44) (actual time=0.801..0.802 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Result &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=0.800..0.800 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test1 &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=0.799..0.799 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test1 WHERE true</font></div><div><font size="2"   >&nbsp;Total runtime: 12.472 ms</font></div><div><font size="2"   >(9 rows)</font></div><p></p></pre></div><div><br></div><div>group by, 聚合 :&nbsp;</div><div><span style="line-height: 22px;"   ># 在父表上执行聚合函数, 会</span><span style="line-height: 22px;"   >将所有数据收集到coordinator节点. 然后在coordinator节点执行聚合. not good.</span></div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; explain analyze verbose select count(*) from test;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Aggregate &nbsp;(cost=5.00..5.01 rows=1 width=0) (actual time=49.958..49.958 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: count(*)</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..0.00 rows=2000 width=0) (actual time=0.702..46.892 rows=20000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=0) (actual time=0.702..22.739 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT * FROM ONLY test WHERE true</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=0) (actual time=0.727..20.450 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT * FROM ONLY test1 test WHERE true</font></div><div><font size="2"   >&nbsp;Total runtime: 50.465 ms</font></div><div><font size="2"   >(10 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; explain analyze verbose select id,count(*) from test group by id;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >-----------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;HashAggregate &nbsp;(cost=10.00..10.02 rows=2 width=4) (actual time=29.463..31.808 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: digoal.test.id, count(*)</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..0.00 rows=2000 width=4) (actual time=0.744..19.747 rows=20000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=4) (actual time=0.743..8.637 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: digoal.test.id</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id FROM ONLY test WHERE true</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=4) (actual time=0.594..7.087 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: digoal.test.id</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id FROM ONLY test1 test WHERE true</font></div><div><font size="2"   >&nbsp;Total runtime: 32.980 ms</font></div><div><font size="2"   >(12 rows)</font></div><p></p></pre></div><div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   ># 在父表加上only后, 执行聚合函数, 聚合函数将forward到子节点执行,</span><span style="line-height: 22px;"   >&nbsp;然后在coordinator节点计算聚合后的数据. good.</span></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   ># 如果group by的不是分布列, 那么在coordinator节点还需要对datanode节点聚合后的数据再次聚合.&nbsp;</span></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   ># 例如这里的test表的分布列为id, 当group by info时需要</span><span style="line-height: 22px;"   >对datanode节点聚合后的数据再次聚合.&nbsp;</span></div></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=&gt; explain analyze verbose select id,count(*) from only test group by id;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >--------</font></div><div><font size="2"   >&nbsp;HashAggregate &nbsp;(cost=5.00..5.01 rows=1 width=4) (actual time=26.008..28.199 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: test.id, pg_catalog.count(*)</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Materialize &nbsp;(cost=0.00..0.00 rows=0 width=0) (actual time=1.929..12.927 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: test.id, (count(*))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on "__REMOTE_GROUP_QUERY__" &nbsp;(cost=0.00..0.00 rows=1000 width=4) (actual time=1.929..10.610 rows=10000 l</font></div><div><font size="2"   >oops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: test.id, count(*)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT group_1.id, count(*) &nbsp;FROM (SELECT id, info, crt_time FROM ONLY test WHERE true) group_1 GROUP B</font></div><div><font size="2"   >Y 1 &nbsp;</font></div><div><font size="2"   >&nbsp;Total runtime: 29.236 ms</font></div><div><font size="2"   >(9 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; explain analyze verbose select count(*) from only test;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >---</font></div><div><font size="2"   >&nbsp;Aggregate &nbsp;(cost=2.50..2.51 rows=1 width=0) (actual time=0.845..0.846 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: pg_catalog.count(*)</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Materialize &nbsp;(cost=0.00..0.00 rows=0 width=0) (actual time=0.821..0.831 rows=5 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: (count(*))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on "__REMOTE_GROUP_QUERY__" &nbsp;(cost=0.00..0.00 rows=1000 width=0) (actual time=0.820..0.830 rows=5 loops=</font></div><div><font size="2"   >1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: count(*)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT count(*) &nbsp;FROM (SELECT id, info, crt_time FROM ONLY test WHERE true) group_1 &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;Total runtime: 0.879 ms</font></div><div><font size="2"   >(9 rows)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=&gt; explain analyze verbose select id,avg(hashtext(info)) from only test group by id;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >-------------------------</font></div><div><font size="2"   >&nbsp;HashAggregate &nbsp;(cost=7.50..7.51 rows=1 width=36) (actual time=61.675..70.284 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: test.id, pg_catalog.avg((avg(hashtext(test.info))))</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Materialize &nbsp;(cost=0.00..0.00 rows=0 width=0) (actual time=9.465..52.209 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: test.id, (avg(hashtext(test.info)))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on "__REMOTE_GROUP_QUERY__" &nbsp;(cost=0.00..0.00 rows=1000 width=36) (actual time=9.464..49.767 rows=10000&nbsp;</font></div><div><font size="2"   >loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: test.id, avg(hashtext(test.info))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT group_1.id, avg(hashtext(group_1.info)) &nbsp;FROM (SELECT id, info, crt_time FROM ONLY test WHERE tr</font></div><div><font size="2"   >ue) group_1 GROUP BY 1 &nbsp;</font></div><div><font size="2"   >&nbsp;Total runtime: 72.024 ms</font></div><div><font size="2"   >(9 rows)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >digoal=&gt; explain analyze verbose select info,avg(id) from only test group by info;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >---------------</font></div><div><font size="2"   >&nbsp;HashAggregate &nbsp;(cost=5.00..5.01 rows=1 width=36) (actual time=36.358..45.066 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: test.info, pg_catalog.avg((avg(test.id)))</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Materialize &nbsp;(cost=0.00..0.00 rows=0 width=0) (actual time=2.751..26.584 rows=10000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: test.info, (avg(test.id))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on "__REMOTE_GROUP_QUERY__" &nbsp;(cost=0.00..0.00 rows=1000 width=36) (actual time=2.749..24.266 rows=10000&nbsp;</font></div><div><font size="2"   >loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: test.info, avg(test.id)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT group_1.info, avg(group_1.id) &nbsp;FROM (SELECT id, info, crt_time FROM ONLY test WHERE true) group_</font></div><div><font size="2"   >1 GROUP BY 1 &nbsp;</font></div><div><font size="2"   >&nbsp;Total runtime: 46.274 ms</font></div><div><font size="2"   >(9 rows)</font></div></div><p></p></pre></div></div><div><br></div><div>where条件 :&nbsp;</div><div><span style="line-height: 22px;"   ># 在父表上执行SQL中包含where条件时, 可以forward到datanode节点. good.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; explain analyze verbose select * from test where id=1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Result &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=21.564..21.828 rows=2 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: digoal.test.id, digoal.test.info, digoal.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=21.562..21.822 rows=2 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=21.562..21.562 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: digoal.test.id, digoal.test.info, digoal.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test WHERE (id = 1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=0.260..0.260 rows=1 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: digoal.test.id, digoal.test.info, digoal.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test1 test WHERE (id = 1)</font></div><div><font size="2"   >&nbsp;Total runtime: 21.856 ms</font></div><div><font size="2"   >(12 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; explain analyze verbose select * from test where info='abc';</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Result &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=31.395..31.395 rows=0 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: digoal.test.id, digoal.test.info, digoal.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Append &nbsp;(cost=0.00..0.00 rows=2000 width=44) (actual time=31.395..31.395 rows=0 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=30.584..30.584 rows=0 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: digoal.test.id, digoal.test.info, digoal.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test WHERE (info = 'abc'::text)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Data Node Scan on test &nbsp;(cost=0.00..0.00 rows=1000 width=44) (actual time=0.809..0.809 rows=0 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: digoal.test.id, digoal.test.info, digoal.test.crt_time</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Node/s: datanode_1, datanode_2, datanode_3, datanode_4, datanode_5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote query: SELECT id, info, crt_time FROM ONLY test1 test WHERE (info = 'abc'::text)</font></div><div><font size="2"   >&nbsp;Total runtime: 31.423 ms</font></div><div><font size="2"   >(12 rows)</font></div><p></p></pre></div><div><br></div><div>[小结]</div><div>1. 不要在父表上使用limit. 因为目前的Postgres-XC版本, 在父表上使用limit将导致查询所有数据汇总到coordinator后limit.</div><div>2. 不要在父表上使用聚合函数, 理由同上.</div><div>3. 1.0.2 的版本不要使用limit , 如果要使用, 请加上execute direct on datanode $$sql$$;</div><div><br><wbr></div></div>
	</div>
</div>
</body>
</html>