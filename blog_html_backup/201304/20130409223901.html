<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Postgre-XC ERROR:  XX000: attempted to delete invisible tuple</h2>
	<h5 id="">2013-04-09 22:39:01&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013399523595/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   >Postgres-XC的gtm模块主要用于提供全局的函数, 序列等.</span><wbr style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >同时还提供统一分配的xid管理, 事务状态信息的管理.</div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><div style="line-height: 25px;"   >以前写过两篇关于PostgreSQL xid模拟数据"消失", 以及flashback query的文章. 原理可以参照此文 :&nbsp;</div><div style="line-height: 25px;"   ><a style="line-height: 25px; text-decoration: none;" href="http://blog.163.com/digoal@126/blog/static/163877040201183043153622/"   ><font color="#000000"   >http://blog.163.com/digoal@126/blog/static/163877040201183043153622/</font></a></div><div style="line-height: 25px;"   ><a style="line-height: 25px; text-decoration: none;" href="http://blog.163.com/digoal@126/blog/static/163877040201251911813661/"   ><font color="#000000"   >http://blog.163.com/digoal@126/blog/static/163877040201251911813661/</font></a></div></div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><br></div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >Postgres-XC与单节点的PostgreSQL数据库原理类似, 只是将xid的snapshot以及提交状态交给GTM来管理了.</div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >当节点(datanode or coordinator)申请的gxid小于gtm节点当前的gtid时, 会报xid非法的错误, 例如 :&nbsp;</div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><pre class="prettyprint"   style="line-height: 25px;"   ><p style="line-height: 25px; margin-bottom: 10px;"   ></p><div style="line-height: 25px;"   ><font size="2"   style="line-height: 21px;"   ><span style="line-height: 21px;"   >2013</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >04</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >05</span><span style="line-height: 21px;"   > </span><span style="line-height: 21px;"   >21</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >41</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >19.091</span><span style="line-height: 21px;"   > CST</span><span style="line-height: 21px;"   >,,,</span><span style="line-height: 21px;"   >4146</span><span style="line-height: 21px;"   >,,</span><span style="line-height: 21px;"   >515ed20f</span><span style="line-height: 21px;"   >.</span><span style="line-height: 21px;"   >1032</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >241</span><span style="line-height: 21px;"   >,,</span><span style="line-height: 21px;"   >2013</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >04</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >05</span><span style="line-height: 21px;"   > </span><span style="line-height: 21px;"   >21</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >30</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >55</span><span style="line-height: 21px;"   > CST</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >1</span><span style="line-height: 21px;"   >/</span><span style="line-height: 21px;"   >31</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >0</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >WARNING</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >01000</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >"Xid is invalid."</span><span style="line-height: 21px;"   >,,,,,,,,</span><span style="line-height: 21px;"   >"GetNewTransactionId, varsup.c:158"</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >""</span></font></div><div style="line-height: 25px;"   ><font size="2"   style="line-height: 21px;"   ><span style="line-height: 21px;"   >2013</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >04</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >05</span><span style="line-height: 21px;"   > </span><span style="line-height: 21px;"   >21</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >41</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >19.091</span><span style="line-height: 21px;"   > CST</span><span style="line-height: 21px;"   >,,,</span><span style="line-height: 21px;"   >4146</span><span style="line-height: 21px;"   >,,</span><span style="line-height: 21px;"   >515ed20f</span><span style="line-height: 21px;"   >.</span><span style="line-height: 21px;"   >1032</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >242</span><span style="line-height: 21px;"   >,,</span><span style="line-height: 21px;"   >2013</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >04</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >05</span><span style="line-height: 21px;"   > </span><span style="line-height: 21px;"   >21</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >30</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >55</span><span style="line-height: 21px;"   > CST</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >1</span><span style="line-height: 21px;"   >/</span><span style="line-height: 21px;"   >31</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >0</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >WARNING</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >08000</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >"can not connect to GTM: Connection refused"</span><span style="line-height: 21px;"   >,,,,,,,,</span><span style="line-height: 21px;"   >"InitGTM, gtm.c:94"</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >""</span></font></div><div style="line-height: 25px;"   ><font size="2"   style="line-height: 21px;"   ><span style="line-height: 21px;"   >2013</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >04</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >05</span><span style="line-height: 21px;"   > </span><span style="line-height: 21px;"   >21</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >41</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >19.092</span><span style="line-height: 21px;"   > CST</span><span style="line-height: 21px;"   >,,,</span><span style="line-height: 21px;"   >4146</span><span style="line-height: 21px;"   >,,</span><span style="line-height: 21px;"   >515ed20f</span><span style="line-height: 21px;"   >.</span><span style="line-height: 21px;"   >1032</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >243</span><span style="line-height: 21px;"   >,,</span><span style="line-height: 21px;"   >2013</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >04</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >05</span><span style="line-height: 21px;"   > </span><span style="line-height: 21px;"   >21</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >30</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >55</span><span style="line-height: 21px;"   > CST</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >1</span><span style="line-height: 21px;"   >/</span><span style="line-height: 21px;"   >31</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >0</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >WARNING</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >08000</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >"can not connect to GTM: Connection refused"</span><span style="line-height: 21px;"   >,,,,,,,,</span><span style="line-height: 21px;"   >"InitGTM, gtm.c:94"</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >""</span></font></div><div style="line-height: 25px;"   ><font size="2"   style="line-height: 21px;"   ><span style="line-height: 21px;"   >2013</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >04</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >05</span><span style="line-height: 21px;"   > </span><span style="line-height: 21px;"   >21</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >41</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >19.092</span><span style="line-height: 21px;"   > CST</span><span style="line-height: 21px;"   >,,,</span><span style="line-height: 21px;"   >4146</span><span style="line-height: 21px;"   >,,</span><span style="line-height: 21px;"   >515ed20f</span><span style="line-height: 21px;"   >.</span><span style="line-height: 21px;"   >1032</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >244</span><span style="line-height: 21px;"   >,,</span><span style="line-height: 21px;"   >2013</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >04</span><span style="line-height: 21px;"   >-</span><span style="line-height: 21px;"   >05</span><span style="line-height: 21px;"   > </span><span style="line-height: 21px;"   >21</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >30</span><span style="line-height: 21px;"   >:</span><span style="line-height: 21px;"   >55</span><span style="line-height: 21px;"   > CST</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >1</span><span style="line-height: 21px;"   >/</span><span style="line-height: 21px;"   >31</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >0</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >ERROR</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >08006</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >"GTM error, could not obtain snapshot"</span><span style="line-height: 21px;"   >,,,,,,,,</span><span style="line-height: 21px;"   >"GetSnapshotDataCoordinator, procarray.c:2836"</span><span style="line-height: 21px;"   >,</span><span style="line-height: 21px;"   >""</span></font></div><p style="line-height: 25px; margin-bottom: 10px;"   ></p></pre></div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >当发生以上错误的同时, 可能会出现某些节点的xid信息比gtm的xid更新的情况, 因此会出现某些数据库对象短暂"消失"的情形.</div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >这种情况下可以通过重启gtm, 并且指定有个更大的xid可以解决.</div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >例如 :&nbsp;</div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><pre class="prettyprint"   ><p><font size="2"   >gtm_ctl -Z gtm start -D /data01/pgxc_gtm -o "-x 200000"</font></p></pre></div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >当然, 除了以上报错, 还可能隐藏更隐晦的错误, 例如表在gxid=10000时创建, 在gxid=10500时写入记录. 然后gtm调到10010, 去删除表.</div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >会报什么错误呢?</div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >在以下环境中进行测试.</div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >gtm : 172.16.122.171</font></div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >coordinator :&nbsp;<span style="line-height: 25px;"   >172.16.122.172</span></font></div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><font size="2"   >datanode :&nbsp;<span style="line-height: 25px;"   >172.16.122.173 -&nbsp;</span><span style="line-height: 25px;"   >172.16.122.178</span></font></div><p></p></pre></div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><span style="line-height: 25px;"   >1. 在coordinator中创建测试表</span></div><div><p></p><div><pre class="prettyprint"   ><p></p><div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >[pgxc@db-192-168-122-172 ~]$ psql</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >psql (PGXC 1.1devel, based on PG 9.2beta2)</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >Type "help" for help.</font></div></div><div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >postgres=# create table user_info (id int primary key, info text);</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "user_info_pkey" for table "user_info"</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >CREATE TABLE</font></div></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   ><div>postgres=# select txid_current();</div><div>&nbsp;txid_current&nbsp;</div><div>--------------</div><div>&nbsp; &nbsp; &nbsp; 1005699</div><div>(1 row)</div></font></div><p></p></pre></div><p></p></div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >2. 通过gtm.log查看当前的gxid :&nbsp;</div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[pgxc@db-192-168-122-171 pgxc_gtm]$ tail -n 10 gtm.log</font></div><div><font size="2"   >1:47746624751936:2013-04-09 22:17:58.745 CST -LOG: &nbsp;Cancelling transaction id 1005698</font></div><div><font size="2"   >LOCATION: &nbsp;ProcessRollbackTransactionCommand, gtm_txn.c:1989</font></div><div><font size="2"   >1:47746624751936:2013-04-09 22:18:03.664 CST -LOG: &nbsp;Assigning new transaction ID = 1005699</font></div><div><font size="2"   >LOCATION: &nbsp;GTM_GetGlobalTransactionIdMulti, gtm_txn.c:581</font></div><div><font size="2"   >1:47746624751936:2013-04-09 22:18:03.664 CST -LOG: &nbsp;Sending transaction id 1005699</font></div><div><font size="2"   >LOCATION: &nbsp;ProcessBeginTransactionGetGXIDCommand, gtm_txn.c:1172</font></div><div><font size="2"   >1:47746624751936:2013-04-09 22:18:03.665 CST -LOG: &nbsp;Received transaction ID 1005699 for snapshot obtention</font></div><div><font size="2"   >LOCATION: &nbsp;ProcessGetSnapshotCommand, gtm_snap.c:307</font></div><div><font size="2"   >1:47746624751936:2013-04-09 22:18:03.667 CST -LOG: &nbsp;Committing transaction id 1005699</font></div><div><font size="2"   >LOCATION: &nbsp;ProcessCommitTransactionCommand, gtm_txn.c:1592</font></div><p></p></pre></div><div>3. 关闭集群</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[pgxc@db-192-168-122-172 ~]$ pg_ctl -Z coordinator stop -m fast -D /data02/pgxc_coordinate</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div><font size="2"   >[pgxc@db-192-168-122-174 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div><font size="2"   >[pgxc@db-192-168-122-175 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div><font size="2"   >[pgxc@db-192-168-122-176 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div><font size="2"   >[pgxc@db-192-168-122-177 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div><font size="2"   >[pgxc@db-192-168-122-178 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div><div><font size="2"   >[pgxc@db-192-168-122-171 pgxc_gtm]$ gtm_ctl -Z gtm stop -m fast -D /data02/pgxc_gtm</font></div><div><font size="2"   >waiting for server to shut down.... done</font></div><div><font size="2"   >server stopped</font></div></div><p></p></pre></div><div>4. 查看集群关闭后的gxid信息</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >1:47746637396288:2013-04-09 22:20:13.264 CST -LOG: &nbsp;Cancelling transaction id 1005710</font></div><div><font size="2"   >....</font></div><div></div><p></p></pre></div><div>5. 启动集群, gxid在原有基础上增加10000, 保证大于结束时的id.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[pgxc@db-192-168-122-171 pgxc_gtm]$ gtm_ctl -Z gtm start -D /data02/pgxc_gtm -o "-x 1015699"</font></div><div><font size="2"   >server starting</font></div></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >[pgxc@db-192-168-122-173 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >[pgxc@db-192-168-122-174 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >[pgxc@db-192-168-122-175 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >[pgxc@db-192-168-122-176 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >[pgxc@db-192-168-122-177 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >[pgxc@db-192-168-122-178 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >[pgxc@db-192-168-122-172 ~]$ pg_ctl -Z coordinator start -D /data02/pgxc_coordinate</font></div><p></p></pre></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   ><br></font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"   >6. 插入测试数据</font></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-172 ~]$ psql</font></span></div><div><font size="2"   >psql (PGXC 1.1devel, based on PG 9.2beta2)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><div><font size="2"   >postgres=# insert into user_info values (1,'digoal');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >postgres=# insert into user_info values (2,'digoal');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >postgres=# insert into user_info values (3,'digoal');</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >postgres=# select txid_current();</font></div><div><font size="2"   >&nbsp;txid_current&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; 1015705</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><br></div><div>7. 关闭数据库集群</div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-172 ~]$ pg_ctl -Z coordinator stop -m fast -D /data02/pgxc_coordinate</font></div><div style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-173 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-174 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-175 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-176 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-177 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-178 ~]$ pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-171 pgxc_gtm]$ gtm_ctl -Z gtm stop -m fast -D /data02/pgxc_gtm</font></div><div style="line-height: 22px;"   ><font size="2"   >waiting for server to shut down.... done</font></div><div style="line-height: 22px;"   ><font size="2"   >server stopped</font></div></div><p></p></pre></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><br></div><div style="line-height: 22px;"   >8. 启动数据库集群, 同时指定gxid为user_info表创建后, 数据插入前的id. 例如&nbsp;<span style="line-height: 22px;"   >1006710</span></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-171 pgxc_gtm]$ gtm_ctl -Z gtm start -D /data02/pgxc_gtm -o "-x&nbsp;<span style="line-height: 22px;"   >1006710</span>"</font></div><div style="line-height: 22px;"   ><font size="2"   >server starting</font></div></div><div style="line-height: 22px;"   ><font face="Arial, Helvetica, simsun, u5b8bu4f53"   style="line-height: 22px;"   size="2"   >[pgxc@db-192-168-122-173 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font face="Arial, Helvetica, simsun, u5b8bu4f53"   style="line-height: 22px;"   size="2"   >[pgxc@db-192-168-122-174 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font face="Arial, Helvetica, simsun, u5b8bu4f53"   style="line-height: 22px;"   size="2"   >[pgxc@db-192-168-122-175 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font face="Arial, Helvetica, simsun, u5b8bu4f53"   style="line-height: 22px;"   size="2"   >[pgxc@db-192-168-122-176 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font face="Arial, Helvetica, simsun, u5b8bu4f53"   style="line-height: 22px;"   size="2"   >[pgxc@db-192-168-122-177 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font face="Arial, Helvetica, simsun, u5b8bu4f53"   style="line-height: 22px;"   size="2"   >[pgxc@db-192-168-122-178 ~]$ pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div style="line-height: 22px;"   ><font face="Arial, Helvetica, simsun, u5b8bu4f53"   style="line-height: 22px;"   size="2"   >[pgxc@db-192-168-122-172 ~]$ pg_ctl -Z coordinator start -D /data02/pgxc_coordinate</font></div><p></p></pre></div></div></div></div></div><div><br></div><div>9. 查询以及删除表测试 :&nbsp;</div><div>因为数据是未来的, 所以查询不到.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select * from user_info;</font></div><div><font size="2"   >&nbsp;id | info&nbsp;</font></div><div><font size="2"   >----+------</font></div><div><font size="2"   >(0 rows)</font></div><div><font size="2"   >postgres=# drop table user_info;</font></div><div><font size="2"   >DROP TABLE</font></div></pre></div><div>如果drop失败, 报错</div><div>ERROR: &nbsp;XX000: attempted to delete invisible tuple</div><div>怎么办呢?, 可以这样试试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >select pgxc_pool_reload();</font></div><div><span style="line-height: 22px;"   ><font size="2"   >trunc table user_info;</font></span></div><div><span style="line-height: 22px;"   ><font size="2"   >drop table user_info;</font></span></div><p></p></pre></div><div style="line-height: 25px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><br></div>[参考]<div>1.&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201183043153622/"   >http://blog.163.com/digoal@126/blog/static/163877040201183043153622/</a><br>2.&nbsp;<wbr><a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/163877040201251911813661/"   >http://blog.163.com/digoal@126/blog/static/163877040201251911813661/</a></div></div>
	</div>
</div>
</body>
</html>