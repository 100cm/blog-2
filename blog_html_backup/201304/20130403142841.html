<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Postgres-XC 1.0.2 install in 8 KVM host enviroment</h2>
	<h5 id="">2013-04-03 14:28:41&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020133292915600/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>[环境 : ]</div><div>主机 : 8核CPU, 98G MEM, OCZ PCI-E SSD硬盘. (Ubuntu desktop 12.04 x64)</div><div>&nbsp; 创建8个虚拟机(CentOS 5.9 x64, 1vCPU, 8GMEM)</div><div>&nbsp; 虚拟机IP地址 : 192.168.122.171 - 192.168.122.178</div><div>虚拟机环境的创建参照:</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201322462042878/"   >http://blog.163.com/digoal@126/blog/static/163877040201322462042878/</a></div><div><br></div><div>虚拟机数据存储使用主机的nfs :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal-PowerEdge-R610:/data03# cat /etc/exports</font></div><div><font size="2"   >/data03/171 &nbsp; &nbsp; 192.168.122.0/24(rw,no_root_squash,sync)</font></div><div><font size="2"   >/data03/172 &nbsp; &nbsp; 192.168.122.0/24(rw,no_root_squash,sync)</font></div><div><font size="2"   >/data03/173 &nbsp; &nbsp; 192.168.122.0/24(rw,no_root_squash,sync)</font></div><div><font size="2"   >/data03/174 &nbsp; &nbsp; 192.168.122.0/24(rw,no_root_squash,sync)</font></div><div><font size="2"   >/data03/175 &nbsp; &nbsp; 192.168.122.0/24(rw,no_root_squash,sync)</font></div><div><font size="2"   >/data03/176 &nbsp; &nbsp; 192.168.122.0/24(rw,no_root_squash,sync)</font></div><div><font size="2"   >/data03/177 &nbsp; &nbsp; 192.168.122.0/24(rw,no_root_squash,sync)</font></div><div><font size="2"   >/data03/178 &nbsp; &nbsp; 192.168.122.0/24(rw,no_root_squash,sync)</font></div><p></p></pre></div><div>nfs的使用参照 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201322410101184/"   >http://blog.163.com/digoal@126/blog/static/163877040201322410101184/</a></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >192.168.122.171: /bin/mount -t nfs -o tcp 192.168.122.1:/data03/171 /data02</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.172:</span><span style="line-height: 22px;"   >&nbsp;</span>/bin/mount -t nfs -o tcp 192.168.122.1:/data03/172 /data02</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.173:</span><span style="line-height: 22px;"   >&nbsp;</span>/bin/mount -t nfs -o tcp 192.168.122.1:/data03/173 /data02</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.174:</span><span style="line-height: 22px;"   >&nbsp;</span>/bin/mount -t nfs -o tcp 192.168.122.1:/data03/174 /data02</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.175:</span><span style="line-height: 22px;"   >&nbsp;</span>/bin/mount -t nfs -o tcp 192.168.122.1:/data03/175 /data02</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.176:</span><span style="line-height: 22px;"   >&nbsp;</span>/bin/mount -t nfs -o tcp 192.168.122.1:/data03/176 /data02</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.177:</span><span style="line-height: 22px;"   >&nbsp;</span>/bin/mount -t nfs -o tcp 192.168.122.1:/data03/177 /data02</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.178:</span><span style="line-height: 22px;"   >&nbsp;</span>/bin/mount -t nfs -o tcp 192.168.122.1:/data03/178 /data02</font></div><p></p></pre></div><div><br></div><div>[Postgres-XC组件环境]</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >gtm :&nbsp;</font></div><div><font size="2"   >&nbsp; 192.168.122.171</font></div><div><font size="2"   >&nbsp; $PGDATA: /data02/pgxc_gtm</font></div><div><font size="2"   >&nbsp; $PGPORT: 1921</font></div><div><font size="2"   >gtm_standby :&nbsp;</font></div><div><font size="2"   >&nbsp; 192.168.122.172</font></div><div><font size="2"   >&nbsp; $PGDATA: /data02/pgxc_gtm</font></div><div><span style="line-height: 22px;"   ><font size="2"   >&nbsp; $PGPORT: 1921</font></span></div><div><font size="2"   >gtm_proxy, coordinator, datanode :&nbsp;</font></div><div><font size="2"   >&nbsp; 192.168.122.173 - 192.168.122.178 :&nbsp;</font></div><div><font size="2"   >gtm_proxy: /data02/pgxc_gtm_proxy ,&nbsp;<span style="line-height: 22px;"   >&nbsp;$PORT: 1924</span></font></div><div><font size="2"   >coordinate: /data02/pgxc_coordinate<span style="line-height: 22px;"   >&nbsp;,&nbsp;</span><span style="line-height: 22px;"   >&nbsp;$PGPORT: 1921</span><span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >, pooler_manager_port: 1922</span></font></div><div><font size="2"   >datanode: /data02/pgxc_datanode<span style="line-height: 22px;"   >&nbsp;,&nbsp;</span><span style="line-height: 22px;"   >&nbsp;$PGPORT: 1923</span></font></div><p></p></pre></div><div><span style="line-height: 22px;"   ><br></span></div><div><span style="line-height: 22px;"   >[架构如图 : ]</span></div><div><div><div><img title="Postgres-XC 1.0.2 install in 8 KVM host enviroment - 德哥@Digoal - The Heart,The World."   alt="Postgres-XC 1.0.2 install in 8 KVM host enviroment - 德哥@Digoal - The Heart,The World."   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/APakRBOY8Dtrm4fFDeZW9g==/1354176112972949175.png"   ></div>&nbsp;</div>&nbsp;</div><div><span style="line-height: 22px;"   >[pg_xc安装参考 : ]</span></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020121952051174/"   >http://blog.163.com/digoal@126/blog/static/16387704020121952051174/</a></div><div><br></div><div>[在所有节点下载Postgres-XC]</div><div><a target="_blank" rel="nofollow" href="http://sourceforge.net/projects/postgres-xc/files/latest/download"   >http://sourceforge.net/projects/postgres-xc/files/latest/download</a></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.171:</span><span style="line-height: 22px;"   >&nbsp;</span>cp&nbsp;pgxc-v1.0.2.tar.gz /data03/171</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.172:</span><span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >cp&nbsp;pgxc-v1.0.2.tar.gz /data03/172</span></font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.173:</span><span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >cp&nbsp;pgxc-v1.0.2.tar.gz /data03/173</span></font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.174:</span><span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >cp&nbsp;pgxc-v1.0.2.tar.gz /data03/174</span></font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.175:</span><span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >cp&nbsp;pgxc-v1.0.2.tar.gz /data03/175</span></font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.176:</span><span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >cp&nbsp;pgxc-v1.0.2.tar.gz /data03/176</span></font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.177:</span><span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >cp&nbsp;pgxc-v1.0.2.tar.gz /data03/177</span></font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.178:</span><span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >cp&nbsp;pgxc-v1.0.2.tar.gz /data03/178</span></font></div><p></p></pre></div><div><br></div><div>[虚拟机操作系统用户及目录配置 : ]</div><div>gtm以及gtm_standby节点配置 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-192-168-122-171 ~]# useradd pgxc</font></div><div><font size="2"   >[root@db-192-168-122-171 ~]# mkdir /data02/pgxc_gtm</font></div><div><font size="2"   >[root@db-192-168-122-171 ~]# chown -R pgxc:pgxc /data02/pgxc_gtm</font></div></div><div><div style="line-height: 22px;"   ><font size="2"   >[root@db-192-168-122-172 ~]# useradd pgxc</font></div><div style="line-height: 22px;"   ><font size="2"   >[root@db-192-168-122-172 ~]# mkdir /data02/pgxc_gtm</font></div><div style="line-height: 22px;"   ><font size="2"   >[root@db-192-168-122-172 ~]# chown -R pgxc:pgxc /data02/pgxc_gtm</font></div></div><p></p></pre></div><div style="line-height: 22px;"   ><br></div><div style="line-height: 22px;"   >gtm_proxy, datanode, coordinator节点配置 :&nbsp;</div><div style="line-height: 22px;"   >(192.168.122.173 - 192.168.122.178)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >useradd pgxc</font></div><div><font size="2"   >mkdir /data02/pgxc_gtm_proxy</font></div><div><font size="2"   >mkdir /data02/pgxc_coordinate</font></div><div><font size="2"   >mkdir /data02/pgxc_datanode</font></div><div><font size="2"   >chown -R pgxc:pgxc /data02/*</font></div><p></p></pre></div><div><br></div><div>[所有虚拟机操作系统配置]</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >yum -y install lrzsz sysstat e4fsprogs ntp readline-devel zlib zlib-devel openssl openssl-devel pam-devel libxml2-devel libxslt-devel python-devel tcl-devel</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >crontab -e</font></div><div><font size="2"   >&nbsp; -- 8 * * * * /usr/sbin/ntpdate asia.pool.ntp.org &amp;&amp; /sbin/hwclock --systohc</font></div><div><font size="2"   >/usr/sbin/ntpdate asia.pool.ntp.org &amp;&amp; /sbin/hwclock --systohc</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi /etc/sysconfig/clock&nbsp;</font></div><div><font size="2"   >&nbsp; -- ZONE="Asia/Shanghai"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;UTC=false</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;ARC=false</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >rm /etc/localtime&nbsp;</font></div><div><font size="2"   >cp /usr/share/zoneinfo/PRC /etc/localtime</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi /etc/sysconfig/i18n</font></div><div><font size="2"   >&nbsp; -- LANG="en_US.UTF-8"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >chkconfig acpid off</font></div><div><font size="2"   >chkconfig avahi-daemon off</font></div><div><font size="2"   >chkconfig bluetooth off</font></div><div><font size="2"   >chkconfig hidd off</font></div><div><font size="2"   >chkconfig smartd off</font></div><div><font size="2"   >chkconfig yum-updatesd off</font></div><div><font size="2"   >chkconfig hplip off</font></div><div><font size="2"   >chkconfig isdn off</font></div><div><font size="2"   >chkconfig iscsi off</font></div><div><font size="2"   >chkconfig iscsid off</font></div><div><font size="2"   >chkconfig multipathd on</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi /etc/sysctl.conf</font></div><div><div><font size="2"   ># Controls the maximum size of a message, in bytes</font></div><div><font size="2"   >kernel.msgmnb = 65536</font></div><div><font size="2"   ># Controls the default maxmimum size of a mesage queue</font></div><div><font size="2"   >kernel.msgmax = 65536</font></div><div><font size="2"   ># Controls the maximum shared segment size, in bytes</font></div><div><font size="2"   >kernel.shmmax = 68719476736</font></div><div><font size="2"   ># Controls the maximum number of shared memory segments, in pages</font></div><div><font size="2"   >kernel.shmall = 4294967296</font></div><div><font size="2"   >kernel.shmmni = 4096</font></div><div><font size="2"   >kernel.sem = 50100 64128000 50100 1280</font></div><div><font size="2"   >fs.file-max = 7672460</font></div><div><font size="2"   >net.ipv4.ip_local_port_range = 9000 65000</font></div><div><font size="2"   >net.core.rmem_default = 1048576</font></div><div><font size="2"   >net.core.rmem_max = 4194304</font></div><div><font size="2"   >net.core.wmem_default = 262144</font></div><div><font size="2"   >net.core.wmem_max = 1048576</font></div><div><font size="2"   >net.ipv4.tcp_tw_recycle = 1</font></div><div><font size="2"   >net.ipv4.tcp_max_syn_backlog = 4096</font></div><div><font size="2"   >net.core.netdev_max_backlog = 10000</font></div><div><font size="2"   >vm.overcommit_memory = 0</font></div><div><font size="2"   >net.ipv4.ip_conntrack_max = 655360</font></div><div><font size="2"   >fs.aio-max-nr = 1048576</font></div><div><font size="2"   >net.ipv4.tcp_timestamps = 0</font></div></div><div><font size="2"   >sysctl -p</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi /etc/security/limits.conf</font></div><div><div><font size="2"   >* soft &nbsp; &nbsp;nofile &nbsp;131072</font></div><div><font size="2"   >* hard &nbsp; &nbsp;nofile &nbsp;131072</font></div><div><font size="2"   >* soft &nbsp; &nbsp;nproc &nbsp; 131072</font></div><div><font size="2"   >* hard &nbsp; &nbsp;nproc &nbsp; 131072</font></div><div><font size="2"   >* soft &nbsp; &nbsp;core &nbsp; &nbsp;unlimited</font></div><div><font size="2"   >* hard &nbsp; &nbsp;core &nbsp; &nbsp;unlimited</font></div><div><font size="2"   >* soft &nbsp; &nbsp;memlock 50000000</font></div><div><font size="2"   >* hard &nbsp; &nbsp;memlock 50000000</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi /etc/hosts</font></div><div><font size="2"   >127.0.0.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localhost.localdomain localhost</font></div><div><div><font size="2"   >192.168.122.171 db-192-168-122-171.sky-mobi.com db-192-168-122-171</font></div><div><font size="2"   >192.168.122.172 db-192-168-122-172.sky-mobi.com db-192-168-122-172</font></div><div><font size="2"   >192.168.122.173 db-192-168-122-173.sky-mobi.com db-192-168-122-173</font></div><div><font size="2"   >192.168.122.174 db-192-168-122-174.sky-mobi.com db-192-168-122-174</font></div><div><font size="2"   >192.168.122.175 db-192-168-122-175.sky-mobi.com db-192-168-122-175</font></div><div><font size="2"   >192.168.122.176 db-192-168-122-176.sky-mobi.com db-192-168-122-176</font></div><div><font size="2"   >192.168.122.177 db-192-168-122-177.sky-mobi.com db-192-168-122-177</font></div><div><font size="2"   >192.168.122.178 db-192-168-122-178.sky-mobi.com db-192-168-122-178</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >vi /etc/sysconfig/selinux</font></div><div><font size="2"   >SELINUX=disabled</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi /etc/sysconfig/iptables</font></div><div><div><font size="2"   ># Generated by iptables-save v1.3.5 on Tue Jul &nbsp;3 10:59:01 2012</font></div><div><font size="2"   >*filter</font></div><div><font size="2"   >:INPUT ACCEPT [0:0]</font></div><div><font size="2"   >:FORWARD ACCEPT [0:0]</font></div><div><font size="2"   >:OUTPUT ACCEPT [369:57193]</font></div><div><font size="2"   >:RH-Firewall-1-INPUT - [0:0]</font></div><div><font size="2"   >-A INPUT -j RH-Firewall-1-INPUT&nbsp;</font></div><div><font size="2"   >-A FORWARD -j RH-Firewall-1-INPUT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -s 192.168.0.0/255.255.0.0 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -s 10.0.0.0/255.0.0.0 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -s 172.16.0.0/255.255.0.0 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -i lo -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -p icmp -m icmp --icmp-type any -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -p esp -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -p ah -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -d 224.0.0.251 -p udp -m udp --dport 5353 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -p udp -m udp --dport 631 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -p tcp -m tcp --dport 631 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -p udp -m state --state NEW -m udp --dport 161 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -p udp -m state --state NEW -m udp --dport 162 -j ACCEPT&nbsp;</font></div><div><font size="2"   >-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp-host-prohibited&nbsp;</font></div><div><font size="2"   >COMMIT</font></div><div><font size="2"   ># Completed on Tue Jul &nbsp;3 10:59:01 2012</font></div></div></div><p></p></pre></div><div><br></div><div>[在所有虚拟机安装pgxc软件]</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - root</font></div><div><div><font size="2"   >tar -jxvf flex-2.5.35.tar.bz2</font></div><div><font size="2"   >cd flex-2.5.35</font></div><div><font size="2"   >./configure &amp;&amp; make &amp;&amp; make install</font></div></div><div><span style="line-height: 22px;"   ><font size="2"   >cd /data02/</font></span></div><div><font size="2"   >tar -zxvf&nbsp;pgxc-v1.0.2.tar.gz</font></div><div><div><font size="2"   >cd pgxc-v1.0.2</font></div><div><font size="2"   >./configure --prefix=/opt/pgxc_1.0.2 --with-pgport=1921 --with-perl --with-python --with-tcl --with-openssl --with-pam --without-ldap --with-libxml --with-libxslt --enable-thread-safety --with-wal-blocksize=16 --enable-debug &amp;&amp; gmake world</font></div></div><div><font size="2"   >gmake install-world</font></div><div><font size="2"   >ln -s /opt/<span style="line-height: 22px;"   >pgxc_1.0.2 /opt/pgxc</span></font></div><p></p></pre></div><div><br></div><div>[Postgres-XC各组件配置]</div><div><span style="line-height: 22px;"   >1. gtm (192.168.122.171)</span></div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 22px;"   ><font size="2"   >su - pgxc</font></div><div style="line-height: 22px;"   ><font size="2"   >vi .bash_profile</font></div></div><div><div><font size="2"   >export PGPORT=1921</font></div><div><font size="2"   >export PGDATA=/data02/pgxc_gtm</font></div><div><font size="2"   >export LANG=en_US.utf8</font></div><div><font size="2"   >export PGHOME=/opt/pgxc</font></div><div><font size="2"   >export LD_LIBRARY_PATH=$PGHOME/lib:$PGHOME/lib/postgresql:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib:$LD_LIBRARY_PATH</font></div><div><font size="2"   >export DATE=`date +"%Y%m%d%H%M"`</font></div><div><font size="2"   >export PATH=$PGHOME/bin:$PATH:.</font></div><div><font size="2"   >export MANPATH=$PGHOME/share/man:$MANPATH</font></div><div><font size="2"   >export PGUSER=postgres</font></div><div><font size="2"   >export PGHOST=$PGDATA</font></div><div><font size="2"   >export PGDATABASE=postgres</font></div><div><font size="2"   >alias rm='rm -i'</font></div><div><font size="2"   >alias ll='ls -lh'</font></div></div><p></p></pre></div></div><div><span style="line-height: 22px;"   ><br></span></div><div>2. gtm_standby<span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >(192.168.122.172)</span></div><div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >su - pgxc</font></div><div style="line-height: 22px;"   ><font size="2"   >vi .bash_profile</font></div></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >export PGPORT=1921</font></div><div style="line-height: 22px;"   ><font size="2"   >export PGDATA=/data02/pgxc_gtm</font></div><div style="line-height: 22px;"   ><font size="2"   >export LANG=en_US.utf8</font></div><div style="line-height: 22px;"   ><font size="2"   >export PGHOME=/opt/pgxc</font></div><div style="line-height: 22px;"   ><font size="2"   >export LD_LIBRARY_PATH=$PGHOME/lib:$PGHOME/lib/postgresql:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib:$LD_LIBRARY_PATH</font></div><div style="line-height: 22px;"   ><font size="2"   >export DATE=`date +"%Y%m%d%H%M"`</font></div><div style="line-height: 22px;"   ><font size="2"   >export PATH=$PGHOME/bin:$PATH:.</font></div><div style="line-height: 22px;"   ><font size="2"   >export MANPATH=$PGHOME/share/man:$MANPATH</font></div><div style="line-height: 22px;"   ><font size="2"   >export PGUSER=postgres</font></div><div style="line-height: 22px;"   ><font size="2"   >export PGHOST=$PGDATA</font></div><div style="line-height: 22px;"   ><font size="2"   >export PGDATABASE=postgres</font></div><div style="line-height: 22px;"   ><font size="2"   >alias rm='rm -i'</font></div><div style="line-height: 22px;"   ><font size="2"   >alias ll='ls -lh'</font></div></div><p></p></pre></div></div></div><div><br></div><div><span style="line-height: 22px;"   >3.&nbsp;</span><span style="line-height: 22px;"   >gtm_proxy, coordinate, datanode</span><span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >(192.168.122.173 - 192.168.122.178)</span></div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 22px;"   ><font size="2"   >su - pgxc</font></div><div style="line-height: 22px;"   ><font size="2"   >vi .bash_profile</font></div></div><div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >export LANG=en_US.utf8</font></div><div style="line-height: 22px;"   ><font size="2"   >export PGHOME=/opt/pgxc</font></div><div style="line-height: 22px;"   ><font size="2"   >export LD_LIBRARY_PATH=$PGHOME/lib:$PGHOME/lib/postgresql:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib:$LD_LIBRARY_PATH</font></div><div style="line-height: 22px;"   ><font size="2"   >export DATE=`date +"%Y%m%d%H%M"`</font></div><div style="line-height: 22px;"   ><font size="2"   >export PATH=$PGHOME/bin:$PATH:.</font></div><div style="line-height: 22px;"   ><font size="2"   >export MANPATH=$PGHOME/share/man:$MANPATH</font></div><div style="line-height: 22px;"   ><font size="2"   >export PGUSER=postgres</font></div><div style="line-height: 22px;"   ><font size="2"   >export PGDATABASE=postgres</font></div><div style="line-height: 22px;"   ><font size="2"   >alias rm='rm -i'</font></div><div style="line-height: 22px;"   ><font size="2"   >alias ll='ls -lh'</font></div></div></div><p></p></pre></div></div><div><br></div><div>[初始化Postgres-XC集群]</div><div>1. 初始化datanode (192.168.122.173 - 192.168.122.178)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - pgxc</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.173:&nbsp;</span>initdb -D /data02/pgxc_datanode --nodename=datanode_1 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.174:&nbsp;</span>initdb -D /data02/pgxc_datanode --nodename=datanode_2 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.175:&nbsp;</span>initdb -D /data02/pgxc_datanode --nodename=datanode_3 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.176:&nbsp;</span>initdb -D /data02/pgxc_datanode --nodename=datanode_4 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.177:&nbsp;</span>initdb -D /data02/pgxc_datanode --nodename=datanode_5 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   ><span style="line-height: 22px;"   >192.168.122.178:&nbsp;</span>initdb -D /data02/pgxc_datanode --nodename=datanode_6 -E UTF8 --locale=C -U postgres -W</font></div><p></p></pre></div><div><br></div><div>2. 初始化coordinate&nbsp;<span style="line-height: 22px;"   >(192.168.122.173 - 192.168.122.178)</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >su - pgxc</font></span></div><div><div><font size="2"   >192.168.122.173: initdb -D /data02/pgxc_coordinate --nodename=coordinate_1 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   >192.168.122.174: initdb -D /data02/pgxc_coordinate --nodename=coordinate_2 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   >192.168.122.175: initdb -D /data02/pgxc_coordinate --nodename=coordinate_3 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   >192.168.122.176: initdb -D /data02/pgxc_coordinate --nodename=coordinate_4 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   >192.168.122.177: initdb -D /data02/pgxc_coordinate --nodename=coordinate_5 -E UTF8 --locale=C -U postgres -W</font></div><div><font size="2"   >192.168.122.178: initdb -D /data02/pgxc_coordinate --nodename=coordinate_6 -E UTF8 --locale=C -U postgres -W</font></div></div><p></p></pre></div><div><br></div><div>3. 初始化gtm (192.168.122.171)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - pgxc</font></div><div><font size="2"   >initgtm -Z gtm -D /data02/pgxc_gtm</font></div><div><font size="2"   >cd&nbsp;<span style="line-height: 22px;"   >/data02/pgxc_gtm</span></font></div><div><span style="line-height: 22px;"   ><font size="2"   ><div>[pgxc@db-192-168-122-171 pgxc_gtm]$ ll</div><div>total 4.0K</div><div>-rw------- 1 pgxc pgxc 2.2K Apr &nbsp;2 13:49 gtm.conf</div><div>vi gtm.conf</div><div><div>nodename = 'one'<span style="line-height: 22px;"   >&nbsp;&nbsp;</span><span style="line-height: 22px;"   ># 所有gtm节点nodename唯一.</span></div><div>listen_addresses = '0.0.0.0'</div><div>port = 1921</div><div>startup = ACT</div><div>keepalives_idle = 60</div><div>keepalives_interval = 10</div><div>keepalives_count = 10</div><div>log_file = 'gtm.log'</div><div>log_min_messages = WARNING</div><div>synchronous_backup = on</div></div></font></span></div><p></p></pre></div><div><br></div><div><div style="line-height: 22px;"   >4. 初始化gtm_standby (192.168.122.172)</div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >su - pgxc</font></div><div style="line-height: 22px;"   ><font size="2"   >initgtm -Z gtm -D /data02/pgxc_gtm</font></div><div><div style="line-height: 22px;"   ><font size="2"   >cd&nbsp;<span style="line-height: 22px;"   >/data02/pgxc_gtm</span></font></div><div><div style="line-height: 22px;"   ><font size="2"   >[pgxc@db-192-168-122-171 pgxc_gtm]$ ll</font></div><div style="line-height: 22px;"   ><font size="2"   >total 4.0K</font></div><div style="line-height: 22px;"   ><font size="2"   >-rw------- 1 pgxc pgxc 2.2K Apr &nbsp;2 13:49 gtm.conf</font></div><div style="line-height: 22px;"   ><font size="2"   >vi gtm.conf</font></div><div><div><font size="2"   >nodename = 'two' &nbsp;<span style="line-height: 22px;"   ># 所有gtm节点nodename唯一.</span></font></div><div><font size="2"   >listen_addresses = '0.0.0.0'</font></div><div><font size="2"   >port = 1921</font></div><div><font size="2"   >startup = STANDBY</font></div><div><font size="2"   >active_host = 'db-192-168-122-171'</font></div><div><font size="2"   >active_port = 1921</font></div><div><font size="2"   >keepalives_idle = 60</font></div><div><font size="2"   >keepalives_interval = 10</font></div><div><font size="2"   >keepalives_count = 10</font></div><div><font size="2"   >log_file = 'gtm.log'</font></div><div><font size="2"   >log_min_messages = WARNING</font></div><div><font size="2"   >synchronous_backup = on</font></div></div></div></div><p></p></pre></div></div><div><br></div><div>5. 启动gtm</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - pgxc</font></div><div><div><font size="2"   >[pgxc@db-192-168-122-171 pgxc_gtm]$ gtm_ctl start -Z gtm -D /data02/pgxc_gtm</font></div><div><font size="2"   >server starting</font></div></div><div><div><font size="2"   >[pgxc@db-192-168-122-171 pgxc_gtm]$ gtm_ctl status -Z gtm -D /data02/pgxc_gtm</font></div><div><font size="2"   >gtm_ctl: server is running (PID: 16716)</font></div><div><font size="2"   >&nbsp;"-D" "/data02/pgxc_gtm"</font></div><div><font size="2"   >1 master</font></div></div><p></p></pre></div><div><br></div><div>6. 启动gtm_standby</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - pgxc</font></div><div><div><font size="2"   >[pgxc@db-192-168-122-172 pgxc_gtm]$ gtm_ctl start -Z gtm -D /data02/pgxc_gtm</font></div><div><font size="2"   >server starting</font></div><div><font size="2"   >[pgxc@db-192-168-122-172 pgxc_gtm]$ gtm_ctl status -Z gtm -D /data02/pgxc_gtm</font></div><div><font size="2"   >gtm_ctl: server is running (PID: 16358)</font></div><div><font size="2"   >0 slave</font></div></div><p></p></pre></div><div><br></div><div>7. 初始化gtm_proxy (192.168.122.173 - 192.168.122.178)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - pgxc</font></div><div><font size="2"   >initgtm -Z gtm_proxy -D /data02/pgxc_gtm_proxy</font></div><div><font size="2"   >cd /data02/pgxc_gtm_proxy</font></div><div><font size="2"   >vi&nbsp;gtm_proxy.conf</font></div><div><div><font size="2"   >nodename = '1' &nbsp; # 所有代理节点nodename唯一.(本例为: 1,2,3,4,5,6)</font></div><div><font size="2"   >listen_addresses = '0.0.0.0'</font></div><div><font size="2"   >port = 1924</font></div><div><font size="2"   >worker_threads = 1</font></div><div><font size="2"   >gtm_host = 'db-192-168-122-171'</font></div><div><font size="2"   >gtm_port = 1921</font></div><div><font size="2"   >gtm_connect_retry_idle = 30</font></div><div><font size="2"   >gtm_connect_retry_count = 10</font></div><div><font size="2"   >gtm_connect_retry_interval = 10</font></div><div><font size="2"   >err_wait_idle = 60</font></div><div><font size="2"   >err_wait_count = 10</font></div><div><font size="2"   >err_wait_interval = 10</font></div><div><font size="2"   >keepalives_idle = 60</font></div><div><font size="2"   >keepalives_interval = 10</font></div><div><font size="2"   >keepalives_count = 10</font></div><div><font size="2"   >log_file = 'gtm_proxy.log'</font></div><div><font size="2"   >log_min_messages = WARNING</font></div></div><p></p></pre></div><div>....................... 其他节点配置略</div><div><br></div><div>8. 启动gtm_proxy<span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >(192.168.122.173 - 192.168.122.178)</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >su - pgxc</font></span></div><div><div><font size="2"   >[pgxc@db-192-168-122-173 pgxc_gtm_proxy]$ gtm_ctl start -Z gtm_proxy -D /data02/pgxc_gtm_proxy</font></div><div><font size="2"   >server starting</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 pgxc_gtm_proxy]$ gtm_ctl status -Z gtm_proxy -D /data02/pgxc_gtm_proxy</font></div><div><font size="2"   >gtm_ctl: server is running (PID: 16509)</font></div><div><font size="2"   >&nbsp;"-D" "/data02/pgxc_gtm_proxy"</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"   >....................... 其他节点启动略</span></div><div><br></div><div>9. 配置datanode<span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >(192.168.122.173 - 192.168.122.178)</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - pgxc</font></div><div><font size="2"   >cd /data02/pgxc_datanode</font></div><div><font size="2"   >vi postgresql.conf</font></div><div><div><font size="2"   >listen_addresses = '0.0.0.0'</font></div><div><font size="2"   >port = 1923</font></div><div><font size="2"   >max_connections = 1600 &nbsp; &nbsp; # 与max_prepared_transactions一致, <span style="line-height: 19px;"   >#(datanode的max_connection&gt;=coordinator.max_coordinators*coordinator.max_connection.)</span></font></div><div><font size="2"   >superuser_reserved_connections = 13</font></div><div><font size="2"   >unix_socket_directory = '.'</font></div><div><font size="2"   >unix_socket_permissions = 0700</font></div><div><font size="2"   >tcp_keepalives_idle = 60</font></div><div><font size="2"   >tcp_keepalives_interval = 10</font></div><div><font size="2"   >tcp_keepalives_count = 10</font></div><div><font size="2"   >shared_buffers = 1024MB</font></div><div><font size="2"   >max_prepared_transactions = 1600 &nbsp;# 与max_connections一致</font></div><div><font size="2"   >maintenance_work_mem = 512MB</font></div><div><font size="2"   >max_stack_depth = 8MB</font></div><div><font size="2"   >wal_level = hot_standby</font></div><div><font size="2"   >synchronous_commit = off</font></div><div><font size="2"   >wal_buffers = 16384kB</font></div><div><font size="2"   >wal_writer_delay = 10ms</font></div><div><font size="2"   >checkpoint_segments = 64</font></div><div><font size="2"   >archive_mode = on</font></div><div><font size="2"   >archive_command = '/bin/date'</font></div><div><font size="2"   >max_wal_senders = 32</font></div><div><font size="2"   >wal_sender_delay = 10ms</font></div><div><font size="2"   >wal_keep_segments = 256</font></div><div><font size="2"   >hot_standby = on</font></div><div><font size="2"   >max_standby_archive_delay = 300s</font></div><div><font size="2"   >max_standby_streaming_delay = 300s</font></div><div><font size="2"   >wal_receiver_status_interval = 1s</font></div><div><font size="2"   >hot_standby_feedback = on</font></div><div><font size="2"   >random_page_cost = 1.0</font></div><div><font size="2"   >effective_cache_size = 8192MB</font></div><div><font size="2"   >log_destination = 'csvlog'</font></div><div><font size="2"   >logging_collector = on</font></div><div><font size="2"   >log_directory = 'pg_log'</font></div><div><font size="2"   >log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'</font></div><div><font size="2"   >log_file_mode = 0600</font></div><div><font size="2"   >log_truncate_on_rotation = on</font></div><div><font size="2"   >log_rotation_age = 1d</font></div><div><font size="2"   >log_rotation_size = 10MB</font></div><div><font size="2"   >log_checkpoints = on</font></div><div><font size="2"   >log_connections = on</font></div><div><font size="2"   >log_disconnections = on</font></div><div><font size="2"   >log_error_verbosity = verbose</font></div><div><font size="2"   >log_statement = 'ddl'</font></div><div><font size="2"   >track_activity_query_size = 2048</font></div><div><font size="2"   >log_autovacuum_min_duration = 0</font></div><div><font size="2"   >datestyle = 'iso, mdy'</font></div><div><font size="2"   >lc_messages = 'C'</font></div><div><font size="2"   >lc_monetary = 'C'</font></div><div><font size="2"   >lc_numeric = 'C'</font></div><div><font size="2"   >lc_time = 'C'</font></div><div><font size="2"   >default_text_search_config = 'pg_catalog.english'</font></div><div><font size="2"   >gtm_host = '127.0.0.1'  # 配置为gtm_proxy的地址和端口. 获取gxid,sequence,timestamp等全局信息.</font></div><div><font size="2"   >gtm_port = 1924</font></div><div><font size="2"   >pgxc_node_name = 'datanode_1' &nbsp;# 集群中的每个datanode名字必须唯一. 对应initdb 时指定的值.</font></div><div><font size="2"   >enforce_two_phase_commit = on</font></div><div><font size="2"   >enable_fast_query_shipping = on</font></div><div><font size="2"   >enable_remotejoin = on</font></div><div><font size="2"   >enable_remotegroup = on</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"   >.......................</span><span style="line-height: 22px;"   >&nbsp;其他节点配置略</span></div><div><span style="line-height: 22px;"   >配置pg_hba.conf</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi pg_hba.conf</font></div><div><div><font size="2"   >host all all 192.168.122.173/32 trust</font></div><div><font size="2"   >host all all 192.168.122.174/32 trust</font></div><div><font size="2"   >host all all 192.168.122.175/32 trust</font></div><div><font size="2"   >host all all 192.168.122.176/32 trust</font></div><div><font size="2"   >host all all 192.168.122.177/32 trust</font></div><div><font size="2"   >host all all 192.168.122.178/32 trust</font></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"   >....................... 其他节点配置略</span></div><div><br></div><div>10. 启动datanode<span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >(192.168.122.173 - 192.168.122.178)</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >su - pgxc</font></span></div><div><font size="2"   >pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >....................... 其他节点启动略</span></div><div><br></div><div>11. 配置coordinate<span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >(192.168.122.173 - 192.168.122.178)</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >su - pgxc</font></span></div><div><font size="2"   >cd /data02/pgxc_coordinate/</font></div><div><font size="2"   >vi postgresql.conf</font></div><div><div><font size="2"   >listen_addresses = '0.0.0.0'</font></div><div><font size="2"   >port = 1921</font></div><div><font size="2"   >max_connections = 100</font></div><div><font size="2"   >superuser_reserved_connections = 13</font></div><div><font size="2"   >unix_socket_directory = '.'</font></div><div><font size="2"   >unix_socket_permissions = 0700</font></div><div><font size="2"   >tcp_keepalives_idle = 60</font></div><div><font size="2"   >tcp_keepalives_interval = 10</font></div><div><font size="2"   >tcp_keepalives_count = 10</font></div><div><font size="2"   >shared_buffers = 1024MB</font></div><div><font size="2"   >max_prepared_transactions = 16 &nbsp; &nbsp; &nbsp;# 用作二阶事务, 必须&gt;=<span style="line-height: 22px;"   >max_coordinators</span><span style="line-height: 22px;"   >&nbsp;</span></font></div><div><font size="2"   >maintenance_work_mem = 512MB</font></div><div><font size="2"   >max_stack_depth = 8MB</font></div><div><font size="2"   >wal_level = minimal</font></div><div><font size="2"   >synchronous_commit = off</font></div><div><font size="2"   >wal_buffers = 16384kB</font></div><div><font size="2"   >wal_writer_delay = 10ms</font></div><div><font size="2"   >checkpoint_segments = 128</font></div><div><font size="2"   >random_page_cost = 1.0</font></div><div><font size="2"   >effective_cache_size = 8192MB</font></div><div><font size="2"   >log_destination = 'csvlog'</font></div><div><font size="2"   >logging_collector = on</font></div><div><font size="2"   >log_directory = 'pg_log'</font></div><div><font size="2"   >log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'</font></div><div><font size="2"   >log_file_mode = 0600</font></div><div><font size="2"   >log_truncate_on_rotation = on</font></div><div><font size="2"   >log_rotation_age = 1d</font></div><div><font size="2"   >log_rotation_size = 10MB</font></div><div><font size="2"   >log_checkpoints = on</font></div><div><font size="2"   >log_connections = on</font></div><div><font size="2"   >log_disconnections = on</font></div><div><font size="2"   >log_error_verbosity = verbose</font></div><div><font size="2"   >log_autovacuum_min_duration = 0</font></div><div><font size="2"   >datestyle = 'iso, mdy'</font></div><div><font size="2"   >lc_messages = 'C'</font></div><div><font size="2"   >lc_monetary = 'C'</font></div><div><font size="2"   >lc_numeric = 'C'</font></div><div><font size="2"   >lc_time = 'C'</font></div><div><font size="2"   >default_text_search_config = 'pg_catalog.english'</font></div><div><font size="2"   >pooler_port = 1922 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Pool Manager TCP port</font></div><div><font size="2"   >min_pool_size = 1</font></div><div><font size="2"   >max_pool_size = 6416 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# &gt;=(max_connection*max_datanodes+max_coordinators); #(datanode的max_connection&gt;=max_coordinators*this.max_connection.)</font></div><div><font size="2"   >max_coordinators = 16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Maximum number of Coordinators</font></div><div><font size="2"   >max_datanodes = 64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Maximum number of Datanodes</font></div><div><font size="2"   >gtm_host = '127.0.0.1' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Host name or address of GTM, 指定本机的gtm_proxy</font></div><div><font size="2"   >gtm_port = 1924 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Port of GTM<span style="line-height: 22px;"   >, 指定本机的gtm_proxy</span></font></div><div><font size="2"   >pgxc_node_name = 'coordinate_1' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Coordinator or Datanode name, 集群中的coordinate名字必须唯一, 与initdb初始化时指定的匹配.</font></div><div><font size="2"   >enforce_two_phase_commit = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Enforce the usage of two-phase commit on transactions</font></div><div><font size="2"   >enable_fast_query_shipping = on</font></div><div><font size="2"   >enable_remotejoin = on</font></div><div><font size="2"   >enable_remotegroup = on</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"   >....................... 其他节点配置略</span></div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi pg_hba.conf</font></div><div><div><font size="2"   >host all all 192.168.122.173/32 trust</font></div><div><font size="2"   >host all all 192.168.122.174/32 trust</font></div><div><font size="2"   >host all all 192.168.122.175/32 trust</font></div><div><font size="2"   >host all all 192.168.122.176/32 trust</font></div><div><font size="2"   >host all all 192.168.122.177/32 trust</font></div><div><font size="2"   >host all all 192.168.122.178/32 trust</font></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"   >....................... 其他节点配置略</span></div><div><br></div><div>12. 启动coordinate<span style="line-height: 22px;"   >&nbsp;</span><span style="line-height: 22px;"   >(192.168.122.173 - 192.168.122.178)</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >su - pgxc</font></span></div><div><font size="2"   >pg_ctl -Z coordinator start -D /data02/pgxc_coordinate</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >....................... 其他节点启动略</span></div><div><br></div><div>13. 创建node, 需要在每个coordinator节点操作, 因为coordinator上创建node以及group的操作不会在所有的coordinator中同步, 需要手工操作.</div><div># 同时不建议使用IP地址, 建议使用主机名. 下一篇中会对本例的IP地址修改为主机名举例.</div><div># datanode可以设置primary和prefered.</div><div># primary表示replicated table的dml操作发生在该节点, 因此所有coordinator节点必须统一配置同一个primary.</div><div># 只能有一个datanode的primary=true. 其他都是false.</div><div># prefered表示replicated table的读操作优先选择该节点. 因此每个coordinator配置为离它最近的节点即可.</div><div>192.168.122.173 :&nbsp;</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql -h 192.168.122.173 -p 1921 -U postgres postgres</font></div><div><font size="2"   >postgres=# select * from pgxc_node;</font></div><div><font size="2"   >&nbsp; node_name &nbsp; | node_type | node_port | node_host | nodeis_primary | nodeis_preferred | &nbsp;node_id &nbsp;&nbsp;</font></div><div><font size="2"   >--------------+-----------+-----------+-----------+----------------+------------------+------------</font></div><div><font size="2"   >&nbsp;coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;5432 | localhost | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -922782310</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div># 注意以上为初始的pgxc_node信息有误, 每个节点都需要修改.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >alter node coordinate_1 with (host='127.0.0.1',port=1921);</font></div><div><font size="2"   >create node datanode_1 with (type=datanode, host='192.168.122.173', port=1923, primary=true, preferred=true);</font></div><div><font size="2"   >create node datanode_2 with (type=datanode, host='192.168.122.174', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_3 with (type=datanode, host='192.168.122.175', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_4 with (type=datanode, host='192.168.122.176', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_5 with (type=datanode, host='192.168.122.177', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_6 with (type=datanode, host='192.168.122.178', port=1923, primary=false, preferred=false);</font></div><div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;11129 | coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-922782310</font></div><div><font size="2"   >&nbsp;16389 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16390 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16391 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16392 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16393 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16394 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(7 rows)</font></div></div></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div></div><div><span style="line-height: 22px;"   >192.168.122.174 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >psql -h 192.168.122.174 -p 1921 -U postgres postgres</font></div><div><span style="line-height: 22px;"   ><font size="2"   >alter node coordinate_2 with (host='127.0.0.1',port=1921);</font></span></div><div><font size="2"   >create node datanode_1 with (type=datanode, host='192.168.122.173', port=1923, primary=true, preferred=false);</font></div><div><font size="2"   >create node datanode_2 with (type=datanode, host='192.168.122.174', port=1923, primary=false, preferred=true);</font></div><div><font size="2"   >create node datanode_3 with (type=datanode, host='192.168.122.175', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_4 with (type=datanode, host='192.168.122.176', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_5 with (type=datanode, host='192.168.122.177', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_6 with (type=datanode, host='192.168.122.178', port=1923, primary=false, preferred=false);</font></div></div><div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;11129 | coordinate_2 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1027955327</font></div><div><font size="2"   >&nbsp;24581 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;24582 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;24578 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;24579 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;24580 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16409 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(7 rows)</font></div></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >192.168.122.175 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >psql -h 192.168.122.175 -p 1921 -U postgres postgres</font></div><div><span style="line-height: 22px;"   ><font size="2"   >alter node coordinate_3 with (host='127.0.0.1',port=1921);</font></span></div><div><span style="line-height: 22px;"   ><font size="2"   >create node datanode_1 with (type=datanode, host='192.168.122.173', port=1923, primary=true, preferred=false);</font></span></div><div><font size="2"   >create node datanode_2 with (type=datanode, host='192.168.122.174', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_3 with (type=datanode, host='192.168.122.175', port=1923, primary=false, preferred=true);</font></div><div><font size="2"   >create node datanode_4 with (type=datanode, host='192.168.122.176', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_5 with (type=datanode, host='192.168.122.177', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_6 with (type=datanode, host='192.168.122.178', port=1923, primary=false, preferred=false);</font></div></div><div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;11129 | coordinate_3 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 183504851</font></div><div><font size="2"   >&nbsp;16417 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16418 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16419 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16420 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16421 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16422 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(7 rows)</font></div></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >192.168.122.176 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >psql -h 192.168.122.176 -p 1921 -U postgres postgres</font></div><div><span style="line-height: 22px;"   ><font size="2"   >alter node coordinate_4 with (host='127.0.0.1',port=1921);</font></span></div><div><span style="line-height: 22px;"   ><font size="2"   >create node datanode_1 with (type=datanode, host='192.168.122.173', port=1923, primary=true, preferred=false);</font></span></div><div><font size="2"   >create node datanode_2 with (type=datanode, host='192.168.122.174', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_3 with (type=datanode, host='192.168.122.175', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_4 with (type=datanode, host='192.168.122.176', port=1923, primary=false, preferred=true);</font></div><div><font size="2"   >create node datanode_5 with (type=datanode, host='192.168.122.177', port=1923, primary=false, preferred=false);</font></div><div><font size="2"   >create node datanode_6 with (type=datanode, host='192.168.122.178', port=1923, primary=false, preferred=false);</font></div></div><div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;11129 | coordinate_4 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1338651536</font></div><div><font size="2"   >&nbsp;16417 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16418 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16419 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16420 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16421 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16409 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(7 rows)</font></div></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >192.168.122.177 :&nbsp;</span></div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 22px;"   ><font size="2"   >psql -h 192.168.122.177 -p 1921 -U postgres postgres</font></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   ><font size="2"   >alter node coordinate_5 with (host='127.0.0.1',port=1921);</font></span></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   ><font size="2"   >create node datanode_1 with (type=datanode, host='192.168.122.173', port=1923, primary=true, preferred=false);</font></span></div><div style="line-height: 22px;"   ><font size="2"   >create node datanode_2 with (type=datanode, host='192.168.122.174', port=1923, primary=false, preferred=false);</font></div><div style="line-height: 22px;"   ><font size="2"   >create node datanode_3 with (type=datanode, host='192.168.122.175', port=1923, primary=false, preferred=false);</font></div><div style="line-height: 22px;"   ><font size="2"   >create node datanode_4 with (type=datanode, host='192.168.122.176', port=1923, primary=false, preferred=false);</font></div><div style="line-height: 22px;"   ><font size="2"   >create node datanode_5 with (type=datanode, host='192.168.122.177', port=1923, primary=false, preferred=true);</font></div><div style="line-height: 22px;"   ><font size="2"   >create node datanode_6 with (type=datanode, host='192.168.122.178', port=1923, primary=false, preferred=false);</font></div></div><div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;11129 | coordinate_5 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;2058409530</font></div><div><font size="2"   >&nbsp;16417 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16418 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16419 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16420 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16421 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16409 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(7 rows)</font></div></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div></div><div><span style="line-height: 22px;"   >192.168.122.178 :&nbsp;</span></div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 22px;"   ><font size="2"   >psql -h 192.168.122.178 -p 1921 -U postgres postgres</font></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   ><font size="2"   >alter node coordinate_6 with (host='127.0.0.1',port=1921);</font></span></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   ><font size="2"   >create node datanode_1 with (type=datanode, host='192.168.122.173', port=1923, primary=true, preferred=false);</font></span></div><div style="line-height: 22px;"   ><font size="2"   >create node datanode_2 with (type=datanode, host='192.168.122.174', port=1923, primary=false, preferred=false);</font></div><div style="line-height: 22px;"   ><font size="2"   >create node datanode_3 with (type=datanode, host='192.168.122.175', port=1923, primary=false, preferred=false);</font></div><div style="line-height: 22px;"   ><font size="2"   >create node datanode_4 with (type=datanode, host='192.168.122.176', port=1923, primary=false, preferred=false);</font></div><div style="line-height: 22px;"   ><font size="2"   >create node datanode_5 with (type=datanode, host='192.168.122.177', port=1923, primary=false, preferred=false);</font></div><div style="line-height: 22px;"   ><font size="2"   >create node datanode_6 with (type=datanode, host='192.168.122.178', port=1923, primary=false, preferred=true);</font></div></div><div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;11129 | coordinate_6 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;15814306</font></div><div><font size="2"   >&nbsp;16437 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16432 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16433 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16434 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16435 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16436 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(7 rows)</font></div></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div></div><div><br></div><div>[其他]</div><div>1. 每个coordinator节点应该创建其他coordinator节点的信息(这样的话ddl语句才会在所有的coordinator节点执行, 详见下一篇BLOG, pgxc use caveat), 以及创建完全一致的group的信息.</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402013332335933/"   >http://blog.163.com/digoal@126/blog/static/1638770402013332335933/</a></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 22px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201322462042878/"   >http://blog.163.com/digoal@126/blog/static/163877040201322462042878/</a></div><div>2.&nbsp;<a style="line-height: 22px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201322410101184/"   >http://blog.163.com/digoal@126/blog/static/163877040201322410101184/</a></div><div>3.&nbsp;<a style="line-height: 22px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020121952051174/"   >http://blog.163.com/digoal@126/blog/static/16387704020121952051174/</a></div><div>4.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://nchc.dl.sourceforge.net/project/postgres-xc/Presentation/20120516_PGConTutorial/20120515_PGXC_Tutorial_global.pdf"   >http://nchc.dl.sourceforge.net/project/postgres-xc/Presentation/20120516_PGConTutorial/20120515_PGXC_Tutorial_global.pdf</a></div><div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >5.&nbsp;<a style="line-height: 22px; font-family: Arial, Helvetica, sans-serif;" target="_blank" rel="nofollow" href="http://www.slideshare.net/stormdb_cloud_database/postgresxc-write-scalable-postgresql-cluster"   >http://www.slideshare.net/stormdb_cloud_database/postgresxc-write-scalable-postgresql-cluster</a></div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >6.&nbsp;<a style="line-height: 22px; font-family: Arial, Helvetica, sans-serif;" target="_blank" rel="nofollow" href="http://www.pgcon.org/2012/schedule/attachments/224_Postgres-XC_tutorial.pdf"   >http://www.pgcon.org/2012/schedule/attachments/224_Postgres-XC_tutorial.pdf</a></div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >7.&nbsp;<a style="line-height: 22px; font-family: Arial, Helvetica, sans-serif;" target="_blank" rel="nofollow" href="http://wiki.postgresql.org/images/4/44/Pgxc_HA_20121024.pdf"   >http://wiki.postgresql.org/images/4/44/Pgxc_HA_20121024.pdf</a></div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >8.&nbsp;<a style="line-height: 22px; font-family: Arial, Helvetica, sans-serif;" target="_blank" rel="nofollow" href="https://github.com/koichi-szk/PGXC-Tools"   >https://github.com/koichi-szk/PGXC-Tools</a></div></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Postgres-XC 1.0.2 install in 8 KVM host enviroment - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>