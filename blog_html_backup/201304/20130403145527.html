<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Postgres-XC 1.0.2 use caveat</h2>
	<h5 id="">2013-04-03 14:55:27&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013332335933/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">接上一篇BLOG :&nbsp;<div><a href="http://blog.163.com/digoal@126/blog/static/16387704020133292915600/"   >http://blog.163.com/digoal@126/blog/static/16387704020133292915600/</a><br><div><br></div><div><div>[使用注意事项]</div><div>一, 初始节点信息in pgxc_node异常(算个小的BUG) :&nbsp;</div><div>在postgres-xc部署好后, 因为初始类型是coordinator, 所以务必将所有datanode节点类型改为datanode type, 否则会有问题哦.</div><div><br></div><div>1. datanode初始节点信息.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[pgxc@db-192-168-122-171 ~]$ psql -h 192.168.122.173 -p 1923 -U postgres postgres</font></div><div><font size="2"   >psql (PGXC 1.0.2, based on PG 9.1.7)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >postgres=# select * from pgxc_node;</font></div><div><font size="2"   >&nbsp;node_name &nbsp;| node_type | node_port | node_host | nodeis_primary | nodeis_preferred | &nbsp;node_id &nbsp;&nbsp;</font></div><div><font size="2"   >------------+-----------+-----------+-----------+----------------+------------------+------------</font></div><div><font size="2"   >&nbsp;datanode_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;5432 | localhost | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -675012441</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div># 初始的本地节点node_type=coordinator, 端口号=5432, node_host=localhost. 显然与本地配置不一致.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# alter node datanode_1 with (type=datanode, host='127.0.0.1',port=1923);</font></div><div><font size="2"   >WARNING: &nbsp;01000: unrecognized node type: 139</font></div><div><font size="2"   >LOCATION: &nbsp;GetCommandLogLevel, utility.c:3722</font></div><div><font size="2"   >ERROR: &nbsp;42601: PGXC node datanode_1: cannot alter Coordinator to Datanode</font></div><div><font size="2"   >LOCATION: &nbsp;PgxcNodeAlter, nodemgr.c:666</font></div><p></p></pre></div><div># 本地实际启动时pg_ctl -Z datanode, 但是尝试修改为datanode上的node信息报错. 所以先不用管它.</div><div><span style="line-height: 22px;"   ># 本地节点不允许删除, 如下.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# drop node datanode_1 ;</font></div><div><font size="2"   >WARNING: &nbsp;01000: unrecognized node type: 141</font></div><div><font size="2"   >LOCATION: &nbsp;GetCommandLogLevel, utility.c:3722</font></div><div><font size="2"   >ERROR: &nbsp;42601: PGXC Node datanode_1: cannot drop local node</font></div><div><font size="2"   >LOCATION: &nbsp;PgxcNodeRemove, nodemgr.c:736</font></div><p></p></pre></div><div><br></div><div>2. coordinate初始节点信息的修改 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[pgxc@db-192-168-122-171 ~]$ psql -h 192.168.122.173 -p 1921 -U postgres postgres</font></div><div><font size="2"   >psql (PGXC 1.0.2, based on PG 9.1.7)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >postgres=# select * from pgxc_node;</font></div><div><font size="2"   >&nbsp; node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;5432 | localhost &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-922782310</font></div><div><font size="2"   >postgres=# alter node coordinate_1 with (host='127.0.0.1',port=1921);</font></div><div><font size="2"   >ALTER NODE</font></div><div><font size="2"   >postgres=# select oid,* from pgxc_node;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;11129 | coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-922782310</font></div><p></p></pre></div><div># 修改后记得执行pgxc_pool_reload();</div><div><br></div><div>二, 在coordinator节点修改或新增或删除node信息前最好停止该coordinator节点的所有操作. 在操作完node信息后立刻执行pgxc_pool_reload重新加载pool信息.</div><div>&nbsp; &nbsp; 然后再允许该coordinator节点的操作, 以免带来不必要的麻烦.</div><div>&nbsp; &nbsp; (这里完全可以做成自动的, 希望以后pgxc改进这部分功能.)</div><div><br></div><div>三, 所有datanode节点中,只能有1个primary节点.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# create node datanode_1 with (type=datanode, host='192.168.122.173', port=1923, primary=true, preferred=false);</font></div><div><font size="2"   >ERROR: &nbsp;PGXC node datanode_1: two nodes cannot be primary</font></div><div><font size="2"   >postgres=# select pgxc_pool_reload();</font></div><div><font size="2"   >&nbsp;pgxc_pool_reload&nbsp;</font></div><div><font size="2"   >------------------</font></div><div><font size="2"   >&nbsp;t</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div># 如果pgxc_node中查到目前没有primary节点, 那么可能是由于pool未更新造成的. 更新后即可.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# create node datanode_1 with (type=datanode, host='192.168.122.173', port=1923, primary=true, preferred=false);</font></div><div><font size="2"   >CREATE NODE</font></div><p></p></pre></div><div># 如果coordinator pool的信息会感知node信息的变化自动更新, 那么就不会有这个问题.</div><div><br></div><div>四, coordinator节点的pgxc_node, pgxc_group信息必须一致, 但是目前来看, 这些信息需要自己来确保一致, 希望未来程序对此进行改进.</div><div>创建分布表 :&nbsp;</div><div># 方法1, 使用datanode定义分发节点.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql -h 192.168.122.173 -p 1921 -U postgres postgres</font></div><div><font size="2"   >postgres=# select oid,* from pgxc_node;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;16389 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16390 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16391 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16392 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16393 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16394 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >&nbsp;11129 | coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-922782310</font></div><div><font size="2"   >(7 rows)</font></div><div><font size="2"   >postgres=# create table t1 (id int primary key, info text) distribute by hash(id) to node datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6;</font></div><div><font size="2"   >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "t1_pkey" for table "t1"</font></div><div><font size="2"   >CREATE TABLE</font></div><p></p></pre></div><div># 创建表时, 根据pgxc_node中的node_type=C的节点同步执行. 这里只配置了本地节点, 所以元数据不会同步到其他coordinator中.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql -h 192.168.122.174 -p 1921 -U postgres postgres</font></div><div><font size="2"   >postgres=# select * from t1;</font></div><div><font size="2"   >ERROR: &nbsp;relation "t1" does not exist</font></div><div><font size="2"   >LINE 1: select * from t1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><p></p></pre></div><div># 删除表也是如此.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql -h 192.168.122.173 -p 1921 -U postgres postgres</font></div><div><font size="2"   >postgres=# drop table t1;</font></div><div><font size="2"   >DROP TABLE</font></div><p></p></pre></div><div><br></div><div># 方法2, 使用group定义分发节点.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql -h 192.168.122.173 -p 1921 -U postgres postgres</font></div><div><font size="2"   >postgres=# create node group gp0 with datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6;</font></div><div><font size="2"   >CREATE NODE GROUP</font></div><div><font size="2"   >postgres=# create table t1 (id int primary key, info text) distribute by hash(id) to group gp0;</font></div><div><font size="2"   >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "t1_pkey" for table "t1"</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >postgres=# select * from pgxc_class;</font></div><div><font size="2"   >&nbsp;pcrelid | pclocatortype | pcattnum | pchashalgorithm | pchashbuckets | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nodeoids &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------+---------------+----------+-----------------+---------------+-------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp;16444 | H &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4096 | 16389 16390 16391 16392 16393 16394</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div># 创建表时, 根据pgxc_node中的node_type=C的节点同步执行. 这里只配置了本地节点, 所以元数据不会同步到其他coordinator中.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql -h 192.168.122.174 -p 1921 -U postgres postgres</font></div><div><font size="2"   >postgres=# select * from t1;</font></div><div><font size="2"   >ERROR: &nbsp;relation "t1" does not exist</font></div><div><font size="2"   >LINE 1: select * from t1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><p></p></pre></div><div># 删除表也是如此.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql -h 192.168.122.173 -p 1921 -U postgres postgres</font></div><div><font size="2"   >postgres=# drop table t1;</font></div><div><font size="2"   >DROP TABLE</font></div><p></p></pre></div><div><br></div><div># 方法3, 在本地添加远程的coordinate节点信息.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# create node coordinate_2 with (type=coordinator, host='192.168.122.174', port=1921);</font></div><div><font size="2"   >CREATE NODE</font></div><div><font size="2"   >postgres=# create node coordinate_3 with (type=coordinator, host='192.168.122.175', port=1921);</font></div><div><font size="2"   >CREATE NODE</font></div><div><font size="2"   >postgres=# create node coordinate_4 with (type=coordinator, host='192.168.122.176', port=1921);</font></div><div><font size="2"   >CREATE NODE</font></div><div><font size="2"   >postgres=# create node coordinate_5 with (type=coordinator, host='192.168.122.177', port=1921);</font></div><div><font size="2"   >CREATE NODE</font></div><div><font size="2"   >postgres=# create node coordinate_6 with (type=coordinator, host='192.168.122.178', port=1921);</font></div><div><font size="2"   >CREATE NODE</font></div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;11129 | coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-922782310</font></div><div><font size="2"   >&nbsp;16452 | coordinate_2 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1027955327</font></div><div><font size="2"   >&nbsp;16453 | coordinate_3 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 183504851</font></div><div><font size="2"   >&nbsp;16454 | coordinate_4 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1338651536</font></div><div><font size="2"   >&nbsp;16455 | coordinate_5 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;2058409530</font></div><div><font size="2"   >&nbsp;16457 | coordinate_6 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;15814306</font></div><div><font size="2"   >&nbsp;16389 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16390 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16391 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16392 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16393 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16394 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(12 rows)</font></div><div><font size="2"   >postgres=# select pgxc_pool_reload();</font></div><div><font size="2"   >&nbsp;pgxc_pool_reload&nbsp;</font></div><div><font size="2"   >------------------</font></div><div><font size="2"   >&nbsp;t</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >postgres=# create table t1 (id int primary key, info text) distribute by hash(id) to group gp0;</font></div><div><font size="2"   >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "t1_pkey" for table "t1"</font></div><div><font size="2"   >ERROR: &nbsp;PGXC Group gp0: group not defined</font></div><div><font size="2"   >postgres=# \dt</font></div><div><font size="2"   >No relations found.</font></div><p></p></pre></div><div># 当本地定义了多个coordinator节点后,</div><div># 执行DDL, 会在所有的coordinator节点执行create table t1 (id int primary key, info text) distribute by hash(id) to group gp0;生成元数据.</div><div># 注意这个表未创建成功, 是因为其他coordinator节点未定义gp0这个组.</div><div># 在其中的一个coordinator定义组时, group的信息不会被同步到其他coordinator, 包括datanode的定义也是如此, 可以认为group,datanode是coordinator节点本地的信息. 如下</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql -h 192.168.122.173 -p 1921 -U postgres postgres</font></div><div><font size="2"   >postgres=# drop node group gp0;</font></div><div><font size="2"   >DROP NODE GROUP</font></div><div><font size="2"   >postgres=# create node group gp0 with datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6;</font></div><div><font size="2"   >CREATE NODE GROUP</font></div><div><font size="2"   >psql -h 192.168.122.174 -p 1921 -U postgres postgres</font></div><div><font size="2"   >postgres=# select * from pgxc_group;</font></div><div><font size="2"   >&nbsp;group_name | group_members&nbsp;</font></div><div><font size="2"   >------------+---------------</font></div><div><font size="2"   >(0 rows)</font></div><p></p></pre></div><div># 为了确保pgxc集群元数据定义一致, 建议每个coordinator节点的pgxc_node以及pgxc_group一致.</div><div># 并且调整了pgxc_node信息后记得调用pgxc_pool_reload重载node连接.</div><div>psql -h 192.168.122.174 -p 1921 -U postgres postgres</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create node coordinate_1 with (type=coordinator, host='192.168.122.173', port=1921);</font></div><div><font size="2"   >create node coordinate_3 with (type=coordinator, host='192.168.122.175', port=1921);</font></div><div><font size="2"   >create node coordinate_4 with (type=coordinator, host='192.168.122.176', port=1921);</font></div><div><font size="2"   >create node coordinate_5 with (type=coordinator, host='192.168.122.177', port=1921);</font></div><div><font size="2"   >create node coordinate_6 with (type=coordinator, host='192.168.122.178', port=1921);</font></div><div><font size="2"   >create node group gp0 with datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6;</font></div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;24591 | coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.173 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-922782310</font></div><div><font size="2"   >&nbsp;11129 | coordinate_2 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1027955327</font></div><div><font size="2"   >&nbsp;24586 | coordinate_3 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 183504851</font></div><div><font size="2"   >&nbsp;24587 | coordinate_4 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1338651536</font></div><div><font size="2"   >&nbsp;24588 | coordinate_5 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;2058409530</font></div><div><font size="2"   >&nbsp;24589 | coordinate_6 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;15814306</font></div><div><font size="2"   >&nbsp;24581 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;24582 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;24578 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;24579 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;24580 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16409 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(12 rows)</font></div><div><font size="2"   >postgres=# select * from pgxc_group;</font></div><div><font size="2"   >&nbsp;group_name | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group_members &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------+-------------------------------------</font></div><div><font size="2"   >&nbsp;gp0 &nbsp; &nbsp; &nbsp; &nbsp;| 24581 24582 24578 24579 24580 16409</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div><div><br></div><div>psql -h 192.168.122.175 -p 1921 -U postgres postgres</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create node coordinate_1 with (type=coordinator, host='192.168.122.173', port=1921);</font></div><div><font size="2"   >create node coordinate_2 with (type=coordinator, host='192.168.122.174', port=1921);</font></div><div><font size="2"   >create node coordinate_4 with (type=coordinator, host='192.168.122.176', port=1921);</font></div><div><font size="2"   >create node coordinate_5 with (type=coordinator, host='192.168.122.177', port=1921);</font></div><div><font size="2"   >create node coordinate_6 with (type=coordinator, host='192.168.122.178', port=1921);</font></div><div><font size="2"   >create node group gp0 with datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6;</font></div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;16426 | coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.173 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-922782310</font></div><div><font size="2"   >&nbsp;16427 | coordinate_2 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1027955327</font></div><div><font size="2"   >&nbsp;11129 | coordinate_3 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 183504851</font></div><div><font size="2"   >&nbsp;16428 | coordinate_4 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1338651536</font></div><div><font size="2"   >&nbsp;16429 | coordinate_5 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;2058409530</font></div><div><font size="2"   >&nbsp;16430 | coordinate_6 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;15814306</font></div><div><font size="2"   >&nbsp;16417 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16418 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16419 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16420 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16421 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16422 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(12 rows)</font></div><div><font size="2"   >postgres=# select * from pgxc_group;</font></div><div><font size="2"   >&nbsp;group_name | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group_members &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------+-------------------------------------</font></div><div><font size="2"   >&nbsp;gp0 &nbsp; &nbsp; &nbsp; &nbsp;| 16417 16418 16419 16420 16421 16422</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div><div><br></div><div>psql -h 192.168.122.176 -p 1921 -U postgres postgres</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create node coordinate_1 with (type=coordinator, host='192.168.122.173', port=1921);</font></div><div><font size="2"   >create node coordinate_2 with (type=coordinator, host='192.168.122.174', port=1921);</font></div><div><font size="2"   >create node coordinate_3 with (type=coordinator, host='192.168.122.175', port=1921);</font></div><div><font size="2"   >create node coordinate_5 with (type=coordinator, host='192.168.122.177', port=1921);</font></div><div><font size="2"   >create node coordinate_6 with (type=coordinator, host='192.168.122.178', port=1921);</font></div><div><font size="2"   >create node group gp0 with datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6;</font></div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;16425 | coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.173 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-922782310</font></div><div><font size="2"   >&nbsp;16426 | coordinate_2 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1027955327</font></div><div><font size="2"   >&nbsp;16427 | coordinate_3 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 183504851</font></div><div><font size="2"   >&nbsp;11129 | coordinate_4 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1338651536</font></div><div><font size="2"   >&nbsp;16428 | coordinate_5 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;2058409530</font></div><div><font size="2"   >&nbsp;16429 | coordinate_6 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;15814306</font></div><div><font size="2"   >&nbsp;16417 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16418 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16419 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16420 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16421 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16409 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(12 rows)</font></div><div><font size="2"   >postgres=# select * from pgxc_group;</font></div><div><font size="2"   >&nbsp;group_name | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group_members &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------+-------------------------------------</font></div><div><font size="2"   >&nbsp;gp0 &nbsp; &nbsp; &nbsp; &nbsp;| 16417 16418 16419 16420 16421 16409</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div><div><br></div><div>psql -h 192.168.122.177 -p 1921 -U postgres postgres</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create node coordinate_1 with (type=coordinator, host='192.168.122.173', port=1921);</font></div><div><font size="2"   >create node coordinate_2 with (type=coordinator, host='192.168.122.174', port=1921);</font></div><div><font size="2"   >create node coordinate_3 with (type=coordinator, host='192.168.122.175', port=1921);</font></div><div><font size="2"   >create node coordinate_4 with (type=coordinator, host='192.168.122.176', port=1921);</font></div><div><font size="2"   >create node coordinate_6 with (type=coordinator, host='192.168.122.178', port=1921);</font></div><div><font size="2"   >create node group gp0 with datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6;</font></div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;16425 | coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.173 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-922782310</font></div><div><font size="2"   >&nbsp;16426 | coordinate_2 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1027955327</font></div><div><font size="2"   >&nbsp;16427 | coordinate_3 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 183504851</font></div><div><font size="2"   >&nbsp;16428 | coordinate_4 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1338651536</font></div><div><font size="2"   >&nbsp;11129 | coordinate_5 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;2058409530</font></div><div><font size="2"   >&nbsp;16429 | coordinate_6 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;15814306</font></div><div><font size="2"   >&nbsp;16417 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16418 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16419 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16420 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16421 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16409 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(12 rows)</font></div><div><font size="2"   >postgres=# select * from pgxc_group;</font></div><div><font size="2"   >&nbsp;group_name | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group_members &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------+-------------------------------------</font></div><div><font size="2"   >&nbsp;gp0 &nbsp; &nbsp; &nbsp; &nbsp;| 16417 16418 16419 16420 16421 16409</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div><div><br></div><div>psql -h 192.168.122.178 -p 1921 -U postgres postgres</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create node coordinate_1 with (type=coordinator, host='192.168.122.173', port=1921);</font></div><div><font size="2"   >create node coordinate_2 with (type=coordinator, host='192.168.122.174', port=1921);</font></div><div><font size="2"   >create node coordinate_3 with (type=coordinator, host='192.168.122.175', port=1921);</font></div><div><font size="2"   >create node coordinate_4 with (type=coordinator, host='192.168.122.176', port=1921);</font></div><div><font size="2"   >create node coordinate_5 with (type=coordinator, host='192.168.122.177', port=1921);</font></div><div><font size="2"   >create node group gp0 with datanode_1, datanode_2, datanode_3, datanode_4, datanode_5, datanode_6;</font></div><div><font size="2"   >postgres=# select oid,* from pgxc_node order by node_name;</font></div><div><font size="2"   >&nbsp; oid &nbsp;| &nbsp;node_name &nbsp; | node_type | node_port | &nbsp; &nbsp;node_host &nbsp; &nbsp;| nodeis_primary | nodeis_preferred | &nbsp; node_id &nbsp;&nbsp;</font></div><div><font size="2"   >-------+--------------+-----------+-----------+-----------------+----------------+------------------+-------------</font></div><div><font size="2"   >&nbsp;16441 | coordinate_1 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.173 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-922782310</font></div><div><font size="2"   >&nbsp;16442 | coordinate_2 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1027955327</font></div><div><font size="2"   >&nbsp;16443 | coordinate_3 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 183504851</font></div><div><font size="2"   >&nbsp;16444 | coordinate_4 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1338651536</font></div><div><font size="2"   >&nbsp;16445 | coordinate_5 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;2058409530</font></div><div><font size="2"   >&nbsp;11129 | coordinate_6 | C &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1921 | 127.0.0.1 &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;15814306</font></div><div><font size="2"   >&nbsp;16437 | datanode_1 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.173 | t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-675012441</font></div><div><font size="2"   >&nbsp;16432 | datanode_2 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.174 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -1047623914</font></div><div><font size="2"   >&nbsp;16433 | datanode_3 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.175 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;1787525382</font></div><div><font size="2"   >&nbsp;16434 | datanode_4 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.176 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -83063638</font></div><div><font size="2"   >&nbsp;16435 | datanode_5 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.177 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; 137889650</font></div><div><font size="2"   >&nbsp;16436 | datanode_6 &nbsp; | D &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;1923 | 192.168.122.178 | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp;-678318491</font></div><div><font size="2"   >(12 rows)</font></div><div><font size="2"   >postgres=# select * from pgxc_group;</font></div><div><font size="2"   >&nbsp;group_name | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;group_members &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------+-------------------------------------</font></div><div><font size="2"   >&nbsp;gp0 &nbsp; &nbsp; &nbsp; &nbsp;| 16437 16432 16433 16434 16435 16436</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div><div><br></div><div># 在任意coordinator节点创建表</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >psql -h 192.168.122.176 -p 1921 -U postgres postgres</font></div><div><font size="2"   >postgres=# create table t1 (id int primary key, info text) distribute by hash(id) to group gp0;</font></div><div><font size="2"   >NOTICE: &nbsp;CREATE TABLE / PRIMARY KEY will create implicit index "t1_pkey" for table "t1"</font></div><div><font size="2"   >CREATE TABLE</font></div><p></p></pre></div><div># 192.168.122.176这台coordinator节点上定义的pgxc_node中的coordinator节点将自动创建该表的元数据.</div><div># 192.168.122.176定义的group gp0中的datanode节点将创建该表.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.173 -p 1921 -U postgres postgres -c "select * from pgxc_class";</font></div><div><font size="2"   >&nbsp;pcrelid | pclocatortype | pcattnum | pchashalgorithm | pchashbuckets | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nodeoids &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------+---------------+----------+-----------------+---------------+-------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp;16467 | H &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4096 | 16389 16390 16391 16392 16393 16394</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.174 -p 1921 -U postgres postgres -c "select * from pgxc_class";</font></div><div><font size="2"   >&nbsp;pcrelid | pclocatortype | pcattnum | pchashalgorithm | pchashbuckets | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nodeoids &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------+---------------+----------+-----------------+---------------+-------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp;24592 | H &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4096 | 24581 24582 24578 24579 24580 16409</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.175 -p 1921 -U postgres postgres -c "select * from pgxc_class";</font></div><div><font size="2"   >&nbsp;pcrelid | pclocatortype | pcattnum | pchashalgorithm | pchashbuckets | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nodeoids &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------+---------------+----------+-----------------+---------------+-------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp;16432 | H &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4096 | 16417 16418 16419 16420 16421 16422</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.176 -p 1921 -U postgres postgres -c "select * from pgxc_class";</font></div><div><font size="2"   >&nbsp;pcrelid | pclocatortype | pcattnum | pchashalgorithm | pchashbuckets | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nodeoids &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------+---------------+----------+-----------------+---------------+-------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp;16431 | H &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4096 | 16417 16418 16419 16420 16421 16409</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.177 -p 1921 -U postgres postgres -c "select * from pgxc_class";</font></div><div><font size="2"   >&nbsp;pcrelid | pclocatortype | pcattnum | pchashalgorithm | pchashbuckets | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nodeoids &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------+---------------+----------+-----------------+---------------+-------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp;16431 | H &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4096 | 16417 16418 16419 16420 16421 16409</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.178 -p 1921 -U postgres postgres -c "select * from pgxc_class";</font></div><div><font size="2"   >&nbsp;pcrelid | pclocatortype | pcattnum | pchashalgorithm | pchashbuckets | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nodeoids &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >---------+---------------+----------+-----------------+---------------+-------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp;16447 | H &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4096 | 16437 16432 16433 16434 16435 16436</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.173 -p 1923 -U postgres postgres -c "\\d t1";</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.174 -p 1923 -U postgres postgres -c "\\d t1";</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.175 -p 1923 -U postgres postgres -c "\\d t1";</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.176 -p 1923 -U postgres postgres -c "\\d t1";</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.177 -p 1923 -U postgres postgres -c "\\d t1";</font></div><div><font size="2"   >[pgxc@db-192-168-122-173 ~]$ psql -h 192.168.122.178 -p 1923 -U postgres postgres -c "\\d t1";</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Table "public.t1"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers&nbsp;</font></div><div><font size="2"   >--------+---------+-----------</font></div><div><font size="2"   >&nbsp;id &nbsp; &nbsp; | integer | not null</font></div><div><font size="2"   >&nbsp;info &nbsp; | text &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >Indexes:</font></div><div><font size="2"   >&nbsp; &nbsp; "t1_pkey" PRIMARY KEY, btree (id)</font></div><p></p></pre></div><div><br></div><div>五, pgxc配置IP地址转换成主机名.</div><div>&nbsp; 如果配置中使用的是IP地址, 那么在地址变更后需要修改配置. 为了减少这种麻烦, 最好在配置中统一使用主机名.</div><div>&nbsp; 如果没有DNS的话, 配置主机的/etc/hosts.</div><div>&nbsp; /etc/hosts配置如下 : (pgxc集群中的所有主机的/etc/hosts都需要配置, 192.168.122.171 - 192.168.122.178)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >127.0.0.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localhost.localdomain localhost</font></div><div><font size="2"   >192.168.122.171 db-192-168-122-171.sky-mobi.com db-192-168-122-171</font></div><div><font size="2"   >192.168.122.172 db-192-168-122-172.sky-mobi.com db-192-168-122-172</font></div><div><font size="2"   >192.168.122.173 db-192-168-122-173.sky-mobi.com db-192-168-122-173</font></div><div><font size="2"   >192.168.122.174 db-192-168-122-174.sky-mobi.com db-192-168-122-174</font></div><div><font size="2"   >192.168.122.175 db-192-168-122-175.sky-mobi.com db-192-168-122-175</font></div><div><font size="2"   >192.168.122.176 db-192-168-122-176.sky-mobi.com db-192-168-122-176</font></div><div><font size="2"   >192.168.122.177 db-192-168-122-177.sky-mobi.com db-192-168-122-177</font></div><div><font size="2"   >192.168.122.178 db-192-168-122-178.sky-mobi.com db-192-168-122-178</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >数据库配置 :&nbsp;</span></div><div>gtm_standby : (192.168.122.172)</div><div><p></p><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /data02/pgxc_gtm/gtm.conf</font></div><div><font size="2"   >active_host = 'db-192-168-122-171'</font></div><p></p></pre></div><p></p></div><div><span style="line-height: 22px;"   >gtm_proxy : (192.168.122.173 - 192.168.122.178)</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /data02/pgxc_gtm_proxy/gtm_proxy.conf</font></div><div><font size="2"   >gtm_host = 'db-192-168-122-171'</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >datanode : (192.168.122.173 - 192.168.122.178)</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /data02/pgxc_datanode/postgresql.conf</font></div><div><font size="2"   >gtm_host = '127.0.0.1'</font></div><div><font size="2"   >gtm_port = 1924</font></div><p></p></pre></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >vi /data02/pgxc_datanode/pg_hba.conf</font></span></div><div><p></p><div><font size="2"   >host all all 127.0.0.1/32 trust</font></div><div><font size="2"   >host all all 192.168.122.173/32 trust</font></div><div><font size="2"   >host all all 192.168.122.174/32 trust</font></div><div><font size="2"   >host all all 192.168.122.175/32 trust</font></div><div><font size="2"   >host all all 192.168.122.176/32 trust</font></div><div><font size="2"   >host all all 192.168.122.177/32 trust</font></div><div><font size="2"   >host all all 192.168.122.178/32 trust</font></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div></div><p></p></pre></div><div><p></p></div><div><span style="line-height: 22px;"   >coordinator : (192.168.122.173 - 192.168.122.178)</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /data02/pgxc_coordinate/postgresql.conf</font></div><div><font size="2"   >gtm_host = '127.0.0.1'</font></div><div><font size="2"   >gtm_port = 1924</font></div><p></p></pre></div><div><pre class="prettyprint"   ><div><font size="2"   >vi /data02/pgxc_coordinate/pg_hba.conf</font></div><div><p></p><div><font size="2"   >host all all 127.0.0.1/32 trust</font></div><div><font size="2"   >host all all 192.168.122.173/32 trust</font></div><div><font size="2"   >host all all 192.168.122.174/32 trust</font></div><div><font size="2"   >host all all 192.168.122.175/32 trust</font></div><div><font size="2"   >host all all 192.168.122.176/32 trust</font></div><div><font size="2"   >host all all 192.168.122.177/32 trust</font></div><div><font size="2"   >host all all 192.168.122.178/32 trust</font></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div></div><p></p></pre></div><div><p></p></div><div><span style="line-height: 22px;"   >psql -h [192.168.122.173 - 192.168.122.178] -p 1921 -U postgres postgres</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >alter node datanode_1 with (host='db-192-168-122-173', PRIMARY=false);</font></div><div><font size="2"   >alter node datanode_2 with (host='db-192-168-122-174', PRIMARY=false);</font></div><div><font size="2"   >alter node datanode_3 with (host='db-192-168-122-175', PRIMARY=false);</font></div><div><font size="2"   >alter node datanode_4 with (host='db-192-168-122-176', PRIMARY=false);</font></div><div><font size="2"   >alter node datanode_5 with (host='db-192-168-122-177', PRIMARY=false);</font></div><div><font size="2"   >alter node datanode_6 with (host='db-192-168-122-178', PRIMARY=false);</font></div><div><font size="2"   >alter node coordinate_1 with (host='db-192-168-122-173');</font></div><div><font size="2"   >alter node coordinate_2 with (host='db-192-168-122-174');</font></div><div><font size="2"   >alter node coordinate_3 with (host='db-192-168-122-175');</font></div><div><font size="2"   >alter node coordinate_4 with (host='db-192-168-122-176');</font></div><div><font size="2"   >alter node coordinate_5 with (host='db-192-168-122-177');</font></div><div><font size="2"   >alter node coordinate_6 with (host='db-192-168-122-178');</font></div><div><font size="2"   >select pgxc_pool_reload();</font></div><div><font size="2"   >alter node datanode_1 with (PRIMARY=true);</font></div><div><font size="2"   >select pgxc_pool_reload();</font></div><p></p></pre></div><div># 如果确认没有其他的primary=ture, 但是修改时还是报以下错, 执行select pgxc_pool_reload();无效, 那么退出coordinator后重新连进去再试一试,</div><div># ERROR: &nbsp;PGXC node datanode_1: two nodes cannot be primary</div><div># 检查所有coordinate节点是否修改正确 :&nbsp;</div><div><pre class="prettyprint"   ><p><font size="2"   >select oid,* from pgxc_node order by node_name;</font></p></pre></div><div><br></div><div>修改完成后, 重启所有组件 :&nbsp;</div><div>[stop顺序]</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >1. coordinator (如果配置了流复制, 那么先停1.primary, 再停2.standby)</font></div><div><font size="2"   >(192.168.122.173 - 192.168.122.178)</font></div><div><p><font size="2"   >pg_ctl -Z coordinator stop -m fast -D /data02/pgxc_coordinate</font></p></div><div><font size="2"   ># 确认所有coordinator节点已关闭</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >2. datanode (如果配置了流复制, 那么先停1.primary, 再停2.standby)</font></div><div><font size="2"   >(192.168.122.173 - 192.168.122.178)</font></div><div><font size="2"   >pg_ctl -Z datanode stop -m fast -D /data02/pgxc_datanode</font></div><div><font size="2"   ># 确认所有datanode节点已关闭</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >3. gtm_proxy</font></div><div><font size="2"   >(192.168.122.173 - 192.168.122.178)</font></div><div><font size="2"   >gtm_ctl -Z gtm_proxy stop -m fast -D /data02/pgxc_gtm_proxy</font></div><div><font size="2"   ># 确认所有gtm_proxy节点已关闭</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >4. gtm</font></div><div><font size="2"   >(192.168.122.171)</font></div><div><font size="2"   >gtm_ctl -Z gtm stop -m fast -D /data02/pgxc_gtm</font></div><div><font size="2"   ># 确认gtm节点已关闭</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >5. gtm_standby</font></div><div><font size="2"   >(192.168.122.172)</font></div><div><font size="2"   >gtm_ctl -Z gtm stop -m fast -D /data02/pgxc_gtm</font></div><div><font size="2"   ># 确认gtm_standby节点已关闭</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >[startup顺序]</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >1. gtm</font></div><div><font size="2"   >(192.168.122.171)</font></div><div><font size="2"   >gtm_ctl -Z gtm start -D /data02/pgxc_gtm</font></div><div><font size="2"   ># 确认gtm节点已开启</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >2. gtm_standby</font></div><div><font size="2"   >(192.168.122.172)</font></div><div><font size="2"   >gtm_ctl -Z gtm start -D /data02/pgxc_gtm</font></div><div><font size="2"   ># 确认gtm_standby节点已开启</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >3. gtm_proxy</font></div><div><font size="2"   >(192.168.122.173 - 192.168.122.178)</font></div><div><font size="2"   >gtm_ctl -Z gtm_proxy start -D /data02/pgxc_gtm_proxy</font></div><div><font size="2"   ># 确认所有gtm_proxy节点已开启</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >4. datanode (如果配置了流复制, 那么先启动1.primary, 再启动2.standby)</font></div><div><font size="2"   >(192.168.122.173 - 192.168.122.178)</font></div><div><font size="2"   >pg_ctl -Z datanode start -D /data02/pgxc_datanode</font></div><div><font size="2"   ># 确认所有datanode节点已开启</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >5. coordinator (如果配置了流复制, 那么先启动1.primary, 再启动2.standby)</font></div><div><font size="2"   >(192.168.122.173 - 192.168.122.178)</font></div><div><font size="2"   >pg_ctl -Z coordinator start -D /data02/pgxc_coordinate</font></div><div><font size="2"   ># 确认所有coordinator节点已开启</font></div><p></p></pre></div><div><br></div><div>六, 新增coordinator节点.</div><div>1. 新增coordinator节点时, pgxc_node, pgxc_group, pgxc_class中的元数据是没有的. 需要处理.</div><div><br></div><div>七, 为什么各个coordinator的元数据信息会不一致?</div><div>例如: 192.168.122.173:1921 上有t1表, 但是<span style="line-height: 22px;"   >192.168.122.174:1921上没有, 此时drop t1时会报错.</span></div><div><span style="line-height: 22px;"   >这个错误是怎么产生的呢?</span></div><div><span style="line-height: 22px;"   >例如在192.168.122.173:1921 创建t1表时, 192.168.122.174:1921还不在pgxc_node的coordinator列表中.&nbsp;</span></div><div><span style="line-height: 22px;"   >所以</span><span style="line-height: 22px;"   >192.168.122.174:1921不会自动创建这个元数据.</span></div><div><span style="line-height: 22px;"   >当发生不一致时可以使用pgxc_ddl来修复.</span></div><div><span style="line-height: 22px;"   >下一篇将讲一讲如何修复元数据.</span></div><wbr></div></div></div>
	</div>
</div>
</body>
</html>