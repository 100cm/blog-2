<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">MySQL server sysv script</h2>
	<h5 id="">2014-12-05 17:33:06&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020141155935205/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>上一篇简单介绍了MariaDB 10 with Galera在Docker中使用yum安装.</div><div>安装完后, 简单介绍一下systemv的控制脚本.</div><div>包含一些变量, 可能需要手工配置.</div><div>1. 主要包含</div><div>&nbsp; &nbsp; mysql软件的安装目录,&nbsp;</div><div>&nbsp; &nbsp; 数据库的数据目录.</div><div>2. 启动数据库后的PID文件放哪里,&nbsp;</div><div>&nbsp; &nbsp; 启动数据库的超时机制,</div><div>3. 是否使用mysqld_safe启动数据库</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@mariadb my.cnf.d]# mysqld_safe --help &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >Usage: /usr/bin/mysqld_safe [OPTIONS]</font></div><div><font size="2"   >&nbsp; --no-defaults &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Don't read the system defaults file</font></div><div><font size="2"   >&nbsp; --core-file-size=LIMIT &nbsp; &nbsp; Limit core files to the specified size</font></div><div><font size="2"   >&nbsp; --defaults-file=FILE &nbsp; &nbsp; &nbsp; Use the specified defaults file</font></div><div><font size="2"   >&nbsp; --defaults-extra-file=FILE Also use defaults from the specified file</font></div><div><font size="2"   >&nbsp; --ledir=DIRECTORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Look for mysqld in the specified directory</font></div><div><font size="2"   >&nbsp; --open-files-limit=LIMIT &nbsp; Limit the number of open files</font></div><div><font size="2"   >&nbsp; --crash-script=FILE &nbsp; &nbsp; &nbsp; &nbsp;Script to call when mysqld crashes</font></div><div><font size="2"   >&nbsp; --timezone=TZ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set the system timezone</font></div><div><font size="2"   >&nbsp; --malloc-lib=LIB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Preload shared library LIB if available</font></div><div><font size="2"   >&nbsp; --mysqld=FILE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Use the specified file as mysqld</font></div><div><font size="2"   >&nbsp; --mysqld-version=VERSION &nbsp; Use "mysqld-VERSION" as mysqld</font></div><div><font size="2"   >&nbsp; --nice=NICE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set the scheduling priority of mysqld</font></div><div><font size="2"   >&nbsp; --no-auto-restart &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Exit after starting mysqld</font></div><div><font size="2"   >&nbsp; --nowatch &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Exit after starting mysqld</font></div><div><font size="2"   >&nbsp; --plugin-dir=DIR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Plugins are under DIR or DIR/VERSION, if</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VERSION is given</font></div><div><font size="2"   >&nbsp; --skip-kill-mysqld &nbsp; &nbsp; &nbsp; &nbsp; Don't try to kill stray mysqld processes</font></div><div><font size="2"   >&nbsp; --syslog &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Log messages to syslog with 'logger'</font></div><div><font size="2"   >&nbsp; --skip-syslog &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Log messages to error log (default)</font></div><div><font size="2"   >&nbsp; --syslog-tag=TAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Pass -t "mysqld-TAG" to 'logger'</font></div><div><font size="2"   >&nbsp; --flush-caches &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Flush and purge buffers/caches before</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;starting the server</font></div><div><font size="2"   >&nbsp; --numa-interleave &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Run mysqld with its memory interleaved</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;on all NUMA nodes</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >All other options are passed to the mysqld program.</font></div><p></p></pre></div><div>4. 额外配置文件, 优先使用$basedir/my.cnf, 然后使用$datadir/my.cnf.</div><div>建议将配置文件放在数据目录, PostgreSQL就是这么干的.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >extra_args=""</font></div><div><font size="2"   >if test -r "$basedir/my.cnf"</font></div><div><font size="2"   >then</font></div><div><font size="2"   >&nbsp; extra_args="-e $basedir/my.cnf"</font></div><div><font size="2"   >else</font></div><div><font size="2"   >&nbsp; if test -r "$datadir/my.cnf"</font></div><div><font size="2"   >&nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; extra_args="-e $datadir/my.cnf"</font></div><div><font size="2"   >&nbsp; fi</font></div><div><font size="2"   >fi</font></div><p></p></pre></div><div><br></div><div><p style="margin-top: 0px; color: rgb(51, 51, 51); font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 14px; line-height: normal;"   ><code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   >mysql.server</code>&nbsp;supports the following options.</p><ul start="1"   style="margin-top: 0px; margin-bottom: 10px; margin-left: 25px; color: rgb(51, 51, 51); font-family: HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 14px; line-height: normal; list-style: none;"   ><li style="line-height: 20px;"   ><code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   ><strong>--basedir=</strong><em>path</em></code><ul start="1"   style="margin-top: 0px; margin-bottom: 0px; margin-left: 25px; list-style: none;"   ><li style="line-height: 20px;"   >The path to the MariaDB installation directory.</li></ul></li><li style="line-height: 20px;"   ><code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   ><strong>--datadir=</strong><em>path</em></code><ul start="1"   style="margin-top: 0px; margin-bottom: 0px; margin-left: 25px; list-style: none;"   ><li style="line-height: 20px;"   >The path to the MariaDB data directory.</li></ul></li><li style="line-height: 20px;"   ><code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   ><strong>--pid-file=</strong><em>file_name</em></code><ul start="1"   style="margin-top: 0px; margin-bottom: 0px; margin-left: 25px; list-style: none;"   ><li style="line-height: 20px;"   >The path name of the file in which the server should write its process ID.</li></ul></li><li style="line-height: 20px;"   ><code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   ><strong>--service-startup-timeout=</strong><em>file_name</em></code><ul start="1"   style="margin-top: 0px; margin-bottom: 0px; margin-left: 25px; list-style: none;"   ><li style="line-height: 20px;"   >How long in seconds to wait for confirmation of server startup. If the server does not start within this time,&nbsp;<code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   >mysql.server</code>&nbsp;exits with an error. The default value is 900. A value of 0 means not to wait at all for startup. Negative values mean to wait forever (no timeout). This option was added in MySQL 5.0.40. Before that, a value of 900 is always used.</li></ul></li><li style="line-height: 20px;"   ><code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   ><strong>--use-mysqld_safe</strong></code><ul start="1"   style="margin-top: 0px; margin-bottom: 0px; margin-left: 25px; list-style: none;"   ><li style="line-height: 20px;"   >Use&nbsp;<code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   >mysqld_safe</code>&nbsp;to start the server. This is the default. This option was added in MySQL 5.0.4.</li></ul></li><li style="line-height: 20px;"   ><code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   ><strong>--use-manager</strong></code><ul start="1"   style="margin-top: 0px; margin-bottom: 0px; margin-left: 25px; list-style: none;"   ><li style="line-height: 20px;"   >Use Instance Manager to start the server. This option was added in MySQL 5.0.4.</li></ul></li><li style="line-height: 20px;"   ><code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   ><strong>--user=</strong><em>user_name</em></code><ul start="1"   style="margin-top: 0px; margin-bottom: 0px; margin-left: 25px; list-style: none;"   ><li style="line-height: 20px;"   >The login user name to use for running&nbsp;<code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; color: inherit; border-radius: 3px; border: 1px solid rgb(225, 225, 232); white-space: pre-wrap; background-color: rgb(247, 247, 249);"   >mysqld</code>. This option was added in MySQL 5.0.4.</li></ul></li></ul></div><wbr><div>脚本内容如下 :&nbsp;</div><div><div>[root@mariadb /]# cat /etc/init.d/mysql &nbsp; &nbsp;&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >#!/bin/sh</font></div><div><font size="2"   ># Copyright Abandoned 1996 TCX DataKonsult AB &amp; Monty Program KB &amp; Detron HB</font></div><div><font size="2"   ># This file is public domain and comes with NO WARRANTY of any kind</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># MySQL daemon start/stop script.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># Usually this is put in /etc/init.d (at least on machines SYSV R4 based</font></div><div><font size="2"   ># systems) and linked to /etc/rc3.d/S99mysql and /etc/rc0.d/K01mysql.</font></div><div><font size="2"   ># When this is done the mysql server will be started when the machine is</font></div><div><font size="2"   ># started and shut down when the systems goes down.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># Comments to support chkconfig on RedHat Linux</font></div><div><font size="2"   ># chkconfig: 2345 64 36</font></div><div><font size="2"   ># description: A very fast and reliable SQL database engine.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># Comments to support LSB init script conventions</font></div><div><font size="2"   >### BEGIN INIT INFO</font></div><div><font size="2"   ># Provides: mysql</font></div><div><font size="2"   ># Required-Start: $local_fs $network $remote_fs</font></div><div><font size="2"   ># Should-Start: ypbind nscd ldap ntpd xntpd</font></div><div><font size="2"   ># Required-Stop: $local_fs $network $remote_fs</font></div><div><font size="2"   ># Default-Start: &nbsp;2 3 4 5</font></div><div><font size="2"   ># Default-Stop: 0 1 6</font></div><div><font size="2"   ># Short-Description: start and stop MySQL</font></div><div><font size="2"   ># Description: MySQL is a very fast and reliable SQL database engine.</font></div><div><font size="2"   >### END INIT INFO</font></div><div><font size="2"   >&nbsp;</font></div><div><font size="2"   ># If you install MySQL on some other places than /usr, then you</font></div><div><font size="2"   ># have to do one of the following things for this script to work:</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># - Run this script from within the MySQL installation directory</font></div><div><font size="2"   ># - Create a /etc/my.cnf file with the following information:</font></div><div><font size="2"   ># &nbsp; [mysqld]</font></div><div><font size="2"   ># &nbsp; basedir=&lt;path-to-mysql-installation-directory&gt;</font></div><div><font size="2"   ># - Add the above to any other configuration file (for example ~/.my.ini)</font></div><div><font size="2"   ># &nbsp; and copy my_print_defaults to /usr/bin</font></div><div><font size="2"   ># - Add the path to the mysql-installation-directory to the basedir variable</font></div><div><font size="2"   ># &nbsp; below.</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># If you want to affect other MySQL variables, you should make your changes</font></div><div><font size="2"   ># in the /etc/my.cnf, ~/.my.cnf or other MySQL configuration files.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># If you change base dir, you must also change datadir. These may get</font></div><div><font size="2"   ># overwritten by settings in the MySQL configuration files.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >basedir=</font></div><div><font size="2"   >datadir=</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># Default value, in seconds, afterwhich the script should timeout waiting</font></div><div><font size="2"   ># for server start.&nbsp;</font></div><div><font size="2"   ># Value here is overriden by value in my.cnf.&nbsp;</font></div><div><font size="2"   ># 0 means don't wait at all</font></div><div><font size="2"   ># Negative numbers mean to wait indefinitely</font></div><div><font size="2"   >service_startup_timeout=900</font></div><div><font size="2"   >startup_sleep=1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># Lock directory for RedHat / SuSE.</font></div><div><font size="2"   >lockdir='/var/lock/subsys'</font></div><div><font size="2"   >lock_file_path="$lockdir/mysql"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># The following variables are only set for letting mysql.server find things.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># Set some defaults</font></div><div><font size="2"   >mysqld_pid_file_path=</font></div><div><font size="2"   >if test -z "$basedir"</font></div><div><font size="2"   >then</font></div><div><font size="2"   >&nbsp; basedir=/usr</font></div><div><font size="2"   >&nbsp; bindir=/usr/bin</font></div><div><font size="2"   >&nbsp; if test -z "$datadir"</font></div><div><font size="2"   >&nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; datadir=/var/lib/mysql</font></div><div><font size="2"   >&nbsp; fi</font></div><div><font size="2"   >&nbsp; sbindir=/usr/sbin</font></div><div><font size="2"   >&nbsp; libexecdir=/usr/sbin</font></div><div><font size="2"   >else</font></div><div><font size="2"   >&nbsp; bindir="$basedir/bin"</font></div><div><font size="2"   >&nbsp; if test -z "$datadir"</font></div><div><font size="2"   >&nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; datadir="$basedir/data"</font></div><div><font size="2"   >&nbsp; fi</font></div><div><font size="2"   >&nbsp; sbindir="$basedir/sbin"</font></div><div><font size="2"   >&nbsp; if test -f "$basedir/bin/mysqld"</font></div><div><font size="2"   >&nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; libexecdir="$basedir/bin"</font></div><div><font size="2"   >&nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; libexecdir="$basedir/libexec"</font></div><div><font size="2"   >&nbsp; fi</font></div><div><font size="2"   >fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># datadir_set is used to determine if datadir was set (and so should be</font></div><div><font size="2"   ># *not* set inside of the --basedir= handler.)</font></div><div><font size="2"   >datadir_set=</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >#</font></div><div><font size="2"   ># Use LSB init script functions for printing messages, if possible</font></div><div><font size="2"   >#</font></div><div><font size="2"   >lsb_functions="/lib/lsb/init-functions"</font></div><div><font size="2"   >if test -f $lsb_functions ; then</font></div><div><font size="2"   >&nbsp; . $lsb_functions</font></div><div><font size="2"   >else</font></div><div><font size="2"   >&nbsp; log_success_msg()</font></div><div><font size="2"   >&nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; echo " SUCCESS! $@"</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; log_failure_msg()</font></div><div><font size="2"   >&nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; echo " ERROR! $@"</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >PATH="/sbin:/usr/sbin:/bin:/usr/bin:$basedir/bin"</font></div><div><font size="2"   >export PATH</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >mode=$1 &nbsp; &nbsp;# start or stop</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[ $# -ge 1 ] &amp;&amp; shift</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >other_args="$*" &nbsp; # uncommon, but needed when called from an RPM upgrade action</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Expected: "--skip-networking --skip-grant-tables"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# They are not checked here, intentionally, as it is the resposibility</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# of the "spec" file author to give correct arguments only.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >case `echo "testing\c"`,`echo -n testing` in</font></div><div><font size="2"   >&nbsp; &nbsp; *c*,-n*) echo_n= &nbsp; echo_c= &nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; &nbsp; *c*,*) &nbsp; echo_n=-n echo_c= &nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; &nbsp; *) &nbsp; &nbsp; &nbsp; echo_n= &nbsp; echo_c='\c' ;;</font></div><div><font size="2"   >esac</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >parse_server_arguments() {</font></div><div><font size="2"   >&nbsp; for arg do</font></div><div><font size="2"   >&nbsp; &nbsp; case "$arg" in</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; --basedir=*) &nbsp;basedir=`echo "$arg" | sed -e 's/^[^=]*=//'`</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bindir="$basedir/bin"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if test -z "$datadir_set"; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; datadir="$basedir/data"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sbindir="$basedir/sbin"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if test -f "$basedir/bin/mysqld"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; libexecdir="$basedir/bin"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; libexecdir="$basedir/libexec"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; libexecdir="$basedir/libexec"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; --datadir=*) &nbsp;datadir=`echo "$arg" | sed -e 's/^[^=]*=//'`</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; datadir_set=1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; --pid-file=*) mysqld_pid_file_path=`echo "$arg" | sed -e 's/^[^=]*=//'` ;;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; --service-startup-timeout=*) service_startup_timeout=`echo "$arg" | sed -e 's/^[^=]*=//'` ;;</font></div><div><font size="2"   >&nbsp; &nbsp; esac</font></div><div><font size="2"   >&nbsp; done</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># Get arguments from the my.cnf file,</font></div><div><font size="2"   ># the only group, which is read from now on is [mysqld]</font></div><div><font size="2"   >if test -x ./bin/my_print_defaults</font></div><div><font size="2"   >then</font></div><div><font size="2"   >&nbsp; print_defaults="./bin/my_print_defaults"</font></div><div><font size="2"   >elif test -x $bindir/my_print_defaults</font></div><div><font size="2"   >then</font></div><div><font size="2"   >&nbsp; print_defaults="$bindir/my_print_defaults"</font></div><div><font size="2"   >elif test -x $bindir/mysql_print_defaults</font></div><div><font size="2"   >then</font></div><div><font size="2"   >&nbsp; print_defaults="$bindir/mysql_print_defaults"</font></div><div><font size="2"   >else</font></div><div><font size="2"   >&nbsp; # Try to find basedir in /etc/my.cnf</font></div><div><font size="2"   >&nbsp; conf=/etc/my.cnf</font></div><div><font size="2"   >&nbsp; print_defaults=</font></div><div><font size="2"   >&nbsp; if test -r $conf</font></div><div><font size="2"   >&nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; subpat='^[^=]*basedir[^=]*=\(.*\)$'</font></div><div><font size="2"   >&nbsp; &nbsp; dirs=`sed -e "/$subpat/!d" -e 's//\1/' $conf`</font></div><div><font size="2"   >&nbsp; &nbsp; for d in $dirs</font></div><div><font size="2"   >&nbsp; &nbsp; do</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; d=`echo $d | sed -e 's/[ &nbsp;]//g'`</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if test -x "$d/bin/my_print_defaults"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; print_defaults="$d/bin/my_print_defaults"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; break</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if test -x "$d/bin/mysql_print_defaults"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; print_defaults="$d/bin/mysql_print_defaults"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; break</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; done</font></div><div><font size="2"   >&nbsp; fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; # Hope it's in the PATH ... but I doubt it</font></div><div><font size="2"   >&nbsp; test -z "$print_defaults" &amp;&amp; print_defaults="my_print_defaults"</font></div><div><font size="2"   >fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >#</font></div><div><font size="2"   ># Read defaults file from 'basedir'. &nbsp; If there is no defaults file there</font></div><div><font size="2"   ># check if it's in the old (depricated) place (datadir) and read it from there</font></div><div><font size="2"   >#</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >extra_args=""</font></div><div><font size="2"   >if test -r "$basedir/my.cnf"</font></div><div><font size="2"   >then</font></div><div><font size="2"   >&nbsp; extra_args="-e $basedir/my.cnf"</font></div><div><font size="2"   >else</font></div><div><font size="2"   >&nbsp; if test -r "$datadir/my.cnf"</font></div><div><font size="2"   >&nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; extra_args="-e $datadir/my.cnf"</font></div><div><font size="2"   >&nbsp; fi</font></div><div><font size="2"   >fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >parse_server_arguments `$print_defaults $extra_args mysqld server mysql_server mysql.server`</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># wait for the pid file to disappear</font></div><div><font size="2"   >wait_for_gone () {</font></div><div><font size="2"   >&nbsp; pid="$1" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # process ID of the program operating on the pid-file</font></div><div><font size="2"   >&nbsp; pid_file_path="$2" # path to the PID file.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; i=0</font></div><div><font size="2"   >&nbsp; crash_protection="by checking again"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; while test $i -ne $service_startup_timeout ; do</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; if kill -0 "$pid" 2&gt;/dev/null; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; : &nbsp;# the server still runs</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if test ! -s "$pid_file_path"; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # no server process and no pid-file? great, we're done!</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; log_success_msg</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # pid-file exists, the server process doesn't.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # it must've crashed, and mysqld_safe will restart it</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if test -n "$crash_protection"; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; crash_protection=""</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; sleep 5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; continue &nbsp;# Check again.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # Cannot help it</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_failure_msg "The server quit without updating PID file ($pid_file_path)."</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; return 1 &nbsp;# not waiting any more.</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; echo $echo_n ".$echo_c"</font></div><div><font size="2"   >&nbsp; &nbsp; i=`expr $i + 1`</font></div><div><font size="2"   >&nbsp; &nbsp; sleep 1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; done</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; log_failure_msg</font></div><div><font size="2"   >&nbsp; return 1</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >wait_for_ready () {</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; sst_progress_file=$datadir/sst_in_progress</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; i=0</font></div><div><font size="2"   >&nbsp; while test $i -ne $service_startup_timeout ; do</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; if $bindir/mysqladmin ping &gt;/dev/null 2&gt;&amp;1; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_success_msg</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; return 0</font></div><div><font size="2"   >&nbsp; &nbsp; elif kill -0 $! 2&gt;/dev/null ; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; : &nbsp;# mysqld_safe is still running</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # mysqld_safe is no longer running, abort the wait loop</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; break</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; if test -e $sst_progress_file &amp;&amp; [ $startup_sleep -ne 10 ];then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; echo $echo_n "SST in progress, setting sleep higher"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; startup_sleep=10</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; echo $echo_n ".$echo_c"</font></div><div><font size="2"   >&nbsp; &nbsp; i=`expr $i + 1`</font></div><div><font size="2"   >&nbsp; &nbsp; sleep $startup_sleep</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; done</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; log_failure_msg</font></div><div><font size="2"   >&nbsp; return 1</font></div><div><font size="2"   >}</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># Set pid file if not given</font></div><div><font size="2"   >#</font></div><div><font size="2"   >if test -z "$mysqld_pid_file_path"</font></div><div><font size="2"   >then</font></div><div><font size="2"   >&nbsp; mysqld_pid_file_path=$datadir/`hostname`.pid</font></div><div><font size="2"   >else</font></div><div><font size="2"   >&nbsp; case "$mysqld_pid_file_path" in</font></div><div><font size="2"   >&nbsp; &nbsp; /* ) ;;</font></div><div><font size="2"   >&nbsp; &nbsp; * ) &nbsp;mysqld_pid_file_path="$datadir/$mysqld_pid_file_path" ;;</font></div><div><font size="2"   >&nbsp; esac</font></div><div><font size="2"   >fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># source other config files</font></div><div><font size="2"   >[ -f /etc/default/mysql ] &amp;&amp; . /etc/default/mysql</font></div><div><font size="2"   >[ -f /etc/sysconfig/mysql ] &amp;&amp; . /etc/sysconfig/mysql</font></div><div><font size="2"   >[ -f /etc/conf.d/mysql ] &amp;&amp; . /etc/conf.d/mysql</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >case "$mode" in</font></div><div><font size="2"   >&nbsp; 'start')</font></div><div><font size="2"   >&nbsp; &nbsp; # Start daemon</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # Safeguard (relative paths, core dumps..)</font></div><div><font size="2"   >&nbsp; &nbsp; cd $basedir</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; echo $echo_n "Starting MySQL"</font></div><div><font size="2"   >&nbsp; &nbsp; if test -x $bindir/mysqld_safe</font></div><div><font size="2"   >&nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # Give extra arguments to mysqld with the my.cnf file. This script</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # may be overwritten at next upgrade.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; $bindir/mysqld_safe --datadir="$datadir" --pid-file="$mysqld_pid_file_path" $other_args &gt;/dev/null 2&gt;&amp;1 &amp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; wait_for_ready; return_value=$?</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # Make lock for RedHat / SuSE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if test -w "$lockdir"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; touch "$lock_file_path"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; exit $return_value</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_failure_msg "Couldn't find MySQL server ($bindir/mysqld_safe)"</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; ;;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; 'stop')</font></div><div><font size="2"   >&nbsp; &nbsp; # Stop daemon. We use a signal here to avoid having to know the</font></div><div><font size="2"   >&nbsp; &nbsp; # root password.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; if test -s "$mysqld_pid_file_path"</font></div><div><font size="2"   >&nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; mysqld_pid=`cat "$mysqld_pid_file_path"`</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if (kill -0 $mysqld_pid 2&gt;/dev/null)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; echo $echo_n "Shutting down MySQL"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; kill $mysqld_pid</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # mysqld should remove the pid file when it exits, so wait for it.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; wait_for_gone $mysqld_pid "$mysqld_pid_file_path"; return_value=$?</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; log_failure_msg "MySQL server process #$mysqld_pid is not running!"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; rm "$mysqld_pid_file_path"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # Delete lock for RedHat / SuSE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if test -f "$lock_file_path"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; rm -f "$lock_file_path"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; exit $return_value</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_failure_msg "MySQL server PID file could not be found!"</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; ;;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; 'restart')</font></div><div><font size="2"   >&nbsp; &nbsp; # Stop the service and regardless of whether it was</font></div><div><font size="2"   >&nbsp; &nbsp; # running or not, start it again.</font></div><div><font size="2"   >&nbsp; &nbsp; if $0 stop &nbsp;$other_args; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if ! $0 start $other_args; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; log_failure_msg "Failed to restart server."</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; exit 1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_failure_msg "Failed to stop running server, so refusing to try to start."</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; exit 1</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; ;;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; 'reload'|'force-reload')</font></div><div><font size="2"   >&nbsp; &nbsp; if test -s "$mysqld_pid_file_path" ; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; read mysqld_pid &lt; &nbsp;"$mysqld_pid_file_path"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; kill -HUP $mysqld_pid &amp;&amp; log_success_msg "Reloading service MySQL"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; touch "$mysqld_pid_file_path"</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_failure_msg "MySQL PID file could not be found!"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; exit 1</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; 'status')</font></div><div><font size="2"   >&nbsp; &nbsp; # First, check to see if pid file exists</font></div><div><font size="2"   >&nbsp; &nbsp; if test -s "$mysqld_pid_file_path" ; then&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; read mysqld_pid &lt; "$mysqld_pid_file_path"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if kill -0 $mysqld_pid 2&gt;/dev/null ; then&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; log_success_msg "MySQL running ($mysqld_pid)"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; exit 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; log_failure_msg "MySQL is not running, but PID file exists"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; exit 1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # Try to find appropriate mysqld process</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; mysqld_pid=`pidof $libexecdir/mysqld`</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # test if multiple pids exist</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; pid_count=`echo $mysqld_pid | wc -w`</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if test $pid_count -gt 1 ; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; log_failure_msg "Multiple MySQL running but PID file could not be found ($mysqld_pid)"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; exit 5</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; elif test -z $mysqld_pid ; then&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if test -f "$lock_file_path" ; then&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; log_failure_msg "MySQL is not running, but lock file ($lock_file_path) exists"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit 2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fi&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; log_failure_msg "MySQL is not running"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; exit 3</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; log_failure_msg "MySQL is running but PID file could not be found"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; exit 4</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; 'configtest')</font></div><div><font size="2"   >&nbsp; &nbsp; # Safeguard (relative paths, core dumps..)</font></div><div><font size="2"   >&nbsp; &nbsp; cd $basedir</font></div><div><font size="2"   >&nbsp; &nbsp; echo $echo_n "Testing MySQL configuration syntax"</font></div><div><font size="2"   >&nbsp; &nbsp; daemon=$bindir/mysqld</font></div><div><font size="2"   >&nbsp; &nbsp; if test -x $libexecdir/mysqld</font></div><div><font size="2"   >&nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; daemon=$libexecdir/mysqld</font></div><div><font size="2"   >&nbsp; &nbsp; elif test -x $sbindir/mysqld</font></div><div><font size="2"   >&nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; daemon=$sbindir/mysqld</font></div><div><font size="2"   >&nbsp; &nbsp; elif test -x `which mysqld`</font></div><div><font size="2"   >&nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; daemon=`which mysqld`</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_failure_msg "Unable to locate the mysqld binary!"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; exit 1</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; help_out=`$daemon --help 2&gt;&amp;1`; r=$?</font></div><div><font size="2"   >&nbsp; &nbsp; if test "$r" != 0 ; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_failure_msg "$help_out"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_failure_msg "There are syntax errors in the server configuration. Please fix them!"</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_success_msg "Syntax OK"</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; exit $r</font></div><div><font size="2"   >&nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; 'bootstrap')</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # Bootstrap the cluster, start the first node</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # that initiate the cluster</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; echo $echo_n "Bootstrapping the cluster"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; $0 start $other_args --wsrep-new-cluster</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   >&nbsp; *)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # usage</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; basename=`basename "$0"`</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; echo "Usage: $basename &nbsp;{start|stop|restart|reload|force-reload|status|configtest|bootstrap} &nbsp;[ MySQL server options ]"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; exit 1</font></div><div><font size="2"   >&nbsp; &nbsp; ;;</font></div><div><font size="2"   >esac</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >exit 0</font></div><p></p></pre></div></div><div>启动相关 :&nbsp;</div><div>默认以mysqld_safe启动数据库, 没有初始化集群的情况下会自动初始化(例如第一次启动mysql).</div><div>datadir建议指定, 否则就是默认的/var/lib/mysql, (见脚本)</div><div><pre class="prettyprint"   ><div><font size="2"   >case "$mode" in</font></div><div><font size="2"   >&nbsp; 'start')</font></div><div><font size="2"   >&nbsp; &nbsp; # Start daemon</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; # Safeguard (relative paths, core dumps..)</font></div><div><font size="2"   >&nbsp; &nbsp; cd $basedir</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; echo $echo_n "Starting MySQL"</font></div><div><font size="2"   >&nbsp; &nbsp; if test -x $bindir/mysqld_safe</font></div><div><font size="2"   >&nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # Give extra arguments to mysqld with the my.cnf file. This script</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # may be overwritten at next upgrade.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; $bindir/mysqld_safe --datadir="$datadir" --pid-file="$mysqld_pid_file_path" $other_args &gt;/dev/null 2&gt;&amp;1 &amp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; wait_for_ready; return_value=$?</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; # Make lock for RedHat / SuSE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if test -w "$lockdir"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; touch "$lock_file_path"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; exit $return_value</font></div><div><font size="2"   >&nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; log_failure_msg "Couldn't find MySQL server ($bindir/mysqld_safe)"</font></div><div><font size="2"   >&nbsp; &nbsp; fi</font></div><div><font size="2"   >&nbsp; &nbsp; ;;</font></div><p></p></pre></div><div>启动后 :&nbsp;</div><div>注意mysqld_safe还在, 同时调用mysqld启动了mysql server.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@mariadb usr]# ps -ewf|grep mysql</font></div><div><font size="2"   >root &nbsp; &nbsp; &nbsp; &nbsp; 444 &nbsp; &nbsp; &nbsp; 1 &nbsp;0 17:24 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 /bin/sh /usr/bin/mysqld_safe --datadir=/var/lib/mysql --pid-file=/var/lib/mysql/mariadb.pid</font></div><div><font size="2"   >mysql &nbsp; &nbsp; &nbsp; &nbsp;558 &nbsp; &nbsp; 444 &nbsp;0 17:24 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 /usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --user=mysql --log-error=/var/lib/mysql/mariadb.err --pid-file=/var/lib/mysql/mariadb.pid --wsrep_start_position=00000000-0000-0000-0000-000000000000:-1</font></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://mariadb.com/kb/en/mariadb/documentation/getting-started/starting-and-stopping-mariadb/mysqlserver/"   >https://mariadb.com/kb/en/mariadb/documentation/getting-started/starting-and-stopping-mariadb/mysqlserver/</a></div><div>2.&nbsp;/etc/init.d/mysql</div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201411533051172/"   >http://blog.163.com/digoal@126/blog/static/163877040201411533051172/</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="MySQL server sysv script - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>