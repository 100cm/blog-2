<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Install ZFS on CentOS use yum</h2>
	<h5 id="">2014-06-17 10:31:08&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201451332042136/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>使用打包好的安装, 好处是加了dkms支持. 一些配置也都弄好了.</div><div><br></div><div>以centos 6.x为例</div><div><div>需要访问外网.</div><div><font size="2"   color="#99cc00"   >$ sudo yum localinstall --nogpgcheck http://archive.zfsonlinux.org/epel/zfs-release$(rpm -E %dist).noarch.rpm</font></div><div><font size="2"   color="#99cc00"   >$ sudo yum install zfs&nbsp;</font></div></div><div><br></div><div>如果你的机子仅仅只能临时出外网的话,&nbsp;<span style="line-height: 28px;"   >用完建议重命名.</span></div><div><span style="line-height: 28px;"   >下次要用的时候, 先申请出外网的权限再把它改回去.</span></div><div><font size="2"   color="#99cc00"   >[root@db- ~]# cd /etc/yum.repos.d/</font></div><div><div><font size="2"   color="#99cc00"   >[root@db- yum.repos.d]# ll</font></div><div><font size="2"   color="#99cc00"   >total 16</font></div><div><font size="2"   color="#99cc00"   >-rw-r--r--. 1 root root 2081 Mar 14 14:27 CentOS6-Base-skymobi_San_Dun.repo</font></div><div><font size="2"   color="#99cc00"   >-rw-r--r--. 1 root root 1109 Mar 14 14:27 epel6-skymobi_San_Dun.repo</font></div><div><font size="2"   color="#99cc00"   >drwxr-xr-x &nbsp;2 root root 4096 Mar 14 14:30 repos_back</font></div><div><font size="2"   color="#99cc00"   >-rw-r--r-- &nbsp;1 root root &nbsp;771 May 31 05:14 zfs.repo</font></div><div><font size="2"   color="#99cc00"   >[root@db- yum.repos.d]# mv zfs.repo zfs.repo.bak</font></div></div><div><font size="2"   color="#99cc00"   ><br></font></div><div><font size="3"   >使用yum安装的话, 自动添加init.d服务.</font></div><div><div><font size="2"   color="#ff0000"   >[root@db-172-16-3-150 src]# chkconfig --list|grep zfs</font></div><div><font size="2"   color="#ff0000"   >zfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0:off &nbsp; 1:off &nbsp; 2:on &nbsp; &nbsp;3:on &nbsp; &nbsp;4:on &nbsp; &nbsp;5:on &nbsp; &nbsp;6:off</font></div><div><div><font size="2"   color="#ff0000"   >[root@db-172-16-3-150 src]# cat /etc/init.d/zfs</font></div><div><font size="2"   color="#ff0000"   >#!/bin/bash</font></div><div><font size="2"   color="#ff0000"   >#</font></div><div><font size="2"   color="#ff0000"   ># zfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; This script will mount/umount the zfs filesystems.</font></div><div><font size="2"   color="#ff0000"   >#</font></div><div><font size="2"   color="#ff0000"   ># chkconfig: &nbsp; &nbsp;2345 01 99</font></div><div><font size="2"   color="#ff0000"   ># description: &nbsp;This script will mount/umount the zfs filesystems during</font></div><div><font size="2"   color="#ff0000"   ># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; system boot/shutdown. &nbsp;Configuration of which filesystems</font></div><div><font size="2"   color="#ff0000"   ># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; should be mounted is handled by the zfs 'mountpoint' and</font></div><div><font size="2"   color="#ff0000"   ># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'canmount' properties. &nbsp;See the zfs(8) man page for details.</font></div><div><font size="2"   color="#ff0000"   ># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; It is also responsible for all userspace zfs services.</font></div><div><font size="2"   color="#ff0000"   >#</font></div><div><font size="2"   color="#ff0000"   >### BEGIN INIT INFO</font></div><div><font size="2"   color="#ff0000"   ># Provides: zfs</font></div><div><font size="2"   color="#ff0000"   ># Required-Start:</font></div><div><font size="2"   color="#ff0000"   ># Required-Stop:</font></div><div><font size="2"   color="#ff0000"   ># Should-Start:</font></div><div><font size="2"   color="#ff0000"   ># Should-Stop:</font></div><div><font size="2"   color="#ff0000"   ># Default-Start: 2 3 4 5</font></div><div><font size="2"   color="#ff0000"   ># Default-Stop: 1</font></div><div><font size="2"   color="#ff0000"   ># Short-Description: Mount/umount the zfs filesystems</font></div><div><font size="2"   color="#ff0000"   ># Description: ZFS is an advanced filesystem designed to simplify managing</font></div><div><font size="2"   color="#ff0000"   ># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;and protecting your data. &nbsp;This service mounts the ZFS</font></div><div><font size="2"   color="#ff0000"   ># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;filesystems and starts all related zfs services.</font></div><div><font size="2"   color="#ff0000"   >### END INIT INFO</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >export PATH=/usr/local/sbin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >if [ -z "$init" ]; then</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; # Not interactive</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; grep -Eqi 'zfs=off|zfs=no' /proc/cmdline &amp;&amp; exit 3</font></div><div><font size="2"   color="#ff0000"   >fi</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   ># Source function library &amp; LSB routines</font></div><div><font size="2"   color="#ff0000"   >. /etc/rc.d/init.d/functions</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   ># script variables</font></div><div><font size="2"   color="#ff0000"   >RETVAL=0</font></div><div><font size="2"   color="#ff0000"   >ZFS="/sbin/zfs"</font></div><div><font size="2"   color="#ff0000"   >ZPOOL="/sbin/zpool"</font></div><div><font size="2"   color="#ff0000"   >ZPOOL_CACHE="/etc/zfs/zpool.cache"</font></div><div><font size="2"   color="#ff0000"   >servicename=zfs</font></div><div><font size="2"   color="#ff0000"   >LOCKFILE=/var/lock/subsys/$servicename</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   ># functions</font></div><div><font size="2"   color="#ff0000"   >zfs_installed() {</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; modinfo zfs &gt; /dev/null 2&gt;&amp;1 || return 5</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; $ZPOOL &nbsp;&gt; /dev/null 2&gt;&amp;1</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; [ $? == 127 ] &amp;&amp; return 5</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; $ZFS &nbsp; &nbsp;&gt; /dev/null 2&gt;&amp;1</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; [ $? == 127 ] &amp;&amp; return 5</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; return 0</font></div><div><font size="2"   color="#ff0000"   >}</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   ># i need a bash guru to simplify this, since this is copy and paste, but donno how</font></div><div><font size="2"   color="#ff0000"   ># to correctly dereference variable names in bash, or how to do this right</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   ># first parameter is a regular expression that filters fstab</font></div><div><font size="2"   color="#ff0000"   >read_fstab() {</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; unset FSTAB</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; n=0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; while read -r fs mntpnt fstype opts blah ; do</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fs=`printf '%b\n' "$fs"`</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FSTAB[$n]=$fs</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let n++</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; done &lt; &lt;(egrep "$1" /etc/fstab)</font></div><div><font size="2"   color="#ff0000"   >}</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >start()</font></div><div><font size="2"   color="#ff0000"   >{</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # Disable lockfile check</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # if [ -f "$LOCKFILE" ] ; then return 0 ; fi</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # check if ZFS is installed. &nbsp;If not, comply to FC standards and bail</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; zfs_installed || {</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action $"Checking if ZFS is installed: not installed" /bin/false</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 5</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # Requires selinux policy which has not been written.</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; if [ -r "/selinux/enforce" ] &amp;&amp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[ "$(cat /selinux/enforce)" = "1" ]; then</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action $"SELinux ZFS policy required: " /bin/false || return 6</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # Delay until all required block devices are present.</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; if [ -x /sbin/udevadm ]; then</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /sbin/udevadm settle</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; elif [ -x /sbin/udevsettle ]; then</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /sbin/udevsettle</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # load kernel module infrastructure</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; if ! grep -q zfs /proc/modules ; then</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action $"Loading kernel ZFS infrastructure: " modprobe zfs || return 5</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; sleep 1</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; action $"Mounting automounted ZFS filesystems: " $ZFS mount -a || return 152</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; action $"Exporting ZFS filesystems: " $ZFS share -a || return 153</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # Read fstab, try to mount zvols ignoring error</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; read_fstab "^/dev/(zd|zvol)"</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; template=$"Mounting volume %s registered in fstab: "</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; for volume in "${FSTAB[@]}" ; do</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string=`printf "$template" "$volume"`</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action "$string" mount "$volume" 2&gt;/dev/null || /bin/true</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; done</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # touch "$LOCKFILE"</font></div><div><font size="2"   color="#ff0000"   >}</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >stop()</font></div><div><font size="2"   color="#ff0000"   >{</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # Disable lockfile check</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # if [ ! -f "$LOCKFILE" ] ; then return 0 ; fi</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # check if ZFS is installed. &nbsp;If not, comply to FC standards and bail</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; zfs_installed || {</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; action $"Checking if ZFS is installed: not installed" /bin/false</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 5</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # the poweroff of the system takes care of this</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # but it never unmounts the root filesystem itself</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # shit</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; action $"Syncing ZFS filesystems: " sync</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# about the only thing we can do, and then we</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# hope that the umount process will succeed</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# unfortunately the umount process does not dismount</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# the root file system, there ought to be some way</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# we can tell zfs to just flush anything in memory</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# when a request to remount,ro comes in</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; #echo -n $"Unmounting ZFS filesystems: "</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; #$ZFS umount -a</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; #RETVAL=$?</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; #if [ $RETVAL -ne 0 ]; then</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # &nbsp; &nbsp; &nbsp; failure</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; # &nbsp; &nbsp; &nbsp; return 8</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; #fi</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; #success</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; rm -f "$LOCKFILE"</font></div><div><font size="2"   color="#ff0000"   >}</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   ># See how we are called</font></div><div><font size="2"   color="#ff0000"   >case "$1" in</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; start)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RETVAL=$?</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; stop)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stop</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RETVAL=$?</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; status)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lsmod | grep -q zfs || RETVAL=3</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $ZPOOL status &amp;&amp; echo &amp;&amp; $ZFS list || {</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ -f "$LOCKFILE" ] &amp;&amp; RETVAL=2 || RETVAL=4</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; restart)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stop</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; condrestart)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if [ -f "$LOCKFILE" ] ; then</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stop</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; start</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fi</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; *)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo $"Usage: $0 {start|stop|status|restart|condrestart}"</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RETVAL=3</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;</font></div><div><font size="2"   color="#ff0000"   >esac</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >exit $RETVAL</font></div></div></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://zfsonlinux.org/epel.html"   >http://zfsonlinux.org/epel.html</a></div></div>
	</div>
</div>
</body>
</html>