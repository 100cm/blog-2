<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">migrate OS shadow to OpenLDAP, or NEW o, ou, cn, uid to OpenLDAP</h2>
	<h5 id="">2014-06-06 15:24:44&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201454112329931/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>前面一篇BLOG讲了一下使用源码安装openldap, 本文将讲一讲openldap的使用, 例如将操作系统本地的账号转移到ldap进行管理.</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014548315577/"   >http://blog.163.com/digoal@126/blog/static/1638770402014548315577/</a></div><div><br></div><div>LDAP可以认为是简化的X.500.</div><div>支持的BACKEND如下, (即存储LDAP数据的后端), 有伯克利DB, 文件, mdb(为了将替换bdb), RDBMS等.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Backends do the actual work of storing or retrieving data in response to LDAP requests. Backends may be compiled statically into slapd, or when module support is enabled, they may be dynamically loaded.</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >SLAPD Backend Options:</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-backends &nbsp; &nbsp; enable all available backends no|yes|mod</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-bdb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;enable Berkeley DB backend no|yes|mod [yes]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-dnssrv &nbsp; &nbsp; &nbsp; enable dnssrv backend no|yes|mod [no]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-hdb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;enable Hierarchical DB backend no|yes|mod [yes]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-ldap &nbsp; &nbsp; &nbsp; &nbsp; enable ldap backend no|yes|mod [no]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-mdb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;enable mdb database backend no|yes|mod [yes]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-meta &nbsp; &nbsp; &nbsp; &nbsp; enable metadirectory backend no|yes|mod [no]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-monitor &nbsp; &nbsp; &nbsp;enable monitor backend no|yes|mod [yes]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-ndb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;enable MySQL NDB Cluster backend no|yes|mod [no]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-null &nbsp; &nbsp; &nbsp; &nbsp; enable null backend no|yes|mod [no]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-passwd &nbsp; &nbsp; &nbsp; enable passwd backend no|yes|mod [no]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-perl &nbsp; &nbsp; &nbsp; &nbsp; enable perl backend no|yes|mod [no]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-relay &nbsp; &nbsp; &nbsp; &nbsp;enable relay backend no|yes|mod [yes]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-shell &nbsp; &nbsp; &nbsp; &nbsp;enable shell backend no|yes|mod [no]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-sock &nbsp; &nbsp; &nbsp; &nbsp; enable sock backend no|yes|mod [no]</font></div><div><font size="2"   >&nbsp; &nbsp; --enable-sql &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;enable sql backend no|yes|mod [no]</font></div></div><p></p></pre></div><div><br></div><div>openldap支持两种配置, ldap.conf以及/etc/openldap/slapd.d/*的配置.</div><div>当配置并存时, 后者优先级更高. 同时也推荐使用后者配置, 后者支持动态变更, 不需要重启slapd服务.</div><div><pre class="prettyprint"   ><p><font size="2"   >In Red Hat Enterprise Linux 6, the slapd service uses a configuration database located in the /etc/openldap/slapd.d/ directory and only reads the old /etc/openldap/slapd.conf configuration file if this directory does not exist.</font></p></pre></div><div><br></div><div>首先介绍一下openldap服务端的安装和配置</div><div>本例用到的环境</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >basename</font></div><div><span style="line-height: 28px;"   ><font size="2"   >dc=my-domain,dc=com</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >openldap server</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >cn=Manager</font></span></div><p></p></pre></div><div>安装</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum install -y &nbsp;openldap-servers</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 slapd.d]# ll /var/lib/ldap</font></div><div><font size="2"   >total 0</font></div><div><font size="2"   >[root@db-172-16-3-150 slapd.d]# ll /etc/openldap</font></div><div><font size="2"   >total 8</font></div><div><font size="2"   >drwxr-xr-x 2 root root 4096 Jun &nbsp;5 13:58 schema</font></div><div><font size="2"   >drwx------ 3 ldap ldap 4096 Jun &nbsp;5 13:58 slapd.d</font></div><p></p></pre></div><div>生成一个openldap的管理密码</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# slappasswd&nbsp;</font></div><div><font size="2"   >New password: 123321</font></div><div><font size="2"   >Re-enter new password: 123321</font></div><div><font size="2"   >{SSHA}A++Un6b7izDiLILyXO1XP2cnOCdRFKcX</font></div><p></p></pre></div><div><br></div><div>注意/var/lib/ldap目录的uid, gid必须是ldap, slapd服务是通过ldap用户启动的</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# ll /var/lib/ldap</font></div><div><font size="2"   >[root@db-172-16-3-150 slapd.d]# stat /var/lib/ldap</font></div><div><font size="2"   >&nbsp; File: `/var/lib/ldap'</font></div><div><font size="2"   >&nbsp; Size: 4096 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Blocks: 8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IO Block: 4096 &nbsp; directory</font></div><div><font size="2"   >Device: 821h/2081d &nbsp; &nbsp; &nbsp;Inode: 1196136 &nbsp; &nbsp; Links: 2</font></div><div><font size="2"   >Access: (0700/drwx------) &nbsp;Uid: ( &nbsp; 55/ &nbsp; &nbsp;ldap) &nbsp; Gid: ( &nbsp; 55/ &nbsp; &nbsp;ldap)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# ps -ewf|grep slap<br>ldap     16760     1  0 14:42 ?        00:00:00 /usr/sbin/slapd -h  ldap:/// ldaps:/// ldapi:/// -u ldap</font></div><p></p></pre></div><div><br></div><div>如果不是的话, 修改一下</div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# chown -R ldap:ldap /var/lib/ldap</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >停止slapd服务</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# service slapd stop</font></div><div></div><p></p></pre></div><div>全局配置</div><div>Changing the Global Configuration</div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 slapd.d]# ll /etc/openldap/slapd.d/</font></div><div><font size="2"   >total 8</font></div><div><font size="2"   >drwx------ 3 ldap ldap 4096 Jun &nbsp;5 14:14 cn=config</font></div><div><font size="2"   >-rw------- 1 ldap ldap 1131 Jun &nbsp;5 13:58 cn=config.ldif</font></div><div><font size="2"   >[root@db-172-16-3-150 slapd.d]# ll /etc/openldap/slapd.d/cn\=config</font></div><div><font size="2"   >total 72</font></div><div><font size="2"   >drwx------ 2 ldap ldap &nbsp;4096 Jun &nbsp;5 13:58 cn=schema</font></div><div><font size="2"   >-rw------- 1 ldap ldap 51896 Jun &nbsp;5 13:58 cn=schema.ldif</font></div><div><font size="2"   >-rw------- 1 ldap ldap &nbsp; 592 Jun &nbsp;5 13:58 olcDatabase={0}config.ldif</font></div><div><font size="2"   >-rw------- 1 ldap ldap &nbsp; 525 Jun &nbsp;5 13:58 olcDatabase={-1}frontend.ldif</font></div><div><font size="2"   >-rw------- 1 ldap ldap &nbsp; 622 Jun &nbsp;5 13:58 olcDatabase={1}monitor.ldif</font></div><div><font size="2"   >-rw------- 1 ldap ldap &nbsp;1251 Jun &nbsp;5 14:07 olcDatabase={2}bdb.ldif</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# cat /etc/openldap/slapd.d/cn\=config.ldif&nbsp;</font></div><div><font size="2"   >dn: cn=config</font></div><div><font size="2"   >objectClass: olcGlobal</font></div><div><font size="2"   >cn: config</font></div><div><font size="2"   >olcConfigFile: /etc/openldap/slapd.conf.bak</font></div><div><font size="2"   >olcConfigDir: /etc/openldap/slapd.d</font></div><div><font size="2"   >olcAllows: bind_v2 update_anon</font></div><div><font size="2"   >olcDisallows: bind_anon</font></div><div><font size="2"   >olcArgsFile: /var/run/openldap/slapd.args</font></div><div><font size="2"   >olcAttributeOptions: lang-</font></div><div><font size="2"   >olcAuthzPolicy: none</font></div><div><font size="2"   >olcConcurrency: 0</font></div><div><font size="2"   >olcConnMaxPending: 100</font></div><div><font size="2"   >olcConnMaxPendingAuth: 1000</font></div><div><font size="2"   >olcGentleHUP: FALSE</font></div><div><font size="2"   >olcIdleTimeout: 180</font></div><div><font size="2"   >olcIndexSubstrIfMaxLen: 4</font></div><div><font size="2"   >olcIndexSubstrIfMinLen: 2</font></div><div><font size="2"   >olcIndexSubstrAnyLen: 4</font></div><div><font size="2"   >olcIndexSubstrAnyStep: 2</font></div><div><font size="2"   >olcIndexIntLen: 4</font></div><div><font size="2"   >olcLocalSSF: 71</font></div><div><font size="2"   >olcPidFile: /var/run/openldap/slapd.pid</font></div><div><font size="2"   >olcLogFile: /var/log/slapd.log</font></div><div><font size="2"   >olcReadOnly: FALSE</font></div><div><font size="2"   >olcReverseLookup: FALSE</font></div><div><font size="2"   >olcSaslSecProps: noplain,noanonymous</font></div><div><font size="2"   >olcSockbufMaxIncoming: 262143</font></div><div><font size="2"   >olcSockbufMaxIncomingAuth: 16777215</font></div><div><font size="2"   >olcThreads: 16</font></div><div><font size="2"   >olcTLSCACertificatePath: /etc/openldap/certs</font></div><div><font size="2"   >olcTLSCertificateFile: "OpenLDAP Server"</font></div><div><font size="2"   >olcTLSCertificateKeyFile: /etc/openldap/certs/password</font></div><div><font size="2"   >olcTLSVerifyClient: never</font></div><div><font size="2"   >olcToolThreads: 1</font></div><div><font size="2"   >olcWriteTimeout: 180</font></div><div><font size="2"   >structuralObjectClass: olcGlobal</font></div><div><font size="2"   >entryUUID: 38436698-80c2-1033-80ab-9bf6e6cc3d6d</font></div><div><font size="2"   >creatorsName: cn=config</font></div><div><font size="2"   >createTimestamp: 20140605055854Z</font></div><div><font size="2"   >entryCSN: 20140605055854.319515Z#000000#000#000000</font></div><div><font size="2"   >modifiersName: cn=config</font></div><div><font size="2"   >modifyTimestamp: 20140605055854Z</font></div><p></p></pre></div><div><br></div><div>修改bdb的配置. readonly=false才能往里添加. 这里的密码是前面生成的管理密码. TLS加密文件后面再生成.</div><div>Changing the Database-Specific Configuration</div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /etc/openldap/slapd.d/cn=config/olcDatabase={2}bdb.ldif</font></div><div><font size="2"   >olcSuffix: dc=my-domain,dc=com</font></div><div><font size="2"   >olcReadOnly: FALSE</font></div><div><font size="2"   >olcRootDN: cn=Manager,dc=my-domain,dc=com</font></div><div><font size="2"   >olcRootPW: {SSHA}A++Un6b7izDiLILyXO1XP2cnOCdRFKcX</font></div><div><font size="2"   >olcTLSCertificateFile: /etc/openldap/ssl/slapdcert.pem</font></div><div><font size="2"   >olcTLSCertificateKeyFile: /etc/openldap/ssl/slapdkey.pem</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># vi /etc/openldap/slapd.d/cn\=config/olcDatabase\=\{1\}monitor.ldif</font></div><div><font size="2"   >dn: olcDatabase={1}monitor</font></div><div><font size="2"   >objectClass: olcDatabaseConfig</font></div><div><font size="2"   >olcDatabase: {1}monitor</font></div><div><font size="2"   >olcAccess: {0}to * &nbsp;by dn.base="gidNumber=0+uidNumber=0,cn=peercred,cn=externa</font></div><div><font size="2"   >&nbsp;l,cn=auth" read &nbsp;by dn.base="cn=manager,dc=my-domain,dc=com" read &nbsp;by * none</font></div><div><font size="2"   >olcAddContentAcl: FALSE</font></div><div><font size="2"   >olcLastMod: TRUE</font></div><div><font size="2"   >olcMaxDerefDepth: 15</font></div><div><font size="2"   >olcReadOnly: FALSE</font></div><div><font size="2"   >olcSyncUseSubentry: FALSE</font></div><div><font size="2"   >olcMonitoring: FALSE</font></div><div><font size="2"   >structuralObjectClass: olcDatabaseConfig</font></div><div><font size="2"   >entryUUID: 38442060-80c2-1033-80bb-9bf6e6cc3d6d</font></div><div><font size="2"   >creatorsName: cn=config</font></div><div><font size="2"   >createTimestamp: 20140605055854Z</font></div><div><font size="2"   >entryCSN: 20140605055854.319515Z#000000#000#000000</font></div><div><font size="2"   >modifiersName: cn=config</font></div><div><font size="2"   >modifyTimestamp: 20140605055854Z</font></div><p></p></pre></div><div><br></div><div>测试配置文件是否正确</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   ># slaptest -u</font></span></div><div><font size="2"   >config file testing succeeded</font></div><div></div><p></p></pre></div><div>配置使用TLS封装LDAP认证.</div><div>Encryption (LDAPS) using TLS</div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi /etc/sysconfig/ldap</font></div><div><font size="2"   ># Run slapd with -h "... ldaps:/// ..."</font></div><div><font size="2"   ># &nbsp; yes/no, default: no</font></div><div><font size="2"   >SLAPD_LDAPS=yes</font></div><p></p></pre></div><div><br></div><div>自己颁发证书, 产生公钥和私钥</div><div>Generate and configure keys</div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># mkdir /etc/openldap/ssl/</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># openssl req -new -x509 -nodes -out /etc/openldap/ssl/slapdcert.pem -keyout /etc/openldap/ssl/slapdkey.pem -days 3650</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Generating a 1024 bit RSA private key</font></div><div><font size="2"   >.....++++++</font></div><div><font size="2"   >.........................++++++</font></div><div><font size="2"   >writing new private key to '/etc/openldap/ssl/slapdkey.pem'</font></div><div><font size="2"   >-----</font></div><div><font size="2"   >You are about to be asked to enter information that will be incorporated</font></div><div><font size="2"   >into your certificate request.</font></div><div><font size="2"   >What you are about to enter is what is called a Distinguished Name or a DN.</font></div><div><font size="2"   >There are quite a few fields but you can leave some blank</font></div><div><font size="2"   >For some fields there will be a default value,</font></div><div><font size="2"   >If you enter '.', the field will be left blank.</font></div><div><font size="2"   >-----</font></div><div><font size="2"   >Country Name (2 letter code) [AU]:</font></div><div><font size="2"   >State or Province Name (full name) [Some-State]:</font></div><div><font size="2"   >Locality Name (eg, city) []:</font></div><div><font size="2"   >Organization Name (eg, company) [Internet Widgits Pty Ltd]:</font></div><div><font size="2"   >Organizational Unit Name (eg, section) []:</font></div><div><font size="2"   >Common Name (e.g. server FQDN or YOUR name) []:Manager.my-domain.com</font></div><div><font size="2"   >Email Address []:digoal@126.com</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># chown -R root:ldap /etc/openldap/ssl</font></div><div><font size="2"   ># chmod -R 750 /etc/openldap/ssl</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># service slapd start</font></div><div><font size="2"   >Starting slapd: [ &nbsp;OK &nbsp;]</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># netstat -lt |grep ldap</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 *:ldaps &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 *:ldap &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 *:ldaps &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 *:ldap &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># chkconfig slapd on</font></div><p></p></pre></div><div><br></div><div>检查ldap是否工作正常.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># ldapsearch -x -b '' -s base '(objectclass=*)' namingContexts</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># extended LDIF</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># LDAPv3</font></div><div><font size="2"   ># base &lt;&gt; with scope baseObject</font></div><div><font size="2"   ># filter: (objectclass=*)</font></div><div><font size="2"   ># requesting: namingContexts&nbsp;</font></div><div><font size="2"   >#</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >#</font></div><div><font size="2"   >dn:</font></div><div><font size="2"   >namingContexts: dc=my-domain,dc=com</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># search result</font></div><div><font size="2"   >search: 2</font></div><div><font size="2"   >result: 0 Success</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># numResponses: 2</font></div><div><font size="2"   ># numEntries: 1</font></div><p></p></pre></div><div><br></div><div><br></div><div>创建域, People, Group组织, 用于迁移操作系统的用户和组.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># cd ~</font></div><div><font size="2"   ># vi base.ldif&nbsp;</font></div><div><font size="2"   >dn: dc=my-domain,dc=com</font></div><div><font size="2"   >dc: my-domain</font></div><div><font size="2"   >objectClass: top</font></div><div><font size="2"   >objectClass: domain</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >dn: ou=People,dc=my-domain,dc=com</font></div><div><font size="2"   >ou: People</font></div><div><font size="2"   >objectClass: top</font></div><div><font size="2"   >objectClass: organizationalUnit</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >dn: ou=Group,dc=my-domain,dc=com</font></div><div><font size="2"   >ou: Group</font></div><div><font size="2"   >objectClass: top</font></div><div><font size="2"   >objectClass: organizationalUnit</font></div><p></p></pre></div><div><br></div><div>将base.ldif导入到ldap库.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapadd -x -W -D "cn=Manager,dc=my-domain,dc=com" -f ./base.ldif</font></div><div><font size="2"   >Enter LDAP Password:&nbsp;</font></div><div><font size="2"   >adding new entry "dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "ou=Group,dc=my-domain,dc=com"</font></div><p></p></pre></div><div><br></div><div>查找是否导入.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapsearch -xWD "cn=Manager,dc=my-domain,dc=com" -b "dc=my-domain,dc=com" "cn=user"</font></div><div><font size="2"   >Enter LDAP Password: 123321</font></div><div><font size="2"   ># extended LDIF</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># LDAPv3</font></div><div><font size="2"   ># base &lt;dc=my-domain,dc=com&gt; with scope subtree</font></div><div><font size="2"   ># filter: cn=user</font></div><div><font size="2"   ># requesting: ALL</font></div><div><font size="2"   >#</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># search result</font></div><div><font size="2"   >search: 2</font></div><div><font size="2"   >result: 0 Success</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># numResponses: 1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapsearch -xWD "cn=Manager,dc=my-domain,dc=com" -b "dc=my-domain,dc=com" "cn=People"</font></div><div><font size="2"   >Enter LDAP Password: 123321</font></div><div><font size="2"   ># extended LDIF</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># LDAPv3</font></div><div><font size="2"   ># base &lt;dc=my-domain,dc=com&gt; with scope subtree</font></div><div><font size="2"   ># filter: cn=People</font></div><div><font size="2"   ># requesting: ALL</font></div><div><font size="2"   >#</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># search result</font></div><div><font size="2"   >search: 2</font></div><div><font size="2"   >result: 0 Success</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># numResponses: 1</font></div><p></p></pre></div><div><br></div><div><br></div><div>迁移本地OS用户和组到ldap, 需要用到<span style="line-height: 28px;"   >migrationtools包</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum install -y migrationtools</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># vi /usr/share/migrationtools/migrate_common.ph</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># Default DNS domain</font></div><div><font size="2"   >$DEFAULT_MAIL_DOMAIN = "my-domain.com";</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># Default base</font></div><div><font size="2"   >$DEFAULT_BASE = "dc=my-domain,dc=com";</font></div><p></p></pre></div><div><br></div><div>迁移准备</div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# cd ~</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >生成用户ldif</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# /usr/share/migrationtools/migrate_passwd.pl /etc/passwd people.ldif</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >导入用户ldif</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapadd -x -W -D "cn=Manager,dc=my-domain,dc=com" -f people.ldif</font></div><div><font size="2"   >Enter LDAP Password:&nbsp;</font></div><div><font size="2"   >adding new entry "uid=root,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=bin,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=daemon,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=adm,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=lp,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=sync,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=shutdown,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=halt,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=mail,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=uucp,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=operator,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=games,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=gopher,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=ftp,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=nobody,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=dbus,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=rpc,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=vcsa,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=abrt,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=saslauth,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=postfix,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=rpcuser,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=nfsnobody,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=haldaemon,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=ntp,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=sshd,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=tcpdump,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=oprofile,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=rtkit,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=pulse,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=avahi-autoipd,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=gdm,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=pg93,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=pg90,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=avahi,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=stap-server,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=pg931,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=ldap,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=test,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=pg92,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=pg94,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=apache,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=nagios,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=digoal,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=pgxl,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=mysql,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=ricci,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=pegasus,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=cimsrvr,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=hacluster,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=otrs,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=mailnull,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=smmsp,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "uid=postgres,ou=People,dc=my-domain,dc=com"</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >生成组ldif</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# /usr/share/migrationtools/migrate_group.pl /etc/group group.ldif</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >导入组ldif</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapadd -x -W -D "cn=Manager,dc=my-domain,dc=com" -f group.ldif</font></div><div><font size="2"   >Enter LDAP Password:&nbsp;</font></div><div><font size="2"   >adding new entry "cn=root,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=bin,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=daemon,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=sys,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=adm,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=tty,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=disk,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=lp,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=mem,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=kmem,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=wheel,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=mail,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=uucp,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=man,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=games,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=gopher,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=video,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=dip,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=ftp,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=lock,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=audio,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=nobody,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=users,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=dbus,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=utmp,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=utempter,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=rpc,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=floppy,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=vcsa,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=abrt,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=cdrom,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=tape,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=dialout,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=cgred,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=saslauth,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=postdrop,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=postfix,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=wbpriv,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=rpcuser,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=nfsnobody,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=haldaemon,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=ntp,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=stapusr,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=stapsys,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=stapdev,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=sshd,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=tcpdump,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=slocate,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=oprofile,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=desktop_admin_r,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=desktop_user_r,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=rtkit,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=pulse,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=pulse-access,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=fuse,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=avahi-autoipd,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=gdm,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=pg93,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=pg90,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=avahi,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=stap-server,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=pg931,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=ldap,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=oinstall,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=dba,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=test,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=pg92,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=pg94,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=apache,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=nagios,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=nagcmd,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=digoal,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=pgxl,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=mysql,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=ricci,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=pegasus,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=cimsrvr,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=haclient,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=otrs,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=mailnull,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=smmsp,ou=Group,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >adding new entry "cn=postgres,ou=Group,dc=my-domain,dc=com"</font></div><p></p></pre></div><div><br></div><div>检查一下是否可以在ldap中查到刚导入的dn</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# id postgres</font></div><div><font size="2"   >uid=509(postgres) gid=512(postgres) groups=512(postgres)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapsearch -xWD "cn=Manager,dc=my-domain,dc=com" -b "dc=my-domain,dc=com" "cn=postgres"</font></div><div><font size="2"   >Enter LDAP Password:&nbsp;</font></div><div><font size="2"   ># extended LDIF</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># LDAPv3</font></div><div><font size="2"   ># base &lt;dc=my-domain,dc=com&gt; with scope subtree</font></div><div><font size="2"   ># filter: cn=postgres</font></div><div><font size="2"   ># requesting: ALL</font></div><div><font size="2"   >#</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># postgres, Group, my-domain.com</font></div><div><font size="2"   >dn: cn=postgres,ou=Group,dc=my-domain,dc=com</font></div><div><font size="2"   >objectClass: posixGroup</font></div><div><font size="2"   >objectClass: top</font></div><div><font size="2"   >cn: postgres</font></div><div><font size="2"   >userPassword:: e2NyeXB0fXg=</font></div><div><font size="2"   >gidNumber: 512</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># search result</font></div><div><font size="2"   >search: 2</font></div><div><font size="2"   >result: 0 Success</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># numResponses: 2</font></div><div><font size="2"   ># numEntries: 1</font></div><p></p></pre></div><div><br></div><div><br></div><div>手工生成一组 用户, 组, 密码</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# slappasswd -c crypt -s Digoal</font></div><div><font size="2"   >{CRYPT}crnjiBEuLUDuU</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi user01.ldif</font></div><div><font size="2"   >dn: uid=digoal,ou=People,dc=my-domain,dc=com</font></div><div><font size="2"   >uid: digoal</font></div><div><font size="2"   >cn: digoal</font></div><div><font size="2"   >objectClass: account</font></div><div><font size="2"   >objectClass: posixAccount</font></div><div><font size="2"   >objectClass: top</font></div><div><font size="2"   >objectClass: shadowAccount</font></div><div><font size="2"   >userPassword: {CRYPT}crnjiBEuLUDuU</font></div><div><font size="2"   >shadowLastChange: 14846</font></div><div><font size="2"   >shadowMax: 99999</font></div><div><font size="2"   >shadowWarning: 7</font></div><div><font size="2"   >loginShell: /bin/bash</font></div><div><font size="2"   >uidNumber: 513</font></div><div><font size="2"   >gidNumber: 513</font></div><div><font size="2"   >homeDirectory: /home/digoal</font></div><div><font size="2"   >gecos: digoal</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi group01.ldif</font></div><div><font size="2"   >dn: cn=digoal,ou=Group,dc=my-domain,dc=com</font></div><div><font size="2"   >objectClass: posixGroup</font></div><div><font size="2"   >objectClass: top</font></div><div><font size="2"   >cn: digoal</font></div><div><font size="2"   >userPassword: {crypt}x</font></div><div><font size="2"   >gidNumber: 513</font></div><p></p></pre></div><div><br></div><div><br></div><div>导入openldap, 如果已经存在的话, 可以删掉再导入</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapadd -x -W -D "cn=Manager,dc=my-domain,dc=com" -f user01.ldif</font></div><div><font size="2"   >Enter LDAP Password:&nbsp;</font></div><div><font size="2"   >adding new entry "uid=digoal,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   >ldap_add: Already exists (68)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapsearch -xWD "cn=Manager,dc=my-domain,dc=com" -b "dc=my-domain,dc=com" "cn=digoal"</font></div><div><font size="2"   >Enter LDAP Password:&nbsp;</font></div><div><font size="2"   ># extended LDIF</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># LDAPv3</font></div><div><font size="2"   ># base &lt;dc=my-domain,dc=com&gt; with scope subtree</font></div><div><font size="2"   ># filter: cn=digoal</font></div><div><font size="2"   ># requesting: ALL</font></div><div><font size="2"   >#</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># digoal, People, my-domain.com</font></div><div><font size="2"   >dn: uid=digoal,ou=People,dc=my-domain,dc=com</font></div><div><font size="2"   >uid: digoal</font></div><div><font size="2"   >cn: digoal</font></div><div><font size="2"   >objectClass: account</font></div><div><font size="2"   >objectClass: posixAccount</font></div><div><font size="2"   >objectClass: top</font></div><div><font size="2"   >objectClass: shadowAccount</font></div><div><font size="2"   >userPassword:: e2NyeXB0fSQ2JFpqcTdKVTY4JGJVOWc1TjZBdi43MmxGWS9zeGp5QTdnenNqMzZ</font></div><div><font size="2"   >&nbsp;CUmVzS0F4T3IvaGUxaGYvLy9oZ05HV2xzSTEvVVQ0a0FsQmROU040eEl3ZzJLWldNTXdadElCdG4u</font></div><div><font size="2"   >shadowLastChange: 16203</font></div><div><font size="2"   >shadowMin: 0</font></div><div><font size="2"   >shadowMax: 99999</font></div><div><font size="2"   >shadowWarning: 7</font></div><div><font size="2"   >loginShell: /bin/bash</font></div><div><font size="2"   >uidNumber: 507</font></div><div><font size="2"   >gidNumber: 510</font></div><div><font size="2"   >homeDirectory: /home/digoal</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># digoal, Group, my-domain.com</font></div><div><font size="2"   >dn: cn=digoal,ou=Group,dc=my-domain,dc=com</font></div><div><font size="2"   >objectClass: posixGroup</font></div><div><font size="2"   >objectClass: top</font></div><div><font size="2"   >cn: digoal</font></div><div><font size="2"   >userPassword:: e2NyeXB0fXg=</font></div><div><font size="2"   >gidNumber: 510</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># search result</font></div><div><font size="2"   >search: 2</font></div><div><font size="2"   >result: 0 Success</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># numResponses: 3</font></div><div><font size="2"   ># numEntries: 2</font></div><p></p></pre></div><div><br></div><div>导入</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapadd -x -W -D "cn=Manager,dc=my-domain,dc=com" -f user01.ldif</font></div><div><font size="2"   >Enter LDAP Password:&nbsp;</font></div><div><font size="2"   >adding new entry "uid=digoal,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   >ldap_add: Already exists (68)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapdelete -xW -D "cn=Manager,dc=my-domain,dc=com" "uid=digoal,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   >Enter LDAP Password:&nbsp;</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapadd -x -W -D "cn=Manager,dc=my-domain,dc=com" -f user01.ldif</font></div><div><font size="2"   >Enter LDAP Password:&nbsp;</font></div><div><font size="2"   >adding new entry "uid=digoal,ou=People,dc=my-domain,dc=com"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# ldapadd -x -W -D "cn=Manager,dc=my-domain,dc=com" -f group01.ldif</font></div><div><font size="2"   >Enter LDAP Password:&nbsp;</font></div><div><font size="2"   >adding new entry "cn=digoal,ou=Group,dc=my-domain,dc=com"</font></div><p></p></pre></div><div><br></div><div><br></div></div><span style="line-height: 28px;"   >[参考]</span><wbr style="line-height: 28px;"   ><div style="line-height: 28px;"   >1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.openldap.org/doc/admin24/backends.html"   >http://www.openldap.org/doc/admin24/backends.html</a></div><div style="line-height: 28px;"   >2. man slapd-mdb, slapd-sql ....</div><div style="line-height: 28px;"   >3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://w.gdu.me/wiki/sysadmin/OpenLDAPconfig.html"   >http://w.gdu.me/wiki/sysadmin/OpenLDAPconfig.html</a></div><div style="line-height: 28px;"   >4.&nbsp;<a target="_blank" rel="nofollow" href="http://blog.christophersmart.com/articles/openldap-how-to-fedora/"   >http://blog.christophersmart.com/articles/openldap-how-to-fedora/</a></div><div style="line-height: 28px;"   >5.&nbsp;<a target="_blank" rel="nofollow" href="http://directory.fedoraproject.org/wiki/Main_Page"   >http://directory.fedoraproject.org/wiki/Main_Page</a></div><div style="line-height: 28px;"   >6.&nbsp;<a target="_blank" rel="nofollow" href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/ch-Directory_Servers.html"   >https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/ch-Directory_Servers.html</a></div><div style="line-height: 28px;"   >7.&nbsp;<a target="_blank" rel="nofollow" href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/ch-Configuring_Authentication.html"   >https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/ch-Configuring_Authentication.html</a></div>8.&nbsp;<a target="_blank" rel="nofollow" href="http://quark.humbug.org.au/publications/ldap/ldap_tut.html"   >http://quark.humbug.org.au/publications/ldap/ldap_tut.html</a><br style="line-height: 28px;"   ><div style="line-height: 28px;"   >9.&nbsp;<a target="_blank" rel="nofollow" href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Directory_Server/9.0/index.html"   >https://access.redhat.com/site/documentation/en-US/Red_Hat_Directory_Server/9.0/index.html</a></div><div style="line-height: 28px;"   >10.&nbsp;<a target="_blank" rel="nofollow" href="http://www.zytrax.com/books/ldap/index.html"   >http://www.zytrax.com/books/ldap/index.html</a></div><div style="line-height: 28px;"   >11.&nbsp;<a target="_blank" rel="nofollow" href="http://grokbase.com/t/postgresql/pgsql-general/086x32w1ew/ldap-authentication"   >http://grokbase.com/t/postgresql/pgsql-general/086x32w1ew/ldap-authentication</a></div><div style="line-height: 28px;"   >12.&nbsp;<a target="_blank" rel="nofollow" href="http://www-06.ibm.com/jp/linux/tech/doc/attachments/openldap_install_v1.3.pdf"   >http://www-06.ibm.com/jp/linux/tech/doc/attachments/openldap_install_v1.3.pdf</a></div><div style="line-height: 28px;"   >13.&nbsp;<a target="_blank" rel="nofollow" href="http://www.cnblogs.com/gaojian/p/3336657.html"   >http://www.cnblogs.com/gaojian/p/3336657.html</a></div><div style="line-height: 28px;"   >14.&nbsp;<a target="_blank" rel="nofollow" href="https://secure.sqlmanager.net/en/articles/postgresql/654"   >https://secure.sqlmanager.net/en/articles/postgresql/654</a></div><div style="line-height: 28px;"   >15.&nbsp;<a target="_blank" rel="nofollow" href="http://itc.musc.edu/wiki/PostgreSQL"   >http://itc.musc.edu/wiki/PostgreSQL</a></div><div style="line-height: 28px;"   >16.&nbsp;<a target="_blank" rel="nofollow" href="http://paginas.fe.up.pt/~jvv/PERL/manual/site/lib/URI/ldap.html"   >http://paginas.fe.up.pt/~jvv/PERL/manual/site/lib/URI/ldap.html</a></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   ><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="migrate OS shadow to OpenLDAP, or NEW o, ou, cn, uid to OpenLDAP - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>