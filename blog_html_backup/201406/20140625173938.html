<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">ZFS module parameters in Linux (OR kernel parameter in FreeBSD or zfs-in-kernel OS)</h2>
	<h5 id="">2014-06-25 17:39:38&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020145253599111/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>ZFS 在linux中以模块的形式加载, ZFS的内核参数没有整合到linux内核参数中, 所以无法使用sysctl来修改.</div><div>只能通过修改模块的参数来变更这些参数.</div><div>ZFS内核参数的意义可参见modinfo $modname, 或者直接查看zfs源代码. 有些参数是根据系统读数设定的(如内存)</div><div><br></div><div><span style="line-height: 28px;"   >与Linux不同, 在FreeBSD里zfs是在内核中的, 所以这些参数可以通过sysctl.conf保存, 或使用sysctl -w直接修改.</span></div><div><br></div><div>例如我的一台安装了0.6.3 zfs的系统, CentOS 6.5 x64.</div><div>内存24GB</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># free</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;total &nbsp; &nbsp; &nbsp; used &nbsp; &nbsp; &nbsp; free &nbsp; &nbsp; shared &nbsp; &nbsp;buffers &nbsp; &nbsp; cached</font></div><div><font size="2"   >Mem: &nbsp; &nbsp; &nbsp;24530656 &nbsp; 20768340 &nbsp; &nbsp;3762316 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 115636 &nbsp; &nbsp;2609916</font></div><div><font size="2"   >-/+ buffers/cache: &nbsp; 18042788 &nbsp; &nbsp;6487868</font></div><div><font size="2"   >Swap: &nbsp; &nbsp; &nbsp;8388600 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;8388600</font></div><p></p></pre></div></div><div><br></div><div>zfs相关模块.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># lsmod|grep zfs</font></div><div><font size="2"   >zfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1195533 &nbsp;1&nbsp;</font></div><div><font size="2"   >zcommon &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;46278 &nbsp;1 zfs</font></div><div><font size="2"   >znvpair &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;80974 &nbsp;2 zfs,zcommon</font></div><div><font size="2"   >zavl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6925 &nbsp;1 zfs</font></div><div><font size="2"   >zunicode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;323159 &nbsp;1 zfs</font></div><div><font size="2"   >spl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 266655 &nbsp;5 zfs,zcommon,znvpair,zavl,zunicode</font></div><p></p></pre></div><div><br></div><div>zfs模块信息, parm是参数部分, 在FreeBSD里面, 这些参数可以通过sysctl.conf保存, 或使用sysctl -w直接修改.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># modinfo zfs</font></div><div><font size="2"   >filename: &nbsp; &nbsp; &nbsp; /lib/modules/2.6.32-431.el6.x86_64/extra/zfs.ko</font></div><div><font size="2"   >version: &nbsp; &nbsp; &nbsp; &nbsp;0.6.3-1</font></div><div><font size="2"   >license: &nbsp; &nbsp; &nbsp; &nbsp;CDDL</font></div><div><font size="2"   >author: &nbsp; &nbsp; &nbsp; &nbsp; Sun Microsystems/Oracle, Lawrence Livermore National Laboratory</font></div><div><font size="2"   >description: &nbsp; &nbsp;ZFS</font></div><div><font size="2"   >srcversion: &nbsp; &nbsp; C29A443E3D2B93F605A540B</font></div><div><font size="2"   >depends: &nbsp; &nbsp; &nbsp; &nbsp;spl,znvpair,zcommon,zunicode,zavl</font></div><div><font size="2"   >vermagic: &nbsp; &nbsp; &nbsp; 2.6.32-431.el6.x86_64 SMP mod_unload modversions&nbsp;</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zvol_inhibit_dev:Do not create zvol device nodes (uint)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zvol_major:Major number for zvol device (uint)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zvol_threads:Number of threads for zvol device (uint)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zvol_max_discard_blocks:Max number of blocks to discard (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zio_injection_enabled:Enable fault injection (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zio_bulk_flags:Additional flags to pass to bulk buffers (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zio_delay_max:Max zio millisec delay before posting event (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zio_requeue_io_start_cut_in_line:Prioritize requeued I/O (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_sync_pass_deferred_free:Defer frees starting in this pass (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_sync_pass_dont_compress:Don't compress starting in this pass (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_sync_pass_rewrite:Rewrite new bps starting in this pass (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zil_replay_disable:Disable intent logging replay (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_nocacheflush:Disable cache flushes (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zil_slog_limit:Max commit bytes to separate log device (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_read_chunk_size:Bytes to read per chunk (long)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_immediate_write_sz:Largest data block to write to zil (long)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_flags:Set additional debugging flags (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_recover:Set to attempt to recover from fatal errors (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_expire_snapshot:Seconds to expire .zfs/snapshot (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_aggregation_limit:Max vdev I/O aggregation size (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_read_gap_limit:Aggregate read I/O over gap (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_write_gap_limit:Aggregate write I/O over gap (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_max_active:Maximum number of active I/Os per vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_async_write_active_max_dirty_percent:Async write concurrency max threshold (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_async_write_active_min_dirty_percent:Async write concurrency min threshold (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_async_read_max_active:Max active async read I/Os per vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_async_read_min_active:Min active async read I/Os per vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_async_write_max_active:Max active async write I/Os per vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_async_write_min_active:Min active async write I/Os per vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_scrub_max_active:Max active scrub I/Os per vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_scrub_min_active:Min active scrub I/Os per vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_sync_read_max_active:Max active sync read I/Os per vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_sync_read_min_active:Min active sync read I/Os per vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_sync_write_max_active:Max active sync write I/Os per vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_sync_write_min_active:Min active sync write I/Osper vdev (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_mirror_switch_us:Switch mirrors every N usecs (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_scheduler:I/O scheduler (charp)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_cache_max:Inflate reads small than max (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_cache_size:Total size of the per-disk cache (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_vdev_cache_bshift:Shift size to inflate reads too (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_txg_timeout:Max seconds worth of delta per txg (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_read_history:Historic statistics for the last N reads (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_read_history_hits:Include cache hits in read history (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_txg_history:Historic statistics for the last N txgs (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_deadman_synctime_ms:Expiration time in milliseconds (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_deadman_enabled:Enable deadman timer (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spa_asize_inflation:SPA size estimate multiplication factor (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spa_config_path:SPA config file (/etc/zfs/zpool.cache) (charp)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_autoimport_disable:Disable pool import at module load (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; metaslab_debug_load:load all metaslabs during pool import (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; metaslab_debug_unload:prevent metaslabs from being unloaded (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_zevent_len_max:Max event queue length (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_zevent_cols:Max event column width (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_zevent_console:Log events to the console (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_top_maxinflight:Max I/Os per top-level (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_resilver_delay:Number of ticks to delay resilver (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_scrub_delay:Number of ticks to delay scrub (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_scan_idle:Idle window in clock ticks (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_scan_min_time_ms:Min millisecs to scrub per txg (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_free_min_time_ms:Min millisecs to free per txg (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_resilver_min_time_ms:Min millisecs to resilver per txg (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_no_scrub_io:Set to disable scrub I/O (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_no_scrub_prefetch:Set to disable scrub prefetching (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_dirty_data_max_percent:percent of ram can be dirty (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_dirty_data_max_max_percent:zfs_dirty_data_max upper bound as % of RAM (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_delay_min_dirty_percent:transaction delay threshold (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_dirty_data_max:determines the dirty space limit (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_dirty_data_max_max:zfs_dirty_data_max upper bound in bytes (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_dirty_data_sync:sync txg when this much dirty data (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_delay_scale:how quickly delay approaches infinity (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_prefetch_disable:Disable all ZFS prefetching (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfetch_max_streams:Max number of streams per zfetch (uint)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfetch_min_sec_reap:Min time before stream reclaim (uint)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfetch_block_cap:Max number of blocks to fetch at a time (uint)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfetch_array_rd_sz:Number of bytes in a array_read (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_pd_blks_max:Max number of blocks to prefetch (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_send_corrupt_data:Allow sending corrupt data (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_mdcomp_disable:Disable meta data compression (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_nopwrite_enabled:Enable NOP writes (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_dedup_prefetch:Enable prefetching dedup-ed blks (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_dbuf_state_index:Calculate arc header index (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_arc_min:Min arc size (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_arc_max:Max arc size (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_arc_meta_limit:Meta limit for arc size (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_arc_meta_prune:Bytes of meta data to prune (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_arc_grow_retry:Seconds before growing arc size (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_arc_p_aggressive_disable:disable aggressive arc_p grow (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_arc_p_dampener_disable:disable arc_p adapt dampener (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_arc_shrink_shift:log2(fraction of arc to reclaim) (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_disable_dup_eviction:disable duplicate buffer eviction (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_arc_memory_throttle_disable:disable memory throttle (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zfs_arc_min_prefetch_lifespan:Min life of prefetch block (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2arc_write_max:Max write bytes per interval (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2arc_write_boost:Extra write bytes during device warmup (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2arc_headroom:Number of max device writes to precache (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2arc_headroom_boost:Compressed l2arc_headroom multiplier (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2arc_feed_secs:Seconds between L2ARC writing (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2arc_feed_min_ms:Min feed interval in milliseconds (ulong)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2arc_noprefetch:Skip caching prefetched buffers (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2arc_nocompress:Skip compressing L2ARC buffers (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2arc_feed_again:Turbo L2ARC warmup (int)</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l2arc_norw:No reads during writes (int)</font></div><p></p></pre></div><div><br></div><div>如果要看模块对应的这些参数的值, 可以到/sys/module/$modname/parameters 中查看.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># cd /sys/module/zfs/parameters/</font></div><div><div><font size="2"   ># grep ".*" *</font></div><div><font size="2"   >l2arc_feed_again:1</font></div><div><font size="2"   >l2arc_feed_min_ms:200</font></div><div><font size="2"   >l2arc_feed_secs:1</font></div><div><font size="2"   >l2arc_headroom:2</font></div><div><font size="2"   >l2arc_headroom_boost:200</font></div><div><font size="2"   >l2arc_nocompress:0</font></div><div><font size="2"   >l2arc_noprefetch:1</font></div><div><font size="2"   >l2arc_norw:0</font></div><div><font size="2"   >l2arc_write_boost:8388608</font></div><div><font size="2"   >l2arc_write_max:8388608</font></div><div><font size="2"   >metaslab_debug_load:0</font></div><div><font size="2"   >metaslab_debug_unload:0</font></div><div><font size="2"   >spa_asize_inflation:24</font></div><div><font size="2"   >spa_config_path:/etc/zfs/zpool.cache</font></div><div><font size="2"   >zfetch_array_rd_sz:1048576</font></div><div><font size="2"   >zfetch_block_cap:256</font></div><div><font size="2"   >zfetch_max_streams:8</font></div><div><font size="2"   >zfetch_min_sec_reap:2</font></div><div><font size="2"   >zfs_arc_grow_retry:5</font></div><div><font size="2"   >zfs_arc_max:0</font></div><div><font size="2"   >zfs_arc_memory_throttle_disable:1</font></div><div><font size="2"   >zfs_arc_meta_limit:0</font></div><div><font size="2"   >zfs_arc_meta_prune:1048576</font></div><div><font size="2"   >zfs_arc_min:0</font></div><div><font size="2"   >zfs_arc_min_prefetch_lifespan:1000</font></div><div><font size="2"   >zfs_arc_p_aggressive_disable:1</font></div><div><font size="2"   >zfs_arc_p_dampener_disable:1</font></div><div><font size="2"   >zfs_arc_shrink_shift:5</font></div><div><font size="2"   >zfs_autoimport_disable:0</font></div><div><font size="2"   >zfs_dbuf_state_index:0</font></div><div><font size="2"   >zfs_deadman_enabled:1</font></div><div><font size="2"   >zfs_deadman_synctime_ms:1000000</font></div><div><font size="2"   >zfs_dedup_prefetch:1</font></div><div><font size="2"   >zfs_delay_min_dirty_percent:60</font></div><div><font size="2"   >zfs_delay_scale:500000</font></div><div><font size="2"   >zfs_dirty_data_max:2511939174</font></div><div><font size="2"   >zfs_dirty_data_max_max:6279847936</font></div><div><font size="2"   >zfs_dirty_data_max_max_percent:25</font></div><div><font size="2"   >zfs_dirty_data_max_percent:10</font></div><div><font size="2"   >zfs_dirty_data_sync:67108864</font></div><div><font size="2"   >zfs_disable_dup_eviction:0</font></div><div><font size="2"   >zfs_expire_snapshot:300</font></div><div><font size="2"   >zfs_flags:1</font></div><div><font size="2"   >zfs_free_min_time_ms:1000</font></div><div><font size="2"   >zfs_immediate_write_sz:32768</font></div><div><font size="2"   >zfs_mdcomp_disable:0</font></div><div><font size="2"   >zfs_nocacheflush:0</font></div><div><font size="2"   >zfs_nopwrite_enabled:1</font></div><div><font size="2"   >zfs_no_scrub_io:0</font></div><div><font size="2"   >zfs_no_scrub_prefetch:0</font></div><div><font size="2"   >zfs_pd_blks_max:100</font></div><div><font size="2"   >zfs_prefetch_disable:0</font></div><div><font size="2"   >zfs_read_chunk_size:1048576</font></div><div><font size="2"   >zfs_read_history:0</font></div><div><font size="2"   >zfs_read_history_hits:0</font></div><div><font size="2"   >zfs_recover:0</font></div><div><font size="2"   >zfs_resilver_delay:2</font></div><div><font size="2"   >zfs_resilver_min_time_ms:3000</font></div><div><font size="2"   >zfs_scan_idle:50</font></div><div><font size="2"   >zfs_scan_min_time_ms:1000</font></div><div><font size="2"   >zfs_scrub_delay:4</font></div><div><font size="2"   >zfs_send_corrupt_data:0</font></div><div><font size="2"   >zfs_sync_pass_deferred_free:2</font></div><div><font size="2"   >zfs_sync_pass_dont_compress:5</font></div><div><font size="2"   >zfs_sync_pass_rewrite:2</font></div><div><font size="2"   >zfs_top_maxinflight:32</font></div><div><font size="2"   >zfs_txg_history:0</font></div><div><font size="2"   >zfs_txg_timeout:5</font></div><div><font size="2"   >zfs_vdev_aggregation_limit:131072</font></div><div><font size="2"   >zfs_vdev_async_read_max_active:3</font></div><div><font size="2"   >zfs_vdev_async_read_min_active:1</font></div><div><font size="2"   >zfs_vdev_async_write_active_max_dirty_percent:60</font></div><div><font size="2"   >zfs_vdev_async_write_active_min_dirty_percent:30</font></div><div><font size="2"   >zfs_vdev_async_write_max_active:10</font></div><div><font size="2"   >zfs_vdev_async_write_min_active:1</font></div><div><font size="2"   >zfs_vdev_cache_bshift:16</font></div><div><font size="2"   >zfs_vdev_cache_max:16384</font></div><div><font size="2"   >zfs_vdev_cache_size:0</font></div><div><font size="2"   >zfs_vdev_max_active:1000</font></div><div><font size="2"   >zfs_vdev_mirror_switch_us:10000</font></div><div><font size="2"   >zfs_vdev_read_gap_limit:32768</font></div><div><font size="2"   >zfs_vdev_scheduler:noop</font></div><div><font size="2"   >zfs_vdev_scrub_max_active:2</font></div><div><font size="2"   >zfs_vdev_scrub_min_active:1</font></div><div><font size="2"   >zfs_vdev_sync_read_max_active:10</font></div><div><font size="2"   >zfs_vdev_sync_read_min_active:10</font></div><div><font size="2"   >zfs_vdev_sync_write_max_active:10</font></div><div><font size="2"   >zfs_vdev_sync_write_min_active:10</font></div><div><font size="2"   >zfs_vdev_write_gap_limit:4096</font></div><div><font size="2"   >zfs_zevent_cols:80</font></div><div><font size="2"   >zfs_zevent_console:0</font></div><div><font size="2"   >zfs_zevent_len_max:128</font></div><div><font size="2"   >zil_replay_disable:0</font></div><div><font size="2"   >zil_slog_limit:1048576</font></div><div><font size="2"   >zio_bulk_flags:0</font></div><div><font size="2"   >zio_delay_max:30000</font></div><div><font size="2"   >zio_injection_enabled:0</font></div><div><font size="2"   >zio_requeue_io_start_cut_in_line:1</font></div><div><font size="2"   >zvol_inhibit_dev:0</font></div><div><font size="2"   >zvol_major:230</font></div><div><font size="2"   >zvol_max_discard_blocks:16384</font></div><div><font size="2"   >zvol_threads:32</font></div></div><p></p></pre></div><div><br></div><div>这些文件可以直接修改. 例如&nbsp;echo 1 &gt;/sys/module/zfs/parameters/zfs_prefetch_disable</div><div>如果要重启生效的话, 可以修改/dev/modprobe.d/$modname.conf 如 /dev/modprobe.d/zfs.conf.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># cd /sys/module/zfs/parameters/</font></div><div><font size="2"   ># cat zvol_threads</font></div><div><font size="2"   ># modinfo zfs|grep zvol_threads</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zvol_threads:Number of threads for zvol device (uint)</font></div><div><font size="2"   ># vi /etc/modprobe.d/zfs.conf</font></div><div><font size="2"   >options zfs zvol_threads=64</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># modinfo spl|grep spl_kmem_cache_slab_limit</font></div><div><font size="2"   >parm: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spl_kmem_cache_slab_limit:Objects less than N bytes use the Linux slab (uint)</font></div><div><div><font size="2"   ># cat /sys/module/spl/parameters/spl_kmem_cache_slab_limit</font></div><div><font size="2"   >0</font></div></div><div><font size="2"   ># vi /etc/modprobe.d/spl.conf</font></div><div><font size="2"   >options spl spl_kmem_cache_slab_limit=16384</font></div><p></p></pre></div><div>修改后重启操作系统. 查看是否生效.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># cat /sys/module/spl/parameters/spl_kmem_cache_slab_limit</font></div><div><font size="2"   >16384</font></div></div><div><div><font size="2"   ># cat /sys/module/zfs/parameters/zvol_threads</font></div><div><font size="2"   >64</font></div></div><p></p></pre></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://zfsonlinux.org/"   >http://zfsonlinux.org/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://open-zfs.org/wiki/Main_Page"   >http://open-zfs.org/wiki/Main_Page</a></div><div>3.&nbsp;zfs-0.6.3/module/zfs</div><div>4.&nbsp;<span style="line-height: 28px;"   >Brian的回复</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >You can set these like any other module parameter on Linux. &nbsp;If you want&nbsp;</font></div><div><font size="2"   >them to be persistent the easiest way is to add them to a zfs.conf file&nbsp;</font></div><div><font size="2"   >in /etc/modprobe.d/. &nbsp;For example something like this.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >$ cat /etc/modprobe.d/zfs.conf</font></div><div><font size="2"   >options spl spl_kmem_cache_slab_limit=16384</font></div><div><font size="2"   >options spl spl_kmem_cache_reclaim=0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Alternately, the ones which are runtime tunable can be set directly&nbsp;</font></div><div><font size="2"   >though /sys/module/zfs/parameters/. &nbsp;Something like</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >echo 1 &gt;/sys/module/zfs/parameters/zfs_prefetch_disable</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Hope that helps.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Thanks,</font></div><div><font size="2"   >Brian</font></div><p></p></pre></div><div><br></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="ZFS module parameters in Linux (OR kernel parameter in FreeBSD or zfs-in-kernel OS) - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>