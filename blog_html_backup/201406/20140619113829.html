<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">ZFS 12*SATA JBOD vs MSA 2312FC 24*SAS</h2>
	<h5 id="">2014-06-19 11:38:29&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020145199591814/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>今天拿了两台主机PK一下zfs和存储的性能.</div><div>ZFS主机</div><div>联想 Reno/Raleigh</div><div>8核&nbsp;Intel(R) Xeon(R) CPU E5-2407 0 @ 2.20GHz</div><div>24GB内存</div><div>12*SATA 2TB, 其中2块RAID1, 另外10块作为zpool (raidz 9 + spare 1 + raid1的一个分区作为log)</div><div>文件系统特殊项atime=off, compression=lz4 压缩比 约3.16</div><div><br></div><div>存储主机</div><div>DELL R610</div><div>16核&nbsp;Intel(R) Xeon(R) CPU &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; E5630 &nbsp;@ 2.53GHz</div><div>32GB内存</div><div>存储2台MSA2312FC, 分别12块300G SAS盘. 10块做的RAID 10. 2块hot spare.</div><div><br></div>其中一台存储的配置<wbr><div><div><font size="2"   color="#ff0000"   >Controllers</font></div><div><font size="2"   color="#ff0000"   >-----------</font></div><div><font size="2"   color="#ff0000"   >Controller ID: A</font></div><div><font size="2"   color="#ff0000"   >Serial Number: 3CL947R707</font></div><div><font size="2"   color="#ff0000"   >Hardware Version: 56</font></div><div><font size="2"   color="#ff0000"   >CPLD Version: 8</font></div><div><font size="2"   color="#ff0000"   >Disks: 12</font></div><div><font size="2"   color="#ff0000"   >Vdisks: 1</font></div><div><font size="2"   color="#ff0000"   >Cache Memory Size (MB): 1024</font></div><div><font size="2"   color="#ff0000"   >Host Ports: 2</font></div><div><font size="2"   color="#ff0000"   >Disk Channels: 2</font></div><div><font size="2"   color="#ff0000"   >Disk Bus Type: SAS</font></div><div><font size="2"   color="#ff0000"   >Status: Running</font></div><div><font size="2"   color="#ff0000"   >Failed Over: No</font></div><div><font size="2"   color="#ff0000"   >Fail Over Reason: Not applicable</font></div></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><div><font size="2"   color="#ff0000"   ># show disks</font></div><div><font size="2"   color="#ff0000"   >Location Serial Number &nbsp; &nbsp; &nbsp; &nbsp; Vendor &nbsp; Rev &nbsp;How Used &nbsp; Type &nbsp; Size &nbsp; &nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; Rate(Gb/s) &nbsp;SP Status &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >-----------------------------------------------------------------------</font></div><div><font size="2"   color="#ff0000"   >1.1 &nbsp; &nbsp; &nbsp;3QP2EN7V00009006CJT4 &nbsp;SEAGATE &nbsp;0004 VDISK VRSC SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.2 &nbsp; &nbsp; &nbsp;3QP232CM00009952PTMA &nbsp;SEAGATE &nbsp;0004 VDISK VRSC SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.3 &nbsp; &nbsp; &nbsp;3QP2GKLZ00009008V1VA &nbsp;SEAGATE &nbsp;0004 VDISK VRSC SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.4 &nbsp; &nbsp; &nbsp;3QP2G2LL00009008WAYU &nbsp;SEAGATE &nbsp;0004 VDISK VRSC SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.5 &nbsp; &nbsp; &nbsp;3QP2EN0700009007DAPA &nbsp;SEAGATE &nbsp;0004 VDISK VRSC SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.6 &nbsp; &nbsp; &nbsp;3QP2G6AE00009008V39E &nbsp;SEAGATE &nbsp;0004 VDISK VRSC SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.7 &nbsp; &nbsp; &nbsp;6SJ4ZX1S0000N239DF6Q &nbsp;SEAGATE &nbsp;0008 GLOBAL SP &nbsp;SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.8 &nbsp; &nbsp; &nbsp;6SJ4ZTLT0000N239FM3P &nbsp;SEAGATE &nbsp;0008 VDISK VRSC SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.9 &nbsp; &nbsp; &nbsp;6SJ4ZY6H0000N2407XKP &nbsp;SEAGATE &nbsp;0008 VDISK VRSC SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.10 &nbsp; &nbsp; 3QP2FVR100009008Z16H &nbsp;SEAGATE &nbsp;0004 VDISK VRSC SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.11 &nbsp; &nbsp; 3QP2DZEX00009008WBN9 &nbsp;SEAGATE &nbsp;0004 VDISK VRSC SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >1.12 &nbsp; &nbsp; 3QP2CXWS00009008WBLN &nbsp;SEAGATE &nbsp;0004 GLOBAL SP &nbsp;SAS &nbsp; &nbsp;300.0GB&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 3.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;OK &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >-----------------------------------------------------------------------</font></div></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><div><font size="2"   color="#ff0000"   >Name Size &nbsp; &nbsp; Free &nbsp; &nbsp;Own Pref &nbsp; RAID &nbsp; Disks Spr Chk &nbsp;Status Jobs &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; Serial Number &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   color="#ff0000"   >------------------------------------------------------------------------</font></div><div><font size="2"   color="#ff0000"   >vd01 1498.4GB 100.4GB A &nbsp; A &nbsp; &nbsp; &nbsp;RAID10 10 &nbsp; &nbsp;0 &nbsp; 16k &nbsp;FTOL &nbsp; VRSC 66% &nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; 00c0ffda61090000144de15100000000</font></div></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><div><font size="2"   color="#ff0000"   ># show cache</font></div><div><font size="2"   color="#ff0000"   >System Cache Parameters</font></div><div><font size="2"   color="#ff0000"   >-----------------------</font></div><div><font size="2"   color="#ff0000"   >Operation Mode: Active-Active ULP</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; Controller A Cache Parameters</font></div><div><font size="2"   color="#ff0000"   >&nbsp; -----------------------------</font></div><div><font size="2"   color="#ff0000"   >&nbsp; Write Back Status: Enabled</font></div><div><font size="2"   color="#ff0000"   >&nbsp; CompactFlash Status: Installed</font></div><div><font size="2"   color="#ff0000"   >&nbsp; Cache Flush: Enabled</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; Controller B Cache Parameters</font></div><div><font size="2"   color="#ff0000"   >&nbsp; -----------------------------</font></div><div><font size="2"   color="#ff0000"   >&nbsp; Write Back Status: Enabled</font></div><div><font size="2"   color="#ff0000"   >&nbsp; CompactFlash Status: Installed</font></div><div><font size="2"   color="#ff0000"   >&nbsp; Cache Flush: Enabled</font></div></div><div><br></div><div>存储文件系统</div><div><div><font size="2"   color="#ff0000"   >[root@db- ~]# lvs</font></div><div><font size="2"   color="#ff0000"   >&nbsp; LV &nbsp; VG &nbsp; &nbsp; &nbsp; Attr &nbsp; LSize &nbsp; &nbsp;Origin Snap% &nbsp;Move Log Copy% &nbsp;Convert</font></div><div><font size="2"   color="#ff0000"   >&nbsp; lv01 vgdata01 -wi-ao &nbsp;300.00G &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; lv02 vgdata01 -wi-ao &nbsp;100.00G &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; lv03 vgdata01 -wi-ao &nbsp; &nbsp;1.17T &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; lv04 vgdata01 -wi-ao 1001.99G &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   color="#ff0000"   >[root@db- ~]# pvs</font></div><div><font size="2"   color="#ff0000"   >&nbsp; PV &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VG &nbsp; &nbsp; &nbsp; Fmt &nbsp;Attr PSize PFree</font></div><div><font size="2"   color="#ff0000"   >&nbsp; /dev/mpath/d09_msa1_vd01vol01 vgdata01 lvm2 a-- &nbsp;1.27T &nbsp; &nbsp;0&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; /dev/mpath/d09_msa2_vd01vol01 vgdata01 lvm2 a-- &nbsp;1.27T &nbsp; &nbsp;0&nbsp;</font></div></div><div>使用ext4, noatime, nodiratime加载.</div><div><br></div><div>测试场景是PostgreSQL 9.2.8</div><div>目前只测试了读速度, 因为zfs这台是流复制备机. (数据库配置完全一致)</div><div>zfs下18G表的COUNT查询</div><div><div><font size="2"   color="#ff0000"   >digoal=&gt; select count(*) from tbl;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; count &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >----------</font></div><div><font size="2"   color="#ff0000"   >&nbsp;48391818</font></div><div><font size="2"   color="#ff0000"   >(1 row)</font></div><div><font size="2"   color="#ff0000"   >Time: 9998.065 ms</font></div></div><div><br></div><div>存储下的查询</div><div><div style="line-height: 28px;"   ><font size="2"   color="#ff0000"   >digoal=&gt; select count(*) from tbl;</font></div><div style="line-height: 28px;"   ><font size="2"   color="#ff0000"   >&nbsp; count &nbsp;&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   color="#ff0000"   >----------</font></div><div style="line-height: 28px;"   ><font size="2"   color="#ff0000"   >&nbsp;48391818</font></div><div style="line-height: 28px;"   ><font size="2"   color="#ff0000"   >(1 row)</font></div></div><div><font size="2"   color="#ff0000"   >Time: 64707.770 ms</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="3"   ><span style="line-height: 22.75px;"   >这个测试数据在ZFS中LZ4压缩算法后缩小了2.5倍左右.</span></font></div><div><div><font size="2"   color="#ff0000"   >pg_relation_filepath &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >-------------------------------------------------</font></div><div><font size="2"   color="#ff0000"   >&nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356</font></div><div style="font-size: medium;"   ><br></div></div><div><div><font size="2"   color="#ff0000"   >&gt; ll -h pg_tblspc/16384/PG_9.2_201204301/70815/10088356*</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 00:59 pg_tblspc/16384/PG_9.2_201204301/70815/10088356</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 04:24 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.1</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 01:21 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.10</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 05:15 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.11</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 04:52 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.12</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 01:50 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.13</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 04:22 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.14</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 03:32 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.15</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 02:05 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.16</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 575M Jun 19 04:26 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.17</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 04:30 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.2</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 01:27 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.3</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 03:24 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.4</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 00:52 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.5</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 03:39 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.6</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 04:53 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.7</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 00:49 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.8</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 1.0G Jun 19 05:14 pg_tblspc/16384/PG_9.2_201204301/70815/10088356.9</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 4.5M Jun 19 03:38 pg_tblspc/16384/PG_9.2_201204301/70815/10088356_fsm</font></div><div><font size="2"   color="#ff0000"   >-rw------- 1 postgres postgres 288K Jun 19 05:12 pg_tblspc/16384/PG_9.2_201204301/70815/10088356_vm</font></div><div><div><font size="2"   color="#ff0000"   >du -sh pg_tblspc/16384/PG_9.2_201204301/70815/10088356*</font></div><div><font size="2"   color="#ff0000"   >415M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356</font></div><div><font size="2"   color="#ff0000"   >405M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.1</font></div><div><font size="2"   color="#ff0000"   >427M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.10</font></div><div><font size="2"   color="#ff0000"   >428M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.11</font></div><div><font size="2"   color="#ff0000"   >425M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.12</font></div><div><font size="2"   color="#ff0000"   >425M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.13</font></div><div><font size="2"   color="#ff0000"   >427M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.14</font></div><div><font size="2"   color="#ff0000"   >427M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.15</font></div><div><font size="2"   color="#ff0000"   >428M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.16</font></div><div><font size="2"   color="#ff0000"   >237M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.17</font></div><div><font size="2"   color="#ff0000"   >403M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.2</font></div><div><font size="2"   color="#ff0000"   >413M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.3</font></div><div><font size="2"   color="#ff0000"   >427M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.4</font></div><div><font size="2"   color="#ff0000"   >432M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.5</font></div><div><font size="2"   color="#ff0000"   >423M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.6</font></div><div><font size="2"   color="#ff0000"   >425M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.7</font></div><div><font size="2"   color="#ff0000"   >433M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.8</font></div><div><font size="2"   color="#ff0000"   >428M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356.9</font></div><div><font size="2"   color="#ff0000"   >3.5M &nbsp; &nbsp;pg_tblspc/16384/PG_9.2_201204301/70815/10088356_fsm</font></div><div><font size="2"   color="#ff0000"   >36K &nbsp; &nbsp; pg_tblspc/16384/PG_9.2_201204301/70815/10088356_vm</font></div></div></div><div><br></div><div>写速度测试补充</div><div>测试模型 :&nbsp;</div><div><div><font size="2"   color="#ff0000"   >postgres=# create table test (id int primary key, info text, crt_time timestamp);</font></div><div><font size="2"   color="#ff0000"   >CREATE TABLE</font></div><div><font size="2"   color="#ff0000"   >postgres=# create or replace function f(v_id int) returns void as&nbsp;</font></div><div><font size="2"   color="#ff0000"   >$$</font></div><div><font size="2"   color="#ff0000"   >declare</font></div><div><font size="2"   color="#ff0000"   >begin</font></div><div><font size="2"   color="#ff0000"   >&nbsp; update test set info=md5(now()::text),crt_time=now() where id=v_id;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; if not found then</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; insert into test values (v_id, md5(now()::text), now()); &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; end if;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; return;</font></div><div><font size="2"   color="#ff0000"   >&nbsp; exception when others then</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; return;</font></div><div><font size="2"   color="#ff0000"   >end;</font></div><div><font size="2"   color="#ff0000"   >$$ language plpgsql strict;</font></div><div><font size="2"   color="#ff0000"   >CREATE FUNCTION</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >$ vi test.sql</font></div><div><font size="2"   color="#ff0000"   >\setrandom vid 1 5000000</font></div><div><font size="2"   color="#ff0000"   >select f(:vid);</font></div><div>测试结果</div><div>ZFS结果</div><div><font color="#ff0000"   size="2"   >pgbench -M prepared -n -r -f ./test.sql -c 8 -j 4 -T 30</font></div><div><font color="#ff0000"   size="2"   >transaction type: Custom query</font></div><div><font color="#ff0000"   size="2"   >scaling factor: 1</font></div><div><font color="#ff0000"   size="2"   >query mode: prepared</font></div><div><font color="#ff0000"   size="2"   >number of clients: 8</font></div><div><font color="#ff0000"   size="2"   >number of threads: 4</font></div><div><font color="#ff0000"   size="2"   >duration: 30 s</font></div><div><font color="#ff0000"   size="2"   >number of transactions actually processed: 1529642</font></div><div><font color="#ff0000"   size="2"   >tps = 50987.733547 (including connections establishing)</font></div><div><font color="#ff0000"   size="2"   >tps = 50998.421896 (excluding connections establishing)</font></div><div><font color="#ff0000"   size="2"   >statement latencies in milliseconds:</font></div><div><font color="#ff0000"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.002064 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom vid 1 5000000</font></div><div><font color="#ff0000"   size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.153280 &nbsp; &nbsp; &nbsp; &nbsp;select f(:vid);</font></div><div><font color="#ff0000"   size="2"   ><div>postgres=# select count(*) from test;</div><div>&nbsp; count &nbsp;</div><div>---------</div><div>&nbsp;1317641</div><div>(1 row)</div></font></div><div>存储主机结果</div><div><font size="2"   color="#ff0000"   >pgbench -M prepared -n -r -f ./test.sql -c 8 -j 4 -T 30</font></div><div><font size="2"   color="#ff0000"   >transaction type: Custom query</font></div><div><font size="2"   color="#ff0000"   >scaling factor: 1</font></div><div><font size="2"   color="#ff0000"   >query mode: prepared</font></div><div><font size="2"   color="#ff0000"   >number of clients: 8</font></div><div><font size="2"   color="#ff0000"   >number of threads: 4</font></div><div><font size="2"   color="#ff0000"   >duration: 30 s</font></div><div><font size="2"   color="#ff0000"   >number of transactions actually processed: 717486</font></div><div><font size="2"   color="#ff0000"   >tps = 23915.516813 (including connections establishing)</font></div><div><font size="2"   color="#ff0000"   >tps = 23921.744263 (excluding connections establishing)</font></div><div><font size="2"   color="#ff0000"   >statement latencies in milliseconds:</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003088 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom vid 1 5000000</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.328250 &nbsp; &nbsp; &nbsp; &nbsp;select f(:vid);</font></div></div><div><div style="color: rgb(255, 0, 0); font-size: small;"   >postgres=# select count(*) from test;</div><div style="color: rgb(255, 0, 0); font-size: small;"   >&nbsp;count &nbsp;</div><div style="color: rgb(255, 0, 0); font-size: small;"   >--------</div><div style="color: rgb(255, 0, 0); font-size: small;"   >&nbsp;668395</div><div style="color: rgb(255, 0, 0); font-size: small;"   >(1 row)</div><div style="color: rgb(255, 0, 0); font-size: small;"   ><br></div><div><font size="3"   >[其他]</font></div><div><font size="3"   >1. 有slog和没有slog的pg_test_fsync的测试结果</font></div></div><div><font size="3"   >有slog</font></div><div><div><font size="2"   color="#ff0000"   >pg_test_fsync</font></div><div><font size="2"   color="#ff0000"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Compare file sync methods using one 8kB write:</font></div><div><font size="2"   color="#ff0000"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   color="#ff0000"   >is Linux's default)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 303.897 ops/sec &nbsp; &nbsp;3291 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 329.612 ops/sec &nbsp; &nbsp;3034 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >* This file system and its mount options do not support direct</font></div><div><font size="2"   color="#ff0000"   >I/O, e.g. ext4 in journaled mode.</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Compare file sync methods using two 8kB writes:</font></div><div><font size="2"   color="#ff0000"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   color="#ff0000"   >is Linux's default)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 328.331 ops/sec &nbsp; &nbsp;3046 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 326.671 ops/sec &nbsp; &nbsp;3061 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >* This file system and its mount options do not support direct</font></div><div><font size="2"   color="#ff0000"   >I/O, e.g. ext4 in journaled mode.</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Compare open_sync with different write sizes:</font></div><div><font size="2"   color="#ff0000"   >(This is designed to compare the cost of writing 16kB</font></div><div><font size="2"   color="#ff0000"   >in different write open_sync sizes.)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font size="2"   color="#ff0000"   >(If the times are similar, fsync() can sync data written</font></div><div><font size="2"   color="#ff0000"   >on a different descriptor.)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 324.818 ops/sec &nbsp; &nbsp;3079 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 325.872 ops/sec &nbsp; &nbsp;3069 usecs/op</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Non-Sync'ed 8kB writes:</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 78023.363 ops/sec &nbsp; &nbsp; &nbsp;13 usecs/op</font></div><div style="font-size: medium;"   ><span style="line-height: 28px;"   ><br></span></div><div style="font-size: medium;"   ><span style="line-height: 28px;"   >没有slog</span></div></div><div><div><font size="2"   color="#ff0000"   >pg_test_fsync&nbsp;</font></div><div><font size="2"   color="#ff0000"   >5 seconds per test</font></div><div><font size="2"   color="#ff0000"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Compare file sync methods using one 8kB write:</font></div><div><font size="2"   color="#ff0000"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   color="#ff0000"   >is Linux's default)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 325.150 ops/sec &nbsp; &nbsp;3076 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 320.737 ops/sec &nbsp; &nbsp;3118 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >* This file system and its mount options do not support direct</font></div><div><font size="2"   color="#ff0000"   >I/O, e.g. ext4 in journaled mode.</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Compare file sync methods using two 8kB writes:</font></div><div><font size="2"   color="#ff0000"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   color="#ff0000"   >is Linux's default)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 313.791 ops/sec &nbsp; &nbsp;3187 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 313.884 ops/sec &nbsp; &nbsp;3186 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >* This file system and its mount options do not support direct</font></div><div><font size="2"   color="#ff0000"   >I/O, e.g. ext4 in journaled mode.</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Compare open_sync with different write sizes:</font></div><div><font size="2"   color="#ff0000"   >(This is designed to compare the cost of writing 16kB</font></div><div><font size="2"   color="#ff0000"   >in different write open_sync sizes.)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font size="2"   color="#ff0000"   >(If the times are similar, fsync() can sync data written</font></div><div><font size="2"   color="#ff0000"   >on a different descriptor.)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 328.620 ops/sec &nbsp; &nbsp;3043 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 328.271 ops/sec &nbsp; &nbsp;3046 usecs/op</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Non-Sync'ed 8kB writes:</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 71741.498 ops/sec &nbsp; &nbsp; &nbsp;14 usecs/op</font></div><div style="font-size: medium;"   >通过iostat可以看到, 有SLOG时, pg_test_fsync全压到slog那个块设备了, 而没有slog的情况下, 压力都在vdev的块设备上, 这里是raidz所以, 全部在所有的设备上.</div><div style="font-size: medium;"   >如果slog改成ssd, pg_test_fsync将会有很好的表现. 例如使用/dev/shm模拟ssd</div><div><font size="2"   color="#ff0000"   ># cd /dev/shm</font></div><div><font size="2"   color="#ff0000"   ># dd if=/dev/zero of=./test.img bs=1k count=2048000</font></div><div><font size="2"   color="#ff0000"   ># zpool add zp1 log /dev/shm/test.img&nbsp;</font></div><div><div><font size="2"   color="#ff0000"   ># zpool status</font></div><div><font size="2"   color="#ff0000"   >&nbsp; pool: zp1</font></div><div><font size="2"   color="#ff0000"   >&nbsp;state: ONLINE</font></div><div><font size="2"   color="#ff0000"   >&nbsp; scan: none requested</font></div><div><font size="2"   color="#ff0000"   >config:</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STATE &nbsp; &nbsp; READ WRITE CKSUM</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; zp1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; raidz1-0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sda &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sde &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdf &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdh &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; logs</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /dev/shm/test.img &nbsp;ONLINE &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; spares</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdj &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AVAIL&nbsp;</font></div></div><div style="font-size: medium;"   >使用内存作为slog后, fsync显然提高了.</div><div><div><font size="2"   color="#ff0000"   >pg_test_fsync&nbsp;</font></div><div><font size="2"   color="#ff0000"   >5 seconds per test</font></div><div><font size="2"   color="#ff0000"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Compare file sync methods using one 8kB write:</font></div><div><font size="2"   color="#ff0000"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   color="#ff0000"   >is Linux's default)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6695.657 ops/sec &nbsp; &nbsp; 149 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8079.750 ops/sec &nbsp; &nbsp; 124 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >* This file system and its mount options do not support direct</font></div><div><font size="2"   color="#ff0000"   >I/O, e.g. ext4 in journaled mode.</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Compare file sync methods using two 8kB writes:</font></div><div><font size="2"   color="#ff0000"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   color="#ff0000"   >is Linux's default)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6247.616 ops/sec &nbsp; &nbsp; 160 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3140.959 ops/sec &nbsp; &nbsp; 318 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >* This file system and its mount options do not support direct</font></div><div><font size="2"   color="#ff0000"   >I/O, e.g. ext4 in journaled mode.</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Compare open_sync with different write sizes:</font></div><div><font size="2"   color="#ff0000"   >(This is designed to compare the cost of writing 16kB</font></div><div><font size="2"   color="#ff0000"   >in different write open_sync sizes.)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a*</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font size="2"   color="#ff0000"   >(If the times are similar, fsync() can sync data written</font></div><div><font size="2"   color="#ff0000"   >on a different descriptor.)</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6330.570 ops/sec &nbsp; &nbsp; 158 usecs/op</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6989.741 ops/sec &nbsp; &nbsp; 143 usecs/op</font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="2"   color="#ff0000"   >Non-Sync'ed 8kB writes:</font></div><div><font size="2"   color="#ff0000"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 77800.273 ops/sec &nbsp; &nbsp; &nbsp;13 usecs/op</font></div></div><div style="font-size: medium;"   ><br></div><div style="font-size: medium;"   >不过这里要说一下, 如果PostgreSQL 关闭了synchronous_commit, 其实普通盘的slog就够用了.</div><div style="font-size: medium;"   >后面的写测试就是很好的证明.</div></div><div><br></div><div><font size="3"   >2. 创建zpool的块设备最好是by-id的, 因为在Linux下设备名可能发生变更. 例如/dev/sda重启后可能变成了/dev/sdb</font></div><div><font size="3"   >对于slog, 这是不允许的, 将导致数据崩溃.</font></div><div><font size="3"   >查看by-id</font></div><div><div><font size="2"   color="#ff0000"   ># ll /dev/disk/by-id/*</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064b0a6dc -&gt; ../../sdd</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064b0a6dc-part1 -&gt; ../../sdd1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064b0a6dc-part9 -&gt; ../../sdd9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064b563d5 -&gt; ../../sda</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064b563d5-part1 -&gt; ../../sda1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064b563d5-part9 -&gt; ../../sda9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bbc776 -&gt; ../../sde</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bbc776-part1 -&gt; ../../sde1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bbc776-part9 -&gt; ../../sde9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bbf23b -&gt; ../../sdh</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bbf23b-part1 -&gt; ../../sdh1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bbf23b-part9 -&gt; ../../sdh9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bbfc66 -&gt; ../../sdf</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bbfc66-part1 -&gt; ../../sdf1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bbfc66-part9 -&gt; ../../sdf9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bc046a -&gt; ../../sdj</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bc046a-part1 -&gt; ../../sdj1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bc046a-part9 -&gt; ../../sdj9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bf56da -&gt; ../../sdc</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bf56da-part1 -&gt; ../../sdc1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bf56da-part9 -&gt; ../../sdc9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bf65dd -&gt; ../../sdb</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bf65dd-part1 -&gt; ../../sdb1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064bf65dd-part9 -&gt; ../../sdb9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064c02880 -&gt; ../../sdi</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064c02880-part1 -&gt; ../../sdi1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064c02880-part9 -&gt; ../../sdi9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064c04f5a -&gt; ../../sdg</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064c04f5a-part1 -&gt; ../../sdg1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-35000c50064c04f5a-part9 -&gt; ../../sdg9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-3600605b0079e70801b0e33ff07ebffa3 -&gt; ../../sdk</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-3600605b0079e70801b0e33ff07ebffa3-part1 -&gt; ../../sdk1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-3600605b0079e70801b0e33ff07ebffa3-part2 -&gt; ../../sdk2</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/scsi-3600605b0079e70801b0e33ff07ebffa3-part3 -&gt; ../../sdk3</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 12:43 /dev/disk/by-id/scsi-3600605b0079e70801b0e33ff07ebffa3-part4 -&gt; ../../sdk4</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064b0a6dc -&gt; ../../sdd</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064b0a6dc-part1 -&gt; ../../sdd1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064b0a6dc-part9 -&gt; ../../sdd9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064b563d5 -&gt; ../../sda</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064b563d5-part1 -&gt; ../../sda1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064b563d5-part9 -&gt; ../../sda9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bbc776 -&gt; ../../sde</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bbc776-part1 -&gt; ../../sde1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bbc776-part9 -&gt; ../../sde9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bbf23b -&gt; ../../sdh</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bbf23b-part1 -&gt; ../../sdh1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bbf23b-part9 -&gt; ../../sdh9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bbfc66 -&gt; ../../sdf</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bbfc66-part1 -&gt; ../../sdf1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bbfc66-part9 -&gt; ../../sdf9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bc046a -&gt; ../../sdj</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bc046a-part1 -&gt; ../../sdj1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bc046a-part9 -&gt; ../../sdj9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bf56da -&gt; ../../sdc</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bf56da-part1 -&gt; ../../sdc1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bf56da-part9 -&gt; ../../sdc9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bf65dd -&gt; ../../sdb</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bf65dd-part1 -&gt; ../../sdb1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064bf65dd-part9 -&gt; ../../sdb9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064c02880 -&gt; ../../sdi</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064c02880-part1 -&gt; ../../sdi1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064c02880-part9 -&gt; ../../sdi9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064c04f5a -&gt; ../../sdg</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064c04f5a-part1 -&gt; ../../sdg1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x5000c50064c04f5a-part9 -&gt; ../../sdg9</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root &nbsp;9 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x600605b0079e70801b0e33ff07ebffa3 -&gt; ../../sdk</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x600605b0079e70801b0e33ff07ebffa3-part1 -&gt; ../../sdk1</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x600605b0079e70801b0e33ff07ebffa3-part2 -&gt; ../../sdk2</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 &nbsp;2014 /dev/disk/by-id/wwn-0x600605b0079e70801b0e33ff07ebffa3-part3 -&gt; ../../sdk3</font></div><div><font size="2"   color="#ff0000"   >lrwxrwxrwx 1 root root 10 Jun 19 12:43 /dev/disk/by-id/wwn-0x600605b0079e70801b0e33ff07ebffa3-part4 -&gt; ../../sdk4</font></div></div><div><font size="3"   >如果已经使用了/dev/sd*, 可以删除后重新加入.</font></div><div><font size="2"   color="#ff0000"   ># zpool remove zp1 /dev/sdk4</font></div><div><font size="2"   color="#ff0000"   ># zpool add zp1 log /dev/disk/by-id/scsi-3600605b0079e70801b0e33ff07ebffa3-part4</font></div><div><font size="3"   >slog一般不需要太大. 有几个G就差不多了. L2ARC则越大越好.</font></div><div><font size="3"   ><br></font></div><div><font size="2"   color="#ff0000"   ><br></font></div><div><font size="3"   >[小结]</font></div><div><font size="3"   >测试面比较窄, 但是反映了一些问题.</font></div><div><font size="3"   >1. 因为使用了SLOG, 所以ZFS写性能超出了这样配置的存储. 所以还是比较适合用作数据库的.</font></div><div><font size="3"   >2. 因为这里的读测试还没有超出内存大小. 显然还不能说明问题. 超出内存后18G表的查询需要70秒左右.&nbsp;</font><span style="line-height: 28px; font-size: medium;"   >如果加上SSD作为L2ARC的话, 读性能还能有提高.</span><span style="line-height: 28px; font-size: medium;"   >&nbsp;</span></div><div><span style="line-height: 28px; font-size: medium;"   >3. 使用zfs压缩后, 存储空间是小了, 同时还要考虑压缩和解压带来的延迟和CPU开销.&nbsp;</span></div><div><span style="line-height: 28px; font-size: medium;"   >4. slog很重要, 最好mirror , 如果底层是raid的话, 可以不mirror. 这里的用内存作为例子千万别模仿, 我只是模仿ssd.</span></div><div><br></div><div>[参考<span style="line-height: 28px;"   >]</span></div><div><span style="line-height: 28px;"   >1.&nbsp;</span><a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://blog.163.com/digoal@126/blog/#m=0&amp;t=1&amp;c=fks_084075085094080071084086083095085080082075083081086071084"   >http://blog.163.com/digoal@126/blog/#m=0&amp;t=1&amp;c=fks_084075085094080071084086083095085080082075083081086071084</a></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="ZFS 12*SATA JBOD vs MSA 2312FC 24*SAS - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>