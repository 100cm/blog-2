<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Create Database using Create Database SQL Command</h2>
	<h5 id="">2010-06-05 13:12:53&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020105511253773/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">创建ORACLE数据库有几种比较常用的方法：<div>1. 图形界面下使用DBCA，可以选择使用模板或者自定义（自定义需要执行创建数据字典和存储过程的过程，而模板的话是使用DBMS包作恢复的安装。所以速度上差别比较大）</div><div>2. 命令行的DBCA与responseFile</div><div>3. Create Database SQL命令，然后执行创建数据字典和存储过程，所以速度会略微慢点。</div><div>据David说考OCM的话考的是CREATE DATABASE SQL建库的过程。一般情况下DBA可能为了图快使用的都是DBCA和模板的方法来建库的。对于create database 命令可能会比较生疏。</div><div><span style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px;">今天刚好在上海上OCM实训班，</span>借此机会来学习一下CREATE DATABASE SQL COMMAND。</div><div>首先来了解一下create database command命令的结构(摘自&nbsp;<span style="font-family: Tahoma, sans-serif; line-height: normal; font-size: small;"><b style="line-height: 20px;">Oracle? Database SQL Reference&nbsp;<span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;">10<i style="line-height: 20px;">g</i>&nbsp;Release 2 (10.2)&nbsp;<span style="font-family: Arial, Helvetica, sans-serif; font-size: 14px; font-weight: normal; line-height: 22px;">):</span></b></span></b></span></div><div><div><img title="Create Database using Create Database SQL Command - 德哥(DiGoal,Just Do It!) - Not Only DBA" alt="Create Database using Create Database SQL Command - 德哥(DiGoal,Just Do It!) - Not Only DBA" style="margin:0 10px 0 0;" src="http://img237.ph.126.net/gM7sY9vbQdZlnXFN4tiPyQ==/1764003679047431932.gif"></div></div><div><br></div><div>ORACLE的命令解释一向都是非常的清晰。</div><div>大概分几个模块：</div><div>配置SYS , SYSTEM用户密码</div><div>配置控制文件</div><div>配置字符集</div><div>配置系统表空间，辅助表空间，默认表空间，临时表空间</div><div>配置日志</div><div>配置表空间特征</div><div>配置时区</div><div><br></div><div>好了，进入主题。</div><div>1. 配置数据库SYSDBA密码</div><div>su - oracle</div><div><div>Usage: orapwd file=&lt;fname&gt; password=&lt;password&gt; entries=&lt;users&gt; force=&lt;y/n&gt;&nbsp;</div><div>&nbsp;&nbsp;where</div><div>&nbsp;&nbsp; &nbsp;file - name of password file (mand),</div><div>&nbsp;&nbsp; &nbsp;password - password for SYS (mand),</div><div>&nbsp;&nbsp; &nbsp;entries - maximum number of distinct DBA and &nbsp; &nbsp; force - whether to overwrite existing file (opt),</div><div>OPERs (opt),&nbsp;</div><div>&nbsp;&nbsp;There are no spaces around the equal-to (=) character.</div><div>$ orapwd file=$ORACLE_HOME/dbs/orapw$SID password=oracle entries=10&nbsp;</div><div><br></div><div>2. 配置参数文件</div><div>使用模板建立参数文件：</div><div>模板在$ORACLE_HOME/dbs/init.ora</div><div>配置后如下：</div><div><div>vi $ORACLE_HOME/dbs/init$ORACLE_SID.ora</div><div>*.background_dump_dest='/opt/oracle/admin/digoal/bdump'</div><div>*.control_files='/database/oradata/digoal/control01.ctl','/database/oradata/digoal/control02.ctl'</div><div>*.core_dump_dest='/opt/oracle/admin/digoal/cdump'</div><div>*.db_file_multiblock_read_count=8</div><div>*.db_files=80</div><div>*.db_name='digoal'</div><div>*.global_names=TRUE</div><div>*.instance_name='digoal'</div><div>*.log_buffer=32768</div><div>*.parallel_max_servers=5</div><div>*.processes=50</div><div>*.sga_target=300M</div><div>*.undo_management='auto'</div><div>*.undo_tablespace='undotbs1'</div><div>*.user_dump_dest='/opt/oracle/admin/digoal/udump'</div><div><br></div><div>3. 创建bdump,cdump,adump,udump目录</div><div>su - root</div><div>mkdir -p $ORACLE_BASE/admin/$ORACLE_SID/bdump</div><div><div style="line-height: 22px;">mkdir -p $ORACLE_BASE/admin/$ORACLE_SID/cdump</div><div><div style="line-height: 22px;">mkdir -p $ORACLE_BASE/admin/$ORACLE_SID/udump</div><div><div style="line-height: 22px;">mkdir -p $ORACLE_BASE/admin/$ORACLE_SID/adump</div><div>chown -R oracle:oinstall $ORACLE_BASE/admin</div><div><br></div></div></div></div></div></div><div>4. 配置数据文件存放目录（或者使用RAW设备的话配置RAW设备路径）</div><div>su - root</div><div>mkdir -p /database/oradata</div><div>chown oracle:dba /database/oradata</div><div><br></div><div>5. nomount模式加载数据库</div><div>su - oracle</div><div>sqlplus "/ as sysdba"</div><div>startup nomount</div><div><br></div><div>6. 创建数据库</div><div><div>CREATE DATABASE digoal</div><div>&nbsp;&nbsp; USER SYS IDENTIFIED BY oracle</div><div>&nbsp;&nbsp; USER SYSTEM IDENTIFIED BY oracle</div><div>&nbsp;&nbsp; LOGFILE GROUP 1 ('/database/oradata/digoal/redo01.log') SIZE 50M,</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GROUP 2 ('/database/oradata/digoal/redo02.log') SIZE 50M,</div><div>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GROUP 3 ('/database/oradata/digoal/redo03.log') SIZE 50M</div><div>&nbsp;&nbsp; MAXLOGFILES 5</div><div>&nbsp;&nbsp; MAXLOGMEMBERS 5</div><div>&nbsp;&nbsp; MAXLOGHISTORY 1</div><div>&nbsp;&nbsp; MAXDATAFILES 100</div><div>&nbsp;&nbsp; MAXINSTANCES 1</div><div>&nbsp;&nbsp; CHARACTER SET UTF8</div><div>&nbsp;&nbsp; NATIONAL CHARACTER SET UTF8</div><div>&nbsp;&nbsp; noarchivelog | archivelog</div><div>&nbsp;&nbsp; EXTENT MANAGEMENT LOCAL</div><div>&nbsp;&nbsp; DATAFILE '/database/oradata/digoal/system01.dbf' SIZE 325M REUSE autoextend on next 10m maxsize 1024m</div><div>&nbsp;&nbsp; SYSAUX DATAFILE '/database/oradata/digoal/sysaux01.dbf' SIZE 325M REUSE autoextend on next 10m maxsize 1024m</div><div>&nbsp;&nbsp; DEFAULT TABLESPACE tbs_default</div><div>&nbsp;&nbsp; DATAFILE '/database/oradata/digoal/tbs_default01.dbf' SIZE 325M REUSE</div><div>&nbsp;&nbsp; DEFAULT TEMPORARY TABLESPACE tempts1</div><div>&nbsp;&nbsp; &nbsp; &nbsp;TEMPFILE '/database/oradata/digoal/temp01.dbf'&nbsp;</div><div>&nbsp;&nbsp; &nbsp; &nbsp;SIZE 20M REUSE&nbsp;</div><div>&nbsp;&nbsp; UNDO TABLESPACE undotbs1&nbsp;</div><div>&nbsp;&nbsp; &nbsp; &nbsp;DATAFILE '/database/oradata/digoal/undotbs1_01.dbf' SIZE 325M REUSE autoextend on next 10m maxsize 1024m</div><div>&nbsp;&nbsp; &nbsp; &nbsp;;</div></div><div><br></div><div>7. 创建数据字典</div><div>su - oracle</div><div>sqlplus "/ as sysdba"</div><div>@?/rdbms/admin/catalog.sql</div><div><br></div><div>8. 创建系统函数</div><div>su - oracle</div><div>sqlplus "/ as sysdba"</div><div>@?/rdbms/admin/catproc.sql</div><div><br></div><div>9. 创建spfile,修改参数</div><div>su - oracle</div><div>sqlplus "/ as sysdba"</div><div>create spfile from pfile;</div><div>shutdown immediate</div><div>startup</div><div><br></div><div>【某些问题总结】</div><div>1. 据David说，10G的官方文档<span style="font-family: Tahoma, sans-serif; line-height: normal; font-size: small;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;">Oracle? Database Administrator's Guide&nbsp;<span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;">10<i style="line-height: 20px;">g</i>&nbsp;Release 2 (10.2)的第二章节，关于CREATE DATABASE的范例有问题，如下</b></span></b></span></b></span></b></span></div><div><span style="font-family: Tahoma, sans-serif; line-height: normal; font-size: small;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="font-weight: normal; line-height: normal;"><pre xmlspace="preserve" style="font-family: monospace; font-size: 12px;">CREATE DATABASE mynewdb
   USER SYS IDENTIFIED BY pz6r58
   USER SYSTEM IDENTIFIED BY y1tz5p
   LOGFILE GROUP 1 ('/u01/oracle/oradata/mynewdb/redo01.log') SIZE 100M,
           GROUP 2 ('/u01/oracle/oradata/mynewdb/redo02.log') SIZE 100M,
           GROUP 3 ('/u01/oracle/oradata/mynewdb/redo03.log') SIZE 100M
   MAXLOGFILES 5
   MAXLOGMEMBERS 5
   MAXLOGHISTORY 1
   MAXDATAFILES 100
   MAXINSTANCES 1
   CHARACTER SET US7ASCII
   NATIONAL CHARACTER SET AL16UTF16
   DATAFILE '/u01/oracle/oradata/mynewdb/system01.dbf' SIZE 325M REUSE
   EXTENT MANAGEMENT LOCAL
   SYSAUX DATAFILE '/u01/oracle/oradata/mynewdb/sysaux01.dbf' SIZE 325M REUSE
   DEFAULT TABLESPACE tbs_1
   DEFAULT TEMPORARY TABLESPACE tempts1
      TEMPFILE '/u01/oracle/oradata/mynewdb/temp01.dbf' 
      SIZE 20M REUSE
   UNDO TABLESPACE undotbs 
      DATAFILE '/u01/oracle/oradata/mynewdb/undotbs01.dbf'
      SIZE 200M REUSE AUTOEXTEND ON MAXSIZE UNLIMITED;</pre><pre xmlspace="preserve" style="font-family: monospace; font-size: 12px;">仔细看了一下，在</pre><div><span style="line-height: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="font-weight: normal; line-height: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><pre xmlspace="preserve" style="line-height: 19px; font-family: monospace; font-size: 12px; display: inline !important;">   DEFAULT TABLESPACE tbs_1</pre></span></b></span></b></span></b></span></b></span></b></span></b></span></b></span></b></span></div><div><span style="line-height: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="font-weight: normal; line-height: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><b style="line-height: 20px;"><span style="line-height: normal; font-weight: normal;"><pre xmlspace="preserve" style="line-height: 19px; font-family: monospace; font-size: 12px; display: inline !important;">这行有问题，没有写数据文件在哪里，所以官方文档也有错误，看文档一定要保持怀疑的态度，哈哈。好像是鲁迅说的。</pre></span></b></span></b></span></b></span></b></span></b></span></b></span></b></span></b></span></div><div><font face="monospace" size="3"><span style="font-size: 12px; line-height: 19px; white-space: pre;">鲁迅还说，别人喝咖啡的时候，我在学习。实在太有教育意义了。</span></font></div></span></b></span></b></span></b></span></b></span></div><div><br></div><div>2. 10.2.0.1 32bit版本建库后报如下异常的解决</div><div><div>Sat Jun &nbsp;5 11:48:19 2010</div><div>Memory Notification: Library Cache Object loaded into SGA</div><div>Heap size 11367K exceeds notification threshold (2048K)</div><div>Details in trace file /opt/oracle/admin/digoal/udump/digoal_ora_6122.trc</div><div>KGL object name :grant select on ku$_m_view_pfh_view to public</div><div><br></div><div>后来查了一下，据说是10.2.0.1版本的默认参数值太小了</div><div><span style="font-family: 宋体; line-height: normal; font-size: 12px; -webkit-border-horizontal-spacing: 1px; -webkit-border-vertical-spacing: 1px;">alter system set "_kgl_large_heap_warning_threshold"=8388608 scope=spfile ;&nbsp;</span></div><div><span style="font-family: 宋体; line-height: normal; font-size: 12px; -webkit-border-horizontal-spacing: 1px; -webkit-border-vertical-spacing: 1px;">从10.2.0.2起，这个参数的默认值被修改为50M</span></div></div><div><br></div><div><br></div><div>【参考】</div><div><span style="font-family: Tahoma, sans-serif; line-height: normal; font-size: small;"><b>Oracle? Database SQL Reference&nbsp;<span style="font-weight: normal; line-height: normal;"><b>10<i>g</i>&nbsp;Release 2 (10.2)</b></span></b></span></div><div><span style="font-family: Tahoma, sans-serif; line-height: normal; font-size: small;"><b><span style="font-weight: normal; line-height: normal;"><b><span style="font-weight: normal; line-height: normal;"><b>Oracle? Database Administrator's Guide&nbsp;<span style="font-weight: normal; line-height: normal;"><b>10<i>g</i>&nbsp;Release 2 (10.2)</b></span></b></span></b></span></b></span></div><div><span style="font-family: Tahoma, sans-serif; line-height: normal; font-size: small;"><b><span style="font-weight: normal; line-height: normal;"><b><span style="font-weight: normal; line-height: normal;"><b><span style="font-weight: normal; line-height: normal;"><b>$ORACLE_HOME/rdbms/admin/catalog.sql</b></span></b></span></b></span></b></span></div><div><span style="font-family: Tahoma, sans-serif; line-height: normal; font-size: small;"><b><span style="font-weight: normal; line-height: normal;"><b><span style="font-weight: normal; line-height: normal;"><b><span style="font-weight: normal; line-height: normal;"><b>$ORACLE_HOME/rdbms/admin/catproc.sql</b></span></b></span></b></span></b></span></div><div><span style="font-family: Tahoma, sans-serif; line-height: normal; font-size: small;"><b><span style="font-weight: normal; line-height: normal;"><b><span style="font-weight: normal; line-height: normal;"><b><span style="font-weight: normal; line-height: normal;"><b><br></b></span></b></span></b></span></b></span></div><div><span style="font-family: Tahoma, sans-serif; line-height: normal; font-size: small;"><b><br></b></span></div></div>
	</div>
</div>
</body>
</html>