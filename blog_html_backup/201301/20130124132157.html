<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL redis fdw support hash coming soon contributed by andrew</h2>
	<h5 id="">2013-01-24 13:21:57&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013024112341509/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>Andrew将要修改dpage的redis_fdw, 加入对hash数据结构的外部表支持.</div><div>在此之前, redis_fdw仅支持key value结构.</div><div>在他的BLOG中提到如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >andrew=# \! echo type foo | redis-cli</font></div><div><font size="2"   >hash</font></div><div><font size="2"   >andrew=# \d xxx</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Foreign table "public.xxx"</font></div><div><font size="2"   >&nbsp;Column | Type | Modifiers | FDW Options&nbsp;</font></div><div><font size="2"   >--------+------+-----------+-------------</font></div><div><font size="2"   >&nbsp;key &nbsp; &nbsp;| text | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;value &nbsp;| text | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >Server: localredis</font></div><div><font size="2"   >FDW Options: (hashkey 'foo')</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >andrew=# select * from xxx;</font></div><div><font size="2"   >&nbsp; &nbsp;key &nbsp; | value&nbsp;</font></div><div><font size="2"   >---------+-------</font></div><div><font size="2"   >&nbsp;bar &nbsp; &nbsp; | baz</font></div><div><font size="2"   >&nbsp;blurflk | asdf</font></div><div><font size="2"   >&nbsp;qqq &nbsp; &nbsp; | ttt</font></div><div><font size="2"   >(3 rows)</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >当前github上的redis_fdw版本测试 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >wget&nbsp;https://github.com/dpage/redis_fdw/archive/master.zip</font></div><div><font size="2"   >su - root</font></div><div><font size="2"   >. /home/pgdev/.bash_profile</font></div><div><div><font size="2"   >root@db-172-16-3-150-&gt; which pg_config</font></div><div><font size="2"   >/home/pgdev/pgsql9.3/bin/pg_config</font></div></div><div><font size="2"   >root@db-172-16-3-150-&gt; unzip redis_fdw-master.zip&nbsp;</font></div><div><div><font size="2"   >root@db-172-16-3-150-&gt; mv redis_fdw-master postgresql-9.3devel/contrib/</font></div><div><font size="2"   >root@db-172-16-3-150-&gt; cd postgresql-9.3devel/contrib/redis_fdw-master/</font></div><div><font size="2"   >root@db-172-16-3-150-&gt; gmake clean</font></div><div><font size="2"   >rm -f redis_fdw.so &nbsp; libredis_fdw.a&nbsp;</font></div><div><font size="2"   >rm -f redis_fdw.o</font></div><div><font size="2"   >rm -rf sql/redis_fdw.sql expected/redis_fdw.out</font></div><div><font size="2"   >rm -rf results/ regression.diffs regression.out tmp_check/ log/</font></div><div><font size="2"   >root@db-172-16-3-150-&gt; gmake</font></div><div><font size="2"   >gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -g -fpic -I. -I. -I../../src/include -D_GNU_SOURCE -I/usr/include/libxml2 &nbsp; -c -o redis_fdw.o redis_fdw.c</font></div><div><font size="2"   >gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -g -fpic -shared -o redis_fdw.so redis_fdw.o -L../../src/port &nbsp;-Wl,-rpath,'/home/pgdev/pgsql9.3/lib',--enable-new-dtags &nbsp;-lhiredis&nbsp;</font></div><div><font size="2"   >root@db-172-16-3-150-&gt; gmake install</font></div><div><font size="2"   >/bin/mkdir -p '/home/pgdev/pgsql9.3/lib'</font></div><div><font size="2"   >/bin/mkdir -p '/home/pgdev/pgsql9.3/share/extension'</font></div><div><font size="2"   >/bin/mkdir -p '/home/pgdev/pgsql9.3/share/extension'</font></div><div><font size="2"   >/usr/bin/install -c -m 755 &nbsp;redis_fdw.so '/home/pgdev/pgsql9.3/lib/redis_fdw.so'</font></div><div><font size="2"   >/usr/bin/install -c -m 644 ./redis_fdw.control '/home/pgdev/pgsql9.3/share/extension/'</font></div><div><font size="2"   >/usr/bin/install -c -m 644 ./redis_fdw--1.0.sql &nbsp;'/home/pgdev/pgsql9.3/share/extension/'</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >/usr/local/bin/redis-server ./redis.conf&nbsp;</font></div><div><span style="line-height: 22px;"   ><font size="2"   >/usr/local/bin/redis-cli</font></span></div><div><span style="line-height: 22px;"   ><font size="2"   >help @hash</font></span></div><div><span style="line-height: 22px;"   ><font size="2"   >select 0</font></span></div><div><font size="2"   >hmset a firname_name zhou last_name digoal age 29</font></div><div><div><font size="2"   >redis 127.0.0.1:6379&gt; hgetall a</font></div><div><font size="2"   >1) "firname_name"</font></div><div><font size="2"   >2) "zhou"</font></div><div><font size="2"   >3) "last_name"</font></div><div><font size="2"   >4) "digoal"</font></div><div><font size="2"   >5) "age"</font></div><div><font size="2"   >6) "29"</font></div></div><p></p></pre></div><div>创建外部表 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >root@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3devel)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# create extension redis_fdw;</font></div><div><font size="2"   >CREATE EXTENSION</font></div></div><div><div><font size="2"   >digoal=# CREATE SERVER redis_server&nbsp;</font></div><div><font size="2"   >digoal-# FOREIGN DATA WRAPPER redis_fdw&nbsp;</font></div><div><font size="2"   >digoal-# OPTIONS (address '127.0.0.1', port '6379');</font></div><div><font size="2"   >CREATE SERVER</font></div><div><font size="2"   >digoal=#&nbsp;</font></div><div><font size="2"   >digoal=# CREATE FOREIGN TABLE redis_db0 (key text, value text)&nbsp;</font></div><div><font size="2"   >digoal-# SERVER redis_server</font></div><div><font size="2"   >digoal-# OPTIONS (database '0');</font></div><div><font size="2"   >CREATE FOREIGN TABLE</font></div></div><div><div><font size="2"   >digoal=# CREATE USER MAPPING FOR PUBLIC</font></div><div><font size="2"   >digoal-# SERVER redis_server;</font></div><div><font size="2"   >CREATE USER MAPPING</font></div><div><font size="2"   >HASH数据查不到 : </font></div><div><font size="2"   >digoal=# select * from redis_db0 ;</font></div><div><font size="2"   >&nbsp;key | value&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >(0 rows)</font></div></div><p></p></pre></div><div>增加key value数据 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >redis 127.0.0.1:6379&gt; MSET one 1 two 2 three 3 four 4</font></div><div><font size="2"   >OK</font></div><p></p></pre></div><div>再查下外部表,key value的数据可以被查到 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select * from redis_db0 ;</font></div><div><font size="2"   >&nbsp; key &nbsp;| value&nbsp;</font></div><div><font size="2"   >-------+-------</font></div><div><font size="2"   >&nbsp;four &nbsp;| 4</font></div><div><font size="2"   >&nbsp;three | 3</font></div><div><font size="2"   >&nbsp;one &nbsp; | 1</font></div><div><font size="2"   >&nbsp;two &nbsp; | 2</font></div><div><font size="2"   >(4 rows)</font></div><p></p></pre></div><div>创建hashkey选项, 目前的版本暂不支持.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# CREATE FOREIGN TABLE redis_hash_a (key text, value text)&nbsp;</font></div><div><font size="2"   >digoal-# SERVER redis_server</font></div><div><font size="2"   >digoal-# OPTIONS (database '0', hashkey 'a');</font></div><div><font size="2"   >ERROR: &nbsp;invalid option "hashkey"</font></div><div><font size="2"   >HINT: &nbsp;Valid options in this context are: database</font></div><p></p></pre></div><div><br></div>【参考】<wbr><div>1.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="https://github.com/dpage/redis_fdw"   >https://github.com/dpage/redis_fdw</a></div><div>2.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://redis.io"   >http://redis.io</a></div><div>3.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="https://github.com/antirez/redis-io"   >https://github.com/antirez/redis-io</a></div><div>4.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="https://github.com/redis/hiredis"   >https://github.com/redis/hiredis</a></div>5.&nbsp;<a rel="nofollow" href="https://github.com/pg-redis-fdw/redis_fdw"   >https://github.com/pg-redis-fdw/redis_fdw</a>&nbsp; (新的repo地址)</div>
	</div>
</div>
</body>
</html>