<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Do not confuse alias and column name in SELECT and WHERE clause</h2>
	<h5 id="">2013-01-23 16:42:22&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020130234303370/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">群里的一位兄弟问到的一个问题如下 :&nbsp;<div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >select * from (</font></div><div><font size="2"  >&nbsp; select COALESCE( b.zh_old , a.zh ) as zh ,a.zhmc</font></div><div><font size="2"  >&nbsp; from&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; zhgl_zhjbxx a &nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; left outer join &nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; zd_zh_ys b&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; on a.zh = b.zh_new</font></div><div><font size="2"  >&nbsp; &nbsp; where zh = '10551000000210197' &nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; and zhmc = '上海市信息化委员会技术中心'</font></div><div><font size="2"  >)d&nbsp;</font></div><p></p></pre></div><div>返回结果如下 :&nbsp;</div><div><div><img title="Do not confuse alias and column name in SELECT clause - 德哥@Digoal - The Heart,The World."  alt="Do not confuse alias and column name in SELECT clause - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img9.ph.126.net/wSL7Sc5f0jfbKdyAe-UvLg==/6597256683635021549.jpg"  ></div></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >select * from (</font></div><div><font size="2"  >&nbsp; select COALESCE( b.zh_old , a.zh ) &nbsp;as zh , a.zhmc</font></div><div><font size="2"  >&nbsp; &nbsp; from&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; zhgl_zhjbxx a &nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; left outer join &nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; zd_zh_ys b&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; on a.zh = b.zh_new</font></div><div><font size="2"  >)d&nbsp;</font></div><div><font size="2"  >where zh = '10551000000210197' &nbsp;</font></div><div><font size="2"  >and zhmc = '上海市信息化委员会技术中心'</font></div><p></p></pre></div><div>返回结果如下 :&nbsp;</div><div><div><img title="Do not confuse alias and column name in SELECT clause - 德哥@Digoal - The Heart,The World."  alt="Do not confuse alias and column name in SELECT clause - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img6.ph.126.net/oaNvC0-Lx4Bnshry2f43Vw==/6597998853982452926.jpg"  ></div></div><div><br></div><div>为什么以上两个SQL语句的返回值不一样呢?</div><div>原因如下 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >第一个SQL的where 条件</font></div><div><span style="line-height: 22px;"  ><font size="2"  >where zh = '10551000000210197'</font></span></div><div><font size="2"  ><span style="line-height: 22px;"  >这里的zh指的是a.zh. 而不是</span><span style="line-height: 22px;"  >COALESCE( b.zh_old , a.zh ) &nbsp;as zh</span></font></div><div><span style="line-height: 22px;"  ><font size="2"  >第二个SQL的where 条件在括号外面, 这次的where 条件</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  >where zh = '10551000000210197'</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  >指的是子查询中的 :&nbsp;</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  >COALESCE( b.zh_old , a.zh ) &nbsp;as zh</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  >因此两次结果不一样.</font></span></div><p></p></pre></div><div><span style="line-height: 22px;"  >下面是一组测试 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >postgres=# create table t1 (zh int);</font></div><div><font size="2"  >CREATE TABLE</font></div><div><font size="2"  >postgres=# create table t2 (zh_old int, zh_new int);</font></div><div><font size="2"  >CREATE TABLE</font></div><div><span style="line-height: 19px; font-family: Arial, Helvetica, sans-serif;"  ><font size="2"  >postgres=# insert into t1 values (2);</font></span></div><div><div><font size="2"  >INSERT 0 1</font></div></div><div><font size="2"  >postgres=# insert into t2 values (2,2),(3,2);<br>INSERT 0 2</font></div><div><div><font size="2"  >postgres=# select * from (select t2.zh_old,t2.zh_new,coalesce(t2.zh_old, t1.zh) zh from t1 left outer join t2 on t1.zh=t2.zh_new where zh=2)t;</font></div><div><font size="2"  >&nbsp;zh_old | zh_new | zh&nbsp;</font></div><div><font size="2"  >--------+--------+----</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp;2 | &nbsp;2</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; 3 | &nbsp; &nbsp; &nbsp;2 | &nbsp;3</font></div><div><font size="2"  >(2 rows)</font></div></div><div><div><font size="2"  >postgres=# select * from (select t2.zh_old,t2.zh_new,coalesce(t2.zh_old, t1.zh) zh from t1 left outer join t2 on t1.zh=t2.zh_new )t where zh=2;</font></div><div><font size="2"  >&nbsp;zh_old | zh_new | zh&nbsp;</font></div><div><font size="2"  >--------+--------+----</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp;2 | &nbsp;2</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"  ><br></span></div><div><div style="line-height: 22px;"  >【注意】</div><div style="line-height: 22px;"  >1. where 条件不能使用别名, 所以不要混淆. 例如 :&nbsp;</div><div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >postgres=# select relname as rn from pg_class where rn='test';</font></div><div><font size="2"  >ERROR: &nbsp;column "rn" does not exist</font></div><div><font size="2"  >LINE 1: select relname as rn from pg_class where rn='test';</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div></div><div style="line-height: 22px;"  ></div><p></p></pre></div></div></div><br><wbr></div></div>
	</div>
</div>
</body>
</html>