<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">HOW PostgreSQL deal NULL-Values follow Three|ternary valued logic RULE</h2>
	<h5 id="">2013-01-25 11:12:07&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201302422446175/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>数据库的NULL表示没有值, 空的意思。</div><div>在三价逻辑运算中, 数据库的NULL相当于UNKNOWN的意思.</div><div>三价逻辑运算请参考 :&nbsp;</div><div><a target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/Three-valued_logic"  >http://en.wikipedia.org/wiki/Three-valued_logic</a></div><div>来看看三价逻辑运算的真值表 :&nbsp;</div><div><h3 style="background-image: none; margin: 0px 0px 0.3em; overflow: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-style: none; font-size: 17px; font-family: sans-serif; line-height: 19.1875px;"  ><span id="Kleene_logic"  >Kleene logic</span></h3><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.1875px; font-family: sans-serif; font-size: 13px;"  >Below is a set of&nbsp;<a title="Truth table" style="text-decoration: initial; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/Truth_table"  >truth tables</a>&nbsp;showing the logic operations for&nbsp;<a title="Stephen Cole Kleene" style="text-decoration: initial; color: rgb(11, 0, 128); background-image: none; background-position: initial initial; background-repeat: initial initial;" rel="nofollow" href="http://en.wikipedia.org/wiki/Stephen_Cole_Kleene"  >Kleene</a>'s logic.</p><table style="font-size: 13px; margin: 1em 0px; background-color: rgb(249, 249, 249); border: 1px solid rgb(170, 170, 170); border-collapse: collapse; color: rgb(0, 0, 0); font-family: sans-serif; line-height: 19.1875px;"  ><tbody><tr><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  ><i>A</i>&nbsp;AND&nbsp;<i>B</i></th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >True</th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >Unknown</th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >False</th></tr><tr><th scope="row"  style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >True</th><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >True</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >Unknown</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >False</td></tr><tr><th scope="row"  style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >Unknown</th><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >Unknown</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >Unknown</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >False</td></tr><tr><th scope="row"  style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >False</th><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >False</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >False</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >False</td></tr></table><table style="font-size: 13px; margin: 1em 0px; background-color: rgb(249, 249, 249); border: 1px solid rgb(170, 170, 170); border-collapse: collapse; color: rgb(0, 0, 0); font-family: sans-serif; line-height: 19.1875px;"  ><tbody><tr><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  ><i>A</i>&nbsp;OR&nbsp;<i>B</i></th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >True</th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >Unknown</th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >False</th></tr><tr><th scope="row"  style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >True</th><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >True</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >True</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >True</td></tr><tr><th scope="row"  style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >Unknown</th><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >True</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >Unknown</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >Unknown</td></tr><tr><th scope="row"  style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >False</th><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >True</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >Unknown</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >False</td></tr></table><table style="font-size: 13px; margin: 1em 0px; background-color: rgb(249, 249, 249); border: 1px solid rgb(170, 170, 170); border-collapse: collapse; color: rgb(0, 0, 0); font-family: sans-serif; line-height: 19.1875px;"  ><tbody><tr><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  ><i>A</i></th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >NOT&nbsp;<i>A</i></th></tr><tr><th scope="row"  style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >True</th><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >False</td></tr><tr><th scope="row"  style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >Unknown</th><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >Unknown</td></tr><tr><th scope="row"  style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >False</th><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >True<br><br></td></tr></table></div><div><h3 style="background-image: none; margin: 0px 0px 0.3em; overflow: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-style: none; font-size: 17px; font-family: sans-serif; line-height: 19.1875px;"  ><span id=".C5.81ukasiewicz_logic"  >Lukasiewicz logic真值表略...</span></h3></div><div>简单的解释一下, 在这里Unknown可能是true也可能是false。</div><div>因此 :&nbsp;</div><div>对于Unknown and true 可能是true and true也可能是false and true. 那么结果应该是true或者false. 最终还是不确定. 所以还是Unknown.</div><div>对于NOT Unknown. 也一样, 可能是NOT true也可能是NOT false, 结果有可能是true或者false, 最终还是不确定, 所以还是Unknown.</div><div>对于Unknown or true, 不管Unknown是true还是false, 结果都是true.</div><div>对于Unknown and false,&nbsp;<span style="line-height: 22px;"  >不管Unknown是true还是false, 结果都是false.</span></div><div>对于Unknown and Unknown, 可能是true and true或者true and false或者false and false最终结果不确定, 所以还是Unknown.</div><div><span style="line-height: 22px;"  >对于Unknown or Unknown, 可能是true or true或者true or false或者false or false最终结果不确定, 所以还是Unknown.</span></div><div><div style="line-height: 22px;"  ><br></div><div style="line-height: 22px;"  >在数据库中验证以上真值表(仅验证含null的部分) :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >ocz@db-172-16-3-150-&gt; psql digoal</font></div><div><font size="2"  >psql (9.2.1)</font></div><div><font size="2"  >Type "help" for help.</font></div><div><font size="2"  >digoal=# \pset null UnKnown</font></div><div><font size="2"  >Null display is "UnKnown".</font></div></div><div><div><font size="2"  >digoal=# select null and true;</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >digoal=# select null and null;</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >digoal=# select null and false;</font></div><div><font size="2"  >&nbsp;f</font></div></div><div><div><font size="2"  >digoal=# select null or true;</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >digoal=# select null or null;</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >digoal=# select null or false;</font></div><div><font size="2"  >&nbsp;UnKnown</font></div></div><div><div><font size="2"  >digoal=# select not null;</font></div><div><font size="2"  >&nbsp;UnKnown</font></div></div></pre></div><div>接下来测试where条件中的null.</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# select 1 where null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >(0 rows)</font></div><div><font size="2"  >digoal=# select 1 where true;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select 1 where false;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >(0 rows)</font></div><p></p></pre></div><div>从测试结果可以看出WHERE子句中的 null和false一样, 被排除掉了.</div><div><br></div><div>接下来测试数据库<span style="line-height: 22px;"  >基本的比较操作</span><span style="line-height: 22px;"  >中用到null的地方的运算结果.</span></div><div><table border="1"  style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; background-color: rgb(224, 236, 239); border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 13.333333969116211px; line-height: normal;"  ><thead><tr><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"  >Operator</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"  >Description</th></tr></thead><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  ><tt>&lt;</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  >less than</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  ><tt>&gt;</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  >greater than</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  ><tt>&lt;=</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  >less than or equal to</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  ><tt>&gt;=</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  >greater than or equal to</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  ><tt>=</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  >equal</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  ><tt>&lt;&gt;</tt>&nbsp;or&nbsp;<tt>!=</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"  >not equal</td></tr></table></div><div>以上操作符只要带有null的比较返回值都是null。</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >digoal=# select 1 &lt; null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select true &lt; null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div></div><div><span style="line-height: 22px;"  ><font size="2"  >表示不知道null和null是否相等, 所以输出还是null.</font></span></div><div><div><font size="2"  >digoal=# select null=null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div></div><div><span style="line-height: 22px;"  ><font size="2"  >表示不知道null和null是否不相等, 所以输出还是null.</font></span></div><div><div><font size="2"  >digoal=# select null &lt;&gt; null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"  >between and 相当于&gt;= and &lt;=, 例如 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# select 1 between null and null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select 1 between null and 2;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null between null and 2;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null between 1 and 2;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null between 1 and null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div><span style="line-height: 22px;"  >not between and 相当于 &lt; or &gt;, 例如 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# select null not between 1 and null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div><span style="line-height: 22px;"  >2. case, 注意CASE中如果使用NULL, 是使用的=操作符. 所以null分支用于不会执行. 如下 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# select case 1 when null then 'is null' else 'is not null' end;</font></div><div><font size="2"  >&nbsp; &nbsp; case &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >-------------</font></div><div><font size="2"  >&nbsp;is not null</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select case null when null then 'is null' else 'is not null' end;</font></div><div><font size="2"  >&nbsp; &nbsp; case &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >-------------</font></div><div><font size="2"  >&nbsp;is not null</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div><br></div><div>其他表达式中的null :&nbsp;</div><div><span style="line-height: 22px;"  >表示不知道null+1等于多少, 结果输出还是null.</span></div><div><pre class="prettyprint"  ><p></p><div><div><span style="line-height: 22px;"  ><font size="2"  >postgres=# select null+1;</font></span></div></div><div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp; UnKnown</font></div><div><font size="2"  >(1 row)</font></div></div><div><div><font size="2"  >digoal=# select null||'abc';</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select 'abc'||null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div></div><div><br></div><div>【注意】</div><div>1. SQL中的特例, 某些使用场景中null和null被认为是相同的, 这打破了三价逻辑的规则. 如下.</div><div><pre class="prettyprint"  ><p></p><div><span style="line-height: 22px;"  ><font size="2"  >postgres=# select null union select null;</font></span></div><div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# select null intersect select null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div></div><div><div><font size="2"  >digoal=# select null except select null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >(0 rows)</font></div></div><p></p></pre></div><div><br></div><div>2. 聚合函数, 除了count(*) 其他聚合函数都不处理null值. 例如 :&nbsp;</div><div><table style="font-size: 13px; margin: 1em 0px; background-color: rgb(249, 249, 249); border: 1px solid rgb(170, 170, 170); border-collapse: collapse; color: rgb(0, 0, 0); font-family: sans-serif; line-height: 19.1875px;"  ><caption style="font-weight: bold;"  >Table</caption><tbody><tr><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >i</th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >j</th></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >150</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >150</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >200</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >200</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >250</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >250</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >NULL</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >0</td></tr></table><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.1875px; font-family: sans-serif;"  ></p><pre class="prettyprint"  ><p><font size="2"  >Here&nbsp;<code style="font-family: monospace, Courier; background-color: rgb(249, 249, 249);"  >AVG(i)</code>&nbsp;is 200 (the average of 150, 200, and 250), while&nbsp;<code style="font-family: monospace, Courier; background-color: rgb(249, 249, 249);"  >AVG(j)</code>&nbsp;is 150 (the average of 150, 200, 250, and 0). A well-known side effect of this is that in SQL&nbsp;<code style="font-family: monospace, Courier; background-color: rgb(249, 249, 249);"  >AVG(z)</code>&nbsp;is not equivalent with&nbsp;<code style="font-family: monospace, Courier; background-color: rgb(249, 249, 249);"  >SUM(z)/COUNT(*)</code>.</font></p></pre></div><div>聚合函数注意, 如果传入了distinct的话, 就要看函数的strict标记 :&nbsp;</div><div><div>&nbsp; &nbsp; &nbsp;* Aggregate functions that are called with DISTINCT are now passed</div><div>&nbsp; &nbsp; &nbsp; &nbsp;NULL values if the aggregate transition function is not marked as</div><div>&nbsp; &nbsp; &nbsp; &nbsp;STRICT (Andrew Gierth)</div><div>&nbsp; &nbsp; &nbsp; &nbsp;For example, agg(DISTINCT x) might pass a NULL x value to agg().</div><div>&nbsp; &nbsp; &nbsp; &nbsp;This is more consistent with the behavior in non-DISTINCT cases.</div></div><div><br></div><div><span style="line-height: 22px;"  >3. 在SQL92标准扩展文件F571定义了6个操作符, 仅返回true或false, 不返回unknown如下 :&nbsp;</span></div><div><table style="font-size: 13px; margin: 1em 0px; background-color: rgb(249, 249, 249); border: 1px solid rgb(170, 170, 170); border-collapse: collapse; color: rgb(0, 0, 0); font-family: sans-serif; line-height: 19.1875px;"  ><tbody><tr><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >p</th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >true</th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >false</th><th style="border: 1px solid rgb(170, 170, 170); padding: 0.2em; background-color: rgb(242, 242, 242); text-align: center;"  >unknown</th></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >p IS TRUE</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >true</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >false</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >false</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >p IS NOT TRUE</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >false</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >true</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >true</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >p IS FALSE</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >false</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >true</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >false</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >p IS NOT FALSE</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >true</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >false</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >true</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >p IS UNKNOWN</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >false</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >false</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >true</td></tr><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >p IS NOT UNKNOWN</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >true</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >true</td><td style="border: 1px solid rgb(170, 170, 170); padding: 0.2em;"  >false</td></tr></table></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# select null is true;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;f</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null is not true;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null is not false;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null is false;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;f</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null is null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null is not null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;f</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null is not unknown;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;f</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null is unknown;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div><br></div><div>4. 除此之外, PostgreSQL 中还包含两个逻辑操作符.</div><div>IS DISTINCT FROM 和 IS NOT DISTINCT FROM, 所有操作都返回true或者false, 不会返回null :&nbsp;</div><div><p style="font-size: 13.333333969116211px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"  >Ordinary comparison operators yield null (signifying&nbsp;<span>"unknown"</span>), not true or false, when either input is null. For example,&nbsp;<tt>7 = NULL</tt>&nbsp;yields null, as does&nbsp;<tt>7 &lt;&gt; NULL</tt>. When this behavior is not suitable, use the&nbsp;<tt>IS [&nbsp;<span>NOT</span>&nbsp;] DISTINCT FROM</tt>&nbsp;constructs:</p><pre style="font-size: 13.333333969116211px; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 1px solid rgb(207, 207, 207); padding: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow: auto; border-top-left-radius: 8px; border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-bottom-left-radius: 8px; background-color: rgb(247, 247, 247); line-height: normal;"  ><tt style="font-style: italic; font-size: 1em;"  >expression</tt> IS DISTINCT FROM <tt style="font-style: italic; font-size: 1em;"  >expression</tt> <tt style="font-style: italic; font-size: 1em;"  >expression</tt> IS NOT DISTINCT FROM <tt style="font-style: italic; font-size: 1em;"  >expression</tt> </pre><p style="font-size: 13.333333969116211px; line-height: 1.5em; margin: 1.2em 0em; font-family: verdana, sans-serif;"  >For non-null inputs,&nbsp;<tt>IS DISTINCT FROM</tt>&nbsp;is the same as the&nbsp;<tt>&lt;&gt;</tt>&nbsp;operator. However, if both inputs are null it returns false, and if only one input is null it returns true. Similarly,&nbsp;<tt>IS NOT DISTINCT FROM</tt>&nbsp;is identical to&nbsp;<tt>=</tt>&nbsp;for non-null inputs, but it returns true when both inputs are null, and false when only one input is null. Thus, these constructs effectively act as though null were a normal data value, rather than&nbsp;<span>"unknown"</span>.</p></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# select null is distinct from null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;f</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null is distinct from 1;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null is not distinct from 1;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;f</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select null is not distinct from null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div><span style="line-height: 22px;"  >5. PostgreSQL transform_null_equals参数打开, 将'表达式=null'或'null=表达式'转换成'表达式 is null'. 如下 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >digoal=# set transform_null_equals=on;</font></div><div><font size="2"  >SET</font></div><div><font size="2"  >digoal=# select 1=null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;f</font></div><div><font size="2"  >(1 row)</font></div></div><div><div><font size="2"  >digoal=# select null=null;</font></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >(1 row)</font></div><div><span style="line-height: 22px;"  ><font size="2"  >digoal=# select null=1;</font></span></div><div><font size="2"  >&nbsp;?column?&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;f</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div>注意这个参数不影响case表达式的判断, 和修改前结果一致 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=# select case null when null then 'is null' else 'is not null' end;</font></div><div><font size="2"  >&nbsp; &nbsp; case &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"  >-------------</font></div><div><font size="2"  >&nbsp;is not null</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div>6. greatest和least不处理null值.</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >digoal=# select greatest(null,null);</font></div><div><font size="2"  >&nbsp;greatest&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select least(null,null);</font></div><div><font size="2"  >&nbsp; least &nbsp;</font></div><div><font size="2"  >---------</font></div><div><font size="2"  >&nbsp;UnKnown</font></div><div><font size="2"  >(1 row)</font></div></div><div><div><font size="2"  >digoal=# select least(null,null,1,2,3);</font></div><div><font size="2"  >&nbsp;least&nbsp;</font></div><div><font size="2"  >-------</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >digoal=# select greatest(null,null,1,2,3);</font></div><div><font size="2"  >&nbsp;greatest&nbsp;</font></div><div><font size="2"  >----------</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; 3</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div>7. 索引中的null值, PostgreSQL 8.3以前(不含8.3)的版本的BTREE索引不支持IS NULL的查询.</div><div>参见 HISTORY ：&nbsp;</div><div>&nbsp; &nbsp; &nbsp;* Allow col IS NULL to use an index (Teodor)</div><div><br></div>【参考】<wbr><div>1.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/Null_(SQL)"  >http://en.wikipedia.org/wiki/Null_(SQL)</a></div><div>2.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/Three-valued_logic"  >http://en.wikipedia.org/wiki/Three-valued_logic</a></div><div>3.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://www.databasedesign-resource.com/null-values-in-a-database.html"  >http://www.databasedesign-resource.com/null-values-in-a-database.html</a></div><div>4.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/Propositional_logic"  >http://en.wikipedia.org/wiki/Propositional_logic</a></div><div>5.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/%C5%81ukasiewicz_logic"  >http://en.wikipedia.org/wiki/%C5%81ukasiewicz_logic</a></div><div>6.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/Stephen_Cole_Kleene"  >http://en.wikipedia.org/wiki/Stephen_Cole_Kleene</a></div><div>7.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://link.springer.com/chapter/10.1007%2F3-540-36596-6_7"  >http://link.springer.com/chapter/10.1007%2F3-540-36596-6_7</a></div><div>8.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.2/static/functions-comparison.html"  >http://www.postgresql.org/docs/9.2/static/functions-comparison.html</a></div></div>
	</div>
</div>
</body>
</html>