<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL real seq_page_cost & random_page_cost in disks,ssd,memory</h2>
	<h5 id="">2014-04-23 9:59:43&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020143238354292/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>在PostgreSQL中全表扫描时, 计算page扫描的成本因子为seq_page_cost, 例如扫描100个数据块, 那么扫描这些数据块的成本就是seq_page_cost*100;</div><div>如果使用的是索引扫描(如index scan, index only scan, bitmap index scan, bitmap heap scan)这些都是随机页面扫描, 在计算成本时使用random_page_cost成本因子, 例如使用这些扫描方法扫描了100个数据块, 则扫描这些数据块的成本就是random_page_cost*100;</div><div>我早些时间写了一篇BLOG专门介绍成本因子的校准的方法, 包括CPU的成本因子和PAGE SCAN的成本因子.</div><div>有兴趣的朋友可参考 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201310255717379"   >http://blog.163.com/digoal@126/blog/static/163877040201310255717379</a></div><div>本文将对比几种硬件的连续扫描和离散扫描的实际时间. 用的方法和上面这篇BLOG一致, 都是使用systemtap来跟踪数据块读取的实际时间.</div><div>测试结果如下 &nbsp;:</div><div><div style="line-height: 28px;"   >机械硬盘连续块扫描的平均时间197881纳秒(0.197881毫秒)</div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >机械硬盘</span>离散块扫描的平均时间4957678纳秒(4.957678毫秒)</div></div><div><div style="line-height: 28px;"   >SSD硬盘连续块扫描的平均时间<span style="line-height: 28px;"   >49577纳秒(0.049577毫秒)</span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >SSD硬盘</span>离散块扫描的平均时间<span style="line-height: 28px;"   >483504纳秒(</span><span style="line-height: 28px;"   >0.483504毫秒</span><span style="line-height: 28px;"   >)</span></div></div><div><div style="line-height: 28px;"   >当数据在内存中时, 连续块扫描的平均时间11445纳秒(0.011445毫秒)</div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >当数据在内存中时,</span><span style="line-height: 28px;"   >&nbsp;</span>离散块扫描的平均时间18563纳秒(0.018563毫秒)</div></div><div style="line-height: 28px;"   >从结论得知, 机械硬盘离散扫描的性能下降最严重, 比连续扫描降25倍.</div><div style="line-height: 28px;"   >SSD的离散扫描性能比连续扫描性能降9.7倍.</div><div style="line-height: 28px;"   >内存的<span style="line-height: 28px;"   >离散扫描性能比连续扫描性能降1.6倍.</span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >相对取单条TUPLE的</span><span style="line-height: 28px;"   >CPU</span><span style="line-height: 28px;"   >成本, 数据块扫描的成本大概是他们的百倍到万倍的区间 :</span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >(以下结果为1.6GHZ频率的CPU的测试结果)</span></div><div><div>cpu_tuple_cost = 0.00018884145574257426 &nbsp; #毫秒</div><div>cpu_index_tuple_cost = 0.00433497085216479990 &nbsp;&nbsp;<span style="line-height: 28px;"   >#毫秒</span></div><div>cpu_operator_cost = 0.00216748542608239995 &nbsp;&nbsp;<span style="line-height: 28px;"   >#毫秒</span></div></div><div><br></div><div>详细的测试过程参考如下 :&nbsp;</div><div>测试环境如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >OS: CentOS 6.4 x64</font></div><div><font size="2"   >MEM: 96GB</font></div><div><font size="2"   >DB: PostgreSQL 9.3.3</font></div><div><font size="2"   >CPU:&nbsp;Intel(R) Xeon(R) CPU &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; E5504 &nbsp;@ 2.00GHz</font></div><div><font size="2"   >DISK: SAS 2.5寸 1万转, 146GB, 开启RAID R|W cache.</font></div><div><font size="2"   >SSD: OCZ RevoDrive3 240GB</font></div><p></p></pre></div><div>要对比的是连续块扫描和离散块扫描在机械硬盘, SSD硬盘以及内存中的实际时间.</div><div><div>分区如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-150-&gt; df -h</font></div><div><font size="2"   >Filesystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Size &nbsp;Used Avail Use% Mounted on</font></div><div><font size="2"   >/dev/sdc1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;29G &nbsp;9.2G &nbsp; 19G &nbsp;34% /</font></div><div><font size="2"   >tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;48G &nbsp; &nbsp; 0 &nbsp; 48G &nbsp; 0% /dev/shm</font></div><div><font size="2"   >/dev/sdc3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;98G &nbsp; 30G &nbsp; 64G &nbsp;32% /opt</font></div><div><font size="2"   >/dev/sdd1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 183G &nbsp; 34G &nbsp;141G &nbsp;20% /ssd1</font></div><div><font size="2"   >/dev/sda1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 221G &nbsp;8.0G &nbsp;201G &nbsp; 4% /ssd3</font></div><div><font size="2"   >/dev/sdb1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 221G &nbsp; 34G &nbsp;176G &nbsp;17% /ssd4</font></div><p></p></pre></div></div><div>数据库安装在SSD上面 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >pg93@db-172-16-3-150-&gt; cd $PGDATA</font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; pwd</font></div><div><font size="2"   >/ssd4/pg93/pg_root</font></div></div><div><div><font size="2"   >pg93@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# \db</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;List of tablespaces</font></div><div><font size="2"   >&nbsp; &nbsp; Name &nbsp; &nbsp;| &nbsp;Owner &nbsp; | Location&nbsp;</font></div><div><font size="2"   >------------+----------+----------</font></div><div><font size="2"   >&nbsp;pg_default | postgres |&nbsp;</font></div><div><font size="2"   >&nbsp;pg_global &nbsp;| postgres |&nbsp;</font></div><div><font size="2"   >(2 rows)</font></div></div><p></p></pre></div><div>为了测试机械硬盘, 在机械硬盘上加一个表空间</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-150 ssd4]# mkdir -p /opt/pg93/tbs_digoal</font></div><div><font size="2"   >[root@db-172-16-3-150 ssd4]# chown -R pg93:pg93 /opt/pg93</font></div></div><div><div><font size="2"   >[root@db-172-16-3-150 ssd4]# su - pg93</font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# create tablespace tbs_digoal location '/opt/pg93/tbs_digoal';</font></div><div><font size="2"   >CREATE TABLESPACE</font></div></div><p></p></pre></div><div>首先要测试的是SSD硬盘 :&nbsp;</div><div>创建测试数据和索引</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create table tbl_cost_align (id int, info text, crt_time timestamp);</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=# insert into tbl_cost_align select (random()*2000000000)::int, md5(random()::text), clock_timestamp() from generate_series(1,10000000);</font></div><div><font size="2"   >INSERT 0 10000000</font></div><div><font size="2"   >digoal=# create index idx_tbl_cost_align_id on tbl_cost_align(id);</font></div><div><font size="2"   >digoal=# analyze tbl_cost_align;</font></div><div><font size="2"   >ANALYZE</font></div><div><font size="2"   >digoal=# select relpages from pg_class where relname='tbl_cost_align';</font></div><div><font size="2"   >&nbsp;relpages&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; 23256</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# checkpoint;</font></div><p></p></pre></div><div>关闭数据库, 并删除系统层面的缓存, 然后重启数据库 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-150-&gt; pg_ctl stop -m fast</font></div><div><font size="2"   >waiting for server to shut down.... done</font></div><div><font size="2"   >server stopped</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# sync; echo 3 &gt; /proc/sys/vm/drop_caches</font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; taskset -c 1 /home/pg93/pgsql9.3.3/bin/postgres &gt;/dev/null 2&gt;&amp;1</font></div><p></p></pre></div><div>开启一个psql进行测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# select pg_backend_pid();</font></div><div><font size="2"   >&nbsp;pg_backend_pid&nbsp;</font></div><div><font size="2"   >----------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2699</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>跟踪这个psql的pid</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >taskset -c 7 stap -e '</font></div><div><font size="2"   >global a</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.3/bin/postgres").mark("query__start") {</font></div><div><font size="2"   >&nbsp; delete a</font></div><div><font size="2"   >&nbsp; println("query__start ", user_string($arg1), "pid:", pid())</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe vfs.read.return {</font></div><div><font size="2"   >&nbsp; t = gettimeofday_ns() - @entry(gettimeofday_ns())</font></div><div><font size="2"   >&nbsp; # if (execname() == "postgres" &amp;&amp; devname != "N/A")</font></div><div><font size="2"   >&nbsp; &nbsp; a[pid()] &lt;&lt;&lt; t</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.3/bin/postgres").mark("query__done") {</font></div><div><font size="2"   >&nbsp; if (@count(a[pid()]))&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; printdln("**", pid(), @count(a[pid()]), @avg(a[pid()]))</font></div><div><font size="2"   >&nbsp; println("query__done ", user_string($arg1), "pid:", pid())</font></div><div><font size="2"   >&nbsp; if (@count(a[pid()])) {</font></div><div><font size="2"   >&nbsp; &nbsp; println(@hist_log(a[pid()]))</font></div><div><font size="2"   >&nbsp; &nbsp; #println(@hist_linear(a[pid()],1024,4096,100))</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; delete a</font></div><div><font size="2"   >}' -x 2699</font></div><p></p></pre></div><div>确认stap模块已经加载到内核 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# lsmod|grep stap</font></div><div><font size="2"   >stap_ba670c311fb1c365e5ccb4b6e6e9d92a__3022 &nbsp; 149604 &nbsp;2&nbsp;</font></div><div><font size="2"   >uprobes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28877 &nbsp;2 stap_ba670c311fb1c365e5ccb4b6e6e9d92a__3022</font></div><p></p></pre></div><div>在psql中执行一个全表扫描的查询 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Seq Scan on public.tbl_cost_align &nbsp;(cost=0.00..123256.00 rows=10000000 width=45) (actual time=0.793..2986.001 rows=10000000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared read=23256</font></div><div><font size="2"   >&nbsp;Total runtime: 4046.410 ms</font></div><div><font size="2"   >(4 rows)</font></div><p></p></pre></div><div>systemtap跟踪的结果如下 :&nbsp;</div><div>平均扫描时间为49577纳秒(0.049577毫秒).</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >query__start explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;pid:2699</font></div><div><font size="2"   >2699**23269**49577</font></div><div><font size="2"   >query__done explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;pid:2699</font></div><div><font size="2"   >&nbsp; value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp;4096 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp;8192 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; 16384 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp;8888</font></div><div><font size="2"   >&nbsp; 32768 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp; &nbsp;8509</font></div><div><font size="2"   >&nbsp; 65536 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5787</font></div><div><font size="2"   >&nbsp;131072 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 73</font></div><div><font size="2"   >&nbsp;262144 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2</font></div><div><font size="2"   >&nbsp;524288 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6</font></div><div><font size="2"   >1048576 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >2097152 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3</font></div><div><font size="2"   >4194304 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >8388608 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><p></p></pre></div><div>随机块扫描测试 :&nbsp;</div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]# sync; echo 3 &gt; /proc/sys/vm/drop_caches</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >重启数据库</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-150-&gt; taskset -c 1 /home/pg93/pgsql9.3.3/bin/postgres &gt;/dev/null 2&gt;&amp;1</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >重新测试</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# select pg_backend_pid();</font></div><div><font size="2"   >&nbsp;pg_backend_pid&nbsp;</font></div><div><font size="2"   >----------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3596</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# taskset -c 7 stap -e '</font></div><div><font size="2"   >global a</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.3/bin/postgres").mark("query__start") {</font></div><div><font size="2"   >&nbsp; delete a</font></div><div><font size="2"   >&nbsp; println("query__start ", user_string($arg1), "pid:", pid())</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe vfs.read.return {</font></div><div><font size="2"   >&nbsp; t = gettimeofday_ns() - @entry(gettimeofday_ns())</font></div><div><font size="2"   >&nbsp; # if (execname() == "postgres" &amp;&amp; devname != "N/A")</font></div><div><font size="2"   >&nbsp; &nbsp; a[pid()] &lt;&lt;&lt; t</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.3/bin/postgres").mark("query__done") {</font></div><div><font size="2"   >&nbsp; if (@count(a[pid()]))&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; printdln("**", pid(), @count(a[pid()]), @avg(a[pid()]))</font></div><div><font size="2"   >&nbsp; println("query__done ", user_string($arg1), "pid:", pid())</font></div><div><font size="2"   >&nbsp; if (@count(a[pid()])) {</font></div><div><font size="2"   >&nbsp; &nbsp; println(@hist_log(a[pid()]))</font></div><div><font size="2"   >&nbsp; &nbsp; #println(@hist_linear(a[pid()],1024,4096,100))</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; delete a</font></div><div><font size="2"   >}' -x 3596</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# lsmod|grep stap</font></div><div><font size="2"   >stap_ba670c311fb1c365e5ccb4b6e6e9d92a__3619 &nbsp; 149604 &nbsp;2&nbsp;</font></div><div><font size="2"   >uprobes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28877 &nbsp;2 stap_ba670c311fb1c365e5ccb4b6e6e9d92a__3619</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# set enable_seqscan=off;&nbsp;</font></div><div><font size="2"   >digoal=# set enable_bitmapscan=off;&nbsp;</font></div><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align where id&gt;1998999963;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Index Scan using idx_tbl_cost_align_id on public.tbl_cost_align &nbsp;(cost=0.43..4609.95 rows=5003 width=45) (actual time=0.711..2240.410 rows=5007 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;Index Cond: (tbl_cost_align.id &gt; 1998999963)</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared hit=481 read=4532</font></div><div><font size="2"   >&nbsp;Total runtime: 2242.254 ms</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >query__start explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align where id&gt;1998999963;pid:3596</font></div><div><font size="2"   >3596**4563**483504</font></div><div><font size="2"   >query__done explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align where id&gt;1998999963;pid:3596</font></div><div><font size="2"   >&nbsp; value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp;4096 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp;8192 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; 16384 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 21</font></div><div><font size="2"   >&nbsp; 32768 |@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 175</font></div><div><font size="2"   >&nbsp; 65536 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 26</font></div><div><font size="2"   >&nbsp;131072 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >&nbsp;262144 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp;2491</font></div><div><font size="2"   >&nbsp;524288 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1800</font></div><div><font size="2"   >1048576 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 47</font></div><div><font size="2"   >2097152 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2</font></div><div><font size="2"   >4194304 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >8388608 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><p></p></pre></div></div><div>随机块扫描的平均时间为<span style="line-height: 28px;"   >483504纳秒(</span>0.483504毫秒<span style="line-height: 28px;"   >);</span></div><div><br></div><div>接下来测试的是机械硬盘的连续块扫描和随机块扫描的实际性能.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# alter table tbl_cost_align set tablespace tbs_digoal;</font></div><div><font size="2"   >ALTER TABLE</font></div><div><font size="2"   >digoal=# alter index idx_tbl_cost_align_id set tablespace tbs_digoal;</font></div><div><font size="2"   >ALTER INDEX</font></div><div><font size="2"   >digoal=# checkpoint;</font></div><div><font size="2"   >CHECKPOINT</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# sync; echo 3 &gt; /proc/sys/vm/drop_caches</font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; taskset -c 1 /home/pg93/pgsql9.3.3/bin/postgres &gt;/dev/null 2&gt;&amp;1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >su - pg93</font></div><div><font size="2"   >^[[A^[[Apg93@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# select pg_backend_pid();</font></div><div><font size="2"   >&nbsp;pg_backend_pid&nbsp;</font></div><div><font size="2"   >----------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3739</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# taskset -c 7 stap -e '</font></div><div><font size="2"   >global a</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.3/bin/postgres").mark("query__start") {</font></div><div><font size="2"   >&nbsp; delete a</font></div><div><font size="2"   >&nbsp; println("query__start ", user_string($arg1), "pid:", pid())</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe vfs.read.return {</font></div><div><font size="2"   >&nbsp; t = gettimeofday_ns() - @entry(gettimeofday_ns())</font></div><div><font size="2"   >&nbsp; # if (execname() == "postgres" &amp;&amp; devname != "N/A")</font></div><div><font size="2"   >&nbsp; &nbsp; a[pid()] &lt;&lt;&lt; t</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.3/bin/postgres").mark("query__done") {</font></div><div><font size="2"   >&nbsp; if (@count(a[pid()]))&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; printdln("**", pid(), @count(a[pid()]), @avg(a[pid()]))</font></div><div><font size="2"   >&nbsp; println("query__done ", user_string($arg1), "pid:", pid())</font></div><div><font size="2"   >&nbsp; if (@count(a[pid()])) {</font></div><div><font size="2"   >&nbsp; &nbsp; println(@hist_log(a[pid()]))</font></div><div><font size="2"   >&nbsp; &nbsp; #println(@hist_linear(a[pid()],1024,4096,100))</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; delete a</font></div><div><font size="2"   >}' -x 3739</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# lsmod|grep stap</font></div><div><font size="2"   >stap_ba670c311fb1c365e5ccb4b6e6e9d92a__3755 &nbsp; 149604 &nbsp;2&nbsp;</font></div><div><font size="2"   >uprobes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28877 &nbsp;2 stap_ba670c311fb1c365e5ccb4b6e6e9d92a__3755</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Seq Scan on public.tbl_cost_align &nbsp;(cost=0.00..123256.00 rows=10000000 width=45) (actual time=12.592..6378.106 rows=10000000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared read=23256</font></div><div><font size="2"   >&nbsp;Total runtime: 7405.526 ms</font></div><div><font size="2"   >(4 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >query__start explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;pid:3739</font></div><div><font size="2"   >3739**23272**197881</font></div><div><font size="2"   >query__done explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;pid:3739</font></div><div><font size="2"   >&nbsp; &nbsp;value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp; 4096 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; 8192 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp;16384 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp;10176</font></div><div><font size="2"   >&nbsp; &nbsp;32768 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7189</font></div><div><font size="2"   >&nbsp; &nbsp;65536 |@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2036</font></div><div><font size="2"   >&nbsp; 131072 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 104</font></div><div><font size="2"   >&nbsp; 262144 |@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1858</font></div><div><font size="2"   >&nbsp; 524288 |@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1472</font></div><div><font size="2"   >&nbsp;1048576 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91</font></div><div><font size="2"   >&nbsp;2097152 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;83</font></div><div><font size="2"   >&nbsp;4194304 |@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;261</font></div><div><font size="2"   >&nbsp;8388608 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2</font></div><div><font size="2"   >16777216 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >33554432 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# sync; echo 3 &gt; /proc/sys/vm/drop_caches</font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; taskset -c 1 /home/pg93/pgsql9.3.3/bin/postgres &gt;/dev/null 2&gt;&amp;1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# su - pg93</font></div><div><font size="2"   >psqlpg93@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# select pg_backend_pid();</font></div><div><font size="2"   >&nbsp;pg_backend_pid&nbsp;</font></div><div><font size="2"   >----------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3868</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# taskset -c 7 stap -e '</font></div><div><font size="2"   >global a</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.3/bin/postgres").mark("query__start") {</font></div><div><font size="2"   >&nbsp; delete a</font></div><div><font size="2"   >&nbsp; println("query__start ", user_string($arg1), "pid:", pid())</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe vfs.read.return {</font></div><div><font size="2"   >&nbsp; t = gettimeofday_ns() - @entry(gettimeofday_ns())</font></div><div><font size="2"   >&nbsp; # if (execname() == "postgres" &amp;&amp; devname != "N/A")</font></div><div><font size="2"   >&nbsp; &nbsp; a[pid()] &lt;&lt;&lt; t</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.3/bin/postgres").mark("query__done") {</font></div><div><font size="2"   >&nbsp; if (@count(a[pid()]))&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; printdln("**", pid(), @count(a[pid()]), @avg(a[pid()]))</font></div><div><font size="2"   >&nbsp; println("query__done ", user_string($arg1), "pid:", pid())</font></div><div><font size="2"   >&nbsp; if (@count(a[pid()])) {</font></div><div><font size="2"   >&nbsp; &nbsp; println(@hist_log(a[pid()]))</font></div><div><font size="2"   >&nbsp; &nbsp; #println(@hist_linear(a[pid()],1024,4096,100))</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; delete a</font></div><div><font size="2"   >}' -x 3868</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# lsmod|grep stap</font></div><div><font size="2"   >stap_ba670c311fb1c365e5ccb4b6e6e9d92a__3881 &nbsp; 149604 &nbsp;2&nbsp;</font></div><div><font size="2"   >uprobes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28877 &nbsp;2 stap_ba670c311fb1c365e5ccb4b6e6e9d92a__3881</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# set enable_seqscan=off;&nbsp;</font></div><div><font size="2"   ><span style="line-height: 28px;"   >digoal=#</span><span style="line-height: 28px;"   >&nbsp;</span>set enable_bitmapscan=off;&nbsp;</font></div><div><font size="2"   ><span style="line-height: 28px;"   >digoal=#</span><span style="line-height: 28px;"   >&nbsp;</span>explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align where id&gt;1998999963;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Index Scan using idx_tbl_cost_align_id on public.tbl_cost_align &nbsp;(cost=0.43..4609.95 rows=5003 width=45) (actual time=5.462..22646.769 rows=5007 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;Index Cond: (tbl_cost_align.id &gt; 1998999963)</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared hit=481 read=4532</font></div><div><font size="2"   >&nbsp;Total runtime: 22648.805 ms</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >query__start explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align where id&gt;1998999963;pid:3868</font></div><div><font size="2"   >3868**4563**4957678</font></div><div><font size="2"   >query__done explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align where id&gt;1998999963;pid:3868</font></div><div><font size="2"   >&nbsp; &nbsp; value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;4096 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;8192 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp; 16384 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 27</font></div><div><font size="2"   >&nbsp; &nbsp; 32768 |@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 169</font></div><div><font size="2"   >&nbsp; &nbsp; 65536 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 26</font></div><div><font size="2"   >&nbsp; &nbsp;131072 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2</font></div><div><font size="2"   >&nbsp; &nbsp;262144 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 17</font></div><div><font size="2"   >&nbsp; &nbsp;524288 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 40</font></div><div><font size="2"   >&nbsp; 1048576 |@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 200</font></div><div><font size="2"   >&nbsp; 2097152 |@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1338</font></div><div><font size="2"   >&nbsp; 4194304 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp;2568</font></div><div><font size="2"   >&nbsp; 8388608 |@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 159</font></div><div><font size="2"   >&nbsp;16777216 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16</font></div><div><font size="2"   >&nbsp;33554432 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;67108864 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >134217728 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >268435456 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><p></p></pre></div><div>机械硬盘连续块扫描的平均时间197881纳秒(0.197881毫秒)</div><div>离散块扫描的平均时间4957678纳秒(4.957678毫秒)</div><div><br></div><div>最后要测试的是在内存中的连续块扫描和离散块扫描的性能.</div><div>要用到pgfincore这个插件, 同时需要修改数据库的shared buffer, 避免在shared buffer中命中, 无法跟踪到vfs系统调用的情况.</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create extension pgfincore;</font></div><div><font size="2"   >CREATE EXTENSION</font></div><div><font size="2"   >digoal=# select * from pgfadvise_willneed('idx_tbl_cost_align_id');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;relpath &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| os_page_size | rel_os_pages | os_pages_free&nbsp;</font></div><div><font size="2"   >----------------------------------------------+--------------+--------------+---------------</font></div><div><font size="2"   >&nbsp;pg_tblspc/25324/PG_9.3_201306121/16384/33521 | &nbsp; &nbsp; &nbsp; &nbsp; 4096 | &nbsp; &nbsp; &nbsp; &nbsp;54416 | &nbsp; &nbsp; &nbsp;19013540</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select * from pgfadvise_willneed('tbl_cost_align');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;relpath &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| os_page_size | rel_os_pages | os_pages_free&nbsp;</font></div><div><font size="2"   >----------------------------------------------+--------------+--------------+---------------</font></div><div><font size="2"   >&nbsp;pg_tblspc/25324/PG_9.3_201306121/16384/33518 | &nbsp; &nbsp; &nbsp; &nbsp; 4096 | &nbsp; &nbsp; &nbsp; 186048 | &nbsp; &nbsp; &nbsp;18884781</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi postgresql.conf</font></div><div><font size="2"   >shared_buffers = 32MB</font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; taskset -c 1 /home/pg93/pgsql9.3.3/bin/postgres &gt;/dev/null 2&gt;&amp;1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pg93@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.3.3)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# select pg_backend_pid();</font></div><div><font size="2"   >&nbsp;pg_backend_pid&nbsp;</font></div><div><font size="2"   >----------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4538</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# taskset -c 7 stap -e '</font></div><div><font size="2"   >global a</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.3/bin/postgres").mark("query__start") {</font></div><div><font size="2"   >&nbsp; delete a</font></div><div><font size="2"   >&nbsp; println("query__start ", user_string($arg1), "pid:", pid())</font></div><div><font size="2"   >}</font></div><div><font size="2"   >probe vfs.read.return { &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; t = gettimeofday_ns() - @entry(gettimeofday_ns())</font></div><div><font size="2"   >&nbsp; # if (execname() == "postgres" &amp;&amp; devname != "N/A")</font></div><div><font size="2"   >&nbsp; &nbsp; a[pid()] &lt;&lt;&lt; t</font></div><div><font size="2"   >} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >probe process("/home/pg93/pgsql9.3.3/bin/postgres").mark("query__done") {</font></div><div><font size="2"   >&nbsp; if (@count(a[pid()])) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; printdln("**", pid(), @count(a[pid()]), @avg(a[pid()]))&nbsp;</font></div><div><font size="2"   >&nbsp; println("query__done ", user_string($arg1), "pid:", pid())</font></div><div><font size="2"   >&nbsp; if (@count(a[pid()])) { &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; println(@hist_log(a[pid()]))</font></div><div><font size="2"   >&nbsp; &nbsp; #println(@hist_linear(a[pid()],1024,4096,100))</font></div><div><font size="2"   >&nbsp; } &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; delete a</font></div><div><font size="2"   >}' -x 4538</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# lsmod|grep stap</font></div><div><font size="2"   >stap_ba670c311fb1c365e5ccb4b6e6e9d92a__4556 &nbsp; 149604 &nbsp;2&nbsp;</font></div><div><font size="2"   >uprobes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28877 &nbsp;2 stap_ba670c311fb1c365e5ccb4b6e6e9d92a__4556</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><span style="line-height: 28px;"   ><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></span></div><div><font size="2"   >&nbsp;Seq Scan on public.tbl_cost_align &nbsp;(cost=0.00..123256.00 rows=10000000 width=45) (actual time=0.066..2086.471 rows=10000000 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared read=23256</font></div><div><font size="2"   >&nbsp;Total runtime: 3128.600 ms</font></div><div><font size="2"   >(4 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >query__start explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;pid:4538</font></div><div><font size="2"   >4538**23272**11445</font></div><div><font size="2"   >query__done explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align;pid:4538</font></div><div><font size="2"   >&nbsp; value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp;2048 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp;4096 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp;8192 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp;23018</font></div><div><font size="2"   >&nbsp; 16384 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 224</font></div><div><font size="2"   >&nbsp; 32768 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;26</font></div><div><font size="2"   >&nbsp; 65536 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3</font></div><div><font size="2"   >&nbsp;131072 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;262144 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp;524288 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >1048576 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >2097152 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# set enable_seqscan=off;&nbsp;</font></div><div><font size="2"   >digoal=# set enable_bitmapscan=off;&nbsp;</font></div><div><font size="2"   >digoal=# explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align where id&gt;1998999963;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><span style="line-height: 28px;"   ><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></span></div><div><font size="2"   >&nbsp;Index Scan using idx_tbl_cost_align_id on public.tbl_cost_align &nbsp;(cost=0.43..4609.95 rows=5003 width=45) (actual time=0.157..110.887 rows=5007 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: id, info, crt_time</font></div><div><font size="2"   >&nbsp; &nbsp;Index Cond: (tbl_cost_align.id &gt; 1998999963)</font></div><div><font size="2"   >&nbsp; &nbsp;Buffers: shared hit=175 read=4838</font></div><div><font size="2"   >&nbsp;Total runtime: 111.819 ms</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >query__start explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align where id&gt;1998999963;pid:4538</font></div><div><font size="2"   >4538**4855**18563</font></div><div><font size="2"   >query__done explain (analyze,verbose,costs,buffers,timing) select * from tbl_cost_align where id&gt;1998999963;pid:4538</font></div><div><font size="2"   >&nbsp; value |-------------------------------------------------- count</font></div><div><font size="2"   >&nbsp; &nbsp;2048 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp;4096 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp; &nbsp;8192 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &nbsp;3762</font></div><div><font size="2"   >&nbsp; 16384 |@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;367</font></div><div><font size="2"   >&nbsp; 32768 |@@@@@@@@@ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 717</font></div><div><font size="2"   >&nbsp; 65536 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2</font></div><div><font size="2"   >&nbsp;131072 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6</font></div><div><font size="2"   >&nbsp;262144 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >&nbsp;524288 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >1048576 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><p></p></pre></div><div><div style="line-height: 28px;"   >当数据在内存中时, 连续块扫描的平均时间11445纳秒(0.011445毫秒)</div><div style="line-height: 28px;"   >离散块扫描的平均时间18563纳秒(0.018563毫秒)</div></div></div><div style="line-height: 28px;"   ><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201310255717379"   >http://blog.163.com/digoal@126/blog/static/163877040201310255717379</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL real seq_page_cost  random_page_cost in disks,ssd,memory - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>