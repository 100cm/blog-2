<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.5 new feature - Add cluster_name GUC identify which "postgres" process in one OS for servel pg clusters</h2>
	<h5 id="">2015-04-09 11:35:05&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201539113050265/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="line-height: 28px;"   >当我们在一个系统中运行了多个PostgreSQL实例时, 一般我们可以通过端口监听来区分它们, 或者放在不同的OS用户下运行.</span></div><div><span style="line-height: 28px;"   >现在</span>PostgreSQL9.5新增了一个cluster_name的配置选项, 可以让我们更好的区分在同一个OS下的多个PostgreSQL实例.</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >pg95@db-172-16-3-150-&gt; vi $PGDATA/postgresql.conf</font></span></div><div><font size="2"   >cluster_name = 'idc_hangzhou_bill'</font></div><div><span style="line-height: 28px;"   ><font size="2"   >pg95@db-172-16-3-150-&gt; pg_ctl restart -m fast</font></span></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >pg95@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.5devel)</font></div><div><font size="2"   >Type "help" for help.</font></div></div><div><div><font size="2"   >postgres=# show cluster_name;</font></div><div><font size="2"   >&nbsp; &nbsp;cluster_name &nbsp; &nbsp;</font></div><div><font size="2"   >-------------------</font></div><div><font size="2"   >&nbsp;idc_hangzhou_bill</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>此时查看进程, 我们看到9.5的这个实例的ps输出, 已经标记了cluster_name</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg95@db-172-16-3-150-&gt; ps -ewf|grep postgres</font></div><div><font size="2"   >postgres 17376 &nbsp; &nbsp; 1 &nbsp;0 Apr04 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 /opt/pgsql9.4.1/bin/postgres</font></div><div><font size="2"   >postgres 17378 17376 &nbsp;0 Apr04 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: logger process &nbsp; &nbsp;</font></div><div><font size="2"   >postgres 17380 17376 &nbsp;0 Apr04 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: checkpointer process &nbsp;&nbsp;</font></div><div><font size="2"   >postgres 17381 17376 &nbsp;0 Apr04 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:01 postgres: writer process &nbsp; &nbsp;</font></div><div><font size="2"   >postgres 17382 17376 &nbsp;0 Apr04 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:01 postgres: wal writer process &nbsp;&nbsp;</font></div><div><font size="2"   >postgres 17383 17376 &nbsp;0 Apr04 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: stats collector process &nbsp;&nbsp;</font></div><div><font size="2"   >root &nbsp; &nbsp; 21969 &nbsp;2319 &nbsp;0 Apr08 pts/1 &nbsp; &nbsp;00:00:00 su - postgres</font></div><div><font size="2"   >postgres 21971 21969 &nbsp;0 Apr08 pts/1 &nbsp; &nbsp;00:00:00 -bash</font></div><div><font size="2"   >pg95 &nbsp; &nbsp; 22833 &nbsp; &nbsp; 1 &nbsp;0 11:27 pts/2 &nbsp; &nbsp;00:00:00 /opt/pgsql9.5/bin/postgres</font></div><div><font size="2"   >pg95 &nbsp; &nbsp; 22835 22833 &nbsp;0 11:27 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: idc_hangzhou_bill: logger process &nbsp;&nbsp;</font></div><div><font size="2"   >pg95 &nbsp; &nbsp; 22837 22833 &nbsp;0 11:27 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: idc_hangzhou_bill: checkpointer process &nbsp;&nbsp;</font></div><div><font size="2"   >pg95 &nbsp; &nbsp; 22838 22833 &nbsp;0 11:27 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: idc_hangzhou_bill: writer process &nbsp;&nbsp;</font></div><div><font size="2"   >pg95 &nbsp; &nbsp; 22839 22833 &nbsp;0 11:27 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: idc_hangzhou_bill: wal writer process &nbsp;&nbsp;</font></div><div><font size="2"   >pg95 &nbsp; &nbsp; 22840 22833 &nbsp;0 11:27 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: idc_hangzhou_bill: autovacuum launcher process &nbsp;&nbsp;</font></div><div><font size="2"   >pg95 &nbsp; &nbsp; 22841 22833 &nbsp;0 11:27 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 postgres: idc_hangzhou_bill: stats collector process &nbsp;&nbsp;</font></div><div><font size="2"   >pg95 &nbsp; &nbsp; 22927 22792 &nbsp;0 11:31 pts/2 &nbsp; &nbsp;00:00:00 grep postgres</font></div><p></p></pre></div><div><br></div><div>这个功能在云环境中非常好用, 例如使用docker的容器环境中, 我们非常可能在一个OS中运行多个PostgreSQL实例.</div><div><br></div><div>[参考]</div><div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=51adcaa0df81da5e94b582d47de64ebb17129937"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=51adcaa0df81da5e94b582d47de64ebb17129937</a></div><div>2.&nbsp;<a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-WHAT"   >http://www.postgresql.org/docs/devel/static/runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-WHAT</a></div><div><dt style="font-family: verdana, sans-serif; font-size: 12.1599998474121px; line-height: normal;"   ><tt>cluster_name</tt>&nbsp;(<tt>string</tt>)</dt><dd style="font-family: verdana, sans-serif; font-size: 12.1599998474121px; line-height: normal;"   ><p style="font-size: 1em; line-height: 1.5em; margin: 1.2em 0em;"   >Sets the cluster name that appears in the process title for all processes in this cluster. The name can be any string of less than&nbsp;<tt>NAMEDATALEN</tt>&nbsp;characters (64 characters in a standard build). Only printable ASCII characters may be used in the&nbsp;<tt>cluster_name</tt>&nbsp;value. Other characters will be replaced with question marks (<tt>?</tt>). No name is shown if this parameter is set to the empty string&nbsp;<tt>''</tt>&nbsp;(which is the default). This parameter can only be set at server start.</p><p style="font-size: 1em; line-height: 1.5em; margin: 1.2em 0em;"   >The process title is typically viewed using programs like&nbsp;<span>ps</span>&nbsp;or, on Windows,&nbsp;<span>Process Explorer</span>.</p></dd></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL 9.5 new feature - Add cluster_name GUC identify which postgres process in one OS for servel pg clusters - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>