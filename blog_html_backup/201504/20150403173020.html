<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">scale in R</h2>
	<h5 id="">2015-04-03 17:30:20&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020153343446995/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>scale在计算时, 主要是分母的选择和<span style="line-height: 28px;"   >center , scale配置有关. 默认两个都是TRUE.</span></div><div>scale(x, center = TRUE, scale = TRUE) &nbsp;</div><div><br></div><div><div>scale(x,scale=F,center=T) 计算结果等价于 x-mean(x)</div><div>scale(x,scale=T,center=F)&nbsp;<span style="line-height: 28px;"   >计算结果</span><span style="line-height: 28px;"   >等价于 x/sqrt(sum(x^2)/(length(x)-1))</span></div><div>scale(x,scale=T,center=T)&nbsp;<span style="line-height: 28px;"   >计算结果</span><span style="line-height: 28px;"   >等价于 (x-mean(x))/sd(x) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sd计算标准差.</span></div></div><div><br></div><div>计算时, 都是基于列的. 例如</div><div>mean() 每列的有意义值的平均值.</div><div><br></div><div>例子 :&nbsp;</div><div><div>&gt; x</div><div>&nbsp; &nbsp; &nbsp;[,1] [,2] [,3] [,4] [,5] [,6] [,7]</div><div>[1,] &nbsp; 14 &nbsp; &nbsp;9 &nbsp; 10 &nbsp; 16 &nbsp; 10 &nbsp; &nbsp;9 &nbsp; &nbsp;8</div><div>[2,] &nbsp; &nbsp;3 &nbsp; 10 &nbsp; 12 &nbsp; &nbsp;7 &nbsp; 12 &nbsp; 14 &nbsp; 15</div><div>[3,] &nbsp; 10 &nbsp; &nbsp;8 &nbsp; &nbsp;8 &nbsp; 13 &nbsp; 11 &nbsp; &nbsp;5 &nbsp; 16</div><div>[4,] &nbsp; &nbsp;8 &nbsp; &nbsp;9 &nbsp; 17 &nbsp; 14 &nbsp; &nbsp;7 &nbsp; &nbsp;4 &nbsp; &nbsp;9</div><div>[5,] &nbsp; &nbsp;7 &nbsp; &nbsp;7 &nbsp; 10 &nbsp; 13 &nbsp; &nbsp;9 &nbsp; &nbsp;6 &nbsp; &nbsp;8</div><div>&gt; scale(x,scale=F,center=T)</div><div>&nbsp; &nbsp; &nbsp;[,1] [,2] [,3] [,4] [,5] [,6] [,7]</div><div>[1,] &nbsp;5.6 &nbsp;0.4 -1.4 &nbsp;3.4 &nbsp;0.2 &nbsp;1.4 -3.2 &nbsp; &nbsp; # &nbsp;每个元素的值等于它的值减去所在列的平均值.</div><div>[2,] -5.4 &nbsp;1.4 &nbsp;0.6 -5.6 &nbsp;2.2 &nbsp;6.4 &nbsp;3.8</div><div>[3,] &nbsp;1.6 -0.6 -3.4 &nbsp;0.4 &nbsp;1.2 -2.6 &nbsp;4.8</div><div>[4,] -0.4 &nbsp;0.4 &nbsp;5.6 &nbsp;1.4 -2.8 -3.6 -2.2</div><div>[5,] -1.4 -1.6 -1.4 &nbsp;0.4 -0.8 -1.6 -3.2</div><div>attr(,"scaled:center")</div><div>[1] &nbsp;8.4 &nbsp;8.6 11.4 12.6 &nbsp;9.8 &nbsp;7.6 11.2</div></div><div>center表示每列的平均值, 如第一列如下 :&nbsp;</div><div>&gt; x[,1]</div><div>[1] 14 &nbsp;3 10 &nbsp;8 &nbsp;7</div><div><div>&gt; mean(x[,1])</div><div>[1] 8.4</div></div><div><br></div><div><br></div><div><div>&gt; scale(x,scale=T,center=F)</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [,1] &nbsp; &nbsp; &nbsp;[,2] &nbsp; &nbsp; &nbsp;[,3] &nbsp; &nbsp; &nbsp;[,4] &nbsp; &nbsp; &nbsp;[,5] &nbsp; &nbsp; &nbsp;[,6] &nbsp; &nbsp; &nbsp;[,7]</div><div>[1,] 1.3695248 0.9295160 0.7575540 1.1047627 0.8989331 0.9566892 0.6091096</div><div>[2,] 0.2934696 1.0327956 0.9090648 0.4833337 1.0787198 1.4881832 1.1420805</div><div>[3,] 0.9782320 0.8262364 0.6060432 0.8976197 0.9888265 0.5314940 1.2182192</div><div>[4,] 0.7825856 0.9295160 1.2878418 0.9666674 0.6292532 0.4251952 0.6852483</div><div>[5,] 0.6847624 0.7229569 0.7575540 0.8976197 0.8090398 0.6377928 0.6091096</div><div>attr(,"scaled:scale")</div><div>[1] 10.222524 &nbsp;9.682458 13.200379 14.482748 11.124298 &nbsp;9.407444 13.133926</div></div><div><span style="line-height: 28px;"   >scale(x,scale=T,center=F)&nbsp;</span>分母为对应列的<span style="line-height: 28px;"   >sqrt(sum(x^2)/(length(x)-1))</span></div><div><span style="line-height: 28px;"   >例如 :&nbsp;</span></div><div><div>&gt; sqrt(sum(x[,1]^2)/(length(x[,1])-1))</div><div>[1] 10.22252</div><div>&gt; sqrt(sum(x[,2]^2)/(length(x[,2])-1))</div><div>[1] 9.682458</div></div><div><br></div><div>最后</div><div><div>&gt; scale(x,scale=T,center=T)</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [,1] &nbsp; &nbsp; &nbsp; [,2] &nbsp; &nbsp; &nbsp; [,3] &nbsp; &nbsp; &nbsp; [,4] &nbsp; &nbsp; &nbsp; [,5] &nbsp; &nbsp; &nbsp; [,6]</div><div>[1,] &nbsp;1.38705673 &nbsp;0.3508232 -0.4075558 &nbsp;1.0114390 &nbsp;0.1039750 &nbsp;0.3467642 &nbsp; &nbsp; &nbsp;# 元素计算方法:&nbsp;<span style="line-height: 28px;"   >(x-mean(x))/sd(x)</span></div><div>[2,] -1.33751899 &nbsp;1.2278812 &nbsp;0.1746668 -1.6658995 &nbsp;1.1437255 &nbsp;1.5852077 &nbsp; &nbsp; &nbsp;# &nbsp;(值-所在列数学期望)/所在列标准差</div><div>[3,] &nbsp;0.39630192 -0.5262348 -0.9897783 &nbsp;0.1189928 &nbsp;0.6238503 -0.6439906</div><div>[4,] -0.09907548 &nbsp;0.3508232 &nbsp;1.6302230 &nbsp;0.4164749 -1.4556507 -0.8916793</div><div>[5,] -0.34676418 -1.4032928 -0.4075558 &nbsp;0.1189928 -0.4159002 -0.3963019</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[,7]</div><div>[1,] -0.8076071</div><div>[2,] &nbsp;0.9590335</div><div>[3,] &nbsp;1.2114107</div><div>[4,] -0.5552299</div><div>[5,] -0.8076071</div><div>attr(,"scaled:center")</div><div>[1] &nbsp;8.4 &nbsp;8.6 11.4 12.6 &nbsp;9.8 &nbsp;7.6 11.2</div><div>同时输出每列的数学期望.</div><div>attr(,"scaled:scale")</div><div>[1] 4.037326 1.140175 3.435113 3.361547 1.923538 4.037326 3.962323</div></div><div>分母为每列的标准差</div><div><br></div>[参考]<wbr><div>1. scale.default</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; scale.default</font></div><div><font size="2"   >function (x, center = TRUE, scale = TRUE)&nbsp;</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; x &lt;- as.matrix(x)</font></div><div><font size="2"   >&nbsp; &nbsp; nc &lt;- ncol(x)</font></div><div><font size="2"   >&nbsp; &nbsp; if (is.logical(center)) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (center) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; center &lt;- colMeans(x, na.rm = TRUE)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x &lt;- sweep(x, 2L, center, check.margin = FALSE)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; else if (is.numeric(center) &amp;&amp; (length(center) == nc))&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; x &lt;- sweep(x, 2L, center, check.margin = FALSE)</font></div><div><font size="2"   >&nbsp; &nbsp; else stop("length of 'center' must equal the number of columns of 'x'")</font></div><div><font size="2"   >&nbsp; &nbsp; if (is.logical(scale)) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (scale) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f &lt;- function(v) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v &lt;- v[!is.na(v)]</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sqrt(sum(v^2)/max(1, length(v) - 1L))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scale &lt;- apply(x, 2L, f)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x &lt;- sweep(x, 2L, scale, "/", check.margin = FALSE)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; else if (is.numeric(scale) &amp;&amp; length(scale) == nc)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; x &lt;- sweep(x, 2L, scale, "/", check.margin = FALSE)</font></div><div><font size="2"   >&nbsp; &nbsp; else stop("length of 'scale' must equal the number of columns of 'x'")</font></div><div><font size="2"   >&nbsp; &nbsp; if (is.numeric(center))&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; attr(x, "scaled:center") &lt;- center</font></div><div><font size="2"   >&nbsp; &nbsp; if (is.numeric(scale))&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; attr(x, "scaled:scale") &lt;- scale</font></div><div><font size="2"   >&nbsp; &nbsp; x</font></div><div><font size="2"   >}</font></div><p></p></pre></div><div><br></div><div>2. help(scale)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >scale &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; package:base &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; R Documentation</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Scaling and Centering of Matrix-like Objects</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Description:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;‘scale’ is generic function whose default method centers and/or</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;scales the columns of a numeric matrix.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Usage:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;scale(x, center = TRUE, scale = TRUE)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >Arguments:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;x: a numeric matrix(like object).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; center: either a logical value or a numeric vector of length equal to</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the number of columns of ‘x’.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp;scale: either a logical value or a numeric vector of length equal to</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the number of columns of ‘x’.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Details:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;The value of ‘center’ determines how column centering is</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;performed. &nbsp;If ‘center’ is a numeric vector with length equal to</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;the number of columns of ‘x’, then each column of ‘x’ has the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;corresponding value from ‘center’ subtracted from it. &nbsp;If ‘center’</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;is ‘TRUE’ then centering is done by subtracting the column means</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;(omitting ‘NA’s) of ‘x’ from their corresponding columns, and if</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;‘center’ is ‘FALSE’, no centering is done.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;The value of ‘scale’ determines how column scaling is performed</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;(after centering). &nbsp;If ‘scale’ is a numeric vector with length</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;equal to the number of columns of ‘x’, then each column of ‘x’ is</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;divided by the corresponding value from ‘scale’. &nbsp;If ‘scale’ is</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;‘TRUE’ then scaling is done by dividing the (centered) columns of</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;‘x’ by their standard deviations if ‘center’ is ‘TRUE’, and the</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;root mean square otherwise. &nbsp;If ‘scale’ is ‘FALSE’, no scaling is</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;done.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;The root-mean-square for a (possibly centered) column is defined</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;as sqrt(sum(x^2)/(n-1)), where x is a vector of the non-missing</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;values and n is the number of non-missing values. &nbsp;In the case</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;‘center = TRUE’, this is the same as the standard deviation, but</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;in general it is not. &nbsp;(To scale by the standard deviations</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;without centering, use ‘scale(x, center = FALSE, scale = apply(x,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;2, sd, na.rm = TRUE))’.)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Value:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;For ‘scale.default’, the centered, scaled matrix. &nbsp;The numeric</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;centering and scalings used (if any) are returned as attributes</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;‘"scaled:center"’ and ‘"scaled:scale"’</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >References:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;Becker, R. A., Chambers, J. M. and Wilks, A. R. (1988) _The New S</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;Language_. &nbsp;Wadsworth &amp; Brooks/Cole.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >See Also:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;‘sweep’ which allows centering (and scaling) with arbitrary</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;statistics.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;For working with the scale of a plot, see ‘par’.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Examples:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;require(stats)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;x &lt;- matrix(1:10, ncol = 2)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;(centered.x &lt;- scale(x, scale = FALSE))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;cov(centered.scaled.x &lt;- scale(x)) # all 1</font></div><p></p></pre></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="scale in R - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>