<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">ceph install in CentOS 7 x64 within docker - 1</h2>
	<h5 id="">2014-11-27 15:13:46&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201410269169450/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>本文使用docker来部署ceph, 基于CentOS 7 x64.</div><div>首先要安装docker, CentOS 7源已经包含了docker, 所以可以直接使用yum安装.</div><pre class="prettyprint"   ><p></p><div><font size="2"   ># yum install -y docker</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >配置docker 运行时的root目录(-g 参数).</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@localhost ~]# lvs</font></div><div><font size="2"   >&nbsp; LV &nbsp; VG &nbsp; &nbsp; &nbsp; Attr &nbsp; &nbsp; &nbsp; LSize &nbsp; Pool Origin Data% &nbsp;Move Log Cpy%Sync Convert</font></div><div><font size="2"   >&nbsp; lv01 vgdata01 -wi-ao---- 409.32g &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >[root@localhost ~]# df -h</font></div><div><font size="2"   >Filesystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size &nbsp;Used Avail Use% Mounted on</font></div><div><font size="2"   >/dev/mapper/vgdata01-lv01 &nbsp;410G &nbsp;474M &nbsp;409G &nbsp; 1% /data01</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@localhost ~]# mkdir /data01/docker</font></div><p></p></pre></div><div>配置docker服务启动项, 与CentOS 6有所不同, 配置如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost ~]# vi /etc/sysconfig/docker</font></div><div><font size="2"   ># /etc/sysconfig/docker</font></div><div><font size="2"   ># Modify these options if you want to change the way the docker daemon runs</font></div><div><font size="2"   >OPTIONS="--selinux-enabled=false -g /data01/docker"</font></div><p></p></pre></div><div><br></div><div>启动docker server</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost ~]# systemctl start docker</font></div><div><div><font size="2"   >[root@localhost ~]# ip link show docker0</font></div><div><font size="2"   >6: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; link/ether 56:84:7a:fe:97:99 brd ff:ff:ff:ff:ff:ff</font></div><div><font size="2"   >[root@localhost ~]# ip addr show docker0</font></div><div><font size="2"   >6: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; link/ether 56:84:7a:fe:97:99 brd ff:ff:ff:ff:ff:ff</font></div><div><font size="2"   >&nbsp; &nbsp; inet 172.17.42.1/16 scope global docker0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;valid_lft forever preferred_lft forever</font></div></div><div><div><font size="2"   >[root@localhost ~]# brctl show</font></div><div><font size="2"   >bridge name &nbsp; &nbsp; bridge id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STP enabled &nbsp; &nbsp; interfaces</font></div><div><font size="2"   >docker0 &nbsp; &nbsp; &nbsp; &nbsp; 8000.56847afe9799 &nbsp; &nbsp; &nbsp; no</font></div></div><div><font size="2"   ># 下载centos base image</font></div><div><font size="2"   >[root@localhost sysconfig]# docker pull centos</font></div><p></p></pre></div><div><br></div><div>规划环境 :&nbsp;</div><div><div><img title="ceph install in CentOS 7 x64 within docker - 1 - 德哥@Digoal - PostgreSQL research"   alt="ceph install in CentOS 7 x64 within docker - 1 - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img2.ph.126.net/lJyoz0qJbyyRG7oPYWkmaA==/2781535719872270411.png"   ></div><br></div><div>IP分别为 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >docker0 172.17.42.1/16<br>br0  172.18.42.1/16<br>br1  172.19.42.1/16<br><br>deploy <br>v00 172.17.0.1/16<br>v01 172.18.0.1/16<br>v02 172.19.0.1/16<br><br>mon1 <br>v10 172.17.0.2/16<br>v11 172.18.0.2/16<br>v12 172.19.0.2/16<br><br>mon2<br>v20 172.17.0.3/16<br>v21 172.18.0.3/16<br>v22 172.19.0.3/16<br><br>mon3<br>v30 172.17.0.4/16<br>v31 172.18.0.4/16<br>v32 172.19.0.4/16<br><br>osd1<br>v40 172.17.0.5/16<br>v41 172.18.0.5/16<br>v42 172.19.0.5/16<br><br>osd2<br>v50 172.17.0.6/16<br>v51 172.18.0.6/16<br>v52 172.19.0.6/16<br><br>osd3<br>v60 172.17.0.7/16<br>v61 172.18.0.7/16<br>v62 172.19.0.7/16<br><br>osd4<br>v70 172.17.0.8/16<br>v71 172.18.0.8/16<br>v72 172.19.0.8/16</span></font></div><p></p></pre></div><div>生产的部署, 网络建议参考, 将OSD的心跳, 复制, 对外和监控分成3张网来通讯.&nbsp;</div><div>(至少应该2张网络)</div><div><a target="_blank" rel="nofollow" href="http://docs.ceph.com/docs/master/rados/configuration/network-config-ref/"   >http://docs.ceph.com/docs/master/rados/configuration/network-config-ref/</a></div><div>网络配置建议使用pipework工具, 简化繁琐的配置过程(因本文配置过程较为繁琐).</div><div>参考 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201411602632460/"   >http://blog.163.com/digoal@126/blog/static/163877040201411602632460/</a></div><div><br></div><div>创建几个卷目录 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# cd /data01/</font></div><div><font size="2"   ><span style="line-height: 21px;"   >[root@localhost data01]# mkdir deploy<br>[root@localhost data01]# mkdir mon1<br>[root@localhost data01]# mkdir mon2<br>[root@localhost data01]# mkdir mon3<br>[root@localhost data01]# mkdir osd1<br>[root@localhost data01]# mkdir osd2<br>[root@localhost data01]# mkdir osd3<br>[root@localhost data01]# mkdir osd4</span></font></div><p></p></pre></div><div><br></div><div>为了能够访问外网, 需要配置宿主机的nat规则配置 :&nbsp;</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   ># iptables rules</font></div><div style="line-height: 28px;"   ><font size="2"   ># Enable NAT</font></div><div style="line-height: 28px;"   ><font size="2"   >iptables -t nat -A POSTROUTING -s 172.16.42.0/24 ! -d 172.16.42.0/24 -j MASQUERADE</font></div><div style="line-height: 28px;"   ><font size="2"   ># Accept incoming packets for existing connections</font></div><div style="line-height: 28px;"   ><font size="2"   >iptables -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</font></div><div style="line-height: 28px;"   ><font size="2"   ># Accept all non-intercontainer outgoing packets</font></div><div style="line-height: 28px;"   ><font size="2"   >iptables -A FORWARD -i docker0 ! -o docker0 -j ACCEPT</font></div><div style="line-height: 28px;"   ><font size="2"   ># By default allow all outgoing traffic</font></div><div style="line-height: 28px;"   ><font size="2"   >iptables -A FORWARD -i docker0 -o docker0 -j ACCEPT</font></div><p></p></pre></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >开启宿主机forward :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost ~]# vi /etc/sysctl.conf</font></div><div><font size="2"   >net.ipv4.ip_forward=1</font></div><div><font size="2"   >[root@localhost ~]# sysctl -p</font></div><div><font size="2"   >net.ipv4.ip_forward = 1</font></div><p></p></pre></div></div><div><br></div><div>使用前面制作的sshd 镜像, 启动几个container.</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014102711413675/"   >http://blog.163.com/digoal@126/blog/static/1638770402014102711413675/</a></div><div>为了自定义IP, 这里不使用docker来配置网络, 而是使用netns来配置网络.</div><div>启动container(包括所有节点)</div><div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >docker run -d --net=none --dns=202.101.172.35 --name=deploy --hostname=deploy --privileged=true -v /data01/deploy:/data01 digoal/sshd</font></div><div><font size="2"   >docker run -d --net=none --dns=202.101.172.35 --name=mon1 --hostname=mon1 --privileged=true -v /data01/mon1:/data01 digoal/sshd</font></div><div><font size="2"   >docker run -d --net=none --dns=202.101.172.35 --name=mon2 --hostname=mon2 --privileged=true -v /data01/mon2:/data01 digoal/sshd</font></div><div><font size="2"   >docker run -d --net=none --dns=202.101.172.35 --name=mon3 --hostname=mon3 --privileged=true -v /data01/mon3:/data01 digoal/sshd</font></div><div><font size="2"   >docker run -d --net=none --dns=202.101.172.35 --name=osd1 --hostname=osd1 --privileged=true -v /data01/osd1:/data01 digoal/sshd</font></div><div><font size="2"   >docker run -d --net=none --dns=202.101.172.35 --name=osd2 --hostname=osd2 --privileged=true -v /data01/osd2:/data01 digoal/sshd</font></div><div><font size="2"   >docker run -d --net=none --dns=202.101.172.35 --name=osd3 --hostname=osd3 --privileged=true -v /data01/osd3:/data01 digoal/sshd</font></div><div><font size="2"   >docker run -d --net=none --dns=202.101.172.35 --name=osd4 --hostname=osd4 --privileged=true -v /data01/osd4:/data01 digoal/sshd</font></div><p></p></pre></div><p></p></div><div>状态如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >[root@localhost data01]# docker ps 
CONTAINER ID        IMAGE                COMMAND               CREATED             STATUS              PORTS               NAMES
02d922ce295b        digoal/sshd:latest   "/usr/sbin/sshd -D"   5 seconds ago       Up 5 seconds        22/tcp              osd2                
f6df72b9780f        digoal/sshd:latest   "/usr/sbin/sshd -D"   5 seconds ago       Up 4 seconds        22/tcp              osd3                
4c098166cc5d        digoal/sshd:latest   "/usr/sbin/sshd -D"   5 seconds ago       Up 4 seconds        22/tcp              osd4                
fa24ec5115f6        digoal/sshd:latest   "/usr/sbin/sshd -D"   6 seconds ago       Up 5 seconds        22/tcp              mon1                
59c41fc9560e        digoal/sshd:latest   "/usr/sbin/sshd -D"   6 seconds ago       Up 6 seconds        22/tcp              deploy              
9c9391eb3e1a        digoal/sshd:latest   "/usr/sbin/sshd -D"   6 seconds ago       Up 5 seconds        22/tcp              mon3                
34a7ceefcfd3        digoal/sshd:latest   "/usr/sbin/sshd -D"   6 seconds ago       Up 5 seconds        22/tcp              osd1                
5de0fae0d8bd        digoal/sshd:latest   "/usr/sbin/sshd -D"   6 seconds ago       Up 5 seconds        22/tcp              mon2                </span></font></div></pre></div><div>/*-------------------------------------------------------------------</div><div>使用pipework来配置更方便, 需要自行添加路由. 所以最好使用--privileged=true启动容器.&nbsp;</div><div>建议使用网桥, 不要使用 OVS, 因为加入OVS的接口peer消失后不会自动删除.</div><div>例如 :&nbsp;</div><div>./pipework.sh docker0 -i eth0 deploy 172.17.0.1/16</div><div>./pipework.sh br0 -i eth1 deploy 172.18.0.1/16</div><div>./pipework.sh br1 -i eth2 deploy 172.19.0.1/16</div><div><br></div><div>ssh 172.17.0.1</div><div>ip route add default via 172.17.42.1 dev eth0</div><div><br></div><div>pipework使用详见 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201411602632460/"   >http://blog.163.com/digoal@126/blog/static/163877040201411602632460/</a></div><div><br></div><div>获得这container的PID, 以此来配置网络.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >[root@localhost data01]# docker inspect -f '{{.State.Pid}}' deploy<br>17299<br>[root@localhost data01]# docker inspect -f '{{.State.Pid}}' mon1<br>17325<br>[root@localhost data01]# docker inspect -f '{{.State.Pid}}' mon2<br>17351<br>[root@localhost data01]# docker inspect -f '{{.State.Pid}}' mon3<br>17377<br>[root@localhost data01]# docker inspect -f '{{.State.Pid}}' osd1<br>17403<br>[root@localhost data01]# docker inspect -f '{{.State.Pid}}' osd2<br>17429<br>[root@localhost data01]# docker inspect -f '{{.State.Pid}}' osd3<br>17456<br>[root@localhost data01]# docker inspect -f '{{.State.Pid}}' osd4<br>17485</span></font></div><p></p></pre></div><div><br></div><div>添加peer接口 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >ip link add v00 type veth peer name vp00<br>ip link add v10 type veth peer name vp10<br>ip link add v20 type veth peer name vp20<br>ip link add v30 type veth peer name vp30<br>ip link add v40 type veth peer name vp40<br>ip link add v50 type veth peer name vp50<br>ip link add v60 type veth peer name vp60<br>ip link add v70 type veth peer name vp70<br>ip link add v01 type veth peer name vp01<br>ip link add v11 type veth peer name vp11<br>ip link add v21 type veth peer name vp21<br>ip link add v31 type veth peer name vp31<br>ip link add v41 type veth peer name vp41<br>ip link add v51 type veth peer name vp51<br>ip link add v61 type veth peer name vp61<br>ip link add v71 type veth peer name vp71<br>ip link add v02 type veth peer name vp02<br>ip link add v12 type veth peer name vp12<br>ip link add v22 type veth peer name vp22<br>ip link add v32 type veth peer name vp32<br>ip link add v42 type veth peer name vp42<br>ip link add v52 type veth peer name vp52<br>ip link add v62 type veth peer name vp62<br>ip link add v72 type veth peer name vp72</span></font></div><p></p></pre></div><div><br></div><div>配置container的netns :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >mkdir -p /var/run/netns<br>rm -rf /var/run/netns/17299<br>rm -rf /var/run/netns/17325<br>rm -rf /var/run/netns/17351<br>rm -rf /var/run/netns/17377<br>rm -rf /var/run/netns/17403<br>rm -rf /var/run/netns/17429<br>rm -rf /var/run/netns/17456<br>rm -rf /var/run/netns/17485<br>ln -s /proc/17299/ns/net /var/run/netns/17299<br>ln -s /proc/17325/ns/net /var/run/netns/17325<br>ln -s /proc/17351/ns/net /var/run/netns/17351<br>ln -s /proc/17377/ns/net /var/run/netns/17377<br>ln -s /proc/17403/ns/net /var/run/netns/17403<br>ln -s /proc/17429/ns/net /var/run/netns/17429<br>ln -s /proc/17456/ns/net /var/run/netns/17456<br>ln -s /proc/17485/ns/net /var/run/netns/17485</span></font></div><p></p></pre></div><div><br></div><div>将peer链路的一个端口分别指派给4个container.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 21px;"   >ip link set v00 netns 17299<br>ip link set v01 netns 17299<br>ip link set v02 netns 17299<br>ip link set v10 netns 17325<br>ip link set v11 netns 17325<br>ip link set v12 netns 17325<br>ip link set v20 netns 17351<br>ip link set v21 netns 17351<br>ip link set v22 netns 17351<br>ip link set v30 netns 17377<br>ip link set v31 netns 17377<br>ip link set v32 netns 17377<br>ip link set v40 netns 17403<br>ip link set v41 netns 17403<br>ip link set v42 netns 17403<br>ip link set v50 netns 17429<br>ip link set v51 netns 17429<br>ip link set v52 netns 17429<br>ip link set v60 netns 17456<br>ip link set v61 netns 17456<br>ip link set v62 netns 17456<br>ip link set v70 netns 17485<br>ip link set v71 netns 17485<br>ip link set v72 netns 17485</span></font></div><p></p></pre></div><div><br></div><div>使用ip netns配置container的IP地址, 并添加默认路由, 指向docker server bridge :&nbsp;</div><div><div><div><pre class="prettyprint"   ><p style="line-height: 28px;"   ></p><div><font size="2"   ><span style="line-height: 21px;"   >ip netns exec 17299 ip link set lo up<br>ip netns exec 17299 ip link set v00 up<br>ip netns exec 17299 ip link set v01 up<br>ip netns exec 17299 ip link set v02 up<br>ip netns exec 17299 ip addr add 172.17.0.1/16 dev v00<br>ip netns exec 17299 ip addr add 172.18.0.1/16 dev v01<br>ip netns exec 17299 ip addr add 172.19.0.1/16 dev v02<br>ip netns exec 17299 ip route add default via 172.17.42.1 dev v00<br>ip netns exec 17325 ip link set lo up<br>ip netns exec 17325 ip link set v10 up<br>ip netns exec 17325 ip link set v11 up<br>ip netns exec 17325 ip link set v12 up<br>ip netns exec 17325 ip addr add 172.17.0.2/16 dev v10<br>ip netns exec 17325 ip addr add 172.18.0.2/16 dev v11<br>ip netns exec 17325 ip addr add 172.19.0.2/16 dev v12<br>ip netns exec 17325 ip route add default via 172.17.42.1 dev v10<br>ip netns exec 17351 ip link set lo up<br>ip netns exec 17351 ip link set v20 up<br>ip netns exec 17351 ip link set v21 up<br>ip netns exec 17351 ip link set v22 up<br>ip netns exec 17351 ip addr add 172.17.0.3/16 dev v20<br>ip netns exec 17351 ip addr add 172.18.0.3/16 dev v21<br>ip netns exec 17351 ip addr add 172.19.0.3/16 dev v22<br>ip netns exec 17351 ip route add default via 172.17.42.1 dev v20<br>ip netns exec 17377 ip link set lo up<br>ip netns exec 17377 ip link set v30 up<br>ip netns exec 17377 ip link set v31 up<br>ip netns exec 17377 ip link set v32 up<br>ip netns exec 17377 ip addr add 172.17.0.4/16 dev v30<br>ip netns exec 17377 ip addr add 172.18.0.4/16 dev v31<br>ip netns exec 17377 ip addr add 172.19.0.4/16 dev v32<br>ip netns exec 17377 ip route add default via 172.17.42.1 dev v30<br>ip netns exec 17403 ip link set lo up<br>ip netns exec 17403 ip link set v40 up<br>ip netns exec 17403 ip link set v41 up<br>ip netns exec 17403 ip link set v42 up<br>ip netns exec 17403 ip addr add 172.17.0.5/16 dev v40<br>ip netns exec 17403 ip addr add 172.18.0.5/16 dev v41<br>ip netns exec 17403 ip addr add 172.19.0.5/16 dev v42<br>ip netns exec 17403 ip route add default via 172.17.42.1 dev v40<br>ip netns exec 17429 ip link set lo up<br>ip netns exec 17429 ip link set v50 up<br>ip netns exec 17429 ip link set v51 up<br>ip netns exec 17429 ip link set v52 up<br>ip netns exec 17429 ip addr add 172.17.0.6/16 dev v50<br>ip netns exec 17429 ip addr add 172.18.0.6/16 dev v51<br>ip netns exec 17429 ip addr add 172.19.0.6/16 dev v52<br>ip netns exec 17429 ip route add default via 172.17.42.1 dev v50<br>ip netns exec 17456 ip link set lo up<br>ip netns exec 17456 ip link set v60 up<br>ip netns exec 17456 ip link set v61 up<br>ip netns exec 17456 ip link set v62 up<br>ip netns exec 17456 ip addr add 172.17.0.7/16 dev v60<br>ip netns exec 17456 ip addr add 172.18.0.7/16 dev v61<br>ip netns exec 17456 ip addr add 172.19.0.7/16 dev v62<br>ip netns exec 17456 ip route add default via 172.17.42.1 dev v60<br>ip netns exec 17485 ip link set lo up<br>ip netns exec 17485 ip link set v70 up<br>ip netns exec 17485 ip link set v71 up<br>ip netns exec 17485 ip link set v72 up<br>ip netns exec 17485 ip addr add 172.17.0.8/16 dev v70<br>ip netns exec 17485 ip addr add 172.18.0.8/16 dev v71<br>ip netns exec 17485 ip addr add 172.19.0.8/16 dev v72<br>ip netns exec 17485 ip route add default via 172.17.42.1 dev v70</span></font></div><p style="line-height: 28px;"   ></p></pre></div></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >docker server 网桥地址</span></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@localhost ~]# ip addr show docker0</font></div><div style="line-height: 28px;"   ><font size="2"   >6: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; link/ether 56:84:7a:fe:97:99 brd ff:ff:ff:ff:ff:ff</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; inet 172.17.42.1/16 scope global docker0</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;valid_lft forever preferred_lft forever</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; inet6 fe80::5484:7aff:fefe:9799/64 scope link&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;valid_lft forever preferred_lft forever</font></div><p></p></pre></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >添加2个网桥 :&nbsp;</div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >[root@localhost netns]# brctl addbr br0</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@localhost netns]# brctl addbr br1</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@localhost netns]# ip link set br0 up</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@localhost netns]# ip link set br1 up</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@localhost netns]# ip addr add 172.18.42.1/16 dev br0</font></div><div style="line-height: 28px;"   ><font size="2"   >[root@localhost netns]# ip addr add 172.19.42.1/16 dev br1</font></div><p></p></pre></div></div><div style="line-height: 28px;"   ><br></div></div></div><div>将peer链路的另一个端口加入docker server对应的网桥, br0以及br1, 并启动接口.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >brctl addif docker0 vp00<br>brctl addif docker0 vp10<br>brctl addif docker0 vp20<br>brctl addif docker0 vp30<br>brctl addif docker0 vp40<br>brctl addif docker0 vp50<br>brctl addif docker0 vp60<br>brctl addif docker0 vp70</font></div><div><font size="2"   ><br>brctl addif br0 vp01<br>brctl addif br0 vp11<br>brctl addif br0 vp21<br>brctl addif br0 vp31<br>brctl addif br0 vp41<br>brctl addif br0 vp51<br>brctl addif br0 vp61<br>brctl addif br0 vp71<br><br>brctl addif br1 vp02<br>brctl addif br1 vp12<br>brctl addif br1 vp22<br>brctl addif br1 vp32<br>brctl addif br1 vp42<br>brctl addif br1 vp52<br>brctl addif br1 vp62<br>brctl addif br1 vp72</font></div><div><font size="2"   ><br>ip link set vp00 up<br>ip link set vp10 up<br>ip link set vp20 up<br>ip link set vp30 up<br>ip link set vp40 up<br>ip link set vp50 up<br>ip link set vp60 up<br>ip link set vp70 up<br>ip link set vp01 up<br>ip link set vp11 up<br>ip link set vp21 up<br>ip link set vp31 up<br>ip link set vp41 up<br>ip link set vp51 up<br>ip link set vp61 up<br>ip link set vp71 up<br>ip link set vp02 up<br>ip link set vp12 up<br>ip link set vp22 up<br>ip link set vp32 up<br>ip link set vp42 up<br>ip link set vp52 up<br>ip link set vp62 up<br>ip link set vp72 up</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@localhost netns]# brctl show<br>bridge name     bridge id               STP enabled     interfaces<br>br0             8000.0a26f690e66f       no              vp01<br>                                                        vp11<br>                                                        vp21<br>                                                        vp31<br>                                                        vp41<br>                                                        vp51<br>                                                        vp61<br>                                                        vp71<br>br1             8000.42bddaccbbc9       no              vp02<br>                                                        vp12<br>                                                        vp22<br>                                                        vp32<br>                                                        vp42<br>                                                        vp52<br>                                                        vp62<br>                                                        vp72<br>docker0         8000.56847afe9799       no              vp00<br>                                                        vp10<br>                                                        vp20<br>                                                        vp30<br>                                                        vp40<br>                                                        vp50<br>                                                        vp60<br>                                                        vp70</font></div><p></p></pre></div><div><br></div><div>--------------------------------------------------------------------------------------------- &nbsp; */</div><div><br></div><div>测试网络连通性 :&nbsp;</div></div><div>连接到deploy节点 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost ~]# ssh 172.17.0.1</font></div><div><font size="2"   >The authenticity of host '172.17.0.1 (172.17.0.1)' can't be established.</font></div><div><font size="2"   >ECDSA key fingerprint is db:5c:6b:2a:bc:9e:3e:31:24:1b:c0:8d:5f:96:f2:e0.</font></div><div><font size="2"   >Are you sure you want to continue connecting (yes/no)? yes</font></div><div><font size="2"   >Warning: Permanently added '172.17.0.1' (ECDSA) to the list of known hosts.</font></div><div><font size="2"   >root@172.17.0.1's password: 密码Digoal_sshd_1999</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@65a05647c55d ~]# ping www.baidu.com</font></div><div><font size="2"   >PING www.a.shifen.com (115.239.211.110) 56(84) bytes of data.</font></div><div><font size="2"   >64 bytes from 115.239.211.110: icmp_seq=1 ttl=55 time=2.67 ms</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@65a05647c55d ~]# ip link</font></div><div><font size="2"   >1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</font></div><div><font size="2"   >64: v1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT qlen 1000</font></div><div><font size="2"   >&nbsp; &nbsp; link/ether 4a:e5:cd:99:f5:c8 brd ff:ff:ff:ff:ff:ff</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@65a05647c55d ~]# ip addr show</font></div><div><font size="2"   >1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</font></div><div><font size="2"   >&nbsp; &nbsp; inet 127.0.0.1/8 scope host lo</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;valid_lft forever preferred_lft forever</font></div><div><font size="2"   >&nbsp; &nbsp; inet6 ::1/128 scope host&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;valid_lft forever preferred_lft forever</font></div><div><font size="2"   >64: v1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</font></div><div><font size="2"   >&nbsp; &nbsp; link/ether 4a:e5:cd:99:f5:c8 brd ff:ff:ff:ff:ff:ff</font></div><div><font size="2"   >&nbsp; &nbsp; inet 172.17.0.1/16 scope global v1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;valid_lft forever preferred_lft forever</font></div><div><font size="2"   >&nbsp; &nbsp; inet6 fe80::48e5:cdff:fe99:f5c8/64 scope link&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;valid_lft forever preferred_lft forever</font></div><p></p></pre></div><div><br></div><div>开始部署ceph :&nbsp;</div><div>首先查看ceph安装环境的需求 :&nbsp;</div><div><a target="_blank" rel="nofollow" href="http://docs.ceph.com/docs/master/start/os-recommendations/"   >http://docs.ceph.com/docs/master/start/os-recommendations/</a></div><div>1. kernel版本, centos 7 的 内核版本3.10.x 符合需求.</div><div>2. 文件系统, centos 7 默认使用xfs文件系统, 符合要求.</div><div><br></div><div>(在所有的docker container中配置yum 仓库)</div><div>使用yum 安装, 首先要配置yum仓库, 参考如下 :&nbsp;</div><div><h2 style="margin: 30px 0px 10px; padding: 5px 10px; text-transform: uppercase; font-weight: normal; font-stretch: normal; font-size: 18px; line-height: 1.8; font-family: 'Titillium Web'; color: rgb(230, 232, 232); background-color: rgb(94, 106, 113);"   >REQUIREMENTS<a title="Permalink to this headline" style="color: rgb(198, 15, 15); text-decoration: none; visibility: visible; font-size: 0.8em; padding: 0px 4px;" rel="nofollow" href="http://ceph.com/docs/master/install/get-packages/#requirements"   >?</a></h2><p style="line-height: 1.5em; color: rgb(62, 67, 73); font-family: Helvetica, Arial, sans-serif; font-size: 14px;"   >All Ceph deployments require Ceph packages (except for development). You should also add keys and recommended packages.</p><ul style="color: rgb(62, 67, 73); font-family: Helvetica, Arial, sans-serif; font-size: 14px; line-height: 19.6000003814697px;"   ><li style="line-height: 1.5em;"   ><strong>Keys: (Recommended)</strong>&nbsp;Whether you add repositories or download packages manually, you should download keys to verify the packages. If you do not get the keys, you may encounter security warnings. There are two keys: one for releases (common) and one for development (programmers and QA only). Choose the key that suits your needs. See&nbsp;<a style="color: rgb(240, 92, 86); text-decoration: none;" rel="nofollow" href="http://ceph.com/docs/master/install/get-packages/#add-keys"   >Add Keys</a>&nbsp;for details.</li><li style="line-height: 1.5em;"   ><strong>Ceph Extras: (Required)</strong>&nbsp;The Ceph Extras repository provides newer Ceph-enabled versions of packages which are already provided in your Linux distribution, but where newer versions are required to support Ceph. Examples of newer versions of available packages include QEMU for CentOS/RHEL distribution and iSCSI among others. If you intend to use any of the foregoing packages, you must add the Ceph Extras repository or download the packages manually. This repository also contains Ceph dependencies for those who intend to install Ceph manually. See&nbsp;<a style="color: rgb(240, 92, 86); text-decoration: none;" rel="nofollow" href="http://ceph.com/docs/master/install/get-packages/#add-ceph-extras"   >Add Ceph Extras</a>&nbsp;for details.</li><li style="line-height: 1.5em;"   ><strong>Ceph: (Required)</strong>&nbsp;All Ceph deployments require Ceph release packages, except for deployments that use development packages (development, QA, and bleeding edge deployments only). See&nbsp;<a style="color: rgb(240, 92, 86); text-decoration: none;" rel="nofollow" href="http://ceph.com/docs/master/install/get-packages/#add-ceph"   >Add Ceph</a>&nbsp;for details.</li><li style="line-height: 1.5em;"   ><strong>Ceph Development: (Optional)</strong>&nbsp;If you are developing for Ceph, testing Ceph development builds, or if you want features from the bleeding edge of Ceph development, you may get Ceph development packages. See&nbsp;<a style="color: rgb(240, 92, 86); text-decoration: none;" rel="nofollow" href="http://ceph.com/docs/master/install/get-packages/#add-ceph-development"   >Add Ceph Development</a>&nbsp;for details.</li><li style="line-height: 1.5em;"   ><strong>Apache/FastCGI: (Optional)</strong>&nbsp;If you are deploying a&nbsp;<a style="color: rgb(240, 92, 86); text-decoration: none;" rel="nofollow" href="http://ceph.com/docs/master/glossary/#term-ceph-object-storage"   ><em>Ceph Object Storage</em></a>&nbsp;service, you must install Apache and FastCGI. Ceph provides Apache and FastCGI builds that are identical to those available from Apache, but with 100-continue support. If you want to enable&nbsp;<a style="color: rgb(240, 92, 86); text-decoration: none;" rel="nofollow" href="http://ceph.com/docs/master/glossary/#term-ceph-object-gateway"   ><em>Ceph Object Gateway</em></a>daemons with 100-continue support, you must retrieve Apache/FastCGI packages from the Ceph repository. See&nbsp;<a style="color: rgb(240, 92, 86); text-decoration: none;" rel="nofollow" href="http://ceph.com/docs/master/install/get-packages/#add-apache-fastcgi"   >Add Apache/FastCGI</a>&nbsp;for details.</li></ul><p style="line-height: 1.5em; color: rgb(62, 67, 73); font-family: Helvetica, Arial, sans-serif; font-size: 14px;"   >If you intend to download packages manually, see Section&nbsp;<a style="color: rgb(240, 92, 86); text-decoration: none;" rel="nofollow" href="http://ceph.com/docs/master/install/get-packages/#download-packages"   >Download Packages</a>.</p></div><div><br></div><div>配置yum 仓库的步骤 :&nbsp;</div><div>详细参考 :&nbsp;</div><div><a target="_blank" rel="nofollow" href="http://ceph.com/docs/master/install/get-packages/"   >http://ceph.com/docs/master/install/get-packages/</a></div><div>注: 使用rhel6或centos6的话, yum仓库配置文件中使用el6替换el7.</div><div><br></div><div>1. 添加 KEY</div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 ~]# rpm --import 'https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc'</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >2. 添加 ceph extras 源</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@150 ~]# cd /etc/yum.repos.d/</font></div><div><font size="2"   >[root@150 yum.repos.d]# uname -r</font></div><div><font size="2"   >3.10.0-123.el7.x86_64</font></div></div><div><font size="2"   >使用el7.</font></div><div><span style="line-height: 28px;"   ><font size="2"   >(目前ceph extras没有el的源, 只能添加同内核版本的fedora, 如centos7对应fedora19, 以后如果有了el源, 可以使用el7代替fedora19)</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   ><br></font></span></div><div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >[root@150 yum.repos.d]# vi ceph-extras.repo</font></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >[ceph-extras]</font></div><div style="line-height: 28px;"   ><font size="2"   >name=Ceph Extras Packages</font></div><div style="line-height: 28px;"   ><font size="2"   >baseurl=http://ceph.com/packages/ceph-extras/rpm/fedora19/$basearch</font></div><div style="line-height: 28px;"   ><font size="2"   >enabled=1</font></div><div style="line-height: 28px;"   ><font size="2"   >priority=2</font></div><div style="line-height: 28px;"   ><font size="2"   >gpgcheck=1</font></div><div style="line-height: 28px;"   ><font size="2"   >type=rpm-md</font></div><div style="line-height: 28px;"   ><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >[ceph-extras-noarch]</font></div><div style="line-height: 28px;"   ><font size="2"   >name=Ceph Extras noarch</font></div><div style="line-height: 28px;"   ><font size="2"   >baseurl=http://ceph.com/packages/ceph-extras/rpm/fedora19/noarch</font></div><div style="line-height: 28px;"   ><font size="2"   >enabled=1</font></div><div style="line-height: 28px;"   ><font size="2"   >priority=2</font></div><div style="line-height: 28px;"   ><font size="2"   >gpgcheck=1</font></div><div style="line-height: 28px;"   ><font size="2"   >type=rpm-md</font></div><div style="line-height: 28px;"   ><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc</font></div><div style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></div><div style="line-height: 28px;"   ><font size="2"   >[ceph-extras-source]</font></div><div style="line-height: 28px;"   ><font size="2"   >name=Ceph Extras Sources</font></div><div style="line-height: 28px;"   ><font size="2"   >baseurl=http://ceph.com/packages/ceph-extras/rpm/fedora19/SRPMS</font></div><div style="line-height: 28px;"   ><font size="2"   >enabled=1</font></div><div style="line-height: 28px;"   ><font size="2"   >priority=2</font></div><div style="line-height: 28px;"   ><font size="2"   >gpgcheck=1</font></div><div style="line-height: 28px;"   ><font size="2"   >type=rpm-md</font></div><div style="line-height: 28px;"   ><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc</font></div></div></div><p></p></pre></div><div><br></div><div>3. 添加 ceph源, 使用最新的stable release版本, giant, 如果以后出了其他版本, 可以使用其他版本名代替giant.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 yum.repos.d]# vi ceph.repo</font></div><div><div><font size="2"   >[ceph]</font></div><div><font size="2"   >name=Ceph packages for $basearch</font></div><div><font size="2"   >baseurl=http://ceph.com/rpm-giant/el7/$basearch</font></div><div><font size="2"   >enabled=1</font></div><div><font size="2"   >priority=2</font></div><div><font size="2"   >gpgcheck=1</font></div><div><font size="2"   >type=rpm-md</font></div><div><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[ceph-noarch]</font></div><div><font size="2"   >name=Ceph noarch packages</font></div><div><font size="2"   >baseurl=http://ceph.com/rpm-giant/el7/noarch</font></div><div><font size="2"   >enabled=1</font></div><div><font size="2"   >priority=2</font></div><div><font size="2"   >gpgcheck=1</font></div><div><font size="2"   >type=rpm-md</font></div><div><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[ceph-source]</font></div><div><font size="2"   >name=Ceph source packages</font></div><div><font size="2"   >baseurl=http://ceph.com/rpm-giant/el7/SRPMS</font></div><div><font size="2"   >enabled=0</font></div><div><font size="2"   >priority=2</font></div><div><font size="2"   >gpgcheck=1</font></div><div><font size="2"   >type=rpm-md</font></div><div><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc</font></div></div><p></p></pre></div><div><br></div><div>现有ceph的版本信息如下, 最新版本为G开头的Giant.</div><div><p style="line-height: 1.5em; color: rgb(62, 67, 73); font-family: Helvetica, Arial, sans-serif; font-size: 14px;"   >The major releases of Ceph include:</p><ul style="color: rgb(62, 67, 73); font-family: Helvetica, Arial, sans-serif; font-size: 14px; line-height: 19.6000003814697px;"   ><li style="line-height: 1.5em;"   ><strong>Giant:</strong>&nbsp;Giant is the most recent major release of Ceph. These packages are recommended for anyone deploying Ceph in a production environment. Critical bug fixes are backported and point releases are made as necessary.</li><li style="line-height: 1.5em;"   ><strong>Firefly:</strong>&nbsp;Firefly is the sixth major release of Ceph. These packages are recommended for anyone deploying Ceph in a production environment. Firefly is a long-term stable release, so critical bug fixes are backported and point releases are made as necessary.</li><li style="line-height: 1.5em;"   ><strong>Emperor:</strong>&nbsp;Emperor is the fifth major release of Ceph. These packages are are old and no longer supported, so we recommend that users upgrade to Firefly immediately.</li><li style="line-height: 1.5em;"   ><strong>Dumpling:</strong>&nbsp;Dumpling is the fourth major release of Ceph. These packages are older and not recommended for new users, but critical bug fixes are still backported as necessary. We encourage all Dumpling users to update to Firefly as soon as they are able to do so.</li><li style="line-height: 1.5em;"   ><strong>Argonaut, Bobtail, Cuttlefish:</strong>&nbsp;These are the first three releases of Ceph. These packages are old and no longer supported, so we recommend that users upgrade to a supported version.</li></ul></div><div><br></div><div>4. 如果不使用对象存储服务, 可以不添加以下源.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 yum.repos.d]# vi ceph-apache.repo</font></div><div><div><font size="2"   >[apache2-ceph-noarch]</font></div><div><font size="2"   >name=Apache noarch packages for Ceph</font></div><div><font size="2"   >baseurl=http://gitbuilder.ceph.com/apache2-rpm-fedora19-x86_64-basic/ref/master</font></div><div><font size="2"   >enabled=1</font></div><div><font size="2"   >priority=2</font></div><div><font size="2"   >gpgcheck=1</font></div><div><font size="2"   >type=rpm-md</font></div><div><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/autobuild.asc</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[apache2-ceph-source]</font></div><div><font size="2"   >name=Apache source packages for Ceph</font></div><div><font size="2"   >baseurl=http://gitbuilder.ceph.com/apache2-rpm-fedora19-x86_64-basic/ref/master</font></div><div><font size="2"   >enabled=0</font></div><div><font size="2"   >priority=2</font></div><div><font size="2"   >gpgcheck=1</font></div><div><font size="2"   >type=rpm-md</font></div><div><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/autobuild.asc</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[fastcgi-ceph-basearch]</font></div><div><font size="2"   >name=FastCGI basearch packages for Ceph</font></div><div><font size="2"   >baseurl=http://gitbuilder.ceph.com/mod_fastcgi-rpm-fedora19-x86_64-basic/ref/master</font></div><div><font size="2"   >enabled=1</font></div><div><font size="2"   >priority=2</font></div><div><font size="2"   >gpgcheck=1</font></div><div><font size="2"   >type=rpm-md</font></div><div><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/autobuild.asc</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[fastcgi-ceph-noarch]</font></div><div><font size="2"   >name=FastCGI noarch packages for Ceph</font></div><div><font size="2"   >baseurl=http://gitbuilder.ceph.com/mod_fastcgi-rpm-fedora19-x86_64-basic/ref/master</font></div><div><font size="2"   >enabled=1</font></div><div><font size="2"   >priority=2</font></div><div><font size="2"   >gpgcheck=1</font></div><div><font size="2"   >type=rpm-md</font></div><div><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/autobuild.asc</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >[fastcgi-ceph-source]</font></div><div><font size="2"   >name=FastCGI source packages for Ceph</font></div><div><font size="2"   >baseurl=http://gitbuilder.ceph.com/mod_fastcgi-rpm-fedora19-x86_64-basic/ref/master</font></div><div><font size="2"   >enabled=0</font></div><div><font size="2"   >priority=2</font></div><div><font size="2"   >gpgcheck=1</font></div><div><font size="2"   >type=rpm-md</font></div><div><font size="2"   >gpgkey=https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/autobuild.asc</font></div></div><p></p></pre></div><wbr><div><br></div><div>检查yum配置是否正确</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 yum.repos.d]# yum search all ceph</font></div><div><div><font size="2"   >========================================================== Matched: ceph ===========================================================</font></div><div><font size="2"   >ceph.x86_64 : User space components of the Ceph file system</font></div><div><font size="2"   >ceph-common.x86_64 : Ceph Common</font></div><div><font size="2"   >ceph-debuginfo.x86_64 : Debug information for package ceph</font></div><div><font size="2"   >ceph-deploy.noarch : Admin and deploy tool for Ceph</font></div><div><font size="2"   >ceph-devel.x86_64 : Ceph headers</font></div><div><font size="2"   >ceph-fuse.x86_64 : Ceph fuse-based client</font></div><div><font size="2"   >ceph-libs-compat.x86_64 : Meta package to include ceph libraries.</font></div><div><font size="2"   >ceph-release.noarch : Ceph repository configuration</font></div><div><font size="2"   >ceph-test.x86_64 : Ceph benchmarks and test tools</font></div><div><font size="2"   >cephfs-java.x86_64 : Java libraries for the Ceph File System.</font></div><div><font size="2"   >libcephfs1.x86_64 : Ceph distributed file system client library</font></div><div><font size="2"   >libcephfs_jni1.x86_64 : Java Native Interface library for CephFS Java bindings.</font></div><div><font size="2"   >python-ceph.x86_64 : Python libraries for the Ceph distributed filesystem</font></div><div><font size="2"   >rbd-fuse.x86_64 : Ceph fuse-based client</font></div><div><font size="2"   >ceph-radosgw.x86_64 : Rados REST gateway</font></div><div><font size="2"   >librados2.x86_64 : RADOS distributed object store client library</font></div><div><font size="2"   >librbd1.x86_64 : RADOS block device client library</font></div><div><font size="2"   >libradosstriper1.x86_64 : RADOS striping interface</font></div><div><font size="2"   >radosgw-agent.noarch : Synchronize users and data between radosgw clusters</font></div><div><font size="2"   >rest-bench.x86_64 : RESTful benchmark</font></div></div><p></p></pre></div><div>最后, 需要配置所有节点的内核参数 :&nbsp;</div><div>建议参数 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/etc/sysctl.conf</font></div><div><font size="2"   >kernel.pid_max=4194303</font></div><div><div><font size="2"   >kernel.shmmni = 4096</font></div><div><font size="2"   >kernel.sem = 50100 64128000 50100 1280</font></div><div><font size="2"   >fs.file-max = 7672460</font></div><div><font size="2"   >net.ipv4.ip_local_port_range = 9000 65000</font></div><div><font size="2"   >net.core.rmem_default = 1048576</font></div><div><font size="2"   >net.core.rmem_max = 4194304</font></div><div><font size="2"   >net.core.wmem_default = 262144</font></div><div><font size="2"   >net.core.wmem_max = 1048576</font></div><div><font size="2"   >net.ipv4.tcp_tw_recycle = 1</font></div><div><font size="2"   >net.ipv4.tcp_max_syn_backlog = 4096</font></div><div><font size="2"   >net.core.netdev_max_backlog = 10000</font></div><div><font size="2"   ><br></font></div></div><div><font size="2"   >/etc/security/limits.conf</font></div><div><div><font size="2"   >* soft &nbsp; &nbsp;nofile &nbsp;131072</font></div><div><font size="2"   >* hard &nbsp; &nbsp;nofile &nbsp;131072</font></div><div><font size="2"   >* soft &nbsp; &nbsp;nproc &nbsp; 131072</font></div><div><font size="2"   >* hard &nbsp; &nbsp;nproc &nbsp; 131072</font></div><div><font size="2"   >* soft &nbsp; &nbsp;core &nbsp; &nbsp;unlimited</font></div><div><font size="2"   >* hard &nbsp; &nbsp;core &nbsp; &nbsp;unlimited</font></div><div><font size="2"   >* soft &nbsp; &nbsp;memlock 50000000</font></div><div><font size="2"   >* hard &nbsp; &nbsp;memlock 50000000</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >/etc/security/limits.d/90-nproc.conf&nbsp;</font></div><div><div><font size="2"   >* soft &nbsp; &nbsp;nproc &nbsp; 131072</font></div><div><font size="2"   >* hard &nbsp; &nbsp;nproc &nbsp; 131072</font></div></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://docs.ceph.com/docs/master/start/quick-start-preflight/"   >http://docs.ceph.com/docs/master/start/quick-start-preflight/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://docs.ceph.com/docs/master/start/quick-ceph-deploy/"   >http://docs.ceph.com/docs/master/start/quick-ceph-deploy/</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://ceph.com/resources/downloads/"   >http://ceph.com/resources/downloads/</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://ceph.com/docs/master/release-notes/"   >http://ceph.com/docs/master/release-notes/</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://ceph.com/docs/master/start/"   >http://ceph.com/docs/master/start/</a></div><div>6.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://ceph.com/docs/master/install/get-packages/"   >http://ceph.com/docs/master/install/get-packages/</a></div><div>7.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://ceph.com/docs/master/glossary/"   >http://ceph.com/docs/master/glossary/</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="ceph install in CentOS 7 x64 within docker - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>