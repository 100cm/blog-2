<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">阿里云RDS for PostgreSQL试用报告 - 1</h2>
	<h5 id="">2015-06-10 13:30:34&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402015599230431/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>昨天申请了5台阿里云的RDS，再加上PG群里的兄弟贡献的几台，可以用plproxy开始测试分布式了。</div><div>申请的RDS都是最低配置的，容量5GB，内存1GB，支持100个连接，IOPS 400。</div><div>先看看配置吧，为了提高性能，有一些参数是可以调整的，如下：</div><wbr><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >postgres=&gt; select name,substring(setting,1,10),unit from pg_settings order by category, name;</font></span></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; substring &nbsp; &nbsp; &nbsp; &nbsp; | unit&nbsp;</font></div><div><font size="2"   >-------------------------------------+---------------------------+------</font></div><div><font size="2"   >&nbsp;autovacuum &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;autovacuum_analyze_scale_factor &nbsp; &nbsp; | 0.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;autovacuum_analyze_threshold &nbsp; &nbsp; &nbsp; &nbsp;| 50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;autovacuum_freeze_max_age &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 200000000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;autovacuum_max_workers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;autovacuum_multixact_freeze_max_age | 400000000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;autovacuum_naptime &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| s &nbsp; &nbsp;-- &nbsp;值略大，容易膨胀，建议改小</font></div><div><font size="2"   color="#ff0000"   >&nbsp;autovacuum_vacuum_cost_delay &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ms &nbsp;-- 如果IOPS比较差，可以考虑改为10毫秒，但是注意容易导致膨胀</font></div><div><font size="2"   >&nbsp;autovacuum_vacuum_cost_limit &nbsp; &nbsp; &nbsp; &nbsp;| -1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;autovacuum_vacuum_scale_factor &nbsp; &nbsp; &nbsp;| 0.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp;&nbsp;<span style="line-height: 28px;"   >-- &nbsp;值略大，可能容易膨胀，不够考虑到IOPS，就算了。</span></font></div><div><font size="2"   >&nbsp;autovacuum_vacuum_threshold &nbsp; &nbsp; &nbsp; &nbsp; | 50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;client_encoding &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | UTF8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;DateStyle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ISO, YMD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;default_text_search_config &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| pg_catalog &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;extra_float_digits &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;IntervalStyle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | postgres &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;lc_collate &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| zh_CN.UTF- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp;| &nbsp; -- &nbsp;个人建议LC相关的全部改为C，并且数据库初始化时也建议选C</font></div><div><font size="2"   >&nbsp;lc_ctype &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| zh_CN.UTF- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;lc_messages &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | C &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;lc_monetary &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | zh_CN.UTF- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;lc_numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| zh_CN.UTF- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;lc_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | zh_CN.UTF- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;server_encoding &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | UTF8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;TimeZone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| PRC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;timezone_abbreviations &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Default &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;gin_fuzzy_search_limit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;tcp_keepalives_count &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;tcp_keepalives_idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 7200 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| s &nbsp; &nbsp;-- 建议改小，例如60，如果有跨广域网访问的话。</font></div><div><font size="2"   color="#ff0000"   >&nbsp;tcp_keepalives_interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 75 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| s &nbsp;&nbsp;<span style="line-height: 28px;"   >-- 建议改小</span></font></div><div><font size="2"   >&nbsp;local_preload_libraries &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;bytea_output &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| hex &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;check_function_bodies &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;default_tablespace &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;default_transaction_deferrable &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;default_transaction_isolation &nbsp; &nbsp; &nbsp; | read commi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;default_transaction_read_only &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;lock_timeout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ms &nbsp; &nbsp; &nbsp;-- &nbsp;建议用户针对自己的业务，修改锁等待超时</font></div><div><font size="2"   >&nbsp;search_path &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | "$user",pu &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;session_replication_role &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| origin &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;statement_timeout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ms &nbsp; &nbsp;-- &nbsp;建议用户针对自己的业务，修改语句执行超时</font></div><div><font size="2"   >&nbsp;temp_tablespaces &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;transaction_deferrable &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;transaction_isolation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | read commi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;transaction_read_only &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;vacuum_freeze_min_age &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 50000000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;vacuum_freeze_table_age &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 150000000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;vacuum_multixact_freeze_min_age &nbsp; &nbsp; | 5000000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;vacuum_multixact_freeze_table_age &nbsp; | 150000000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;xmlbinary &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | base64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;xmloption &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | content &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;bonjour &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;bonjour_name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;listen_addresses &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| * &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;max_connections &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;port &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 3009 &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -- &nbsp;这是数据库的监听端口，和RDS提供的端口不一样，说明RDS用了中间件或端口代理</font></div><div><font size="2"   color="#ff0000"   >&nbsp;superuser_reserved_connections &nbsp; &nbsp; &nbsp;| 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp;| &nbsp; -- 为超级用户保留的连接，阿里云管理RDS用的，超级用户对客户不开放</font></div><div><font size="2"   >&nbsp;unix_socket_group &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;unix_socket_permissions &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0777 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -- 这个权限改为0700更靠谱</font></div><div><font size="2"   >&nbsp;authentication_timeout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| s</font></div><div><font size="2"   >&nbsp;db_user_namespace &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;krb_caseins_users &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;password_encryption &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;ssl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; -- &nbsp;对于跨广域网的访问，建议阿里云允许SSL连接</font></div><div><font size="2"   >&nbsp;ssl_ca_file &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;ssl_cert_file &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | server.crt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;ssl_crl_file &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;ssl_key_file &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| server.key &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;ssl_prefer_server_ciphers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;ssl_renegotiation_limit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 524288 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| kB</font></div><div><font size="2"   color="#ff0000"   >&nbsp;pg_stat_statements.max &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -- &nbsp;阿里云RDS默认开启了pg_stat_statements</font></div><div><font size="2"   >&nbsp;pg_stat_statements.save &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;pg_stat_statements.track &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;pg_stat_statements.track_utility &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;allow_system_table_mods &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;debug_assertions &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;ignore_checksum_failure &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;ignore_system_indexes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;post_auth_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | s</font></div><div><font size="2"   >&nbsp;pre_auth_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | s</font></div><div><font size="2"   >&nbsp;trace_notify &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;trace_recovery_messages &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | log &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;trace_sort &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;zero_damaged_pages &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;exit_on_error &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;restart_after_crash &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;deadlock_timeout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| ms &nbsp;-- 锁时间超过1秒，记录锁等待SQL以及其他状态</font></div><div><font size="2"   >&nbsp;max_locks_per_transaction &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;max_pred_locks_per_transaction &nbsp; &nbsp; &nbsp;| 64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;block_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 8192 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -- &nbsp;数据块大小，对当下的硬件，建议用32KB的块</font></div><div><font size="2"   color="#ff0000"   >&nbsp;data_checksums &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -- checksums打开，对性能有一定影响，开启了FULL PAGE WRITE一般没有必要开这个</font></div><div><font size="2"   >&nbsp;integer_datetimes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;max_function_args &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;max_identifier_length &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 63 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;max_index_keys &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;segment_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 131072 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 8kB &nbsp; -- 单个数据文件最大1GB</font></div><div><font size="2"   >&nbsp;server_version &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 9.4.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;server_version_num &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 90401 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;wal_block_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 8192 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;wal_segment_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 2048 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 8kB &nbsp;-- 单个WAL文件16MB</font></div><div><font size="2"   >&nbsp;geqo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;geqo_effort &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;geqo_generations &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;geqo_pool_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;geqo_seed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;geqo_selection_bias &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;geqo_threshold &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;| &nbsp; -- 超过12个对象的JOIN会使用遗传优化算法，不用穷举法</font></div><div><font size="2"   >&nbsp;constraint_exclusion &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| partition &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;cursor_tuple_fraction &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;default_statistics_target &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;from_collapse_limit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;join_collapse_limit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;cpu_index_tuple_cost &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.005 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; -- 成本因子，不知道阿里有没有针对硬件环境调整，看样子是没有调整</font></div><div><font size="2"   >&nbsp;cpu_operator_cost &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0.0025 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;cpu_tuple_cost &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0.01 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;effective_cache_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 98304 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8kB &nbsp;-- 只给了800MB，难道在宿主机连这个也限了？</font></div><div><font size="2"   >&nbsp;random_page_cost &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;seq_page_cost &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;enable_bitmapscan &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;enable_hashagg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;enable_hashjoin &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;enable_indexonlyscan &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;enable_indexscan &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;enable_material &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;enable_mergejoin &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;enable_nestloop &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;enable_seqscan &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;enable_sort &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;enable_tidscan &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;synchronous_standby_names &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; -- 未开启同步流复制</font></div><div><font size="2"   >&nbsp;vacuum_defer_cleanup_age &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;max_replication_slots &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;max_wal_senders &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;wal_keep_segments &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;wal_sender_timeout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 60000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ms</font></div><div><font size="2"   color="#ff0000"   >&nbsp;hot_standby &nbsp; &nbsp; &nbsp;&nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -- 开启了hot_standby，可能是用于HA的，如果开放超级用户或者复制用户的话，客户可以将整个集群通过流复制协议搞出来。不过阿里云只提供了普通用户给客户使用。</font></div><div><font size="2"   >&nbsp;hot_standby_feedback &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;max_standby_archive_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 30000 &nbsp; &nbsp; | ms  <span style="line-height: 21px;"   > -- 如果将来阿里云要开放读写分离，在SLAVE要跑LONG SQL的话，可能要加大这个值</span></font></div><div><font size="2"   >&nbsp;max_standby_streaming_delay &nbsp; &nbsp; &nbsp; &nbsp; | 30000 &nbsp; &nbsp; &nbsp;&nbsp; | ms  -- 如果将来阿里云要开放读写分离，在SLAVE要跑LONG SQL的话，可能要加大这个值</font></div><div><font size="2"   >&nbsp;wal_receiver_status_interval &nbsp; &nbsp; &nbsp; &nbsp;| 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| s  -- 建议缩短feedback时延</font></div><div><font size="2"   >&nbsp;wal_receiver_timeout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 60000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ms  </font></div><div><font size="2"   >&nbsp;application_name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| psql &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;debug_pretty_print &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;debug_print_parse &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;debug_print_plan &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;debug_print_rewritten &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;log_autovacuum_min_duration &nbsp; &nbsp; &nbsp; &nbsp; | -1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| ms &nbsp;-- 这个值建议改为0，记录所有的垃圾回收操作</font></div><div><font size="2"   color="#ff0000"   >&nbsp;log_checkpoints &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; -- 建议打开</font></div><div><font size="2"   color="#ff0000"   >&nbsp;log_connections &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; -- 建议打开</font></div><div><font size="2"   color="#ff0000"   >&nbsp;log_disconnections &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; -- 建议打开</font></div><div><font size="2"   >&nbsp;log_duration &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;log_error_verbosity &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | default &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; -- 建议改为 verbose, 记录代码位置</font></div><div><font size="2"   >&nbsp;log_hostname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;log_line_prefix &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | \x01 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +|&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; %p &nbsp; &nbsp; &nbsp;%r &nbsp; &nbsp; &nbsp;% |&nbsp;</font></div><div><font size="2"   >&nbsp;log_lock_waits &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;log_statement &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; -- &nbsp;又一个对性能有影响的参数，阿里RDS将记录所有的SQL</font></div><div><font size="2"   >&nbsp;log_temp_files &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 100000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| kB</font></div><div><font size="2"   >&nbsp;log_timezone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| UTC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;client_min_messages &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | notice &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;log_min_duration_statement &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| ms &nbsp;-- 开了log_statement=all, 这个就没有必要了。</font></div><div><font size="2"   >&nbsp;log_min_error_statement &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | error &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;log_min_messages &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| warning &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;event_source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| PostgreSQL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;log_destination &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | stderr &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;| &nbsp; -- &nbsp;建议使用csvlog，或者加一个remote log。日志统一发到监控平台。</font></div><div><font size="2"   >&nbsp;log_file_mode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0600 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;logging_collector &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;log_rotation_age &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | min</font></div><div><font size="2"   >&nbsp;log_rotation_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 10240 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | kB</font></div><div><font size="2"   >&nbsp;log_truncate_on_rotation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;syslog_facility &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | local0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;syslog_ident &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| postgres &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;effective_io_concurrency &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;max_worker_processes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;bgwriter_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| ms</font></div><div><font size="2"   >&nbsp;bgwriter_lru_maxpages &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;bgwriter_lru_multiplier &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;vacuum_cost_delay &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; | 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; | ms &nbsp;-- 如果想降低垃圾回收对IO的影响，可以改为10毫秒，但是垃圾回收的时间会拉长</font></div><div><font size="2"   >&nbsp;vacuum_cost_limit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 200 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;vacuum_cost_page_dirty &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;vacuum_cost_page_hit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;vacuum_cost_page_miss &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;temp_file_limit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | -1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| kB</font></div><div><font size="2"   >&nbsp;max_files_per_process &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 1000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;autovacuum_work_mem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | -1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| kB</font></div><div><font size="2"   >&nbsp;dynamic_shared_memory_type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| posix &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;huge_pages &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| try &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;maintenance_work_mem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 16384 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | kB</font></div><div><font size="2"   color="#ff0000"   >&nbsp;max_prepared_transactions &nbsp; &nbsp;  &nbsp; | 800 &nbsp; &nbsp; &nbsp; | &nbsp; -- &nbsp;允许用户使用分布式事务，一般不建议打开，对于不熟悉的用户，可能导致膨胀，xid wrap等不良后果。除非有使用的必要。</font></div><div><font size="2"   >&nbsp;max_stack_depth &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 2048 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| kB</font></div><div><font size="2"   color="#ff0000"   >&nbsp;shared_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 32768 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8kB &nbsp;-- &nbsp;太小了吧，到底是只有1G内存的实例</font></div><div><font size="2"   >&nbsp;temp_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 1024 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 8kB</font></div><div><font size="2"   >&nbsp;track_activity_query_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 1024 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;work_mem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 4096 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| kB</font></div><div><font size="2"   >&nbsp;log_executor_stats &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;log_parser_stats &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;log_planner_stats &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;log_statement_stats &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;track_activities &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;track_counts &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;track_functions &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp;-- 这个也是对性能有影响的，统计所有的函数调用</font></div><div><font size="2"   color="#ff0000"   >&nbsp;track_io_timing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| -- 对IO耗时进行统计，相当影响性能</font></div><div><font size="2"   >&nbsp;update_process_title &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;transform_null_equals &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;array_nulls &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;backslash_quote &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | safe_encod &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;default_with_oids &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;escape_string_warning &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;lo_compat_privileges &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;quote_all_identifiers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;sql_inheritance &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;standard_conforming_strings &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;synchronize_seqscans &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;archive_command &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | cp %p /u02 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;archive_mode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -- 开启了归档，是为了更好的做在线备份</font></div><div><font size="2"   >&nbsp;archive_timeout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | s</font></div><div><font size="2"   color="#ff0000"   >&nbsp;checkpoint_completion_target &nbsp; &nbsp; &nbsp; &nbsp;| 0.9 &nbsp; &nbsp; &nbsp; | &nbsp; -- &nbsp;检查点的时间拉这么长，是IOPS性能较差的妥协，恢复时间也会拉长。</font></div><div><font size="2"   color="#ff0000"   >&nbsp;checkpoint_segments &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -- shared buffer只有256MB，但是这个有1GB的间隔，可以考虑加大shared buffer。前提是cgroup不会限制。</font></div><div><font size="2"   >&nbsp;checkpoint_timeout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 300 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | s</font></div><div><font size="2"   >&nbsp;checkpoint_warning &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| s</font></div><div><font size="2"   color="#ff0000"   >&nbsp;commit_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 0 &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; | &nbsp; -- &nbsp;未开启分组提交，对于高并发的场景，建议打开。当然也可以关闭<span style="line-height: 28px;"   >synchronous_commit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;达到同样的目的。</span></font></div><div><font size="2"   >&nbsp;commit_siblings &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;full_page_writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; -- 如果底层块设备的原子写大于等于block_size，和wal_block_size，可以关闭full_page_writes, 或者底层文件系统可以避免partial write，也可以关闭fpw.</font></div><div><font size="2"   color="#ff0000"   >&nbsp;synchronous_commit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on &nbsp;  &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp;| &nbsp;-- 对于非重要事务，建议在事务级别关闭<span style="line-height: 28px;"   >synchronous_commit &nbsp; 来提高性能。</span></font></div><div><font size="2"   >&nbsp;wal_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 983 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8kB</font></div><div><font size="2"   >&nbsp;wal_level &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | hot_standb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;wal_log_hints &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   color="#ff0000"   >&nbsp;wal_sync_method &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | fdatasync &nbsp; &nbsp; &nbsp;  &nbsp; | &nbsp; -- 建议根据wal所在的块设备测试一下，使用最快的fsync接口</font></div><div><font size="2"   color="#ff0000"   >&nbsp;wal_writer_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 200 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ms &nbsp;-- &nbsp;建议改为10ms</font></div><div><font size="2"   >(228 rows)</font></div></div><p></p></pre></div><div>以上有很多可以优化或调整的地方，希望阿里云RDS团队的人看到或者用户看到，大家一起来把RDS搞好，用好。</div><div><br></div><div>接下来先做一个简单的单个实例的性能测试，因为RDS实例是最低配置的，而且鉴于以上配置有些对性能影响较大的，同时网络层面不是直连数据库，因为阿里云里面还有一层中间件，另外还有一个对性能有影响的是用了其他机房的ECS去测试RDS，所以结果可能和我们自己笔记本上测试的都相差甚远。</div><div>请看：</div><div>生成测试数据，为了减少IOPS，因为CGROUP现在了只有400的IOPS，所以我们的测试数据和索引加起来要小于256MB，用户数据200万条，会话数据200万条，一共400万条初始数据，以及日志表一个。</div><div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >\timing</font></div><div><font size="2"   >set synchronous_commit=off;</font></div><div><font size="2"   >create table userinfo (userid int,info jsonb);</font></div><div><font size="2"   >insert into userinfo select generate_series(1,2000000);</font></div><div><font size="2"   >create table session (userid int,last_login timestamp);</font></div><div><font size="2"   >insert into session select generate_series(1,2000000);</font></div><div><font size="2"   >create table login_log (userid int,db_user name,client_addr inet,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;client_port int,server_addr inet,server_port int,login_time timestamp);</font></div><div><font size="2"   >set maintenance_work_mem='1GB';</font></div><div><font size="2"   >alter table userinfo add constraint pk_userinfo primary key (userid);</font></div><div><font size="2"   >alter table session add constraint pk_session primary key (userid);</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >postgres=&gt; \dt+</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of relations</font></div><div><font size="2"   >&nbsp;Schema | &nbsp; &nbsp; &nbsp;Name &nbsp; &nbsp; &nbsp; | Type &nbsp;| Owner &nbsp;| &nbsp;Size &nbsp;| Description&nbsp;</font></div><div><font size="2"   >--------+-----------------+-------+--------+--------+-------------</font></div><div><font size="2"   >&nbsp;public | ha_health_check | table | aurora | 40 kB &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;public | login_log &nbsp; &nbsp; &nbsp; | table | digoal | 141 MB |&nbsp;</font></div><div><font size="2"   >&nbsp;public | session &nbsp; &nbsp; &nbsp; &nbsp; | table | digoal | 75 MB &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;public | userinfo &nbsp; &nbsp; &nbsp; &nbsp;| table | digoal | 69 MB &nbsp;|&nbsp;</font></div><div><font size="2"   >(4 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=&gt; \di+</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List of relations</font></div><div><font size="2"   >&nbsp;Schema | &nbsp; &nbsp; &nbsp; &nbsp; Name &nbsp; &nbsp; &nbsp; &nbsp; | Type &nbsp;| Owner &nbsp;| &nbsp; &nbsp; &nbsp;Table &nbsp; &nbsp; &nbsp;| Size &nbsp;| Description&nbsp;</font></div><div><font size="2"   >--------+----------------------+-------+--------+-----------------+-------+-------------</font></div><div><font size="2"   >&nbsp;public | ha_health_check_pkey | index | aurora | ha_health_check | 16 kB |&nbsp;</font></div><div><font size="2"   >&nbsp;public | login_log_pkey &nbsp; &nbsp; &nbsp; | index | digoal | login_log &nbsp; &nbsp; &nbsp; | 22 MB |&nbsp;</font></div><div><font size="2"   >&nbsp;public | pk_session &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | index | digoal | session &nbsp; &nbsp; &nbsp; &nbsp; | 43 MB |&nbsp;</font></div><div><font size="2"   >&nbsp;public | pk_userinfo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| index | digoal | userinfo &nbsp; &nbsp; &nbsp; &nbsp;| 43 MB |&nbsp;</font></div><div><font size="2"   >(4 rows)</font></div></div><p></p></pre></div><div><br></div><div>将数据加载到内存：</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >create extension pg_prewarm;</font></span></div><div><font size="2"   >select pg_prewarm('userinfo');</font></div><div><font size="2"   >select pg_prewarm('pk_userinfo');</font></div><div><font size="2"   >select pg_prewarm('session');</font></div><div><font size="2"   >select pg_prewarm('pk_session');</font></div><p></p></pre></div><div><br></div><div>创建测试函数，包含3个操作：</div><div>1. 基于PK执行查询用户表，</div><div>2. 基于PK更新会话表，</div><div>3. 插入日志</div><div>共三个操作的事务，使用异步提交。</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create or replace function f_test(i_id int) returns void as $$</font></div><div><font size="2"   >declare</font></div><div><font size="2"   >&nbsp; v_t timestamp := now();</font></div><div><font size="2"   >begin</font></div><div><font size="2"   >&nbsp; set synchronous_commit = off;</font></div><div><font size="2"   >&nbsp; perform 1 from userinfo where userid=i_id;</font></div><div><font size="2"   >&nbsp; update session set last_login=v_t where userid=i_id;</font></div><div><font size="2"   >&nbsp; insert into login_log (userid,db_user,client_addr,client_port,server_addr,server_port,login_time)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; values (i_id,current_user,inet_client_addr(),inet_client_port(),inet_server_addr(),inet_server_port(),v_t);</font></div><div><font size="2"   >&nbsp; return;</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >$$ language plpgsql strict;</font></div><p></p></pre></div><div><br></div><div>验证：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=&gt; select f_test(1);</font></div><div><font size="2"   >&nbsp;f_test&nbsp;</font></div><div><font size="2"   >--------</font></div><div><font size="2"   >&nbsp;</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >postgres=&gt; select now(),* from session where userid=1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; now &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| userid | &nbsp; &nbsp; &nbsp; &nbsp;last_login &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >-------------------------------+--------+---------------------------</font></div><div><font size="2"   >&nbsp;2015-06-10 11:44:01.820262+08 | &nbsp; &nbsp; &nbsp;1 | 2015-06-10 11:44:01.22805</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div></div><div><br></div><div style="line-height: 28px;"   >测试机是阿里云的ECS（1核的ECS，也是较烂的性能了），与数据库在北京的不同机房（因为没找到同机房的ECS），测试：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi test.sql</font></div><div><font size="2"   >\setrandom id 1 2000000</font></div><div><font size="2"   >select f_test(:id);</font></div><p></p></pre></div><div>测试5分钟，每5秒输出一次tps统计，测试结果：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pgbench -M prepared -n -r -f ./test.sql -c 16 -j 16 -P 5 -h xxxx -p 3433 -U digoal -T 300 postgres</font></div><div><font size="2"   >progress: 5.0 s, 2903.1 tps, lat 5.482 ms stddev 7.189</font></div><div><font size="2"   >progress: 10.0 s, 3101.8 tps, lat 5.162 ms stddev 6.366</font></div><div><font size="2"   >progress: 15.0 s, 3131.1 tps, lat 5.098 ms stddev 6.286</font></div><div><font size="2"   >progress: 20.0 s, 3060.6 tps, lat 5.234 ms stddev 6.591</font></div><div><font size="2"   >progress: 25.0 s, 3198.8 tps, lat 4.998 ms stddev 6.069</font></div><div><font size="2"   >progress: 30.0 s, 3110.7 tps, lat 5.144 ms stddev 6.362</font></div><div><font size="2"   >progress: 35.0 s, 2972.9 tps, lat 5.376 ms stddev 6.899</font></div><div><font size="2"   >progress: 40.0 s, 3060.7 tps, lat 5.224 ms stddev 6.609</font></div><div><font size="2"   >progress: 45.0 s, 3057.8 tps, lat 5.232 ms stddev 6.642</font></div><div><font size="2"   >progress: 50.0 s, 3051.0 tps, lat 5.242 ms stddev 6.601</font></div><div><font size="2"   >progress: 55.0 s, 3083.9 tps, lat 5.192 ms stddev 6.454</font></div><div><font size="2"   >progress: 60.0 s, 3154.5 tps, lat 5.063 ms stddev 6.247</font></div><div><font size="2"   >progress: 65.0 s, 3103.8 tps, lat 5.166 ms stddev 6.421</font></div><div><font size="2"   >progress: 70.0 s, 3099.7 tps, lat 5.158 ms stddev 6.464</font></div><div><font size="2"   >progress: 75.0 s, 3141.9 tps, lat 5.092 ms stddev 6.292</font></div><div><font size="2"   >progress: 80.0 s, 3105.9 tps, lat 5.140 ms stddev 6.406</font></div><div><font size="2"   >progress: 85.0 s, 3097.7 tps, lat 5.161 ms stddev 6.412</font></div><div><font size="2"   >progress: 90.0 s, 3112.3 tps, lat 5.146 ms stddev 6.339</font></div><div><font size="2"   >progress: 95.0 s, 3023.9 tps, lat 5.271 ms stddev 6.627</font></div><div><font size="2"   >progress: 100.0 s, 3088.4 tps, lat 5.194 ms stddev 6.426</font></div><div><font size="2"   >progress: 105.0 s, 3095.3 tps, lat 5.178 ms stddev 6.358</font></div><div><font size="2"   >progress: 110.0 s, 3085.7 tps, lat 5.172 ms stddev 6.465</font></div><div><font size="2"   >progress: 115.0 s, 3143.2 tps, lat 5.099 ms stddev 6.185</font></div><div><font size="2"   >progress: 122.9 s, 1429.7 tps, lat 6.803 ms stddev 78.508</font></div><div><font size="2"   >progress: 127.8 s, 174.7 tps, lat 95.927 ms stddev 617.430</font></div><div><font size="2"   >progress: 130.5 s, 443.2 tps, lat 61.379 ms stddev 460.493</font></div><div><font size="2"   >progress: 135.5 s, 240.0 tps, lat 68.903 ms stddev 379.392</font></div><div><font size="2"   >progress: 143.0 s, 179.9 tps, lat 45.773 ms stddev 314.194</font></div><div><font size="2"   >progress: 148.1 s, 330.8 tps, lat 74.456 ms stddev 564.188</font></div><div><font size="2"   >progress: 150.2 s, 993.0 tps, lat 20.515 ms stddev 249.150</font></div><div><font size="2"   >progress: 158.5 s, 265.6 tps, lat 58.506 ms stddev 422.513</font></div><div><font size="2"   >progress: 160.3 s, 1535.6 tps, lat 15.287 ms stddev 188.301</font></div><div><font size="2"   >progress: 168.8 s, 377.9 tps, lat 34.676 ms stddev 309.978</font></div><div><font size="2"   >progress: 170.0 s, 2758.9 tps, lat 15.764 ms stddev 204.179</font></div><div><font size="2"   >progress: 175.0 s, 992.6 tps, lat 16.132 ms stddev 146.747</font></div><div><font size="2"   >progress: 180.0 s, 1061.1 tps, lat 15.093 ms stddev 136.797</font></div><div><font size="2"   >progress: 185.0 s, 487.3 tps, lat 32.812 ms stddev 302.795</font></div><div><font size="2"   >progress: 190.8 s, 1665.7 tps, lat 6.174 ms stddev 57.000</font></div><div><font size="2"   >progress: 195.7 s, 834.5 tps, lat 16.647 ms stddev 189.034</font></div><div><font size="2"   >progress: 204.2 s, 1839.9 tps, lat 10.975 ms stddev 147.814</font></div><div><font size="2"   >progress: 205.0 s, 3180.3 tps, lat 8.171 ms stddev 95.892</font></div><div><font size="2"   >progress: 210.0 s, 3216.4 tps, lat 4.972 ms stddev 10.054</font></div><div><font size="2"   >progress: 215.0 s, 1229.4 tps, lat 13.029 ms stddev 166.420</font></div><div><font size="2"   >progress: 220.0 s, 3178.3 tps, lat 5.039 ms stddev 7.517</font></div><div><font size="2"   >progress: 225.0 s, 3261.0 tps, lat 4.897 ms stddev 11.573</font></div><div><font size="2"   >progress: 230.0 s, 3149.3 tps, lat 5.073 ms stddev 7.657</font></div><div><font size="2"   >progress: 235.0 s, 3200.8 tps, lat 4.995 ms stddev 7.128</font></div><div><font size="2"   >progress: 240.0 s, 3128.6 tps, lat 5.121 ms stddev 9.665</font></div><div><font size="2"   >progress: 245.0 s, 3063.0 tps, lat 5.223 ms stddev 6.571</font></div><div><font size="2"   >progress: 250.0 s, 3047.3 tps, lat 5.250 ms stddev 6.514</font></div><div><font size="2"   >progress: 255.0 s, 3192.3 tps, lat 5.007 ms stddev 6.121</font></div><div><font size="2"   >progress: 260.0 s, 3113.3 tps, lat 5.148 ms stddev 6.379</font></div><div><font size="2"   >progress: 265.0 s, 3278.1 tps, lat 4.871 ms stddev 5.762</font></div><div><font size="2"   >progress: 270.0 s, 3091.6 tps, lat 5.181 ms stddev 6.378</font></div><div><font size="2"   >progress: 275.0 s, 3172.2 tps, lat 5.034 ms stddev 6.098</font></div><div><font size="2"   >progress: 280.0 s, 2879.8 tps, lat 5.556 ms stddev 7.319</font></div><div><font size="2"   >progress: 285.0 s, 3267.2 tps, lat 4.900 ms stddev 5.850</font></div><div><font size="2"   >progress: 290.0 s, 3174.6 tps, lat 5.035 ms stddev 6.097</font></div><div><font size="2"   >progress: 295.0 s, 3201.1 tps, lat 4.996 ms stddev 6.033</font></div><div><font size="2"   >progress: 300.0 s, 3071.6 tps, lat 5.216 ms stddev 6.439</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 16</font></div><div><font size="2"   >number of threads: 16</font></div><div><font size="2"   >duration: 300 s</font></div><div><font size="2"   >number of transactions actually processed: 720287</font></div><div><font size="2"   >latency average: 6.663 ms</font></div><div><font size="2"   >latency stddev: 72.356 ms</font></div><div><font size="2"   >tps = 2400.926759 (including connections establishing)</font></div><div><font size="2"   >tps = 2401.013184 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.002118 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 2000000</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 6.659889 &nbsp; &nbsp; &nbsp; &nbsp;select f_test(:id);</font></div><p></p></pre></div><div>性能抖动分析，虽然拿不到数据库的日志，但是基本上和检查点有关，检查点时会产生刷脏数据的IO，因此更新会变慢，同时又开启了FPW，所以接下来的脏块写WAL BUFFER开销会变大，所以性能抖动严重，这个是需要优化的，但是IOPS是无法优化的硬伤。详见我以前写的一些分析文章：</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201542103933969/"   >http://blog.163.com/digoal@126/blog/static/163877040201542103933969/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402015463252387/"   >http://blog.163.com/digoal@126/blog/static/1638770402015463252387/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020154651655783/"   >http://blog.163.com/digoal@126/blog/static/16387704020154651655783/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020154653422892/"   >http://blog.163.com/digoal@126/blog/static/16387704020154653422892/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020154811421484/"   >http://blog.163.com/digoal@126/blog/static/16387704020154811421484/</a></div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020154129958753/"   >http://blog.163.com/digoal@126/blog/static/16387704020154129958753/</a></div><div>所以我们再看看不带更新, 只有查询和插入的测试吧：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >create or replace function f_test(i_id int) returns void as $$</font></div><div><font size="2"   >declare</font></div><div><font size="2"   >&nbsp; v_t timestamp := now();</font></div><div><font size="2"   >begin</font></div><div><font size="2"   >&nbsp; set synchronous_commit = off;</font></div><div><font size="2"   >&nbsp; perform 1 from userinfo where userid=i_id;</font></div><div><font size="2"   >&nbsp; -- update session set last_login=v_t where userid=i_id;</font></div><div><font size="2"   >&nbsp; insert into login_log (userid,db_user,client_addr,client_port,server_addr,server_port,login_time)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; values (i_id,current_user,inet_client_addr(),inet_client_port(),inet_server_addr(),inet_server_port(),v_t);</font></div><div><font size="2"   >&nbsp; return;</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >$$ language plpgsql strict;</font></div><p></p></pre></div><div>测试结果，性能相当平稳：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pgbench -M prepared -n -r -f ./test.sql -c 16 -j 16 -P 5 -h xxxx -p 3433 -U digoal -T 300 postgres</font></div><div><font size="2"   >progress: 5.0 s, 3571.7 tps, lat 4.466 ms stddev 4.847</font></div><div><font size="2"   >progress: 10.0 s, 3653.7 tps, lat 4.379 ms stddev 4.484</font></div><div><font size="2"   >progress: 15.0 s, 3675.6 tps, lat 4.352 ms stddev 4.416</font></div><div><font size="2"   >progress: 20.0 s, 3688.8 tps, lat 4.337 ms stddev 4.420</font></div><div><font size="2"   >progress: 25.0 s, 3766.2 tps, lat 4.247 ms stddev 4.116</font></div><div><font size="2"   >progress: 30.0 s, 3626.6 tps, lat 4.411 ms stddev 4.657</font></div><div><font size="2"   >progress: 35.0 s, 3683.6 tps, lat 4.342 ms stddev 4.424</font></div><div><font size="2"   >progress: 40.0 s, 3735.7 tps, lat 4.282 ms stddev 4.283</font></div><div><font size="2"   >progress: 45.0 s, 3818.3 tps, lat 4.189 ms stddev 4.027</font></div><div><font size="2"   >progress: 50.0 s, 3736.7 tps, lat 4.281 ms stddev 4.259</font></div><div><font size="2"   >progress: 55.0 s, 3763.7 tps, lat 4.250 ms stddev 4.158</font></div><div><font size="2"   >progress: 60.0 s, 3768.1 tps, lat 4.245 ms stddev 4.169</font></div><div><font size="2"   >progress: 65.0 s, 3699.0 tps, lat 4.324 ms stddev 4.355</font></div><div><font size="2"   >progress: 70.0 s, 3698.1 tps, lat 4.326 ms stddev 4.345</font></div><div><font size="2"   >progress: 75.0 s, 3653.2 tps, lat 4.378 ms stddev 4.496</font></div><div><font size="2"   >progress: 80.0 s, 3623.2 tps, lat 4.415 ms stddev 4.615</font></div><div><font size="2"   >progress: 85.0 s, 3653.9 tps, lat 4.378 ms stddev 4.464</font></div><div><font size="2"   >progress: 90.0 s, 3548.9 tps, lat 4.507 ms stddev 4.958</font></div><div><font size="2"   >progress: 95.0 s, 3656.9 tps, lat 4.374 ms stddev 4.520</font></div><div><font size="2"   >progress: 100.0 s, 3750.1 tps, lat 4.265 ms stddev 4.221</font></div><div><font size="2"   >progress: 105.0 s, 3742.4 tps, lat 4.274 ms stddev 4.190</font></div><div><font size="2"   >progress: 110.0 s, 3662.2 tps, lat 4.368 ms stddev 4.464</font></div><div><font size="2"   >progress: 115.0 s, 3652.6 tps, lat 4.379 ms stddev 4.431</font></div><div><font size="2"   >progress: 120.0 s, 3707.2 tps, lat 4.315 ms stddev 4.363</font></div><div><font size="2"   >progress: 125.0 s, 3765.1 tps, lat 4.248 ms stddev 4.216</font></div><div><font size="2"   >progress: 130.0 s, 3750.7 tps, lat 4.265 ms stddev 4.244</font></div><div><font size="2"   >progress: 135.0 s, 3693.3 tps, lat 4.331 ms stddev 4.371</font></div><div><font size="2"   >progress: 140.0 s, 3748.8 tps, lat 4.267 ms stddev 4.264</font></div><div><font size="2"   >progress: 145.0 s, 3702.3 tps, lat 4.320 ms stddev 4.297</font></div><div><font size="2"   >progress: 150.0 s, 3584.9 tps, lat 4.462 ms stddev 4.832</font></div><div><font size="2"   >progress: 155.0 s, 3537.5 tps, lat 4.522 ms stddev 4.942</font></div><div><font size="2"   >progress: 160.0 s, 3638.0 tps, lat 4.397 ms stddev 4.472</font></div><div><font size="2"   >progress: 165.0 s, 3645.4 tps, lat 4.388 ms stddev 4.489</font></div><div><font size="2"   >progress: 170.0 s, 3642.1 tps, lat 4.392 ms stddev 4.488</font></div><div><font size="2"   >progress: 175.0 s, 3650.1 tps, lat 4.382 ms stddev 4.473</font></div><div><font size="2"   >progress: 180.0 s, 3550.6 tps, lat 4.505 ms stddev 4.733</font></div><div><font size="2"   >progress: 185.0 s, 3550.3 tps, lat 4.505 ms stddev 4.613</font></div><div><font size="2"   >progress: 190.0 s, 3703.2 tps, lat 4.319 ms stddev 4.374</font></div><div><font size="2"   >progress: 195.0 s, 3666.0 tps, lat 4.363 ms stddev 4.440</font></div><div><font size="2"   >progress: 200.0 s, 3660.2 tps, lat 4.371 ms stddev 4.520</font></div><div><font size="2"   >progress: 205.0 s, 3686.4 tps, lat 4.339 ms stddev 4.374</font></div><div><font size="2"   >progress: 210.0 s, 3557.1 tps, lat 4.497 ms stddev 4.882</font></div><div><font size="2"   >progress: 215.0 s, 3546.0 tps, lat 4.505 ms stddev 4.914</font></div><div><font size="2"   >progress: 220.0 s, 3726.5 tps, lat 4.298 ms stddev 4.293</font></div><div><font size="2"   >progress: 225.0 s, 3740.5 tps, lat 4.276 ms stddev 4.247</font></div><div><font size="2"   >progress: 230.0 s, 3704.3 tps, lat 4.318 ms stddev 4.337</font></div><div><font size="2"   >progress: 235.0 s, 3635.7 tps, lat 4.400 ms stddev 4.510</font></div><div><font size="2"   >progress: 240.0 s, 3592.6 tps, lat 4.453 ms stddev 4.675</font></div><div><font size="2"   >progress: 245.0 s, 3581.2 tps, lat 4.466 ms stddev 4.732</font></div><div><font size="2"   >progress: 250.0 s, 3609.8 tps, lat 4.431 ms stddev 4.626</font></div><div><font size="2"   >progress: 255.0 s, 3628.8 tps, lat 4.408 ms stddev 4.549</font></div><div><font size="2"   >progress: 260.0 s, 3611.0 tps, lat 4.430 ms stddev 4.608</font></div><div><font size="2"   >progress: 265.0 s, 3666.0 tps, lat 4.363 ms stddev 4.395</font></div><div><font size="2"   >progress: 270.0 s, 3657.9 tps, lat 4.373 ms stddev 4.575</font></div><div><font size="2"   >progress: 275.0 s, 3603.4 tps, lat 4.439 ms stddev 4.791</font></div><div><font size="2"   >progress: 280.0 s, 3794.4 tps, lat 4.215 ms stddev 4.105</font></div><div><font size="2"   >progress: 285.0 s, 3759.1 tps, lat 4.255 ms stddev 4.123</font></div><div><font size="2"   >progress: 290.0 s, 3631.6 tps, lat 4.405 ms stddev 4.468</font></div><div><font size="2"   >progress: 295.0 s, 3741.2 tps, lat 4.275 ms stddev 4.196</font></div><div><font size="2"   >progress: 300.0 s, 3743.8 tps, lat 4.273 ms stddev 4.223</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 16</font></div><div><font size="2"   >number of threads: 16</font></div><div><font size="2"   >duration: 300 s</font></div><div><font size="2"   >number of transactions actually processed: 1101227</font></div><div><font size="2"   >latency average: 4.357 ms</font></div><div><font size="2"   >latency stddev: 4.453 ms</font></div><div><font size="2"   >tps = 3670.717757 (including connections establishing)</font></div><div><font size="2"   >tps = 3670.852824 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.002000 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 2000000</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 4.354966 &nbsp; &nbsp; &nbsp; &nbsp;select f_test(:id);</font></div><p></p></pre></div><div><br></div><div>小结：</div><div>1.RDS内部再优化一下，性能还会更加靠谱。可以参考前面的参数分析。</div><div><span style="line-height: 28px;"   >2.另外需要注意别触碰到IOPS的瓶颈，因为是用cgroup限制的，影响很大。</span></div><div><span style="line-height: 28px;"   >3.RDS用了异步流复制，所以用户需要注意，是否有绝对的不丢事务的需求，这点一定要和阿里云确定清楚。</span></div><div><br></div><div>其他：</div><div>在阿里云RDS中使用dblink：</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >CREATE SERVER fdtest FOREIGN DATA WRAPPER dblink_fdw OPTIONS (host 'xxxxxx', dbname 'postgres<span style="line-height: 28px;"   >', port '3433');</span></font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >CREATE USER MAPPING FOR digoal SERVER fdtest OPTIONS (user 'xxx', password 'xxx');</font></div><div style="line-height: 28px;"   ><font size="2"   >GRANT USAGE ON FOREIGN SERVER fdtest TO digoal;</font></div><div style="line-height: 28px;"   ><font size="2"   >SELECT dblink_connect('myconn', 'fdtest');</font></div></div><p></p></pre></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   >查看数据库的真实IP</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >postgres=&gt; SELECT * from dblink('myconn', 'select inet_server_addr()') as t(ip inet);</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; ip</font></div><div style="line-height: 28px;"   ><font size="2"   >---------------</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;10.151.133.18</font></div><div style="line-height: 28px;"   ><font size="2"   >(1 row)</font></div><p></p></pre></div><div style="line-height: 28px;"   >查看客户端的真实IP，从现象上看，至少中间件这层在IP层好像是透明的，或者做了协议适配。</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >postgres=&gt; SELECT * from dblink('myconn', 'select inet_client_addr()') as t(ip inet);</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; ip</font></div><div style="line-height: 28px;"   ><font size="2"   >---------------</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;10.151.133.19</font></div><div style="line-height: 28px;"   ><font size="2"   >(1 row)</font></div><p></p></pre></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   >查看standby状态，普通用户现在了一些信息的查看。</span></div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >postgres=&gt; &nbsp;select * from pg_stat_replication ;</font></span></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >&nbsp; pid &nbsp; | usesysid | &nbsp;usename &nbsp; | application_name | client_addr | client_hostname | client_port | backend_start | backend_xmin | st</font></div><div style="line-height: 28px;"   ><font size="2"   >ate | sent_location | write_location | flush_location | replay_location | sync_priority | sync_state&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >--------+----------+------------+------------------+-------------+-----------------+-------------+---------------+--------------+---</font></div><div style="line-height: 28px;"   ><font size="2"   >----+---------------+----------------+----------------+-----------------+---------------+------------</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;204877 | &nbsp; &nbsp;16384 | replicator | standby1 &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; 3310 | &nbsp;&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >(1 row)</font></div></div><p></p></pre></div></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   >除了普通用户digoal, 还有几个用户是RDS后台用的，复制用的。</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >postgres=&gt; \du</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of roles</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Role name &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Attributes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Member of&nbsp;</font></div><div style="line-height: 28px;"   ><font size="2"   >-------------------------+------------------------------------------------+-----------</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;aurora &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Superuser &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| {}</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;aurora_proxy &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Superuser &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| {}</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;digoal &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Create role, Create DB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | {}</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;pgrdskp501t1znuuzp2xxxx | Superuser, Create role, Create DB, Replication | {}  -- 这里可能暴露了主机名，建议改改</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp;replicator &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Superuser, Replication &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | {}</font></div></div></div><div></div><p></p></pre></div></div></div><div><br></div><div>待续。。。</div><div style="line-height: 28px;"   >后期再测试使用plproxy分布式处理的性能</div><div style="line-height: 28px;"   ><br></div><div>【参考】</div><div><div style="line-height: 28px;"   ><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201542103933969/"   >http://blog.163.com/digoal@126/blog/static/163877040201542103933969/</a></div><div style="line-height: 28px;"   ><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402015463252387/"   >http://blog.163.com/digoal@126/blog/static/1638770402015463252387/</a></div><div style="line-height: 28px;"   ><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020154651655783/"   >http://blog.163.com/digoal@126/blog/static/16387704020154651655783/</a></div><div style="line-height: 28px;"   ><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020154653422892/"   >http://blog.163.com/digoal@126/blog/static/16387704020154653422892/</a></div><div style="line-height: 28px;"   ><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020154811421484/"   >http://blog.163.com/digoal@126/blog/static/16387704020154811421484/</a></div><div style="line-height: 28px;"   ><a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020154129958753/"   >http://blog.163.com/digoal@126/blog/static/16387704020154129958753/</a></div></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="阿里云RDS for PostgreSQL试用报告 - 1 - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>