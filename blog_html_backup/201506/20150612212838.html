<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Pay attention: Oracle INTEGER is NUMBER(p) not INT4 in PostgreSQL</h2>
	<h5 id="">2015-06-12 21:28:38&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020155129167746/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>今天一位朋友问我Oracle转换到PostgreSQL时，Oracle的INT应该转换为PostgreSQL的什么类型？<br></div><div>差点被integer这个词迷惑，其实在Oracle中，integer使用NUMBER来存储的，只是不存储小数。</div><div>例如：</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SQL&gt; set numwidth 50</font></div><div><font size="2"   >SQL&gt; create table test(id int);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Table created.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; insert into test values (9999999999999999999);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >1 row created.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SQL&gt; select * from test;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ID</font></div><div><font size="2"   >--------------------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9999999999999999999</font></div><p></p></pre></div><div>在sqlplus客户端中，数字长度显示默认为10，超出的话会用科学方法表示，所以不要误以为这是精度问题哦。</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SQL&gt; set numwidth 10</font></div><div><font size="2"   >SQL&gt; select * from test;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ID</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >1.0000E+19</font></div><p></p></pre></div></div><div>精度实际上是NUMBER(38)。超过可能遇到BUG，虽然可以存储进去。例如以下，40个9显示正常，但是41个9时进位了，已经精度不准确。</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SQL&gt; insert into test values (9999999999999999999999999999999999999999);</font></div><div><font size="2"   >SQL&gt; insert into test values (99999999999999999999999999999999999999999);</font></div><div><font size="2"   >SQL&gt; select * from test;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ID</font></div><div><font size="2"   >--------------------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9999999999999999999999999999999999999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 100000000000000000000000000000000000000000</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >使用NUMERIC表现一样：</font></div><div><font size="2"   >SQL&gt; drop table test;<br>Table dropped.<br>SQL&gt; create table test(id numeric);<br>Table created.<br>SQL&gt; insert into test values (9999999999999999999999999999999999999999);<br>SQL&gt; insert into test values (99999999999999999999999999999999999999999);<br>SQL&gt; select * from test;<br>                                                ID<br>--------------------------------------------------<br>          9999999999999999999999999999999999999999<br>        100000000000000000000000000000000000000000</font></div><p></p></pre></div><div><br></div><div>在PostgreSQL中，我们要使用对应的numeric类型来代替Oracle的int类型，并且非常完美，超出40位没有问题。</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select 9999999999999999999999999999999999999999::numeric;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------</font></div><div><font size="2"   >&nbsp;9999999999999999999999999999999999999999</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select 99999999999999999999999999999999999999999::numeric;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >-------------------------------------------</font></div><div><font size="2"   >&nbsp;99999999999999999999999999999999999999999</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select 99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999::numeric;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >-------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select 9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999::numeric;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >---------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999</font></div><div><font size="2"   >99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select 999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999::numeric;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >-----------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999</font></div><div><font size="2"   >999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999</font></div><div><font size="2"   >9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# select 999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999998888888888888888888888888888888888888888888888888888888888888888888888888888::numeric;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;num</font></div><div><font size="2"   >eric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >--</font></div><div><font size="2"   >&nbsp;99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999</font></div><div><font size="2"   >999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999</font></div><div><font size="2"   >999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999</font></div><div><font size="2"   >999999999999999999999999999999999999999999999999999999999888888888888888888888888888888888888888888888888888888888888888888888888888</font></div><div><font size="2"   >8</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# create table test(id numeric);<br>CREATE TABLE<br>postgres=# insert into test values (9999999999999999999999999999999999999999);<br>INSERT 0 1<br>postgres=# insert into test values (99999999999999999999999999999999999999999);<br>INSERT 0 1<br>postgres=# select * from test;<br>                    id                     <br>-------------------------------------------<br>  9999999999999999999999999999999999999999<br> 99999999999999999999999999999999999999999<br>(2 rows)<br><br>postgres=# insert into test values (9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999991111111111111111111111111111111111111111111111111111111111111111111);<br>INSERT 0 1<br>postgres=# select * from test;<br>                                                                                id                                                  <br>                              <br>------------------------------------------------------------------------------------------------------------------------------------<br>------------------------------<br>                                                                                                                         99999999999<br>99999999999999999999999999999<br>                                                                                                                        999999999999<br>99999999999999999999999999999<br> 99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999911111111111111111111111111111111111111<br>11111111111111111111111111111<br>(3 rows)</font></div><p></p></pre></div><div>那么PostgreSQL的numeric精度有多大呢？</div><div><div><span style="line-height: 28px;"   >src/include/utils/numeric.h</span></div><div><pre class="prettyprint"   ><p></p><div><div><div><font size="2"   >/*-------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* numeric.h</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp;Definitions for the exact numeric data type of Postgres</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Original coding 1998, Jan Wieck. &nbsp;Heavily revised 2003, Tom Lane.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Copyright (c) 1998-2010, PostgreSQL Global Development Group</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* $PostgreSQL: pgsql/src/include/utils/numeric.h,v 1.29 2010/01/02 16:58:10 momjian Exp $</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;*-------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;*/</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* The Numeric data type stored in the database</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* NOTE: by convention, values in the packed form have been stripped of</font></div><div><font size="2"   >&nbsp;* all leading and trailing zero digits (where a "digit" is of base NBASE).</font></div><div><font size="2"   >&nbsp;* In particular, if the value is zero, there will be no digits at all!</font></div><div><font size="2"   >&nbsp;* The weight is arbitrary in that case, but we normally set it to zero.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >typedef struct NumericData</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vl_len_; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* varlena header (do not touch directly!) */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; uint16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n_sign_dscale; &nbsp;/* Sign + display scale */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n_weight; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Weight of 1st digit &nbsp;*/</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; char &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n_data[1]; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* Digits (really array of NumericDigit) */</font></div><div><font size="2"   >} NumericData;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >typedef NumericData *Numeric;</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* Hardcoded precision limit - arbitrary, but must be small enough that</font></div><div><font size="2"   >&nbsp;* dscale values will fit in 14 bits.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >#define NUMERIC_MAX_PRECISION &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000</font></div></div><p></p></pre></div></div><div><br></div><div>如果你要限制numeric的精度，那么最大允许1000的长度限制。</div><div>但是如果你不限制，允许多大的数字呢？</div><div>数字总长度不能超过uint16+uint16+2^14，即131072+16384，其中131072为整数部分，16384为小数点以及小数部分。</div><div><pre class="prettyprint"   ><font size="2"   >postgres=# select 2^16 + 2^16;<br> ?column? <br>----------<br>   131072<br>(1 row)<br><br>postgres=# select repeat('9',131073)::numeric;<br>ERROR:  22003: value overflows numeric format<br>LOCATION:  make_result, numeric.c:4202<br><br>postgres=# select repeat('9',131072)::numeric;<br>正常返回<br><br>postgres=# select (repeat('9',131072)||'.'||repeat('9',16384))::numeric;<br>ERROR:  22003: value overflows numeric format<br>LOCATION:  make_result, numeric.c:4202<br><br>postgres=# select (repeat('9',131072)||'.'||repeat('9',16383))::numeric;<br>正常返回</font></pre><div>参考，<span style="line-height: 28px;"   >src/backend/utils/adt/numeric.c</span></div></div><div><span style="line-height: 28px;"   >其实有两种格式，一种SHORT，一种LONG。</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* The Numeric type as stored on disk.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* If the high bits of the first word of a NumericChoice (n_header, or</font></div><div><font size="2"   >&nbsp;* n_short.n_header, or n_long.n_sign_dscale) are NUMERIC_SHORT, then the</font></div><div><font size="2"   >&nbsp;* numeric follows the NumericShort format; if they are NUMERIC_POS or</font></div><div><font size="2"   >&nbsp;* NUMERIC_NEG, it follows the NumericLong format. &nbsp;If they are NUMERIC_NAN,</font></div><div><font size="2"   >&nbsp;* it is a NaN. &nbsp;We currently always store a NaN using just two bytes (i.e.</font></div><div><font size="2"   >&nbsp;* only n_header), but previous releases used only the NumericLong format,</font></div><div><font size="2"   >&nbsp;* so we might find 4-byte NaNs on disk if a database has been migrated using</font></div><div><font size="2"   >&nbsp;* pg_upgrade. &nbsp;In either case, when the high bits indicate a NaN, the</font></div><div><font size="2"   >&nbsp;* remaining bits are never examined. &nbsp;Currently, we always initialize these</font></div><div><font size="2"   >&nbsp;* to zero, but it might be possible to use them for some other purpose in</font></div><div><font size="2"   >&nbsp;* the future.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* In the NumericShort format, the remaining 14 bits of the header word</font></div><div><font size="2"   >&nbsp;* (n_short.n_header) are allocated as follows: 1 for sign (positive or</font></div><div><font size="2"   >&nbsp;* negative), 6 for dynamic scale, and 7 for weight. &nbsp;In practice, most</font></div><div><font size="2"   >&nbsp;* commonly-encountered values can be represented this way.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* In the NumericLong format, the remaining 14 bits of the header word</font></div><div><font size="2"   >&nbsp;* (n_long.n_sign_dscale) represent the display scale; and the weight is</font></div><div><font size="2"   >&nbsp;* stored separately in n_weight.</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* NOTE: by convention, values in the packed form have been stripped of</font></div><div><font size="2"   >&nbsp;* all leading and trailing zero digits (where a "digit" is of base NBASE).</font></div><div><font size="2"   >&nbsp;* In particular, if the value is zero, there will be no digits at all!</font></div><div><font size="2"   >&nbsp;* The weight is arbitrary in that case, but we normally set it to zero.</font></div><div><font size="2"   >&nbsp;*/</font></div></div><div><div><font size="2"   >struct NumericShort</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; uint16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n_header; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Sign + display scale + weight */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NumericDigit n_data[1]; &nbsp; &nbsp; &nbsp; &nbsp; /* Digits */</font></div><div><font size="2"   >};</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >struct NumericLong</font></div><div><font size="2"   >{</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; uint16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n_sign_dscale; &nbsp;/* Sign + display scale */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n_weight; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Weight of 1st digit &nbsp;*/</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NumericDigit n_data[1]; &nbsp; &nbsp; &nbsp; &nbsp; /* Digits */</font></div><div><font size="2"   >};</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >union NumericChoice</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; uint16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n_header; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Header word */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; struct NumericLong n_long; &nbsp; &nbsp; &nbsp;/* Long form (4-byte header) */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; struct NumericShort n_short; &nbsp; &nbsp;/* Short form (2-byte header) */</font></div><div><font size="2"   >};</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >struct NumericData</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vl_len_; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* varlena header (do not touch directly!) */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; union NumericChoice choice; /* choice of format */</font></div><div><font size="2"   >};</font></div></div><p></p></pre></div><div><br></div><div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* make_result() -</font></div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;Create the packed db numeric format in palloc()'d memory from</font></div><div><font size="2"   >&nbsp;* &nbsp; &nbsp; &nbsp;a variable.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >static Numeric</font></div><div><font size="2"   >make_result(NumericVar *var)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Numeric &nbsp; &nbsp; &nbsp; &nbsp; result;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; NumericDigit *digits = var-&gt;digits;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; weight = var-&gt;weight;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = var-&gt;sign;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;len;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (sign == NUMERIC_NAN)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = (Numeric) palloc(NUMERIC_HDRSZ_SHORT);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET_VARSIZE(result, NUMERIC_HDRSZ_SHORT);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result-&gt;choice.n_header = NUMERIC_NAN;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* the header word is all we need */</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dump_numeric("make_result()", result);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return result;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; n = var-&gt;ndigits;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* truncate leading zeroes */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; while (n &gt; 0 &amp;&amp; *digits == 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digits++;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; weight--;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n--;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* truncate trailing zeroes */</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; while (n &gt; 0 &amp;&amp; digits[n - 1] == 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n--;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* If zero result, force to weight=0 and positive sign */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (n == 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; weight = 0;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = NUMERIC_POS;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* Build the result */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (NUMERIC_CAN_BE_SHORT(var-&gt;dscale, weight))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = NUMERIC_HDRSZ_SHORT + n * sizeof(NumericDigit);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = (Numeric) palloc(len);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET_VARSIZE(result, len);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result-&gt;choice.n_short.n_header =</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (sign == NUMERIC_NEG ? (NUMERIC_SHORT | NUMERIC_SHORT_SIGN_MASK)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: NUMERIC_SHORT)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | (var-&gt;dscale &lt;&lt; NUMERIC_SHORT_DSCALE_SHIFT)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | (weight &lt; 0 ? NUMERIC_SHORT_WEIGHT_SIGN_MASK : 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | (weight &amp; NUMERIC_SHORT_WEIGHT_MASK);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = NUMERIC_HDRSZ + n * sizeof(NumericDigit);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result = (Numeric) palloc(len);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET_VARSIZE(result, len);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result-&gt;choice.n_long.n_sign_dscale =</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign | (var-&gt;dscale &amp; NUMERIC_DSCALE_MASK);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; result-&gt;choice.n_long.n_weight = weight;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; memcpy(NUMERIC_DIGITS(result), digits, n * sizeof(NumericDigit));</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Assert(NUMERIC_NDIGITS(result) == n);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* Check for overflow of int16 fields */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (NUMERIC_WEIGHT(result) != weight ||</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NUMERIC_DSCALE(result) != var-&gt;dscale)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode(ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errmsg("value overflows numeric format")));</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; dump_numeric("make_result()", result);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return result;</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div></div><div><br></div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 12.1599998474121px; line-height: normal; background-color: rgb(224, 236, 239);"   ><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>numeric</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   >variable</td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   >user-specified precision, exact</td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   >no limit</td></tr></table></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://docs.oracle.com/database/121/SQLRF/sql_elements001.htm#SQLRF00213"   >http://docs.oracle.com/database/121/SQLRF/sql_elements001.htm#SQLRF00213</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.0/static/datatype-numeric.html"   >http://www.postgresql.org/docs/9.0/static/datatype-numeric.html</a></div><div>3.&nbsp;<span style="line-height: 28px;"   >src/include/utils/numeric.h<br></span><span style="line-height: 28px;"   >
</span><a style="line-height: 28px;" rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="Pay attention: Oracle INTEGER is NUMBER(p) not INT4 in PostgreSQL - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div></div>
	</div>
</div>
</body>
</html>