<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.5 new feature - pg_settings, pg_file_settings, alter system</h2>
	<h5 id="">2015-06-14 17:52:20&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201551453134609/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 9.5 针对参数配置的小改进，可以通过alter system设置参数，通过pg_ctl reload配置。</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres=# alter system set synchronous_commit=on;</font></div><div><font size="2"   >ALTER SYSTEM</font></div><div><font size="2"   >postgres=# show synchronous_commit;</font></div><div><font size="2"   >&nbsp;synchronous_commit&nbsp;</font></div><div><font size="2"   >--------------------</font></div><div><font size="2"   >&nbsp;off</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >pg95@db-172-16-3-150-&gt; pg_ctl reload</font></div><div><font size="2"   >server signaled</font></div><div><font size="2"   >pg95@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.5devel)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >postgres=# show synchronous_commit;</font></div><div><font size="2"   >&nbsp;synchronous_commit&nbsp;</font></div><div><font size="2"   >--------------------</font></div><div><font size="2"   >&nbsp;on</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><br></div><div>另外新增了pg_file_settings视图，用于查看通过参数文件配置的参数：</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select * from&nbsp;<span style="line-height: 28px;"   >pg_file_settings</span>;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sourcefile &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | sourceline | seqno | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;setting &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >-----------------------------------------------+------------+-------+----------------------------+--------------------</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 64 | &nbsp; &nbsp; 1 | max_connections &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 100</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 68 | &nbsp; &nbsp; 2 | unix_socket_directories &nbsp; &nbsp;| .</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 71 | &nbsp; &nbsp; 3 | unix_socket_permissions &nbsp; &nbsp;| 0700</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;102 | &nbsp; &nbsp; 4 | tcp_keepalives_idle &nbsp; &nbsp; &nbsp; &nbsp;| 60</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;104 | &nbsp; &nbsp; 5 | tcp_keepalives_interval &nbsp; &nbsp;| 10</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;106 | &nbsp; &nbsp; 6 | tcp_keepalives_count &nbsp; &nbsp; &nbsp; | 10</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;116 | &nbsp; &nbsp; 7 | shared_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 4096MB</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;131 | &nbsp; &nbsp; 8 | dynamic_shared_memory_type | posix</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;160 | &nbsp; &nbsp; 9 | bgwriter_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 10ms</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;179 | &nbsp; &nbsp;10 | synchronous_commit &nbsp; &nbsp; &nbsp; &nbsp; | off</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;189 | &nbsp; &nbsp;11 | wal_compression &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;192 | &nbsp; &nbsp;12 | wal_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 16MB</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;194 | &nbsp; &nbsp;13 | wal_writer_delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 10ms</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;202 | &nbsp; &nbsp;14 | max_wal_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8GB</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;234 | &nbsp; &nbsp;15 | track_commit_timestamp &nbsp; &nbsp; | off</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;322 | &nbsp; &nbsp;16 | log_destination &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| csvlog</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;328 | &nbsp; &nbsp;17 | logging_collector &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| on</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;340 | &nbsp; &nbsp;18 | log_truncate_on_rotation &nbsp; | on</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;446 | &nbsp; &nbsp;19 | log_timezone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | PRC</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;533 | &nbsp; &nbsp;20 | datestyle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| iso, mdy</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;535 | &nbsp; &nbsp;21 | timezone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | PRC</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;548 | &nbsp; &nbsp;22 | lc_messages &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| C</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;550 | &nbsp; &nbsp;23 | lc_monetary &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| C</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;551 | &nbsp; &nbsp;24 | lc_numeric &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | C</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;552 | &nbsp; &nbsp;25 | lc_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| C</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.conf &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;555 | &nbsp; &nbsp;26 | default_text_search_config | pg_catalog.english</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.auto.conf | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | &nbsp; &nbsp;27 | track_commit_timestamp &nbsp; &nbsp; | on</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.auto.conf | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 | &nbsp; &nbsp;28 | shared_buffers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | 8GB</font></div><div><font size="2"   >&nbsp;/data03/pgdata95/pg_root/postgresql.auto.conf | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 | &nbsp; &nbsp;29 | synchronous_commit &nbsp; &nbsp; &nbsp; &nbsp; | on</font></div><div><font size="2"   >(29 rows)</font></div><p></p></pre></div><div>同一个参数可能在多个文件中配置，所以seqno代表了顺序，以最后一个匹配的值为准。</div><div><br></div><div>另外pg_settings.<span style="line-height: 28px;"   >pending_restart</span><span style="line-height: 28px;"   >&nbsp;代表了某些参数被修改后，是否需要重启生效。</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# alter system set shared_buffers='8GB';</font></div><div><font size="2"   >ALTER SYSTEM</font></div><p></p></pre></div><div>注意通过任何方式修改或新增配置时，务必使用pg_ctl reload或者直接向postgres 主进程发SIGHUP信号，才会去读配置文件，否则是看不到pending_restart的变更的，也看不到<span style="line-height: 28px;"   >pg_file_settings的变更：</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres=# \q</font></div><div><font size="2"   >pg95@db-172-16-3-150-&gt; pg_ctl reload</font></div><div><font size="2"   >server signaled</font></div></div><div><div><font size="2"   >postgres=# select * from pg_settings where pending_restart;</font></div><div><font size="2"   >-[ RECORD 1 ]---+-------------------------------------------------------------</font></div><div><font size="2"   >name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| shared_buffers</font></div><div><font size="2"   >setting &nbsp; &nbsp; &nbsp; &nbsp; | 131072</font></div><div><font size="2"   >unit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 32kB</font></div><div><font size="2"   >category &nbsp; &nbsp; &nbsp; &nbsp;| Resource Usage / Memory</font></div><div><font size="2"   >short_desc &nbsp; &nbsp; &nbsp;| Sets the number of shared memory buffers used by the server.</font></div><div><font size="2"   >extra_desc &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >context &nbsp; &nbsp; &nbsp; &nbsp; | postmaster</font></div><div><font size="2"   >vartype &nbsp; &nbsp; &nbsp; &nbsp; | integer</font></div><div><font size="2"   >source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| configuration file</font></div><div><font size="2"   >min_val &nbsp; &nbsp; &nbsp; &nbsp; | 16</font></div><div><font size="2"   >max_val &nbsp; &nbsp; &nbsp; &nbsp; | 1073741823</font></div><div><font size="2"   >enumvals &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >boot_val &nbsp; &nbsp; &nbsp; &nbsp;| 1024</font></div><div><font size="2"   >reset_val &nbsp; &nbsp; &nbsp; | 131072</font></div><div><font size="2"   >sourcefile &nbsp; &nbsp; &nbsp;| /data03/pgdata95/pg_root/postgresql.conf</font></div><div><font size="2"   >sourceline &nbsp; &nbsp; &nbsp;| 116</font></div><div><font size="2"   >pending_restart | t</font></div></div><p></p></pre></div><div><span style="line-height: 28px;"   ><br></span></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/view-pg-file-settings.html"   >http://www.postgresql.org/docs/devel/static/view-pg-file-settings.html</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/view-pg-settings.html"   >http://www.postgresql.org/docs/devel/static/view-pg-settings.html</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/config-setting.html"   >http://www.postgresql.org/docs/devel/static/config-setting.html</a></div><div><br></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL 9.5 new feature - U - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>