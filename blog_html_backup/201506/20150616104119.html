<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.5 new feature - JSON,JSONB improve</h2>
	<h5 id="">2015-06-16 10:41:19&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402015516103221261/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 9.5 对json或jsonb的增强：</div><div><h4 style="font-size: 0.95em; margin: 1.2em 0em; font-weight: normal; color: rgb(102, 102, 102); font-family: verdana, sans-serif; line-height: normal;"   ><a id="AEN125786" name="AEN125786" rel="nofollow"   >E.1.3.6.1.</a>&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/datatype-json.html"   ><acronym>JSON</a></h4><ul style="font-size: 12.1599998474121px; line-height: 1.5em; margin-top: 0.2em; margin-bottom: 0.1em; font-family: verdana, sans-serif;"   ><li style="font-size: 1em; line-height: 1.5em; margin-top: 0.2em; margin-bottom: 0.1em;"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0.2em 0em 1.2em;"   >Add&nbsp;<tt>JSONB</tt>&nbsp;functions&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html#FUNCTIONS-JSON-PROCESSING-TABLE"   ><code>jsonb_set()</code></a>&nbsp;and&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html#FUNCTIONS-JSON-PROCESSING-TABLE"   ><code>jsonb_pretty</code></a>&nbsp;(Dmitry Dolgov, Andrew Dunstan, Petr Jelínek)</p></li><li style="font-size: 1em; line-height: 1.5em; margin-top: 0.2em; margin-bottom: 0.1em;"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0.2em 0em 1.2em;"   >Add several generator functions for&nbsp;<tt>JSONB</tt>&nbsp;that exist for&nbsp;<tt>JSON</tt>&nbsp;(Andrew Dunstan)</p><p style="font-size: 1em; line-height: 1.5em; margin: 0.2em 0em 1.2em;"   >The functions are&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html#FUNCTIONS-JSON-CREATION-TABLE"   ><code>to_jsonb()</code></a>,&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html#FUNCTIONS-JSON-CREATION-TABLE"   ><code>jsonb_object()</code></a>,&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html#FUNCTIONS-JSON-CREATION-TABLE"   ><code>jsonb_build_object()</code></a>,&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html#FUNCTIONS-JSON-CREATION-TABLE"   ><code>jsonb_build_array()</code></a>,&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-aggregate.html#FUNCTIONS-AGGREGATE-TABLE"   ><code>jsonb_agg()</code></a>, and&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-aggregate.html#FUNCTIONS-AGGREGATE-TABLE"   ><code>jsonb_object_agg()</code></a>.</p></li><li style="font-size: 1em; line-height: 1.5em; margin-top: 0.2em; margin-bottom: 0.1em;"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0.2em 0em 1.2em;"   >Reduce casting requirements to/from&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/datatype-json.html"   ><tt>JSON</tt></a>&nbsp;and&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/datatype-json.html"   ><tt>JSONB</tt></a>&nbsp;(Tom Lane)</p></li><li style="font-size: 1em; line-height: 1.5em; margin-top: 0.2em; margin-bottom: 0.1em;"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0.2em 0em 1.2em;"   >Allow&nbsp;<tt>TEXT</tt>,&nbsp;<tt>TEXT</tt>&nbsp;array, and&nbsp;<tt>INTEGER</tt>&nbsp;values to be&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html#FUNCTIONS-JSONB-OP-TABLE"   >subtracted</a>&nbsp;from&nbsp;<tt>JSONB</tt>&nbsp;documents (Dmitry Dolgov, Andrew Dunstan)</p></li><li style="font-size: 1em; line-height: 1.5em; margin-top: 0.2em; margin-bottom: 0.1em;"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0.2em 0em 1.2em;"   >Add&nbsp;<tt>JSONB</tt>&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html#FUNCTIONS-JSONB-OP-TABLE"   >operator</a>&nbsp;<tt>||</tt>&nbsp;(Dmitry Dolgov, Andrew Dunstan)</p></li><li style="font-size: 1em; line-height: 1.5em; margin-top: 0.2em; margin-bottom: 0.1em;"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0.2em 0em 1.2em;"   >Add&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html#FUNCTIONS-JSON-PROCESSING-TABLE"   ><code>json_strip_nulls()</code></a>&nbsp;and&nbsp;<a style="color: rgb(0, 78, 102);" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html#FUNCTIONS-JSON-PROCESSING-TABLE"   ><code>jsonb_strip_nulls()</code></a>&nbsp;functions to remove&nbsp;<tt>JSON</tt>&nbsp;null values from documents (Andrew Dunstan)</p></li></ul></div><div>测试：</div><div>jsonb_set用于新增会修改jsonb的元素值。</div><div>jsonb_pretty是输出标准化jsonb的值。</div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 12.1599998474121px; line-height: normal; background-color: rgb(224, 236, 239);"   ><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>jsonb_set(target jsonb, path text[], new_value jsonb[<span>,<tt style="font-size: 1em;"   >create_missing</tt>&nbsp;<tt style="font-size: 1em;"   >boolean</tt></span>])</tt></p></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>jsonb</tt></p></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   >Returns&nbsp;<tt style="font-style: italic;"   >target</tt>&nbsp;with the section designated by&nbsp;<tt style="font-style: italic;"   >path</tt>&nbsp;replaced by<tt style="font-style: italic;"   >new_value</tt>, or with&nbsp;<tt style="font-style: italic;"   >new_value</tt>&nbsp;added if&nbsp;<tt style="font-style: italic;"   >create_missing</tt>&nbsp;is true ( default is&nbsp;<tt>true</tt>) and the item designated by&nbsp;<tt style="font-style: italic;"   >path</tt>&nbsp;does not exist.</td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>jsonb_set('[{"f1":1,"f2":null},2,null,3]', '{0,f1}','[2,3,4]', false)</tt></p><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>jsonb_set('[{"f1":1,"f2":null},2]', '{0,f3}','[2,3,4]')</tt></p></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>[{"f1":[2,3,4],"f2":null},2,null,3]</tt></p><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>[{"f1": 1, "f2": null, "f3": [2, 3, 4]}, 2]</tt></p></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>jsonb_pretty(from_json jsonb)</tt></p></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>text</tt></p></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   >Returns&nbsp;<tt style="font-style: italic;"   >from_json</tt>&nbsp;as indented json text.</td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>jsonb_pretty('[{"f1":1,"f2":null},2,null,3]')</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><pre style="font-size: 1em; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border: 1px solid rgb(207, 207, 207); padding: 2ex; margin-top: 2ex; margin-bottom: 2ex; margin-left: 2ex; overflow: auto; border-radius: 8px; background-color: rgb(247, 247, 247);"   >                    
 [
     {
         "f1": 1,
         "f2": null
     },
     2,
     null,
     3
 ]</pre></td></tr></table></div><div><br></div><div>从jsonb中删除元素，使用数字下标(针对数组型JSONB)，或使用KEY(针对key/value)，或使用路径(针对数组型JSONB)。</div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 12.1599998474121px; line-height: normal; background-color: rgb(224, 236, 239);"   ><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>-</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>text</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   >Delete key/value pair or&nbsp;<span style="font-weight: bold;"   >string</span>&nbsp;element from left operand. Key/value pairs are matched based on their key value.</td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>'{"a": "b"}'::jsonb - 'a'</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>-</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>integer</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   >Delete the array element with specified index (Negative integers count from the end). Throws an error if top level container is not an array.</td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>'["a", "b"]'::jsonb - 1</tt></td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>#-</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>text[]</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   >Delete the field or element with specified path</td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>'["a", {"b":1}]'::jsonb #- '{1,b}'</tt></td></tr></table></div><div><br></div><div>允许连接两个jsonb</div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 12.1599998474121px; line-height: normal; background-color: rgb(224, 236, 239);"   ><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>||</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>jsonb</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   >Concatentate two jsonb values into a new jsonb value</td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>'["a", "b"]'::jsonb || '["c", "d"]'::jsonb</tt></td></tr></table></div><div><br></div><div>允许从json或jsonb中删除空值</div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 12.1599998474121px; line-height: normal; background-color: rgb(224, 236, 239);"   ><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>json_strip_nulls(from_json json)</tt></p><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>jsonb_strip_nulls(from_json jsonb)</tt></p></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>json</tt></p><p style="font-size: 1em; line-height: 1.5em; margin: 0em 0em 1.2em;"   ><tt>jsonb</tt></p></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   >Returns&nbsp;<tt style="font-style: italic;"   >from_json</tt>&nbsp;with all object fields that have null values omitted. Other null values are untouched.</td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>json_strip_nulls('[{"f1":1,"f2":null},2,null,3]')</tt></td><td style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex; background-color: rgb(255, 255, 255);"   ><tt>[{"f1":1},2,null,3]</tt></td></tr></table></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/functions-json.html"   >http://www.postgresql.org/docs/devel/static/functions-json.html</a></div><div><br></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL 9.5 new feature - JSON,JSONB improve - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>