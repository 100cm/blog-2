<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL Logarithm function</h2>
	<h5 id="">2013-03-05 13:14:07&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013251557542/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 的两个函数: 自然对数, 10为底的对数.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List of functions</font></div><div><font size="2"   >&nbsp; &nbsp;Schema &nbsp; | &nbsp;Name &nbsp;| Result data type | Argument data types | &nbsp;Type &nbsp;</font></div><div><font size="2"   >------------+--------+------------------+---------------------+--------</font></div><div><font size="2"   >&nbsp;pg_catalog | dlog1 &nbsp;| double precision | double precision &nbsp; &nbsp;| normal</font></div><div><font size="2"   >&nbsp;pg_catalog | dlog10 | double precision | double precision &nbsp; &nbsp;| normal</font></div><div><font size="2"   >(2 rows)</font></div><p></p></pre></div><div>2为底的对数可以使用如下计算方法 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >dlog1(x)/dlog1(2)</font></div><div><font size="2"   >或者</font></div><div><font size="2"   >dlog10(x)/dlog10(2)</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >n为底的对数可以使用如下计算方法 :&nbsp;</span></div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >dlog1(x)/dlog1(n)</font></div><div style="line-height: 22px;"   ><font size="2"   >或者</font></div><div style="line-height: 22px;"   ><font size="2"   >dlog10(x)/dlog10(n)</font></div><p></p></pre></div></div><div style="line-height: 22px;"   ><br></div><div style="line-height: 22px;"   >例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select dlog1(1)/dlog1(2);</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 1.760 ms</font></div><div><font size="2"   >digoal=# select dlog1(2)/dlog1(2);</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 1</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 1.918 ms</font></div><div><font size="2"   >digoal=# select dlog1(4)/dlog1(2);</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 2</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 1.925 ms</font></div><div><font size="2"   >digoal=# select dlog1(8)/dlog1(2);</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 3</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 2.032 ms</font></div><p></p></pre></div><div style="line-height: 22px;"   ><br></div><div style="line-height: 22px;"   >如果要经常使用, 分母可以用常数替代, 例如要经常计算2为底的对数.&nbsp;<span style="line-height: 22px;"   >这么写就可以了 :&nbsp;</span></div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p><font size="2"   >dlog1(x)/0.693147180559945</font></p></pre></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   >要经常计算3为底的对数.&nbsp;<span style="line-height: 22px;"   >这么写就可以了 :&nbsp;</span></div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><span style="line-height: 22px;"   ><font size="2"   >dlog1(9)/1.09861228866811</font></span></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   ><font size="2"   >-- 例如 :&nbsp;</font></span></div></div><div><div><font size="2"   >digoal=# select dlog1(3);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; dlog1 &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------</font></div><div><font size="2"   >&nbsp;1.09861228866811</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 1.932 ms</font></div><div><font size="2"   >digoal=# select dlog1(9)/dlog1(3);</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 2</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 2.151 ms</font></div><div><font size="2"   >digoal=# select dlog1(9)/1.09861228866811;</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 2</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 1.996 ms</font></div></div><p></p></pre></div></div><div style="line-height: 22px;"   >【其他】</div><div style="line-height: 22px;"   >1. 其他的很多数学函数都可以在float.c中查到.</div><div style="line-height: 22px;"   >大部分来自&lt;math.h&gt;库.</div><div style="line-height: 22px;"   ><br></div>【参考】<div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://en.wikipedia.org/wiki/Log_(mathematics)"   >http://en.wikipedia.org/wiki/Log_(mathematics)</a></div><div>2.&nbsp;src/backend/utils/adt/float.c<div><pre class="prettyprint"   ><div><font size="2"   >01460 /*</font></div><div><font size="2"   >01461 &nbsp;* &nbsp; &nbsp; &nbsp;dlog1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - returns the natural logarithm of arg1</font></div><div><font size="2"   >01462 &nbsp;*/</font></div><div><font size="2"   >01463 Datum</font></div><div><font size="2"   >01464 dlog1(PG_FUNCTION_ARGS)</font></div><div><font size="2"   >01465 {</font></div><div><font size="2"   >01466 &nbsp; &nbsp; float8 &nbsp; &nbsp; &nbsp;arg1 = PG_GETARG_FLOAT8(0);</font></div><div><font size="2"   >01467 &nbsp; &nbsp; float8 &nbsp; &nbsp; &nbsp;result;</font></div><div><font size="2"   >01468&nbsp;</font></div><div><font size="2"   >01469 &nbsp; &nbsp; /*</font></div><div><font size="2"   >01470 &nbsp; &nbsp; &nbsp;* Emit particular SQLSTATE error codes for ln(). This is required by the</font></div><div><font size="2"   >01471 &nbsp; &nbsp; &nbsp;* SQL standard.</font></div><div><font size="2"   >01472 &nbsp; &nbsp; &nbsp;*/</font></div><div><font size="2"   >01473 &nbsp; &nbsp; if (arg1 == 0.0)</font></div><div><font size="2"   >01474 &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,</font></div><div><font size="2"   >01475 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode(ERRCODE_INVALID_ARGUMENT_FOR_LOG),</font></div><div><font size="2"   >01476 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errmsg("cannot take logarithm of zero")));</font></div><div><font size="2"   >01477 &nbsp; &nbsp; if (arg1 &lt; 0)</font></div><div><font size="2"   >01478 &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,</font></div><div><font size="2"   >01479 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode(ERRCODE_INVALID_ARGUMENT_FOR_LOG),</font></div><div><font size="2"   >01480 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errmsg("cannot take logarithm of a negative number")));</font></div><div><font size="2"   >01481&nbsp;</font></div><div><font size="2"   >01482 &nbsp; &nbsp; result = log(arg1);</font></div><div><font size="2"   >01483&nbsp;</font></div><div><font size="2"   >01484 &nbsp; &nbsp; CHECKFLOATVAL(result, isinf(arg1), arg1 == 1);</font></div><div><font size="2"   >01485 &nbsp; &nbsp; PG_RETURN_FLOAT8(result);</font></div><div><font size="2"   >01486 }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >01489 /*</font></div><div><font size="2"   >01490 &nbsp;* &nbsp; &nbsp; &nbsp;dlog10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- returns the base 10 logarithm of arg1</font></div><div><font size="2"   >01491 &nbsp;*/</font></div><div><font size="2"   >01492 Datum</font></div><div><font size="2"   >01493 dlog10(PG_FUNCTION_ARGS)</font></div><div><font size="2"   >01494 {</font></div><div><font size="2"   >01495 &nbsp; &nbsp; float8 &nbsp; &nbsp; &nbsp;arg1 = PG_GETARG_FLOAT8(0);</font></div><div><font size="2"   >01496 &nbsp; &nbsp; float8 &nbsp; &nbsp; &nbsp;result;</font></div><div><font size="2"   >01497&nbsp;</font></div><div><font size="2"   >01498 &nbsp; &nbsp; /*</font></div><div><font size="2"   >01499 &nbsp; &nbsp; &nbsp;* Emit particular SQLSTATE error codes for log(). The SQL spec doesn't</font></div><div><font size="2"   >01500 &nbsp; &nbsp; &nbsp;* define log(), but it does define ln(), so it makes sense to emit the</font></div><div><font size="2"   >01501 &nbsp; &nbsp; &nbsp;* same error code for an analogous error condition.</font></div><div><font size="2"   >01502 &nbsp; &nbsp; &nbsp;*/</font></div><div><font size="2"   >01503 &nbsp; &nbsp; if (arg1 == 0.0)</font></div><div><font size="2"   >01504 &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,</font></div><div><font size="2"   >01505 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode(ERRCODE_INVALID_ARGUMENT_FOR_LOG),</font></div><div><font size="2"   >01506 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errmsg("cannot take logarithm of zero")));</font></div><div><font size="2"   >01507 &nbsp; &nbsp; if (arg1 &lt; 0)</font></div><div><font size="2"   >01508 &nbsp; &nbsp; &nbsp; &nbsp; ereport(ERROR,</font></div><div><font size="2"   >01509 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (errcode(ERRCODE_INVALID_ARGUMENT_FOR_LOG),</font></div><div><font size="2"   >01510 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errmsg("cannot take logarithm of a negative number")));</font></div><div><font size="2"   >01511&nbsp;</font></div><div><font size="2"   >01512 &nbsp; &nbsp; result = log10(arg1);</font></div><div><font size="2"   >01513&nbsp;</font></div><div><font size="2"   >01514 &nbsp; &nbsp; CHECKFLOATVAL(result, isinf(arg1), arg1 == 1);</font></div><div><font size="2"   >01515 &nbsp; &nbsp; PG_RETURN_FLOAT8(result);</font></div><div><font size="2"   >01516 }</font></div><p></p></pre></div>3. man log<wbr></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >EXP(3) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Linux Programmer’s Manual &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EXP(3)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >NAME</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;log, logf, logl - natural logarithmic function</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SYNOPSIS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;#include &lt;math.h&gt;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;double log(double x);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;float logf(float x);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;long double logl(long double x);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Link with -lm.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >DESCRIPTION</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The log() function returns the natural logarithm of x.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >ERRORS</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;The log() function can return the following errors:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;EDOM &nbsp; The argument x is negative.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;ERANGE The argument x is zero. &nbsp;The log of zero is not defined (minus infinity).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >CONFORMING TO</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;SVr4, 4.3BSD, C89. &nbsp;The float and long double variants are C99 requirements.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >SEE ALSO</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;cbrt(3), clog(3), log1p(3), sqrt(3)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2002-07-27 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EXP(3)</font></div><p></p></pre></div></div>
	</div>
</div>
</body>
</html>