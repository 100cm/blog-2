<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.3 Writeable Foreign Table with postgres_fdw extension</h2>
	<h5 id="">2013-03-14 11:33:45&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013214103144414/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 9.3 新增了postgres_fdw模块, 前段时间写了一篇BLOG详细的介绍和测试这个extension, 如下 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201312544919858/"   >http://blog.163.com/digoal@126/blog/static/163877040201312544919858/</a></div><div>前几天postgres_fdw新增了外部表可写的功能.&nbsp;</div><div>本文将拿上一篇文章中用到的例子, 对外部表的写做一下测试, 测试环境请到上一篇文章中找.</div><div>-- 测试插入</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=&gt; \d ft2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Foreign table "digoal.ft2"</font></div><div><font size="2"   >&nbsp;Column | &nbsp;Type &nbsp; | Modifiers | FDW Options&nbsp;</font></div><div><font size="2"   >--------+---------+-----------+-------------</font></div><div><font size="2"   >&nbsp;c2 &nbsp; &nbsp; | text &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >&nbsp;c1 &nbsp; &nbsp; | integer | not null &nbsp;|&nbsp;</font></div><div><font size="2"   >Server: s1</font></div><div><font size="2"   >FDW Options: (schema_name 'digoal', table_name 'test2')</font></div></div><div><div><font size="2"   >digoal=&gt; insert into ft2 values ('abc',100);</font></div><div><font size="2"   >ERROR: &nbsp;duplicate key value violates unique constraint "t2_pkey"</font></div><div><font size="2"   >DETAIL: &nbsp;Key (c1)=(100) already exists.</font></div><div><font size="2"   >CONTEXT: &nbsp;Remote SQL command: INSERT INTO digoal.test2(c2, c1) VALUES ($1, $2)</font></div><div><font size="2"   >digoal=&gt; insert into ft2 values ('abc',100000);</font></div><div><font size="2"   >INSERT 0 1</font></div></div><div><div><font size="2"   >digoal=&gt; select * from ft2 where c1=100000;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| &nbsp; c1 &nbsp;&nbsp;</font></div><div><font size="2"   >-----+--------</font></div><div><font size="2"   >&nbsp;abc | 100000</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >digoal=&gt; insert into ft2 select 'digoal',generate_series(10000,10010);</font></div><div><font size="2"   >INSERT 0 11</font></div></div><p></p></pre></div><div><br></div><div>-- 执行计划</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; explain verbose insert into ft2 values ('abc',100000);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >----------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Insert on digoal.ft2 &nbsp;(cost=0.00..0.01 rows=1 width=0)</font></div><div><font size="2"   >&nbsp; &nbsp;Remote SQL: INSERT INTO digoal.test2(c2, c1) VALUES ($1, $2)</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Result &nbsp;(cost=0.00..0.01 rows=1 width=0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: 'abc'::text, 100000</font></div><div><font size="2"   >(4 rows)</font></div><p></p></pre></div><div><br></div><div>-- 更新</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; update ft2 set c2='new' where c1=1;</font></div><div><font size="2"   >UPDATE 1</font></div><div><font size="2"   >digoal=&gt; select * from ft2 where c1=1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| c1&nbsp;</font></div><div><font size="2"   >-----+----</font></div><div><font size="2"   >&nbsp;new | &nbsp;1</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; explain verbose update ft2 set c2='new' where c1=1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >-----------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Update on digoal.ft2 &nbsp;(cost=100.00..140.35 rows=12 width=10)</font></div><div><font size="2"   >&nbsp; &nbsp;Remote SQL: UPDATE digoal.test2 SET c2 = $2 WHERE ctid = $1</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Foreign Scan on digoal.ft2 &nbsp;(cost=100.00..140.35 rows=12 width=10)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: 'new'::text, c1, ctid</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote SQL: SELECT NULL, c1, ctid FROM digoal.test2 WHERE ((c1 = 1)) FOR UPDATE</font></div><div><font size="2"   >(5 rows)</font></div><p></p></pre></div><div>-- 注意更新时, 先是for update. 取出ctid. 再使用ctid作为唯一条件进行更新.</div><div><br></div><div>-- 删除</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; explain verbose delete from ft2 where c1=1;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >-------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Delete on digoal.ft2 &nbsp;(cost=100.00..144.40 rows=14 width=6)</font></div><div><font size="2"   >&nbsp; &nbsp;Remote SQL: DELETE FROM digoal.test2 WHERE ctid = $1</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Foreign Scan on digoal.ft2 &nbsp;(cost=100.00..144.40 rows=14 width=6)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: ctid</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote SQL: SELECT NULL, NULL, ctid FROM digoal.test2 WHERE ((c1 = 1)) FOR UPDATE</font></div><div><font size="2"   >(5 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=&gt; delete from ft2 where c1=1;</font></div><div><font size="2"   >DELETE 1</font></div><div><font size="2"   >digoal=&gt; select * from ft2 where c1=1;</font></div><div><font size="2"   >&nbsp;c2 | c1&nbsp;</font></div><div><font size="2"   >----+----</font></div><div><font size="2"   >(0 rows)</font></div><p></p></pre></div><div>-- 删除与更新类似, 使用了for update. 以及使用ctid定位行.&nbsp;</div><div><br></div><div>-- 测试savepoint;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=&gt; begin;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >digoal=&gt; delete from ft2 where c1=2;</font></div><div><font size="2"   >DELETE 1</font></div><div><font size="2"   >digoal=&gt; savepoint s1;</font></div><div><font size="2"   >SAVEPOINT</font></div><div><font size="2"   >digoal=&gt; delete from ft2 where c1=3;</font></div><div><font size="2"   >DELETE 1</font></div><div><font size="2"   >digoal=&gt; savepoint s2;</font></div><div><font size="2"   >SAVEPOINT</font></div><div><font size="2"   >digoal=&gt; insert into ft2 select 'digoal',generate_series(10000,10010);</font></div><div><font size="2"   >ERROR: &nbsp;duplicate key value violates unique constraint "t2_pkey"</font></div><div><font size="2"   >DETAIL: &nbsp;Key (c1)=(10000) already exists.</font></div><div><font size="2"   >CONTEXT: &nbsp;Remote SQL command: INSERT INTO digoal.test2(c2, c1) VALUES ($1, $2)</font></div><div><font size="2"   >digoal=&gt; delete from ft2 where c1=4;</font></div><div><font size="2"   >ERROR: &nbsp;current transaction is aborted, commands ignored until end of transaction block</font></div><div><font size="2"   >digoal=&gt; rollback to savepoint s2;</font></div><div><font size="2"   >ROLLBACK</font></div><div><font size="2"   >digoal=&gt; end;</font></div><div><font size="2"   >COMMIT</font></div><p></p></pre></div><div><br></div>【参考】<div>1.&nbsp;<a target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=21734d2fb896e0ecdddd3251caa72a3576e2d415"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=21734d2fb896e0ecdddd3251caa72a3576e2d415</a></div><div>2.&nbsp;<a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201312544919858/"   >http://blog.163.com/digoal@126/blog/static/163877040201312544919858/</a></div><div>3. 自测输出</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >-- test writable foreign table stuff</font></div><div><font size="2"   >-- ===================================================================</font></div><div><font size="2"   >EXPLAIN (verbose, costs off)</font></div><div><font size="2"   >INSERT INTO ft2 (c1,c2,c3) SELECT c1+1000,c2+100, c3 || c3 FROM ft2 LIMIT 20;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Insert on public.ft2</font></div><div><font size="2"   >&nbsp; &nbsp;Remote SQL: INSERT INTO "S 1"."T 1"("C 1", c2, c3, c4, c5, c6, c7, c8) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Subquery Scan on "*SELECT*"</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: "*SELECT*"."?column?", "*SELECT*"."?column?_1", NULL::integer, "*SELECT*"."?column?_2", NULL::timestamp with time zone, NULL::timestamp without time zone, NULL::character varying, 'ft2 &nbsp; &nbsp; &nbsp; '::character(10), NULL::user_enum</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Limit</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: ((ft2_1.c1 + 1000)), ((ft2_1.c2 + 100)), ((ft2_1.c3 || ft2_1.c3))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Foreign Scan on public.ft2 ft2_1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: (ft2_1.c1 + 1000), (ft2_1.c2 + 100), (ft2_1.c3 || ft2_1.c3)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote SQL: SELECT "C 1", c2, c3, NULL, NULL, NULL, NULL, NULL FROM "S 1"."T 1"</font></div><div><font size="2"   >(9 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >INSERT INTO ft2 (c1,c2,c3) SELECT c1+1000,c2+100, c3 || c3 FROM ft2 LIMIT 20;</font></div><div><font size="2"   >INSERT INTO ft2 (c1,c2,c3)</font></div><div><font size="2"   >&nbsp; VALUES (1101,201,'aaa'), (1102,202,'bbb'), (1103,203,'ccc') RETURNING *;</font></div><div><font size="2"   >&nbsp; c1 &nbsp;| c2 &nbsp;| c3 &nbsp;| c4 | c5 | c6 | &nbsp; &nbsp; c7 &nbsp; &nbsp; | c8&nbsp;</font></div><div><font size="2"   >------+-----+-----+----+----+----+------------+----</font></div><div><font size="2"   >&nbsp;1101 | 201 | aaa | &nbsp; &nbsp;| &nbsp; &nbsp;| &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;1102 | 202 | bbb | &nbsp; &nbsp;| &nbsp; &nbsp;| &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;1103 | 203 | ccc | &nbsp; &nbsp;| &nbsp; &nbsp;| &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >(3 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >INSERT INTO ft2 (c1,c2,c3) VALUES (1104,204,'ddd'), (1105,205,'eee');</font></div><div><font size="2"   >UPDATE ft2 SET c2 = c2 + 300, c3 = c3 || '_update3' WHERE c1 % 10 = 3;</font></div><div><font size="2"   >UPDATE ft2 SET c2 = c2 + 400, c3 = c3 || '_update7' WHERE c1 % 10 = 7 RETURNING *;</font></div><div><font size="2"   >&nbsp; c1 &nbsp;| c2 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; c3 &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| c6 | &nbsp; &nbsp; c7 &nbsp; &nbsp; | c8 &nbsp;</font></div><div><font size="2"   >------+-----+--------------------+------------------------------+--------------------------+----+------------+-----</font></div><div><font size="2"   >&nbsp; &nbsp; 7 | 407 | 00007_update7 &nbsp; &nbsp; &nbsp;| Thu Jan 08 00:00:00 1970 PST | Thu Jan 08 00:00:00 1970 | 7 &nbsp;| 7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| foo</font></div><div><font size="2"   >&nbsp; &nbsp;17 | 407 | 00017_update7 &nbsp; &nbsp; &nbsp;| Sun Jan 18 00:00:00 1970 PST | Sun Jan 18 00:00:00 1970 | 7 &nbsp;| 7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| foo</font></div><div><font size="2"   >&nbsp; &nbsp;27 | 407 | 00027_update7 &nbsp; &nbsp; &nbsp;| Wed Jan 28 00:00:00 1970 PST | Wed Jan 28 00:00:00 1970 | 7 &nbsp;| 7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| foo</font></div><div><font size="2"   >...略</font></div><div><div><font size="2"   >&nbsp;1007 | 507 | 0000700007_update7 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;1017 | 507 | 0001700017_update7 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >(102 rows)</font></div></div><div><div><font size="2"   >EXPLAIN (verbose, costs off)</font></div><div><font size="2"   >UPDATE ft2 SET c2 = ft2.c2 + 500, c3 = ft2.c3 || '_update9', c7 = DEFAULT</font></div><div><font size="2"   >&nbsp; FROM ft1 WHERE ft1.c1 = ft2.c2 AND ft1.c1 % 10 = 9;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >-------------------------------------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Update on public.ft2</font></div><div><font size="2"   >&nbsp; &nbsp;Remote SQL: UPDATE "S 1"."T 1" SET c2 = $2, c3 = $3, c7 = $4 WHERE ctid = $1</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Hash Join</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: ft2.c1, (ft2.c2 + 500), NULL::integer, (ft2.c3 || '_update9'::text), ft2.c4, ft2.c5, ft2.c6, 'ft2 &nbsp; &nbsp; &nbsp; '::character(10), ft2.c8, ft2.ctid, ft1.*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hash Cond: (ft2.c2 = ft1.c1)</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Foreign Scan on public.ft2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: ft2.c1, ft2.c2, ft2.c3, ft2.c4, ft2.c5, ft2.c6, ft2.c8, ft2.ctid</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote SQL: SELECT "C 1", c2, c3, c4, c5, c6, NULL, c8, ctid FROM "S 1"."T 1" FOR UPDATE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Hash</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: ft1.*, ft1.c1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Foreign Scan on public.ft1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: ft1.*, ft1.c1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote SQL: SELECT "C 1", c2, c3, c4, c5, c6, c7, c8 FROM "S 1"."T 1" WHERE ((("C 1" % 10) = 9))</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >UPDATE ft2 SET c2 = ft2.c2 + 500, c3 = ft2.c3 || '_update9', c7 = DEFAULT</font></div><div><font size="2"   >&nbsp; FROM ft1 WHERE ft1.c1 = ft2.c2 AND ft1.c1 % 10 = 9;</font></div><div><font size="2"   >DELETE FROM ft2 WHERE c1 % 10 = 5 RETURNING *;</font></div><div><font size="2"   >&nbsp; c1 &nbsp;| c2 &nbsp;| &nbsp; &nbsp; c3 &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| c6 | &nbsp; &nbsp; c7 &nbsp; &nbsp; | c8 &nbsp;</font></div><div><font size="2"   >------+-----+------------+------------------------------+--------------------------+----+------------+-----</font></div><div><font size="2"   >&nbsp; &nbsp; 5 | &nbsp; 5 | 00005 &nbsp; &nbsp; &nbsp;| Tue Jan 06 00:00:00 1970 PST | Tue Jan 06 00:00:00 1970 | 5 &nbsp;| 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| foo</font></div><div><font size="2"   >&nbsp; &nbsp;15 | &nbsp; 5 | 00015 &nbsp; &nbsp; &nbsp;| Fri Jan 16 00:00:00 1970 PST | Fri Jan 16 00:00:00 1970 | 5 &nbsp;| 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| foo</font></div><div><font size="2"   >&nbsp; &nbsp;25 | &nbsp; 5 | 00025 &nbsp; &nbsp; &nbsp;| Mon Jan 26 00:00:00 1970 PST | Mon Jan 26 00:00:00 1970 | 5 &nbsp;| 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| foo</font></div><div><font size="2"   >&nbsp; &nbsp;35 | &nbsp; 5 | 00035 &nbsp; &nbsp; &nbsp;| Thu Feb 05 00:00:00 1970 PST | Thu Feb 05 00:00:00 1970 | 5 &nbsp;| 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| foo</font></div><div><font size="2"   >&nbsp; &nbsp;45 | &nbsp; 5 | 00045 &nbsp; &nbsp; &nbsp;| Sun Feb 15 00:00:00 1970 PST | Sun Feb 15 00:00:00 1970 | 5 &nbsp;| 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| foo</font></div></div><div><font size="2"   >... 略</font></div><div><div><font size="2"   >&nbsp; 995 | &nbsp; 5 | 00995 &nbsp; &nbsp; &nbsp;| Mon Apr 06 00:00:00 1970 PST | Mon Apr 06 00:00:00 1970 | 5 &nbsp;| 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| foo</font></div><div><font size="2"   >&nbsp;1005 | 105 | 0000500005 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;1015 | 105 | 0001500015 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;1105 | 205 | eee &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >(103 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >EXPLAIN (verbose, costs off)</font></div><div><font size="2"   >DELETE FROM ft2 USING ft1 WHERE ft1.c1 = ft2.c2 AND ft1.c1 % 10 = 2;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Delete on public.ft2</font></div><div><font size="2"   >&nbsp; &nbsp;Remote SQL: DELETE FROM "S 1"."T 1" WHERE ctid = $1</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;Hash Join</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: ft2.ctid, ft1.*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hash Cond: (ft2.c2 = ft1.c1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Foreign Scan on public.ft2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: ft2.ctid, ft2.c2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote SQL: SELECT NULL, c2, NULL, NULL, NULL, NULL, NULL, NULL, ctid FROM "S 1"."T 1" FOR UPDATE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Hash</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: ft1.*, ft1.c1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Foreign Scan on public.ft1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: ft1.*, ft1.c1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Remote SQL: SELECT "C 1", c2, c3, c4, c5, c6, c7, c8 FROM "S 1"."T 1" WHERE ((("C 1" % 10) = 2))</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >DELETE FROM ft2 USING ft1 WHERE ft1.c1 = ft2.c2 AND ft1.c1 % 10 = 2;</font></div><div><font size="2"   >SELECT c1,c2,c3,c4 FROM ft2 ORDER BY c1;</font></div><div><font size="2"   >&nbsp; c1 &nbsp;| c2 &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; c3 &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------+-----+--------------------+------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp; 1 | &nbsp; 1 | 00001 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Fri Jan 02 00:00:00 1970 PST</font></div><div><font size="2"   >&nbsp; &nbsp; 3 | 303 | 00003_update3 &nbsp; &nbsp; &nbsp;| Sun Jan 04 00:00:00 1970 PST</font></div><div><font size="2"   >&nbsp; &nbsp; 4 | &nbsp; 4 | 00004 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Mon Jan 05 00:00:00 1970 PST</font></div><div><font size="2"   >&nbsp; &nbsp; 6 | &nbsp; 6 | 00006 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Wed Jan 07 00:00:00 1970 PST</font></div><div><font size="2"   >&nbsp; &nbsp; 7 | 407 | 00007_update7 &nbsp; &nbsp; &nbsp;| Thu Jan 08 00:00:00 1970 PST</font></div><div><font size="2"   >&nbsp; &nbsp; 8 | &nbsp; 8 | 00008 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Fri Jan 09 00:00:00 1970 PST</font></div><div><font size="2"   >&nbsp; &nbsp; 9 | 509 | 00009_update9 &nbsp; &nbsp; &nbsp;| Sat Jan 10 00:00:00 1970 PST</font></div><div><font size="2"   >&nbsp; &nbsp;10 | &nbsp; 0 | 00010 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Sun Jan 11 00:00:00 1970 PST</font></div><div><font size="2"   >&nbsp; &nbsp;11 | &nbsp; 1 | 00011 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Mon Jan 12 00:00:00 1970 PST</font></div></div><div><div><font size="2"   >&nbsp;1008 | 708 | 0000800008_trig_update &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;1018 | 708 | 0001800018_trig_update &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;1208 | 818 | fff_trig_update_trig_update | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp;| ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >&nbsp;1218 | 818 | ggg_trig_update_trig_update | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| (--; | ft2 &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp;</font></div><div><font size="2"   >(104 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >-- Test errors thrown on remote side during update</font></div><div><font size="2"   >ALTER TABLE "S 1"."T 1" ADD CONSTRAINT c2positive CHECK (c2 &gt;= 0);</font></div><div><div><font size="2"   >INSERT INTO ft1(c1, c2) VALUES(11, 12); &nbsp;-- duplicate key</font></div><div><font size="2"   >ERROR: &nbsp;duplicate key value violates unique constraint "t1_pkey"</font></div><div><font size="2"   >DETAIL: &nbsp;Key ("C 1")=(11) already exists.</font></div><div><font size="2"   >CONTEXT: &nbsp;Remote SQL command: INSERT INTO "S 1"."T 1"("C 1", c2, c3, c4, c5, c6, c7, c8) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)</font></div><div><font size="2"   >INSERT INTO ft1(c1, c2) VALUES(1111, -2); &nbsp;-- c2positive</font></div><div><font size="2"   >ERROR: &nbsp;new row for relation "T 1" violates check constraint "c2positive"</font></div><div><font size="2"   >DETAIL: &nbsp;Failing row contains (1111, -2, null, null, null, null, ft1 &nbsp; &nbsp; &nbsp; , null).</font></div><div><font size="2"   >CONTEXT: &nbsp;Remote SQL command: INSERT INTO "S 1"."T 1"("C 1", c2, c3, c4, c5, c6, c7, c8) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)</font></div><div><font size="2"   >UPDATE ft1 SET c2 = -c2 WHERE c1 = 1; &nbsp;-- c2positive</font></div><div><font size="2"   >ERROR: &nbsp;new row for relation "T 1" violates check constraint "c2positive"</font></div><div><font size="2"   >DETAIL: &nbsp;Failing row contains (1, -1, 00001_trig_update, 1970-01-02 08:00:00+00, 1970-01-02 00:00:00, 1, 1 &nbsp; &nbsp; &nbsp; &nbsp; , foo).</font></div><div><font size="2"   >CONTEXT: &nbsp;Remote SQL command: UPDATE "S 1"."T 1" SET c2 = $2 WHERE ctid = $1</font></div><div><font size="2"   >-- Test savepoint/rollback behavior</font></div><div><font size="2"   >select c2, count(*) from ft2 where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;0 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;4 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >select c2, count(*) from "S 1"."T 1" where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;0 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;4 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div></div></div><div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >begin;</font></div><div><font size="2"   >update ft2 set c2 = 42 where c2 = 0;</font></div><div><font size="2"   >select c2, count(*) from ft2 where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;4 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 42 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >savepoint s1;</font></div><div><font size="2"   >update ft2 set c2 = 44 where c2 = 4;</font></div><div><font size="2"   >select c2, count(*) from ft2 where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div></div><div><div><font size="2"   >&nbsp; 42 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 44 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >release savepoint s1;</font></div><div><font size="2"   >select c2, count(*) from ft2 where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 42 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 44 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >savepoint s2;</font></div><div><font size="2"   >update ft2 set c2 = 46 where c2 = 6;</font></div><div><font size="2"   >select c2, count(*) from ft2 where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div></div><div><div><font size="2"   >&nbsp; 42 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 44 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 46 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >rollback to savepoint s2;</font></div><div><font size="2"   >select c2, count(*) from ft2 where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 42 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 44 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >release savepoint s2;</font></div><div><font size="2"   >select c2, count(*) from ft2 where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div></div><div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 42 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 44 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >savepoint s3;</font></div><div><font size="2"   >update ft2 set c2 = -2 where c2 = 42 and c1 = 10; -- fail on remote side</font></div><div><font size="2"   >ERROR: &nbsp;new row for relation "T 1" violates check constraint "c2positive"</font></div><div><font size="2"   >DETAIL: &nbsp;Failing row contains (10, -2, 00010_trig_update_trig_update, 1970-01-11 08:00:00+00, 1970-01-11 00:00:00, 0, 0 &nbsp; &nbsp; &nbsp; &nbsp; , foo).</font></div><div><font size="2"   >CONTEXT: &nbsp;Remote SQL command: UPDATE "S 1"."T 1" SET c2 = $2 WHERE ctid = $1</font></div><div><font size="2"   >rollback to savepoint s3;</font></div><div><font size="2"   >select c2, count(*) from ft2 where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 42 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 44 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div></div><div><div><font size="2"   >release savepoint s3;</font></div><div><font size="2"   >select c2, count(*) from ft2 where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 42 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 44 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >-- none of the above is committed yet remotely</font></div><div><font size="2"   >select c2, count(*) from "S 1"."T 1" where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;0 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;4 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div></div><div><div><font size="2"   >commit;</font></div><div><font size="2"   >select c2, count(*) from ft2 where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 42 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 44 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >select c2, count(*) from "S 1"."T 1" where c2 &lt; 500 group by 1 order by 1;</font></div><div><font size="2"   >&nbsp;c2 &nbsp;| count&nbsp;</font></div><div><font size="2"   >-----+-------</font></div><div><font size="2"   >&nbsp; &nbsp;1 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; &nbsp;6 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 42 | &nbsp; 100</font></div><div><font size="2"   >&nbsp; 44 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;100 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;101 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;104 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;106 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;201 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;204 | &nbsp; &nbsp; 1</font></div><div><font size="2"   >&nbsp;303 | &nbsp; 100</font></div><div><font size="2"   >&nbsp;403 | &nbsp; &nbsp; 2</font></div><div><font size="2"   >&nbsp;407 | &nbsp; 100</font></div><div><font size="2"   >(13 rows)</font></div></div><p></p></pre></div><br><wbr></div></div>
	</div>
</div>
</body>
</html>