<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL FDW mongo_fdw usage</h2>
	<h5 id="">2013-03-19 22:19:43&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201321984940903/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><a target="_blank" rel="nofollow" href="https://wiki.postgresql.org/wiki/Foreign_data_wrappers"   >https://wiki.postgresql.org/wiki/Foreign_data_wrappers</a></div><div><br></div><div><span style="line-height: 22px;"   >mongo_fdw是</span><span style="line-height: 22px;"   >PostgreSQL众多FDW中的一个, 显而易见是连接mongoDB的.</span></div><div><span style="line-height: 22px;"   >最近在看CitusDB的时候, 文档中提到了mongo_fdw, 实际上在CitusDB中并没有发挥这个extension的distribute query特性.&nbsp;</span></div><div><span style="line-height: 22px;"   >用在PostgreSQL单节点的环境当然也是可以的.&nbsp;</span></div><wbr><div>下面介绍一下mongo_fdw在PostgreSQL数据库环境中的安装和用法.</div><div>1. 安装</div><div># 下载</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ><span style="line-height: 22px;"   >ocz@db-172-16-3-150-&gt;</span><span style="line-height: 22px;"   >&nbsp;</span>wget&nbsp;--no-check-certificate&nbsp;https://github.com/citusdata/mongo_fdw/archive/master.zip</font></div><div><font size="2"   ><span style="line-height: 22px;"   >ocz@db-172-16-3-150-&gt;</span><span style="line-height: 22px;"   >&nbsp;</span>unzip master</font></div><div><font size="2"   >ocz@db-172-16-3-150-&gt; mv mongo_fdw-master postgresql-9.2.1/contrib/</font></div><p></p></pre></div><div><br></div><div># 编译</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - root</font></div><div><div><font size="2"   >[root@db-172-16-3-150 ~]# . /home/ocz/.bash_profile&nbsp;</font></div><div><font size="2"   >root@db-172-16-3-150-&gt; which pg_config</font></div><div><font size="2"   >/home/ocz/pgsql9.2.1/bin/pg_config</font></div></div><div><font size="2"   >root@db-172-16-3-150-&gt; cd /home/ocz/postgresql-9.2.1/contrib/mongo_fdw-master/</font></div><div><font size="2"   >root@db-172-16-3-150-&gt; make clean</font></div><div><font size="2"   >root@db-172-16-3-150-&gt; make</font></div><div><font size="2"   >root@db-172-16-3-150-&gt; make install</font></div><p></p></pre></div><div><br></div><div>2. 创建extension</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@db-172-16-3-150-&gt; su - ocz</font></div><div><div><font size="2"   >ocz@db-172-16-3-150-&gt; psql</font></div><div><font size="2"   >psql (9.2.1)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >postgres=# \c digoal postgres</font></div></div><div><div><font size="2"   >digoal=# create extension mongo_fdw;</font></div><div><font size="2"   >CREATE EXTENSION</font></div></div><p></p></pre></div><div><br></div><div>3. 创建mongoDB测试环境</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-150 ~]#&nbsp;wget&nbsp;http://fastdl.mongodb.org/linux/mongodb-linux-x86_64-2.2.3.tgz</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# tar -zxvf mongodb-linux-x86_64-2.2.3.tgz</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# mv mongodb-linux-x86_64-2.2.3 /opt/</font></div><div><font size="2"   ><br></font></div><div><span style="line-height: 22px;"   ><font size="2"   >[root@db-172-16-3-150 ~]# useradd mongo</font></span></div><div><font size="2"   >[root@db-172-16-3-150 ~]# chown -R mongo:mongo /opt/mongodb-linux-x86_64-2.2.3</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >[root@db-172-16-3-150 ~]# su - mongo</font></div><div><font size="2"   >mongo@db-172-16-3-150-&gt; vi .bash_profile</font></div><div><font size="2"   >export MONGO_HOME=/opt/<span style="line-height: 22px;"   >mongodb-linux-x86_64-2.2.3</span></font></div><div><font size="2"   >export PATH=$MONGO_HOME/bin:$PATH:.</font></div><div><font size="2"   >umask 022</font></div><div><font size="2"   >alias rm='rm -i'</font></div><div><font size="2"   >alias ll='ls -lh'</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >su - root</font></div><div><div><font size="2"   >[root@db-172-16-3-150 data03]# mkdir -p /data03/mongodata</font></div><div><font size="2"   >[root@db-172-16-3-150 data03]# chown -R mongo:mongo /data03/mongodata</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >[root@db-172-16-3-150 data03]# vi /opt/mongodb-linux-x86_64-2.2.3/mongo11111.conf</font></div><div><div><font size="2"   >logpath = /data03/mongodata/mongod_5281.log</font></div><div><font size="2"   >logappend = true</font></div><div><font size="2"   >fork = true</font></div><div><font size="2"   >port = 11111</font></div><div><font size="2"   >noauth = true</font></div><div><font size="2"   >bind_ip = 0.0.0.0</font></div><div><font size="2"   >dbpath = /data03/mongodata/</font></div><div><font size="2"   >maxConns = 20000</font></div><div><font size="2"   >pidfilepath = /data03/mongodata/mongod_11111.pid</font></div><div><font size="2"   >nounixsocket = true</font></div><div><font size="2"   >directoryperdb = true</font></div><div><font size="2"   >journal = true</font></div><div><font size="2"   >journalCommitInterval = 40</font></div><div><font size="2"   >profile = 0</font></div><div><font size="2"   >nohttpinterface = true</font></div><div><font size="2"   >nssize = 2000</font></div><div><font size="2"   >oplogSize = 31280</font></div></div><div><font size="2"   >[root@db-172-16-3-150 mongodb-linux-x86_64-2.2.3]# chown mongo:mongo /opt/mongodb-linux-x86_64-2.2.3/mongo11111.conf</font></div><p></p></pre></div><div><br></div><div>4. 启动mongodb数据库</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - mongo</font></div><div><font size="2"   >mongo@db-172-16-3-150-&gt; mongod -f /opt/mongodb-linux-x86_64-2.2.3/mongo11111.conf</font></div><div><font size="2"   >mongo@db-172-16-3-150-&gt; mongo 127.0.0.1:11111/admin</font></div><div><div><font size="2"   >MongoDB shell version: 2.2.3</font></div><div><font size="2"   >connecting to: 127.0.0.1:11111/admin</font></div><div><font size="2"   >Welcome to the MongoDB shell.</font></div><div><font size="2"   >For interactive help, type "help".</font></div><div><font size="2"   >For more comprehensive documentation, see</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; http://docs.mongodb.org/</font></div><div><font size="2"   >Questions? Try the support group</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; http://groups.google.com/group/mongodb-user</font></div><div><font size="2"   >&gt; show dbsshow dbs</font></div><div><font size="2"   >local &nbsp; (empty)</font></div></div><p></p></pre></div><div><br></div><div><div style="line-height: 22px;"   >5. 创建外部表</div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >[root@db-172-16-3-150 ~]# su - ocz</font></div><div style="line-height: 22px;"   ><font size="2"   >ocz@db-172-16-3-150-&gt; psql digoal digoal</font></div><div style="line-height: 22px;"   ><font size="2"   >psql (9.2.1)</font></div><div style="line-height: 22px;"   ><font size="2"   >Type "help" for help.</font></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >digoal=&gt; \c digoal postgres</font></div><div style="line-height: 22px;"   ><font size="2"   >You are now connected to database "digoal" as user "postgres".</font></div><div style="line-height: 22px;"   ><font size="2"   >digoal=# \dx</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List of installed extensions</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp;Name &nbsp; &nbsp;| Version | &nbsp; Schema &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Description &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >-----------+---------+------------+--------------------------------------------------------------</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;dblink &nbsp; &nbsp;| 1.0 &nbsp; &nbsp; | public &nbsp; &nbsp; | connect to other PostgreSQL databases from within a database</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;hll &nbsp; &nbsp; &nbsp; | 1.0 &nbsp; &nbsp; | public &nbsp; &nbsp; | type for storing hyperloglog data</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;mongo_fdw | 1.0 &nbsp; &nbsp; | public &nbsp; &nbsp; | foreign data wrapper for MongoDB access</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;plcoffee &nbsp;| 1.3.0 &nbsp; | pg_catalog | PL/CoffeeScript (v8) trusted procedural language</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;plls &nbsp; &nbsp; &nbsp;| 1.3.0 &nbsp; | pg_catalog | PL/LiveScript (v8) trusted procedural language</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;plpgsql &nbsp; | 1.0 &nbsp; &nbsp; | pg_catalog | PL/pgSQL procedural language</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;plv8 &nbsp; &nbsp; &nbsp;| 1.3.0 &nbsp; | pg_catalog | PL/JavaScript (v8) trusted procedural language</font></div><div style="line-height: 22px;"   ><font size="2"   >(7 rows)</font></div></div></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >digoal=# CREATE SERVER mongo_server FOREIGN DATA WRAPPER mongo_fdw</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; OPTIONS (address '127.0.0.1', port '11111');</font></div></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >digoal=# CREATE FOREIGN TABLE customer_reviews</font></div><div style="line-height: 22px;"   ><font size="2"   >(</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; customer_id TEXT,</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; review_date TIMESTAMP,</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; review_rating INTEGER,</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; product_id CHAR(10),</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; product_title TEXT,</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; product_group TEXT,</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; product_category TEXT,</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; similar_product_ids CHAR(10)[]</font></div><div style="line-height: 22px;"   ><font size="2"   >)</font></div><div style="line-height: 22px;"   ><font size="2"   >SERVER mongo_server</font></div><div style="line-height: 22px;"   ><font size="2"   >OPTIONS (database 'test', collection 'customer_reviews');</font></div></div><p></p></pre></div></div><div style="line-height: 22px;"   ><br style="line-height: 22px;"   ></div><div style="line-height: 22px;"   >6. 查询外部表</div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >digoal=# select * from customer_reviews ;</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp;customer_id | review_date | review_rating | product_id | product_title | product_group | product_category | similar_product_ids&nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >-------------+-------------+---------------+------------+---------------+---------------+------------------+---------------------</font></div><div style="line-height: 22px;"   ><font size="2"   >(0 rows)</font></div></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >&gt; show dbsshow dbs</font></div><div style="line-height: 22px;"   ><font size="2"   >local &nbsp; (empty)</font></div><div style="line-height: 22px;"   ><font size="2"   >test &nbsp; &nbsp;(empty)</font></div></div><p></p></pre></div></div></div><div><br></div><div>7. 下载测试数据</div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 22px;"   ><font size="2"   >[root@db-172-16-3-150 ~]# wget http://examples.citusdata.com/customer_reviews_1998.json.gz</font></div><div style="line-height: 22px;"   ><font size="2"   >[root@db-172-16-3-150 ~]# wget http://examples.citusdata.com/customer_reviews_1999.json.gz</font></div></div><div><font size="2"   >[root@db-172-16-3-150 ~]# gunzip customer_reviews_1998.json.gz</font></div><p></p></pre></div></div><div><br></div><div>8. 导入测试数据</div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div><div style="line-height: 22px;"   ><font size="2"   >[root@db-172-16-3-150 ~]# . /home/mongo/.bash_profile&nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >root@db-172-16-3-150-&gt; which mongo</font></div><div style="line-height: 22px;"   ><font size="2"   >/opt/mongodb-linux-x86_64-2.2.3/bin/mongo</font></div><div style="line-height: 22px;"   ><font size="2"   >root@db-172-16-3-150-&gt; mongoimport --port 11111 --db test --collection customer_reviews --type json --file customer_reviews_1998.json</font></div><div style="line-height: 22px;"   ><font size="2"   >connected to: 127.0.0.1:11111</font></div></div><div><div><font size="2"   >root@db-172-16-3-150-&gt; mongo 127.0.0.1:11111/test</font></div><div><font size="2"   >MongoDB shell version: 2.2.3</font></div><div><font size="2"   >connecting to: 127.0.0.1:11111/test</font></div></div><div><div><font size="2"   >&gt; show collections</font></div><div><font size="2"   >customer_reviews</font></div><div><font size="2"   >system.indexes</font></div></div><div><font size="2"   >&gt;&nbsp;<span style="line-height: 22px;"   >db.customer_reviews.count()</span></font></div><div><font size="2"   >589859</font></div><p></p></pre></div></div><div><br></div><div>9. PostgreSQL 外部表查询</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# select * from customer_reviews limit 1;</font></div><div><font size="2"   >&nbsp; customer_id &nbsp;| &nbsp; &nbsp; review_date &nbsp; &nbsp; | review_rating | product_id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; product_title &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| product_group | &nbsp; p</font></div><div><font size="2"   >roduct_category &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; similar_product_ids &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >---------------+---------------------+---------------+------------+--------------------------------------------+---------------+----</font></div><div><font size="2"   >------------------+----------------------------------------------------------</font></div><div><font size="2"   >&nbsp;AE22YDHSBFYIP | 1970-12-30 00:00:00 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5 | 1551803542 | Start and Run a Coffee Bar (Start &amp; Run a) | Book &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Bus</font></div><div><font size="2"   >iness &amp; Investing | {0471136174,0910627312,047112138X,0786883561,0201570483}</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >digoal=# select count(*) from customer_reviews ;</font></div><div><font size="2"   >&nbsp;count &nbsp;</font></div><div><font size="2"   >--------</font></div><div><font size="2"   >&nbsp;589859</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >digoal=# SELECT</font></div><div><font size="2"   >&nbsp; &nbsp; round(avg(review_rating), 2),</font></div><div><font size="2"   >&nbsp; &nbsp; width_bucket(length(product_title), 1, 50, 5) as title_length,</font></div><div><font size="2"   >&nbsp; &nbsp; count(*)</font></div><div><font size="2"   >FROM</font></div><div><font size="2"   >&nbsp; &nbsp; customer_reviews</font></div><div><font size="2"   >WHERE</font></div><div><font size="2"   >&nbsp; &nbsp; product_group='Book' AND</font></div><div><font size="2"   >&nbsp; &nbsp; review_date &gt;= '1998-01-01' AND</font></div><div><font size="2"   >&nbsp; &nbsp; review_date &lt; date '1998-01-01' + interval '1 year'</font></div><div><font size="2"   >GROUP BY</font></div><div><font size="2"   >&nbsp; &nbsp; title_length</font></div><div><font size="2"   >ORDER BY</font></div><div><font size="2"   >&nbsp; &nbsp; title_length;</font></div><div><font size="2"   >&nbsp;round | title_length | count &nbsp;</font></div><div><font size="2"   >-------+--------------+--------</font></div><div><font size="2"   >&nbsp; 4.39 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp;40058</font></div><div><font size="2"   >&nbsp; 4.29 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 | 125688</font></div><div><font size="2"   >&nbsp; 4.41 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | &nbsp;76425</font></div><div><font size="2"   >&nbsp; 4.36 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 | &nbsp;51531</font></div><div><font size="2"   >&nbsp; 4.30 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 | &nbsp;34974</font></div><div><font size="2"   >&nbsp; 4.39 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6 | &nbsp;30349</font></div><div><font size="2"   >(6 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# explain analyze verbose SELECT</font></div><div><font size="2"   >&nbsp; &nbsp; round(avg(review_rating), 2),</font></div><div><font size="2"   >&nbsp; &nbsp; width_bucket(length(product_title), 1, 50, 5) as title_length,</font></div><div><font size="2"   >&nbsp; &nbsp; count(*)</font></div><div><font size="2"   >FROM</font></div><div><font size="2"   >&nbsp; &nbsp; customer_reviews</font></div><div><font size="2"   >WHERE</font></div><div><font size="2"   >&nbsp; &nbsp; product_group='Book' AND</font></div><div><font size="2"   >&nbsp; &nbsp; review_date &gt;= '1998-01-01' AND</font></div><div><font size="2"   >&nbsp; &nbsp; review_date &lt; date '1998-01-01' + interval '1 year'</font></div><div><font size="2"   >GROUP BY</font></div><div><font size="2"   >&nbsp; &nbsp; title_length</font></div><div><font size="2"   >ORDER BY</font></div><div><font size="2"   >&nbsp; &nbsp; title_length;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; QUERY PLAN &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >----------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;Sort &nbsp;(cost=21457.71..21457.71 rows=1 width=36) (actual time=3221.772..3221.772 rows=6 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp;Output: (round(avg(review_rating), 2)), (width_bucket((length(product_title))::double precision, 1::double precision, 50::double&nbsp;</font></div><div><font size="2"   >precision, 5)), (count(*))</font></div><div><font size="2"   >&nbsp; &nbsp;Sort Key: (width_bucket((length(customer_reviews.product_title))::double precision, 1::double precision, 50::double precision, 5)</font></div><div><font size="2"   >)</font></div><div><font size="2"   >&nbsp; &nbsp;Sort Method: quicksort &nbsp;Memory: 25kB</font></div><div><font size="2"   >&nbsp; &nbsp;-&gt; &nbsp;HashAggregate &nbsp;(cost=21457.68..21457.70 rows=1 width=36) (actual time=3221.746..3221.754 rows=6 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: round(avg(review_rating), 2), (width_bucket((length(product_title))::double precision, 1::double precision, 50::dou</font></div><div><font size="2"   >ble precision, 5)), count(*)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt; &nbsp;Foreign Scan on public.customer_reviews &nbsp;(cost=5.00..21457.56 rows=15 width=36) (actual time=225.305..3036.528 rows=359</font></div><div><font size="2"   >025 loops=1)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output: width_bucket((length(product_title))::double precision, 1::double precision, 50::double precision, 5), review</font></div><div><font size="2"   >_rating</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Filter: ((customer_reviews.review_date &gt;= '1998-01-01 00:00:00'::timestamp without time zone) AND (customer_reviews.r</font></div><div><font size="2"   >eview_date &lt; '1999-01-01 00:00:00'::timestamp without time zone) AND (customer_reviews.product_group = 'Book'::text))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Foreign Namespace: test.customer_reviews</font></div><div><font size="2"   >&nbsp;Total runtime: 3222.184 ms</font></div><div><font size="2"   >(11 rows)</font></div></div><p></p></pre></div><div><br></div><div>【参考<span style="line-height: 22px;"   >】</span></div><div><span style="line-height: 22px;"   >1.&nbsp;</span><a style="line-height: 22px;" target="_blank" rel="nofollow" href="https://github.com/citusdata/mongo_fdw"   >https://github.com/citusdata/mongo_fdw</a></div><div>2.&nbsp;<a style="line-height: 22px;" target="_blank" rel="nofollow" href="http://pgxn.org/dist/mongo_fdw"   >http://pgxn.org/dist/mongo_fdw</a></div>【其他FDW】<div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   >1. hive</div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"   ><a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" rel="nofollow" href="https://github.com/youngwookim/hive-fdw-for-postgresql"   >https://github.com/youngwookim/hive-fdw-for-postgresql</a></div><div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   >2. PostgreSQL Foreign Table - pgsql_fdw</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   ><a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201231514057303/"   >http://blog.163.com/digoal@126/blog/static/163877040201231514057303/</a></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   >3. PostgreSQL Foreign Table - oracle_fdw 1</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   ><a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201181505331588/"   >http://blog.163.com/digoal@126/blog/static/163877040201181505331588/</a></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   >4. PostgreSQL Foreign Table - oracle_fdw 2</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   ><a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020118151162340/"   >http://blog.163.com/digoal@126/blog/static/16387704020118151162340/</a></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   >5. PostgreSQL Foreign Table - oracle_fdw 3</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   ><a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020118951953408/"   >http://blog.163.com/digoal@126/blog/static/16387704020118951953408/</a></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   >6. PostgreSQL Foreign Table - file_fdw</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   ><a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201141641148311/"   >http://blog.163.com/digoal@126/blog/static/163877040201141641148311/</a></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   >7. PostgreSQL Foreign Table - redis_fdw</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   ><a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020119181188247/"   >http://blog.163.com/digoal@126/blog/static/16387704020119181188247/</a></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   >8. PostgreSQL Foreign Table - mysql_fdw 1</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   ><a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402011111233524987/"   >http://blog.163.com/digoal@126/blog/static/1638770402011111233524987/</a></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   >9. PostgreSQL Foreign Table - mysql_fdw 2</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   ><a style="line-height: 25px; text-decoration: none; color: rgb(85, 108, 136);" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020121108551698/"   >http://blog.163.com/digoal@126/blog/static/16387704020121108551698/</a></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 25px;"   >10.&nbsp;PostgreSQL file text array fdw used for unpredictable columns of text file</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201302410511382/"   >http://blog.163.com/digoal@126/blog/static/163877040201302410511382/</a></div></div></div></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">zyb200 - 2014-04-15 8:57:50</h5>
				<div>当mongodb的参数<span style=""  >auth = true时候，在postgresql中如何设置这个验证？</span><br><br></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 zyb200 - 2014-04-15 8:57:50</h5>
				<div style="width:600px;">HI, 目前mongo_fdw不支持mongodb密码验证, &nbsp;这个fdw是用<span style=" font-weight: bold;"  >mongo_connect这个接口去连mongo的.</span><div><div class="line"  id="LC405"  style=""  ><span class="n"  style=""  >你需要这个功能的话, 可以自己改一下这个fdw. mongo_cmd_authenticate好像是支持用户密码的.</span></div><div class="line"  id="LC405"  style=""  ><span class="n"  style=""  >MONGO_EXPORT</span> <span class="kt"  style=" font-weight: bold;"  >int</span> <span class="nf"  style=" font-weight: bold;"  >mongo_connect</span><span class="p"  style=""  >(</span> <span class="n"  style=""  >mongo</span> <span class="o"  style=" font-weight: bold;"  >*</span><span class="n"  style=""  >conn</span> <span class="p"  style=""  >,</span> <span class="k"  style=" font-weight: bold;"  >const</span> <span class="kt"  style=" font-weight: bold;"  >char</span> <span class="o"  style=" font-weight: bold;"  >*</span><span class="n"  style=""  >host</span><span class="p"  style=""  >,</span> <span class="kt"  style=" font-weight: bold;"  >int</span> <span class="n"  style=""  >port</span> <span class="p"  style=""  >)</span> <span class="p"  style=""  >{</span></div><div class="line"  id="LC406"  style=""  >&nbsp;&nbsp;&nbsp;&nbsp;<span class="n"  style=""  >mongo_init</span><span class="p"  style=""  >(</span> <span class="n"  style=""  >conn</span> <span class="p"  style=""  >);</span></div><div class="line"  id="LC407"  style=""  ><br style=""  ></div><div class="line"  id="LC408"  style=""  >&nbsp;&nbsp;&nbsp;&nbsp;<span class="n"  style=""  >conn</span><span class="o"  style=" font-weight: bold;"  >-&gt;</span><span class="n"  style=""  >primary</span> <span class="o"  style=" font-weight: bold;"  >=</span> <span class="n"  style=""  >bson_malloc</span><span class="p"  style=""  >(</span> <span class="k"  style=" font-weight: bold;"  >sizeof</span><span class="p"  style=""  >(</span> <span class="n"  style=""  >mongo_host_port</span> <span class="p"  style=""  >)</span> <span class="p"  style=""  >);</span></div></div></div>
			</div>
	</div>
</div>
</body>
</html>