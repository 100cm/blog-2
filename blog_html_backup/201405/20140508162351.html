<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">pgpool-II dblink's password cann't auto-filled bug used in parallel query rewrite?</h2>
	<h5 id="">2014-05-08 16:23:51&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020144834224774/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">群里的一位兄弟问到pgpool-II为什么要用dblink, 我之前pgpool没有仔细的看过. 今天翻看了一下.<div>发现确实会用到dblink, 是在parallel模式的聚合查询中, pgpool 会对查询做重写处理. 重写后的SQL需要用到dblink, 实际上就是帮你简化分布式数据的聚合.</div><div>例如count(*)一个分布式表. 会帮你重写成sum(*) from dblink('select count(*) from tbl')类似的.</div><div>重写实际上存在一定的安全隐患, 为什么呢?</div><div>1. 因为重写中的查询普通用户必须提供密码, 也就是这个重写的SQL一旦发生问题会记录到backend database 的日志中, 日志中包含密码可不是什么好事.</div><div>2. 如果pgpool节点连接backend database节点是采用non ssl连接方式的话, 那么网络中传输的SQL也是明文的, 有被窃取的可能.</div><div>好了, 安全问题先不谈, 这里还有一个问题, 当我在使用pgpool的聚合做查询的时候, 提示封装中没有密码.</div><div>这个问题相关的代码:</div><div>pool_rewrite_outfuncs.c</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >/* start of rewriting query */</font></div><div><font size="2"   >static void examSelectStmt(Node *node,POOL_CONNECTION_POOL *backend,RewriteQuery *message)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; static ConInfoTodblink dblink;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* initialize dblink info */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; initdblink(&amp;dblink,backend);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* initialize &nbsp;message */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; initMessage(message);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; message-&gt;type = node-&gt;type;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; message-&gt;r_code = SELECT_DEFAULT;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; /* do rewrite query */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; nodeToRewriteString(message,&amp;dblink,node);</font></div><div><font size="2"   >}</font></div></div><div><div><font size="2"   >/* set dblink info */</font></div><div><font size="2"   >static void initdblink(ConInfoTodblink *dblink,POOL_CONNECTION_POOL *backend)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; dblink-&gt;dbname = &nbsp;MASTER_CONNECTION(backend)-&gt;sp-&gt;database;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; dblink-&gt;hostaddr = pool_config-&gt;pgpool2_hostname;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; dblink-&gt;user = MASTER_CONNECTION(backend)-&gt;sp-&gt;user;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; dblink-&gt;port = pool_config-&gt;port;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; dblink-&gt;password = MASTER_CONNECTION(backend)-&gt;con-&gt;password;</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div><div>pool_rewrite_query.c</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >static void writeRangeHeader(RewriteQuery *message,ConInfoTodblink *dblink, String *str,DistDefInfo *info, RepliDefInfo *info2,char&nbsp;</font></div><div><font size="2"   >*alias)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; char port[8];</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; char *schema = NULL;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; char *table = NULL;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; pool_debug("writeRangeHeader select_no=%d",message-&gt;current_select);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; sprintf(port,"%d",dblink-&gt;port);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, "dblink(");</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, "'");</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, "host=");</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, dblink-&gt;hostaddr);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, " dbname=");</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, dblink-&gt;dbname);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, " port=");</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, port);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, " user=");</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, dblink-&gt;user);</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if(strlen(dblink-&gt;password))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, " password=");</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delay_string_append_char(message, str, dblink-&gt;password);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><p></p></pre></div><div><br></div><div>我的测试环境</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pgpool ver : 3.3.3</font></div><div><font size="2"   >pgpool IP : 172.16.3.150</font></div><div><font size="2"   >pgpool port : 9999</font></div><div><font size="2"   >backend0 : 172.16.3.39:1999</font></div><div><font size="2"   >backend1: 172.16.3.150:1921</font></div><div><font size="2"   >system_db_hostname: 172.16.3.150:1921</font></div><p></p></pre></div><div>pgpool配置文件</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >-- pool_hba.conf</font></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div><div><div><font size="2"   >-- pool_passwd&nbsp;</font></div><div><font size="2"   >digoal:md5462f71c79368ccf422f8a773ef40074d</font></div><div><font size="2"   >pgpool:md5f24aeb1c3b7d05d7eaf2cd648c307092</font></div></div><div><font size="2"   >-- pgpool.conf</font></div><div><div><font size="2"   >listen_addresses = '0.0.0.0'</font></div><div><font size="2"   >port = 9999</font></div><div><font size="2"   >socket_dir = '/tmp'</font></div><div><font size="2"   >pcp_port = 9898</font></div><div><font size="2"   >pcp_socket_dir = '/tmp'</font></div><div><font size="2"   >backend_hostname0 = '172.16.3.39'</font></div><div><font size="2"   >backend_port0 = 1999</font></div><div><font size="2"   >backend_weight0 = 1</font></div><div><font size="2"   >backend_hostname1 = '172.16.3.150'</font></div><div><font size="2"   >backend_port1 = 1921</font></div><div><font size="2"   >backend_weight1 = 1</font></div><div><font size="2"   >enable_pool_hba = on</font></div><div><font size="2"   >pool_passwd = 'pool_passwd'</font></div><div><font size="2"   >authentication_timeout = 60</font></div><div><font size="2"   >ssl = off</font></div><div><font size="2"   >num_init_children = 20&nbsp;</font></div><div><font size="2"   >max_pool = 4</font></div><div><font size="2"   >child_life_time = 300</font></div><div><font size="2"   >child_max_connections = 0</font></div><div><font size="2"   >connection_life_time = 0</font></div><div><font size="2"   >client_idle_limit = 0</font></div><div><font size="2"   >log_destination = 'syslog'</font></div><div><font size="2"   >print_timestamp = on</font></div><div><font size="2"   >log_connections = on</font></div><div><font size="2"   >log_hostname = on</font></div><div><font size="2"   >log_statement = on</font></div><div><font size="2"   >log_per_node_statement = on</font></div><div><font size="2"   >log_standby_delay = 'none'</font></div><div><font size="2"   >syslog_facility = 'LOCAL0'</font></div><div><font size="2"   >syslog_ident = 'pgpool'</font></div><div><font size="2"   >debug_level = 1</font></div><div><font size="2"   >pid_file_name = '/var/run/pgpool/pgpool.pid'</font></div><div><font size="2"   >logdir = '/tmp'</font></div><div><font size="2"   >connection_cache = on</font></div><div><font size="2"   >reset_query_list = 'ABORT; DISCARD ALL'</font></div><div><font size="2"   >replication_mode = off</font></div><div><font size="2"   >replicate_select = off</font></div><div><font size="2"   >insert_lock = on</font></div><div><font size="2"   >lobj_lock_table = ''</font></div><div><font size="2"   >replication_stop_on_mismatch = off</font></div><div><font size="2"   >failover_if_affected_tuples_mismatch = off</font></div><div><font size="2"   >load_balance_mode = on</font></div><div><font size="2"   >ignore_leading_white_space = on</font></div><div><font size="2"   >white_function_list = ''</font></div><div><font size="2"   >black_function_list = 'nextval,setval'</font></div><div><font size="2"   >master_slave_mode = off</font></div><div><font size="2"   >master_slave_sub_mode = 'stream'</font></div><div><font size="2"   >sr_check_period = 0&nbsp;</font></div><div><font size="2"   >sr_check_user = 'postgres'</font></div><div><font size="2"   >sr_check_password = 'postgres'</font></div><div><font size="2"   >delay_threshold = 0</font></div><div><font size="2"   >follow_master_command = ''</font></div><div><font size="2"   >parallel_mode = on</font></div><div><font size="2"   >pgpool2_hostname = ''</font></div><div><font size="2"   >system_db_hostname &nbsp;= '172.16.3.150'</font></div><div><font size="2"   >system_db_port = 1921</font></div><div><font size="2"   >system_db_dbname = 'pgpool'</font></div><div><font size="2"   >system_db_schema = 'pgpool_catalog'</font></div><div><font size="2"   >system_db_user = 'pgpool'</font></div><div><font size="2"   >system_db_password = 'pgpool'</font></div><div><font size="2"   >health_check_period = 0</font></div><div><font size="2"   >health_check_timeout = 20</font></div><div><font size="2"   >health_check_user = 'nobody'</font></div><div><font size="2"   >health_check_password = ''</font></div><div><font size="2"   >health_check_max_retries = 0</font></div><div><font size="2"   >health_check_retry_delay = 1</font></div><div><font size="2"   >failover_command = ''</font></div><div><font size="2"   >failback_command = ''</font></div><div><font size="2"   >fail_over_on_backend_error = on</font></div><div><font size="2"   >search_primary_node_timeout = 10</font></div><div><font size="2"   >recovery_user = 'nobody'</font></div><div><font size="2"   >recovery_password = ''</font></div><div><font size="2"   >recovery_1st_stage_command = ''</font></div><div><font size="2"   >recovery_2nd_stage_command = ''</font></div><div><font size="2"   >recovery_timeout = 90</font></div><div><font size="2"   >client_idle_limit_in_recovery = 0</font></div><div><font size="2"   >use_watchdog = off</font></div><div><font size="2"   >trusted_servers = ''</font></div><div><font size="2"   >ping_path = '/bin'</font></div><div><font size="2"   >wd_hostname = ''</font></div><div><font size="2"   >wd_port = 9000</font></div><div><font size="2"   >wd_authkey = ''</font></div><div><font size="2"   >delegate_IP = ''</font></div><div><font size="2"   >ifconfig_path = '/sbin'</font></div><div><font size="2"   >if_up_cmd = 'ifconfig eth0:0 inet $_IP_$ netmask 255.255.255.0'</font></div><div><font size="2"   >if_down_cmd = 'ifconfig eth0:0 down'</font></div><div><font size="2"   >arping_path = '/usr/sbin' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # arping command path</font></div><div><font size="2"   >arping_cmd = 'arping -U $_IP_$ -w 1'</font></div><div><font size="2"   >clear_memqcache_on_escalation = on</font></div><div><font size="2"   >wd_escalation_command = ''</font></div><div><font size="2"   >wd_lifecheck_method = 'heartbeat'</font></div><div><font size="2"   >wd_interval = 10</font></div><div><font size="2"   >wd_heartbeat_port = 9694</font></div><div><font size="2"   >wd_heartbeat_keepalive = 2</font></div><div><font size="2"   >wd_heartbeat_deadtime = 30</font></div><div><font size="2"   >heartbeat_destination0 = 'host0_ip1'</font></div><div><font size="2"   >heartbeat_destination_port0 = 9694&nbsp;</font></div><div><font size="2"   >heartbeat_device0 = ''</font></div><div><font size="2"   >wd_life_point = 3</font></div><div><font size="2"   >wd_lifecheck_query = 'SELECT 1'</font></div><div><font size="2"   >wd_lifecheck_dbname = 'template1'</font></div><div><font size="2"   >wd_lifecheck_user = 'nobody'</font></div><div><font size="2"   >wd_lifecheck_password = ''</font></div><div><font size="2"   >relcache_expire = 0</font></div><div><font size="2"   >relcache_size = 256</font></div><div><font size="2"   >check_temp_table = on</font></div><div><font size="2"   >memory_cache_enabled = off</font></div><div><font size="2"   >memqcache_method = 'shmem'</font></div><div><font size="2"   >memqcache_memcached_host = 'localhost'</font></div><div><font size="2"   >memqcache_memcached_port = 11211</font></div><div><font size="2"   >memqcache_total_size = 67108864</font></div><div><font size="2"   >memqcache_max_num_cache = 1000000</font></div><div><font size="2"   >memqcache_expire = 0</font></div><div><font size="2"   >memqcache_auto_cache_invalidation = on</font></div><div><font size="2"   >memqcache_maxcache = 409600</font></div><div><font size="2"   >memqcache_cache_block_size = 1048576</font></div><div><font size="2"   >memqcache_oiddir = '/var/log/pgpool/oiddir'</font></div><div><font size="2"   >white_memqcache_table_list = ''</font></div><div><font size="2"   >black_memqcache_table_list = ''</font></div></div><p></p></pre></div><div><br></div><div>backend pg_hba..conf配置</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >-- pg_hba.conf</font></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div><p></p></pre></div><div><br></div><div>在数据库中直接调用聚合函数报错.</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@db-172-16-3-150-&gt; psql -h 127.0.0.1 -p 9999 -U digoal bench_parallel</font></div><div><font size="2"   >Password for user digoal:&nbsp;</font></div><div><font size="2"   >psql (9.3.3, server 9.3.1)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><div><font size="2"   >bench_parallel=# select count(*) from pgbench_accounts;</font></div><div><font size="2"   >ERROR: &nbsp;08001: could not establish connection</font></div><div><font size="2"   >DETAIL: &nbsp;fe_sendauth: no password supplied</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >LOCATION: &nbsp;dblink_record_internal, dblink.c:686</font></div></div><p></p></pre></div><div>在backend database的日志中能看到对应的日志, 其实就是password没有封装进去.</div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >2014-05-08 16:17:36.233 CST,"pgpool","pgpool",4745,"172.16.3.150:20063",536b3cf5.1289,4,"SELECT",2014-05-08 16:14:45 CST,15/23,0,ERROR,08001,"could not establish connection","fe_sendauth: no password supplied</font></div><div><font size="2"   >",,,,," SELECT sum(pool_g$0) AS count FROM dblink('host=db-172-16-3-150.sky-mobi.com dbname=bench_parallel port=9999 user=digoal','SELECT pool_parallel(""SELECT count(*) FROM pgbench_accounts"")',false) AS pool_t$0g (pool_g$0 bigint ) ",,"dblink_record_internal, dblink.c:686",""</font></div><p></p></pre></div><div>对于这个错误, 解决办法是自行调用pool_parallel, 将会在所有的backend database中执行pool_parallel中的SQL, 并返回结果.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >bench_parallel=# SELECT pool_parallel('SELECT count(*) FROM pgbench_accounts');</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >(2 rows)</font></div><p></p></pre></div><div>使用gdb跟踪时, 也跟踪不到password被存储的迹象.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-150 pgpool-II-3.3.3]# ps -ewf|grep pgpool | grep bench<span style="line-height: 28px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></font></div><div><font size="2"   >root &nbsp; &nbsp; &nbsp;1793 &nbsp;1779 &nbsp;0 14:17 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 pgpool: digoal bench_parallel localhost(27475) idle</font></div></div><div><font size="2"   ># gdb</font></div><div><font size="2"   >(gdb) attach 1793</font></div><div><div><font size="2"   >(gdb) b initdblink</font></div><div><font size="2"   >Breakpoint 1 at 0x424f90: file pool_rewrite_query.c, line 309.</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >输出查询count的SQL.</font></div><div><font size="2"   >gdb中查询对应的password有没有被存储.</font></div><div><div><font size="2"   >Breakpoint 1, initdblink (dblink=0x719600, backend=0x1ea4b90) at pool_rewrite_query.c:309</font></div><div><font size="2"   >309 &nbsp; &nbsp; {</font></div></div><div><div><font size="2"   >(gdb) print backend</font></div><div><font size="2"   >$1 = (POOL_CONNECTION_POOL *) 0x1ea4b90</font></div><div><font size="2"   >(gdb) print backend-&gt;password</font></div><div><font size="2"   >There is no member named password.</font></div><div><font size="2"   >(gdb) print backend-&gt;pwd_size</font></div><div><font size="2"   >There is no member named pwd_size.</font></div><div><font size="2"   >(gdb) print backend</font></div><div><font size="2"   >$2 = (POOL_CONNECTION_POOL *) 0x1ea4b90</font></div><div><font size="2"   >(gdb) print dblink-&gt;password</font></div><div><font size="2"   >$3 = 0x0</font></div><div><font size="2"   >(gdb) n</font></div><div><font size="2"   >310 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dblink-&gt;dbname = &nbsp;MASTER_CONNECTION(backend)-&gt;sp-&gt;database;</font></div><div><font size="2"   >(gdb)&nbsp;</font></div><div><font size="2"   >311 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dblink-&gt;hostaddr = pool_config-&gt;pgpool2_hostname;</font></div><div><font size="2"   >(gdb)&nbsp;</font></div><div><font size="2"   >312 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dblink-&gt;user = MASTER_CONNECTION(backend)-&gt;sp-&gt;user;</font></div><div><font size="2"   >(gdb)&nbsp;</font></div><div><font size="2"   >313 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dblink-&gt;port = pool_config-&gt;port;</font></div><div><font size="2"   >(gdb) print dblink-&gt;password</font></div><div><font size="2"   >$4 = 0x0</font></div><div><font size="2"   >(gdb) print dblink-&gt;port</font></div><div><font size="2"   >$5 = 0</font></div><div><font size="2"   >(gdb) print dblink-&gt;user</font></div><div><font size="2"   >$6 = 0x1e9a930 "digoal"</font></div><div><font size="2"   >(gdb) print dblink-&gt;hostaddr</font></div><div><font size="2"   >$7 = 0x70ef20 "db-172-16-3-150.sky-mobi.com"</font></div><div><font size="2"   >(gdb) print dblink-&gt;dbname</font></div><div><font size="2"   >$8 = 0x1e9a950 "bench_parallel"</font></div><div><font size="2"   >(gdb) print dblink-&gt;port</font></div><div><font size="2"   >$9 = 0</font></div><div><font size="2"   >(gdb) n</font></div><div><font size="2"   >314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dblink-&gt;password = MASTER_CONNECTION(backend)-&gt;con-&gt;password;</font></div><div><font size="2"   >(gdb) print dblink-&gt;password</font></div><div><font size="2"   >$10 = 0x0</font></div><div><font size="2"   >(gdb) print MASTER_CONNECTION(backend)</font></div><div><font size="2"   >No symbol "MASTER_CONNECTION" in current context.</font></div><div><font size="2"   >(gdb) print backend</font></div><div><font size="2"   >$11 = (POOL_CONNECTION_POOL *) 0x1ea4b90</font></div><div><font size="2"   >(gdb) print dblink-&gt;con</font></div><div><font size="2"   >There is no member named con.</font></div><div><font size="2"   >(gdb) print backend-con</font></div><div><font size="2"   >No symbol "con" in current context.</font></div><div><font size="2"   >(gdb) print backend-con-password</font></div><div><font size="2"   >No symbol "con" in current context.</font></div><div><font size="2"   >(gdb) print pool_virtual_master_db_node_id()</font></div><div><font size="2"   >$12 = 0</font></div><div><font size="2"   >(gdb) print (backend)-&gt;slots[0]</font></div><div><font size="2"   >$13 = (POOL_CONNECTION_POOL_SLOT *) 0x1e9d480</font></div><div><font size="2"   >(gdb) print (backend)-&gt;slots[0]-&gt;con</font></div><div><font size="2"   >$14 = (POOL_CONNECTION *) 0x1ea7fe0</font></div><div><font size="2"   >(gdb) print (backend)-&gt;slots[0]-&gt;con-&gt;password</font></div><div><font size="2"   >$15 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb) print (backend)-&gt;slots[0]-&gt;con-&gt;password</font></div><div><font size="2"   >$16 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb)&nbsp;</font></div><div><font size="2"   >$17 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb)&nbsp;</font></div><div><font size="2"   >$18 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb)&nbsp;</font></div><div><font size="2"   >$19 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb)&nbsp;</font></div><div><font size="2"   >$20 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb)&nbsp;</font></div><div><font size="2"   >$21 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb) print (backend)-&gt;slots[0]-&gt;con-&gt;password</font></div><div><font size="2"   >$22 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb) print (backend)-&gt;slots[1]-&gt;con-&gt;password</font></div><div><font size="2"   >$23 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb) print backend-&gt;slots[1]-&gt;con-&gt;password</font></div><div><font size="2"   >$24 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb) print backend-&gt;slots</font></div><div><font size="2"   >$25 = {0x1e9d480, 0x1e9d4b0, 0x0 &lt;repeats 126 times&gt;}</font></div><div><font size="2"   >(gdb) print backend-&gt;slots[1]</font></div><div><font size="2"   >$26 = (POOL_CONNECTION_POOL_SLOT *) 0x1e9d4b0</font></div><div><font size="2"   >(gdb) print backend-&gt;slots[0]</font></div><div><font size="2"   >$27 = (POOL_CONNECTION_POOL_SLOT *) 0x1e9d480</font></div><div><font size="2"   >(gdb) print backend-&gt;slots[0]-&gt;password</font></div><div><font size="2"   >There is no member named password.</font></div><div><font size="2"   >(gdb) print backend-&gt;slots[0]-&gt;con</font></div><div><font size="2"   >$28 = (POOL_CONNECTION *) 0x1ea7fe0</font></div><div><font size="2"   >(gdb) print backend-&gt;slots[0]-&gt;con-&gt;password</font></div><div><font size="2"   >$29 = '\000' &lt;repeats 1023 times&gt;</font></div><div><font size="2"   >(gdb) n</font></div></div><p></p></pre></div>
<div>这个问题正在和pgpool-II的作者沟通. 有结果会发到这里来.</div><div><br></div><a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="pgpool-II dblinks password cannt auto-filled bug used in parallel query rewrite? - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">heibao326 - 2015-07-28 15:23:03</h5>
				<div>根据http://www.postgres.cn/docs/9.3/different-replication-solutions.html中的集群方案，我们一般通过哪种方案搭建集群呢？利用PGPOOL-II搭建pg集群复制模式？利用PGPOOL-II搭建pg高可用模式？利用流复制搭建pg高可用？是有什么优劣势吗？</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-07-28 15:23:03</h5>
				<div style="width:600px;">hi, 如果要实现对应于透明的读写分离，可以考虑pgpool-II+stream replicatoin,如果要做HA，可以用stream replication+failover脚本来实现。</div>
			</div>
			<div id="">
				<h5 id="">heibao326 - 2015-06-03 16:27:44</h5>
				<div>德哥 &nbsp;请教下 &nbsp;现在有办法彻底解决这个问题吗“parallel下使用聚合函数的查询总提示密码吗？“</div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 heibao326 - 2015-06-03 16:27:44</h5>
				<div style="width:600px;">pgpool-II下一个版本已经放弃parallel功能了</div>
			</div>
			<div id="">
				<h5 id="">zhaolinzzu - 2014-08-17 14:22:46</h5>
				<div>目前也遇到了这个问题，parallel下使用聚合函数的查询总提示密码<br><br></div>
			</div>
	</div>
</div>
</body>
</html>