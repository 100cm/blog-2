<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">cp can change a file's content or md5sum?</h2>
	<h5 id="">2011-03-29 17:06:15&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201122944913193/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">我在写这个的时候还是抱有怀疑的态度。<br>今天一位数据仓库的兄弟在做一个文件的入库时报了一个如下的错误：<br>ERROR:&nbsp;gpfdist&nbsp;error&nbsp;-&nbsp;line&nbsp;too&nbsp;long&nbsp;in&nbsp;file<br>（很明显是使用GreenPlum的gpfdist外部表来做的入库，看起来是文件存在格式上的问题）.<br>奇怪的是，该同学把这个文件拷贝到另一个盘，就可以入库了（具体是不是这么做的我现在还是有点怀疑，因为看下面的分析）。<br>首先，原始文件和拷贝后的文件MD5值是不一样的，正常情况下拷贝一个文件MD5值应该是一样的。<br>[root@dw-host33-master-if0 ftp_samba]# md5sum 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt<br>1eb0e31df897986f2f4d8b126a573f2a&nbsp; 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt<br>[root@dw-host33-master-if0 ftp_samba]# md5sum 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt1<br>a9d19ae0ebf7a30e08a372743248396f&nbsp; 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt1<br><br>其次，两个文件在内容上存在差别<br>[root@dw-host33-master-if0 ftp_samba]# tail -n 1 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt1 （异常入库的文件）<br>11346586045&nbsp;&nbsp;&nbsp;&nbsp; 856965949&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )dzyDBzyO~zyDhzyzrzy&nbsp;&nbsp;&nbsp; )#zzf1zyKBzyLlzy(Hzy&nbsp;&nbsp;&nbsp; $l1^aD4%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; euA=&nbsp;&nbsp;&nbsp; 240&nbsp;&nbsp;&nbsp;&nbsp; 320&nbsp;&nbsp;&nbsp;&nbsp; 575&nbsp;&nbsp;&nbsp;&nbsp; 00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 327013&nbsp; 1002&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8d1268c990d0fd0bc4a53c507d6b18e2?-88546930212897&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 410717&nbsp; 131535&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 200-88546930212897 100&nbsp;&nbsp;&nbsp;&nbsp; 2011-03-22 23:13:00&nbsp;&nbsp;&nbsp;&nbsp; 2011-03-29 11:55:58&nbsp;&nbsp;&nbsp;&nbsp; 2011-03-29 11:55:58&nbsp;&nbsp;&nbsp;&nbsp; 2011-03-29 11:59:59&nbsp;&nbsp;&nbsp;&nbsp; 211.140.18.130&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8613800577500&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 310000&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 279182&nbsp; 410717&nbsp; 2<br>[root@dw-host33-master-if0 ftp_samba]# tail -n 1 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt（正常入库的文件）<br>13249172728&nbsp;&nbsp;&nbsp;&nbsp; -1459607343&nbsp;&nbsp;&nbsp;&nbsp; )dzyK5zyKdzyf3zyzlzz&nbsp;&nbsp;&nbsp; $jyy$1zyD5zyL)zzDtzy&nbsp;&nbsp;&nbsp; 3j6%$@7%bM==&nbsp;&nbsp;&nbsp; bfzFqM==&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 240&nbsp;&nbsp;&nbsp;&nbsp; 320&nbsp;&nbsp;&nbsp;&nbsp; 35211&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 285&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b3858e4f817039d61242cb052def6297?-76787182313009&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 44852&nbsp;&nbsp; 44852&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0104112&nbsp; -76787182313009 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2011-03-29 11:59:02&nbsp;&nbsp;&nbsp;&nbsp; 2011-03-29 11:59:45&nbsp;&nbsp;&nbsp;&nbsp; 2011-03-29 11:59:45&nbsp;&nbsp;&nbsp;&nbsp; 2011-03-29 11:59:59&nbsp;&nbsp;&nbsp;&nbsp; 117.136.4.11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 30000&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 44852&nbsp;&nbsp; 3<br><br>下面是纪实的分析过程，把那个异常入库的文件重新再拷贝到另一个文件<br>cp 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt1 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt2<br>[root@dw-host33-master-if0 ftp_samba]# md5sum 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt2<br>a9d19ae0ebf7a30e08a372743248396f&nbsp; 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt2<br>MD5值与原文件一致，文件内容一致。<br><br>文件比较 : (拷贝后文件用CMP比较后一致，返回结果0)<br>[root@dw-host33-master-if0 ftp_samba]# cmp 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt2 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt1<br>[root@dw-host33-master-if0 ftp_samba]# echo $?<br>0<br>[root@dw-host33-master-if0 ftp_samba]# cmp （可以正常入库的文件和异常入库的文件比较后，发现内容不一致，返回结果1）<br>2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt2 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt<br>2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt2 2__cookielog.tbl_dcs_download_rec_2011-03-29_11_20110329110000-20110329120000_0.txt differ: byte 732307705, line 2296506<br>[root@dw-host33-master-if0 ftp_samba]# echo $?<br>1<br><br>唯一可以让人理解的解释是：这位哥们搞错了，可能ETL重新做了一次，解决了格式上的问题。而可以正常入库的文件和异常入库的文件应该是两次ETL产生的文件。</div>
	</div>
</div>
</body>
</html>