<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">/proc/sys/vm</h2>
	<h5 id="">2010-07-09 9:15:32&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020106991532355/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">最近服务器有 报vm overcommit异常，先摘记一下vm介绍:有空再看<div><span style="font-family: geneva, arial, verdana, lucida, helvetida, sans-serif; line-height: normal; font-size: medium;"  ><pre style="padding-top: 1em; padding-right: 1em; padding-bottom: 1em; padding-left: 1em; background-color: rgb(238, 238, 238); width: 58em;"  >Documentation for /proc/sys/vm/* kernel version 2.6.29 <span><a name="2" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#2"  >2</a> </span> (c) 1998, 1999,  Rik van Riel &lt;riel[AT]nl.linux[DOT]org&gt; <span><a name="3" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#3"  >3</a> </span> (c) 2008         Peter W. Morreale &lt;pmorreale[AT]novell[DOT]com&gt; <span><a name="4" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#4"  >4</a> </span> <span><a name="5" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#5"  >5</a> </span>For general info and legal blurb, please look in README. <span><a name="6" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#6"  >6</a> </span> <span><a name="7" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#7"  >7</a> </span>============================================================== <span><a name="8" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#8"  >8</a> </span> <span><a name="9" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#9"  >9</a> </span>This file contains the documentation for the sysctl files in <span><a name="10" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#10"  >10</a> </span>/proc/sys/vm and is valid for Linux kernel version 2.6.29. <span><a name="11" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#11"  >11</a> </span> <span><a name="12" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#12"  >12</a> </span>The files in this directory can be used to tune the operation <span><a name="13" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#13"  >13</a> </span>of the virtual memory (VM) subsystem of the Linux kernel and <span><a name="14" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#14"  >14</a> </span>the writeout of dirty data to disk. <span><a name="15" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#15"  >15</a> </span> <span><a name="16" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#16"  >16</a> </span>Default values and initialization routines for most of these <span><a name="17" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#17"  >17</a> </span>files can be found in mm/swap.c. <span><a name="18" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#18"  >18</a> </span> <span><a name="19" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#19"  >19</a> </span>Currently, these files are in /proc/sys/vm: <span><a name="20" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#20"  >20</a> </span> <span><a name="21" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#21"  >21</a> </span>- block_dump <span><a name="22" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#22"  >22</a> </span>- dirty_background_bytes <span><a name="23" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#23"  >23</a> </span>- dirty_background_ratio <span><a name="24" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#24"  >24</a> </span>- dirty_bytes <span><a name="25" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#25"  >25</a> </span>- dirty_expire_centisecs <span><a name="26" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#26"  >26</a> </span>- dirty_ratio <span><a name="27" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#27"  >27</a> </span>- dirty_writeback_centisecs <span><a name="28" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#28"  >28</a> </span>- drop_caches <span><a name="29" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#29"  >29</a> </span>- hugepages_treat_as_movable <span><a name="30" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#30"  >30</a> </span>- hugetlb_shm_group <span><a name="31" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#31"  >31</a> </span>- laptop_mode <span><a name="32" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#32"  >32</a> </span>- legacy_va_layout <span><a name="33" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#33"  >33</a> </span>- lowmem_reserve_ratio <span><a name="34" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#34"  >34</a> </span>- max_map_count <span><a name="35" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#35"  >35</a> </span>- memory_failure_early_kill <span><a name="36" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#36"  >36</a> </span>- memory_failure_recovery <span><a name="37" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#37"  >37</a> </span>- min_free_kbytes <span><a name="38" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#38"  >38</a> </span>- min_slab_ratio <span><a name="39" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#39"  >39</a> </span>- min_unmapped_ratio <span><a name="40" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#40"  >40</a> </span>- mmap_min_addr <span><a name="41" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#41"  >41</a> </span>- nr_hugepages <span><a name="42" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#42"  >42</a> </span>- nr_overcommit_hugepages <span><a name="43" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#43"  >43</a> </span>- nr_pdflush_threads <span><a name="44" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#44"  >44</a> </span>- nr_trim_pages         (only if CONFIG_MMU=n) <span><a name="45" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#45"  >45</a> </span>- numa_zonelist_order <span><a name="46" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#46"  >46</a> </span>- oom_dump_tasks <span><a name="47" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#47"  >47</a> </span>- oom_kill_allocating_task <span><a name="48" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#48"  >48</a> </span>- overcommit_memory <span><a name="49" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#49"  >49</a> </span>- overcommit_ratio <span><a name="50" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#50"  >50</a> </span>- page-cluster <span><a name="51" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#51"  >51</a> </span>- panic_on_oom <span><a name="52" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#52"  >52</a> </span>- percpu_pagelist_fraction <span><a name="53" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#53"  >53</a> </span>- stat_interval <span><a name="54" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#54"  >54</a> </span>- swappiness <span><a name="55" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#55"  >55</a> </span>- vfs_cache_pressure <span><a name="56" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#56"  >56</a> </span>- zone_reclaim_mode <span><a name="57" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#57"  >57</a> </span> <span><a name="58" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#58"  >58</a> </span>============================================================== <span><a name="59" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#59"  >59</a> </span> <span><a name="60" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#60"  >60</a> </span>block_dump <span><a name="61" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#61"  >61</a> </span> <span><a name="62" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#62"  >62</a> </span>block_dump enables block I/O debugging when set to a nonzero value. More <span><a name="63" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#63"  >63</a> </span>information on block I/O debugging is in Documentation/laptops/laptop-mode.txt. <span><a name="64" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#64"  >64</a> </span> <span><a name="65" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#65"  >65</a> </span>============================================================== <span><a name="66" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#66"  >66</a> </span> <span><a name="67" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#67"  >67</a> </span>dirty_background_bytes <span><a name="68" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#68"  >68</a> </span> <span><a name="69" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#69"  >69</a> </span>Contains the amount of dirty memory at which the pdflush background writeback <span><a name="70" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#70"  >70</a> </span>daemon will start writeback. <span><a name="71" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#71"  >71</a> </span> <span><a name="72" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#72"  >72</a> </span>If dirty_background_bytes is written, dirty_background_ratio becomes a function <span><a name="73" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#73"  >73</a> </span>of its value (dirty_background_bytes / the amount of dirtyable system memory). <span><a name="74" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#74"  >74</a> </span> <span><a name="75" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#75"  >75</a> </span>============================================================== <span><a name="76" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#76"  >76</a> </span> <span><a name="77" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#77"  >77</a> </span>dirty_background_ratio <span><a name="78" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#78"  >78</a> </span> <span><a name="79" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#79"  >79</a> </span>Contains, as a percentage of total system memory, the number of pages at which <span><a name="80" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#80"  >80</a> </span>the pdflush background writeback daemon will start writing out dirty data. <span><a name="81" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#81"  >81</a> </span> <span><a name="82" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#82"  >82</a> </span>============================================================== <span><a name="83" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#83"  >83</a> </span> <span><a name="84" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#84"  >84</a> </span>dirty_bytes <span><a name="85" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#85"  >85</a> </span> <span><a name="86" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#86"  >86</a> </span>Contains the amount of dirty memory at which a process generating disk writes <span><a name="87" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#87"  >87</a> </span>will itself start writeback. <span><a name="88" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#88"  >88</a> </span> <span><a name="89" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#89"  >89</a> </span>If dirty_bytes is written, dirty_ratio becomes a function of its value <span><a name="90" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#90"  >90</a> </span>(dirty_bytes / the amount of dirtyable system memory). <span><a name="91" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#91"  >91</a> </span> <span><a name="92" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#92"  >92</a> </span>Note: the minimum value allowed for dirty_bytes is two pages (in bytes); any <span><a name="93" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#93"  >93</a> </span>value lower than this limit will be ignored and the old configuration will be <span><a name="94" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#94"  >94</a> </span>retained. <span><a name="95" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#95"  >95</a> </span> <span><a name="96" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#96"  >96</a> </span>============================================================== <span><a name="97" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#97"  >97</a> </span> <span><a name="98" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#98"  >98</a> </span>dirty_expire_centisecs <span><a name="99" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#99"  >99</a> </span> <span><a name="100" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#100"  >100</a> </span>This tunable is used to define when dirty data is old enough to be eligible <span><a name="101" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#101"  >101</a> </span>for writeout by the pdflush daemons.  It is expressed in 100'ths of a second. <span><a name="102" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#102"  >102</a> </span>Data which has been dirty in-memory for longer than this interval will be <span><a name="103" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#103"  >103</a> </span>written out next time a pdflush daemon wakes up. <span><a name="104" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#104"  >104</a> </span> <span><a name="105" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#105"  >105</a> </span>============================================================== <span><a name="106" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#106"  >106</a> </span> <span><a name="107" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#107"  >107</a> </span>dirty_ratio <span><a name="108" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#108"  >108</a> </span> <span><a name="109" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#109"  >109</a> </span>Contains, as a percentage of total system memory, the number of pages at which <span><a name="110" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#110"  >110</a> </span>a process which is generating disk writes will itself start writing out dirty <span><a name="111" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#111"  >111</a> </span>data. <span><a name="112" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#112"  >112</a> </span> <span><a name="113" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#113"  >113</a> </span>============================================================== <span><a name="114" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#114"  >114</a> </span> <span><a name="115" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#115"  >115</a> </span>dirty_writeback_centisecs <span><a name="116" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#116"  >116</a> </span> <span><a name="117" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#117"  >117</a> </span>The pdflush writeback daemons will periodically wake up and write `old' data <span><a name="118" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#118"  >118</a> </span>out to disk.  This tunable expresses the interval between those wakeups, in <span><a name="119" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#119"  >119</a> </span>100'ths of a second. <span><a name="120" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#120"  >120</a> </span> <span><a name="121" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#121"  >121</a> </span>Setting this to zero disables periodic writeback altogether. <span><a name="122" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#122"  >122</a> </span> <span><a name="123" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#123"  >123</a> </span>============================================================== <span><a name="124" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#124"  >124</a> </span> <span><a name="125" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#125"  >125</a> </span>drop_caches <span><a name="126" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#126"  >126</a> </span> <span><a name="127" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#127"  >127</a> </span>Writing to this will cause the kernel to drop clean caches, dentries and <span><a name="128" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#128"  >128</a> </span>inodes from memory, causing that memory to become free. <span><a name="129" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#129"  >129</a> </span> <span><a name="130" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#130"  >130</a> </span>To free pagecache: <span><a name="131" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#131"  >131</a> </span> echo 1 &gt; /proc/sys/vm/drop_caches <span><a name="132" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#132"  >132</a> </span>To free dentries and inodes: <span><a name="133" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#133"  >133</a> </span> echo 2 &gt; /proc/sys/vm/drop_caches <span><a name="134" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#134"  >134</a> </span>To free pagecache, dentries and inodes: <span><a name="135" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#135"  >135</a> </span> echo 3 &gt; /proc/sys/vm/drop_caches <span><a name="136" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#136"  >136</a> </span> <span><a name="137" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#137"  >137</a> </span>As this is a non-destructive operation and dirty objects are not freeable, the <span><a name="138" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#138"  >138</a> </span>user should run `sync' first. <span><a name="139" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#139"  >139</a> </span> <span><a name="140" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#140"  >140</a> </span>============================================================== <span><a name="141" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#141"  >141</a> </span> <span><a name="142" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#142"  >142</a> </span>hugepages_treat_as_movable <span><a name="143" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#143"  >143</a> </span> <span><a name="144" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#144"  >144</a> </span>This parameter is only useful when kernelcore= is specified at boot time to <span><a name="145" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#145"  >145</a> </span>create ZONE_MOVABLE for pages that may be reclaimed or migrated. Huge pages <span><a name="146" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#146"  >146</a> </span>are not movable so are not normally allocated from ZONE_MOVABLE. A non-zero <span><a name="147" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#147"  >147</a> </span>value written to hugepages_treat_as_movable allows huge pages to be allocated <span><a name="148" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#148"  >148</a> </span>from ZONE_MOVABLE. <span><a name="149" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#149"  >149</a> </span> <span><a name="150" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#150"  >150</a> </span>Once enabled, the ZONE_MOVABLE is treated as an area of memory the huge <span><a name="151" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#151"  >151</a> </span>pages pool can easily grow or shrink within. Assuming that applications are <span><a name="152" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#152"  >152</a> </span>not running that mlock() a lot of memory, it is likely the huge pages pool <span><a name="153" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#153"  >153</a> </span>can grow to the size of ZONE_MOVABLE by repeatedly entering the desired value <span><a name="154" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#154"  >154</a> </span>into nr_hugepages and triggering page reclaim. <span><a name="155" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#155"  >155</a> </span> <span><a name="156" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#156"  >156</a> </span>============================================================== <span><a name="157" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#157"  >157</a> </span> <span><a name="158" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#158"  >158</a> </span>hugetlb_shm_group <span><a name="159" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#159"  >159</a> </span> <span><a name="160" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#160"  >160</a> </span>hugetlb_shm_group contains group id that is allowed to create SysV <span><a name="161" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#161"  >161</a> </span>shared memory segment using hugetlb page. <span><a name="162" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#162"  >162</a> </span> <span><a name="163" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#163"  >163</a> </span>============================================================== <span><a name="164" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#164"  >164</a> </span> <span><a name="165" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#165"  >165</a> </span>laptop_mode <span><a name="166" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#166"  >166</a> </span> <span><a name="167" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#167"  >167</a> </span>laptop_mode is a knob that controls "laptop mode". All the things that are <span><a name="168" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#168"  >168</a> </span>controlled by this knob are discussed in Documentation/laptops/laptop-mode.txt. <span><a name="169" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#169"  >169</a> </span> <span><a name="170" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#170"  >170</a> </span>============================================================== <span><a name="171" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#171"  >171</a> </span> <span><a name="172" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#172"  >172</a> </span>legacy_va_layout <span><a name="173" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#173"  >173</a> </span> <span><a name="174" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#174"  >174</a> </span>If non-zero, this sysctl disables the new 32-bit mmap mmap layout - the kernel <span><a name="175" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#175"  >175</a> </span>will use the legacy (2.4) layout for all processes. <span><a name="176" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#176"  >176</a> </span> <span><a name="177" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#177"  >177</a> </span>============================================================== <span><a name="178" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#178"  >178</a> </span> <span><a name="179" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#179"  >179</a> </span>lowmem_reserve_ratio <span><a name="180" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#180"  >180</a> </span> <span><a name="181" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#181"  >181</a> </span>For some specialised workloads on highmem machines it is dangerous for <span><a name="182" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#182"  >182</a> </span>the kernel to allow process memory to be allocated from the "lowmem" <span><a name="183" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#183"  >183</a> </span>zone.  This is because that memory could then be pinned via the mlock() <span><a name="184" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#184"  >184</a> </span>system call, or by unavailability of swapspace. <span><a name="185" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#185"  >185</a> </span> <span><a name="186" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#186"  >186</a> </span>And on large highmem machines this lack of reclaimable lowmem memory <span><a name="187" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#187"  >187</a> </span>can be fatal. <span><a name="188" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#188"  >188</a> </span> <span><a name="189" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#189"  >189</a> </span>So the Linux page allocator has a mechanism which prevents allocations <span><a name="190" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#190"  >190</a> </span>which _could_ use highmem from using too much lowmem.  This means that <span><a name="191" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#191"  >191</a> </span>a certain amount of lowmem is defended from the possibility of being <span><a name="192" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#192"  >192</a> </span>captured into pinned user memory. <span><a name="193" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#193"  >193</a> </span> <span><a name="194" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#194"  >194</a> </span>(The same argument applies to the old 16 megabyte ISA DMA region.  This <span><a name="195" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#195"  >195</a> </span>mechanism will also defend that region from allocations which could use <span><a name="196" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#196"  >196</a> </span>highmem or lowmem). <span><a name="197" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#197"  >197</a> </span> <span><a name="198" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#198"  >198</a> </span>The `lowmem_reserve_ratio' tunable determines how aggressive the kernel is <span><a name="199" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#199"  >199</a> </span>in defending these lower zones. <span><a name="200" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#200"  >200</a> </span> <span><a name="201" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#201"  >201</a> </span>If you have a machine which uses highmem or ISA DMA and your <span><a name="202" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#202"  >202</a> </span>applications are using mlock(), or if you are running with no swap then <span><a name="203" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#203"  >203</a> </span>you probably should change the lowmem_reserve_ratio setting. <span><a name="204" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#204"  >204</a> </span> <span><a name="205" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#205"  >205</a> </span>The lowmem_reserve_ratio is an array. You can see them by reading this file. <span><a name="206" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#206"  >206</a> </span>- <span><a name="207" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#207"  >207</a> </span>% cat /proc/sys/vm/lowmem_reserve_ratio <span><a name="208" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#208"  >208</a> </span>256     256     32 <span><a name="209" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#209"  >209</a> </span>- <span><a name="210" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#210"  >210</a> </span>Note: # of this elements is one fewer than number of zones. Because the highest <span><a name="211" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#211"  >211</a> </span>      zone's value is not necessary for following calculation. <span><a name="212" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#212"  >212</a> </span> <span><a name="213" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#213"  >213</a> </span>But, these values are not used directly. The kernel calculates # of protection <span><a name="214" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#214"  >214</a> </span>pages for each zones from them. These are shown as array of protection pages <span><a name="215" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#215"  >215</a> </span>in /proc/zoneinfo like followings. (This is an example of x86-64 box). <span><a name="216" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#216"  >216</a> </span>Each zone has an array of protection pages like this. <span><a name="217" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#217"  >217</a> </span> <span><a name="218" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#218"  >218</a> </span>- <span><a name="219" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#219"  >219</a> </span>Node 0, zone      DMA <span><a name="220" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#220"  >220</a> </span>  pages free     1355 <span><a name="221" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#221"  >221</a> </span>        min      3 <span><a name="222" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#222"  >222</a> </span>        low      3 <span><a name="223" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#223"  >223</a> </span>        high     4 <span><a name="224" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#224"  >224</a> </span> : <span><a name="225" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#225"  >225</a> </span> : <span><a name="226" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#226"  >226</a> </span>    numa_other   0 <span><a name="227" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#227"  >227</a> </span>        protection: (0, 2004, 2004, 2004) <span><a name="228" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#228"  >228</a> </span> ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ <span><a name="229" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#229"  >229</a> </span>  pagesets <span><a name="230" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#230"  >230</a> </span>    cpu: 0 pcp: 0 <span><a name="231" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#231"  >231</a> </span>        : <span><a name="232" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#232"  >232</a> </span>- <span><a name="233" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#233"  >233</a> </span>These protections are added to score to judge whether this zone should be used <span><a name="234" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#234"  >234</a> </span>for page allocation or should be reclaimed. <span><a name="235" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#235"  >235</a> </span> <span><a name="236" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#236"  >236</a> </span>In this example, if normal pages (index=2) are required to this DMA zone and <span><a name="237" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#237"  >237</a> </span>watermark[WMARK_HIGH] is used for watermark, the kernel judges this zone should <span><a name="238" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#238"  >238</a> </span>not be used because pages_free(1355) is smaller than watermark + protection[2] <span><a name="239" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#239"  >239</a> </span>(4 + 2004 = 2008). If this protection value is 0, this zone would be used for <span><a name="240" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#240"  >240</a> </span>normal page requirement. If requirement is DMA zone(index=0), protection[0] <span><a name="241" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#241"  >241</a> </span>(=0) is used. <span><a name="242" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#242"  >242</a> </span> <span><a name="243" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#243"  >243</a> </span>zone[i]'s protection[j] is calculated by following expression. <span><a name="244" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#244"  >244</a> </span> <span><a name="245" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#245"  >245</a> </span>(i &lt; j): <span><a name="246" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#246"  >246</a> </span>  zone[i]-&gt;protection[j] <span><a name="247" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#247"  >247</a> </span>  = (total sums of present_pages from zone[i+1] to zone[j] on the node) <span><a name="248" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#248"  >248</a> </span>    / lowmem_reserve_ratio[i]; <span><a name="249" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#249"  >249</a> </span>(i = j): <span><a name="250" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#250"  >250</a> </span>   (should not be protected. = 0; <span><a name="251" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#251"  >251</a> </span>(i &gt; j): <span><a name="252" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#252"  >252</a> </span>   (not necessary, but looks 0) <span><a name="253" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#253"  >253</a> </span> <span><a name="254" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#254"  >254</a> </span>The default values of lowmem_reserve_ratio[i] are <span><a name="255" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#255"  >255</a> </span>    256 (if zone[i] means DMA or DMA32 zone) <span><a name="256" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#256"  >256</a> </span>    32  (others). <span><a name="257" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#257"  >257</a> </span>As above expression, they are reciprocal number of ratio. <span><a name="258" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#258"  >258</a> </span>256 means 1/256. # of protection pages becomes about "0.39%" of total present <span><a name="259" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#259"  >259</a> </span>pages of higher zones on the node. <span><a name="260" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#260"  >260</a> </span> <span><a name="261" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#261"  >261</a> </span>If you would like to protect more pages, smaller values are effective. <span><a name="262" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#262"  >262</a> </span>The minimum value is 1 (1/1 -&gt; 100%). <span><a name="263" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#263"  >263</a> </span> <span><a name="264" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#264"  >264</a> </span>============================================================== <span><a name="265" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#265"  >265</a> </span> <span><a name="266" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#266"  >266</a> </span>max_map_count: <span><a name="267" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#267"  >267</a> </span> <span><a name="268" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#268"  >268</a> </span>This file contains the maximum number of memory map areas a process <span><a name="269" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#269"  >269</a> </span>may have. Memory map areas are used as a side-effect of calling <span><a name="270" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#270"  >270</a> </span>malloc, directly by mmap and mprotect, and also when loading shared <span><a name="271" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#271"  >271</a> </span>libraries. <span><a name="272" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#272"  >272</a> </span> <span><a name="273" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#273"  >273</a> </span>While most applications need less than a thousand maps, certain <span><a name="274" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#274"  >274</a> </span>programs, particularly malloc debuggers, may consume lots of them, <span><a name="275" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#275"  >275</a> </span>e.g., up to one or two maps per allocation. <span><a name="276" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#276"  >276</a> </span> <span><a name="277" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#277"  >277</a> </span>The default value is 65536. <span><a name="278" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#278"  >278</a> </span> <span><a name="279" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#279"  >279</a> </span>============================================================= <span><a name="280" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#280"  >280</a> </span> <span><a name="281" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#281"  >281</a> </span>memory_failure_early_kill: <span><a name="282" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#282"  >282</a> </span> <span><a name="283" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#283"  >283</a> </span>Control how to kill processes when uncorrected memory error (typically <span><a name="284" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#284"  >284</a> </span>a 2bit error in a memory module) is detected in the background by hardware <span><a name="285" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#285"  >285</a> </span>that cannot be handled by the kernel. In some cases (like the page <span><a name="286" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#286"  >286</a> </span>still having a valid copy on disk) the kernel will handle the failure <span><a name="287" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#287"  >287</a> </span>transparently without affecting any applications. But if there is <span><a name="288" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#288"  >288</a> </span>no other uptodate copy of the data it will kill to prevent any data <span><a name="289" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#289"  >289</a> </span>corruptions from propagating. <span><a name="290" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#290"  >290</a> </span> <span><a name="291" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#291"  >291</a> </span>1: Kill all processes that have the corrupted and not reloadable page mapped <span><a name="292" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#292"  >292</a> </span>as soon as the corruption is detected.  Note this is not supported <span><a name="293" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#293"  >293</a> </span>for a few types of pages, like kernel internally allocated data or <span><a name="294" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#294"  >294</a> </span>the swap cache, but works for the majority of user pages. <span><a name="295" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#295"  >295</a> </span> <span><a name="296" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#296"  >296</a> </span>0: Only unmap the corrupted page from all processes and only kill a process <span><a name="297" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#297"  >297</a> </span>who tries to access it. <span><a name="298" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#298"  >298</a> </span> <span><a name="299" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#299"  >299</a> </span>The kill is done using a catchable SIGBUS with BUS_MCEERR_AO, so processes can <span><a name="300" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#300"  >300</a> </span>handle this if they want to. <span><a name="301" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#301"  >301</a> </span> <span><a name="302" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#302"  >302</a> </span>This is only active on architectures/platforms with advanced machine <span><a name="303" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#303"  >303</a> </span>check handling and depends on the hardware capabilities. <span><a name="304" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#304"  >304</a> </span> <span><a name="305" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#305"  >305</a> </span>Applications can override this setting individually with the PR_MCE_KILL prctl <span><a name="306" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#306"  >306</a> </span> <span><a name="307" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#307"  >307</a> </span>============================================================== <span><a name="308" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#308"  >308</a> </span> <span><a name="309" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#309"  >309</a> </span>memory_failure_recovery <span><a name="310" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#310"  >310</a> </span> <span><a name="311" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#311"  >311</a> </span>Enable memory failure recovery (when supported by the platform) <span><a name="312" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#312"  >312</a> </span> <span><a name="313" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#313"  >313</a> </span>1: Attempt recovery. <span><a name="314" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#314"  >314</a> </span> <span><a name="315" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#315"  >315</a> </span>0: Always panic on a memory failure. <span><a name="316" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#316"  >316</a> </span> <span><a name="317" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#317"  >317</a> </span>============================================================== <span><a name="318" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#318"  >318</a> </span> <span><a name="319" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#319"  >319</a> </span>min_free_kbytes: <span><a name="320" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#320"  >320</a> </span> <span><a name="321" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#321"  >321</a> </span>This is used to force the Linux VM to keep a minimum number <span><a name="322" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#322"  >322</a> </span>of kilobytes free.  The VM uses this number to compute a <span><a name="323" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#323"  >323</a> </span>watermark[WMARK_MIN] value for each lowmem zone in the system. <span><a name="324" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#324"  >324</a> </span>Each lowmem zone gets a number of reserved free pages based <span><a name="325" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#325"  >325</a> </span>proportionally on its size. <span><a name="326" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#326"  >326</a> </span> <span><a name="327" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#327"  >327</a> </span>Some minimal amount of memory is needed to satisfy PF_MEMALLOC <span><a name="328" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#328"  >328</a> </span>allocations; if you set this to lower than 1024KB, your system will <span><a name="329" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#329"  >329</a> </span>become subtly broken, and prone to deadlock under high loads. <span><a name="330" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#330"  >330</a> </span> <span><a name="331" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#331"  >331</a> </span>Setting this too high will OOM your machine instantly. <span><a name="332" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#332"  >332</a> </span> <span><a name="333" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#333"  >333</a> </span>============================================================= <span><a name="334" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#334"  >334</a> </span> <span><a name="335" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#335"  >335</a> </span>min_slab_ratio: <span><a name="336" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#336"  >336</a> </span> <span><a name="337" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#337"  >337</a> </span>This is available only on NUMA kernels. <span><a name="338" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#338"  >338</a> </span> <span><a name="339" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#339"  >339</a> </span>A percentage of the total pages in each zone.  On Zone reclaim <span><a name="340" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#340"  >340</a> </span>(fallback from the local zone occurs) slabs will be reclaimed if more <span><a name="341" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#341"  >341</a> </span>than this percentage of pages in a zone are reclaimable slab pages. <span><a name="342" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#342"  >342</a> </span>This insures that the slab growth stays under control even in NUMA <span><a name="343" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#343"  >343</a> </span>systems that rarely perform global reclaim. <span><a name="344" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#344"  >344</a> </span> <span><a name="345" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#345"  >345</a> </span>The default is 5 percent. <span><a name="346" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#346"  >346</a> </span> <span><a name="347" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#347"  >347</a> </span>Note that slab reclaim is triggered in a per zone / node fashion. <span><a name="348" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#348"  >348</a> </span>The process of reclaiming slab memory is currently not node specific <span><a name="349" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#349"  >349</a> </span>and may not be fast. <span><a name="350" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#350"  >350</a> </span> <span><a name="351" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#351"  >351</a> </span>============================================================= <span><a name="352" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#352"  >352</a> </span> <span><a name="353" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#353"  >353</a> </span>min_unmapped_ratio: <span><a name="354" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#354"  >354</a> </span> <span><a name="355" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#355"  >355</a> </span>This is available only on NUMA kernels. <span><a name="356" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#356"  >356</a> </span> <span><a name="357" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#357"  >357</a> </span>This is a percentage of the total pages in each zone. Zone reclaim will <span><a name="358" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#358"  >358</a> </span>only occur if more than this percentage of pages are in a state that <span><a name="359" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#359"  >359</a> </span>zone_reclaim_mode allows to be reclaimed. <span><a name="360" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#360"  >360</a> </span> <span><a name="361" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#361"  >361</a> </span>If zone_reclaim_mode has the value 4 OR'd, then the percentage is compared <span><a name="362" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#362"  >362</a> </span>against all file-backed unmapped pages including swapcache pages and tmpfs <span><a name="363" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#363"  >363</a> </span>files. Otherwise, only unmapped pages backed by normal files but not tmpfs <span><a name="364" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#364"  >364</a> </span>files and similar are considered. <span><a name="365" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#365"  >365</a> </span> <span><a name="366" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#366"  >366</a> </span>The default is 1 percent. <span><a name="367" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#367"  >367</a> </span> <span><a name="368" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#368"  >368</a> </span>============================================================== <span><a name="369" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#369"  >369</a> </span> <span><a name="370" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#370"  >370</a> </span>mmap_min_addr <span><a name="371" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#371"  >371</a> </span> <span><a name="372" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#372"  >372</a> </span>This file indicates the amount of address space  which a user process will <span><a name="373" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#373"  >373</a> </span>be restricted from mmapping.  Since kernel null dereference bugs could <span><a name="374" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#374"  >374</a> </span>accidentally operate based on the information in the first couple of pages <span><a name="375" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#375"  >375</a> </span>of memory userspace processes should not be allowed to write to them.  By <span><a name="376" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#376"  >376</a> </span>default this value is set to 0 and no protections will be enforced by the <span><a name="377" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#377"  >377</a> </span>security module.  Setting this value to something like 64k will allow the <span><a name="378" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#378"  >378</a> </span>vast majority of applications to work correctly and provide defense in depth <span><a name="379" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#379"  >379</a> </span>against future potential kernel bugs. <span><a name="380" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#380"  >380</a> </span> <span><a name="381" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#381"  >381</a> </span>============================================================== <span><a name="382" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#382"  >382</a> </span> <span><a name="383" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#383"  >383</a> </span>nr_hugepages <span><a name="384" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#384"  >384</a> </span> <span><a name="385" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#385"  >385</a> </span>Change the minimum size of the hugepage pool. <span><a name="386" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#386"  >386</a> </span> <span><a name="387" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#387"  >387</a> </span>See Documentation/vm/hugetlbpage.txt <span><a name="388" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#388"  >388</a> </span> <span><a name="389" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#389"  >389</a> </span>============================================================== <span><a name="390" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#390"  >390</a> </span> <span><a name="391" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#391"  >391</a> </span>nr_overcommit_hugepages <span><a name="392" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#392"  >392</a> </span> <span><a name="393" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#393"  >393</a> </span>Change the maximum size of the hugepage pool. The maximum is <span><a name="394" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#394"  >394</a> </span>nr_hugepages + nr_overcommit_hugepages. <span><a name="395" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#395"  >395</a> </span> <span><a name="396" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#396"  >396</a> </span>See Documentation/vm/hugetlbpage.txt <span><a name="397" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#397"  >397</a> </span> <span><a name="398" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#398"  >398</a> </span>============================================================== <span><a name="399" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#399"  >399</a> </span> <span><a name="400" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#400"  >400</a> </span>nr_pdflush_threads <span><a name="401" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#401"  >401</a> </span> <span><a name="402" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#402"  >402</a> </span>The current number of pdflush threads.  This value is read-only. <span><a name="403" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#403"  >403</a> </span>The value changes according to the number of dirty pages in the system. <span><a name="404" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#404"  >404</a> </span> <span><a name="405" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#405"  >405</a> </span>When necessary, additional pdflush threads are created, one per second, up to <span><a name="406" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#406"  >406</a> </span>nr_pdflush_threads_max. <span><a name="407" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#407"  >407</a> </span> <span><a name="408" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#408"  >408</a> </span>============================================================== <span><a name="409" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#409"  >409</a> </span> <span><a name="410" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#410"  >410</a> </span>nr_trim_pages <span><a name="411" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#411"  >411</a> </span> <span><a name="412" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#412"  >412</a> </span>This is available only on NOMMU kernels. <span><a name="413" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#413"  >413</a> </span> <span><a name="414" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#414"  >414</a> </span>This value adjusts the excess page trimming behaviour of power-of-2 aligned <span><a name="415" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#415"  >415</a> </span>NOMMU mmap allocations. <span><a name="416" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#416"  >416</a> </span> <span><a name="417" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#417"  >417</a> </span>A value of 0 disables trimming of allocations entirely, while a value of 1 <span><a name="418" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#418"  >418</a> </span>trims excess pages aggressively. Any value &gt;= 1 acts as the watermark where <span><a name="419" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#419"  >419</a> </span>trimming of allocations is initiated. <span><a name="420" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#420"  >420</a> </span> <span><a name="421" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#421"  >421</a> </span>The default value is 1. <span><a name="422" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#422"  >422</a> </span> <span><a name="423" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#423"  >423</a> </span>See Documentation/nommu-mmap.txt for more information. <span><a name="424" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#424"  >424</a> </span> <span><a name="425" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#425"  >425</a> </span>============================================================== <span><a name="426" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#426"  >426</a> </span> <span><a name="427" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#427"  >427</a> </span>numa_zonelist_order <span><a name="428" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#428"  >428</a> </span> <span><a name="429" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#429"  >429</a> </span>This sysctl is only for NUMA. <span><a name="430" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#430"  >430</a> </span>'where the memory is allocated from' is controlled by zonelists. <span><a name="431" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#431"  >431</a> </span>(This documentation ignores ZONE_HIGHMEM/ZONE_DMA32 for simple explanation. <span><a name="432" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#432"  >432</a> </span> you may be able to read ZONE_DMA as ZONE_DMA32...) <span><a name="433" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#433"  >433</a> </span> <span><a name="434" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#434"  >434</a> </span>In non-NUMA case, a zonelist for GFP_KERNEL is ordered as following. <span><a name="435" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#435"  >435</a> </span>ZONE_NORMAL -&gt; ZONE_DMA <span><a name="436" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#436"  >436</a> </span>This means that a memory allocation request for GFP_KERNEL will <span><a name="437" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#437"  >437</a> </span>get memory from ZONE_DMA only when ZONE_NORMAL is not available. <span><a name="438" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#438"  >438</a> </span> <span><a name="439" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#439"  >439</a> </span>In NUMA case, you can think of following 2 types of order. <span><a name="440" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#440"  >440</a> </span>Assume 2 node NUMA and below is zonelist of Node(0)'s GFP_KERNEL <span><a name="441" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#441"  >441</a> </span> <span><a name="442" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#442"  >442</a> </span>(A) Node(0) ZONE_NORMAL -&gt; Node(0) ZONE_DMA -&gt; Node(1) ZONE_NORMAL <span><a name="443" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#443"  >443</a> </span>(B) Node(0) ZONE_NORMAL -&gt; Node(1) ZONE_NORMAL -&gt; Node(0) ZONE_DMA. <span><a name="444" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#444"  >444</a> </span> <span><a name="445" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#445"  >445</a> </span>Type(A) offers the best locality for processes on Node(0), but ZONE_DMA <span><a name="446" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#446"  >446</a> </span>will be used before ZONE_NORMAL exhaustion. This increases possibility of <span><a name="447" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#447"  >447</a> </span>out-of-memory(OOM) of ZONE_DMA because ZONE_DMA is tend to be small. <span><a name="448" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#448"  >448</a> </span> <span><a name="449" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#449"  >449</a> </span>Type(B) cannot offer the best locality but is more robust against OOM of <span><a name="450" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#450"  >450</a> </span>the DMA zone. <span><a name="451" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#451"  >451</a> </span> <span><a name="452" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#452"  >452</a> </span>Type(A) is called as "Node" order. Type (B) is "Zone" order. <span><a name="453" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#453"  >453</a> </span> <span><a name="454" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#454"  >454</a> </span>"Node order" orders the zonelists by node, then by zone within each node. <span><a name="455" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#455"  >455</a> </span>Specify "[Nn]ode" for zone order <span><a name="456" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#456"  >456</a> </span> <span><a name="457" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#457"  >457</a> </span>"Zone Order" orders the zonelists by zone type, then by node within each <span><a name="458" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#458"  >458</a> </span>zone.  Specify "[Zz]one"for zode order. <span><a name="459" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#459"  >459</a> </span> <span><a name="460" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#460"  >460</a> </span>Specify "[Dd]efault" to request automatic configuration.  Autoconfiguration <span><a name="461" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#461"  >461</a> </span>will select "node" order in following case. <span><a name="462" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#462"  >462</a> </span>(1) if the DMA zone does not exist or <span><a name="463" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#463"  >463</a> </span>(2) if the DMA zone comprises greater than 50% of the available memory or <span><a name="464" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#464"  >464</a> </span>(3) if any node's DMA zone comprises greater than 60% of its local memory and <span><a name="465" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#465"  >465</a> </span>    the amount of local memory is big enough. <span><a name="466" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#466"  >466</a> </span> <span><a name="467" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#467"  >467</a> </span>Otherwise, "zone" order will be selected. Default order is recommended unless <span><a name="468" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#468"  >468</a> </span>this is causing problems for your system/application. <span><a name="469" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#469"  >469</a> </span> <span><a name="470" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#470"  >470</a> </span>============================================================== <span><a name="471" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#471"  >471</a> </span> <span><a name="472" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#472"  >472</a> </span>oom_dump_tasks <span><a name="473" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#473"  >473</a> </span> <span><a name="474" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#474"  >474</a> </span>Enables a system-wide task dump (excluding kernel threads) to be <span><a name="475" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#475"  >475</a> </span>produced when the kernel performs an OOM-killing and includes such <span><a name="476" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#476"  >476</a> </span>information as pid, uid, tgid, vm size, rss, cpu, oom_adj score, and <span><a name="477" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#477"  >477</a> </span>name.  This is helpful to determine why the OOM killer was invoked <span><a name="478" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#478"  >478</a> </span>and to identify the rogue task that caused it. <span><a name="479" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#479"  >479</a> </span> <span><a name="480" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#480"  >480</a> </span>If this is set to zero, this information is suppressed.  On very <span><a name="481" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#481"  >481</a> </span>large systems with thousands of tasks it may not be feasible to dump <span><a name="482" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#482"  >482</a> </span>the memory state information for each one.  Such systems should not <span><a name="483" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#483"  >483</a> </span>be forced to incur a performance penalty in OOM conditions when the <span><a name="484" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#484"  >484</a> </span>information may not be desired. <span><a name="485" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#485"  >485</a> </span> <span><a name="486" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#486"  >486</a> </span>If this is set to non-zero, this information is shown whenever the <span><a name="487" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#487"  >487</a> </span>OOM killer actually kills a memory-hogging task. <span><a name="488" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#488"  >488</a> </span> <span><a name="489" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#489"  >489</a> </span>The default value is 0. <span><a name="490" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#490"  >490</a> </span> <span><a name="491" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#491"  >491</a> </span>============================================================== <span><a name="492" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#492"  >492</a> </span> <span><a name="493" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#493"  >493</a> </span>oom_kill_allocating_task <span><a name="494" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#494"  >494</a> </span> <span><a name="495" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#495"  >495</a> </span>This enables or disables killing the OOM-triggering task in <span><a name="496" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#496"  >496</a> </span>out-of-memory situations. <span><a name="497" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#497"  >497</a> </span> <span><a name="498" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#498"  >498</a> </span>If this is set to zero, the OOM killer will scan through the entire <span><a name="499" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#499"  >499</a> </span>tasklist and select a task based on heuristics to kill.  This normally <span><a name="500" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#500"  >500</a> </span>selects a rogue memory-hogging task that frees up a large amount of <span><a name="501" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#501"  >501</a> </span>memory when killed. <span><a name="502" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#502"  >502</a> </span> <span><a name="503" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#503"  >503</a> </span>If this is set to non-zero, the OOM killer simply kills the task that <span><a name="504" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#504"  >504</a> </span>triggered the out-of-memory condition.  This avoids the expensive <span><a name="505" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#505"  >505</a> </span>tasklist scan. <span><a name="506" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#506"  >506</a> </span> <span><a name="507" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#507"  >507</a> </span>If panic_on_oom is selected, it takes precedence over whatever value <span><a name="508" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#508"  >508</a> </span>is used in oom_kill_allocating_task. <span><a name="509" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#509"  >509</a> </span> <span><a name="510" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#510"  >510</a> </span>The default value is 0. <span><a name="511" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#511"  >511</a> </span> <span><a name="512" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#512"  >512</a> </span>============================================================== <span><a name="513" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#513"  >513</a> </span> <span><a name="514" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#514"  >514</a> </span>overcommit_memory: <span><a name="515" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#515"  >515</a> </span> <span><a name="516" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#516"  >516</a> </span>This value contains a flag that enables memory overcommitment. <span><a name="517" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#517"  >517</a> </span> <span><a name="518" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#518"  >518</a> </span>When this flag is 0, the kernel attempts to estimate the amount <span><a name="519" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#519"  >519</a> </span>of free memory left when userspace requests more memory. <span><a name="520" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#520"  >520</a> </span> <span><a name="521" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#521"  >521</a> </span>When this flag is 1, the kernel pretends there is always enough <span><a name="522" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#522"  >522</a> </span>memory until it actually runs out. <span><a name="523" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#523"  >523</a> </span> <span><a name="524" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#524"  >524</a> </span>When this flag is 2, the kernel uses a "never overcommit" <span><a name="525" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#525"  >525</a> </span>policy that attempts to prevent any overcommit of memory. <span><a name="526" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#526"  >526</a> </span> <span><a name="527" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#527"  >527</a> </span>This feature can be very useful because there are a lot of <span><a name="528" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#528"  >528</a> </span>programs that malloc() huge amounts of memory "just-in-case" <span><a name="529" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#529"  >529</a> </span>and don't use much of it. <span><a name="530" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#530"  >530</a> </span> <span><a name="531" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#531"  >531</a> </span>The default value is 0. <span><a name="532" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#532"  >532</a> </span> <span><a name="533" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#533"  >533</a> </span>See Documentation/vm/overcommit-accounting and <span><a name="534" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#534"  >534</a> </span>security/commoncap.c::cap_vm_enough_memory() for more information. <span><a name="535" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#535"  >535</a> </span> <span><a name="536" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#536"  >536</a> </span>============================================================== <span><a name="537" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#537"  >537</a> </span> <span><a name="538" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#538"  >538</a> </span>overcommit_ratio: <span><a name="539" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#539"  >539</a> </span> <span><a name="540" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#540"  >540</a> </span>When overcommit_memory is set to 2, the committed address <span><a name="541" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#541"  >541</a> </span>space is not permitted to exceed swap plus this percentage <span><a name="542" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#542"  >542</a> </span>of physical RAM.  See above. <span><a name="543" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#543"  >543</a> </span> <span><a name="544" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#544"  >544</a> </span>============================================================== <span><a name="545" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#545"  >545</a> </span> <span><a name="546" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#546"  >546</a> </span>page-cluster <span><a name="547" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#547"  >547</a> </span> <span><a name="548" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#548"  >548</a> </span>page-cluster controls the number of pages which are written to swap in <span><a name="549" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#549"  >549</a> </span>a single attempt.  The swap I/O size. <span><a name="550" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#550"  >550</a> </span> <span><a name="551" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#551"  >551</a> </span>It is a logarithmic value - setting it to zero means "1 page", setting <span><a name="552" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#552"  >552</a> </span>it to 1 means "2 pages", setting it to 2 means "4 pages", etc. <span><a name="553" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#553"  >553</a> </span> <span><a name="554" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#554"  >554</a> </span>The default value is three (eight pages at a time).  There may be some <span><a name="555" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#555"  >555</a> </span>small benefits in tuning this to a different value if your workload is <span><a name="556" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#556"  >556</a> </span>swap-intensive. <span><a name="557" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#557"  >557</a> </span> <span><a name="558" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#558"  >558</a> </span>============================================================= <span><a name="559" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#559"  >559</a> </span> <span><a name="560" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#560"  >560</a> </span>panic_on_oom <span><a name="561" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#561"  >561</a> </span> <span><a name="562" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#562"  >562</a> </span>This enables or disables panic on out-of-memory feature. <span><a name="563" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#563"  >563</a> </span> <span><a name="564" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#564"  >564</a> </span>If this is set to 0, the kernel will kill some rogue process, <span><a name="565" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#565"  >565</a> </span>called oom_killer.  Usually, oom_killer can kill rogue processes and <span><a name="566" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#566"  >566</a> </span>system will survive. <span><a name="567" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#567"  >567</a> </span> <span><a name="568" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#568"  >568</a> </span>If this is set to 1, the kernel panics when out-of-memory happens. <span><a name="569" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#569"  >569</a> </span>However, if a process limits using nodes by mempolicy/cpusets, <span><a name="570" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#570"  >570</a> </span>and those nodes become memory exhaustion status, one process <span><a name="571" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#571"  >571</a> </span>may be killed by oom-killer. No panic occurs in this case. <span><a name="572" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#572"  >572</a> </span>Because other nodes' memory may be free. This means system total status <span><a name="573" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#573"  >573</a> </span>may be not fatal yet. <span><a name="574" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#574"  >574</a> </span> <span><a name="575" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#575"  >575</a> </span>If this is set to 2, the kernel panics compulsorily even on the <span><a name="576" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#576"  >576</a> </span>above-mentioned. Even oom happens under memory cgroup, the whole <span><a name="577" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#577"  >577</a> </span>system panics. <span><a name="578" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#578"  >578</a> </span> <span><a name="579" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#579"  >579</a> </span>The default value is 0. <span><a name="580" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#580"  >580</a> </span>1 and 2 are for failover of clustering. Please select either <span><a name="581" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#581"  >581</a> </span>according to your policy of failover. <span><a name="582" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#582"  >582</a> </span>panic_on_oom=2+kdump gives you very strong tool to investigate <span><a name="583" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#583"  >583</a> </span>why oom happens. You can get snapshot. <span><a name="584" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#584"  >584</a> </span> <span><a name="585" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#585"  >585</a> </span>============================================================= <span><a name="586" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#586"  >586</a> </span> <span><a name="587" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#587"  >587</a> </span>percpu_pagelist_fraction <span><a name="588" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#588"  >588</a> </span> <span><a name="589" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#589"  >589</a> </span>This is the fraction of pages at most (high mark pcp-&gt;high) in each zone that <span><a name="590" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#590"  >590</a> </span>are allocated for each per cpu page list.  The min value for this is 8.  It <span><a name="591" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#591"  >591</a> </span>means that we don't allow more than 1/8th of pages in each zone to be <span><a name="592" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#592"  >592</a> </span>allocated in any single per_cpu_pagelist.  This entry only changes the value <span><a name="593" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#593"  >593</a> </span>of hot per cpu pagelists.  User can specify a number like 100 to allocate <span><a name="594" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#594"  >594</a> </span>1/100th of each zone to each per cpu page list. <span><a name="595" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#595"  >595</a> </span> <span><a name="596" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#596"  >596</a> </span>The batch value of each per cpu pagelist is also updated as a result.  It is <span><a name="597" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#597"  >597</a> </span>set to pcp-&gt;high/4.  The upper limit of batch is (PAGE_SHIFT * 8) <span><a name="598" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#598"  >598</a> </span> <span><a name="599" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#599"  >599</a> </span>The initial value is zero.  Kernel does not use this value at boot time to set <span><a name="600" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#600"  >600</a> </span>the high water marks for each per cpu page list. <span><a name="601" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#601"  >601</a> </span> <span><a name="602" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#602"  >602</a> </span>============================================================== <span><a name="603" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#603"  >603</a> </span> <span><a name="604" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#604"  >604</a> </span>stat_interval <span><a name="605" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#605"  >605</a> </span> <span><a name="606" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#606"  >606</a> </span>The time interval between which vm statistics are updated.  The default <span><a name="607" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#607"  >607</a> </span>is 1 second. <span><a name="608" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#608"  >608</a> </span> <span><a name="609" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#609"  >609</a> </span>============================================================== <span><a name="610" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#610"  >610</a> </span> <span><a name="611" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#611"  >611</a> </span>swappiness <span><a name="612" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#612"  >612</a> </span> <span><a name="613" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#613"  >613</a> </span>This control is used to define how aggressive the kernel will swap <span><a name="614" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#614"  >614</a> </span>memory pages.  Higher values will increase agressiveness, lower values <span><a name="615" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#615"  >615</a> </span>decrease the amount of swap. <span><a name="616" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#616"  >616</a> </span> <span><a name="617" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#617"  >617</a> </span>The default value is 60. <span><a name="618" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#618"  >618</a> </span> <span><a name="619" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#619"  >619</a> </span>============================================================== <span><a name="620" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#620"  >620</a> </span> <span><a name="621" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#621"  >621</a> </span>vfs_cache_pressure <span><a name="622" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#622"  >622</a> </span>------------------ <span><a name="623" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#623"  >623</a> </span> <span><a name="624" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#624"  >624</a> </span>Controls the tendency of the kernel to reclaim the memory which is used for <span><a name="625" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#625"  >625</a> </span>caching of directory and inode objects. <span><a name="626" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#626"  >626</a> </span> <span><a name="627" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#627"  >627</a> </span>At the default value of vfs_cache_pressure=100 the kernel will attempt to <span><a name="628" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#628"  >628</a> </span>reclaim dentries and inodes at a "fair" rate with respect to pagecache and <span><a name="629" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#629"  >629</a> </span>swapcache reclaim.  Decreasing vfs_cache_pressure causes the kernel to prefer <span><a name="630" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#630"  >630</a> </span>to retain dentry and inode caches. When vfs_cache_pressure=0, the kernel will <span><a name="631" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#631"  >631</a> </span>never reclaim dentries and inodes due to memory pressure and this can easily <span><a name="632" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#632"  >632</a> </span>lead to out-of-memory conditions. Increasing vfs_cache_pressure beyond 100 <span><a name="633" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#633"  >633</a> </span>causes the kernel to prefer to reclaim dentries and inodes. <span><a name="634" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#634"  >634</a> </span> <span><a name="635" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#635"  >635</a> </span>============================================================== <span><a name="636" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#636"  >636</a> </span> <span><a name="637" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#637"  >637</a> </span>zone_reclaim_mode: <span><a name="638" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#638"  >638</a> </span> <span><a name="639" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#639"  >639</a> </span>Zone_reclaim_mode allows someone to set more or less aggressive approaches to <span><a name="640" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#640"  >640</a> </span>reclaim memory when a zone runs out of memory. If it is set to zero then no <span><a name="641" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#641"  >641</a> </span>zone reclaim occurs. Allocations will be satisfied from other zones / nodes <span><a name="642" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#642"  >642</a> </span>in the system. <span><a name="643" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#643"  >643</a> </span> <span><a name="644" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#644"  >644</a> </span>This is value ORed together of <span><a name="645" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#645"  >645</a> </span> <span><a name="646" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#646"  >646</a> </span>1 = Zone reclaim on <span><a name="647" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#647"  >647</a> </span>2 = Zone reclaim writes dirty pages out <span><a name="648" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#648"  >648</a> </span>4 = Zone reclaim swaps pages <span><a name="649" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#649"  >649</a> </span> <span><a name="650" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#650"  >650</a> </span>zone_reclaim_mode is set during bootup to 1 if it is determined that pages <span><a name="651" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#651"  >651</a> </span>from remote zones will cause a measurable performance reduction. The <span><a name="652" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#652"  >652</a> </span>page allocator will then reclaim easily reusable pages (those page <span><a name="653" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#653"  >653</a> </span>cache pages that are currently not used) before allocating off node pages. <span><a name="654" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#654"  >654</a> </span> <span><a name="655" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#655"  >655</a> </span>It may be beneficial to switch off zone reclaim if the system is <span><a name="656" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#656"  >656</a> </span>used for a file server and all of memory should be used for caching files <span><a name="657" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#657"  >657</a> </span>from disk. In that case the caching effect is more important than <span><a name="658" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#658"  >658</a> </span>data locality. <span><a name="659" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#659"  >659</a> </span> <span><a name="660" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#660"  >660</a> </span>Allowing zone reclaim to write out pages stops processes that are <span><a name="661" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#661"  >661</a> </span>writing large amounts of data from dirtying pages on other nodes. Zone <span><a name="662" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#662"  >662</a> </span>reclaim will write out dirty pages if a zone fills up and so effectively <span><a name="663" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#663"  >663</a> </span>throttle the process. This may decrease the performance of a single process <span><a name="664" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#664"  >664</a> </span>since it cannot use all of system memory to buffer the outgoing writes <span><a name="665" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#665"  >665</a> </span>anymore but it preserve the memory on other nodes so that the performance <span><a name="666" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#666"  >666</a> </span>of other processes running on other nodes will not be affected. <span><a name="667" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#667"  >667</a> </span> <span><a name="668" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#668"  >668</a> </span>Allowing regular swap effectively restricts allocations to the local <span><a name="669" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#669"  >669</a> </span>node unless explicitly overridden by memory policies or cpuset <span><a name="670" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#670"  >670</a> </span>configurations. <span><a name="671" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#671"  >671</a> </span> <span><a name="672" rel="nofollow" href="http://www.mjmwired.net/kernel/Documentation/sysctl/vm.txt#672"  >672</a> </span>============ End of Document =================================</pre></span></div></div>
	</div>
</div>
</body>
</html>