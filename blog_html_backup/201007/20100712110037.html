<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Brocade Access Gateway Port Group Failover and Failback Test</h2>
	<h5 id="">2010-07-12 11:00:37&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201061211037781/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>首先对概念搞清楚：</div><div>1. 默认PG所有的Nport必须连接到同一个fabirc.</div><div>2. 手工PG所有的Nport必须连接到不同的fabric.</div><div><br></div><div>测试环境:</div><div>server</div><div>\|/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\|/</div><div>Edge AG1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Edge AG2</div><div>\|/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\|/</div><div>Core AG1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Core AG2</div><div>\|/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\|/</div><div>Fabric1 FCSW &nbsp; Fabric2 FCSW</div><div>\|/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\|/</div><div>Storage1-port1 &nbsp;Storage1-port2</div><div><br></div><div>在服务器端配置MultiPath(failover模式),不过这个和本次测试无关。只测试一个通道。</div><div><br></div><div>PG failover测试:&nbsp;</div><div>断开任意AG交换机的与服务器镜像的NPORT，发生如下情况。</div><div><div>ag --mapshow</div><div>N_Port &nbsp;Configured_F_Ports &nbsp; &nbsp; &nbsp;Current_F_Ports Failover Failback PG_ID PG_Name</div><div>--------------------------------------------------------------------------------</div><div>&nbsp;&nbsp;16 &nbsp; &nbsp;0;8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; None &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;17 &nbsp; &nbsp;1;9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;18 &nbsp; &nbsp;2;10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;19 &nbsp; &nbsp;3;11 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;20 &nbsp; &nbsp;4;12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;21 &nbsp; &nbsp;5;13 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;22 &nbsp; &nbsp;6;14 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0;6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;23 &nbsp; &nbsp;7;15 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>--------------------------------------------------------------------------------</div></div><div>服务器端vmstat输出</div><div>&nbsp;1 &nbsp;2 340576 &nbsp;73976 100576 23023784 &nbsp; &nbsp;0 &nbsp; &nbsp;0 &nbsp; &nbsp; 0 215824 1500 1311 &nbsp;0 &nbsp;5 76 19 &nbsp;0</div><div>&nbsp;1 &nbsp;3 340576 &nbsp;72064 100660 23027260 &nbsp; &nbsp;0 &nbsp; &nbsp;0 &nbsp; &nbsp; 0 43776 1149 1317 &nbsp;0 &nbsp;1 75 24 &nbsp;0</div><div>&nbsp;0 &nbsp;3 340576 &nbsp;71020 100712 23027888 &nbsp; &nbsp;0 &nbsp; &nbsp;0 &nbsp; &nbsp; 0 57708 1164 1267 &nbsp;0 &nbsp;1 75 24 &nbsp;0</div><div>&nbsp;0 &nbsp;4 340576 &nbsp;71240 &nbsp;66252 23059848 &nbsp; &nbsp;0 &nbsp;152 &nbsp; &nbsp; 0 340736 1818 1514 &nbsp;0 &nbsp;9 70 21 &nbsp;0</div><div>&nbsp;0 &nbsp;4 340576 &nbsp;72192 &nbsp;66472 23057688 &nbsp; &nbsp;0 &nbsp; &nbsp;0 &nbsp; &nbsp; 0 224988 1505 1311 &nbsp;0 &nbsp;6 61 33 &nbsp;0</div></div><div><br></div><div><br></div><div><br></div><div>PG failback测试:</div><div>将链路回复，发生如下情况：</div><div>ag --mapshow</div><div><div>N_Port &nbsp;Configured_F_Ports &nbsp; &nbsp; &nbsp;Current_F_Ports Failover Failback PG_ID PG_Name</div><div>--------------------------------------------------------------------------------</div><div>&nbsp;&nbsp;16 &nbsp; &nbsp;0;8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;17 &nbsp; &nbsp;1;9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;18 &nbsp; &nbsp;2;10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;19 &nbsp; &nbsp;3;11 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;20 &nbsp; &nbsp;4;12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;21 &nbsp; &nbsp;5;13 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;22 &nbsp; &nbsp;6;14 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>&nbsp;&nbsp;23 &nbsp; &nbsp;7;15 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp;pg0</div><div>--------------------------------------------------------------------------------</div></div><div>服务器端vmstat输出</div><div>&nbsp;0 &nbsp;6 340576 &nbsp;75152 &nbsp;71416 23051316 &nbsp; &nbsp;0 &nbsp; &nbsp;0 &nbsp; &nbsp; 0 231668 1483 1366 &nbsp;0 &nbsp;6 56 38 &nbsp;0</div><div>&nbsp;0 &nbsp;6 340576 &nbsp;70488 &nbsp;71572 23055720 &nbsp; &nbsp;0 &nbsp; &nbsp;0 &nbsp; &nbsp; 0 146608 1378 1320 &nbsp;0 &nbsp;4 50 46 &nbsp;0</div><div>&nbsp;0 &nbsp;6 340576 &nbsp;70664 &nbsp;71572 23055896 &nbsp; &nbsp;0 &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 1009 1206 &nbsp;0 &nbsp;0 50 50 &nbsp;0</div><div>&nbsp;2 &nbsp;9 340576 &nbsp;76476 &nbsp;71812 23048960 &nbsp; &nbsp;0 &nbsp; &nbsp;0 &nbsp; &nbsp; 0 225128 1560 1587 &nbsp;0 &nbsp;6 59 34 &nbsp;0</div><div><br></div><div><br></div><div><br></div><div><div>经测试Nport的failover和failback在2秒左右可以搞定.</div></div></div>
	</div>
</div>
</body>
</html>