<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">OProfile & Systemtap</h2>
	<h5 id="">2015-05-09 15:02:59&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201549115140794/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div style="box-sizing: border-box; widows: 4; orphans: 4; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; font-stretch: inherit; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="color: rgb(26, 26, 26); font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; font-size: 15.3999996185303px; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   >Oprofile性能损耗小，如果CPU支持硬件监控的话（现在大多数CPU已经支持）。但是Oprofile不能像stap样使用timer来间断输出或累计输出统计，STAP损耗较大。<span style="line-height: 26.9500007629395px; font-size: 15.3999996185303px;"   >Oprofile 适合做性能诊断，例如系统中最耗CPU的进程，进程中哪些函数是比较耗CPU的，函数中哪段代码是最耗CPU的。。。</span><span style="line-height: 26.9500007629395px; font-size: 15.3999996185303px;"   >operf开启监控, opreport, opannotate可以输出调用报告，或函数、汇编指令等统计情况。</span><span style="line-height: 26.9500007629395px; font-size: 15.3999996185303px;"   >Stap 适合做跟踪。</span><span style="line-height: 26.9500007629395px; font-size: 15.3999996185303px;"   >例子 :&nbsp;</span></div><div style="color: rgb(26, 26, 26); font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><pre class="prettyprint"   ><p></p><div style="font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >[root@digoal ~]# cd /data06</font></div><div style="font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >[root@digoal data06]# &nbsp;operf --system-wide --lazy-conversion</font></div><div style="font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >operf: Press Ctl-c or 'kill -SIGINT 45366' to stop profiling</font></div><div style="font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >operf: Profiler started</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >^C</font></div><div style="font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >Profiling done.</font></div><div style="font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >Converting profile data to OProfile format</font></div><div style="font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >................</font></div></div><p></p></pre></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="color: rgb(26, 26, 26); font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; font-size: 15.3999996185303px; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   >输出报告：</div><div style="color: rgb(26, 26, 26); font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><pre class="prettyprint"   ><p></p><div style="font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >[root@digoal data06]# opreport -l -f -w -x -t 1&nbsp;</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >Using /data06/oprofile_data/samples/ for samples directory.</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >CPU: Intel Core/i7, speed 1995.14 MHz (estimated)</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >Counted CPU_CLK_UNHALTED events (Clock cycles when not halted) with a unit mask of 0x00 (No unit mask) count 100000</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >vma &nbsp; &nbsp; &nbsp;samples &nbsp;% &nbsp; &nbsp; &nbsp; &nbsp;app name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; symbol name</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >007827a0 2091381 &nbsp;26.6819 &nbsp;/opt/pgsql9.4.1/bin/postgres HeapTupleSatisfiesVacuum</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >00490300 988600 &nbsp; 12.6126 &nbsp;/opt/pgsql9.4.1/bin/postgres heap_page_prune</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >0078a8c0 698665 &nbsp; &nbsp;8.9136 &nbsp;/opt/pgsql9.4.1/bin/postgres pg_qsort</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >0058afb0 676022 &nbsp; &nbsp;8.6247 &nbsp;/opt/pgsql9.4.1/bin/postgres vac_cmp_itemptr</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >0058baf0 385039 &nbsp; &nbsp;4.9123 &nbsp;/opt/pgsql9.4.1/bin/postgres lazy_vacuum_rel</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >004c4d00 365497 &nbsp; &nbsp;4.6630 &nbsp;/opt/pgsql9.4.1/bin/postgres XLogInsert</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >00675420 229805 &nbsp; &nbsp;2.9319 &nbsp;/opt/pgsql9.4.1/bin/postgres itemoffcompare</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >00675d20 184668 &nbsp; &nbsp;2.3560 &nbsp;/opt/pgsql9.4.1/bin/postgres PageRepairFragmentation</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >0078a7e0 169808 &nbsp; &nbsp;2.1664 &nbsp;/opt/pgsql9.4.1/bin/postgres swapfunc</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >00655590 147647 &nbsp; &nbsp;1.8837 &nbsp;/opt/pgsql9.4.1/bin/postgres BufferGetBlockNumber</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >00488940 139389 &nbsp; &nbsp;1.7783 &nbsp;/opt/pgsql9.4.1/bin/postgres heap_prepare_freeze_tuple</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >007624d0 86239 &nbsp; &nbsp; 1.1002 &nbsp;/opt/pgsql9.4.1/bin/postgres hash_search_with_hash_value</font></div><div style="line-height: 25.2000007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   ><br></font></div></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >[root@digoal data06]# opreport -l -f -g -w -x -t 1 /opt/pgsql/bin/postgres</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >Using /data06/oprofile_data/samples/ for samples directory.</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >CPU: Intel Core/i7, speed 1995.14 MHz (estimated)</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >Counted CPU_CLK_UNHALTED events (Clock cycles when not halted) with a unit mask of 0x00 (No unit mask) count 100000</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >vma &nbsp; &nbsp; &nbsp;samples &nbsp;% &nbsp; &nbsp; &nbsp; &nbsp;linenr info &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; symbol name</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >007827a0 2091381 &nbsp;26.7572 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/backend/utils/time/tqual.c:1116 HeapTupleSatisfiesVacuum</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >00490300 988600 &nbsp; 12.6482 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/backend/access/heap/pruneheap.c:174 heap_page_prune</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >0078a8c0 698665 &nbsp; &nbsp;8.9387 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/port/qsort.c:104 pg_qsort</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >0058afb0 676022 &nbsp; &nbsp;8.6491 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/backend/commands/vacuumlazy.c:1728 vac_cmp_itemptr</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >0058baf0 385039 &nbsp; &nbsp;4.9262 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/backend/commands/vacuumlazy.c:172 lazy_vacuum_rel</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >004c4d00 365497 &nbsp; &nbsp;4.6762 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/backend/access/transam/xlog.c:844 XLogInsert</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >00675420 229805 &nbsp; &nbsp;2.9401 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/backend/storage/page/bufpage.c:415 itemoffcompare</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >00675d20 184668 &nbsp; &nbsp;2.3626 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/backend/storage/page/bufpage.c:433 PageRepairFragmentation</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >0078a7e0 169808 &nbsp; &nbsp;2.1725 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/port/qsort.c:78 swapfunc</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >00655590 147647 &nbsp; &nbsp;1.8890 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/backend/storage/buffer/bufmgr.c:1898 BufferGetBlockNumber</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >00488940 139389 &nbsp; &nbsp;1.7833 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/backend/access/heap/heapam.c:5756 heap_prepare_freeze_tuple</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >007624d0 86239 &nbsp; &nbsp; 1.1033 &nbsp;/opt/soft_bak/postgresql-9.4.1/src/backend/utils/hash/dynahash.c:824 hash_search_with_hash_value</font></div></div><p></p></pre></div></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font color="#1a1a1a"   face="Open Sans, liberation sans, Myriad, Bitstream Vera Sans, Lucida Grande, Luxi Sans, helvetica, verdana, arial, sans-serif"   ><span style="font-size: 15.3999996185303px; line-height: 26.9500007629395px;"   >可以看到最耗费CPU的调用是哪些。</span></font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font color="#1a1a1a"   face="Open Sans, liberation sans, Myriad, Bitstream Vera Sans, Lucida Grande, Luxi Sans, helvetica, verdana, arial, sans-serif"   ><div style="line-height: 26.9500007629395px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><pre class="prettyprint"   ><p></p><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >[root@digoal data06]# opannotate -x -s -t 1 /opt/pgsql/bin/postgres -i HeapTupleSatisfiesVacuum|less</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >Using /data06/oprofile_data/samples/ for session-dir</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >/*&nbsp;</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;* Command line: opannotate -x -s -t 1 /opt/pgsql/bin/postgres -i HeapTupleSatisfiesVacuum&nbsp;</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;*&nbsp;</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;* Interpretation of command line:</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;* Output annotated source file with samples</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;* Output files where samples count reach 1% of the samples</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;*&nbsp;</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;* CPU: Intel Core/i7, speed 1995.14 MHz (estimated)</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;* Counted CPU_CLK_UNHALTED events (Clock cycles when not halted) with a unit mask of 0x00 (No unit mask) count 100000</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;*/</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >/*&nbsp;</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;* Total samples for file : "/opt/soft_bak/postgresql-9.4.1/src/backend/utils/time/tqual.c"</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;*&nbsp;</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;* 2091381 100.000</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp;*/</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   ><br></font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   ><br></font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:/*-------------------------------------------------------------------------</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: *</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: * tqual.c</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: * &nbsp; &nbsp; &nbsp; &nbsp;POSTGRES "time qualification" code, ie, tuple visibility rules.</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: *</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: * NOTE: all the HeapTupleSatisfies routines will update the tuple's</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: * "hint" status bits if we see that the inserting or deleting transaction</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: * has now committed or aborted (and it is safe to set the hint bits).</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: * If the hint bits are changed, MarkBufferDirtyHint is called on</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: * the passed-in buffer. &nbsp;The caller must hold not only a pin, but at least</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: * shared buffer content lock on the buffer containing the tuple.</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: *</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: * NOTE: must check TransactionIdIsInProgress (which looks in PGXACT array)</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >。。。。。。</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >1879024 89.8461 : &nbsp; &nbsp; &nbsp; if (!HeapTupleHeaderXminCommitted(tuple))</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: &nbsp; &nbsp; &nbsp; &nbsp;{</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; 63 &nbsp;0.0030 : &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (HeapTupleHeaderXminInvalid(tuple))</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return HEAPTUPLE_DEAD;</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* Used by pre-9.0 binary upgrades */</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; 18 8.6e-04 : &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else if (tuple-&gt;t_infomask &amp; HEAP_MOVED_OFF)</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TransactionId xvac = HeapTupleHeaderGetXvac(tuple);</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:</font></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><font size="2"   >。。。。。。</font></div></div><p></p></pre></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="line-height: 26.9500007629395px; font-size: 15.3999996185303px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   >最耗费的出现在代码中的这段调用。</div><div style="line-height: 26.9500007629395px; font-size: 15.3999996185303px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="font-size: 15.3999996185303px; line-height: 26.9500007629395px;"   >if (!HeapTupleHeaderXminCommitted(tuple))</span></div><div style="line-height: 26.9500007629395px; font-size: 15.3999996185303px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="font-size: 15.3999996185303px; line-height: 26.9500007629395px;"   >Oprofile支持的事件，使用opcontrol --list-events查看:</span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><pre class="prettyprint"   ><p></p><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >[root@digoal data06]# opcontrol --list-events</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >oprofile: available events for CPU type "Intel Core/i7"</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   ><br></font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >See Intel Architecture Developer's Manual Volume 3B, Appendix A and</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >Intel Architecture Optimization Reference Manual</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   ><br></font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >For architectures using unit masks, you may be able to specify</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >unit masks by name. &nbsp;See 'opcontrol' or 'operf' man page for more details.</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   ><br></font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >CPU_CLK_UNHALTED: (counter: all)</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Clock cycles when not halted (min count: 6000)</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >UNHALTED_REFERENCE_CYCLES: (counter: all)</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Unhalted reference cycles (min count: 6000)</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Unit masks (default 0x1)</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; ----------</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0x01: No unit mask</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >......</font></span></div><p></p></pre></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="font-size: 15.3999996185303px; line-height: 26.9500007629395px;"   >事件配置:</span></div></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><pre class="prettyprint"   ><p></p><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--events / -e event1[,event2[,...]]</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; This option is for passing a comma-separated list of event specifications for profiling. Each event spec</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is of the form:</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name:count[:unitmask[:kernel[:user]]]</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; You can specify unit mask values using either a numerical value (hex values must begin with "0x") &nbsp;or &nbsp;a</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; symbolic &nbsp;name &nbsp;(if &nbsp;the name=&lt;um_name&gt; field is shown in the ophelp output). For some named unit masks,</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the hex value is not unique; thus, OProfile tools enforce specifying such unit masks value by name.</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   ><br></font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Event names for some IBM PowerPC systems include a _GRP&lt;n&gt; (group number) suffix. You &nbsp;can &nbsp;pass &nbsp;either</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the &nbsp;full event name or the base event name (i.e., without the suffix) to operf. &nbsp;If the base event name</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is passed, operf will automatically choose an appropriate group number suffix for the event; thus, OPro-</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; file post-processing tools will always show real event names that include the group number suffix.</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   ><br></font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; When &nbsp;no event specification is given, the default event for the running processor type will be used for</font></span></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="line-height: 26.9500007629395px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; profiling. &nbsp;Use ophelp to list the available events for your processor type.</font></span></div><p></p></pre></div></div><div style="line-height: 26.9500007629395px; font-size: 15.3999996185303px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="font-size: 15.3999996185303px; line-height: 26.9500007629395px;"   ><br></span></div><div style="line-height: 26.9500007629395px; font-size: 15.3999996185303px; box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="font-size: 15.3999996185303px; line-height: 26.9500007629395px;"   >以下摘自redhat admin doc</span></div></div></font></div></div></div><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; font-stretch: inherit; vertical-align: baseline;"   ><span style="color: rgb(26, 26, 26); font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; font-size: 15.3999996185303px; line-height: 25.2000007629395px;"   >OProfile is a low overhead, system-wide performance monitoring tool. It uses the performance monitoring hardware on the processor to retrieve information about the kernel and executables on the system, such as when memory is referenced, the number of L2 cache requests, and the number of hardware interrupts received. On a Red&nbsp;Hat Enterprise&nbsp;Linux system, the&nbsp;</span><code style="color: inherit; font-size: 15.3999996185303px; line-height: inherit; box-sizing: border-box; font-family: Menlo, Monaco, 'Courier New', monospace; padding: 0px; border-radius: 0px; font-weight: inherit; white-space: pre-wrap; word-wrap: break-word; border: 0px none; font-stretch: inherit; font-style: inherit; font-variant: inherit; margin: 0px; vertical-align: baseline; display: inline-block; background-color: transparent;"   >oprofile</code><span style="color: rgb(26, 26, 26); font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif; font-size: 15.3999996185303px; line-height: 25.2000007629395px;"   >&nbsp;package must be installed to use this tool.</span></div></div></div><div style="box-sizing: border-box; widows: 4; orphans: 4; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; line-height: 25.2000007629395px; vertical-align: baseline; color: rgb(26, 26, 26); font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif;"   >Many processors include dedicated performance monitoring hardware. This hardware makes it possible to detect when certain events happen (such as the requested data not being in cache). The hardware normally takes the form of one or more&nbsp;<em style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   >counters</em>&nbsp;that are incremented each time an event takes place. When the counter value increments, an interrupt is generated, making it possible to control the amount of detail (and therefore, overhead) produced by performance monitoring.</div><div style="box-sizing: border-box; widows: 4; orphans: 4; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; line-height: 25.2000007629395px; vertical-align: baseline; color: rgb(26, 26, 26); font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif;"   >OProfile uses this hardware (or a timer-based substitute in cases where performance monitoring hardware is not present) to collect&nbsp;<em style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   >samples</em>&nbsp;of performance-related data each time a counter generates an interrupt. These samples are periodically written out to disk; later, the data contained in these samples can then be used to generate reports on system-level and application-level performance.</div><div style="box-sizing: border-box; widows: 4; orphans: 4; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; line-height: 25.2000007629395px; vertical-align: baseline; color: rgb(26, 26, 26); font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif;"   >Be aware of the following limitations when using OProfile:</div><div xmlnsd="http://docbook.org/ns/docbook"   class="itemizedlist"   style="box-sizing: border-box; widows: 4; orphans: 4; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; line-height: 25.2000007629395px; margin: 0px; padding: 0px; vertical-align: baseline; color: rgb(26, 26, 26); font-family: 'Open Sans', 'liberation sans', 'Myriad ', 'Bitstream Vera Sans', 'Lucida Grande', 'Luxi Sans', helvetica, verdana, arial, sans-serif;"   ><ul style="box-sizing: border-box; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; list-style-type: circle; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; vertical-align: baseline;"   ><li style="box-sizing: border-box; margin: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; padding: 0px; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; vertical-align: baseline;"   ><span style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   ><em style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   >Use of shared libraries</em></span>&nbsp;― Samples for code in shared libraries are not attributed to the particular application unless the&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 15.3999996185303px; padding: 0px; color: inherit; border-radius: 0px; font-weight: inherit; white-space: pre-wrap; word-wrap: break-word; border: 0px none; font-stretch: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; vertical-align: baseline; display: inline-block; background-color: transparent;"   >--separate=library</code>&nbsp;option is used.</div></li><li style="box-sizing: border-box; margin: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; padding: 0px; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; vertical-align: baseline;"   ><span style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   ><em style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   >Performance monitoring samples are inexact</em></span>&nbsp;― When a performance monitoring register triggers a sample, the interrupt handling is not precise like a divide by zero exception. Due to the out-of-order execution of instructions by the processor, the sample may be recorded on a nearby instruction.</div></li><li style="box-sizing: border-box; margin: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; padding: 0px; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; vertical-align: baseline;"   ><span style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   ><em style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   ><code style="box-sizing: border-box; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 15.3999996185303px; padding: 0px; color: inherit; border-radius: 0px; font-weight: inherit; white-space: pre-wrap; word-wrap: break-word; border: 0px none; font-stretch: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; vertical-align: baseline; display: inline-block; background-color: transparent;"   >opreport</code>&nbsp;does not associate samples for inline functions properly</em></span>&nbsp;―&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 15.3999996185303px; padding: 0px; color: inherit; border-radius: 0px; font-weight: inherit; white-space: pre-wrap; word-wrap: break-word; border: 0px none; font-stretch: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; vertical-align: baseline; display: inline-block; background-color: transparent;"   >opreport</code>&nbsp;uses a simple address range mechanism to determine which function an address is in. Inline function samples are not attributed to the inline function but rather to the function the inline function was inserted into.</div></li><li style="box-sizing: border-box; margin: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; padding: 0px; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; vertical-align: baseline;"   ><span style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   ><em style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   >OProfile accumulates data from multiple runs</em></span>&nbsp;― OProfile is a system-wide profiler and expects processes to start up and shut down multiple times. Thus, samples from multiple runs accumulate. Use the command&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 15.3999996185303px; padding: 0px; color: inherit; border-radius: 0px; font-weight: inherit; white-space: pre-wrap; word-wrap: break-word; border: 0px none; font-stretch: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; vertical-align: baseline; display: inline-block; background-color: transparent;"   >opcontrol --reset</code>&nbsp;to clear out the samples from previous runs.</div></li><li style="box-sizing: border-box; margin: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; padding: 0px; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; vertical-align: baseline;"   ><span style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   ><em style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   >Hardware performance counters do not work on guest virtual machines</em></span>&nbsp;― Because the hardware performance counters are not available on virtual systems, you need to use the&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 15.3999996185303px; padding: 0px; color: inherit; border-radius: 0px; font-weight: inherit; white-space: pre-wrap; word-wrap: break-word; border: 0px none; font-stretch: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; vertical-align: baseline; display: inline-block; background-color: transparent;"   >timer</code>&nbsp;mode. Enter the command&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 15.3999996185303px; padding: 0px; color: inherit; border-radius: 0px; font-weight: inherit; white-space: pre-wrap; word-wrap: break-word; border: 0px none; font-stretch: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; vertical-align: baseline; display: inline-block; background-color: transparent;"   >opcontrol --deinit</code>, and then execute&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 15.3999996185303px; padding: 0px; color: inherit; border-radius: 0px; font-weight: inherit; white-space: pre-wrap; word-wrap: break-word; border: 0px none; font-stretch: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; vertical-align: baseline; display: inline-block; background-color: transparent;"   >modprobe oprofile timer=1</code>&nbsp;to enable the&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 15.3999996185303px; padding: 0px; color: inherit; border-radius: 0px; font-weight: inherit; white-space: pre-wrap; word-wrap: break-word; border: 0px none; font-stretch: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; vertical-align: baseline; display: inline-block; background-color: transparent;"   >timer</code>&nbsp;mode.</div></li><li style="box-sizing: border-box; margin: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; padding: 0px; vertical-align: baseline;"   ><div style="box-sizing: border-box; margin: 0px 0px 1.8em; padding: 0px; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; vertical-align: baseline;"   ><span style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   ><em style="box-sizing: border-box; border: 0px none; font-size: 15.3999996185303px; font-stretch: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; margin: 0px; padding: 0px; vertical-align: baseline;"   >Non-CPU-limited performance problems</em></span>&nbsp;― OProfile is oriented to finding problems with CPU-limited processes. OProfile does not identify processes that are asleep because they are waiting on locks or for some other event to occur (for example an I/O device to finish an operation).</div></li></ul></div></div><div><br></div><div><div>SystemTap is a tracing and probing tool that allows users to study and monitor the activities of the operating system in fine detail. It provides information similar to the output of tools like netstat, ps, top, and iostat; however, SystemTap is designed to provide more filtering and analysis options for the collected information.</div><div>While using OProfile is suggested in cases of collecting data on where and why the processor spends time in a particular area of code, it is less usable when finding out why the processor stays idle.</div><div>You might want to use SystemTap when instrumenting specific places in code. Because SystemTap allows you to run the code instrumentation without having to stop and restart the instrumented code, it is particularly useful for instrumenting the kernel and daemons.</div></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://oprofile.sourceforge.net/"   >http://oprofile.sourceforge.net/</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-OProfile.html"   >https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/ch-OProfile.html</a></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="OProfile  Systemtap - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>