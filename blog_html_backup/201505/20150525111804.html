<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.5 new feature - table | mview data sample</h2>
	<h5 id="">2015-05-25 11:18:04&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201542510138405/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>PostgreSQL 9.5支持的新特性，数据采样。有了这个功能，如果能结合pg_dump使用的话，可以为比较大的生产数据库创建较小的测试环境。当然，如果是这样的话采样还需要考虑数据关联的问题。</div><div><br></div><div>用户可以自定义采样方法，或者使用系统自带的两种采样方法（基于所有数据块的选择性采样，以及基于全表的选择性采样）</div><div>基于数据块的采样扫描的数据块比较少，只需要扫描筛选出的数据块并返回最终的采样数据(粒度较大)。</div><div>基于全表的采样，需要扫描全表，并筛选最终的采样数据(粒度细，但是开销大)。</div><div>语法：</div><wbr><div><div>[ TABLESAMPLE sampling_method ( argument [, ...] ) [ REP<span style="line-height: 28px;"   >EATABLE ( seed ) ] ]</span></div></div><div><span style="line-height: 28px;"   >repeatable指定采样seed.</span></div><div><span style="line-height: 28px;"   >sampling_method 参数是采样函数的参数，目前指采样比例。</span></div><div><span style="line-height: 28px;"   >例子：</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres=# create table test(id int);</font></div><div><font size="2"   >CREATE TABLE</font></div></div><div><div><font size="2"   >postgres=# insert into test select generate_series(1,100000000);</font></div><div><font size="2"   >INSERT 0 100000000</font></div><div><font size="2"   >Time: 128199.864 ms</font></div></div><p></p></pre></div><div><div>采样速度很快，2毫秒就完成了。</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# select count(*) from test tablesample system (0.000001);</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp; &nbsp;909</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 1.930 ms</font></div><p></p></pre></div><div>正常的话应该返回100条采样数据，但是返回了909，因为我们使用的是数据块采样方法SYSTEM，返回了1个数据块的所有记录。</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres=# select 100000000*0.000001;</font></div><div><font size="2"   >&nbsp; ?column? &nbsp;</font></div><div><font size="2"   >------------</font></div><div><font size="2"   >&nbsp;100.000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 0.631 ms</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >postgres=# select count(*) from (select ctid,* from test limit 100000) t where ctid::text ~ '\(1,';</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp; &nbsp;909</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 196.232 ms</font></div></div><p></p></pre></div></div><div>这种采样方法离散度比较低，因为集中返回某些数据块的记录。</div><div><br></div><div>接下来使用记录采样方法<span style="line-height: 28px;"   >BERNOULLI</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres=# select relpages,reltuples from pg_class where relname='test';</font></div><div><font size="2"   >&nbsp;relpages | &nbsp;reltuples &nbsp;</font></div><div><font size="2"   >----------+-------------</font></div><div><font size="2"   >&nbsp; &nbsp;110012 | 2.72691e+07</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 0.786 ms</font></div></div><div><div><font size="2"   >postgres=# select count(*) from test;</font></div><div><font size="2"   >&nbsp; &nbsp;count &nbsp;&nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp;100000000</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 12041.390 ms</font></div></div><p></p></pre></div><div>扫描全表的采样方法明显速度下降了</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres=# select count(*) from test tablesample BERNOULLI (0.000001) ;</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 6245.059 ms</font></div></div><div><div><font size="2"   >postgres=# select count(*) from test tablesample BERNOULLI (0.00001) ;</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp; &nbsp; 13</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 6305.808 ms</font></div></div><p></p></pre></div><div>同样，采样结果也不对，这个应该是BUG。</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres=# select 2.72691e+07*0.00001;</font></div><div><font size="2"   >&nbsp;?column? &nbsp;</font></div><div><font size="2"   >-----------</font></div><div><font size="2"   >&nbsp;272.69100</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >postgres=# vacuum analyze test;</font></div><div><font size="2"   >VACUUM</font></div><div><font size="2"   >Time: 9880.728 ms</font></div></div><div><div><font size="2"   >postgres=# select relpages,reltuples from pg_class where relname='test';</font></div><div><font size="2"   >&nbsp;relpages | reltuples&nbsp;</font></div><div><font size="2"   >----------+-----------</font></div><div><font size="2"   >&nbsp; &nbsp;110012 | &nbsp; &nbsp; 1e+08</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 0.438 ms</font></div><div><font size="2"   >postgres=# select count(*) from test tablesample BERNOULLI (0.00001) ;</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;6</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 6243.548 ms</font></div><div><font size="2"   >postgres=# select count(*) from test tablesample BERNOULLI (0.00001) ;</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;9</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 6275.948 ms</font></div><div><font size="2"   >postgres=# select count(*) from test tablesample BERNOULLI (0.00001) ;</font></div><div><font size="2"   >&nbsp;count&nbsp;</font></div><div><font size="2"   >-------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;9</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >Time: 6243.882 ms</font></div></div><p></p></pre></div><div>这种方法的采样数据离散度很好，但是采样比较耗时。</div><div><br></div><div><br></div><div>PostgreSQL 另外还提供了两个扩展的采样方法模块：</div><div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >1.&nbsp;<a style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, &#23435;&#20307;;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/tsm-system-rows.html"   >http://www.postgresql.org/docs/devel/static/tsm-system-rows.html</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >这个采样方法和system一样，是基于数据块的，但是精确的返回指定的行数，相当于加了过滤器。</div></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >离散度较低。</div><div><div style="color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   ><font size="2"   >postgres=# CREATE EXTENSION tsm_system_rows;</font></div><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   ><font size="2"   >CREATE EXTENSION</font></div><div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >postgres=# SELECT count(*) FROM test TABLESAMPLE SYSTEM_ROWS(100);</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >&nbsp;count&nbsp;</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >-------</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >&nbsp; &nbsp;100</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >(1 row)</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >Time: 0.568 ms</font></div></div><div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >postgres=# SELECT distinct substring(ctid::text,'(.*),') FROM test TABLESAMPLE SYSTEM_ROWS(100);</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >&nbsp;substring&nbsp;</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >-----------</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >&nbsp;(75816</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >(1 row)</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >Time: 1.265 ms</font></div></div><p></p></pre></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   ><br></font></div><div style="color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   ><span style="line-height: 28px;"   >2.&nbsp;</span><a style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, &#23435;&#20307;;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/tsm-system-time.html"   >http://www.postgresql.org/docs/devel/static/tsm-system-time.html</a></div><div style="color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   >这个采样方法是基于时间的采样方法，从任意一个数据块开始扫描，当扫描时间达到指定的扫描时间时停止扫描.</div></div><div style="color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   >所以返回的记录是某些数据块的连续数据，离散度较低。</div><div style="color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   ><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >postgres=# create extension tsm_system_time;</font></div><div style="line-height: 28px;"   ><font size="2"   >CREATE EXTENSION</font></div><div style="line-height: 28px;"   ><font size="2"   ><br></font></div></div><div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >postgres=# SELECT min(ctid),max(ctid),count(*),min(id),max(id),max(id)-min(id) FROM test TABLESAMPLE SYSTEM_TIME(1);</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >&nbsp; &nbsp;min &nbsp; &nbsp;| &nbsp; &nbsp;max &nbsp; &nbsp; | count | &nbsp; min &nbsp; | &nbsp; max &nbsp; | ?column?&nbsp;</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >----------+------------+-------+---------+---------+----------</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >&nbsp;(8093,1) | (8095,909) | &nbsp;2727 | 6356538 | 6359264 | &nbsp; &nbsp; 2726</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >(1 row)</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >Time: 2.080 ms</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >postgres=# SELECT min(ctid),max(ctid),count(*),min(id),max(id),max(id)-min(id) FROM test TABLESAMPLE SYSTEM_TIME(1);</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >&nbsp; &nbsp; min &nbsp; &nbsp;| &nbsp; &nbsp; max &nbsp; &nbsp; | count | &nbsp; min &nbsp; &nbsp;| &nbsp; max &nbsp; &nbsp;| ?column?&nbsp;</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >-----------+-------------+-------+----------+----------+----------</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >&nbsp;(35058,1) | (35083,909) | 23634 | 31867723 | 31891356 | &nbsp; &nbsp;23633</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >(1 row)</font></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   >Time: 12.863 ms</font></div></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   size="2"   ><div>postgres=# explain SELECT min(ctid),max(ctid),count(*),min(id),max(id),max(id)-min(id) FROM test TABLESAMPLE SYSTEM_TIME(1);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;QUERY PLAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</div><div>-------------------------------------------------------------------------------------</div><div>&nbsp;Aggregate &nbsp;(cost=29697.06..29697.07 rows=1 width=10)</div><div>&nbsp; &nbsp;-&gt; &nbsp;Sample Scan (system_time) on test &nbsp;(cost=0.00..12198.93 rows=999893 width=10)</div><div>(2 rows)</div><div>Time: 0.671 ms</div></font></div><p></p></pre></div></div><div style="color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53; line-height: 28px;"   ><br></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >用户还可以自定义采样方法函数，参考：</div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><a style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, &#23435;&#20307;;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/tablesample-method.html"   >http://www.postgresql.org/docs/devel/static/tablesample-method.html</a></div><div><br></div>[参考]<wbr><div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >1.&nbsp;<a style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, &#23435;&#20307;;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/tsm-system-rows.html"   >http://www.postgresql.org/docs/devel/static/tsm-system-rows.html</a></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   >2.&nbsp;<a style="line-height: 28px; font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, &#23435;&#20307;;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/tsm-system-time.html"   >http://www.postgresql.org/docs/devel/static/tsm-system-time.html</a></div></div><div style="line-height: 28px; color: rgb(51, 51, 51); font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;"   ><span style="line-height: 28px;"   >3.&nbsp;</span><a style="font-family: 'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, &#23435;&#20307;; line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/tablesample-method.html"   >http://www.postgresql.org/docs/devel/static/tablesample-method.html</a></div><div><font color="#333333"   face="Hiragino Sans GB W3, Hiragino Sans GB, Arial, Helvetica, simsun, u5b8bu4f53"   >4.&nbsp;</font><a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/sql-select.html"   >http://www.postgresql.org/docs/devel/static/sql-select.html</a></div><div><dt style="font-family: verdana, sans-serif; font-size: 12.1599998474121px; line-height: normal;"   >TABLESAMPLE&nbsp;<tt style="font-weight: bold; font-style: italic;"   >sampling_method</tt>&nbsp;(&nbsp;<tt style="font-weight: bold; font-style: italic;"   >argument</tt>&nbsp;[, ...] ) [ REPEATABLE (&nbsp;<tt style="font-weight: bold; font-style: italic;"   >seed</tt>&nbsp;) ]</dt><dd style="font-family: verdana, sans-serif; font-size: 12.1599998474121px; line-height: normal;"   ><p style="font-size: 1em; line-height: 1.5em; margin: 1.2em 0em;"   >Table sample clause after&nbsp;<tt style="font-weight: bold; font-style: italic;"   >table_name</tt>&nbsp;indicates that a&nbsp;<tt style="font-weight: bold; font-style: italic;"   >sampling_method</tt>&nbsp;should be used to retrieve subset of rows in the table. The&nbsp;<tt style="font-weight: bold; font-style: italic;"   >sampling_method</tt>&nbsp;can be any sampling method installed in the database. There are currently two sampling methods available in the standard&nbsp;<span>PostgreSQL</span>&nbsp;distribution:</p><ul style="font-size: 1em; line-height: 1.5em; margin-top: 0.2em; margin-bottom: 0.1em;"   ><li style="font-size: 1em; line-height: 1.5em; margin-top: 0.2em; margin-bottom: 0.1em;"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0.2em 0em 1.2em;"   ><tt>SYSTEM</tt></p></li><li style="font-size: 1em; line-height: 1.5em; margin-top: 0.2em; margin-bottom: 0.1em;"   ><p style="font-size: 1em; line-height: 1.5em; margin: 0.2em 0em 1.2em;"   ><tt>BERNOULLI</tt></p></li></ul><p style="font-size: 1em; line-height: 1.5em; margin: 1.2em 0em;"   >Both of these sampling methods currently accept only single argument which is the percent (floating point from 0 to 100) of the rows to be returned. The&nbsp;<tt>SYSTEM</tt>&nbsp;sampling method does block level sampling with each block having the same chance of being selected and returns all rows from each selected block. The&nbsp;<tt>BERNOULLI</tt>&nbsp;scans whole table and returns individual rows with equal probability. Additional sampling methods may be installed in the database via extensions.</p><p style="font-size: 1em; line-height: 1.5em; margin: 1.2em 0em;"   >The optional parameter&nbsp;<tt>REPEATABLE</tt>&nbsp;uses the seed parameter, which can be a number or expression producing a number, as a random seed for sampling. Note that subsequent commands may return different results even if same&nbsp;<tt>REPEATABLE</tt>&nbsp;clause was specified. This happens because&nbsp;<acronym>DML&nbsp;statements and maintenance operations such as&nbsp;<tt>VACUUM</tt>&nbsp;may affect physical distribution of data. The&nbsp;<code>setseed()</code>&nbsp;function will not affect the sampling result when the&nbsp;<tt>REPEATABLE</tt>&nbsp;parameter is used.</p></dd></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL 9.5 new feature - table | mview data sample - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>