<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">A case : performance slower down when collections upto 8K</h2>
	<h5 id="">2011-09-07 12:15:28&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201187113546635/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">以前从一位开发人员那里了解到，mongoDB建了8000多个collection后，速度会变得很慢。<div>可能和这个有关:</div><div><span style="font-family: helvetica, arial, sans-serif; font-size: 13px; line-height: 17px; background-color: rgb(243, 244, 235);"  ><h2 style="margin-top: 24px; margin-right: 0px; margin-bottom: 1.1em; margin-left: 0px; line-height: normal; font-weight: bold; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-size: 16pt; color: rgb(0, 51, 102); text-decoration: none !important; border-bottom-color: rgb(102, 153, 204);"  >Limits</h2><p style="margin-top: 0px; font-size: 10pt; line-height: 13pt; color: rgb(76, 58, 44) !important; text-decoration: none !important; max-width: 800px;"  >By default MongoDB has a limit of approximately 24,000&nbsp;<em style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  >namespaces</em>&nbsp;per database. Each namespace is 628 bytes, the&nbsp;<tt style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  >.ns</tt>&nbsp;file is 16MB by default.</p><p style="margin-top: 0px; font-size: 10pt; line-height: 13pt; color: rgb(76, 58, 44) !important; text-decoration: none !important; max-width: 800px;"  >Each collection counts as a namespace, as does each index.&nbsp; Thus if every collection had one index, we can create up to 12,000 collections.&nbsp; The&nbsp;<tt style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  >--nssize</tt>&nbsp;parameter allows you to increase this limit (see below).</p><p style="margin-top: 0px; font-size: 10pt; line-height: 13pt; color: rgb(76, 58, 44) !important; text-decoration: none !important; max-width: 800px;"  >Be aware that there is a certain minimum overhead per collection -- a few KB.&nbsp; Further, any index will require at least 8KB of data space as the b-tree page size is 8KB. Certain operations can get slow if there are a lot of collections and the meta data gets paged out.</p><h3 style="margin-top: 20px; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: normal; font-weight: bold; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; font-size: 14pt; color: rgb(0, 51, 102); text-decoration: none !important;"  ><a style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; text-decoration: none !important; color: rgb(76, 58, 44) !important; " name="UsingaLargeNumberofCollections-%7B%7Bnssize%7D%7D" rel="nofollow"  ></a><tt style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  >--nssize</tt></h3><p style="margin-top: 0px; font-size: 10pt; line-height: 13pt; color: rgb(76, 58, 44) !important; text-decoration: none !important; max-width: 800px;"  >If more collections are required, run mongod with the&nbsp;<tt style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  >--nssize</tt>&nbsp;parameter specified.&nbsp; This will make the &lt;database&gt;.ns file larger and support more collections.&nbsp; Note that&nbsp;<tt style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  >--nssize</tt>&nbsp;sets the size used for newly created&nbsp;<tt style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  >.ns</tt>&nbsp;files -- if you have an existing database and wish to resize, after running the db with&nbsp;<tt style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  >--nssize</tt>, run the&nbsp;<tt style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  >db.repairDatabase()</tt>&nbsp;command from the shell to adjust the size.</p><p style="margin-top: 0px; font-size: 10pt; line-height: 13pt; color: rgb(76, 58, 44) !important; text-decoration: none !important; max-width: 800px;"  >Maximum&nbsp;<tt style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;"  >.ns</tt>&nbsp;file size is 2GB.</p></span></div><div><br></div><div><br>【参考】<wbr></div><div><a rel="nofollow" href="http://www.mongodb.org/display/DOCS/Using+a+Large+Number+of+Collections"  >http://www.mongodb.org/display/DOCS/Using+a+Large+Number+of+Collections</a></div></div>
	</div>
</div>
</body>
</html>