<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">mongoDB 2.0.0 shard implemention with noauth=true</h2>
	<h5 id="">2011-09-27 10:47:01&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402011827104558802/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">配置和1.8差不多，只是mongoDB2.0.0本身带来了一些新的特性，所以参数配置有点不一样。<wbr><div>以下是详细部署过程 :&nbsp;</div><div><div>产品部署注意事项 :&nbsp;</div><div>do not use hugepage</div><div>use ntp</div><div>use ext4/xfs</div><div>mount with option : noatime&nbsp;</div><div>Do not use NUMA</div><div>DELL服务器关闭NUMA : Node Interleaving 改为Enabled则安装对称内存配置时支持内存交错。如果为 Disabled（已禁用），系统支持非一体化内存体系结构 (NUMA)（非对称）内存配置。</div><div>不关闭numa会有警告信息 :&nbsp;</div><div><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: 12px; line-height: 21px;"  >Mon Sep 26 14:07:01 File I/O errno:29 Illegal seek<br style="line-height: 21px;"  >Mon Sep 26 14:07:01 ** WARNING: cannot parse numa_maps</span></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><span style="font-size: 12px; line-height: 19px;"  ><br></span></font></div><div>Servers :&nbsp;</div><div>10.10.10.10</div><div>10.10.10.11</div><div>10.10.10.12</div><div>10.10.10.13</div><div>10.10.10.14</div><div>10.10.10.16</div><div><br></div><div>configdb :&nbsp;</div><div>10.10.10.14:6669 , 10.10.10.14:6670 , 10.10.10.16:6669</div><div>mongos :&nbsp;</div><div>10.10.10.16:6666&nbsp;</div><div>shard1 :&nbsp;</div><div>digoal001/10.10.10.10:6666(PRIMARY),10.10.10.11:6667(SECONDARY),10.10.10.12:6668(arbit)</div><div>shard2 :&nbsp;</div><div>digoal002/10.10.10.11:6666(PRIMARY),10.10.10.10:6667(SECONDARY),10.10.10.13:6668(arbit)</div><div>shard3 :&nbsp;</div><div>digoal003/10.10.10.12:6666(PRIMARY),10.10.10.13:6667(SECONDARY),10.10.10.10:6668(arbit)</div><div>shard4 :&nbsp;</div><div>digoal004/10.10.10.13:6666(PRIMARY),10.10.10.12:6667(SECONDARY),10.10.10.11:6668(arbit)</div><div><br></div><div>存储配置 :&nbsp;</div><div># pvcreate /dev/sdb</div><div># pvcreate /dev/sdc</div><div># pvcreate /dev/sda4</div><div># pvs</div><div>&nbsp; PV &nbsp; &nbsp; &nbsp; &nbsp; VG &nbsp; &nbsp; &nbsp; Fmt &nbsp;Attr PSize &nbsp; PFree</div><div>&nbsp; /dev/sda4 &nbsp;vgdata01 lvm2 a- &nbsp; 154.56G &nbsp; &nbsp;0&nbsp;</div><div>&nbsp; /dev/sdb &nbsp; vgdata01 lvm2 a- &nbsp; 278.87G &nbsp; &nbsp;0&nbsp;</div><div>&nbsp; /dev/sdc &nbsp; vgdata01 lvm2 a- &nbsp; 278.87G &nbsp; &nbsp;0&nbsp;</div><div># vgcreate vgdata01 /dev/sdb /dev/sdc /dev/sda4</div><div># vgs</div><div>&nbsp; VG &nbsp; &nbsp; &nbsp; #PV #LV #SN Attr &nbsp; VSize &nbsp; VFree &nbsp;</div><div>&nbsp; vgdata01 &nbsp; 3 &nbsp; 0 &nbsp; 0 wz--n- 712.30G 712.30G</div><div># lvcreate -l 71391 -n lv01 vgdata01 /dev/sdb</div><div># lvcreate -l 71391 -n lv02 vgdata01 /dev/sdc</div><div># lvextend -l +19784 /dev/vgdata01/lv01 /dev/sda4</div><div># lvextend -l +19784 /dev/vgdata01/lv02 /dev/sda4</div><div># mkfs.ext4 /dev/mapper/vgdata01-lv01</div><div># mkfs.ext4 /dev/mapper/vgdata01-lv02</div><div># vi /etc/fstab</div><div>/dev/mapper/vgdata01-lv01 &nbsp; &nbsp; &nbsp; /mongodata/digoal/6666/data01 &nbsp; &nbsp; ext4 &nbsp; &nbsp;defaults,noatime 0 0</div><div>/dev/mapper/vgdata01-lv02 &nbsp; &nbsp; &nbsp; /mongodata/digoal/6667/data01 &nbsp; &nbsp; ext4 &nbsp; &nbsp;defaults,noatime 0 0</div><div># mkdir -p /mongodata/digoal/6666/data01</div><div># mkdir -p /mongodata/digoal/6667/data01</div><div># mount -a</div><div># mkdir /mongodata/digoal/6666/data01/mongodb_datafile</div><div># mkdir /mongodata/digoal/6666/data01/mongodb_etc</div><div># mkdir /mongodata/digoal/6666/data01/mongodb_run</div><div># mkdir /mongodata/digoal/6667/data01/mongodb_datafile</div><div># mkdir /mongodata/digoal/6667/data01/mongodb_etc</div><div># mkdir /mongodata/digoal/6667/data01/mongodb_run</div><div># mkdir -p /opt/mongodata/digoal/6668/data01/mongodb_datafile</div><div># mkdir -p /opt/mongodata/digoal/6668/data01/mongodb_etc</div><div># mkdir -p /opt/mongodata/digoal/6668/data01/mongodb_run</div><div># chown -R mongo:mongo /mongodata</div><div># chown -R mongo:mongo /opt/mongodata</div><div><br></div><div>用户配置 :&nbsp;</div><div># useradd mongo</div><div># passwd mongo</div><div># passwd root</div><div># chown -R mongo:mongo /mongodata</div><div># su - mongo</div><div>$ vi .bash_profile</div><div>export PS1="$USER@`/bin/hostname -s`-&gt; "&nbsp;</div><div>export MONGO_HOME=/opt/mongodb-linux-x86_64-2.0.0</div><div>export PATH=$MONGO_HOME/bin:$PATH:.</div><div>umask 022</div><div>alias rm='rm -i'</div><div>alias ll='ls -lh'</div><div><br></div><div>系统配置 :&nbsp;</div><div># vi /etc/sysctl.conf</div><div>kernel.shmmni = 4096</div><div>kernel.sem = 50100 64128000 50100 1280</div><div>fs.file-max = 7672460</div><div>net.core.rmem_default = 1048576</div><div>net.core.rmem_max = 4194304</div><div>net.core.wmem_default = 262144</div><div>net.core.wmem_max = 1048576</div><div>net.ipv4.ip_local_port_range = 9000 65000</div><div>net.ipv4.tcp_tw_recycle = 1</div><div>net.ipv4.tcp_max_syn_backlog = 4096</div><div>net.ipv4.ip_conntrack_max = 655360</div><div>net.core.netdev_max_backlog = 10000</div><div>net.ipv4.ip_conntrack_max = 655360</div><div>fs.aio-max-nr = 1048576</div><div>net.ipv4.tcp_timestamps = 0</div><div>vm.overcommit_memory = 0</div><div>vm.zone_reclaim_mode = 0</div><div><br></div><div># chkconfig cmirror off &nbsp;</div><div># chkconfig ip6tables off</div><div># chkconfig iscsi off &nbsp; &nbsp;</div><div># chkconfig iscsid off &nbsp;&nbsp;</div><div># chkconfig rhnsd off &nbsp; &nbsp;</div><div># chkconfig ricci off &nbsp; &nbsp;</div><div># chkconfig avahi-daemon off</div><div># chkconfig modclusterd off</div><div><br></div><div># vi /etc/security/limits.conf</div><div>* soft &nbsp; &nbsp;nofile &nbsp;131072</div><div>* hard &nbsp; &nbsp;nofile &nbsp;131072</div><div>* soft &nbsp; &nbsp;nproc &nbsp; 131072</div><div>* hard &nbsp; &nbsp;nproc &nbsp; 131072</div><div>* soft &nbsp; &nbsp;core &nbsp; &nbsp;unlimited</div><div>* hard &nbsp; &nbsp;core &nbsp; &nbsp;unlimited</div><div>* soft &nbsp; &nbsp;memlock 50000000</div><div>* hard &nbsp; &nbsp;memlock 50000000</div><div><br></div><div># echo -e "\nsession required pam_limits.so" &gt;&gt;/etc/pam.d/login</div><div><br></div><div># vi /etc/sysconfig/iptables</div><div><br></div><div># vi /etc/sysconfig/ntpd</div><div><br></div><div># vi /etc/ssh/sshd_config</div><div><br></div><div># vi /etc/ssh/ssh_config</div><div><br></div><div># vi /etc/resolv.conf</div><div><br></div><div># vi /etc/hosts</div><div>127.0.0.1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localhost.localdomain localhost</div><div>10.10.10.10 db-10-10-10-10.sky-mobi.com.sh.nj db-10-10-10-10</div><div>10.10.10.11 db-10-10-10-11.sky-mobi.com.sh.nj db-10-10-10-11</div><div>10.10.10.12 db-10-10-10-12.sky-mobi.com.sh.nj db-10-10-10-12</div><div>10.10.10.13 db-10-10-10-13.sky-mobi.com.sh.nj db-10-10-10-13</div><div>10.10.10.14 db-10-10-10-14.sky-mobi.com.sh.nj db-10-10-10-14</div><div>10.10.10.16 db-10-10-10-16.sky-mobi.com.sh.nj db-10-10-10-16</div><div><br></div><div># hostname</div><div><br></div><div># vi /etc/sysconfig/network</div><div><br></div><div># crontab -e</div><div>8 * * * * /usr/sbin/ntpdate asia.pool.ntp.org &amp;&amp; /sbin/hwclock --systohc</div><div><br></div><div>数据库配置 :&nbsp;</div><div># tar -zxvf mongodb-linux-x86_64-2.0.0.tgz</div><div># tar -zxvf mongodb-src-r2.0.0.tar.gz</div><div># chown -R mongo:mongo mongodb*</div><div># mv mongodb-linux-x86_64-2.0.0 /opt/mongodb-linux-x86_64-2.0.0</div><div># mkdir /var/log/mongo</div><div># chown mongo:mongo /var/log/mongo</div><div># 配置见附录</div><div>$ vi /mongodata/digoal/6666/data01/mongodb_etc/mongod_6666.conf</div><div>$ vi /mongodata/digoal/6667/data01/mongodb_etc/mongod_6667.conf</div><div>$ vi /opt/mongodata/digoal/6668/data01/mongodb_etc/mongod_6668.conf</div><div><br></div><div>启动数据库 :&nbsp;</div><div>10.10.10.10,&nbsp;</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal001 -f /mongodata/digoal/6666/data01/mongodb_etc/mongod_6666.conf"</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal002 -f /mongodata/digoal/6667/data01/mongodb_etc/mongod_6667.conf"</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal003 -f /opt/mongodata/digoal/6668/data01/mongodb_etc/mongod_6668.conf"</div><div>10.10.10.11,&nbsp;</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal002 -f /mongodata/digoal/6666/data01/mongodb_etc/mongod_6666.conf"</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal001 -f /mongodata/digoal/6667/data01/mongodb_etc/mongod_6667.conf"</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal004 -f /opt/mongodata/digoal/6668/data01/mongodb_etc/mongod_6668.conf"</div><div>10.10.10.12,&nbsp;</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal003 -f /mongodata/digoal/6666/data01/mongodb_etc/mongod_6666.conf"</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal004 -f /mongodata/digoal/6667/data01/mongodb_etc/mongod_6667.conf"</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal001 -f /opt/mongodata/digoal/6668/data01/mongodb_etc/mongod_6668.conf"</div><div>10.10.10.13,&nbsp;</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal004 -f /mongodata/digoal/6666/data01/mongodb_etc/mongod_6666.conf"</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal003 -f /mongodata/digoal/6667/data01/mongodb_etc/mongod_6667.conf"</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --shardsvr --replSet=digoal002 -f /opt/mongodata/digoal/6668/data01/mongodb_etc/mongod_6668.conf"</div><div><br></div><div>加入自动启动</div><div># vi /etc/rc.local</div><div><br></div><div>配置replicaSet</div><div>$ mongo 10.10.10.10:6666/admin</div><div>&gt; cfg = {</div><div>&nbsp; &nbsp; _id : "digoal001",</div><div>&nbsp; &nbsp; members : [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 0, host : "10.10.10.10:6666", arbiterOnly : false, priority : 2},</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 1, host : "10.10.10.11:6667", arbiterOnly : false, priority : 1},</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 2, host : "10.10.10.12:6668", arbiterOnly : true, priority : 0}</div><div>&nbsp; &nbsp; ]</div><div>}</div><div>&gt; rs.initiate(cfg)</div><div>&gt; rs.status()</div><div><br></div><div>$ mongo 10.10.10.11:6666/admin</div><div>&gt; cfg = {</div><div>&nbsp; &nbsp; _id : "digoal002",</div><div>&nbsp; &nbsp; members : [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 0, host : "10.10.10.11:6666", arbiterOnly : false, priority : 2},</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 1, host : "10.10.10.10:6667", arbiterOnly : false, priority : 1},</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 2, host : "10.10.10.13:6668", arbiterOnly : true, priority : 0}</div><div>&nbsp; &nbsp; ]</div><div>}</div><div>&gt; rs.initiate(cfg)</div><div>&gt; rs.status()</div><div><br></div><div>$ mongo 10.10.10.12:6666/admin</div><div>&gt; cfg = {</div><div>&nbsp; &nbsp; _id : "digoal003",</div><div>&nbsp; &nbsp; members : [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 0, host : "10.10.10.12:6666", arbiterOnly : false, priority : 2},</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 1, host : "10.10.10.13:6667", arbiterOnly : false, priority : 1},</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 2, host : "10.10.10.10:6668", arbiterOnly : true, priority : 0}</div><div>&nbsp; &nbsp; ]</div><div>}</div><div>&gt; rs.initiate(cfg)</div><div>&gt; rs.status()</div><div><br></div><div>$ mongo 10.10.10.13:6666/admin</div><div>&gt; cfg = {</div><div>&nbsp; &nbsp; _id : "digoal004",</div><div>&nbsp; &nbsp; members : [</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 0, host : "10.10.10.13:6666", arbiterOnly : false, priority : 2},</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 1, host : "10.10.10.12:6667", arbiterOnly : false, priority : 1},</div><div>&nbsp; &nbsp; &nbsp; &nbsp; {_id : 2, host : "10.10.10.11:6668", arbiterOnly : true, priority : 0}</div><div>&nbsp; &nbsp; ]</div><div>}</div><div>&gt; rs.initiate(cfg)</div><div>&gt; rs.status()</div><div>&gt; db.addUser("","")</div><div><br></div><div><br></div><div>configsrv配置</div><div>configdb :&nbsp;</div><div>10.10.10.14:6669 , 10.10.10.14:6670 , 10.10.10.16:6669</div><div>10.10.10.14 :&nbsp;</div><div># mkdir /data1/mongoconfigdbdata</div><div># ln -s /data1/mongoconfigdbdata /mongodata</div><div># mkdir -p /mongodata/digoal/6669/data01/mongodb_datafile</div><div># mkdir -p /mongodata/digoal/6669/data01/mongodb_etc</div><div># mkdir -p /mongodata/digoal/6669/data01/mongodb_run</div><div># mkdir -p /opt/mongodata/digoal/6670/data01/mongodb_datafile</div><div># mkdir -p /opt/mongodata/digoal/6670/data01/mongodb_etc</div><div># mkdir -p /opt/mongodata/digoal/6670/data01/mongodb_run</div><div># chown -R mongo:mongo /data1/mongoconfigdbdata</div><div># chown -R mongo:mongo /opt/mongodata</div><div>10.10.10.16 :&nbsp;</div><div># mkdir -p /opt/mongodata/digoal/6669/data01/mongodb_datafile</div><div># mkdir -p /opt/mongodata/digoal/6669/data01/mongodb_etc</div><div># mkdir -p /opt/mongodata/digoal/6669/data01/mongodb_run</div><div># mkdir -p /opt/mongodata/digoal/6666/data01/mongodb_datafile</div><div># mkdir -p /opt/mongodata/digoal/6666/data01/mongodb_etc</div><div># mkdir -p /opt/mongodata/digoal/6666/data01/mongodb_run</div><div># chown -R mongo:mongo /opt/mongodata</div><div><br></div><div>configsrv配置文件示例</div><div>logpath = /var/log/mongo/mongod_6669.log</div><div>logappend = true</div><div>fork = true</div><div>port = 6669</div><div>bind_ip = 0.0.0.0</div><div>dbpath = /opt/mongodata/digoal/6669/data01/mongodb_datafile</div><div>maxConns = 12000</div><div>pidfilepath = /opt/mongodata/digoal/6669/data01/mongodb_run/mongod_6669.pid</div><div>nounixsocket = true</div><div>directoryperdb = true</div><div>oplogSize = 31280</div><div>journal = true</div><div>journalCommitInterval = 40</div><div>profile = 1</div><div>slowms = 50</div><div>noauth = true</div><div>nohttpinterface = true</div><div>nssize = 2000</div><div><br></div><div>mongos配置文件</div><div>logpath = /var/log/mongo/mongod_6666.log</div><div>logappend = true</div><div>fork = true</div><div>port = 6666</div><div>bind_ip = 0.0.0.0</div><div>maxConns = 200</div><div>pidfilepath = /opt/mongodata/digoal/6666/data01/mongodb_run/mongod_6666.pid</div><div><br></div><div>启动configsrv,mongos</div><div>10.10.10.14 :&nbsp;</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --configsvr -f /mongodata/digoal/6669/data01/mongodb_etc/mongod_6669.conf"</div><div># su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --configsvr -f /opt/mongodata/digoal/6670/data01/mongodb_etc/mongod_6670.conf"</div><div>10.10.10.16 :&nbsp;</div><div>su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongod --configsvr -f /opt/mongodata/digoal/6669/data01/mongodb_etc/mongod_6669.conf"</div><div>su - mongo -c "/opt/mongodb-linux-x86_64-2.0.0/bin/mongos --configdb 10.10.10.14:6669,10.10.10.14:6670,10.10.10.16:6669 -f /opt/mongodata/digoal/6666/data01/mongodb_etc/mongod_6666.conf"</div><div><br></div><div>shard配置,连接到mongos</div><div>&gt; db.adminCommand( { addShard : "digoal001/10.10.10.10:6666,10.10.10.11:6667,10.10.10.12:6668" } )</div><div>&gt; db.adminCommand( { addShard : "digoal002/10.10.10.11:6666,10.10.10.10:6667,10.10.10.13:6668" } )</div><div>&gt; db.adminCommand( { addShard : "digoal003/10.10.10.12:6666,10.10.10.13:6667,10.10.10.10:6668" } )</div><div>&gt; db.adminCommand( { addShard : "digoal004/10.10.10.13:6666,10.10.10.12:6667,10.10.10.11:6668" } )</div></div><div><br></div><div><div><div>mongod.conf配置文件范例 :&nbsp;</div><div># mongod_$PORT.conf</div><div># where to log</div><div>logpath = /var/log/mongo/mongod_6666.log</div><div>logappend = true</div><div># fork and run in background</div><div>fork = true</div><div>port = 6666</div><div>bind_ip = 0.0.0.0</div><div>dbpath = /mongodata/digoal/6666/data01/mongodb_datafile</div><div>maxConns = 12000</div><div>pidfilepath = /mongodata/digoal/6666/data01/mongodb_run/mongod_6666.pid</div><div>nounixsocket = true</div><div>directoryperdb = true</div><div>oplogSize = 31280</div><div>journal = true</div><div>journalCommitInterval = 40</div><div>profile = 1</div><div>slowms = 50</div><div># Disables write-ahead journaling</div><div># nojournal = true</div><div># Enables periodic logging of CPU utilization and I/O wait</div><div>#cpu = true</div><div># Turn on/off security. &nbsp;Off is currently the default</div><div>noauth = true</div><div>#auth = true</div><div># Verbose logging output.</div><div>#verbose = true</div><div># Inspect all client data for validity on receipt (useful for</div><div># developing drivers)</div><div>#objcheck = true</div><div># Enable db quota management</div><div>#quota = true</div><div># Set oplogging level where n is</div><div># &nbsp; 0=off (default)</div><div># &nbsp; 1=W</div><div># &nbsp; 2=R</div><div># &nbsp; 3=both</div><div># &nbsp; 7=W+some reads</div><div>#oplog = 0</div><div># Ignore query hints</div><div>#nohints = true</div><div># Disable the HTTP interface (Defaults to localhost:27018).</div><div>nohttpinterface = true</div><div># Turns off server-side scripting. &nbsp;This will result in greatly limited</div><div># functionality</div><div>#noscripting = true</div><div># Turns off table scans. &nbsp;Any query that would do a table scan fails.</div><div>#notablescan = true</div><div># Disable data file preallocation.</div><div>#noprealloc = true</div><div># Specify .ns file size(MB) for new databases.</div><div>nssize = 2000</div><div># Accout token for Mongo monitoring server.</div><div>#mms-token = &lt;token&gt;</div><div># Server name for Mongo monitoring server.</div><div>#mms-name = &lt;server-name&gt;</div><div># Ping interval for Mongo monitoring server.</div><div>#mms-interval = &lt;seconds&gt;</div><div># Replication Options</div><div># in replicated mongo databases, specify here whether this is a slave or master</div><div>#slave = true</div><div>#source = master.example.com</div><div># Slave only: specify a single database to replicate</div><div>#only = master.example.com</div><div># or</div><div>#master = true</div><div>#source = slave.example.com</div><div><br></div><div>由于使用了noauth=true,所以配置防火墙是很有必要的.以下是范例</div><div>iptables防火墙配置</div><div>-A RH-Firewall-1-INPUT -i lo -j ACCEPT</div><div># mongoDB:mongod,configsrv,mongos</div><div>-A RH-Firewall-1-INPUT -m iprange --src-range 10.10.10.10-10.10.10.13 -j ACCEPT</div><div>-A RH-Firewall-1-INPUT -m iprange --src-range 10.10.10.14-10.10.10.16 -j ACCEPT</div><div># mongoDB:appserver</div><div>-A RH-Firewall-1-INPUT -m iprange --src-range xxx.xxx.xxx.xxx-xxx.xxx.xxx.xxx -p tcp -m multiport --destination-ports 6666,6669:6670 -j ACCEPT</div><div># mongoDB:reject Port</div><div>-A RH-Firewall-1-INPUT -m state --state NEW -p tcp -m multiport --destination-ports 6666,6669:6670 -j REJECT</div></div></div><div><br></div><div>最后是GRIDFS的注意事项 :&nbsp;</div><div><span style="color: rgb(76, 58, 44); font-family: helvetica, arial, sans-serif; font-size: 13px; line-height: 17px; background-color: rgb(243, 244, 235);"  >"chunks" collection should be sharded using the index "files_id: 1". The existing "files_id, n" index created by the drivers cannot be used to shard on "files_id" (this is a sharding limitation that will be fixed), so you have to create a separate index on just "files_id". The reason to use "files_id" is so that all chunks of a given file live on the same shard, which is safer and allows "filemd5" command to work (required by certain drivers).</span></div></div>
	</div>
</div>
</body>
</html>