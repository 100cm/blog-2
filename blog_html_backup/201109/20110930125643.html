<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL xid(int4) to txid(int8)</h2>
	<h5 id="">2011-09-30 12:56:43&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402011830105342275/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="white-space:pre;"   > </span>这篇BLOG的起源还是MVCC，PostgreSQL很多东西都是围绕 MVCC展开的。所以建议可以阅读一下手册的相关部分，另外我之前也写过几篇和MVCC相关的BLOG，有兴趣的朋友可以浏览一下。</div><div><span style="white-space:pre;"   > </span>今天我的同事francs发现我们昨天出现BUG的那个数据库的事务ID到100多亿了，正常情况下应该是在2^32约40亿以内的。</div><div>一开始我也非常惊讶，怎么会出现这样的情况。</div><div>到数据库里面查询，果真如此 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select txid_current();</font></div><div><font size="2"   >&nbsp;txid_current&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; 11658174917</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>那么怎么会这样呢?</div><div>我们先来看看数据库里面xid类型的定义 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select * from pg_type where typname='xid';</font></div><div><font size="2"   >&nbsp;typname | typnamespace | typowner | typlen | typbyval | typtype | typcategory | typispreferred | typisdefined | typdelim | typrelid</font></div><div><font size="2"   >&nbsp;| typelem | typarray | typinput | typoutput | typreceive | typsend | typmodin | typmodout | typanalyze | typalign | typstorage | ty</font></div><div><font size="2"   >pnotnull | typbasetype | typtypmod | typndims | typdefaultbin | typdefault&nbsp;</font></div><div><font size="2"   >---------+--------------+----------+--------+----------+---------+-------------+----------------+--------------+----------+---------</font></div><div><font size="2"   >-+---------+----------+----------+-----------+------------+---------+----------+-----------+------------+----------+------------+---</font></div><div><font size="2"   >---------+-------------+-----------+----------+---------------+------------</font></div><div><font size="2"   >&nbsp;xid &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 11 | &nbsp; &nbsp; &nbsp; 10 | &nbsp; &nbsp; &nbsp;4 | t &nbsp; &nbsp; &nbsp; &nbsp;| b &nbsp; &nbsp; &nbsp; | U &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | f &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| t &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| , &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp;0</font></div><div><font size="2"   >&nbsp;| &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; 1011 | xidin &nbsp; &nbsp;| xidout &nbsp; &nbsp;| xidrecv &nbsp; &nbsp;| xidsend | - &nbsp; &nbsp; &nbsp; &nbsp;| - &nbsp; &nbsp; &nbsp; &nbsp; | - &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp; &nbsp; &nbsp; &nbsp;| p &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| f&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp;-1 | &nbsp; &nbsp; &nbsp; &nbsp;0 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>显然长度是4字节，32位没错的。</div><div><br></div><div>然后来看看&nbsp;txid_current()这个函数返回的结果是什么类型 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# \df+ txid_current</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List of functions</font></div><div><font size="2"   >&nbsp; &nbsp;Schema &nbsp; | &nbsp; &nbsp; Name &nbsp; &nbsp; | Result data type | Argument data types | &nbsp;Type &nbsp;| Volatility | &nbsp;Owner &nbsp; | Language | Source code &nbsp;| &nbsp; &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; Description &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------+--------------+------------------+---------------------+--------+------------+----------+----------+--------------+----</font></div><div><font size="2"   >------------------------</font></div><div><font size="2"   >&nbsp;pg_catalog | txid_current | bigint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | normal | stable &nbsp; &nbsp; | postgres | internal | txid_current | get</font></div><div><font size="2"   >&nbsp;current transaction ID</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>结果是bigint,占据64个比特位.</div><div>那么为什么系统要使用这样一个超出XID范围的结果类型呢？</div><div>手册中有指出 :&nbsp;</div><div><pre class="prettyprint"   ><p><font size="2"   >The internal transaction ID type (<tt style="line-height: 19px;"   >xid</tt>) is 32 bits wide and wraps around every 4 billion transactions. However, these functions export a 64-bit format that is extended with an<span style="line-height: 19px;"   >"epoch"</span>&nbsp;counter so it will not wrap around during the life of an installation.</font></p></pre></div><div><font face="verdana, sans-serif"   ><span style="font-size: 12px; line-height: 19px;"   >具体可以参考我另一篇BLOG</span></font></div><div><a href="http://blog.163.com/digoal@126/blog/static/16387704020118301222520/"   >http://blog.163.com/digoal@126/blog/static/16387704020118301222520/</a> </div><div><font face="verdana, sans-serif"   ><span style="font-size: 12px; line-height: 19px;"   >所以</span></font>txid_current()这个函数和tuple里面查到的xmin,xmax就没有太大的可比性了，计算年龄还是使用系统提供的age()函数比较靠谱。</div><div>关于这个函数返回的值，源码文件txid.c有这样一段 :&nbsp;</div><div><br></div><div><div><pre class="prettyprint"   ><p></p><div>&nbsp;<span style="font-size: small;"   >* &nbsp; &nbsp; &nbsp;Export internal transaction IDs to user level.</span></div><p></p><div><div><font size="2"   >&nbsp;*</font></div><div><font size="2"   >&nbsp;* Note that only top-level transaction IDs are ever converted to TXID.</font></div><div><font size="2"   >&nbsp;* This is important because TXIDs frequently persist beyond the global</font></div><div><font size="2"   >&nbsp;* xmin horizon, or may even be shipped to other machines, so we cannot</font></div><div><font size="2"   >&nbsp;* rely on being able to correlate subtransaction IDs with their parents</font></div><div><font size="2"   >&nbsp;* via functions such as SubTransGetTopmostTransaction().</font></div><div><font size="2"   >&nbsp;*</font></div></div><div><div><font size="2"   >/* txid will be signed int8 in database, so must limit to 63 bits */</font></div><div><font size="2"   >#define MAX_TXID &nbsp; UINT64CONST(0x7FFFFFFFFFFFFFFF)</font></div></div><div><font size="2"   >/*</font></div><div><div><font size="2"   >&nbsp;* do a TransactionId -&gt; txid conversion for an XID near the given epoch</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >static txid</font></div><div><font size="2"   >convert_xid(TransactionId xid, const TxidEpoch *state)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; uint64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;epoch;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* return special xid's as-is */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (!TransactionIdIsNormal(xid))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return (txid) xid;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* xid can be on either side when near wrap-around */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; epoch = (uint64) state-&gt;epoch;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (xid &gt; state-&gt;last_xid &amp;&amp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TransactionIdPrecedes(xid, state-&gt;last_xid))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; epoch--;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else if (xid &lt; state-&gt;last_xid &amp;&amp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TransactionIdFollows(xid, state-&gt;last_xid))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; epoch++;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; return (epoch &lt;&lt; 32) | xid;</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div><p></p></div><div>【关于freeze的示例】</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create table txid_test(id int);</font></div><div><font size="2"   >CREATE TABLE</font></div><div><div><font size="2"   >digoal=# insert into txid_test values (1);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# insert into txid_test values (2);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# insert into txid_test values (3);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# select relfrozenxid,age(relfrozenxid) from pg_class where relname='txid_test';</font></div><div><font size="2"   >&nbsp;relfrozenxid | &nbsp;age &nbsp;&nbsp;</font></div><div><font size="2"   >--------------+--------</font></div><div><font size="2"   >&nbsp; &nbsp;3070449946 | 361154</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select id,age(xmin),xmin,txid_current() from txid_test ;</font></div><div><font size="2"   >&nbsp;id | &nbsp;age &nbsp;| &nbsp; &nbsp;xmin &nbsp; &nbsp;| txid_current&nbsp;</font></div><div><font size="2"   >----+-------+------------+--------------</font></div><div><font size="2"   >&nbsp; 1 | 16578 | 3070798309 | &nbsp;11660749479</font></div><div><font size="2"   >&nbsp; 2 | 14431 | 3070800456 | &nbsp;11660749479</font></div><div><font size="2"   >&nbsp; 3 | 13595 | 3070801292 | &nbsp;11660749479</font></div><div><font size="2"   >(3 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# vacuum full txid_test ;</font></div><div><font size="2"   >VACUUM</font></div><div><font size="2"   >digoal=# select relfrozenxid,age(relfrozenxid) from pg_class where relname='txid_test';</font></div><div><font size="2"   >&nbsp;relfrozenxid | &nbsp;age &nbsp;&nbsp;</font></div><div><font size="2"   >--------------+--------</font></div><div><font size="2"   >&nbsp; &nbsp;3070449946 | 386485</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select id,age(xmin),xmin,txid_current() from txid_test ;</font></div><div><font size="2"   >&nbsp;id | &nbsp;age &nbsp;| &nbsp; &nbsp;xmin &nbsp; &nbsp;| txid_current&nbsp;</font></div><div><font size="2"   >----+-------+------------+--------------</font></div><div><font size="2"   >&nbsp; 1 | 46133 | 3070798309 | &nbsp;11660779034</font></div><div><font size="2"   >&nbsp; 2 | 43986 | 3070800456 | &nbsp;11660779034</font></div><div><font size="2"   >&nbsp; 3 | 43150 | 3070801292 | &nbsp;11660779034</font></div><div><font size="2"   >(3 rows)</font></div></div><p></p></pre></div><div># vacuum full并没有对xmin进行修改，原因是这个表的relfrozenxid 的年龄未达到触发freeze事件 (默认是5000W).</div><div># 下面是强制使用freeze。</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# vacuum full freeze txid_test ;&nbsp;</font></div><div><font size="2"   >VACUUM</font></div><div><font size="2"   >digoal=# select relfrozenxid from pg_class where relname='txid_test';</font></div><div><font size="2"   >&nbsp;relfrozenxid&nbsp;</font></div><div><font size="2"   >--------------</font></div><div><font size="2"   >&nbsp; &nbsp;3070104853</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select id,age(xmin),xmin,txid_current() from txid_test ;</font></div><div><font size="2"   >&nbsp;id | &nbsp; &nbsp;age &nbsp; &nbsp; | xmin | txid_current&nbsp;</font></div><div><font size="2"   >----+------------+------+--------------</font></div><div><font size="2"   >&nbsp; 1 | 2147483647 | &nbsp; &nbsp;2 | &nbsp;11660042643</font></div><div><font size="2"   >&nbsp; 2 | 2147483647 | &nbsp; &nbsp;2 | &nbsp;11660042643</font></div><div><font size="2"   >&nbsp; 3 | 2147483647 | &nbsp; &nbsp;2 | &nbsp;11660042643</font></div><div><font size="2"   >(3 rows)</font></div><p></p></pre></div></div><div>所以xmin发生了变化，</div><div>另外需要注意的是，freeze后的tuple, xmin 变成了一个FrozenXID，这个XID不参与比较，始终认为这个ID比其他的XID老，所以用 age 去计算始终显示&nbsp;2147483647&nbsp;。</div><div>术语解释请参考后面的术语部分。</div><div><br></div><div>【关于freeze的示例2】</div><div># 这个示例和前面是一样的，只是凸显了set vacuum_freeze_min_age=0;的效果。</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# delete from txid_test ;</font></div><div><font size="2"   >DELETE 3</font></div><div><font size="2"   >digoal=# alter table txid_test set (autovacuum_freeze_min_age=0);</font></div><div><font size="2"   >ALTER TABLE</font></div><div><font size="2"   >digoal=# insert into txid_test values (1);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# insert into txid_test values (2);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# insert into txid_test values (3);</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# select relfrozenxid,age(relfrozenxid) from pg_class where relname='txid_test';</font></div><div><font size="2"   >&nbsp;relfrozenxid | &nbsp;age &nbsp;&nbsp;</font></div><div><font size="2"   >--------------+--------</font></div><div><font size="2"   >&nbsp; &nbsp;3070449946 | 852352</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# vacuum full txid_test;</font></div><div><font size="2"   >VACUUM</font></div><div><font size="2"   >digoal=# select relfrozenxid,age(relfrozenxid) from pg_class where relname='txid_test';</font></div><div><font size="2"   >&nbsp;relfrozenxid | &nbsp;age &nbsp;&nbsp;</font></div><div><font size="2"   >--------------+--------</font></div><div><font size="2"   >&nbsp; &nbsp;3070449946 | 859567</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select id,age(xmin),xmin,txid_current() from txid_test ;</font></div><div><font size="2"   >&nbsp;id | &nbsp;age &nbsp;| &nbsp; &nbsp;xmin &nbsp; &nbsp;| txid_current&nbsp;</font></div><div><font size="2"   >----+-------+------------+--------------</font></div><div><font size="2"   >&nbsp; 1 | 19165 | 3071293757 | &nbsp;11661247514</font></div><div><font size="2"   >&nbsp; 2 | 17484 | 3071295438 | &nbsp;11661247514</font></div><div><font size="2"   >&nbsp; 3 | 16902 | 3071296020 | &nbsp;11661247514</font></div><div><font size="2"   >(3 rows)</font></div><p></p></pre></div><div># 显然，没有XMIN没有发生变化，原因是autovacuum_freeze_min_age=0是autovacuum触发时生效的。我们手工的vacuum不会去读这个属性。</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# set vacuum_freeze_min_age=0;</font></div><div><font size="2"   >SET</font></div><div><font size="2"   >digoal=# vacuum full txid_test ;</font></div><div><font size="2"   >VACUUM</font></div><div><font size="2"   >digoal=# select id,age(xmin),xmin,txid_current() from txid_test ;</font></div><div><font size="2"   >&nbsp;id | &nbsp; &nbsp;age &nbsp; &nbsp; | xmin | txid_current&nbsp;</font></div><div><font size="2"   >----+------------+------+--------------</font></div><div><font size="2"   >&nbsp; 1 | 2147483647 | &nbsp; &nbsp;2 | &nbsp;11661255866</font></div><div><font size="2"   >&nbsp; 2 | 2147483647 | &nbsp; &nbsp;2 | &nbsp;11661255866</font></div><div><font size="2"   >&nbsp; 3 | 2147483647 | &nbsp; &nbsp;2 | &nbsp;11661255866</font></div><div><font size="2"   >(3 rows)</font></div><p></p></pre></div></div><div># 这里就生效了。</div><div><br></div><div>【术语】</div><div><br></div><div>参数 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><span style="font-family: verdana, sans-serif; line-height: 19px;"   ><font size="2"   ><tt>vacuum_freeze_min_age</tt>&nbsp;(<tt>integer</tt>)</font></span></div><div><span style="line-height: normal;"   ><dd style="font-family: verdana, sans-serif;"   ><p style="line-height: 1.5em; margin-top: 1.2em; margin-right: 0em; margin-bottom: 1.2em; margin-left: 0em;"   ><font size="2"   >Specifies the cutoff age (in transactions) that&nbsp;<tt>VACUUM</tt>&nbsp;should use to decide whether to replace transaction IDs with&nbsp;<tt>FrozenXID</tt>&nbsp;while scanning a table. The default is 50 million transactions.&nbsp;</font></p></dd></span></div><p></p></pre></div><div><br></div><div>vacuum 加上freeze参数解释 :&nbsp;</div><div><font size="2"   face="monospace"   ><dt style="line-height: 19px;"   ><pre class="prettyprint"   ><p></p><dt><tt>FREEZE</tt></dt><dd><p style="line-height: 1.5em; margin-top: 1.2em; margin-right: 0em; margin-bottom: 1.2em; margin-left: 0em;"   >Selects aggressive&nbsp;"freezing"&nbsp;of tuples. Specifying&nbsp;<tt>FREEZE</tt>&nbsp;is equivalent to performing&nbsp;<tt>VACUUM</tt>&nbsp;with the&nbsp;<a style="color: rgb(0, 102, 162); " rel="nofollow" href="http://www.postgresql.org/docs/9.1/static/runtime-config-client.html#GUC-VACUUM-FREEZE-MIN-AGE"   >vacuum_freeze_min_age</a>&nbsp;parameter set to zero.</p></dd><p></p></pre></dt></font></div><div><br></div><div>系统表pg_class的relfrozenxid列的解释 :&nbsp;</div><div><span style="font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"   ><table border="1"   style="margin-left: 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: collapse; margin-top: 2ex; margin-right: 0px; margin-bottom: 2ex; background-color: rgb(224, 236, 239); border-top-width: 2px; border-right-width: 2px; border-bottom-width: 2px; border-left-width: 2px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223);"   ><tbody><tr><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(239, 239, 239); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>relfrozenxid</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(239, 239, 239); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>xid</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(239, 239, 239); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >&nbsp;</td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(239, 239, 239); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >All transaction IDs before this one have been replaced with a permanent (<span>"frozen"</span>) transaction ID in this table. This is used to track whether the table needs to be vacuumed in order to prevent transaction ID wraparound or to allow&nbsp;<tt>pg_clog</tt>&nbsp;to be shrunk. Zero (<tt>InvalidTransactionId</tt>) if the relation is not a table.</td></tr></table></span></div><div><br></div><div>涉及到txid的系统函数 :&nbsp;</div><div><span style="font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"   ><p style="font-size: 1em; line-height: 1.5em; margin-top: 1.2em; margin-right: 0em; margin-bottom: 1.2em; margin-left: 0em;"   >The functions shown in&nbsp;<a style="color: rgb(0, 102, 162); text-decoration: underline; " rel="nofollow" href="http://www.postgresql.org/docs/9.1/static/functions-info.html#FUNCTIONS-TXID-SNAPSHOT"   >Table 9-52</a>&nbsp;provide server transaction information in an exportable form. The main use of these functions is to determine which transactions were committed between two snapshots.</p><div><a name="FUNCTIONS-TXID-SNAPSHOT" rel="nofollow"   ></a><p style="font-size: 1em; line-height: 1.5em; margin-top: 1.2em; margin-right: 0em; margin-bottom: 1.2em; margin-left: 0em;"   ><b style="font-weight: bold;"   >Table 9-52. Transaction IDs and Snapshots</b></p><table border="1"   style="margin-left: 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: collapse; margin-top: 2ex; margin-right: 0px; margin-bottom: 2ex; background-color: rgb(224, 236, 239); border-top-width: 2px; border-right-width: 2px; border-bottom-width: 2px; border-left-width: 2px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223);"   ><colgroup><col><col><col><thead><tr><th style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >Name</th><th style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >Return Type</th><th style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >Description</th></tr></thead><tbody><tr><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt><code style="font-size: 1em;"   >txid_current()</code></tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>bigint</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >get current transaction ID</td></tr><tr><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt><code style="font-size: 1em;"   >txid_current_snapshot()</code></tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>txid_snapshot</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >get current snapshot</td></tr><tr><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt><code style="font-size: 1em;"   >txid_snapshot_xip(<tt style="font-size: 1em;"   >txid_snapshot</tt>)</code></tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>setof bigint</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >get in-progress transaction IDs in snapshot</td></tr><tr><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt><code style="font-size: 1em;"   >txid_snapshot_xmax(<tt style="font-size: 1em;"   >txid_snapshot</tt>)</code></tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>bigint</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >get&nbsp;<tt>xmax</tt>&nbsp;of snapshot</td></tr><tr><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt><code style="font-size: 1em;"   >txid_snapshot_xmin(<tt style="font-size: 1em;"   >txid_snapshot</tt>)</code></tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>bigint</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >get&nbsp;<tt>xmin</tt>&nbsp;of snapshot</td></tr><tr><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(239, 239, 239); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt><code style="font-size: 1em;"   >txid_visible_in_snapshot(<tt style="font-size: 1em;"   >bigint</tt>,&nbsp;<tt style="font-size: 1em;"   >txid_snapshot</tt>)</code></tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(239, 239, 239); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>boolean</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(239, 239, 239); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >is transaction ID visible in snapshot? (do not use with subtransaction ids)</td></tr></table></div><p style="font-size: 1em; line-height: 1.5em; margin-top: 1.2em; margin-right: 0em; margin-bottom: 1.2em; margin-left: 0em;"   >The internal transaction ID type (<tt>xid</tt>) is 32 bits wide and wraps around every 4 billion transactions. However, these functions export a 64-bit format that is extended with an<span>"epoch"</span>&nbsp;counter so it will not wrap around during the life of an installation. The data type used by these functions,&nbsp;<tt>txid_snapshot</tt>, stores information about transaction ID visibility at a particular moment in time. Its components are described in&nbsp;<a style="color: rgb(0, 102, 162); text-decoration: underline; " rel="nofollow" href="http://www.postgresql.org/docs/9.1/static/functions-info.html#FUNCTIONS-TXID-SNAPSHOT-PARTS"   >Table 9-53</a>.</p><div><a name="FUNCTIONS-TXID-SNAPSHOT-PARTS" rel="nofollow"   ></a><p style="font-size: 1em; line-height: 1.5em; margin-top: 1.2em; margin-right: 0em; margin-bottom: 1.2em; margin-left: 0em;"   ><b style="font-weight: bold;"   >Table 9-53. Snapshot Components</b></p><table border="1"   style="margin-left: 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: collapse; margin-top: 2ex; margin-right: 0px; margin-bottom: 2ex; background-color: rgb(224, 236, 239); border-top-width: 2px; border-right-width: 2px; border-bottom-width: 2px; border-left-width: 2px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223);"   ><colgroup><col><col><thead><tr><th style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >Name</th><th style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >Description</th></tr></thead><tbody><tr><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>xmin</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >Earliest transaction ID (txid) that is still active. All earlier transactions will either be committed and visible, or rolled back and dead.</td></tr><tr><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>xmax</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >First as-yet-unassigned txid. All txids greater than or equal to this are not yet started as of the time of the snapshot, and thus invisible.</td></tr><tr><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   ><tt>xip_list</tt></td><td style="border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; background-color: rgb(255, 255, 255); border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(167, 198, 223); border-right-color: rgb(167, 198, 223); border-bottom-color: rgb(167, 198, 223); border-left-color: rgb(167, 198, 223); padding-top: 0.5ex; padding-right: 0.5ex; padding-bottom: 0.5ex; padding-left: 0.5ex;"   >Active txids at the time of the snapshot. The list includes only those active txids between&nbsp;<tt>xmin</tt>&nbsp;and&nbsp;<tt>xmax</tt>; there might be active txids higher than&nbsp;<tt>xmax</tt>. A txid that is<tt>xmin &lt;= txid &lt; xmax</tt>&nbsp;and not in this list was already completed at the time of the snapshot, and thus either visible or dead according to its commit status. The list does not include txids of subtransactions.</td></tr></table></div><p style="font-size: 1em; line-height: 1.5em; margin-top: 1.2em; margin-right: 0em; margin-bottom: 1.2em; margin-left: 0em;"   ><tt>txid_snapshot</tt>'s textual representation is&nbsp;<tt><tt style="font-size: 1em;"   ><i>xmin</i></tt>:<tt style="font-size: 1em;"   ><i>xmax</i></tt>:<tt style="font-size: 1em;"   ><i>xip_list</i></tt></tt>. For example&nbsp;<tt>10:20:10,14,15</tt>&nbsp;means&nbsp;<tt>xmin=10, xmax=20, xip_list=10, 14, 15</tt>.</p></span></div><div><br></div><div>截取自pg_resetxlog man page :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The transaction ID epoch is not actually stored anywhere in the database except in the field that is set by</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pg_resetxlog, so any value will work so far as the database itself is concerned. You might need to adjust</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;this value to ensure that replication systems such as Slony-I work correctly ― if so, an appropriate value</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;should be obtainable from the state of the downstream replicated database.</font></div><p></p></pre></div><div><br></div><div>那么如何得知数据库集群的epoch呢? 这个数据在控制文件中.</div><div>pg_controldata $PGDATA</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >.....</font></div><div><font size="2"   >Latest checkpoint's NextXID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0/136923</font></div><div><font size="2"   >.....</font></div><p></p></pre></div><div>这里了的第一个斜线前面的部分0就是当前数据库集群的epoch.</div><div>对应源码</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >  src/bin/pg_controldata/pg_controldata.c</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; printf(_("Latest checkpoint's NextXID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%u/%u\n"),</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ControlFile.checkPointCopy.nextXidEpoch,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ControlFile.checkPointCopy.nextXid);</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >  src/include/catalog/pg_control.h</font></div><div><font size="2"   >typedef struct CheckPoint<br>{<br>        XLogRecPtr      redo;                   /* next RecPtr available when we began to<br>                                                                 * create CheckPoint (i.e. REDO start point) */<br>        TimeLineID      ThisTimeLineID; /* current TLI */<br>        TimeLineID      PrevTimeLineID; /* previous TLI, if this record begins a new<br>                                                                 * timeline (equals ThisTimeLineID otherwise) */<br>        bool            fullPageWrites; /* current full_page_writes */<br>        uint32          nextXidEpoch;   /* higher-order bits of nextXid */</font></div><p></p></pre></div><div><br></div><div><br></div><div>【参考】</div><a rel="nofollow" href="http://www.postgresql.org/docs/9.1/static/functions-info.html#FUNCTIONS-TXID-SNAPSHOT-PARTS"   >http://www.postgresql.org/docs/9.1/static/functions-info.html#FUNCTIONS-TXID-SNAPSHOT-PARTS</a><div>src/backend/utils/adt/txid.c<br><wbr><div>man pg_resetxlog</div><div><a rel="nofollow" href="http://www.postgresql.org/docs/9.1/static/routine-vacuuming.html"   >http://www.postgresql.org/docs/9.1/static/routine-vacuuming.html</a></div><div><br></div></div></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">hxre - 2011-09-30 13:07:16</h5>
				<div>学习了<br><br></div>
			</div>
	</div>
</div>
</body>
</html>