<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">[PG News] Separating bgwriter and checkpointer</h2>
	<h5 id="">2011-09-22 10:50:43&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402011822105043482/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"  ><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >几个看点 : </pre></span><span style="font-family: monospace; white-space: pre;"  >1. splits bgwriter into 2 processes: checkpointer and bgwriter.</span></div><div><span style="font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"  ></span><span style="font-family: monospace; white-space: pre;"  >2. replace polling loops with latches for power reduction</span><font face="verdana, sans-serif"  ><span style="font-size: 12px; line-height: normal;"  >.</span></font></div><div><font face="verdana, sans-serif"  ><span style="font-size: 12px; line-height: normal;"  >3. &nbsp;</span></font><span style="font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"  ><span style="font-family: monospace; font-size: 14px; line-height: 22px; white-space: pre;"  >could there be any benefit to spawning a separate bgwriter process for each tablespace.</span><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >Currently the bgwriter process performs both background writing, checkpointing and some other duties.&nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >This means that we can't perform the final checkpoint fsync without stopping background writing, so there is a negative performance effect from doing both things in one process. &nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >Additionally, our aim in 9.2 is to replace polling loops with latches for power reduction.&nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >The complexity of the bgwriter loops is high and it seems unlikely to come up with a clean approach using latches. &nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >This patch splits bgwriter into 2 processes: checkpointer and bgwriter, seeking to avoid contentious changes.&nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >Additional changes are expected in this release to build upon these changes for both new processes, though this patch stands on its own as both a performance vehicle and in some ways a refcatoring to simplify the code. &nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >Checkpointer does the important things, "new bgwriter" just does background writing and so is much less important than before.&nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >Current patch has a bug at shutdown I've not located yet, but seems likely is a simple error.&nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >That is mainly because for personal reasons I've not been able to work on the patch recently.&nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >I expect to be able to fix that later in the CF.</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >/*********************************************************************/</pre></span></div><div><span style="font-family: verdana, sans-serif; font-size: 12px; line-height: normal;"  ><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >While you're already splitting up bgwriter, could there be any benefit to spawning a separate bgwriter process for each tablespace? &nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >If your database has one tablespace on a fast I/O system and another on a slow one, the slow tablespace would also bog down background writing for the fast tablespace.&nbsp;</pre><pre style="font-family: monospace; font-size: 1.2em; word-wrap: break-word;"  >But I don't know whether that's really a problem or not.<br></pre></span></div><div><br></div>【原文】<wbr><div><a rel="nofollow" href="http://archives.postgresql.org/message-id/CA+U5nMLv2ah-HNHaQ=2rxhp_hDJ9jcf-LL2kW3sE4msfnUw9gA@mail.gmail.com"  >http://archives.postgresql.org/message-id/CA+U5nMLv2ah-HNHaQ=2rxhp_hDJ9jcf-LL2kW3sE4msfnUw9gA@mail.gmail.com</a></div></div>
	</div>
</div>
</body>
</html>