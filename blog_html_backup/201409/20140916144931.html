<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">ganglia gweb AUTH configure with nginx</h2>
	<h5 id="">2014-09-16 14:49:31&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201481552751497/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>ganglia的认证是基于Zend框架来写的, 权限分布可见<span style="line-height: 28px;"   >lib/GangliaAcl.php. (默认所有集群归属于ALL_CLUSTERS, 所有用户归属于GUEST, 默认GUEST角色有所有cluster的VIEW权限, 没有EDIT权限. ADMIN角色有所有cluster的VIEW和EDIT权限; 私有cluster: GUEST没有私有cluster的任何权限(其实是回收了VIEW权限))</span></div><div><span style="line-height: 28px;"   >参考 :&nbsp;</span></div><div><a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://framework.zend.com/manual/1.12/en/zend.acl.html"   >http://framework.zend.com/manual/1.12/en/zend.acl.html</a></div><div><p style="line-height: 28px;"   ></p><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ganglia-web]# pwd</font></div><div><font size="2"   >/data01/web/ganglia-web</font></div><div><font size="2"   >[root@db-172-16-3-221 ganglia-web]# cat lib/GangliaAcl.php&nbsp;</font></div><div><font size="2"   >&lt;?php</font></div><div><font size="2"   >require_once 'Zend/Acl.php';</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >class GangliaAcl extends Zend_Acl {</font></div><div><font size="2"   >&nbsp; private static $acl;</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; // resources</font></div><div><font size="2"   >&nbsp; const ALL_RESOURCES = 'all_resources';</font></div><div><font size="2"   >&nbsp; const &nbsp;ALL_CLUSTERS = 'all_clusters';</font></div><div><font size="2"   >&nbsp; const &nbsp; &nbsp; ALL_VIEWS = 'all_views';</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; // privileges</font></div><div><font size="2"   >&nbsp; const &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VIEW = 'view';</font></div><div><font size="2"   >&nbsp; const &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EDIT = 'edit';</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; // roles</font></div><div><font size="2"   >&nbsp; const &nbsp; &nbsp; &nbsp; &nbsp; ADMIN = 'admin';</font></div><div><font size="2"   >&nbsp; const &nbsp; &nbsp; &nbsp; &nbsp; GUEST = 'guest';</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; public static function getInstance() {</font></div><div><font size="2"   >&nbsp; &nbsp; if(is_null(self::$acl)) {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; self::$acl = new GangliaAcl();</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; return self::$acl;</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; public function __construct() {</font></div><div><font size="2"   >&nbsp; &nbsp; // define default groups</font></div><div><font size="2"   >&nbsp; &nbsp; $this-&gt;addRole( new Zend_Acl_Role(GangliaAcl::GUEST))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-&gt;addRole( new Zend_Acl_Role(GangliaAcl::ADMIN));</font></div><div><font size="2"   >&nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; // define default resources</font></div><div><font size="2"   >&nbsp; &nbsp; // all clusters should be children of GangliaAcl::ALL_CLUSTERS</font></div><div><font size="2"   >&nbsp; &nbsp; $this-&gt;add( new Zend_Acl_Resource(GangliaAcl::ALL_RESOURCES) );</font></div><div><font size="2"   >&nbsp; &nbsp; $this-&gt;add( new Zend_Acl_Resource(GangliaAcl::ALL_CLUSTERS), GangliaAcl::ALL_RESOURCES);</font></div><div><font size="2"   >&nbsp; &nbsp; $this-&gt;add( new Zend_Acl_Resource(GangliaAcl::ALL_VIEWS), GangliaAcl::ALL_RESOURCES);</font></div><div><font size="2"   >&nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; // guest can view everything and edit nothing.</font></div><div><font size="2"   >&nbsp; &nbsp; $this-&gt;allow(GangliaAcl::GUEST, GangliaAcl::ALL_RESOURCES, GangliaAcl::VIEW);</font></div><div><font size="2"   >&nbsp; &nbsp; $this-&gt;deny(GangliaAcl::GUEST, GangliaAcl::ALL_RESOURCES, GangliaAcl::EDIT);</font></div><div><font size="2"   >&nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; $this-&gt;allow(GangliaAcl::ADMIN, GangliaAcl::ALL_RESOURCES, GangliaAcl::EDIT);</font></div><div><font size="2"   >&nbsp; &nbsp; $this-&gt;allow(GangliaAcl::ADMIN, GangliaAcl::ALL_RESOURCES, GangliaAcl::VIEW);</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; public function addPrivateCluster($cluster) {</font></div><div><font size="2"   >&nbsp; &nbsp; $this-&gt;add( new Zend_Acl_Resource($cluster), self::ALL_CLUSTERS );</font></div><div><font size="2"   >&nbsp; &nbsp; //$this-&gt;allow(self::ADMIN, $cluster, 'edit');</font></div><div><font size="2"   >&nbsp; &nbsp; $this-&gt;deny(self::GUEST, $cluster);</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >}</font></div><div><font size="2"   >?&gt;</font></div><p></p></pre></div><p style="line-height: 28px;"   ></p></div><div>如果配置了认证, 并且没有集群的查询权限的话</div><div>(<span style="line-height: 28px;"   >if( ! checkAccess( $resource, GangliaAcl::VIEW, $conf ) ) {</span><span style="line-height: 28px;"   >),&nbsp;</span></div><div><span style="line-height: 28px;"   >WEB页面会报错, 见index.php</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-221 ganglia-web]# less index.php&nbsp;</font></div></div><div><font size="2"   >&lt;?php</font></div><div><font size="2"   >include_once "./eval_conf.php";</font></div><div><font size="2"   ># ATD - function.php must be included before get_context.php. &nbsp;It defines some needed functions.</font></div><div><font size="2"   >include_once "./functions.php";</font></div><div><font size="2"   >include_once "./get_context.php";</font></div><div><font size="2"   >include_once "./ganglia.php";</font></div><div><font size="2"   >include_once "./get_ganglia.php";</font></div><div><font size="2"   >include_once "./dwoo/dwooAutoload.php";</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >$resource = GangliaAcl::ALL_CLUSTERS;</font></div><div><font size="2"   >if( $context == "grid" ) {</font></div><div><font size="2"   >&nbsp; $resource = $grid;</font></div><div><font size="2"   >} else if ( $context == "cluster" || $context == "host" ) {</font></div><div><font size="2"   >&nbsp; $resource = $clustername;&nbsp;</font></div><div><font size="2"   >}</font></div><div><font size="2"   >if( ! checkAccess( $resource, GangliaAcl::VIEW, $conf ) ) {</font></div><div><font size="2"   >&nbsp; header( "HTTP/1.1 403 Access Denied" );</font></div><div><font size="2"   >&nbsp; die("&lt;html&gt;&lt;head&gt;&lt;title&gt;Access Denied&lt;/title&gt;&lt;body&gt;&lt;h4&gt;Sorry, you do not have access to this resource.&lt;/h4&gt;&lt;/body&gt;&lt;/html&gt;");</font></div><div><font size="2"   >}</font></div><p></p></pre></div></div><div>报错如下 :&nbsp;</div><div><div><img title="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   alt="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/S9fp4B6fmwhmQRUkvjPvkg==/6619068795304800229.png"   ></div></div><div><br></div><div>登录相关的php, login.php文件 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >login.php</font></div><div><div><font size="2"   >&lt;?php</font></div><div><font size="2"   >require_once 'eval_conf.php';</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if($conf['auth_system'] == 'enabled' &amp;&amp; isSet($_SERVER['REMOTE_USER']) &amp;&amp; !empty($_SERVER['REMOTE_USER']) ){</font></div><div><font size="2"   >&nbsp; $auth = GangliaAuth::getInstance();</font></div><div><font size="2"   >&nbsp; $auth-&gt;setAuthCookie($_SERVER['REMOTE_USER']);</font></div><div><font size="2"   >&nbsp; $redirect_to = isSet( $_SERVER['HTTP_REFERER'] ) ? $_SERVER['HTTP_REFERER'] : 'index.php';</font></div><div><font size="2"   >&nbsp; header("Location: $redirect_to");</font></div><div><font size="2"   >&nbsp; die();</font></div><div><font size="2"   >}</font></div><div><font size="2"   >?&gt;</font></div><div><font size="2"   >&lt;html&gt;</font></div><div><font size="2"   >&lt;head&gt;</font></div><div><font size="2"   >&nbsp; &lt;title&gt;Authentication Failed&lt;/title&gt;</font></div><div><font size="2"   >&lt;/head&gt;</font></div><div><font size="2"   >&lt;body&gt;</font></div><div><font size="2"   >&nbsp; &lt;h1&gt;We were unable to log you in.&lt;/h1&gt;</font></div><div><font size="2"   >&nbsp; &lt;div&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;?php if( ! isSet($conf['auth_system'] ) ) { ?&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;code&gt;$conf['auth_system']&lt;/code&gt; is not defined.&lt;br/&gt; &nbsp;Please notify an administrator.</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;?php } else if($conf['auth_system'] == 'disabled' || $conf['auth_system'] == 'readonly') { ?&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Authentication is disabled by Ganglia configuration.&lt;br/&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;code&gt;$conf['auth_system'] = '&lt;?php echo $conf['auth_system']; ?&gt;';&lt;/code&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;?php } else { ?&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Authentication is not configured correctly. &nbsp;The web server must provide an authenticated username.</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;?php } ?&gt;</font></div><div><font size="2"   >&nbsp; &lt;/div&gt;</font></div><div><font size="2"   >&lt;/body&gt;</font></div><div><font size="2"   >&lt;/html&gt;</font></div></div><p></p></pre></div><div><br></div><div>下面是一个简单的配置过程 :&nbsp;</div><div>首先要安装一个httpd-tools工具, 用<span style="line-height: 28px;"   >htpasswd命令</span><span style="line-height: 28px;"   >生成加密的密码 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   ># yum install -y httpd-tools</font></span></div><div><div><font size="2"   >[root@db-172-16-3-221 ganglia-web]# htpasswd -h</font></div><div><font size="2"   >Usage:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; htpasswd [-cmdpsD] passwordfile username</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; htpasswd -b[cmdpsD] passwordfile username password</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; htpasswd -n[mdps] username</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; htpasswd -nb[mdps] username password</font></div><div><font size="2"   >&nbsp;-c &nbsp;Create a new file.</font></div><div><font size="2"   >&nbsp;-n &nbsp;Don't update file; display results on stdout.</font></div><div><font size="2"   >&nbsp;-m &nbsp;Force MD5 encryption of the password.</font></div><div><font size="2"   >&nbsp;-d &nbsp;Force CRYPT encryption of the password (default).</font></div><div><font size="2"   >&nbsp;-p &nbsp;Do not encrypt the password (plaintext).</font></div><div><font size="2"   >&nbsp;-s &nbsp;Force SHA encryption of the password.</font></div><div><font size="2"   >&nbsp;-b &nbsp;Use the password from the command line rather than prompting for it.</font></div><div><font size="2"   >&nbsp;-D &nbsp;Delete the specified user.</font></div><div><font size="2"   >On Windows, NetWare and TPF systems the '-m' flag is used by default.</font></div><div><font size="2"   >On all other systems, the '-p' flag will probably not work.</font></div></div><p></p></pre></div><div>生成一个密码, 例如使用SHA1封装 :&nbsp;</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ganglia-web]# htpasswd -nms digoal</font></div><div><font size="2"   >New password: 输入DIGOAL123</font></div><div><font size="2"   >Re-type new password: 输入DIGOAL123</font></div><div><font size="2"   >digoal:{SHA}Jh72pRIlkvfUk6oy1iOvxHmRMVg=</font></div><p></p></pre></div><div>编辑密码文件:&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi /opt/nginx1.6.0/conf/htpasswd</font></div><div><div><font size="2"   ># comment</font></div><div><font size="2"   >#name1:password1</font></div><div><font size="2"   >#name2:password2:comment</font></div><div><font size="2"   >#name3:password3</font></div><div><font size="2"   >digoal:{SHA}Jh72pRIlkvfUk6oy1iOvxHmRMVg=</font></div></div><p></p></pre></div><div>修改密码文件权限如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ganglia-web]# chown root:nobody /opt/nginx1.6.0/conf/htpasswd&nbsp;</font></div><div><font size="2"   >[root@db-172-16-3-221 ganglia-web]# chmod 640 /opt/nginx1.6.0/conf/htpasswd&nbsp;</font></div><div><font size="2"   >[root@db-172-16-3-221 ganglia-web]# ll /opt/nginx1.6.0/conf/htpasswd&nbsp;</font></div><div><font size="2"   >-rw-r----- 1 root nobody 110 Sep 16 10:35 /opt/nginx1.6.0/conf/htpasswd</font></div><p></p></pre></div></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >按照ganglia的说明, 配置nginx :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># vi /opt/nginx1.6.0/conf/nginx.conf</font></div><div><div><font size="2"   >user &nbsp;nobody;</font></div><div><font size="2"   >worker_processes &nbsp;3;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >error_log &nbsp;logs/error.log;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pid &nbsp; &nbsp; &nbsp; &nbsp;logs/nginx.pid;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >events {</font></div><div><font size="2"   >&nbsp; &nbsp; worker_connections &nbsp;1024;</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >http {</font></div><div><font size="2"   >&nbsp; &nbsp; include &nbsp; &nbsp; &nbsp; mime.types;</font></div><div><font size="2"   >&nbsp; &nbsp; default_type &nbsp;application/octet-stream;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; sendfile &nbsp; &nbsp; &nbsp; &nbsp;on;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; keepalive_timeout &nbsp;65;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; server {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; listen &nbsp; &nbsp; &nbsp; 80;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; server_name &nbsp;localhost;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; root &nbsp; /data01/web/ganglia-web;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; location / {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; index &nbsp;index.html index.htm index.php;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # redirect server error pages to the static page /50x.html</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; error_page &nbsp; 500 502 503 504 &nbsp;/50x.html;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; location = /50x.html {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; root &nbsp; html;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; #</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; location /login.php &nbsp;{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auth_basic &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"Ganglia Access"; &nbsp; &nbsp;# 提示字符串</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auth_basic_user_file &nbsp;/opt/nginx1.6.0/conf/htpasswd; &nbsp; &nbsp; &nbsp;# &nbsp;密码文件</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_param &nbsp;REMOTE_USER &nbsp; &nbsp;$remote_user; &nbsp; # 登录用户名</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; location ~ \.php$ {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_pass &nbsp; 127.0.0.1:9000;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_index &nbsp;index.php;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_param &nbsp;SCRIPT_FILENAME &nbsp;$document_root$fastcgi_script_name;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; include &nbsp; &nbsp; &nbsp; &nbsp;fastcgi_params;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_param &nbsp;ganglia_secret &nbsp; MAFweifwf123_2rfj; &nbsp; &nbsp;# &nbsp;使用这个字符串和username结合加密, 存储cookie</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; }</font></div><div><span style="line-height: 28px;"   ><font size="2"   >}</font></span></div></div><p></p></pre></div><div>重载nginx</div><div><pre class="prettyprint"   ><p><font size="2"   ># nginx -s reload</font></p></pre></div><div>修改gweb的conf.php :&nbsp;</div><div>把认证打开.</div><div><p></p><div><pre class="prettyprint"   ><p></p><div><font size="2"   >#</font></div><div><font size="2"   ># 'readonly': No authentication is required. &nbsp;All users may view all resources. &nbsp;No edits are allowed.</font></div><div><font size="2"   ># &nbsp;'enabled': Guest users may view public clusters. &nbsp;Login is required to make changes. &nbsp;</font></div><div><font size="2"   ># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; An administrator must configure an authentication scheme and ACL rules.</font></div><div><font size="2"   ># 'disabled': Guest users may perform any actions, including edits. &nbsp;No authentication is required.</font></div><div><font size="2"   >$conf['auth_system'] = 'enabled';</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># 添加到末尾部分, ?&gt;之前</font></div><div><font size="2"   >#add by digoal</font></div><div><font size="2"   >$acl = GangliaAcl::getInstance();</font></div><div><font size="2"   >$acl-&gt;addRole( 'digoal', GangliaAcl::ADMIN ); &nbsp; # 新增一个用户名为digoal, 密码在前面配置了.</font></div><div><font size="2"   >$acl-&gt;addPrivateCluster( 'test' ); &nbsp; &nbsp;# test是我们环境中的clustername, 配置在gmond中. 即把test的GUEST的VIEW权限收回.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >?&gt;</font></div><p></p></pre></div><p></p></div><div>因为环境中只有一个test集群, 所以GUEST用户没有了VIEW权限, 也没有看到登录界面, 直接返回错误.</div><div><img title="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   alt="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   src="http://img1.ph.126.net/S9fp4B6fmwhmQRUkvjPvkg==/6619068795304800229.png"   style="line-height: 28px; margin: 0px 10px 0px 0px;"   ></div><div>但是使用login.php也提示错误,&nbsp;</div><div><div><img title="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   alt="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/PPVHZbrqIJUMQfG1eAu-oA==/6608858730329629225.png"   ></div></div><div>这个错误时login.php爆出的, 原因待查.</div><div>浏览器的cookie也清除了, 还是照旧.</div><div><br></div><div>如果不把test集群加入私有集群的话, 页面可以打开, 但是问题来了, EVENT可以添加, 貌似没有起到EDIT的限制. 并且点击login爆同样的错误.</div><div><div><img title="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   alt="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/H1gZ8jweYo6uUGm5m5euRQ==/6608829043515683803.png"   ></div></div><div><br></div><div>登录同样报错 :&nbsp;</div><div><div><img title="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   alt="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/q0PztaZuO-J7g1TpyZSz4A==/6619447027304755252.png"   ></div>也没有登录界面弹出.</div><div><img title="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   alt="ganglia gweb AUTH configure with nginx - 德哥@Digoal - PostgreSQL research"   src="http://img1.ph.126.net/PPVHZbrqIJUMQfG1eAu-oA==/6608858730329629225.png"   style="line-height: 28px; margin: 0px 10px 0px 0px;"   ></div><div><br></div><div>conf.php中可配置的访问控制介绍 :&nbsp;</div><div><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   ><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);"   >Access Controls</h2><div style="box-sizing: border-box;"   ><div style="box-sizing: border-box;"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   >The default access control setup has the following properties: * Guests may view all public clusters. * Admins may view all public &amp; private clusters, and edit configuration (views) for them. * Guests may not view private clusters.</p></div><div style="box-sizing: border-box;"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   ><strong style="box-sizing: border-box;"   >Additional rules may be configured as required. This configuration should go in&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-weight: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >conf.php</code>.</strong>&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >GangliaAcl</code>&nbsp;is based on&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >Zend_Acl</code>. More documentation is available at&nbsp;<a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; background: transparent;" rel="nofollow" href="http://framework.zend.com/manual/en/zend.acl.html"   >http://framework.zend.com/manual/en/zend.acl.html</a>.</p></div><div style="box-sizing: border-box;"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   >Note that there is no built-in distinction between a&nbsp;<em style="box-sizing: border-box;"   >user</em>&nbsp;and a&nbsp;<em style="box-sizing: border-box;"   >group</em>&nbsp;in&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >Zend_Acl</code>. Both are implemented as roles. The system supports the configuration of heirarchical sets of ACL rules. We implement user/group semantics by making all user roles children of the&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >GangliaAcl::GUEST</code>&nbsp;role, and all clusters children of<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >GangliaAcl::ALL</code>.</p></div></div></div><h1 style="box-sizing: border-box; font-size: 2.25em; margin: 1em 0px 16px; line-height: 1.2;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;"   ><a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" name="user-content-constants" aria-hidden="true" rel="nofollow" href="https://github.com/ganglia/ganglia-web/wiki/Authorization-System#constants"   ></a>Constants</h1><table style="box-sizing: border-box; border-collapse: collapse; border-spacing: 0px; margin-top: 0px; margin-bottom: 16px; display: block; width: 580px; overflow: auto; word-break: normal; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6000003814697px;"   ><colgroup style="box-sizing: border-box;"   ><col style="box-sizing: border-box;"   ><col style="box-sizing: border-box;"   ><thead style="box-sizing: border-box;"   ><tr style="box-sizing: border-box; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204);"   ><th style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   >Name</th><th style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   >Meaning</th></tr></thead><tbody style="box-sizing: border-box;"   ><tr style="box-sizing: border-box; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204);"   ><td style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >GangliaAcl::ALL_CLUSTERS</code></p></td><td style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   >Every cluster should descend from this role. Guests have&nbsp;<em style="box-sizing: border-box;"   >view</em>&nbsp;access on<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >GangliaAcl::ALL_CLUSTERS</code>.</p></td></tr><tr style="box-sizing: border-box; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(248, 248, 248);"   ><td style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >GangliaAcl::GUEST</code></p></td><td style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   >Every user should descend from this role. (Users may also have other roles, but this one grants global view privileges to public clusters.)</p></td></tr><tr style="box-sizing: border-box; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204);"   ><td style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >GangliaAcl::ADMIN</code></p></td><td style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   >Admins may access all private clusters and edit configuration for any cluster.</p></td></tr><tr style="box-sizing: border-box; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(248, 248, 248);"   ><td style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >GangliaAcl::VIEW</code></p></td><td style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   >This permission is granted to guests on all clusters, and then selectively denied for private clusters.</p></td></tr><tr style="box-sizing: border-box; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204);"   ><td style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >GangliaAcl::EDIT</code></p></td><td style="box-sizing: border-box; padding: 6px 13px; border: 1px solid rgb(221, 221, 221);"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   >This permission is used to determine if a user may update views and perform any other configuration tasks.</p></td></tr></table><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px;"   ><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);"   ><a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" name="user-content-actions" aria-hidden="true" rel="nofollow" href="https://github.com/ganglia/ganglia-web/wiki/Authorization-System#actions"   ></a>Actions</h2><div style="box-sizing: border-box;"   ><div style="box-sizing: border-box;"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   >Currently we only support two actions,&nbsp;<em style="box-sizing: border-box;"   >view</em>&nbsp;and&nbsp;<em style="box-sizing: border-box;"   >edit</em>. These are applied on a per-cluster basis. So one user may have&nbsp;<em style="box-sizing: border-box;"   >view</em>&nbsp;access to all clusters, but&nbsp;<em style="box-sizing: border-box;"   >edit</em>&nbsp;access to only one.</p></div></div></div><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 25.6000003814697px; margin-bottom: 0px !important;"   ><h2 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.225; font-size: 1.75em;position:inherit; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);"   ><a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" name="user-content-examples" aria-hidden="true" rel="nofollow" href="https://github.com/ganglia/ganglia-web/wiki/Authorization-System#examples"   ></a>Examples</h2><div style="box-sizing: border-box;"   ><div style="box-sizing: border-box;"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   ><strong style="box-sizing: border-box;"   >These should go in your&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; font-weight: normal; line-height: normal; padding: 0.2em 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157);"   >conf.php</code>&nbsp;file.</strong>&nbsp;The usernames you use will be the ones provided by whatever authentication system you are using in Apache. If you want to explicitly allow/deny access to certain clusters, you need to spell that out here.</p></div><div style="box-sizing: border-box;"   ><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit;"   ><a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" name="user-content-accessing-the-acl" aria-hidden="true" rel="nofollow" href="https://github.com/ganglia/ganglia-web/wiki/Authorization-System#accessing-the-acl"   ></a>Accessing the ACL</h3><div style="box-sizing: border-box;"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px;"   >All later examples assume you have this code to start with:</p></div><div style="box-sizing: border-box;"   ><div style="box-sizing: border-box; margin-bottom: 16px; background-image: initial; background-attachment: initial; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"   ><pre style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 0px; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; word-break: normal; background-color: rgb(247, 247, 247);"   ><span style="box-sizing: border-box; color: rgb(0, 128, 128);"   >$acl</span> <span style="box-sizing: border-box; font-weight: bold;"   >=</span> <span style="box-sizing: border-box;"   >GangliaAcl</span><span style="box-sizing: border-box; font-weight: bold;"   >::</span><span style="box-sizing: border-box; color: rgb(0, 128, 128);"   >getInstance</span><span style="box-sizing: border-box;"   >();</span>
</pre></div></div></div><div style="box-sizing: border-box;"   ><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit;"   ><a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" name="user-content-making-a-user-an-admin" aria-hidden="true" rel="nofollow" href="https://github.com/ganglia/ganglia-web/wiki/Authorization-System#making-a-user-an-admin"   ></a>Making a user an admin</h3><div style="box-sizing: border-box;"   ><pre lang=""   style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; background-color: rgb(247, 247, 247);"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: inherit; padding: 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: normal; border: 0px; display: inline; word-wrap: normal; background: transparent;"   >$acl-&gt;addRole( 'username', GangliaAcl::ADMIN );</code></pre></div></div><div style="box-sizing: border-box;"   ><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit;"   ><a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" name="user-content-defining-a-private-cluster" aria-hidden="true" rel="nofollow" href="https://github.com/ganglia/ganglia-web/wiki/Authorization-System#defining-a-private-cluster"   ></a>Defining a private cluster</h3><div style="box-sizing: border-box;"   ><pre lang=""   style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; background-color: rgb(247, 247, 247);"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: inherit; padding: 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: normal; border: 0px; display: inline; word-wrap: normal; background: transparent;"   >$acl-&gt;addPrivateCluster( 'clustername' );</code></pre></div></div><div style="box-sizing: border-box;"   ><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit;"   ><a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" name="user-content-granting-certain-users-access-to-a-private-cluster" aria-hidden="true" rel="nofollow" href="https://github.com/ganglia/ganglia-web/wiki/Authorization-System#granting-certain-users-access-to-a-private-cluster"   ></a>Granting certain users access to a private cluster</h3><div style="box-sizing: border-box;"   ><pre lang=""   style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; background-color: rgb(247, 247, 247);"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: inherit; padding: 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: normal; border: 0px; display: inline; word-wrap: normal; background: transparent;"   >$acl-&gt;addPrivateCluster( 'clustername' );
$acl-&gt;addRole( 'username', GangliaAcl::GUEST );
$acl-&gt;allow( 'username', 'clustername', GangliaAcl::VIEW );</code></pre></div></div><div style="box-sizing: border-box;"   ><h3 style="box-sizing: border-box; margin-top: 1em; margin-bottom: 16px; line-height: 1.43; font-size: 1.5em;position:inherit;"   ><a style="box-sizing: border-box; color: rgb(65, 131, 196); text-decoration: none; position: absolute; top: 0px; bottom: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; background: transparent;" name="user-content-granting-users-access-to-edit-some-clusters" aria-hidden="true" rel="nofollow" href="https://github.com/ganglia/ganglia-web/wiki/Authorization-System#granting-users-access-to-edit-some-clusters"   ></a>Granting users access to edit some clusters</h3><div style="box-sizing: border-box;"   ><pre lang=""   style="box-sizing: border-box; overflow: auto; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 14px; margin-top: 0px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal; background-color: rgb(247, 247, 247);"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; line-height: inherit; padding: 0px; margin: 0px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: normal; border: 0px; display: inline; word-wrap: normal; background: transparent;"   >$acl-&gt;addRole( 'username', GangliaAcl::GUEST );
$acl-&gt;add( new Zend_Acl_Resource( 'clustername' ), GangliaAcl::ALL_CLUSTERS );
$acl-&gt;allow( 'username', 'clustername', GangliaAcl::EDIT );</code></pre></div></div></div></div></div><div><br></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/ganglia/ganglia-web/wiki/Authorization-System"   >https://github.com/ganglia/ganglia-web/wiki/Authorization-System</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://wiki.nginx.org/HttpAuthBasicModule"   >http://wiki.nginx.org/HttpAuthBasicModule</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://nginx.org/en/docs/http/ngx_http_auth_basic_module.html"   >http://nginx.org/en/docs/http/ngx_http_auth_basic_module.html</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://nginx.org/en/docs/http/ngx_http_access_module.html"   >http://nginx.org/en/docs/http/ngx_http_access_module.html</a></div><div>5.&nbsp;<a target="_blank" rel="nofollow" href="http://nginx.org/en/docs/http/ngx_http_auth_request_module.html"   >http://nginx.org/en/docs/http/ngx_http_auth_request_module.html</a></div><div>6.&nbsp;<a target="_blank" rel="nofollow" href="http://framework.zend.com/manual/1.12/en/zend.acl.html"   >http://framework.zend.com/manual/1.12/en/zend.acl.html</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="ganglia gweb AUTH with nginx - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>