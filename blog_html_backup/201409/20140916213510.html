<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">fence_vmware usage with ESX or VCenter, or VSphere ... vmware product</h2>
	<h5 id="">2014-09-16 21:35:10&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020148169845549/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>在使用RHCS搭建HA时, fence是必不可少的, 主要是为了防止脑裂的发生, 例如共享存储时, 只有主节点读写, 当发生failover时, 需要先把主节点fence掉, 才会将服务在备节点激活. 确保同一时间只有一个主机在对存储进行读写.</div><div>在虚拟化环境中, 管理平台可以对虚拟机进行开关机的操作, 所以先天具备fence的功能.</div><div>只要管理平台开放开关机的API, 就可以实现fence.&nbsp;</div><div>本文要说的是vmware的虚拟化产品的fence, RHCS带的fence_vmware就可以实现这个功能 .&nbsp;</div><div><br></div><div><span style="line-height: 28px;"   >在man fence_vmware的STDIN PARAMETERS章节中, 是在/etc/cluster/cluster.conf中可以配置的参数.&nbsp;</span></div><div><span style="line-height: 28px;"   >另外需要注意required parameter是必须配置的. (例如管理平台的IP, 用户, 密码, 以及要操作的虚拟机名, 以及操作选项(reboot, on, off....))</span></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >有些在帮助中没有指出可以配置的范围或枚举值的, 可以参考/usr/sbin/fence_vmware的定义.</span></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >注意fence_vmware 中的重要配置.</span></div><div><span style="line-height: 28px;"   >--ip 指虚拟化管理平台主机的IP(如ESX server), 不是虚拟机的IP.</span></div><div><span style="line-height: 28px;"   >--plug 指虚拟机的名称, 可能是指管理平台中对虚拟机的命名.</span></div><div><span style="line-height: 28px;"   >--username 指虚拟化管理平台分配的用户名</span></div><div><span style="line-height: 28px;"   >--password 密码</span></div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># fence_vmware --help</font></div><div><font size="2"   >Usage:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fence_vmware [options]</font></div><div><font size="2"   >Options:</font></div><div><font size="2"   >&nbsp; &nbsp;-o, --action=&lt;action&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Action: status, reboot (default), off or on</font></div><div><font size="2"   >&nbsp; &nbsp;-a, --ip=&lt;ip&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IP address or hostname of fencing device</font></div><div><font size="2"   >&nbsp; &nbsp;-l, --username=&lt;name&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Login name</font></div><div><font size="2"   >&nbsp; &nbsp;-p, --password=&lt;password&gt; &nbsp; &nbsp; &nbsp;Login password or passphrase</font></div><div><font size="2"   >&nbsp; &nbsp;-S, --password-script=&lt;script&gt; Script to run to retrieve password</font></div><div><font size="2"   >&nbsp; &nbsp;-n, --plug=&lt;id&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Physical plug number on device or</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name of virtual machine</font></div><div><font size="2"   >&nbsp; &nbsp;-e, --exec=&lt;command&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Command to execute</font></div><div><font size="2"   >&nbsp; &nbsp;-d, --vmware_type=&lt;type&gt; &nbsp; &nbsp; &nbsp; Type of VMware to connect</font></div><div><font size="2"   >&nbsp; &nbsp;-x, --ssh &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Use ssh connection</font></div><div><font size="2"   >&nbsp; &nbsp;-k, --identity-file=&lt;filename&gt; Identity file (private key) for ssh&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp;-s, --vmware-datacenter=&lt;dc&gt; &nbsp; VMWare datacenter filter</font></div><div><font size="2"   >&nbsp; &nbsp;-v, --verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Verbose mode</font></div><div><font size="2"   >&nbsp; &nbsp;-D, --debug-file=&lt;debugfile&gt; &nbsp; Debugging to output file</font></div><div><font size="2"   >&nbsp; &nbsp;-V, --version &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Output version information and exit</font></div><div><font size="2"   >&nbsp; &nbsp;-h, --help &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Display this help and exit</font></div><div><font size="2"   >&nbsp; &nbsp;-C, --separator=&lt;char&gt; &nbsp; &nbsp; &nbsp; &nbsp; Separator for CSV created by 'list' operation</font></div><div><font size="2"   >&nbsp; &nbsp;--power-timeout &lt;seconds&gt; &nbsp; &nbsp; &nbsp;Test X seconds for status change after ON/OFF</font></div><div><font size="2"   >&nbsp; &nbsp;--shell-timeout &lt;seconds&gt; &nbsp; &nbsp; &nbsp;Wait X seconds for cmd prompt after issuing command</font></div><div><font size="2"   >&nbsp; &nbsp;--login-timeout &lt;seconds&gt; &nbsp; &nbsp; &nbsp;Wait X seconds for cmd prompt after login</font></div><div><font size="2"   >&nbsp; &nbsp;--power-wait &lt;seconds&gt; &nbsp; &nbsp; &nbsp; &nbsp; Wait X seconds after issuing ON/OFF</font></div><div><font size="2"   >&nbsp; &nbsp;--delay &lt;seconds&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Wait X seconds before fencing is started</font></div><div><font size="2"   >&nbsp; &nbsp;--retry-on &lt;attempts&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Count of attempts to retry power on</font></div><p></p></pre></div><div style="line-height: 28px;"   ><br></div></div><div><span style="line-height: 28px;"   >帮助文件更详细一点, 例如配置/etc/cluster/cluster.conf时, stdin parameter即配置参数.</span></div><div><span style="line-height: 28px;"   >如 :&nbsp;</span></div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &lt;fencedevices&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;fencedevice agent="fence_vmware" ipaddr="管理平台主机IP" login="管理平台用户" name="fence_154" passwd="密码" port="虚拟机在管理平台中的名字"/&gt;</font></div><div><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &lt;/fencedevices&gt;</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   ><br></font></span></div><div><div><font size="2"   >&nbsp; &nbsp; &lt;clusternode name="虚拟机IP" nodeid="1"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;method name="abc"&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;device action="reboot" name="fence_154"/&gt;</font></div><div><span style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &lt;/method&gt;</font></span></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;/fence&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &lt;/clusternode&gt;</font></div></div><p></p></pre></div><div><div style="line-height: 28px;"   >fence_vmware帮助 &nbsp;:&nbsp;</div></div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >man fence_vmware</font></div><div><div><font size="2"   >FENCE_AGENT(8) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FENCE_AGENT(8)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >NAME</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;fence_vmware - Fence agent for VMWare</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >DESCRIPTION</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;fence_vmware is an I/O Fencing agent which can be used with the VMware ESX, VMware ESXi or VMware Server to fence virtual machines.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Before you can use this agent, it must be installed VI Perl Toolkit or vmrun command on every node you want to make fencing.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;VI &nbsp;Perl Toolkit is preferred for VMware ESX/ESXi and Virtual Center. Vmrun command is only solution for VMware Server 1/2 (this command will works against ESX/ESXi</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;3.5 up2 and VC up2 too, but not cluster aware!) and is available as part of VMware VIX API SDK package. VI Perl and VIX API SDK are both available from &nbsp;VMware &nbsp;web</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;pages (not int RHEL repository!).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;You &nbsp;can &nbsp;specify type of VMware you are connecting to with -d switch (or vmware_type for stdin). Possible values are esx, server2 and server1.Default value is esx,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;which will use VI Perl. With server1 and server2, vmrun command is used.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;After you have successfully installed VI Perl Toolkit or VIX API, you should be able to run fence_vmware_helper (part of this agent) or vmrun &nbsp;command. &nbsp;This &nbsp;agent</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;supports only vmrun from version 2.0.0 (VIX API 1.6.0).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;fence_vmware &nbsp;accepts &nbsp;options &nbsp;on the command line as well as from stdin. Fenced sends parameters through stdin when it execs the agent. fence_vmware can be run by</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;itself with command line options. &nbsp;This is useful for testing and for turning outlets on or off from scripts.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;Vendor URL: http://www.vmware.com</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >PARAMETERS</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-o, --action=&lt;action&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Fencing Action (Default Value: reboot)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-a, --ip=&lt;ip&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IP Address or Hostname This parameter is always required.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-l, --username=&lt;name&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Login Name This parameter is always required.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-p, --password=&lt;password&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Login password or passphrase</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-S, --password-script=&lt;script&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Script to retrieve password</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-n, --plug=&lt;id&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Physical plug number or name of virtual machine This parameter is always required.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-e, --exec=&lt;command&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Command to execute</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-d, --vmware_type=&lt;type&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Type of VMware to connect (Default Value: esx)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-x, --ssh</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SSH connection (Default Value: true)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-k, --identity-file=&lt;filename&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Identity file for ssh</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-s, --vmware-datacenter=&lt;dc&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Show only machines in specified datacenter</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-v, --verbose</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Verbose mode</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-D, --debug-file=&lt;debugfile&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write debug information to given file</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-V, --version</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Display version information and exit</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-h, --help</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Display help and exit</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;-C, --separator=&lt;char&gt;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Separator for CSV created by operation list (Default Value: ,)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--power-timeout</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Test X seconds for status change after ON/OFF (Default Value: 20)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--shell-timeout</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wait X seconds for cmd prompt after issuing command (Default Value: 3)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--login-timeout</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wait X seconds for cmd prompt after login (Default Value: 5)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--power-wait</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wait X seconds after issuing ON/OFF (Default Value: 0)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--delay</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wait X seconds before fencing is started (Default Value: 0)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;--retry-on</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Count of attempts to retry power on (Default Value: 1)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >ACTIONS</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;on &nbsp; &nbsp; Power on machine.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;off &nbsp; &nbsp;Power off machine.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;reboot Reboot machine.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;status This returns the status of the plug/virtual machine.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;list &nbsp; List available plugs with aliases/virtual machines if there is support for more then one device. Returns N/A otherwise.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;monitor</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Check if fencing device is running. List available plugs/virtual machines or get status of machine (if it does not support more).</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;metadata</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Display the XML metadata describing this resource.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >STDIN PARAMETERS</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;action Fencing Action (Default Value: reboot)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;ipaddr IP Address or Hostname This parameter is always required.</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;login &nbsp;Login Name This parameter is always required.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;passwd Login password or passphrase</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;passwd_script</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Script to retrieve password</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;port &nbsp; Physical plug number or name of virtual machine This parameter is always required.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;exec &nbsp; Command to execute</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;vmware_type</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Type of VMware to connect (Default Value: esx)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;secure SSH connection (Default Value: true)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;identity_file</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Identity file for ssh</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;vmware_datacenter</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Show only machines in specified datacenter</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;verbose</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Verbose mode</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;debug &nbsp;Write debug information to given file</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;version</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Display version information and exit</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;help &nbsp; Display help and exit</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;separator</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Separator for CSV created by operation list (Default Value: ,)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;power_timeout</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Test X seconds for status change after ON/OFF (Default Value: 20)</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;shell_timeout</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wait X seconds for cmd prompt after issuing command (Default Value: 3)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;login_timeout</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wait X seconds for cmd prompt after login (Default Value: 5)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;power_wait</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wait X seconds after issuing ON/OFF (Default Value: 0)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;delay &nbsp;Wait X seconds before fencing is started (Default Value: 0)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;retry_on</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Count of attempts to retry power on (Default Value: 1)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >fence_vmware (Fence Agent) &nbsp; &nbsp; &nbsp; &nbsp;2009-10-20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FENCE_AGENT(8)</font></div></div><p></p></pre></div><div>对于枚举值vmware_type在帮助中没有指出, 可以查看fence_vmware脚本.</div><div>从脚本fence_vmware的内容可以知道支持的配置vmware_type can be esx,server2 or server1!</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   ># less /usr/sbin/fence_vmware</font></div></div><div><div><font size="2"   ># Default type of vmware</font></div><div><font size="2"   >VMWARE_DEFAULT_TYPE="esx"</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   ># Check vmware type, set vmware_internal_type to one of VMWARE_TYPE_ value and</font></div><div><font size="2"   ># options["-e"] to path (if not specified)</font></div><div><font size="2"   >def vmware_check_vmware_type(options):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; global vmware_internal_type</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; options["-d"]=options["-d"].lower()</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (options["-d"]=="esx"):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vmware_internal_type=VMWARE_TYPE_ESX</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (not options.has_key("-e")):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options["-e"]=VMHELPER_COMMAND</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; elif (options["-d"]=="server2"):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vmware_internal_type=VMWARE_TYPE_SERVER2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (not options.has_key("-e")):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options["-e"]=VMRUN_COMMAND</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; elif (options["-d"]=="server1"):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vmware_internal_type=VMWARE_TYPE_SERVER1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (not options.has_key("-e")):</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options["-e"]=VMRUN_COMMAND</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fail_usage("vmware_type can be esx,server2 or server1!")</font></div></div><p></p></pre></div><div><br></div><div>[转载几篇相关文章]</div><div>如果觉得以上信息量不够的话, 可以参考以下文章 :&nbsp;</div><div><br></div><wbr><div><h1 id="VMwarefenceagentRedHatClusterSuite"   style="font-family: Arial, Verdana, 'Bitstream Vera Sans', Helvetica, sans-serif; letter-spacing: -0.018em; page-break-after: avoid; font-size: 19px; margin: 0.15em 1em 0.5em -18px; line-height: normal;"   >VMware fence agent &amp; Red Hat Cluster Suite<a title="&#38142;&#25509;&#21040;&#36825;&#19968;&#33410;" style="text-decoration: none; color: rgb(215, 215, 215); border: none; font-size: 0.8em; vertical-align: text-top; visibility: hidden;" rel="nofollow" href="https://fedorahosted.org/cluster/wiki/VMware_FencingConfig#VMwarefenceagentRedHatClusterSuite"   ></a></h1><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >Last updated 04-May-2010</p><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >Updates history:</p><ul style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   ><li>2010-05-04: Fence_vmware in RHEL 5.5 is currently fence_vmware_ng (same syntax but named as fence_vmware) so fence_vmware_ng is&nbsp;<strong>no longer needed</strong>.</li><li>2010-15-01: Fence_vmware from RHEL 5.3, 5.4 doesn't work with ESX 4.0. Working agent included</li><li>2009-10-07: Tested on ESX 4.0.0 and vCenter 4.0.0</li><li>2009-01-19: Fixed vmware-ng. Old one mail fail, if somebody turn on VM (for example VMware cluster itself) before agent itself. Before, this leads to error and fence agent fail. Now only warning is displayed and fencing is considered sucessfull.</li><li>2009-01-15: New vmware-ng. There is speed improvement with many VMs registered in VMware for status operation =&gt; whole fencing. Default type esx is now really default.</li></ul><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >We have 2 agents for VMware virtual machines fencing.</p><ul style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   ><li>First fence_vmware is in RHEL5.3 and 5.4/STABLE2 branch. It's designed and tested against VMware ESX server (not ESXi!) and Server 1.x. This one is replaced by new fence_vmware (currently named fence_vmware) in RHEL 5.5/STABLE3</li><li>Second in master/STALBLE3 branch. It's designed and tested against VMware ESX/ESXi/VC and Server 2.x, 1.x. This is what replaced old fence_vmware. (in master/STABLE3 is actually named fence_vmware)</li></ul><h2 id="Fence_vmware"   style="font-family: Arial, Verdana, 'Bitstream Vera Sans', Helvetica, sans-serif; letter-spacing: -0.018em; page-break-after: avoid; font-size: 16px; margin-left: -18px; line-height: normal;"   >Fence_vmware<a title="&#38142;&#25509;&#21040;&#36825;&#19968;&#33410;" style="text-decoration: none; color: rgb(215, 215, 215); border: none; font-size: 0.8em; vertical-align: text-top; visibility: hidden;" rel="nofollow" href="https://fedorahosted.org/cluster/wiki/VMware_FencingConfig#Fence_vmware"   ></a></h2><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >It's union of two older agents. fence_vmware_vix and fence_vmware_vi.</p><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >VI (in following text, VI API is not only original VI Perl API with last version 1.6, but VMware vSphere SDK for Perl too) is VMware API for controlling their main business class of VMware products (ESX/VC). This API is fully cluster aware (VMware cluster). So this agent is able to do fencing guests machines physically running on ESX but managed by VC and able to work without any reconfiguration in case of migrating guest to another ESX.</p><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >VIX is newer API, working on VMware "low-end" products (Server 2.x, 1.x), but there is some support for ESX/ESXi 3.5 update 2 and VC 2.5 update 2. This API is NOT cluster aware, and recommended only for Server 2.x and 1.x. But if you are using only one ESX/ESXi or doesn't have VMware Cluster and never use migration, you can use this API too.</p><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >If you are using RHEL 5.5/RHEL 6 just install fence-agents package and you are ready to use fence_vmware. For distributions with older fence_agetns, you can get this agent from GIT (RHEL 5.5/STABLE3/master) repository and use (please make sure to use current library (fencing.py) too).</p><h3 id="Pre-req"   style="font-family: Arial, Verdana, 'Bitstream Vera Sans', Helvetica, sans-serif; letter-spacing: -0.018em; page-break-after: avoid; font-size: 14px; margin-left: -18px; line-height: normal;"   >Pre-req<a title="&#38142;&#25509;&#21040;&#36825;&#19968;&#33410;" style="text-decoration: none; color: rgb(215, 215, 215); border: none; font-size: 0.8em; vertical-align: text-top; visibility: hidden;" rel="nofollow" href="https://fedorahosted.org/cluster/wiki/VMware_FencingConfig#Pre-req"   ></a></h3><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >VI Perl API or/and VIX API installed on every node in cluster. This is big difference against older agent, where you don't need install anything, but new agent has little less painful configuration (and many bonuses)</p><h3 id="Running"   style="font-family: Arial, Verdana, 'Bitstream Vera Sans', Helvetica, sans-serif; letter-spacing: -0.018em; page-break-after: avoid; font-size: 14px; margin-left: -18px; line-height: normal;"   >Running<a title="&#38142;&#25509;&#21040;&#36825;&#19968;&#33410;" style="text-decoration: none; color: rgb(215, 215, 215); border: none; font-size: 0.8em; vertical-align: text-top; visibility: hidden;" rel="nofollow" href="https://fedorahosted.org/cluster/wiki/VMware_FencingConfig#Running"   ></a></h3><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >If you run fence_vmware with -h you will see something like this:</p><pre style="border: 1px solid rgb(215, 215, 215); margin-right: 1.75em; margin-left: 1.75em; padding: 0.25em; overflow: auto; font-size: 13px; line-height: normal; background: rgb(247, 247, 247);"   >Options:
   -o &lt;action&gt;    Action: status, reboot (default), off or on
   -a &lt;ip&gt;        IP address or hostname of fencing device
   -l &lt;name&gt;      Login name
   -p &lt;password&gt;  Login password or passphrase
   -S &lt;script&gt;    Script to run to retrieve password
   -n &lt;id&gt;        Physical plug number on device or name of virtual machine
   -e             Command to execute
   -d             Type of VMware to connect
   -x             Use ssh connection
   -s             VMWare datacenter filter
   -q             Quiet mode
   -v             Verbose mode
   -D &lt;debugfile&gt; Debugging to output file
   -V             Output version information and exit
   -h             Display this help and exit
</pre><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >Now parameters one by one, little more deeper (format is short option - XML argument name - description).</p><ul style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   ><li>o - action - This is same as with any other agent.</li><li>a - ipaddr - Hostname/IP address of VMware ESX/ESXi/VC or Server 2/1.x. You can enter tcp port in this option in usually way (hostname:port). Port is not needed for standard ESX/ESXi/VC installations, but Server 2.x runs management console on other than usual, so this is why you have this possibility.</li><li>l - login - This is login name for management console.</li><li>p - passwd - This is password for management console.</li><li>S - passwd_script - Script which retrieve password</li><li>n - port - Virtual machine name. This is in case of VI API guest name, you are able to see in VI Client (for example node1). For VIX Api, this name is in form [datacenter] path/name.vmx.</li><li>d - vmware_type - Type of VMware to connect. This parameter distinguish, what API you will use (VI or VIX). Possible values are esx, server2 and server1. Default is esx.<ul><li>esx - VI API is used. Only one cluster aware, able to work with ESX/ESXi/VC</li><li>server2 - VIX API is used. Works for Server 2.x, ESX/ESXi 3.5 update 2 and VC 2.5 update 2, but not cluster aware!!!</li><li>server1 - VIX API. Works only for Server 1.x</li></ul></li><li>s - vmware_datacenter - Used for filter available guests. Default is show all guests in all datacenters. With this, you will be able to fence same-named guests, if they are in different datacenters (so two node1 isn't any problem). If you never have same-named guests, this option is useless for you.</li><li>e - exec - Executable to operate. In every mode, this agent works by forking another helping program, which really does useful work. In case of VI, it's Perl vmware_fence_helper. In case of VIX, it's vmrun from VIX API package. If you have commands on nonstandard locations, you can use this option, to specify, where command lives.</li></ul><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >Example usage of agent in CLI mode: You have VC (named vccenter) with node1 which you want to fence. You will use Administrator account with password pass.</p><pre style="border: 1px solid rgb(215, 215, 215); margin-right: 1.75em; margin-left: 1.75em; padding: 0.25em; overflow: auto; font-size: 13px; line-height: normal; background: rgb(247, 247, 247);"   >fence_vmware -a vccenter -l Administrator -p pass -n 'node1'
</pre><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >If everything works, you can modify your cluster.conf as follows (in this example, you have two nodes, guest1 and guest2):</p><pre style="border: 1px solid rgb(215, 215, 215); margin-right: 1.75em; margin-left: 1.75em; padding: 0.25em; overflow: auto; font-size: 13px; line-height: normal; background: rgb(247, 247, 247);"   >      ...
      &lt;clusternodes&gt;
              &lt;clusternode name="guest1" nodeid="1" votes="1"&gt;
                      &lt;fence&gt;
                              &lt;method name="1"&gt;
                                      &lt;device name="vmware1"/&gt;
                              &lt;/method&gt;
                      &lt;/fence&gt;
              &lt;/clusternode&gt;
              &lt;clusternode name="guest2" nodeid="2" votes="1"&gt;
                      &lt;fence&gt;
                              &lt;method name="1"&gt;
                                      &lt;device name="vmware2"/&gt;
                              &lt;/method&gt;
                      &lt;/fence&gt;
              &lt;/clusternode&gt;
      &lt;/clusternodes&gt;
      &lt;fencedevices&gt;
              &lt;fencedevice agent="fence_vmware" ipaddr="vccenter" login="Administrator" name="vmware1" passwd="pass" port="guest1"/&gt;
              &lt;fencedevice agent="fence_vmware" ipaddr="vccenter" login="Administrator" name="vmware2" passwd="pass" port="guest2"/&gt;
      &lt;/fencedevices&gt;
      ...
</pre><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >You can test setup with fence_node fqdn command.</p><h3 id="Changingconfigurationfromoldfence_vmwaretonewfence_vmware"   style="font-family: Arial, Verdana, 'Bitstream Vera Sans', Helvetica, sans-serif; letter-spacing: -0.018em; page-break-after: avoid; font-size: 14px; margin-left: -18px; line-height: normal;"   >Changing configuration from old fence_vmware to new fence_vmware<a title="&#38142;&#25509;&#21040;&#36825;&#19968;&#33410;" style="text-decoration: none; color: rgb(215, 215, 215); border: none; font-size: 0.8em; vertical-align: text-top; visibility: hidden;" rel="nofollow" href="https://fedorahosted.org/cluster/wiki/VMware_FencingConfig#Changingconfigurationfromoldfence_vmwaretonewfence_vmware"   ></a></h3><ul style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   ><li>Install needed VI Perl API on every node</li><li>remove login, and passwd parameter</li><li>change vmlogin to login and vmpasswd to passwd</li><li>change port value to shorter name (basically remove /full/path/ and .vmx)</li><li>If you have vmipaddr, delete ipaddr and change vmippadr to ipaddr.</li></ul><h3 id="Problems"   style="font-family: Arial, Verdana, 'Bitstream Vera Sans', Helvetica, sans-serif; letter-spacing: -0.018em; page-break-after: avoid; font-size: 14px; margin-left: -18px; line-height: normal;"   >Problems<a title="&#38142;&#25509;&#21040;&#36825;&#19968;&#33410;" style="text-decoration: none; color: rgb(215, 215, 215); border: none; font-size: 0.8em; vertical-align: text-top; visibility: hidden;" rel="nofollow" href="https://fedorahosted.org/cluster/wiki/VMware_FencingConfig#Problems"   ></a></h3><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >One of biggest problem of ESX 3.5/ESXi 3.5/VC 2.5 behaves very badly in case you have many virtual machines registered, because get list of VMs takes just too long. This will make fencing of larger datacenter unusable, because in case of 100+ registered VMs, whole fencing can take few minutes. This appears to be fixed in ESX 4.0.0/vCenter 4.0.0 (200+ registered VMs, fencing of one takes ~17 sec).. In case you don't want to upgrade, you can use separate datacenter for each cluster.</p><h2 id="OldFence_vmware"   style="font-family: Arial, Verdana, 'Bitstream Vera Sans', Helvetica, sans-serif; letter-spacing: -0.018em; page-break-after: avoid; font-size: 16px; margin-left: -18px; line-height: normal;"   >Old Fence_vmware<a title="&#38142;&#25509;&#21040;&#36825;&#19968;&#33410;" style="text-decoration: none; color: rgb(215, 215, 215); border: none; font-size: 0.8em; vertical-align: text-top; visibility: hidden;" rel="nofollow" href="https://fedorahosted.org/cluster/wiki/VMware_FencingConfig#OldFence_vmware"   ></a></h2><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >This is older fence agent, which should work on every ESX server, which has allowed ssh connection and has vmware-cmd command on it. Basic idea of this agent is to connect via ssh to ESX server, there run vmware-cmd which is able to run/shutdown virtual machine.</p><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >In ESX 4.0, vmware-cmd changed little, so it will not work anymore. You can solve this, by deleting lines 32 and 33 ('if options.has_key("-A"):' and 'cmd_line+=" -v"') or download<a title="&#22312; VMware_FencingConfig &#20013;&#30340;&#38468;&#20214; 'fence_vmware.gz'" style="text-decoration: none; color: rgb(187, 0, 0); border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: rgb(187, 187, 187);" class="attachment" rel="nofollow" href="https://fedorahosted.org/cluster/attachment/wiki/VMware_FencingConfig/fence_vmware.gz"   >fence_vmware.gz</a><a title="&#19979;&#36733;" class="trac-rawlink" rel="nofollow" href="https://fedorahosted.org/cluster/raw-attachment/wiki/VMware_FencingConfig/fence_vmware.gz"   >?</a>, unpack it and replace original /sbin/fence_vmware.</p><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >Biggest problem of this solution is many parameters, which must be entered.</p><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >If you run fence_vmware with -h you will see something like this:</p><pre style="border: 1px solid rgb(215, 215, 215); margin-right: 1.75em; margin-left: 1.75em; padding: 0.25em; overflow: auto; font-size: 13px; line-height: normal; background: rgb(247, 247, 247);"   >   -o &lt;action&gt;    Action: status, reboot (default), off or on
   -a &lt;ip&gt;        IP address or hostname of fencing device
   -l &lt;name&gt;      Login name
   -p &lt;password&gt;  Login password or passphrase
   -S &lt;script&gt;    Script to run to retrieve password
   -x             Use ssh connection
   -k &lt;filename&gt;  Identity file (private key) for ssh
   -n &lt;id&gt;        Physical plug number on device or name of virtual machine
   -A &lt;ip&gt;        IP address or hostname of managed VMware ESX (default localhost)
   -L &lt;name&gt;      VMware ESX management login name
   -P &lt;password&gt;  VMware ESX management login password
   -B &lt;script&gt;    Script to run to retrieve VMware ESX management password
   -q             Quiet mode
   -v             Verbose mode
   -D &lt;debugfile&gt; Debugging to output file
   -V             Output version information and exit
   -h             Display this help and exit
</pre><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >Now parameters one by one, little more deeper (format is short option - XML argument name - description).</p><ul style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   ><li>o - action - This is same as with any other agent.</li><li>a - ipaddr - Hostname/IP address of VMware ESX ssh</li><li>l - login - This is login name for ESX ssh</li><li>p - passwd - This is password for ESX ssh</li><li>S - passwd_script - Script which retrieve password</li><li>A - vmipaddr - VMware ESX hostname/ip adress. Here it starts to be more confusing. What's the biggest difference between -a and -A? -a is address of computer where you want ssh to. -A is address of VMware server to operate. This is mostly localhost (think, that after you ssh to your ESX, you wan't operate on that machine -&gt; localhost).</li><li>L - vmlogin - VMware ESX user login. Difference between -l and -L is mostly same as -a and -A. -L is login to VMware operating server.</li><li>P - vmpasswd - VMWare esx user password.</li><li>B - vmpasswd_script - Script to retrieve -P. This script is runned on GUEST! machine, not on VMware ESX machine!</li><li>n - port - Virtual machine name. This is output of vmware-cmd -L, mostly something like /vmfs/volumes/48bfcbd1-4624461c-8250-<a title="&#22312;&#29256;&#26412;&#24211;&#20013;&#27809;&#26377;&#21464;&#26356;&#38598; 0015c5f3ef0f" style="color: rgb(153, 153, 136);" rel="nofollow"   >0015c5f3ef0f/Rhel/Rhel.vmx</a>.</li></ul><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >I'm big fan of pictures, so example situation:</p><pre style="border: 1px solid rgb(215, 215, 215); margin-right: 1.75em; margin-left: 1.75em; padding: 0.25em; overflow: auto; font-size: 13px; line-height: normal; background: rgb(247, 247, 247);"   >  
+---------------------------------------------------------------------------------------+
| +----------                                                                           |
| | guest1  | ssh to VMware ESX - can be, where guest1 run                              |
| | RHEL 5  |------------------+                                                        |
| +---------+                  |                                                        |
|                             \/                                                        |
| +----------      +--------SSH (22)---------------------------------+                  |
| | guest2  |      |        ------&gt; run vmware-cmd with params off --|-&gt; Kill guest1 VM | 
| | RHEL 5  |      |                                                 |                  |
| +---------+      |    dom0 - VMware management console             |                  |
|                  | (192.168.1.1) - Has user test with password test|                  |
|                  |               - Has vmware-cmd                  |                  |
|                  +-------------------------------------------------+                  |
|                                                                                       |
|            VMware ESX hypervisor                                                      |
+---------------------------------------------------------------------------------------+
</pre><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >As you can see, guest1 connect to VMware management console (with hostname/login/password (-a/-l/-p) for ssh) and there, vmware-cmd is runned (with hostname/login/password (-A/-L/-P for VMware).</p><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >So why we have 2 set's of parameters? Because:</p><ul style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   ><li>On guest machine, you don't need to install anything. No vmware-cmd. You just connect to other machine, which has this command.</li><li>On dom0, ssh is not allowed for user root. So we can't use root login/password.</li><li>Mostly, owner of Virtual Machine is root, but again, ssh is not allowed for that user.</li></ul><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >Recomended way, how to use this agent is:</p><ul style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   ><li>Install ESX server and set root pasword (for example root)</li><li>Create normal (non-root) user on VMware dom0 (in this example, I will suspect user test with password test)</li><li>Create virtual machine (there is funny thing. You must use Windows, because web console is not able to create new virtual machine :) )</li><li>Install your cluster node</li></ul><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >If everything done, test fencing via command line (on one of guests)</p><pre style="border: 1px solid rgb(215, 215, 215); margin-right: 1.75em; margin-left: 1.75em; padding: 0.25em; overflow: auto; font-size: 13px; line-height: normal; background: rgb(247, 247, 247);"   >fence_vmware -a 192.168.1.1 -l test -p test -L root -P root -o status -n /vmfs/volumes/48bfcbd1-4624461c-8250-0015c5f3ef0f/Rhel/Rhel.vmx
</pre><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >You should get status of virtual machine named Rhel.</p><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >If everything works, you can modify your cluster.conf like:</p><pre style="border: 1px solid rgb(215, 215, 215); margin-right: 1.75em; margin-left: 1.75em; padding: 0.25em; overflow: auto; font-size: 13px; line-height: normal; background: rgb(247, 247, 247);"   >      ...
      &lt;clusternodes&gt;
              &lt;clusternode name="guest1" nodeid="1" votes="1"&gt;
                      &lt;fence&gt;
                              &lt;method name="1"&gt;
                                      &lt;device name="vmware1"/&gt;
                              &lt;/method&gt;
                      &lt;/fence&gt;
              &lt;/clusternode&gt;
              &lt;clusternode name="guest2" nodeid="2" votes="1"&gt;
                      &lt;fence&gt;
                              &lt;method name="1"&gt;
                                      &lt;device name="vmware2"/&gt;
                              &lt;/method&gt;
                      &lt;/fence&gt;
              &lt;/clusternode&gt;
      &lt;/clusternodes&gt;
      &lt;fencedevices&gt;
              &lt;fencedevice agent="fence_vmware" ipaddr="192.168.1.1" login="test" name="vmware1" passwd="test" vmlogin="root" vmpasswd="root" port="PATH_TO_VMX"/&gt;
              &lt;fencedevice agent="fence_vmware" ipaddr="192.168.1.1" login="test" name="vmware2" passwd="test" vmlogin="root" vmpasswd="root" port="PATH_TO_VMX"/&gt;
      &lt;/fencedevices&gt;
      ...
</pre><h2 id="RecomendationforeveryVMware"   style="font-family: Arial, Verdana, 'Bitstream Vera Sans', Helvetica, sans-serif; letter-spacing: -0.018em; page-break-after: avoid; font-size: 16px; margin-left: -18px; line-height: normal;"   >Recomendation for every VMware<a title="&#38142;&#25509;&#21040;&#36825;&#19968;&#33410;" style="text-decoration: none; color: rgb(215, 215, 215); border: none; font-size: 0.8em; vertical-align: text-top; visibility: hidden;" rel="nofollow" href="https://fedorahosted.org/cluster/wiki/VMware_FencingConfig#RecomendationforeveryVMware"   ></a></h2><p style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; font-size: 13px; line-height: normal;"   >The vmware "client" machine should have VMware Tools installed. So I recommend to install vmware tools in all cluster machine. This improve speed of guest.</p></div><div><br></div><div><br></div><div><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >rhel的集群软件，最让人纠结的就是fence这个设备，在xen的虚拟化平台，尚有"Virtual Machine Fence”可用，可"在Vmware虚拟化平台下，fence设备就没有现成的。我搜索了许多资料，基本上没看到解决办法，有人提出过RHCS是有可用的vmware fence，但语焉不详，又似遮遮掩掩。</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >功夫不负有心人，综合多方面资料，总算是找到解决办法:https://fedorahosted.org/cluster/wiki/VMware_FencingConfig 。该文章本事在redhat官网的，但是已经被删除，幸好这还有一篇，这个貌似是fedora的某个网站还有保存这篇文章，强烈建议先看看这篇文章。</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   ><strong style="color: rgb(34, 34, 34);"   >文章简单说明：</strong></p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >1.Vcenter就具有fencing功能，可以当作一个fence设备，同理vmware vSphere(ESX)主机也是。</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >2.rhel5.4版本及其以下的系统中，用vmware_fence_ng连接fence,在rhel5.5及其以上版本的系统中，该工具已经被命名为vmware_fence，和vmware_fence_ng语法一样。</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   ><strong style="color: rgb(34, 34, 34);"   >配置方法：</strong></p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >RHCS的安装及配置步骤略。</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >RHCS最重要的配置文件师/etc/cluster/cluster.conf文件，所有和集群有关的配置都在里面，包括fence的配置。</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >打开/etc/cluster/cluster.conf文件，定位到&lt;clusternodes&gt;...&lt;/clusternodes&gt;和&lt;fencedevices&gt;...&lt;/fencedevices&gt;。按照如下格式修改：</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;clusternodes&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;clusternode name="guest1" nodeid="1" votes="1"&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;fence&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;method name="1"&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;device name="vmware1"/&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;/method&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;/fence&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;clusternode name="guest2" nodeid="2" votes="1"&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;fence&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;method name="1"&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;device name="vmware2"/&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;/method&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;/fence&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;/clusternode&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;fencedevices&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;fencedevice agent="fence_vmware" ipaddr="vccenter" login="Administrator" name="vmware1" passwd="pass" port="guest1"/&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;fencedevice agent="fence_vmware" ipaddr="vccenter" login="Administrator" name="vmware2" passwd="pass" port="guest2"/&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >&lt;/fencedevices&gt;</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >说明：</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >agent固定为fence_vmware或者fence_vmware_ng，ipaddr为vccenter的主机名或者IP地址，login为vccenter的用户名，name为给该fence设置的命名，也就是device name，passwd为"login"登录的密码，port为该虚拟机在Vcenter中的命名。</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >然后安装在操作系统中安装vSphere SDK For Perlhttp://www.vmware.com/support/developer/viperltoolkit/。选择适合自己虚拟机主机的版本。解压安装，运行vmware_install.pl即可。</p><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   ><strong style="color: rgb(34, 34, 34); font-size: 12px; line-height: 18px;"   >配置权限：&nbsp;</strong><span style="font-size: 12px; line-height: 18px;"   >最后，在vcenter中为相应的账户配置权限（如果不介意用Administrator账户，也可以不用配置）。 选择相应的虚拟机，(给用户)添加权限。</span></p><pre style="color: rgb(102, 102, 102); font-size: 12px; line-height: 20px;"   ><div><img title="fence_vmware usage with ESX or VCenter, or VSphere ... vmware product - 德哥@Digoal - PostgreSQL research"   alt="fence_vmware usage with ESX or VCenter, or VSphere ... vmware product - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img1.ph.126.net/BcTnRFcNyvA5BUIGhNnI4Q==/6608893914701723338.png"   ></div>&nbsp;</pre><p style="margin-top: 15px; margin-bottom: 15px; vertical-align: baseline; font-size: 14px; line-height: 25.2000007629395px; color: rgb(102, 102, 102); font-family: Tahoma, Geneva, sans-serif;"   >给相应的用户授权权限，由于fence的功能和作用，要授予开关机重启的权限，嫌麻烦就授予该虚拟机的最高权限。</p><pre style="color: rgb(102, 102, 102); font-size: 12px; line-height: 20px;"   ><a style="color: rgb(153, 153, 153); text-decoration: none; border-bottom-width: 1px; border-bottom-style: dotted; border-bottom-color: rgb(153, 153, 153); line-height: 18px;" rel="nofollow" href="http://www.zoublog.com/wp-content/uploads/2013/01/assign_permission.png"   ></a><div><img title="fence_vmware usage with ESX or VCenter, or VSphere ... vmware product - 德哥@Digoal - PostgreSQL research"   alt="fence_vmware usage with ESX or VCenter, or VSphere ... vmware product - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/e5s-6QQrip6Dg3SeB6XHNQ==/6619583366746602078.png"   ></div>&nbsp;
RHCS的机群中的所有虚拟机都要如此设置权限。

以上只在rhel x64 5.6和vsphere 4.0中配置通过，其他情况，按需改动。</pre></div><div><br></div><div><span style="font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   >在pacemaker 中，&nbsp;&nbsp;fence_vmvware 的一个示例配置:&nbsp;</span><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><span style="font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   >primitive fence_vm96 stonith:fence_vmware \</span><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><span style="font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   >&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;params ipaddr="192.168.x.x" login="user" passwd="passwd" vmware_datacenter="GZ-xxx" vmware_type="esx" action="reboot" port="dba-test-Cos6.xx" pcmk_reboot_action="reboot" pcmk_host_list="node95 node96" \</span><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><span style="font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   >&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;op monitor interval="20" timeout="60s" \</span><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><span style="font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   >&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;op start interval="0" timeout="60s" \</span><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><span style="font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   >&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;meta target-role="Started"</span><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><span style="font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   >port&nbsp;&nbsp;对应的命令行的fence_vmware 的-n 选项&nbsp;&nbsp;</span><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><span style="font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   >ipadd 对应的 是fence_vmware 命令行执行的 ip 选项</span><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><span style="font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   >ipaddr 对应的&nbsp;&nbsp;fence_vmware 的ip 选项。&nbsp;</span><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><br style="word-wrap: break-word; font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   ><span style="font-family: song, Verdana; font-size: 14px; line-height: 22.3999996185303px; background-color: rgb(240, 243, 250);"   >希望可以对后来人有个帮助。</span></div><div><br></div>[参考]<wbr><div>1. man fence_vmware</div><div>2. man fence_vmware_soap</div><div>3. /usr/sbin/fence_vmware</div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://fedorahosted.org/cluster/wiki/VMware_FencingConfig"   >https://fedorahosted.org/cluster/wiki/VMware_FencingConfig</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.zoublog.com/vmware-vsphere-esx-fence/"   >http://www.zoublog.com/vmware-vsphere-esx-fence/</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="fence_vmware usage with ESX or VCenter, or VSphere ... vmware product - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>