<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">ganglia XDR(eXternal Data Representation) protocol</h2>
	<h5 id="">2014-09-22 17:27:29&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020148225722432/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><pre class="prettyprint"   ><p></p><div><font size="2"   >XDR is a binary protocol that is used by not only gmetric but also gmond itself to pass</font></div><div><font size="2"   >metric packets from one instance to another. The XDR protocol can also be used to</font></div><div><font size="2"   >insert metric packets into the metric stream by a third-party utility. In fact, gmetric is</font></div><div><font size="2"   >a good example of how the XDR protocol can be used in this manner. gmetric, being</font></div><div><font size="2"   >an external utility, uses the XDR protocol to submit metrics directly to a gmond instance</font></div><div><font size="2"   >in the form of a binary packet. The metric information is submitted as a series of two</font></div><div><font size="2"   >UDP packets: one containing metadata regarding the metric in question, and a second</font></div><div><font size="2"   >packet containing the metric value. Table 5-3explains the lower-level format of XDR</font></div><div><font size="2"   >integer and string values. See Table 5-4and Table 5-5for descriptions of the metadata</font></div><div><font size="2"   >and value formats.</font></div><p></p></pre></div><div>gmetric, gmond都是通过xdr协议发送监控的消息包的, 包含metadata, data packet.</div><div>详见 :&nbsp;</div><div><br></div><div>Types</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Type &nbsp; &nbsp;Representation</font></div><div><font size="2"   >INT &nbsp; &nbsp; &nbsp;    Integer values in XDR are represented as a series of four sequential 8-bit values that, taken together,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;form a single 32-bit integer value. The value is ordered high byte to low byte.</font></div><div><font size="2"   >STRING &nbsp; &nbsp; &nbsp; String values in XDR are represented as an integer XDR “length” value, being the length of the target</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string followed by a series of characters forming the string. These values are padded to a string length</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;that is a multiple of 4 by 0 byte values. Null string values are represented as a zero-length value,</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;followed by four 0 bytes.</font></div><p></p></pre></div><div><br></div><div>Metadata packet :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >Name &nbsp; &nbsp; &nbsp;      Type &nbsp; &nbsp; &nbsp;    Value</font></div><div><font size="2"   >Packet type &nbsp; &nbsp; &nbsp; INT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; “gmetadata_full”, represented as 128</font></div><div><font size="2"   >Hostname &nbsp; &nbsp; &nbsp; STRING &nbsp; &nbsp; &nbsp; Source hostname for this metric. This should be represented in “spoof” form (IP address</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;       &nbsp;+ “:” + hostname) if the packet represents spoofed data.</font></div><div><font size="2"   >Metric name &nbsp; &nbsp; &nbsp; &nbsp;STRING &nbsp; &nbsp; &nbsp; Textual name of the metric presented. Any nonalphanumeric characters will be translated &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;                 &nbsp;into underscore characters by gmond in modern versions of the monitoring core.</font></div><div><font size="2"   >Spoof              INT &nbsp; &nbsp; &nbsp; 1 if the packet is being spoofed, 0 if it is not a spoofed packet.</font></div><div><font size="2"   >Type<span style="line-height: 28px;"   >&nbsp;representation</span></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRING &nbsp; &nbsp; &nbsp; One of the following: unknown, string, uint16, int16, uint32, int32, float, double.</font></div><div><font size="2"   >Metric name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRING &nbsp; &nbsp; &nbsp; Repetition of the earlier metric name field.</font></div></div><div><div><font size="2"   >Units &nbsp; &nbsp; &nbsp; &nbsp; STRING &nbsp; &nbsp; &nbsp; &nbsp; Textual name of the units being used for this metric.</font></div><div><font size="2"   >Slope &nbsp; &nbsp; &nbsp; &nbsp; INT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;        ? 0: zero slope</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;? 1: positive slope (creates a COUNTER style metric)</font></div><div><font size="2"   ><span style="line-height: 28px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>? 2: negative slope</font></div><div><font size="2"   ><span style="line-height: 28px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>? 3: both (should be the default for most metrics)</font></div><div><font size="2"   ><span style="line-height: 28px;"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>? 4: unspecified</font></div><div><font size="2"   >tmax &nbsp; &nbsp; &nbsp; &nbsp;INT &nbsp; &nbsp; &nbsp; &nbsp;Maximum time in seconds between gmetric values submitted. The minimum value of</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;this should be 60.</font></div><div><font size="2"   >dmax &nbsp; &nbsp; &nbsp; INT &nbsp; &nbsp; &nbsp; &nbsp; Lifetime in seconds of this metric. 0 indicates an unlimited lifetime.</font></div><div><font size="2"   >Extra data qualifier &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="line-height: 28px;"   >INT &nbsp; &nbsp; &nbsp; This “magic” value specifies how many repetitions of the two following values are in</span></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the packet. Most packets contain at least a GROUP value, if not a SPOOF_NAME one.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;This value can be 0 if there are no additional extra data values being passed.</font></div><div><font size="2"   >Extra data name</font></div><div><font size="2"   >(repeats)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STRING &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Additional data name to be submitted with this packet. Common keys are “GROUP”</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and “SPOOF_NAME”.</font></div><div><font size="2"   >Extra data value</font></div><div><font size="2"   >(repeats)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STRING &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Corresponding value for extra data.</font></div></div><p></p></pre></div><div><br></div><wbr><div>Value packet :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Value</font></div><div><font size="2"   >Packet type &nbsp; &nbsp; &nbsp;   INT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 133 (128 + 5)</font></div><div><font size="2"   >Hostname &nbsp; &nbsp; &nbsp; &nbsp;   &nbsp;STRING &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Should match the hostname in the preceding metadata packet.</font></div><div><font size="2"   >Metric name &nbsp; &nbsp; &nbsp;   STRING &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Should match the metric name in the preceding metadata packet.</font></div><div><font size="2"   >Spoof &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Should match the spoof value in the preceding metadata packet.</font></div><div><font size="2"   >Format string &nbsp; &nbsp; &nbsp; STRING             “%s”. &nbsp; &nbsp; Note: ideally, this should be the printf/scanf-style format of the value being</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; passed, but in reality, all are presently passed as string values, and are then converted</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; to their specified types by gmond.</font></div><div><font size="2"   >Metric value &nbsp; &nbsp; &nbsp; &nbsp; STRING &nbsp; &nbsp; &nbsp; &nbsp;Reported metric value.</font></div><p></p></pre></div><div><br></div><div><div>Packets</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >A &nbsp;metadata packet is an XDR packet that contains the definition of an individual metric.</font></div><div><font size="2"   >Before a metric can be understood and viewed by the Ganglia monitoring system, its</font></div><div><font size="2"   >metadata must have been communicated throughout the system by a metadata packet.</font></div><div><font size="2"   >When an instance of gmond is started, the first thing it does is send a metadata packet</font></div><div><font size="2"   >over the network for each metric for which it intends to provide a value. If the configuration directive, &nbsp;send_metadata_interval, is set to a positive value, the instance of</font></div><div><font size="2"   >gmond will resend each metric’s metadata according to the interval value.</font></div><div><font size="2"   >A value packet contains only enough information to communicate a metric value. In</font></div><div><font size="2"   >order to reduce the amount of data that an instance of gmond produces, the actual&nbsp;metric values are communicated through a much smaller packet, which allows gmond</font></div><div><font size="2"   >to communicate the much larger metric metadata on an as-needed basis while maintaining a very small footprint when communicating metric values.</font></div><p></p></pre></div></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014819102825333/"   >http://blog.163.com/digoal@126/blog/static/1638770402014819102825333/</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="ganglia XDR(eXternal Data Representation) protocol - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>