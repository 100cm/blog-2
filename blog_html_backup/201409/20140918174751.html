<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">ganglia metric extended by gmetric command line tool</h2>
	<h5 id="">2014-09-18 17:47:51&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201481843417188/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>上一篇文章简单的介绍了一下metric的相关知识 :&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201481835916946/"   >http://blog.163.com/digoal@126/blog/static/163877040201481835916946/</a></div><div>ganglia gmond实际上是将metric collection模块化来处理的, 包括自带的metric, 也是模块化来加载的, 所以非常适合扩展.</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 cpu]# cd /opt/ganglia-core-3.6.0/</font></div><div><font size="2"   >[root@db-172-16-3-221 ganglia-core-3.6.0]# ll</font></div><div><font size="2"   >total 24</font></div><div><font size="2"   >drwxr-xr-x 2 root root 4096 Sep &nbsp;9 11:03 bin</font></div><div><font size="2"   >drwxr-xr-x 3 root root 4096 Sep 15 09:31 etc</font></div><div><font size="2"   >drwxr-xr-x 2 root root 4096 Sep &nbsp;9 11:03 include</font></div><div><font size="2"   >drwxr-xr-x 3 root root 4096 Sep &nbsp;9 11:03 lib64</font></div><div><font size="2"   >drwxr-xr-x 2 root root 4096 Sep &nbsp;9 11:03 sbin</font></div><div><font size="2"   >drwxr-xr-x 3 root root 4096 Sep &nbsp;9 11:03 share</font></div><div><font size="2"   >[root@db-172-16-3-221 ganglia-core-3.6.0]# cd lib64/</font></div><div><font size="2"   >[root@db-172-16-3-221 lib64]# ll</font></div><div><font size="2"   >total 660</font></div><div><font size="2"   >drwxr-xr-x 2 root root &nbsp; 4096 Sep &nbsp;9 11:03 ganglia</font></div><div><font size="2"   >lrwxrwxrwx 1 root root &nbsp; &nbsp; 25 Sep &nbsp;9 11:03 libganglia-3.6.0.so.0 -&gt; libganglia-3.6.0.so.0.0.0</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 257554 Sep &nbsp;9 11:03 libganglia-3.6.0.so.0.0.0</font></div><div><font size="2"   >-rw-r--r-- 1 root root 408276 Sep &nbsp;9 11:03 libganglia.a</font></div><div><font size="2"   >-rwxr-xr-x 1 root root &nbsp; 1270 Sep &nbsp;9 11:03 libganglia.la</font></div><div><font size="2"   >lrwxrwxrwx 1 root root &nbsp; &nbsp; 25 Sep &nbsp;9 11:03 libganglia.so -&gt; libganglia-3.6.0.so.0.0.0</font></div><div><font size="2"   >[root@db-172-16-3-221 lib64]# cd ganglia/</font></div><div><font size="2"   >[root@db-172-16-3-221 ganglia]# ll</font></div><div><font size="2"   >total 700</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 86896 Sep &nbsp;9 11:03 modcpu.so</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 84118 Sep &nbsp;9 11:03 moddisk.so</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 17896 Sep &nbsp;9 11:03 modgstatus.so</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 84078 Sep &nbsp;9 11:03 modload.so</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 85832 Sep &nbsp;9 11:03 modmem.so</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 31655 Sep &nbsp;9 11:03 modmulticpu.so</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 84480 Sep &nbsp;9 11:03 modnet.so</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 83862 Sep &nbsp;9 11:03 modproc.so</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 53954 Sep &nbsp;9 11:03 modpython.so</font></div><div><font size="2"   >-rwxr-xr-x 1 root root 85136 Sep &nbsp;9 11:03 modsys.so</font></div><p></p></pre></div><div>在gmond的配置文件中加载模块 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># less /opt/ganglia-core-3.6.0/etc/gmond.conf</font></div><div><div><font size="2"   >/* Each metrics module that is referenced by gmond must be specified and</font></div><div><font size="2"   >&nbsp; &nbsp;loaded. If the module has been statically linked with gmond, it does</font></div><div><font size="2"   >&nbsp; &nbsp;not require a load path. However all dynamically loadable modules must</font></div><div><font size="2"   >&nbsp; &nbsp;include a load path. */</font></div><div><font size="2"   >modules {</font></div><div><font size="2"   >&nbsp; module {</font></div><div><font size="2"   >&nbsp; &nbsp; name = "core_metrics"</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; module {</font></div><div><font size="2"   >&nbsp; &nbsp; name = "cpu_module"</font></div><div><font size="2"   >&nbsp; &nbsp; path = "modcpu.so"</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; module {</font></div><div><font size="2"   >&nbsp; &nbsp; name = "disk_module"</font></div><div><font size="2"   >&nbsp; &nbsp; path = "moddisk.so"</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; module {</font></div><div><font size="2"   >&nbsp; &nbsp; name = "load_module"</font></div><div><font size="2"   >&nbsp; &nbsp; path = "modload.so"</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; module {</font></div><div><font size="2"   >&nbsp; &nbsp; name = "mem_module"</font></div><div><font size="2"   >&nbsp; &nbsp; path = "modmem.so"</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; module {</font></div><div><font size="2"   >&nbsp; &nbsp; name = "net_module"</font></div><div><font size="2"   >&nbsp; &nbsp; path = "modnet.so"</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; module {</font></div><div><font size="2"   >&nbsp; &nbsp; name = "proc_module"</font></div><div><font size="2"   >&nbsp; &nbsp; path = "modproc.so"</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >&nbsp; module {</font></div><div><font size="2"   >&nbsp; &nbsp; name = "sys_module"</font></div><div><font size="2"   >&nbsp; &nbsp; path = "modsys.so"</font></div><div><font size="2"   >&nbsp; }</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div><div>当gmond自带的metric模块不能满足你的监控需求时, 你需要扩展metric collection.</div><div>扩展方法比较多, 例如直接修改gmond, 添加模块并重新编译gmond.&nbsp;<span style="line-height: 28px;"   >然后在gmond.conf中添加新增的模块, 并配置metric采集项.</span></div><div>或者使用c/c++, python , php, perl遵循gmond的标准来写扩展模块.&nbsp;<span style="line-height: 28px;"   >然后在gmond.conf中添加新增的模块, 并配置metric采集项.</span></div><div><span style="line-height: 28px;"   >(编译时需要开启php, perl的功能, 具体见源码里的 configure --help)</span></div><div>最后, 还可以使用gmetric命令直接向集群中的多播地址或单播地址发送metric信息.</div><div>显然使用gmetric来得最快, 但是使用gmetric有一个弊端, 必须用户自己调度gmetric的执行,&nbsp;</div><div>而如果使用模块的话, 可以统一在gmond.conf中配置, gmond handler会根据gmond的配置来调用模块来完成metric的采集, 不需要用户去调度.</div><div>接下来要使用gmetric来测试一下自定义metric收集.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 ganglia-3.6.0]# gmetric --help</font></div><div><font size="2"   >gmetric 3.6.0</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The Ganglia Metric Client (gmetric) announces a metric</font></div><div><font size="2"   >on the list of defined send channels defined in a configuration file</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Usage: gmetric [OPTIONS]...</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; -h, --help &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Print help and exit</font></div><div><font size="2"   >&nbsp; -V, --version &nbsp; &nbsp; &nbsp; &nbsp; Print version and exit</font></div><div><font size="2"   >&nbsp; -c, --conf=STRING &nbsp; &nbsp; The configuration file to use for finding send channels&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(default=`/opt/ganglia-core-3.6.0/etc/gmond.conf')</font></div><div><font size="2"   >&nbsp; -n, --name=STRING &nbsp; &nbsp; Name of the metric</font></div><div><font size="2"   >&nbsp; -v, --value=STRING &nbsp; &nbsp;Value of the metric</font></div><div><font size="2"   >&nbsp; -t, --type=STRING &nbsp; &nbsp; Either&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string|int8|uint8|int16|uint16|int32|uint32|float|double</font></div><div><font size="2"   >&nbsp; -u, --units=STRING &nbsp; &nbsp;Unit of measure for the value e.g. Kilobytes, Celcius &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (default=`')</font></div><div><font size="2"   >&nbsp; -s, --slope=STRING &nbsp; &nbsp;Either zero|positive|negative|both &nbsp;(default=`both')</font></div><div><font size="2"   >&nbsp; -x, --tmax=INT &nbsp; &nbsp; &nbsp; &nbsp;The maximum time in seconds between gmetric calls &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (default=`60')</font></div><div><font size="2"   >&nbsp; -d, --dmax=INT &nbsp; &nbsp; &nbsp; &nbsp;The lifetime in seconds of this metric &nbsp;(default=`0')</font></div><div><font size="2"   >&nbsp; -g, --group=STRING &nbsp; &nbsp;Group(s) of the metric (comma-separated)</font></div><div><font size="2"   >&nbsp; -C, --cluster=STRING &nbsp;Cluster of the metric</font></div><div><font size="2"   >&nbsp; -D, --desc=STRING &nbsp; &nbsp; Description of the metric</font></div><div><font size="2"   >&nbsp; -T, --title=STRING &nbsp; &nbsp;Title of the metric</font></div><div><font size="2"   >&nbsp; -S, --spoof=STRING &nbsp; &nbsp;IP address and name of host/device (colon separated) we&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; are spoofing &nbsp;(default=`')</font></div><div><font size="2"   >&nbsp; -H, --heartbeat &nbsp; &nbsp; &nbsp; spoof a heartbeat message (use with spoof option)</font></div><p></p></pre></div><div>首先在集群中要有gmond监听来自网络中的metric消息.</div><div>例如我们网络中只有一个gmond服务, 并在多播地址上起了一个监听来接收网络中发送过来的metric信息.</div><div><div><pre class="prettyprint"   ><div><font size="2"   >[root@db-172-16-3-221 ganglia-3.6.0]# ps -ewf|grep gmond</font></div><div><font size="2"   >nobody &nbsp; &nbsp;4271 &nbsp; &nbsp; 1 &nbsp;0 15:51 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 gmond</font></div><div><font size="2"   >root &nbsp; &nbsp; &nbsp;4930 26259 &nbsp;0 16:54 pts/2 &nbsp; &nbsp;00:00:00 grep gmond</font></div><div><font size="2"   >[root@db-172-16-3-221 ganglia-3.6.0]# netstat -anp|grep gmon</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 0.0.0.0:8649 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;4271/gmond &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >udp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 172.16.3.221:63894 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;239.2.11.71:8649 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ESTABLISHED 4271/gmond &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >udp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 239.2.11.71:8649 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4271/gmond&nbsp;</font></div><p></p></pre></div></div><div>接下来我在多播域中的另一台机器上配置一下gmond.conf</div><div>主要配置如下, 务必配置正确的udp发送通道.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 etc]# vi /opt/ganglia-core-3.6.0/etc/gmond.conf</font></div><div><div><font size="2"   >/* This configuration is as close to 2.5.x default behavior as possible</font></div><div><font size="2"   >&nbsp; &nbsp;The values closely match ./gmond/metric.h definitions in 2.5.x */</font></div><div><font size="2"   >globals {</font></div><div><font size="2"   >&nbsp; daemonize = yes</font></div><div><font size="2"   >&nbsp; setuid = yes</font></div><div><font size="2"   >&nbsp; user = nobody</font></div><div><font size="2"   >&nbsp; debug_level = 0</font></div><div><font size="2"   >&nbsp; max_udp_msg_len = 1472</font></div><div><font size="2"   >&nbsp; mute = no</font></div><div><font size="2"   >&nbsp; deaf = no</font></div><div><font size="2"   >&nbsp; allow_extra_data = yes</font></div><div><font size="2"   >&nbsp; host_dmax = 86400 /*secs. Expires (removes from web interface) hosts in 1 day */</font></div><div><font size="2"   >&nbsp; host_tmax = 20 /*secs */</font></div><div><font size="2"   >&nbsp; cleanup_threshold = 300 /*secs */</font></div><div><font size="2"   >&nbsp; gexec = no</font></div><div><font size="2"   >&nbsp; # By default gmond will use reverse DNS resolution when displaying your hostname</font></div><div><font size="2"   >&nbsp; # Uncommeting following value will override that value.</font></div><div><font size="2"   >&nbsp; # override_hostname = "mywebserver.domain.com"</font></div><div><font size="2"   >&nbsp; # If you are not using multicast this value should be set to something other than 0.</font></div><div><font size="2"   >&nbsp; # Otherwise if you restart aggregator gmond you will get empty graphs. 60 seconds is reasonable</font></div><div><font size="2"   >&nbsp; send_metadata_interval = 0 /*secs */</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* The cluster attributes specified will be used as part of the &lt;CLUSTER&gt;</font></div><div><font size="2"   >&nbsp;* tag that will wrap all hosts collected by this instance.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >cluster {</font></div><div><font size="2"   >&nbsp; name = "test"</font></div><div><font size="2"   >&nbsp; owner = "digoal"</font></div><div><font size="2"   >&nbsp; latlong = "111 122"</font></div><div><font size="2"   >&nbsp; url = "http://dba.sky-mobi.com"</font></div><div><font size="2"   >}</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >/* The host section describes attributes of the host, like the location */</font></div><div><font size="2"   >host {</font></div><div><font size="2"   >&nbsp; location = "1,2,4"</font></div><div><font size="2"   >}</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >/* Feel free to specify as many udp_send_channels as you like. &nbsp;Gmond</font></div><div><font size="2"   >&nbsp; &nbsp;used to only support having a single channel */</font></div><div><font size="2"   >udp_send_channel {</font></div><div><font size="2"   >&nbsp; #bind_hostname = yes # Highly recommended, soon to be default.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# This option tells gmond to use a source address</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# that resolves to the machine's hostname. &nbsp;Without</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# this, the metrics may appear to come from any</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# interface and the DNS names associated with</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# those IPs will be used to create the RRDs.</font></div><div><font size="2"   >&nbsp; mcast_join = 239.2.11.71</font></div><div><font size="2"   >&nbsp; port = 8649</font></div><div><font size="2"   >&nbsp; ttl = 10</font></div><div><font size="2"   >}</font></div></div><p></p></pre></div><div>主机名和IP如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 etc]# hostname</font></div><div><font size="2"   >150.sky-mobi.com</font></div><div><font size="2"   >[root@150 etc]# ifconfig</font></div><div><font size="2"   >em1 &nbsp; &nbsp; &nbsp; Link encap:Ethernet &nbsp;HWaddr 00:22:19:60:77:8F &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::222:19ff:fe60:778f/64 Scope:Link</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:599238829 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:67014382 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:882536084904 (821.9 GiB) &nbsp;TX bytes:8841108757 (8.2 GiB)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >lo &nbsp; &nbsp; &nbsp; &nbsp;Link encap:Local Loopback &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1 &nbsp;Mask:255.0.0.0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: ::1/128 Scope:Host</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING &nbsp;MTU:16436 &nbsp;Metric:1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:81579301 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:81579301 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:15164677095 (14.1 GiB) &nbsp;TX bytes:15164677095 (14.1 GiB)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >ovirtmgmt Link encap:Ethernet &nbsp;HWaddr 00:22:19:60:77:8F &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:172.16.3.150 &nbsp;Bcast:172.16.3.255 &nbsp;Mask:255.255.255.0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::222:19ff:fe60:778f/64 Scope:Link</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:93718326 errors:0 dropped:0 overruns:0 frame:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:86213477 errors:0 dropped:0 overruns:0 carrier:0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1098952054073 (1023.4 GiB) &nbsp;TX bytes:11330242206 (10.5 GiB)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >ovirtmgmt:1 Link encap:Ethernet &nbsp;HWaddr 00:22:19:60:77:8F &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:172.16.13.150 &nbsp;Bcast:172.16.13.255 &nbsp;Mask:255.255.255.0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</font></div><p></p></pre></div><div>首先要启动gmond, (当然, 不启动也可以, 启动gmond除了可以发心跳包, 还可以将location等基础信息发过去)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Usage: gmetric [OPTIONS]...</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; -h, --help &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Print help and exit</font></div><div><font size="2"   >&nbsp; -V, --version &nbsp; &nbsp; &nbsp; &nbsp; Print version and exit</font></div><div><font size="2"   >&nbsp; -c, --conf=STRING &nbsp; &nbsp; The configuration file to use for finding send channels&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(default=`/opt/ganglia-core-3.6.0/etc/gmond.conf')</font></div><div><font size="2"   >&nbsp; -n, --name=STRING &nbsp; &nbsp; Name of the metric</font></div><div><font size="2"   >&nbsp; -v, --value=STRING &nbsp; &nbsp;Value of the metric</font></div><div><font size="2"   >&nbsp; -t, --type=STRING &nbsp; &nbsp; Either&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string|int8|uint8|int16|uint16|int32|uint32|float|double</font></div><div><font size="2"   >&nbsp; -u, --units=STRING &nbsp; &nbsp;Unit of measure for the value e.g. Kilobytes, Celcius &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (default=`')</font></div><div><font size="2"   >&nbsp; -s, --slope=STRING &nbsp; &nbsp;Either zero|positive|negative|both &nbsp;(default=`both')</font></div><div><font size="2"   >&nbsp; -x, --tmax=INT &nbsp; &nbsp; &nbsp; &nbsp;The maximum time in seconds between gmetric calls &nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (default=`60')</font></div><div><font size="2"   >&nbsp; -d, --dmax=INT &nbsp; &nbsp; &nbsp; &nbsp;The lifetime in seconds of this metric &nbsp;(default=`0')</font></div><div><font size="2"   >&nbsp; -g, --group=STRING &nbsp; &nbsp;Group(s) of the metric (comma-separated)</font></div><div><font size="2"   >&nbsp; -C, --cluster=STRING &nbsp;Cluster of the metric</font></div><div><font size="2"   >&nbsp; -D, --desc=STRING &nbsp; &nbsp; Description of the metric</font></div><div><font size="2"   >&nbsp; -T, --title=STRING &nbsp; &nbsp;Title of the metric</font></div><div><font size="2"   >&nbsp; -S, --spoof=STRING &nbsp; &nbsp;IP address and name of host/device (colon separated) we&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; are spoofing &nbsp;(default=`')</font></div><div><font size="2"   >&nbsp; -H, --heartbeat &nbsp; &nbsp; &nbsp; spoof a heartbeat message (use with spoof option)</font></div><div><font size="2"   >[root@150 etc]# gmetric -c /opt/ganglia-core-3.6.0/etc/gmond.conf -n load_one -v 1.0 -t float -s both -x 20 -g load -C test -D "load per min" -T "load one"</font></div><p></p></pre></div><div>例如在172.16.3.150模拟发送172.16.3.151的metric信息 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 etc]# gmetric -c /opt/ganglia-core-3.6.0/etc/gmond.conf -n load_one -v 1.0 -t float -s both -x 20 -g load -C test -D "load per min" -T "load one" -S "172.16.3.151:digoal_host"</font></div><div></div><p></p></pre></div><div>不指定<span style="line-height: 28px;"   >-S "172.16.3.151:digoal_host"的话, 就是以当前主机的metric来发送.</span></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >如果不启动gmond的话, 那么需要发心跳包过去.</span></div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >[root@150 etc]# gmetric -c /opt/ganglia-core-3.6.0/etc/gmond.conf -n load_one -v 1.0 -t float -s both -x 20 -g load -C test -D "load per min" -T "load one" -S "172.16.3.151:digoal_host" -H</font></span></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >发完心跳包后 :&nbsp;</span></div><div><div><img title="ganglia metric extended by gmetric command line tool - 德哥@Digoal - PostgreSQL research"   alt="ganglia metric extended by gmetric command line tool - 德哥@Digoal - PostgreSQL research"   style="margin:0 10px 0 0;"   src="http://img0.ph.126.net/I4lQRE02-30S5GpyotTUcg==/6619448126816392596.png"   ></div><br></div><div>[注意]</div><div>1. gmond 负责监听的节点, 必须开放防火墙的访问, 例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-221 kernel-doc-2.6.32]# netstat -anp|grep gmond</font></div><div><font size="2"   >tcp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 0.0.0.0:8649 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LISTEN &nbsp; &nbsp; &nbsp;4271/gmond &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >udp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 172.16.3.221:63894 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;239.2.11.71:8649 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ESTABLISHED 4271/gmond &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >udp &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 239.2.11.71:8649 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4271/gmond&nbsp;</font></div><p></p></pre></div><div>务必允许其他主机访问这个多播地址.</div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/ganglia/ganglia_contrib/tree/master/gmond-debug"   >https://github.com/ganglia/ganglia_contrib/tree/master/gmond-debug</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201481835916946/"   >http://blog.163.com/digoal@126/blog/static/163877040201481835916946/</a></div><div><br></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="ganglia metric extended by gmetric command line tool - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>