<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Lua talbe's pairs & ipairs & traverse loop, table.pack and table.unpack</h2>
	<h5 id="">2014-02-18 12:58:43&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014118115446603/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">Lua 表有几种形式用得比较多,<wbr><div>一种是sequence, 一种是table, 还有一种是list.</div><div>1. sequence指没有气泡的一些元素. 例如{"hello", "nihao","yes"}是一个sequence, 索引为1开始的自增数字.</div><div>但是<span style="line-height: 28px;"   >{"hello", "nihao", nil, "yes"} 不算序列. 因为中间有个nil气泡.</span></div><div><span style="line-height: 28px;"   ><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; t = {"hello", "nihao", nil, "yes"}</font></div><div><font size="2"   >&gt; for i,v in ipairs(t) do</font></div><div><font size="2"   >&gt;&gt; print (i,v)</font></div><div><font size="2"   >&gt;&gt; end</font></div><div><font size="2"   >1 &nbsp; &nbsp; &nbsp; hello</font></div><div><font size="2"   >2 &nbsp; &nbsp; &nbsp; nihao</font></div><div><font size="2"   >使用ipairs遍历t表只输出前两个值</font></div><p></p></pre></div><div>2. table指key, value形式存储的表.</div><div>例如tbl = {a="nihao", b=nil, c="hello", d="yes"}</div><div>使用pairs可以遍历这个表, 会忽略value=nil的元素.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; tbl = {a="nihao", b=nil, c="hello", d="yes"}</font></div><div><font size="2"   >&gt; for k,v in pairs(tbl) do</font></div><div><font size="2"   >&gt;&gt; &nbsp;print(k,v)</font></div><div><font size="2"   >&gt;&gt; end</font></div><div><font size="2"   >a &nbsp; &nbsp; &nbsp; nihao</font></div><div><font size="2"   >d &nbsp; &nbsp; &nbsp; yes</font></div><div><font size="2"   >c &nbsp; &nbsp; &nbsp; hello</font></div><p></p></pre></div><div>其实pairs是调用了next(_s, _var)函数, 所以我们知道generic for语法的话, 可以直接使用next来写for循环.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; for k,v in next, tbl do</font></div><div><font size="2"   >&gt;&gt; &nbsp; print(k,v)</font></div><div><font size="2"   >&gt;&gt; end</font></div><div><font size="2"   >a &nbsp; &nbsp; &nbsp; nihao</font></div><div><font size="2"   >d &nbsp; &nbsp; &nbsp; yes</font></div><div><font size="2"   >c &nbsp; &nbsp; &nbsp; hello</font></div><p></p></pre></div><div>直接调用next的效果</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >&gt; =next(tbl,nil)</font></div><div><font size="2"   >a &nbsp; &nbsp; &nbsp; nihao</font></div></div><div><div><font size="2"   >&gt; return next(tbl,"a")</font></div><div><font size="2"   >d &nbsp; &nbsp; &nbsp; yes</font></div><div><font size="2"   >&gt; return next(tbl,"d")</font></div><div><font size="2"   >c &nbsp; &nbsp; &nbsp; hello</font></div><div><font size="2"   >&gt; return next(tbl,"c")</font></div><div><font size="2"   >nil</font></div></div><p></p></pre></div><div><span style="line-height: 28px;"   >pairs原型</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >function pairs(t)</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >&nbsp; return next, t, nil</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   >end</font></span></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >3. list指链表.&nbsp;</span></div><div><span style="line-height: 28px;"   ><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; a = {"hello", next=nil} &nbsp;-- 链表的头</font></div><div><font size="2"   >&gt; a = {"nihao", next=a} &nbsp;-- next指向头</font></div><div><font size="2"   >&gt; a = {"yes", next=a} &nbsp;-- next指向上层</font></div><div><font size="2"   >&gt; a = {"ok", next=a} &nbsp;-- next指向上层&nbsp;</font></div><p></p></pre></div><div>打印链表的值.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; print(a[1])</font></div><div><font size="2"   >ok</font></div><div><font size="2"   >&gt; print(a.next[1])</font></div><div><font size="2"   >yes</font></div><div><font size="2"   >&gt; print(a.next.next[1])</font></div><div><font size="2"   >nihao</font></div><div><font size="2"   >&gt; print(a.next.next.next[1])</font></div><div><font size="2"   >hello</font></div><p></p></pre></div><div>生成一个链表和输出链表的值的例子</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; list = nil</font></div><div><font size="2"   >&gt; &nbsp; &nbsp; for line in io.lines() do</font></div><div><font size="2"   >&gt;&gt; &nbsp; &nbsp; &nbsp; list = {next=list, value=line}</font></div><div><font size="2"   >&gt;&gt; &nbsp; &nbsp; end</font></div><div><font size="2"   >a</font></div><div><font size="2"   >b</font></div><div><font size="2"   >c</font></div><div><font size="2"   >d</font></div><div><font size="2"   >e</font></div><div><font size="2"   >^D</font></div><div><font size="2"   >&gt; &nbsp;l = list</font></div><div><font size="2"   >&gt; &nbsp; &nbsp; while l do</font></div><div><font size="2"   >&gt;&gt; &nbsp; &nbsp; &nbsp; print(l.value)</font></div><div><font size="2"   >&gt;&gt; &nbsp; &nbsp; &nbsp; l = l.next</font></div><div><font size="2"   >&gt;&gt; &nbsp; &nbsp; end</font></div><div><font size="2"   >e</font></div><div><font size="2"   >d</font></div><div><font size="2"   >c</font></div><div><font size="2"   >b</font></div><div><font size="2"   >a</font></div><p></p></pre></div></span></div><div><span style="line-height: 28px;"   >链表的generic for循环函数用法 .</span></div><div>iterator函数, 函数中不保存state值. 所以也称为stateless iterator</div><div><span style="line-height: 28px;"   ><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; function getnext(list, node)</font></div><div><font size="2"   >&gt;&gt; &nbsp; if not node then</font></div><div><font size="2"   >&gt;&gt; &nbsp; &nbsp; return list</font></div><div><font size="2"   >&gt;&gt; &nbsp; else</font></div><div><font size="2"   >&gt;&gt; &nbsp; &nbsp; return node.next</font></div><div><font size="2"   >&gt;&gt; &nbsp; end</font></div><div><font size="2"   >&gt;&gt; end</font></div><p></p></pre></div><div>factory 函数</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; function traverse(list)</font></div><div><font size="2"   >&gt;&gt; &nbsp; return getnext, list, nil</font></div><div><font size="2"   >&gt;&gt; end</font></div><p></p></pre></div><div>使用io.lines生成链表</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; list = nil</font></div><div><font size="2"   >&gt; for line in io.lines() do</font></div><div><font size="2"   >&gt;&gt; &nbsp; list = {val = line, next = list}</font></div><div><font size="2"   >&gt;&gt; end</font></div><div><font size="2"   >hello</font></div><div><font size="2"   >yes</font></div><div><font size="2"   >digoal</font></div><div><font size="2"   >hehe</font></div><div><font size="2"   >^D</font></div><p></p></pre></div><div>使用factory函数循环</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; for node in traverse(list) do&nbsp;</font></div><div><font size="2"   >&gt;&gt; &nbsp; print (node.val)</font></div><div><font size="2"   >&gt;&gt; end</font></div><div><font size="2"   >hehe</font></div><div><font size="2"   >digoal</font></div><div><font size="2"   >yes</font></div><div><font size="2"   >hello</font></div><p></p></pre></div><div>直接使用stateless iterator函数和state值循环</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; for node in getnext,list do &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; print (node.val)</font></div><div><font size="2"   >end</font></div><div><font size="2"   >hehe</font></div><div><font size="2"   >digoal</font></div><div><font size="2"   >yes</font></div><div><font size="2"   >hello</font></div><p></p></pre></div></span></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >4.&nbsp;</span></div></span></div><div><span style="line-height: 28px;"   >table.pack 和table.unpack</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >table.pack把多个值打包成一个序列表.</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   ><div>&gt; a = table.pack("a","b","c","nil")</div><div>&gt; for i,v in ipairs(a) do</div><div>&gt;&gt; &nbsp; print (i,v)</div><div>&gt;&gt; end</div><div>1 &nbsp; &nbsp; &nbsp; a</div><div>2 &nbsp; &nbsp; &nbsp; b</div><div>3 &nbsp; &nbsp; &nbsp; c</div><div>4 &nbsp; &nbsp; &nbsp; nil</div><div>table.unpack把序列表解散成多值返回.</div><div><div>&gt; x,y,z = table.unpack(a)</div><div>&gt; print(x,y,z)</div><div>a &nbsp; &nbsp; &nbsp; b &nbsp; &nbsp; &nbsp; c</div></div><div><div>&gt; x,y,z = table.unpack({a=1,b=2,c=3}) &nbsp;-- unpack不处理非序列表元素.</div><div>&gt; print(x,y,z)</div><div>nil &nbsp; &nbsp; nil &nbsp; &nbsp; nil</div></div><div><div>&gt; x,y,z = table.unpack({a=1,b=2,c=3,"h","j","k"}) &nbsp;-- 只解包序列部分</div><div>&gt; print(x,y,z)</div><div>h &nbsp; &nbsp; &nbsp; j &nbsp; &nbsp; &nbsp; k</div></div></font></span></div><p></p></pre></div></div>
	</div>
</div>
</body>
</html>