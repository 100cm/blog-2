<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">luasocket 2.0.2 only supporte Lua 5.1 but not 5.2</h2>
	<h5 id="">2014-02-21 10:36:09&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014121102539377/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>在<span style="line-height: 28px;"   >环境Lua 5.2.3中</span><span style="line-height: 28px;"   >安装luasocket 2.0.2时遇到如下错误 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-33 luasocket-2.0.2]# make</font></div><div><font size="2"   >cd src; make all</font></div><div><font size="2"   >make[1]: Entering directory `/opt/soft_bak/luasocket-2.0.2/src'</font></div><div><font size="2"   >gcc &nbsp;-DLUASOCKET_DEBUG &nbsp;-pedantic -Wall -O2 -fpic &nbsp; -c -o luasocket.o luasocket.c</font></div><div><font size="2"   >In file included from luasocket.c:31:</font></div><div><font size="2"   >auxiliar.h:38: error: expected declaration specifiers or ‘...’ before ‘luaL_reg’</font></div><div><font size="2"   >luasocket.c:50: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘mod’</font></div><div><font size="2"   >luasocket.c:60: warning: ISO C does not allow extra ‘;’ outside of a function</font></div><div><font size="2"   >luasocket.c:62: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘func’</font></div><div><font size="2"   >luasocket.c:66: warning: ISO C does not allow extra ‘;’ outside of a function</font></div><div><font size="2"   >luasocket.c: In function ‘base_open’:</font></div><div><font size="2"   >luasocket.c:92: warning: implicit declaration of function ‘luaL_openlib’</font></div><div><font size="2"   >luasocket.c:92: error: ‘func’ undeclared (first use in this function)</font></div><div><font size="2"   >luasocket.c:92: error: (Each undeclared identifier is reported only once</font></div><div><font size="2"   >luasocket.c:92: error: for each function it appears in.)</font></div><div><font size="2"   >luasocket.c: In function ‘luaopen_socket_core’:</font></div><div><font size="2"   >luasocket.c:116: error: ‘mod’ undeclared (first use in this function)</font></div><div><font size="2"   >make[1]: *** [luasocket.o] Error 1</font></div><div><font size="2"   >make[1]: Leaving directory `/opt/soft_bak/luasocket-2.0.2/src'</font></div><div><font size="2"   >make: *** [all] Error 2</font></div><p></p></pre></div><div>经过查询, 发现luasocket 2.0.2只支持Lua 5.1, 原因是用到了5.1中的一个数据类型, 但是5.2里面没有.</div><div><div style="box-sizing: border-box; padding-left: 15px; padding-right: 15px; color: rgb(119, 119, 119); background-color: rgb(247, 247, 247); border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); border-top-left-radius: 4px; border-top-right-radius: 4px; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 13px; line-height: 18.200000762939453px;"   ><div style="box-sizing: border-box; padding-top: 10px; padding-bottom: 10px;"   ><strong style="box-sizing: border-box;"   ><a style="box-sizing: border-box; color: rgb(85, 85, 85); text-decoration: none;" rel="nofollow" href="https://github.com/pkulchenko"   >pkulchenko</a>&nbsp;</strong>commented&nbsp;<a style="box-sizing: border-box; text-decoration: none;" rel="nofollow" href="https://github.com/pkulchenko/MobDebug/issues/4#issuecomment-13043115"   >a year ago</a></div></div><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 13px; line-height: 18.200000762939453px;"   ><div style="box-sizing: border-box;"   ><div style="box-sizing: border-box; font-size: 14px; line-height: 1.7; word-wrap: break-word; width: 694px; padding: 15px;"   ><blockquote style="box-sizing: border-box; margin-bottom: 15px; margin-left: 0px; border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); margin-top: 0px !important;"   ><p style="box-sizing: border-box; margin-top: 0px; margin-bottom: 0px;"   >In file included from luasocket.c:31:0:<br style="box-sizing: border-box;"   >auxiliar.h:38:61: error: unknown type name ‘luaL_reg’</p></blockquote><p style="box-sizing: border-box; margin-top: 15px; margin-bottom: 15px;"   ><a style="box-sizing: border-box; color: rgb(51, 51, 51); text-decoration: none; font-weight: bold; white-space: nowrap;" rel="nofollow" href="https://github.com/masterkorp"   >@masterkorp</a>, this looks like it may still be using Lua 5.2 includes. From&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; max-width: 100%; display: inline-block; overflow: auto; vertical-align: middle; line-height: 1.3; padding: 0px; white-space: nowrap;"   >auxiliar.h</code>:</p><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal;"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: none; background-color: transparent; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; display: inline; vertical-align: middle; line-height: inherit; padding: 0px; word-wrap: normal;"   >#include "lauxlib.h"

int auxiliar_open(lua_State *L);
void auxiliar_newclass(lua_State *L, const char *classname, luaL_reg *func);
</code></pre><p style="box-sizing: border-box; margin-top: 15px; margin-bottom: 15px;"   >Lua 5.1&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; max-width: 100%; display: inline-block; overflow: auto; vertical-align: middle; line-height: 1.3; padding: 0px; white-space: nowrap;"   >lauxlib.h</code>&nbsp;includes defined for&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; max-width: 100%; display: inline-block; overflow: auto; vertical-align: middle; line-height: 1.3; padding: 0px; white-space: nowrap;"   >luaL_reg</code>&nbsp;(line 170):</p><pre style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 13px; margin-top: 15px; margin-bottom: 15px; background-color: rgb(248, 248, 248); border: 1px solid rgb(221, 221, 221); line-height: 19px; overflow: auto; padding: 6px 10px; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-wrap: normal;"   ><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: none; background-color: transparent; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; display: inline; vertical-align: middle; line-height: inherit; padding: 0px; word-wrap: normal;"   >#define luaL_reg    luaL_Reg
</code></pre><p style="box-sizing: border-box; margin-top: 15px; margin-bottom: 0px !important;"   >but Lua 5.2&nbsp;<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; max-width: 100%; display: inline-block; overflow: auto; vertical-align: middle; line-height: 1.3; padding: 0px; white-space: nowrap;"   >lauxlib.h</code>&nbsp;doesn't include that, which would explain why the type is unknown.</p></div></div></div></div><div>如果一定要在5.2上使用luasocket, 可以去github下最新版本</div><div><a target="_blank" rel="nofollow" href="https://github.com/diegonehab/luasocket/"   >https://github.com/diegonehab/luasocket/</a></div><div>make的时候也需要注意, 通过luasocket的makefile可以看到, 如果要支持5.2的话, 需要使用both安装.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># Targets:</font></div><div><font size="2"   ># &nbsp; install &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;install system independent support</font></div><div><font size="2"   ># &nbsp; install-unix &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; also install unix-only support</font></div><div><font size="2"   ># &nbsp; install-both &nbsp; &nbsp; &nbsp; install for both lua5.1 and lua5.2&nbsp;</font></div><div><font size="2"   ># &nbsp; install-both-unix &nbsp; &nbsp; &nbsp;also install unix-only&nbsp;</font></div><div><font size="2"   ># &nbsp; print &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print the build settings</font></div><p></p></pre></div><div><br></div><div>简明步骤 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># git clone &nbsp;https://github.com/diegonehab/luasocket</font></div><div><font size="2"   ># cd luasocket</font></div><div><font size="2"   ># make</font></div><div><font size="2"   ># make&nbsp;install-both-unix</font></div><div><div><font size="2"   >[root@db-172-16-3-33 luasocket]# lua</font></div><div><font size="2"   >Lua 5.2.3 &nbsp;Copyright (C) 1994-2013 Lua.org, PUC-Rio</font></div><div><font size="2"   >&gt; require ("socket")</font></div></div><p></p></pre></div><div>打印socket包含的对象 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >function print_tbl(v_s)&nbsp;</font></div><div><font size="2"   >&nbsp; if type(v_s) == "table" then</font></div><div><font size="2"   >&nbsp; &nbsp; print(v_s, "contents:-----------------------------------------------")</font></div><div><font size="2"   >&nbsp; &nbsp; for k,v in pairs(v_s) do&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; if type(v_s[k]) == "table"&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; then&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; print(v_s,k,v)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; print_tbl(v_s[k])&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; else&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; print(v_s,k,v)&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; end&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; end</font></div><div><font size="2"   >&nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; error("please enter a table variable.")</font></div><div><font size="2"   >&nbsp; end</font></div><div><font size="2"   >end</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >&gt; s = require("socket")</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >&gt; print_tbl(s)</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;contents:-----------------------------------------------</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;dns &nbsp; &nbsp; table: 0x15b95c0</font></div><div><font size="2"   >table: 0x15b95c0 &nbsp; &nbsp; &nbsp; &nbsp;contents:-----------------------------------------------</font></div><div><font size="2"   >table: 0x15b95c0 &nbsp; &nbsp; &nbsp; &nbsp;getaddrinfo &nbsp; &nbsp; function: 0x7f5d2c2ded80</font></div><div><font size="2"   >table: 0x15b95c0 &nbsp; &nbsp; &nbsp; &nbsp;gethostname &nbsp; &nbsp; function: 0x7f5d2c2deb20</font></div><div><font size="2"   >table: 0x15b95c0 &nbsp; &nbsp; &nbsp; &nbsp;toip &nbsp; &nbsp;function: 0x7f5d2c2df1d0</font></div><div><font size="2"   >table: 0x15b95c0 &nbsp; &nbsp; &nbsp; &nbsp;getnameinfo &nbsp; &nbsp; function: 0x7f5d2c2deba0</font></div><div><font size="2"   >table: 0x15b95c0 &nbsp; &nbsp; &nbsp; &nbsp;tohostname &nbsp; &nbsp; &nbsp;function: 0x7f5d2c2df140</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;__unload &nbsp; &nbsp; &nbsp; &nbsp;function: 0x7f5d2c2dc510</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;choose &nbsp;function: 0x15bb6b0</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;sink &nbsp; &nbsp;function: 0x15badc0</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;sourcet table: 0x15bb6e0</font></div><div><font size="2"   >table: 0x15bb6e0 &nbsp; &nbsp; &nbsp; &nbsp;contents:-----------------------------------------------</font></div><div><font size="2"   >table: 0x15bb6e0 &nbsp; &nbsp; &nbsp; &nbsp;default function: 0x15baee0</font></div><div><font size="2"   >table: 0x15bb6e0 &nbsp; &nbsp; &nbsp; &nbsp;by-length &nbsp; &nbsp; &nbsp; function: 0x15bae00</font></div><div><font size="2"   >table: 0x15bb6e0 &nbsp; &nbsp; &nbsp; &nbsp;until-closed &nbsp; &nbsp;function: 0x15baee0</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;skip &nbsp; &nbsp;function: 0x7f5d2c2dc520</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;_VERSION &nbsp; &nbsp; &nbsp; &nbsp;LuaSocket 3.0-rc1</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;source &nbsp;function: 0x15bafd0</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;sleep &nbsp; function: 0x7f5d2c2dc6b0</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;udp &nbsp; &nbsp; function: 0x7f5d2c2e1450</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;BLOCKSIZE &nbsp; &nbsp; &nbsp; 2048</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;tcp &nbsp; &nbsp; function: 0x7f5d2c2e0b30</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;_SETSIZE &nbsp; &nbsp; &nbsp; &nbsp;1024</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;sinkt &nbsp; table: 0x15bb730</font></div><div><font size="2"   >table: 0x15bb730 &nbsp; &nbsp; &nbsp; &nbsp;contents:-----------------------------------------------</font></div><div><font size="2"   >table: 0x15bb730 &nbsp; &nbsp; &nbsp; &nbsp;default function: 0x15bb7e0</font></div><div><font size="2"   >table: 0x15bb730 &nbsp; &nbsp; &nbsp; &nbsp;close-when-done function: 0x15bb780</font></div><div><font size="2"   >table: 0x15bb730 &nbsp; &nbsp; &nbsp; &nbsp;keep-open &nbsp; &nbsp; &nbsp; function: 0x15bb7e0</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;newtry &nbsp;function: 0x7f5d2c2dfe70</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;select &nbsp;function: 0x7f5d2c2e0360</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;try &nbsp; &nbsp; function: 0x15bbeb0</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;bind &nbsp; &nbsp;function: 0x15b94c0</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;connect6 &nbsp; &nbsp; &nbsp; &nbsp;function: 0x15bbe50</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;protect function: 0x7f5d2c2dfda0</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;gettime function: 0x7f5d2c2dc7b0</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;connect4 &nbsp; &nbsp; &nbsp; &nbsp;function: 0x15b9640</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;connect function: 0x7f5d2c2e0780</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;udp6 &nbsp; &nbsp;function: 0x7f5d2c2e1440</font></div><div><font size="2"   >table: 0x15b9410 &nbsp; &nbsp; &nbsp; &nbsp;tcp6 &nbsp; &nbsp;function: 0x7f5d2c2e0b20</font></div></div><p></p></pre></div><div><br></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&gt; print_tbl(s.dns.getnameinfo('127.0.0.1'))</font></div><div><font size="2"   >table: 0x15ca660 &nbsp; &nbsp; &nbsp; &nbsp;contents:-----------------------------------------------</font></div><div><font size="2"   >table: 0x15ca660 &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; localhost</font></div><div><font size="2"   >&gt; print_tbl(s.dns.getnameinfo('192.168.1.1'))</font></div><div><font size="2"   >table: 0x15b3cb0 &nbsp; &nbsp; &nbsp; &nbsp;contents:-----------------------------------------------</font></div><div><font size="2"   >table: 0x15b3cb0 &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; 192.168.1.1</font></div><div><font size="2"   >&gt; print_tbl(s.dns.getnameinfo('202.101.172.35'))</font></div><div><font size="2"   >table: 0x15c9340 &nbsp; &nbsp; &nbsp; &nbsp;contents:-----------------------------------------------</font></div><div><font size="2"   >table: 0x15c9340 &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; &nbsp; hangzhou.zjhzptt.net.cn</font></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://github.com/diegonehab/luasocket/"   >https://github.com/diegonehab/luasocket/</a></div>2.&nbsp;<a target="_blank" rel="nofollow" href="http://luaforge.net/projects/"   >http://luaforge.net/projects/</a><br><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://lua-users.org/wiki/LibrariesAndBindings"   >http://lua-users.org/wiki/LibrariesAndBindings</a></div></div>
	</div>
</div>
</body>
</html>