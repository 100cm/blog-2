<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Lua io.lines("filename", $fmt)</h2>
	<h5 id="">2014-02-18 20:15:04&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020141188350795/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>使用io.lines可以读取文件的内容, 返回一个函数.</div><div>每次调用这个函数, 按照格式要求输出文件的内容.</div><div>格式如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >"*n": reads a number; this is the only format that returns a number instead of a string.</font></span></div><div><font size="2"   >"*a": reads the whole file, starting at the current position. On end of file, it returns the empty string.</font></div><div><font size="2"   >"*l": reads the next line skipping the end of line, returning nil on end of file. This is the default format.</font></div><div><font size="2"   >"*L": reads the next line keeping the end of line (if present), returning nil on end of file.</font></div><div><font size="2"   >number: reads a string with up to this number of bytes, returning nil on end of file. If number is zero, it reads nothing and returns an empty string, or nil on end of file.</font></div><p></p></pre></div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-150 ~]# pwd</font></div><div><font size="2"   >/root</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# ll install.log</font></div><div><font size="2"   >-rw-r--r--. 1 root root 41261 Sep 26 15:30 install.log</font></div><div><font size="2"   >[root@db-172-16-3-150 ~]# lua</font></div><div><font size="2"   >Lua 5.2.3 &nbsp;Copyright (C) 1994-2013 Lua.org, PUC-Rio</font></div><div><font size="2"   >&gt; f = io.lines("/root/install.log", "*l") &nbsp;-- "*l"每次读取一行, 不添加回车.</font></div><div><font size="2"   >&gt; print(type(f)) &nbsp; -- f是一个函数</font></div><div><font size="2"   >function</font></div><div><font size="2"   >&gt; print( f() ) &nbsp;-- 调用f函数, 每次返回一行,&nbsp;<span style="line-height: 28px;"   >&nbsp;</span><span style="line-height: 28px;"   >不添加回车.</span></font></div><div><font size="2"   >Installing libgcc-4.4.7-3.el6.x86_64</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >warning: libgcc-4.4.7-3.el6.x86_64: Header V3 RSA/SHA1 Signature, key ID c105b9de: NOKEY</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >Installing ca-certificates-2010.63-3.el6_1.5.noarch</font></div><div><font size="2"   >&gt; f = io.lines("/root/install.log", "*L") &nbsp;-- "*L" 每次返回一行, 同时加一个回车.</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >Installing libgcc-4.4.7-3.el6.x86_64</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >warning: libgcc-4.4.7-3.el6.x86_64: Header V3 RSA/SHA1 Signature, key ID c105b9de: NOKEY</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >&gt; f = io.lines("/root/install.log", 5) &nbsp;-- 数字表示每次读取多少个字节, 如果是多字节字符可能有问题.</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >Insta</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >lling</font></div><div><font size="2"   >&gt; f = io.lines("/root/install.log", "*a")  -- "*a" 表示一次读取文件的所有内容</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >Installing libgcc-4.4.7-3.el6.x86_64</font></div><div><font size="2"   >warning: libgcc-4.4.7-3.el6.x86_64: Header V3 RSA/SHA1 Signature, key ID c105b9de: NOKEY</font></div><div><font size="2"   >Installing ca-certificates-2010.63-3.el6_1.5.noarch</font></div></div><div><font size="2"   >... 略</font></div><p></p></pre></div><div><br></div><div>多字节字符, 使用数字返回, 必须要复合字节数, 否则会有问题.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@db-172-16-3-150 ~]# vi test.lua</font></div><div><font size="2"   >你好test=100</font></div><div><font size="2"   >return test</font></div></div><div><div><font size="2"   >[root@db-172-16-3-150 ~]# lua</font></div><div><font size="2"   >Lua 5.2.3 &nbsp;Copyright (C) 1994-2013 Lua.org, PUC-Rio</font></div><div><font size="2"   >&gt; f = io.lines("/root/test.lua", 2)</font></div><div><font size="2"   >&gt; print( f() ) &nbsp;-- 因为UTF-8中文使用了3个字节, 所以返回有问题.</font></div><div><font size="2"   >位</font></div><div><font size="2"   >&nbsp; &gt; print( f() )</font></div><div><font size="2"   >?半&gt;&nbsp;</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >￥?</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >te</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >st</font></div></div><div><font size="2"   >-- 使用3个字节, 正常返回存储的中文.</font></div><div><div><font size="2"   >&gt; f = io.lines("/root/test.lua", 3)</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >你</font></div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >好</font></div></div><div><div><font size="2"   >&gt; print( f() )</font></div><div><font size="2"   >tes</font></div></div><p></p></pre></div><div><br></div><div><span style="line-height: 28px;"   >[参考]</span></div><wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.lua.org/manual/5.2/manual.html#pdf-io.lines"   >http://www.lua.org/manual/5.2/manual.html#pdf-io.lines</a></div></div>
	</div>
</div>
</body>
</html>