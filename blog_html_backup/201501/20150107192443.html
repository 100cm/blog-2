<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">use cgroup limit cpu core usage</h2>
	<h5 id="">2015-01-07 19:24:43&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020150771345617/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><div>本文将测试一下使用cgroup的cpuset组来控制进程对CPU的使用 :&nbsp;</div><div>测试环境CentOS 7.x x64</div><div>创建一个继承组</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@150 rg1]# cd /sys/fs/cgroup/cpuset/</font></div><div><font size="2"   >[root@150 cpuset]# mkdir cg1</font></div><p></p></pre></div><div>继承组自动创建对应的限制文件</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost cpuset]# cd cg1</font></div><div><font size="2"   >[root@localhost cg1]# ll</font></div><div><font size="2"   >total 0</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 cgroup.clone_children</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 cgroup.procs</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.cpu_exclusive</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 03:06 cpuset.cpus</font></div><div><font size="2"   >-r--r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.effective_cpus</font></div><div><font size="2"   >-r--r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.effective_mems</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.mem_exclusive</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.mem_hardwall</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.memory_migrate</font></div><div><font size="2"   >-r--r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.memory_pressure</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.memory_spread_page</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.memory_spread_slab</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 03:01 cpuset.mems</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.sched_load_balance</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 cpuset.sched_relax_domain_level</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 00:46 notify_on_release</font></div><div><font size="2"   >-rw-r--r-- 1 root root 0 Jan &nbsp;8 03:01 tasks</font></div><p></p></pre></div><div>继承组的tasks为空.</div><div><br></div><div>查看CPU资源</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   ># lscpu&nbsp;</font></div><div><font size="2"   >Architecture: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x86_64</font></div><div><font size="2"   >CPU op-mode(s): &nbsp; &nbsp; &nbsp; &nbsp;32-bit, 64-bit</font></div><div><font size="2"   >Byte Order: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Little Endian</font></div><div><font size="2"   >CPU(s): &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8</font></div><div><font size="2"   >On-line CPU(s) list: &nbsp; 0-7</font></div><div><font size="2"   >Thread(s) per core: &nbsp; &nbsp;1</font></div><div><font size="2"   >Core(s) per socket: &nbsp; &nbsp;4</font></div><div><font size="2"   >Socket(s): &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2</font></div><div><font size="2"   >NUMA node(s): &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1</font></div><div><font size="2"   >Vendor ID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GenuineIntel</font></div><div><font size="2"   >CPU family: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6</font></div><div><font size="2"   >Model: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 26</font></div><div><font size="2"   >Model name: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Intel(R) Xeon(R) CPU &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; E5504 &nbsp;@ 2.00GHz</font></div><div><font size="2"   >Stepping: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5</font></div><div><font size="2"   >CPU MHz: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1995.053</font></div><div><font size="2"   >BogoMIPS: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3989.39</font></div><div><font size="2"   >Virtualization: &nbsp; &nbsp; &nbsp; &nbsp;VT-x</font></div><div><font size="2"   >L1d cache: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 32K</font></div><div><font size="2"   >L1i cache: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 32K</font></div><div><font size="2"   >L2 cache: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;256K</font></div><div><font size="2"   >L3 cache: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4096K</font></div><div><font size="2"   >NUMA node0 CPU(s): &nbsp; &nbsp; 0-7</font></div><p></p></pre></div><div><br></div><div>设置cpuset.mems</div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost cg1]# echo 0 &gt; ./cpuset.mems</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >否则在将PID添加到这个组的时候, 会报错如下 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost cg1]# echo 48413 &gt;./tasks&nbsp;</font></div><div><font size="2"   >-bash: echo: write error: No space left on device</font></div><p></p></pre></div><div><br></div><div>设置cpuset.cpus</div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost cg1]# echo 7 &gt; ./cpuset.cpus</font></div><div></div><p></p></pre></div><div>将数据库的主进程加入到这个组</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >[root@localhost cg1]# ps -ewf|grep postgres</font></div><div><font size="2"   >postgres &nbsp; 48413 &nbsp; &nbsp; &nbsp; 1 &nbsp;0 Jan07 ? &nbsp; &nbsp; &nbsp; &nbsp;00:00:00 /opt/pgsql9.3.5/bin/postgres</font></div></div><div><font size="2"   >[root@localhost cg1]# echo 48413 &gt;./tasks</font></div><p></p></pre></div><div><br></div><div>现在数据库被限制了只能使用7号CPU 核.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@localhost-&gt; pgbench -M prepared -n -r -f ./test.sql -c 16 -j 4 -h 127.0.0.1 -T 30</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 16</font></div><div><font size="2"   >number of threads: 4</font></div><div><font size="2"   >duration: 30 s</font></div><div><font size="2"   >number of transactions actually processed: 560871</font></div><div><font size="2"   >tps = 18695.122321 (including connections establishing)</font></div><div><font size="2"   >tps = 18746.566935 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.851678 &nbsp; &nbsp; &nbsp; &nbsp;select 1;</font></div><p></p></pre></div><div><br></div><div>使用top的P选项查看 :&nbsp;</div><div>在top界面按&nbsp;<span style="line-height: 28px;"   >f&nbsp;</span></div><div>选择</div><pre class="prettyprint"   ><p></p><div><font size="2"   >* P &nbsp; &nbsp; &nbsp; = Last Used Cpu (SMP)&nbsp;</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >查看到所有postgres进程新fork的backend process都用的7号cpu</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; PID USER &nbsp; &nbsp; &nbsp;PR &nbsp;NI &nbsp; &nbsp;VIRT &nbsp; &nbsp;RES &nbsp; &nbsp;SHR S &nbsp;%CPU %MEM &nbsp; &nbsp; TIME+ COMMAND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P&nbsp;</font></div><div><font size="2"   >&nbsp; 54349 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10076 &nbsp; 8308 R &nbsp; 7.3 &nbsp;0.0 &nbsp; 0:00.79 postgres: postgres postgres 127.0.0.1(14172) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54351 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10076 &nbsp; 8308 S &nbsp; 7.3 &nbsp;0.0 &nbsp; 0:00.79 postgres: postgres postgres 127.0.0.1(14174) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54353 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10140 &nbsp; 8372 R &nbsp; 7.3 &nbsp;0.0 &nbsp; 0:00.79 postgres: postgres postgres 127.0.0.1(14176) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54354 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10076 &nbsp; 8308 R &nbsp; 7.3 &nbsp;0.0 &nbsp; 0:00.80 postgres: postgres postgres 127.0.0.1(14177) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54355 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp; 9900 &nbsp; 8136 S &nbsp; 7.3 &nbsp;0.0 &nbsp; 0:00.80 postgres: postgres postgres 127.0.0.1(14178) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54356 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp; 9836 &nbsp; 8068 R &nbsp; 7.3 &nbsp;0.0 &nbsp; 0:00.79 postgres: postgres postgres 127.0.0.1(14179) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54357 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp;10080 &nbsp; 8308 R &nbsp; 7.3 &nbsp;0.0 &nbsp; 0:00.79 postgres: postgres postgres 127.0.0.1(14180) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54358 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp;10016 &nbsp; 8244 R &nbsp; 7.3 &nbsp;0.0 &nbsp; 0:00.79 postgres: postgres postgres 127.0.0.1(14181) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54360 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9956 &nbsp; 8184 R &nbsp; 7.3 &nbsp;0.0 &nbsp; 0:00.79 postgres: postgres postgres 127.0.0.1(14183) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54361 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp;10020 &nbsp; 8248 R &nbsp; 7.3 &nbsp;0.0 &nbsp; 0:00.78 postgres: postgres postgres 127.0.0.1(14184) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54350 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10076 &nbsp; 8308 R &nbsp; 3.7 &nbsp;0.0 &nbsp; 0:00.79 postgres: postgres postgres 127.0.0.1(14173) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54352 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10076 &nbsp; 8308 R &nbsp; 3.7 &nbsp;0.0 &nbsp; 0:00.79 postgres: postgres postgres 127.0.0.1(14175) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54359 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp;10020 &nbsp; 8248 R &nbsp; 3.7 &nbsp;0.0 &nbsp; 0:00.78 postgres: postgres postgres 127.0.0.1(14182) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54362 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9956 &nbsp; 8184 R &nbsp; 3.7 &nbsp;0.0 &nbsp; 0:00.78 postgres: postgres postgres 127.0.0.1(14185) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54363 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9960 &nbsp; 8188 R &nbsp; 3.7 &nbsp;0.0 &nbsp; 0:00.78 postgres: postgres postgres 127.0.0.1(14186) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54364 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9956 &nbsp; 8184 R &nbsp; 3.7 &nbsp;0.0 &nbsp; 0:00.77 postgres: postgres postgres 127.0.0.1(14187) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 48413 postgres &nbsp;20 &nbsp; 0 &nbsp;306188 &nbsp;15896 &nbsp;15036 S &nbsp; 0.0 &nbsp;0.0 &nbsp; 0:00.28 /opt/pgsql9.3.5/bin/postgres &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp;</font></div><p></p></pre></div><div><br></div><div>改为0-7可以使用8个CPU核</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@localhost cg1]# echo 0-7 &gt; ./cpuset.cpus</font></div><div></div><p></p></pre></div><div>再次测试 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >PID USER &nbsp; &nbsp; &nbsp;PR &nbsp;NI &nbsp; &nbsp;VIRT &nbsp; &nbsp;RES &nbsp; &nbsp;SHR S &nbsp;%CPU %MEM &nbsp; &nbsp; TIME+ COMMAND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><span style="line-height: 28px;"   ><font size="2"   >&nbsp; 54424 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10004 &nbsp; 8236 S &nbsp;35.6 &nbsp;0.0 &nbsp; 0:04.28 postgres: postgres postgres 127.0.0.1(14191) BIND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4&nbsp;</font></span></div><div><font size="2"   >&nbsp; 54423 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10076 &nbsp; 8308 S &nbsp;35.1 &nbsp;0.0 &nbsp; 0:04.23 postgres: postgres postgres 127.0.0.1(14190) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4&nbsp;</font></div><div><font size="2"   >&nbsp; 54425 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10076 &nbsp; 8308 R &nbsp;34.6 &nbsp;0.0 &nbsp; 0:04.24 postgres: postgres postgres 127.0.0.1(14192) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3&nbsp;</font></div><div><font size="2"   >&nbsp; 54433 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9336 &nbsp; 7580 S &nbsp;34.0 &nbsp;0.0 &nbsp; 0:03.97 postgres: postgres postgres 127.0.0.1(14200) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6&nbsp;</font></div><div><font size="2"   >&nbsp; 54426 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10116 &nbsp; 8348 S &nbsp;33.5 &nbsp;0.0 &nbsp; 0:04.20 postgres: postgres postgres 127.0.0.1(14193) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3&nbsp;</font></div><div><font size="2"   >&nbsp; 54427 postgres &nbsp;20 &nbsp; 0 &nbsp;307264 &nbsp;10076 &nbsp; 8308 S &nbsp;33.5 &nbsp;0.0 &nbsp; 0:03.99 postgres: postgres postgres 127.0.0.1(14194) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6&nbsp;</font></div><div><font size="2"   >&nbsp; 54428 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9652 &nbsp; 7892 R &nbsp;33.0 &nbsp;0.0 &nbsp; 0:04.05 postgres: postgres postgres 127.0.0.1(14195) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6&nbsp;</font></div><div><font size="2"   >&nbsp; 54429 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9652 &nbsp; 7892 R &nbsp;32.5 &nbsp;0.0 &nbsp; 0:04.06 postgres: postgres postgres 127.0.0.1(14196) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp;</font></div><div><font size="2"   >&nbsp; 54434 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp;10020 &nbsp; 8248 S &nbsp;31.9 &nbsp;0.0 &nbsp; 0:03.92 postgres: postgres postgres 127.0.0.1(14201) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5&nbsp;</font></div><div><font size="2"   >&nbsp; 54437 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9896 &nbsp; 8124 R &nbsp;31.9 &nbsp;0.0 &nbsp; 0:03.91 postgres: postgres postgres 127.0.0.1(14204) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp;</font></div><div><font size="2"   >&nbsp; 54438 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9956 &nbsp; 8184 R &nbsp;31.9 &nbsp;0.0 &nbsp; 0:03.85 postgres: postgres postgres 127.0.0.1(14205) BIND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp;</font></div><div><font size="2"   >&nbsp; 54430 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9648 &nbsp; 7888 R &nbsp;31.4 &nbsp;0.0 &nbsp; 0:03.99 postgres: postgres postgres 127.0.0.1(14197) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3&nbsp;</font></div><div><font size="2"   >&nbsp; 54431 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9940 &nbsp; 8168 S &nbsp;31.4 &nbsp;0.0 &nbsp; 0:03.91 postgres: postgres postgres 127.0.0.1(14198) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3&nbsp;</font></div><div><font size="2"   >&nbsp; 54432 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9340 &nbsp; 7588 S &nbsp;31.4 &nbsp;0.0 &nbsp; 0:03.92 postgres: postgres postgres 127.0.0.1(14199) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4&nbsp;</font></div><div><font size="2"   >&nbsp; 54435 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9956 &nbsp; 8184 S &nbsp;30.9 &nbsp;0.0 &nbsp; 0:03.80 postgres: postgres postgres 127.0.0.1(14202) idle &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><div><font size="2"   >&nbsp; 54436 postgres &nbsp;20 &nbsp; 0 &nbsp;307268 &nbsp; 9956 &nbsp; 8184 R &nbsp;30.9 &nbsp;0.0 &nbsp; 0:03.85 postgres: postgres postgres 127.0.0.1(14203) BIND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp;</font></div><p></p></pre></div><div><br></div><div>当然性能也有提升</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@localhost-&gt; pgbench -M prepared -n -r -f ./test.sql -c 16 -j 4 -h 127.0.0.1 -T 30</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 16</font></div><div><font size="2"   >number of threads: 4</font></div><div><font size="2"   >duration: 30 s</font></div><div><font size="2"   >number of transactions actually processed: 2924931</font></div><div><font size="2"   >tps = 97490.141264 (including connections establishing)</font></div><div><font size="2"   >tps = 97533.454952 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.162975 &nbsp; &nbsp; &nbsp; &nbsp;select 1;</font></div><p></p></pre></div><div><br></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://www.kernel.org/doc/Documentation/cgroups/cgroups.txt"   >https://www.kernel.org/doc/Documentation/cgroups/cgroups.txt</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201411341949278/"   >http://blog.163.com/digoal@126/blog/static/163877040201411341949278/</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/1638770402014102653934376/"   >http://blog.163.com/digoal@126/blog/static/1638770402014102653934376/</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://serverfault.com/questions/579555/cgroup-no-space-left-on-device"   >http://serverfault.com/questions/579555/cgroup-no-space-left-on-device</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.cnblogs.com/wang_yb/p/3942208.html"   >http://www.cnblogs.com/wang_yb/p/3942208.html</a></div><div>6.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.bullopensource.org/cpuset/cpuset.html"   >http://www.bullopensource.org/cpuset/cpuset.html<br></a><span style="line-height: 28px;"   >
</span><a style="line-height: 28px;" rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="use cgroup limit cpu core usage - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div></div>
	</div>
</div>
</body>
</html>