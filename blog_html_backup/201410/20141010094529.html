<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">nftables will replace {ip|ip6|eb|arp}tables in kernel >= 3.13</h2>
	<h5 id="">2014-10-10 9:45:29&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201491094529600/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="line-height: 28px;"   >nftables未来要替换iptables, 目前还处于开发状态.</span></div><div><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 19.0499992370605px; font-family: sans-serif; font-size: 13px;"   ><b>nftables</b>&nbsp;is the new packet classification framework that intends to replace the existing {ip,ip6,arp,eb}_tables infrastructure. In a nutshell:</p><ul style="line-height: 19.0499992370605px; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em; font-family: sans-serif; font-size: 13px;"   ><li style="margin-bottom: 0.1em;"   >It is available in Linux kernels &gt;= 3.13.</li></ul><ul style="line-height: 19.0499992370605px; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em; font-family: sans-serif; font-size: 13px;"   ><li style="margin-bottom: 0.1em;"   >It comes with a new command line utility&nbsp;<i>nft</i>&nbsp;whose syntax is different to iptables.</li></ul><ul style="line-height: 19.0499992370605px; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em; font-family: sans-serif; font-size: 13px;"   ><li style="margin-bottom: 0.1em;"   >It also comes with a compatibility layer that allows you to run iptables commands over the new nftables kernel framework.</li></ul><ul style="line-height: 19.0499992370605px; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em; font-family: sans-serif; font-size: 13px;"   ><li style="margin-bottom: 0.1em;"   >It also comes with the generic set infrastructure that allows you to construct mappings between matchings and actions for performance lookups.</li></ul><ul style="line-height: 19.0499992370605px; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em; font-family: sans-serif; font-size: 13px;"   ><li style="margin-bottom: 0.1em;"   >This software is under development, so get ready to report bugs in case you experience problems.&nbsp;<a rel="nofollow" href="https://bugzilla.netfilter.org/"   >Netfilter's bugzilla</a>&nbsp;is your friend.</li></ul></div><div>CentOS 7.0 的内核还是3.10的, 所以nftables暂时不会出现在7.0的版本中.</div><div>需要试用的话, 可以下载nftables源码, 重新编译内核.</div><div>相比iptables的好处</div><div><div style="font-family: arial, helvetica, sans-serif; font-size: medium; line-height: normal;"   ><h2 style="font-family: Arial, Helvetica, sans-serif; color: rgb(0, 51, 153); border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: rgb(0, 51, 153); clear: both;"   >Main Features</h2></div><p style="font-family: arial, helvetica, sans-serif; font-size: medium; line-height: normal;"   ></p><div style="font-family: arial, helvetica, sans-serif; font-size: medium; line-height: normal;"   ><ul type="bullet"   ><li style="list-style-type: disc;"   >Pseudo-state machine in kernel-space: the userspace utility&nbsp;<span><strong>nftables</strong></span>&nbsp;interprets the rule-set provided by the user (using a new syntax), it compiles it into the pseudo-state machine bytecode and then it transfers it to the kernel via the nftables Netlink's API. Roughly, the idea behind nftables is similar to the Berkeley Packet Filters (BPF).</li><li style="list-style-type: disc;"   >Fast lookups through performance data structures: The new syntax allows you to arrange you rule-set in a very performance way contrary to purely linear-list based filtering policies. Nftables allows you to use set-based action mappings, ie. for a matching element in the set, issue the action specified by the user.</li><li style="list-style-type: disc;"   >Reduce the amount of code in kernel-space. You can express the packet selectors for all existing protocols using the instruction-set provided by the nftables pseudo-state machine. That means that we do not need a specific extension in kernel-space for each protocol that you want to support. As a side effect, you are likely not need to upgrade your kernel to obtain new features as it has been designed to keep most of the logic in user-space.</li><li style="list-style-type: disc;"   >Unified interface to replace iptables/ip6tables/arptables/ebtables utilities. Thus, we will be able to fully get rid of all the existing code replication in kernel and user-space.</li></ul></div></div><div><h1 id="firstHeading"   style="font-weight: normal; margin: 0px 0px 0.1em; overflow: hidden; padding-top: 0.5em; padding-bottom: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); width: auto; font-size: 24px; line-height: 1.2em; font-family: sans-serif; background: none;"   ><span dir="auto"   >Main differences with iptables</span></h1><div id="bodyContent"   style="font-family: sans-serif; font-size: 13px; line-height: 19.0499992370605px;"   ><div id="contentSub"   style="font-size: 12px; line-height: 1.2em; margin: 0px 0px 1.4em 1em; color: rgb(125, 125, 125); width: auto;"   ></div><div id="jump-to-nav"   style="overflow: hidden; height: 0px; zoom: 1; margin-top: -1.4em; margin-bottom: 1.4em;"   ><a style="text-decoration: none; color: rgb(90, 54, 150); background: none;" rel="nofollow" href="http://wiki.nftables.org/wiki-nftables/index.php/Main_differences_with_iptables#column-one"   ></a><a style="text-decoration: none; color: rgb(90, 54, 150); background: none;" rel="nofollow" href="http://wiki.nftables.org/wiki-nftables/index.php/Main_differences_with_iptables#searchInput"   ></a></div><div id="mw-content-text"   lang="en"   dir="ltr"   style="direction: ltr;"   ><p style="margin-top: 0.4em; margin-bottom: 0.5em; line-height: 1.5em;"   >The main differences between&nbsp;<i>nftables</i>&nbsp;and&nbsp;<i>iptables</i>&nbsp;from the user point of view are:</p><ul style="line-height: 1.5em; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em;"   ><li style="margin-bottom: 0.1em;"   >The&nbsp;<b>syntax</b>. The&nbsp;<i>iptables</i>&nbsp;command line tool uses a getopt_long()-based parser where keys are always preceded by double minus, eg.&nbsp;<i>--key</i>&nbsp;or one single minus, eg.&nbsp;<i>-p tcp</i>. In that regard,&nbsp;<i>nftables</i>&nbsp;uses cleaner syntax which is inspired by&nbsp;<i>tcpdump</i>.</li></ul><ul style="line-height: 1.5em; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em;"   ><li style="margin-bottom: 0.1em;"   ><b>Tables and chains are fully configurable</b>. Contrary to&nbsp;<i>iptables</i>&nbsp;that comes with a set of already defined tables and chains,&nbsp;<i>nftables</i>&nbsp;allows you to create your own tables and chain configurations. We have gotten reports in the past that unused predefined chains were harming performance, even if unused. With this new approach, you can just register the chains that you need depending on your setup.</li></ul><ul style="line-height: 1.5em; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em;"   ><li style="margin-bottom: 0.1em;"   ><b>No distinction between matches and targets anymore</b>. In&nbsp;<i>nftables</i>, we have&nbsp;<i>expressions</i>&nbsp;that are basically instructions that can be used to build the rule. This approach is radically different from&nbsp;<i>iptables</i>, that requires specific extensions to match protocol header fields and packet meta information.</li></ul><ul style="line-height: 1.5em; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em;"   ><li style="margin-bottom: 0.1em;"   ><b>You can specify several actions in one single rule</b>. In&nbsp;<i>iptables</i>&nbsp;you can only specify one single target. This has been a longstanding limitation that has been resolved by jumping to custom chains at the cost of making the rule-set structure slightly a bit more complex.</li></ul><ul style="line-height: 1.5em; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em;"   ><li style="margin-bottom: 0.1em;"   ><b>No built-in counter per chain and rules</b>. In&nbsp;<i>nftables</i>, these are optional so you can enable counters on demand.</li></ul><ul style="line-height: 1.5em; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em;"   ><li style="margin-bottom: 0.1em;"   ><b>Generic set infrastructure</b>. This infrastructure integrates tightly into the nftables core and it allows advanced configurations such as&nbsp;<a title="Dictionaries" style="text-decoration: none; color: rgb(90, 54, 150); background: none;" rel="nofollow" href="http://wiki.nftables.org/wiki-nftables/index.php/Dictionaries"   >dictionaries</a>,&nbsp;<a title="Maps" style="text-decoration: none; color: rgb(90, 54, 150); background: none;" rel="nofollow" href="http://wiki.nftables.org/wiki-nftables/index.php/Maps"   >maps</a>&nbsp;and<a title="Intervals" style="text-decoration: none; color: rgb(90, 54, 150); background: none;" rel="nofollow" href="http://wiki.nftables.org/wiki-nftables/index.php/Intervals"   >intervals</a>&nbsp;to achieve performance-oriented packet classification. The most important thing is that you can use&nbsp;<i>any</i>&nbsp;supported selector to classify traffic.</li></ul><ul style="line-height: 1.5em; list-style-type: square; margin-top: 0.3em; margin-bottom: 0px; margin-left: 1.6em;"   ><li style="margin-bottom: 0.1em;"   ><b>New supported protocols without kernel upgrades</b>. Kernel upgrade is a timeconsuming task, specifically if you have to maintain more than one single firewall in your network. Distributors usually include a bit older Linux kernel versions for stability reasons. With the new pseudo-state machine approach, you will most likely not need such upgrade to support a new protocol, a relatively simple&nbsp;<i>nft</i>&nbsp;userspace utility update should be enough to obtain it.</li></ul></div></div></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.netfilter.org/projects/nftables/index.html"   >http://www.netfilter.org/projects/nftables/index.html</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://wiki.nftables.org/wiki-nftables/index.php/Main_Page"   >http://wiki.nftables.org/wiki-nftables/index.php/Main_Page<br></a><span style="line-height: 28px;"   >
</span><a style="line-height: 28px;" rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="nftables will replace {ip|ip6|eb|arp}tables in kernel = 3.13 - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div></div>
	</div>
</div>
</body>
</html>