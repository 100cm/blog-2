<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">USE SysBench test Mysql and PostgreSQL - 1</h2>
	<h5 id="">2013-05-14 16:28:53&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201341441042613/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>上一篇介绍了编译sysbench支持mysql和postgresql.</div><div>本文将简单的介绍一下sysbench测试mysql和postgresql.</div><div>首先初始化数据 :&nbsp;</div><div>MySQL :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-33 bin]# ./sysbench --test=oltp --oltp-table-size=10000000 --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test --db-driver=mysql prepare</font></div><div><font size="2"   >sysbench 0.4.12: &nbsp;multi-threaded system evaluation benchmark</font></div><div><font size="2"   >Creating table 'sbtest'...</font></div><div><font size="2"   >Creating 10000000 records in table 'sbtest'...</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >PostgreSQL :&nbsp;</span></div><div><pre class="prettyprint"   ><p><font size="2"   >[root@db-172-16-3-33 bin]# ./sysbench --test=oltp --oltp-table-size=10000000 --pgsql-host=127.0.0.1 --pgsql-port=1999 --pgsql-user=postgres --pgsql-password=postgres --pgsql-db=postgres --db-driver=pgsql prepare</font></p></pre></div><div><br></div><div>实际执行的SQL是</div><div><pre class="prettyprint"   ><p><font size="2"   >CREATE TABLE sbtest (id SERIAL &nbsp;NOT NULL , k integer &nbsp;DEFAULT '0' NOT NULL, c char(120) DEFAULT '' NOT NULL, pad char(60) DEFAULT '' NOT NULL, PRIMARY KEY &nbsp;(id) );</font></p></pre></div><div>然后调用1000W次以下SQL.</div><div><pre class="prettyprint"   ><p><font size="2"   >INSERT INTO sbtest(k, c, pad) VALUES (0,' ','qqqqqqqqqqwwwwwwwwwweeeeeeeeeerrrrrrrrrrtttttttttt');</font></p></pre></div><div>插入速度较慢, 可以自己插入.</div><div>停掉sysbench prepare进程, 然后在psql shell中执行.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres=# truncate sbtest ;</font></div><div><font size="2"   >TRUNCATE TABLE</font></div><div><font size="2"   >postgres=# INSERT INTO sbtest(k, c, pad) select 0,' ','qqqqqqqqqqwwwwwwwwwweeeeeeeeeerrrrrrrrrrtttttttttt' from generate_series(1,10000000);</font></div><div><font size="2"   >INSERT 0 10000000</font></div><p></p></pre></div><div><br></div><div>[simple read测试]</div><div>MySQL :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-33 bin]# ./sysbench --max-requests=0 --max-time=60 --num-threads=16 --test=oltp --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test --db-driver=mysql --oltp-reconnect-mode=session --oltp-test-mode=simple run</font></div><div><font size="2"   >sysbench 0.4.12: &nbsp;multi-threaded system evaluation benchmark</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Running the test with following options:</font></div><div><font size="2"   >Number of threads: 16</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Doing OLTP test.</font></div><div><font size="2"   >Running simple OLTP test</font></div><div><font size="2"   >Using Special distribution (12 iterations, &nbsp;1 pct of values are returned in 75 pct cases)</font></div><div><font size="2"   >Using "BEGIN" for starting transactions</font></div><div><font size="2"   >Using auto_inc on the id column</font></div><div><font size="2"   >Threads started!</font></div><div><font size="2"   >Time limit exceeded, exiting...</font></div><div><font size="2"   >(last message repeated 15 times)</font></div><div><font size="2"   >Done.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >OLTP test statistics:</font></div><div><font size="2"   >&nbsp; &nbsp; queries performed:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; read: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5589652</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; other: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; total: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5589652</font></div><div><font size="2"   >&nbsp; &nbsp; transactions: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5589652 (93160.39 per sec.)</font></div><div><font size="2"   >&nbsp; &nbsp; deadlocks: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp;(0.00 per sec.)</font></div><div><font size="2"   >&nbsp; &nbsp; read/write requests: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5589652 (93160.39 per sec.)</font></div><div><font size="2"   >&nbsp; &nbsp; other operations: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;(0.00 per sec.)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Test execution summary:</font></div><div><font size="2"   >&nbsp; &nbsp; total time: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;60.0003s</font></div><div><font size="2"   >&nbsp; &nbsp; total number of events: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5589652</font></div><div><font size="2"   >&nbsp; &nbsp; total time taken by event execution: 940.6337</font></div><div><font size="2"   >&nbsp; &nbsp; per-request statistics:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;min: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.06ms</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;avg: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.17ms</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;max: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 96.02ms</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;approx. &nbsp;95 percentile: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.17ms</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Threads fairness:</font></div><div><font size="2"   >&nbsp; &nbsp; events (avg/stddev): &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 349353.2500/4024.92</font></div><div><font size="2"   >&nbsp; &nbsp; execution time (avg/stddev): &nbsp; 58.7896/0.05</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >PostgreSQL :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-33 bin]# ./sysbench --max-requests=0 --max-time=60 --num-threads=16 --test=oltp --db-driver=pgsql --pgsql-host=127.0.0.1 --pgsql-port=1999 --pgsql-user=postgres --pgsql-password=postgres --pgsql-db=postgres --oltp-test-mode=simple --oltp-reconnect-mode=session run</font></div><div><font size="2"   >sysbench 0.4.12: &nbsp;multi-threaded system evaluation benchmark</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Running the test with following options:</font></div><div><font size="2"   >Number of threads: 16</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Doing OLTP test.</font></div><div><font size="2"   >Running simple OLTP test</font></div><div><font size="2"   >Using Special distribution (12 iterations, &nbsp;1 pct of values are returned in 75 pct cases)</font></div><div><font size="2"   >Using "BEGIN" for starting transactions</font></div><div><font size="2"   >Using auto_inc on the id column</font></div><div><font size="2"   >Threads started!</font></div><div><font size="2"   >Time limit exceeded, exiting...</font></div><div><font size="2"   >(last message repeated 15 times)</font></div><div><font size="2"   >Done.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >OLTP test statistics:</font></div><div><font size="2"   >&nbsp; &nbsp; queries performed:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; read: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7961615</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; other: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; total: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7961615</font></div><div><font size="2"   >&nbsp; &nbsp; transactions: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7961615 (132692.94 per sec.)</font></div><div><font size="2"   >&nbsp; &nbsp; deadlocks: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp;(0.00 per sec.)</font></div><div><font size="2"   >&nbsp; &nbsp; read/write requests: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7961615 (132692.94 per sec.)</font></div><div><font size="2"   >&nbsp; &nbsp; other operations: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;(0.00 per sec.)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Test execution summary:</font></div><div><font size="2"   >&nbsp; &nbsp; total time: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;60.0003s</font></div><div><font size="2"   >&nbsp; &nbsp; total number of events: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7961615</font></div><div><font size="2"   >&nbsp; &nbsp; total time taken by event execution: 821.8844</font></div><div><font size="2"   >&nbsp; &nbsp; per-request statistics:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;min: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.05ms</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;avg: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.10ms</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;max: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;570.73ms</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;approx. &nbsp;95 percentile: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.12ms</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Threads fairness:</font></div><div><font size="2"   >&nbsp; &nbsp; events (avg/stddev): &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 497600.9375/34503.98</font></div><div><font size="2"   >&nbsp; &nbsp; execution time (avg/stddev): &nbsp; 51.3678/1.36</font></div><p></p></pre></div><div>PostgreSQL tps :&nbsp;132692.94&nbsp;</div><div>MySQL tps :&nbsp;93160.39&nbsp;</div><div><br></div><div>下一篇将介绍comple场景测试.</div><div><br></div>[参考]<wbr><div>1.&nbsp;Install SysBench support MySQL and PostgreSQL</div><div><a href="http://blog.163.com/digoal@126/blog/static/16387704020134142151769/"   >http://blog.163.com/digoal@126/blog/static/16387704020134142151769/</a></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="USE SysBench test Mysql and PostgreSQL - 1 - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>