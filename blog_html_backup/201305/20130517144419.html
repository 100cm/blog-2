<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">inode and hard link</h2>
	<h5 id="">2013-05-17 14:44:19&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201341722927382/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>In computing, an inode (index node) is a data structure found in many Unix file systems.&nbsp;</div><div>Each inode stores all the information about a file system object (file, device node, socket, pipe, etc.), <u>except data content and file name</u>.</div><div><div>inode 不包含数据内容和文件名的信息.</div><div>POSIX inode包含如下信息 :&nbsp;</div><div>POSIX inode description</div><div>The POSIX standard mandates filesystem behavior that is strongly influenced by traditional UNIX filesystems. Regular files must have the following attributes:</div><div>1. The size of the file in bytes.</div><div>2. Device ID (this identifies the device containing the file).</div><div>3. The User ID of the file's owner.</div><div>4. The Group ID of the file.</div><div>5. The file mode which determines the file type and how the file's owner, its group, and others can access the file.</div><div>6. Additional system and user flags to further protect the file (limit its use and modification).</div><div>7. Timestamps telling when the inode itself was last modified (ctime, inode change time), the file content last modified (mtime, modification time), and last accessed (atime, access time).</div><div>8. A link count telling how many hard links point to the inode.</div><div>9. Pointers to the disk blocks that store the file's contents (see inode pointer structure).</div><div>The stat system call retrieves a file's inode number and some of the information in the inode.</div></div><div>使用stat可以查看文件的inode号.</div><div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ stat rdp.sh&nbsp;</div><div>&nbsp; 文件："rdp.sh"</div><div>&nbsp; 大小：464 &nbsp; &nbsp; &nbsp; <span style="white-space:pre;"   >	</span>块：8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IO 块：4096 &nbsp; 普通文件</div><div>设备：801h/2049d<span style="white-space:pre;"   >	</span>Inode：<font color="#ff0000"   >1447366</font> &nbsp; &nbsp; 硬链接：1</div><div>权限：(0500/-r-x------) &nbsp;Uid：( 1000/ &nbsp;digoal) &nbsp; Gid：( 1000/ &nbsp;digoal)</div><div>最近访问：2013-05-16 16:23:17.116096958 +0800</div><div>最近更改：2013-03-27 14:09:31.984110512 +0800</div><div>最近改动：2013-03-27 14:09:32.064110510 +0800</div><div>创建时间：-</div></div><div><br></div><div>使用 ls -i也可以查看inode号.</div><div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ ls -lai rdp.sh&nbsp;</div><div><font color="#ff0000"   >1447366</font> -r-x------ 1 digoal digoal 464 &nbsp;3月 27 14:09 rdp.sh</div></div><div><br></div><div>目录指的是filename以及对应的inode number的列表.</div><div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ pwd</div><div>/home/digoal/script</div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ ls -lai</div><div>总用量 16</div><div>1442642 drwxrwxr-x &nbsp;2 digoal digoal 4096 &nbsp;3月 29 14:30 .</div><div>&nbsp;945715 drwxr-xr-x 45 digoal digoal 4096 &nbsp;5月 17 08:32 ..</div><div>1447366 -r-x------ &nbsp;1 digoal digoal &nbsp;464 &nbsp;3月 27 14:09 rdp.sh</div><div>1442437 -r-x------ &nbsp;1 digoal digoal &nbsp;339 &nbsp;3月 29 14:30 ssh.sh</div></div><div><br></div><div>数据块上有一个部分存储了硬链接的个数, 当这个个数变成0时, 这个数据块就可以被删除了.</div><div>例如 :&nbsp;</div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ touch abc</div><div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ stat abc</div><div>&nbsp; 文件："abc"</div><div>&nbsp; 大小：0 &nbsp; &nbsp; &nbsp; &nbsp; <span style="white-space:pre;"   >	</span>块：0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IO 块：4096 &nbsp; 普通空文件</div><div>设备：801h/2049d<span style="white-space:pre;"   >	</span>Inode：1442547 &nbsp; &nbsp; 硬链接：1</div><div>权限：(0664/-rw-rw-r--) &nbsp;Uid：( 1000/ &nbsp;digoal) &nbsp; Gid：( 1000/ &nbsp;digoal)</div><div>最近访问：2013-05-17 14:39:22.020069682 +0800</div><div>最近更改：2013-05-17 14:39:22.020069682 +0800</div><div>最近改动：2013-05-17 14:39:22.020069682 +0800</div><div>创建时间：-</div></div><div><br></div><div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ ln ./abc def</div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ stat abc</div><div>&nbsp; 文件："abc"</div><div>&nbsp; 大小：0 &nbsp; &nbsp; &nbsp; &nbsp; <span style="white-space:pre;"   >	</span>块：0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IO 块：4096 &nbsp; 普通空文件</div><div>设备：801h/2049d<span style="white-space:pre;"   >	</span>Inode：1442547 &nbsp; &nbsp; 硬链接：2</div><div>权限：(0664/-rw-rw-r--) &nbsp;Uid：( 1000/ &nbsp;digoal) &nbsp; Gid：( 1000/ &nbsp;digoal)</div><div>最近访问：2013-05-17 14:39:22.020069682 +0800</div><div>最近更改：2013-05-17 14:39:22.020069682 +0800</div><div>最近改动：2013-05-17 14:39:57.656069028 +0800</div><div>创建时间：-</div></div><div><br></div><div>当删除1个文件时，因为<span style="line-height: 22px;"   >Inode：1442547中还有1个链接, 所以数据块不会被删除.</span></div><div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ stat def</div><div>&nbsp; 文件："def"</div><div>&nbsp; 大小：0 &nbsp; &nbsp; &nbsp; &nbsp; <span style="white-space:pre;"   >	</span>块：0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IO 块：4096 &nbsp; 普通空文件</div><div>设备：801h/2049d<span style="white-space:pre;"   >	</span>Inode：1442547 &nbsp; &nbsp; 硬链接：1</div><div>权限：(0664/-rw-rw-r--) &nbsp;Uid：( 1000/ &nbsp;digoal) &nbsp; Gid：( 1000/ &nbsp;digoal)</div><div>最近访问：2013-05-17 14:39:22.020069682 +0800</div><div>最近更改：2013-05-17 14:39:22.020069682 +0800</div><div>最近改动：2013-05-17 14:40:18.336068650 +0800</div><div>创建时间：-</div><div style="line-height: 22px;"   ><br></div></div><div style="line-height: 22px;"   >目录上不能创建硬链接.</div><div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ ln / /abc</div><div>ln: "/": 不允许将硬链接指向目录</div><div style="line-height: 22px;"   ><br></div></div><div style="line-height: 22px;"   >软链接和硬链接的不同之处, 软链接不是指向同一个inode number.</div><div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ ln -s ./def abc</div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ stat abc</div><div>&nbsp; 文件："abc" -&gt; "./def"</div><div>&nbsp; 大小：5 &nbsp; &nbsp; &nbsp; &nbsp; <span style="white-space:pre;"   >	</span>块：0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IO 块：4096 &nbsp; 符号链接</div><div>设备：801h/2049d<span style="white-space:pre;"   >	</span>Inode：1456078 &nbsp; &nbsp; 硬链接：1</div><div>权限：(0777/lrwxrwxrwx) &nbsp;Uid：( 1000/ &nbsp;digoal) &nbsp; Gid：( 1000/ &nbsp;digoal)</div><div>最近访问：2013-05-17 14:41:39.732067159 +0800</div><div>最近更改：2013-05-17 14:41:39.732067159 +0800</div><div>最近改动：2013-05-17 14:41:39.732067159 +0800</div><div>创建时间：-</div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ stat def</div><div>&nbsp; 文件："def"</div><div>&nbsp; 大小：0 &nbsp; &nbsp; &nbsp; &nbsp; <span style="white-space:pre;"   >	</span>块：0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IO 块：4096 &nbsp; 普通空文件</div><div>设备：801h/2049d<span style="white-space:pre;"   >	</span>Inode：1442547 &nbsp; &nbsp; 硬链接：1</div><div>权限：(0664/-rw-rw-r--) &nbsp;Uid：( 1000/ &nbsp;digoal) &nbsp; Gid：( 1000/ &nbsp;digoal)</div><div>最近访问：2013-05-17 14:39:22.020069682 +0800</div><div>最近更改：2013-05-17 14:39:22.020069682 +0800</div><div>最近改动：2013-05-17 14:40:18.336068650 +0800</div><div>创建时间：-</div><div style="line-height: 22px;"   ><br></div></div><div style="line-height: 22px;"   >硬链接不能跨文件系统, 但是软链接可以.</div><div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ ln /home/digoal/script/abc /data01/test</div><div>ln: 无法创建硬链接"/data01/test" =&gt; "/home/digoal/script/abc": 无效的跨设备连接</div><div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ ln -s /home/digoal/script/abc /data01/test</div><div>digoal@digoal-Dell-System-Vostro-3450:~/script$ ll /data01/test</div><div>lrwxrwxrwx 1 digoal digoal 23 &nbsp;5月 17 14:43 /data01/test -&gt; /home/digoal/script/abc</div><div style="line-height: 22px;"   ><br></div></div></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://en.wikipedia.org/wiki/Inode_pointer_structure"   >http://en.wikipedia.org/wiki/Inode_pointer_structure</a></div><div>2.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://en.wikipedia.org/wiki/Ln_(Unix)"   >http://en.wikipedia.org/wiki/Ln_(Unix)</a></div><div>3.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.gnu.org/software/coreutils/manual/html_node/ln-invocation.html"   >http://www.gnu.org/software/coreutils/manual/html_node/ln-invocation.html</a></div><div>4.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://pubs.opengroup.org/onlinepubs/009695399/utilities/ln.html"   >http://pubs.opengroup.org/onlinepubs/009695399/utilities/ln.html</a></div><div>5.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://en.wikibooks.org/wiki/Guide_to_Unix/Commands/File_System_Utilities#ln"   >http://en.wikibooks.org/wiki/Guide_to_Unix/Commands/File_System_Utilities#ln</a></div><div>6.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.linfo.org/inode.html"   >http://www.linfo.org/inode.html</a></div><div>7.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://en.wikipedia.org/wiki/Inode"   >http://en.wikipedia.org/wiki/Inode</a></div><div>8.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://en.wikipedia.org/wiki/Hard_link"   >http://en.wikipedia.org/wiki/Hard_link</a></div></div>
	</div>
</div>
</body>
</html>