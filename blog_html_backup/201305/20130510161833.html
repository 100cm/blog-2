<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 9.3 Allow the psql --single-transaction mode to work when reading from standard input</h2>
	<h5 id="">2013-05-10 16:18:33&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020134104101463/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>Allow the psql --single-transaction mode to work when reading from standard input (Fabien Coelho, Robert Haas)</div><div>Previously this option only worked when reading from a file.</div><div>PostgreSQL 9.3 允许psql命令的单事务参数在标准输入时也生效, 而老版本只有在执行文件时生效. 请看如下测试 &nbsp;:&nbsp;</div><div><br></div><div><div>[测试]</div><div>PostgreSQL 9.2 :&nbsp;</div><div>-- 创建测试表</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-33-&gt; psql</font></div><div><font size="2"   >psql (9.2.4)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# create table t(id int);</font></div><div><font size="2"   >CREATE TABLE</font></div><p></p></pre></div><div>-- 测试文件</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-33-&gt; vi test.sql</font></div><div><font size="2"   >insert into t values(1);</font></div><div><font size="2"   >insert into t values(2);</font></div><div><font size="2"   >insert into t values(3);</font></div><p></p></pre></div><div><br></div><div>以文件形式加单事务参数执行</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-33-&gt; psql --single-transaction -f ./test.sql&nbsp;</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >pg92@db-172-16-3-33-&gt; psql</font></div><div><font size="2"   >psql (9.2.4)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# select ctid,cmin,cmax,xmin,xmax,* from t;</font></div><div><font size="2"   >&nbsp;ctid &nbsp;| cmin | cmax | &nbsp;xmin &nbsp; | xmax | id&nbsp;</font></div><div><font size="2"   >-------+------+------+---------+------+----</font></div><div><font size="2"   >&nbsp;(0,1) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 3078899 | &nbsp; &nbsp;0 | &nbsp;1</font></div><div><font size="2"   >&nbsp;(0,2) | &nbsp; &nbsp;1 | &nbsp; &nbsp;1 | 3078899 | &nbsp; &nbsp;0 | &nbsp;2</font></div><div><font size="2"   >&nbsp;(0,3) | &nbsp; &nbsp;2 | &nbsp; &nbsp;2 | 3078899 | &nbsp; &nbsp;0 | &nbsp;3</font></div><div><font size="2"   >(3 rows)</font></div><p></p></pre></div><div>-- xmin显示为一个事务号, 单事务参数起了作用</div><div><br></div><div><span style="line-height: 22px;"   >以标准输入形式加单事务参数执行</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-33-&gt; cat test.sql |psql --single-transaction</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >pg92@db-172-16-3-33-&gt; psql</font></div><div><font size="2"   >psql (9.2.4)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# select ctid,cmin,cmax,xmin,xmax,* from t;</font></div><div><font size="2"   >&nbsp;ctid &nbsp;| cmin | cmax | &nbsp;xmin &nbsp; | xmax | id&nbsp;</font></div><div><font size="2"   >-------+------+------+---------+------+----</font></div><div><font size="2"   >&nbsp;(0,1) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 3078899 | &nbsp; &nbsp;0 | &nbsp;1</font></div><div><font size="2"   >&nbsp;(0,2) | &nbsp; &nbsp;1 | &nbsp; &nbsp;1 | 3078899 | &nbsp; &nbsp;0 | &nbsp;2</font></div><div><font size="2"   >&nbsp;(0,3) | &nbsp; &nbsp;2 | &nbsp; &nbsp;2 | 3078899 | &nbsp; &nbsp;0 | &nbsp;3</font></div><div><font size="2"   >&nbsp;(0,4) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 3078900 | &nbsp; &nbsp;0 | &nbsp;1</font></div><div><font size="2"   >&nbsp;(0,5) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 3078901 | &nbsp; &nbsp;0 | &nbsp;2</font></div><div><font size="2"   >&nbsp;(0,6) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 3078902 | &nbsp; &nbsp;0 | &nbsp;3</font></div><div><font size="2"   >(6 rows)</font></div><p></p></pre></div><div>-- 标准输入xmin是3个事务. 说明单事务参数未起作用</div><div><br></div><div>PostgreSQL 9.3 :&nbsp;</div><div>-- 测试表</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-33-&gt; psql</font></div><div><font size="2"   >psql (9.3devel)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# create table t(id int);</font></div><div><font size="2"   >CREATE TABLE</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >-- 以文件形式加单事务参数执行</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-33-&gt; vi test.sql</font></div><div><font size="2"   >insert into t values(1);</font></div><div><font size="2"   >insert into t values(2);</font></div><div><font size="2"   >insert into t values(3);</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 22px;"   >以文件形式加单事务参数执行</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-33-&gt; psql --single-transaction -f ./test.sql&nbsp;</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >pg93@db-172-16-3-33-&gt; psql</font></div><div><font size="2"   >psql (9.3devel)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# select ctid,cmin,cmax,xmin,xmax,* from t;</font></div><div><font size="2"   >&nbsp;ctid &nbsp;| cmin | cmax | &nbsp; xmin &nbsp; | xmax | id&nbsp;</font></div><div><font size="2"   >-------+------+------+----------+------+----</font></div><div><font size="2"   >&nbsp;(0,1) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 12159226 | &nbsp; &nbsp;0 | &nbsp;1</font></div><div><font size="2"   >&nbsp;(0,2) | &nbsp; &nbsp;1 | &nbsp; &nbsp;1 | 12159226 | &nbsp; &nbsp;0 | &nbsp;2</font></div><div><font size="2"   >&nbsp;(0,3) | &nbsp; &nbsp;2 | &nbsp; &nbsp;2 | 12159226 | &nbsp; &nbsp;0 | &nbsp;3</font></div><div><font size="2"   >(3 rows)</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >-- xmin显示为一个事务号, 单事务参数起了作用</span></div><div><span style="line-height: 22px;"   >以标准输入形式加单事务参数执行</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-33-&gt; cat test.sql |psql --single-transaction</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >pg93@db-172-16-3-33-&gt; psql</font></div><div><font size="2"   >psql (9.3devel)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# select ctid,cmin,cmax,xmin,xmax,* from t;</font></div><div><font size="2"   >&nbsp;ctid &nbsp;| cmin | cmax | &nbsp; xmin &nbsp; | xmax | id&nbsp;</font></div><div><font size="2"   >-------+------+------+----------+------+----</font></div><div><font size="2"   >&nbsp;(0,1) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 12159226 | &nbsp; &nbsp;0 | &nbsp;1</font></div><div><font size="2"   >&nbsp;(0,2) | &nbsp; &nbsp;1 | &nbsp; &nbsp;1 | 12159226 | &nbsp; &nbsp;0 | &nbsp;2</font></div><div><font size="2"   >&nbsp;(0,3) | &nbsp; &nbsp;2 | &nbsp; &nbsp;2 | 12159226 | &nbsp; &nbsp;0 | &nbsp;3</font></div><div><font size="2"   >&nbsp;(0,4) | &nbsp; &nbsp;0 | &nbsp; &nbsp;0 | 12159227 | &nbsp; &nbsp;0 | &nbsp;1</font></div><div><font size="2"   >&nbsp;(0,5) | &nbsp; &nbsp;1 | &nbsp; &nbsp;1 | 12159227 | &nbsp; &nbsp;0 | &nbsp;2</font></div><div><font size="2"   >&nbsp;(0,6) | &nbsp; &nbsp;2 | &nbsp; &nbsp;2 | 12159227 | &nbsp; &nbsp;0 | &nbsp;3</font></div><div><font size="2"   >(6 rows)</font></div><p></p></pre></div></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   >-- xmin显示为一个事务号, 单事务参数起了作用</span></div><wbr></div>
	</div>
</div>
</body>
</html>