<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL column cryptographic use pgcrypto extension and optional openssl lib</h2>
	<h5 id="">2013-05-25 12:00:21&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402013423101455507/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>前面介绍了PostgreSQL 服务端和客户端之间的数据传输加密, 还介绍了数据库服务器的文件系统或者目录加密.</div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201342233131835/"   >http://blog.163.com/digoal@126/blog/static/163877040201342233131835/</a></div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201342383123592/"   >http://blog.163.com/digoal@126/blog/static/163877040201342383123592/</a></div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201342335842432/"   >http://blog.163.com/digoal@126/blog/static/163877040201342335842432/</a></div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402013423384517/"   >http://blog.163.com/digoal@126/blog/static/1638770402013423384517/</a></div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201342443944861/"   >http://blog.163.com/digoal@126/blog/static/163877040201342443944861/</a></div><div>但是要知道数据都是以明文存储在数据库中的。如果未使用数据传输加密的话, 数据一旦在传输中被截获的话就很容易泄漏数据。</div><div>本文将要介绍的是数据内容的加密。</div><div>数据内容的加密可以在数据库服务端进行加解密, 也可以在客户端进行加解密.&nbsp;</div><div>在数据库服务端加解密的话, 网络上传输的还是未加密的内容, 所以为了防御网络数据截获, 建议还是要搭配使用数据传输加密.</div><div>如果是在客户端进行加解密的话, 网络上传输的是加密后的内容, 所以不必担心网络数据截获的问题.</div><div>下面以pgcrypto这个扩展包为例, 讲一下数据库服务端加密.</div><div>1. 创建pgcrypto扩展包</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-40-&gt; psql -h 172.16.3.33 -p 1999 -U postgres digoal</font></div><div><font size="2"   >psql (9.2beta1, server 9.3devel)</font></div><div><font size="2"   >WARNING: psql version 9.2, server version 9.3.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Some psql features might not work.</font></div><div><font size="2"   >SSL connection (cipher: RC4-SHA, bits: 128)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# create extension pgcrypto;</font></div><div><font size="2"   >CREATE EXTENSION</font></div><p></p></pre></div><div><br></div><div>2. 扩展包新建了一些加密和解密的函数.</div><div>详见末尾部分.</div><div><br></div><div>下面主要针对新增的加解密函数进行讲解.</div><div>3. 计算hash值的函数.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digest(data text, type text) returns bytea</font></div><div><font size="2"   >digest(data bytea, type text) returns bytea</font></div><p></p></pre></div><div>type为算法.支持&nbsp;md5, sha1, sha224, sha256, sha384, sha512. 如果编译postgresql时时有了with-openssl选项, 则可以支持更多的算法.</div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select digest('I am digoal.', 'md5');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;digest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------</font></div><div><font size="2"   >&nbsp;\xc3b0fb1147858d2259d92f20668fc8f9</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >每次运算得到的hash值都一样.</font></div><div><font size="2"   >digoal=# select digest('I am digoal.', 'md5');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;digest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------</font></div><div><font size="2"   >&nbsp;\xc3b0fb1147858d2259d92f20668fc8f9</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>但是请注意函数参数, 如果要对bytea hash, 那么请在输入参数时指定参数类型bytea.</div><div>例如以下两次调用分别调用了2个函数. 所以得到的结果也是不一样的.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select digest('\xffffff'::bytea, 'md5');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;digest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------</font></div><div><font size="2"   >&nbsp;\x8597d4e7e65352a302b63e07bc01a7da</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select digest('\xffffff', 'md5');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;digest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------</font></div><div><font size="2"   >&nbsp;\xd721f40e22920e0fd8ac7b13587aa92d</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >hmac(data text, key text, type text) returns bytea</span></div><div><div>hmac(data bytea, key text, type text) returns bytea</div></div><div>这两个函数与digest类似, 只是多了一个key参数, 也就是说同一个被加密的值, 可以使用不同的key得到不同的hash值.</div><div>这样的做法是, 不知道key的话, 也无法逆向破解原始值.&nbsp;</div><div>使用hmac还有一个好处是, 使用digest如果原始值和hash值同时被别人修改了是无法知道是否被修改的.</div><div>但是使用hmac, 如果原始值被修改了, 同时key没有泄漏的话, 那么hash值是无法被修改的, 因此就能够知道原始值是否被修改过.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select hmac('I am digoal.', 'this is a key', 'md5');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hmac &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------</font></div><div><font size="2"   >&nbsp;\xc70d0fd2af2382ea8e0a7ffd9edcbd58</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select hmac('I am digoal.', 'this is a key', 'md5');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hmac &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------</font></div><div><font size="2"   >&nbsp;\xc70d0fd2af2382ea8e0a7ffd9edcbd58</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select hmac('I am digoal.', 'this is b key', 'md5');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hmac &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------</font></div><div><font size="2"   >&nbsp;\x4518090fb07fc672b66c829e43fd62dc</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select hmac('I am digoal.', 'this is b key', 'md5');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hmac &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------</font></div><div><font size="2"   >&nbsp;\x4518090fb07fc672b66c829e43fd62dc</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>如果key的长度超过了block size, 那么key会先hash一次, 然后hash值作为key.</div><div><br></div><div>4. 以上hash函数只要原始值一致, 每次得到的hash值是一样的, 虽然hmac多了key的参数, 但是只要key和原始数据一样, 得到的hash值也是一样的. 这样的加密很可能被逆向破解掉.</div><div>下面的2个函数主要是提高了逆向破解的难度, 增强了数据的安全性.&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >crypt(password text, salt text) returns text</font></div><div><font size="2"   >gen_salt(type text [, iter_count integer ]) returns text</font></div><p></p></pre></div><div>crypt(), 用来计算hash值.</div><div>gen_salt(), 用来产生随机的参数给crypt. type参数为des, xdes, md5, bf. iter_count指迭代次数, 数字越大加密时间越长, 被破解需要的时间也越长.</div><div><p style="font-size: 13.333333969116211px; line-height: 1.5em; margin: 1.2em 0em; font-weight: bold; font-family: verdana, sans-serif;"   >Table F-16. Iteration Counts for&nbsp;<code>crypt()</code></p><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; background-color: rgb(224, 236, 239); border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 13.333333969116211px; line-height: normal;"   ><colgroup><col><col><col><col><thead><tr><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Algorithm</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Default</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Min</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Max</th></tr></thead><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>xdes</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >725</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >1</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >16777215</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>bf</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >6</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >4</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >31</td></tr></table></div><div>xdes的iter_count必须为奇数.</div><div>crypt和gen_salt结合使用的话, 同一个原始值, 每次得到的hash值是不一样的.</div><div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select crypt('this is a pwd source', gen_salt('md5'));</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crypt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------</font></div><div><font size="2"   >&nbsp;$1$CAp4ifAa$p261Vfku7HDnwx8cuFhsq/</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select crypt('this is a pwd source', gen_salt('bf',10));</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; crypt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;$2a$10$tvNK2H9mPu1tU5L6oAHdSeze5Hlz7G0y4oEKNg9SlGa06J2sywZHu</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div># 每次运算可以得到不同的hash值.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select crypt('this is a pwd source', gen_salt('md5'));</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crypt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >------------------------------------</font></div><div><font size="2"   >&nbsp;$1$p2Sg93iZ$SCdUePtZVuyIJBDO1cEYh1</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select crypt('this is a pwd source', gen_salt('bf',10));</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; crypt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;$2a$10$cgJiTAs55vMBqYR1kGMGXuMKZI4dsayna4wgEL4K7duYkD0g25ufW</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div></div><div>原因是gen_salt每次都会给出1个随机值.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select gen_salt('bf',10);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gen_salt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >-------------------------------</font></div><div><font size="2"   >&nbsp;$2a$10$qY0amXGalzj14rooSpTf5e</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select gen_salt('bf',10);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gen_salt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >-------------------------------</font></div><div><font size="2"   >&nbsp;$2a$10$TmqxqmOd8R3scnPk25Pp2O</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>计算好hash后匹配是怎么做的呢?</div><div>看下面, hash值作为第二个参数, 得到的值就是hash值. 所以这样就可以进行匹配了.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select crypt('this is a pwd source', gen_salt('bf',10));</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; crypt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;$2a$10$x5bQ0wcHc0.li1XcDbzSyOvpjPOKlzg.psbNaA33VH.gAfKbA7.IK</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select crypt('this is a pwd source', gen_salt('bf',10));</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; crypt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;$2a$10$X7D5eMxcaXNn.BPkPnb1GuSVxDUjNiO5M/9ss9GLHpgGq6s3hbPrG</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select crypt('this is a pwd source', '$2a$10$X7D5eMxcaXNn.BPkPnb1GuSVxDUjNiO5M/9ss9GLHpgGq6s3hbPrG');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; crypt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;$2a$10$X7D5eMxcaXNn.BPkPnb1GuSVxDUjNiO5M/9ss9GLHpgGq6s3hbPrG</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >digoal=# select crypt('this is a pwd source', '$2a$10$x5bQ0wcHc0.li1XcDbzSyOvpjPOKlzg.psbNaA33VH.gAfKbA7.IK');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; crypt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >--------------------------------------------------------------</font></div><div><font size="2"   >&nbsp;$2a$10$x5bQ0wcHc0.li1XcDbzSyOvpjPOKlzg.psbNaA33VH.gAfKbA7.IK</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>假设用它来存密码 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create table userpwd(userid int8 primary key, pwd text);</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=# insert into userpwd (userid,pwd) values (1, crypt('this is a pwd source', gen_salt('bf',10)));</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >输入错误的密码, 返回假</font></div><div><font size="2"   >digoal=# select crypt('this is a error pwd source', pwd)=pwd from userpwd where userid =1;</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;f</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   >输入正确的密码, 返回真</font></div><div><font size="2"   >digoal=# select crypt('this is a pwd source', pwd)=pwd from userpwd where userid =1;</font></div><div><font size="2"   >&nbsp;?column?&nbsp;</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp;t</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div>crypt支持的算法如下 :&nbsp;</div><div><p style="font-size: 13.333333969116211px; line-height: 1.5em; margin: 1.2em 0em; font-weight: bold; font-family: verdana, sans-serif;"   >Table F-15. Supported Algorithms for&nbsp;<code>crypt()</code></p><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; background-color: rgb(224, 236, 239); border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 13.333333969116211px; line-height: normal;"   ><colgroup><col><col><col><col><col><thead><tr><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Algorithm</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Max Password Length</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Adaptive?</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Salt Bits</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Description</th></tr></thead><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>bf</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >72</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >yes</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >128</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Blowfish-based, variant 2a</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>md5</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >unlimited</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >no</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >48</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >MD5-based crypt</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>xdes</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >8</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >yes</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >24</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >Extended DES</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><tt>des</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >8</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >no</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >12</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >Original UNIX crypt</td></tr></table></div><div><span style="line-height: 22px;"   >当然, crypt和gen_salt是以牺牲hash速度为代价来换取安全性的.</span></div><div><table border="1"   style="margin: 2ex 0px 2ex 2ex; -webkit-box-shadow: rgb(223, 223, 223) 3px 3px 5px; box-shadow: rgb(223, 223, 223) 3px 3px 5px; border-spacing: 0px; border-collapse: collapse; background-color: rgb(224, 236, 239); border: 2px solid rgb(167, 198, 223); color: rgb(0, 0, 0); font-family: verdana, sans-serif; font-size: 13.333333969116211px; line-height: normal;"   ><colgroup><col><col><col><col><thead><tr><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Algorithm</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >Hashes/sec</th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >For&nbsp;<tt>[a-z]</tt></th><th style="border: 1px solid rgb(167, 198, 223); padding: 0.5ex;"   >For&nbsp;<tt>[A-Za-z0-9]</tt></th></tr></thead><tbody><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>crypt-bf/8</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >28</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >246 years</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >251322 years</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>crypt-bf/7</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >57</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >121 years</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >123457 years</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>crypt-bf/6</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >112</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >62 years</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >62831 years</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>crypt-bf/5</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >211</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >33 years</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >33351 years</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   ><tt>crypt-md5</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >2681</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >2.6 years</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(239, 239, 239); padding: 0.5ex;"   >2625 years</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>crypt-des</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >362837</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >7 days</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >19 years</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>sha1</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >590223</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >4 days</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >12 years</td></tr><tr><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   ><tt>md5</tt></td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >2345086</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >1 day</td><td style="border: 1px solid rgb(167, 198, 223); background-color: rgb(255, 255, 255); padding: 0.5ex;"   >3 years</td></tr></table></div><div>以上hash计算速度取自1.5G的奔腾4 CPU. 以及如下测试软件 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >crypt-des and crypt-md5 algorithm numbers are taken from John the Ripper v1.6.38 -test output.</font></div><div><font size="2"   >md5 numbers are from mdcrack 1.2.</font></div><div><font size="2"   >sha1 numbers are from lcrack-20031130-beta.</font></div><div><font size="2"   >crypt-bf numbers are taken using a simple program that loops over 1000 8-character passwords. That way I can show the speed with different numbers of iterations. For reference: john -test shows 213 loops/sec for crypt-bf/5. (The very small difference in results is in accordance with the fact that the crypt-bf implementation in pgcrypto is the same one used in John the Ripper.)</font></div><p></p></pre></div><div>原则上, iter_count的选择以hash计算速度为准则, 以当前流行的CPU, 并且实测后取4-100每秒之间为宜.</div><div><br></div><div>5.&nbsp;PGP 加密函数.</div><div>PostgreSQL pgcrypto扩展包中的pgp加解密函数遵循OpenPGP (RFC 4880)标准.</div><div>加密的PGP消息由2部分组成 :&nbsp;</div><div>1. 这个消息的会话密钥, 会话密钥可以是对称密钥或公钥.</div><div>2. 使用该会话密钥加密的数据, 可以选择加密选项例如</div><div><pre class="prettyprint"   ><p><font size="2"   >compress-algo,&nbsp;unicode-mode,&nbsp;cipher-algo, compress-level, convert-crlf, disable-mdc, enable-session-key, s2k-mode, s2k-digest-algo, s2k-cipher-algo</font></p></pre></div><div>使用对称密钥加解密的函数如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >pgp_sym_encrypt(data text, psw text [, options text ]) returns bytea</font></div><div><font size="2"   >pgp_sym_encrypt_bytea(data bytea, psw text [, options text ]) returns bytea</font></div></div><div><div><font size="2"   >pgp_sym_decrypt(msg bytea, psw text [, options text ]) returns text</font></div><div><font size="2"   >pgp_sym_decrypt_bytea(msg bytea, psw text [, options text ]) returns bytea</font></div></div><p></p></pre></div><div>options参考pgcrypto加密选项部分.</div><div>5.1 对称加密举例 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >使用对称密钥加密, 这里的对称密钥为'pwd'字符串 :&nbsp;</font></div><div><div><font size="2"   >digoal=# select pgp_sym_encrypt('i am digoal', 'pwd', 'cipher-algo=bf, compress-algo=2, compress-level=9');</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pgp_sym_encrypt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >------------------------------------------------------------------------------------------------------------------------------------</font></div><div><font size="2"   >--------------------------------</font></div><div><font size="2"   >&nbsp;\xc30d0404030245811e051118cc136ed23f0198808f069b53264d4a08c2b5dcf3b1c39a34d091263f7f6b64a14808e6ffb32ccc09749105b9cc062d70c628357ab</font></div><div><font size="2"   >1e2474ff6d109dd083ce892cfa55706</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >解密也需要使用加密时的对称密钥 :&nbsp;</font></div><div><div><font size="2"   >digoal=# select pgp_sym_decrypt('\xc30d0404030245811e051118cc136ed23f0198808f069b53264d4a08c2b5dcf3b1c39a34d091263f7f6b64a14808e6ffb32ccc09749105b9cc062d70c628357ab1e2474ff6d109dd083ce892cfa55706'::bytea, 'pwd');</font></div><div><font size="2"   >&nbsp;pgp_sym_decrypt&nbsp;</font></div><div><font size="2"   >-----------------</font></div><div><font size="2"   >&nbsp;i am digoal</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><br></div><div>5.2 使用公钥加解密的函数如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >pgp_pub_encrypt(data text, key bytea [, options text ]) returns bytea</font></div><div><font size="2"   >pgp_pub_encrypt_bytea(data bytea, key bytea [, options text ]) returns bytea</font></div></div><div><div><font size="2"   >pgp_pub_decrypt(msg bytea, key bytea [, psw text [, options text ]]) returns text</font></div><div><font size="2"   >pgp_pub_decrypt_bytea(msg bytea, key bytea [, psw text [, options text ]]) returns bytea</font></div></div><p></p></pre></div><div><span style="line-height: 22px;"   >options参考</span><span style="line-height: 22px;"   >pgcrypto</span><span style="line-height: 22px;"   >加密选项部分.</span></div><div><span style="line-height: 22px;"   >公钥加密举例 :&nbsp;</span></div><div><span style="line-height: 22px;"   >首先要使用gpg生成一对公钥和密钥. 当然你也可以生成很多对.&nbsp;</span></div><div>加密用公钥, 解密用对应的私钥即可.&nbsp;</div><div><span style="line-height: 22px;"   >公钥和私钥都可以放在客户端, 这样的话数据库中只存储加密后的数据, 攻击者获取数据后也无法对它进行解密.</span></div><div><span style="line-height: 22px;"   >生成一对公钥密钥</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-40-&gt; gpg --gen-key</font></div><div><font size="2"   >gpg (GnuPG) 1.4.5; Copyright (C) 2006 Free Software Foundation, Inc.</font></div><div><font size="2"   >This program comes with ABSOLUTELY NO WARRANTY.</font></div><div><font size="2"   >This is free software, and you are welcome to redistribute it</font></div><div><font size="2"   >under certain conditions. See the file COPYING for details.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Please select what kind of key you want:</font></div><div><font size="2"   >&nbsp; &nbsp;(1) DSA and Elgamal (default)</font></div><div><font size="2"   >&nbsp; &nbsp;(2) DSA (sign only)</font></div><div><font size="2"   >&nbsp; &nbsp;(5) RSA (sign only)</font></div><div><font size="2"   >Your selection? 1 &nbsp;#选择1</font></div><div><font size="2"   >DSA keypair will have 1024 bits.</font></div><div><font size="2"   >ELG-E keys may be between 1024 and 4096 bits long.</font></div><div><font size="2"   >What keysize do you want? (2048)&nbsp;<span style="line-height: 22px;"   >#选择2048</span></font></div><div><font size="2"   >Requested keysize is 2048 bits</font></div><div><font size="2"   >Please specify how long the key should be valid.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 = key does not expire</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;n&gt; &nbsp;= key expires in n days</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;n&gt;w = key expires in n weeks</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;n&gt;m = key expires in n months</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &lt;n&gt;y = key expires in n years</font></div><div><font size="2"   >Key is valid for? (0)&nbsp;<span style="line-height: 22px;"   >#选择0, 永不过期.</span></font></div><div><font size="2"   >Key does not expire at all</font></div><div><font size="2"   >Is this correct? (y/N) y&nbsp;<span style="line-height: 22px;"   >#输入y</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >You need a user ID to identify your key; the software constructs the user ID</font></div><div><font size="2"   >from the Real Name, Comment and Email Address in this form:</font></div><div><font size="2"   >&nbsp; &nbsp; "Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Real name: digoal &nbsp;# 必须输入的是name, 后面要用到这个name导出公钥和密钥.</font></div><div><font size="2"   >Email address:&nbsp;</font></div><div><font size="2"   >Comment:&nbsp;</font></div><div><font size="2"   >You selected this USER-ID:</font></div><div><font size="2"   >&nbsp; &nbsp; "digoal"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O &nbsp;# 输入O确认</font></div><div><font size="2"   >You need a Passphrase to protect your secret key.</font></div><div><font size="2"   ># 这里可以选择输入保护密钥的passphrase, 当然也可以不输入留空.&nbsp;</font></div><div><font size="2"   ># 如果输入了, 那么使用pgp_pub_decrypt函数解密数据时则需要输入这个 passphrase.</font></div><div><font size="2"   ># 本例不输入passphrase.</font></div><div><font size="2"   >You don't want a passphrase - this is probably a *bad* idea!</font></div><div><font size="2"   >I will do it anyway. &nbsp;You can change your passphrase at any time,</font></div><div><font size="2"   >using this program with the option "--edit-key".</font></div><div><font size="2"   ># 马上在另一个会话中执行ll -R /. 这样可以让服务器产生一些动作. 否则可能造成如下错误 :&nbsp;</font></div><div><font size="2"   >#&nbsp;Not enough random bytes available. &nbsp;Please do some other work to give</font></div><div><font size="2"   >We need to generate a lot of random bytes. It is a good idea to perform</font></div><div><font size="2"   >some other action (type on the keyboard, move the mouse, utilize the</font></div><div><font size="2"   >disks) during the prime generation; this gives the random number</font></div><div><font size="2"   >generator a better chance to gain enough entropy.</font></div><div><font size="2"   >+++++++++++++++.++++++++++.++++++++++..++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++.+++++.+++++.+++++.++++++++++++++++++++&gt;.++++++++++....&gt;+++++............&lt;+++++............+++++</font></div><div><font size="2"   >We need to generate a lot of random bytes. It is a good idea to perform</font></div><div><font size="2"   >some other action (type on the keyboard, move the mouse, utilize the</font></div><div><font size="2"   >disks) during the prime generation; this gives the random number</font></div><div><font size="2"   >generator a better chance to gain enough entropy.</font></div><div><font size="2"   >++++++++++++++++++++.+++++..+++++...+++++.+++++.++++++++++.++++++++++++++++++++..+++++.+++++.++++++++++..+++++++++++++++++++++++++.+++++++++++++++.++++++++++.+++++&gt;.+++++.+++++&gt;+++++.&gt;+++++&gt;+++++&lt;+++++....+++++^^^</font></div><div><font size="2"   >gpg: key 634F912F marked as ultimately trusted</font></div><div><font size="2"   >public and secret key created and signed.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >gpg: checking the trustdb</font></div><div><font size="2"   >gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model</font></div><div><font size="2"   >gpg: depth: 0 &nbsp;valid: &nbsp; 1 &nbsp;signed: &nbsp; 0 &nbsp;trust: 0-, 0q, 0n, 0m, 0f, 1u</font></div><div><font size="2"   >pub &nbsp; 1024D/634F912F 2013-05-25</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; Key fingerprint = D2CD D9B8 F1C3 D940 33E9 &nbsp;9E94 DA32 0B23 634F 912F</font></div><div><font size="2"   >uid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;digoal</font></div><div><font size="2"   >sub &nbsp; 2048g/D670D845 2013-05-25</font></div><p></p></pre></div><div>#　接下来要生成公钥和密钥.</div><div># 列出当前系统中的钥匙串</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-40-&gt; gpg --list-secret-keys</font></div><div><font size="2"   >/home/pg92/.gnupg/secring.gpg</font></div><div><font size="2"   >-----------------------------</font></div><div><font size="2"   >sec &nbsp; 1024D/634F912F 2013-05-25</font></div><div><font size="2"   >uid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;digoal</font></div><div><font size="2"   >ssb &nbsp; 2048g/D670D845 2013-05-25</font></div><p></p></pre></div><div># 导出uid=digoal的公钥</div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-40-&gt; gpg -a --export digoal &gt; public.key</font></div><div></div><p></p></pre><div><span style="line-height: 22px;"   ># 导出uid=digoal的密钥</span></div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-40-&gt; gpg -a --export-secret-keys digoal &gt; secret.key</font></div><div></div><p></p></pre><div><span style="line-height: 22px;"   ># 查看公钥和密钥内容</span></div><div><span style="line-height: 22px;"   >公钥内容 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-40-&gt; cat public.key&nbsp;</font></div><div><font size="2"   >-----BEGIN PGP PUBLIC KEY BLOCK-----</font></div><div><font size="2"   >Version: GnuPG v1.4.5 (GNU/Linux)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >mQGiBFGgIDgRBADALXrWA4PyT+Mj6be2Jl0kMeXItZqdqOp5fKOYNpWT2LqKBa9Y</font></div><div><font size="2"   >RFMDZHSS1MIfjyDEi07O+TKm98haHBowbHB00qMXW6z6VAxtqdUBt9b0L52OwkA9</font></div><div><font size="2"   >awsclpalPvLwDAQGpxlJh7aQJ0hHjQRgvfTqJpOoCF4WoMVVSin5Ox2P4wCgzcr7</font></div><div><font size="2"   >FtLhbysH/Axqmx6Oc3wG3FMD/ij4ES38IDNAoacCOuWlA6MeaxWzgVka1Zl/h2kt</font></div><div><font size="2"   >UVJOLeM0saF6Z570/RYYFASC5cVazCG9Gbq6a3WvCy6LW9hV5XZIOU1VBXYxaCP1</font></div><div><font size="2"   >sMeWgRSbVathdJMqbcz+kzqabiCVHDt5Q8k/TuIEvmkTnUbk1ca1GTxRJMhXYldZ</font></div><div><font size="2"   >LDAcA/4hnPbjxUUtkQ9S6gP3Cih/8SOA/E4YIj5PK3S9nRc6OKZ9NiGVXmhqff8P</font></div><div><font size="2"   >A4TmX08DiVclDzsaxpmB1yYUc44/rhEZ53XxKfHzjvowNKEevBm+cPEc0U9a5VSF</font></div><div><font size="2"   >IBwfwuAAVbbfdmLKM+HcBsPc/3uRnNGRZX6mMvUAG9UCk50zUrQGZGlnb2FsiGAE</font></div><div><font size="2"   >ExECACAFAlGgIDgCGwMGCwkIBwMCBBUCCAMEFgIDAQIeAQIXgAAKCRDaMgsjY0+R</font></div><div><font size="2"   >L6mpAJ97/he5t1uatNKyO5v00bfuq9hMrQCgyihwLNzCn3immQp1E8fsg0Rfmaq5</font></div><div><font size="2"   >Ag0EUaAgORAIAPf4AB8dn2tYQlqOu3cC4g+yD95RV+lxERWLwMNzH1aVuSmBQzZA</font></div><div><font size="2"   >7pZuAyt9Joy6kwgkcilWtP1XgwUQBnyfS5QOiqNAbDoKFZWxLVKPpvb8jk20zbiW</font></div><div><font size="2"   >vqH9IUVlMaRjJrY1kdC1ckPFmx17k4uFU9GKFrfx/VukaTBhK3iByUD4JGUvmqKJ</font></div><div><font size="2"   >vu3DX3JliIH4PJaBFxp/nOIy/66gPPz2DkSTBBNYTNVtMqkDLz2gcAWQ99TWsEXR</font></div><div><font size="2"   >skehPk9FSUDvrs62vC7ZsGmwihSMt/B/gQHc9rmEs5RkqNfyYKUoI4d5UCQdWnjI</font></div><div><font size="2"   >+V5Sppq6HQhRJ9M0ytoqmYJDKioKR0ewBQMAAwUH/jOZn7ei1rZLv0RP0Y+/E0RO</font></div><div><font size="2"   >kzpNmMuP+mNvZNrf/PCd1SvPxFZ2MNnhB0JN9a1OjJD8otqqvxMujyTx5z0RqD+7</font></div><div><font size="2"   >mWKb/q96NpG+fApZNGt6YiTc4a9FV9jpf+fYZyfpOj/bmPpHIUtheGzx/+WIL9gH</font></div><div><font size="2"   >WDiFR0nP9uXZoDZotuPqEsH2acoIE4oB4lLBvajuDtwnAZlajHMgXZD9W/xzdAlR</font></div><div><font size="2"   >5frfGNVIdvylwN2SOfSavl4VM4hG1uFc2J4szmivK0TesP1UcIdxnTlTvFieEqaP</font></div><div><font size="2"   >2rpG6WfVVO7N5ZiWXYOuazzRSEtfTjnGZRnx+WmkUb5KNvVhSg8F7oB7WrKMH/2I</font></div><div><font size="2"   >SQQYEQIACQUCUaAgOQIbDAAKCRDaMgsjY0+RLx/TAJ4uAleVExWDEVSbNeqm9wBk</font></div><div><font size="2"   >gRNGbgCeK648ARQH8pBNHcX/hsefvah7TO4=</font></div><div><font size="2"   >=XGEV</font></div><div><font size="2"   >-----END PGP PUBLIC KEY BLOCK-----</font></div><p></p></pre></div><div>私钥内容 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg92@db-172-16-3-40-&gt; cat secret.key&nbsp;</font></div><div><font size="2"   >-----BEGIN PGP PRIVATE KEY BLOCK-----</font></div><div><font size="2"   >Version: GnuPG v1.4.5 (GNU/Linux)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >lQG7BFGgIDgRBADALXrWA4PyT+Mj6be2Jl0kMeXItZqdqOp5fKOYNpWT2LqKBa9Y</font></div><div><font size="2"   >RFMDZHSS1MIfjyDEi07O+TKm98haHBowbHB00qMXW6z6VAxtqdUBt9b0L52OwkA9</font></div><div><font size="2"   >awsclpalPvLwDAQGpxlJh7aQJ0hHjQRgvfTqJpOoCF4WoMVVSin5Ox2P4wCgzcr7</font></div><div><font size="2"   >FtLhbysH/Axqmx6Oc3wG3FMD/ij4ES38IDNAoacCOuWlA6MeaxWzgVka1Zl/h2kt</font></div><div><font size="2"   >UVJOLeM0saF6Z570/RYYFASC5cVazCG9Gbq6a3WvCy6LW9hV5XZIOU1VBXYxaCP1</font></div><div><font size="2"   >sMeWgRSbVathdJMqbcz+kzqabiCVHDt5Q8k/TuIEvmkTnUbk1ca1GTxRJMhXYldZ</font></div><div><font size="2"   >LDAcA/4hnPbjxUUtkQ9S6gP3Cih/8SOA/E4YIj5PK3S9nRc6OKZ9NiGVXmhqff8P</font></div><div><font size="2"   >A4TmX08DiVclDzsaxpmB1yYUc44/rhEZ53XxKfHzjvowNKEevBm+cPEc0U9a5VSF</font></div><div><font size="2"   >IBwfwuAAVbbfdmLKM+HcBsPc/3uRnNGRZX6mMvUAG9UCk50zUgAAn2j3pAZqpbN3</font></div><div><font size="2"   >xfFFL2YYhP+ePmrnCzm0BmRpZ29hbIhgBBMRAgAgBQJRoCA4AhsDBgsJCAcDAgQV</font></div><div><font size="2"   >AggDBBYCAwECHgECF4AACgkQ2jILI2NPkS+pqQCfe/4XubdbmrTSsjub9NG37qvY</font></div><div><font size="2"   >TK0AoMoocCzcwp94ppkKdRPH7INEX5mqnQI9BFGgIDkQCAD3+AAfHZ9rWEJajrt3</font></div><div><font size="2"   >AuIPsg/eUVfpcREVi8DDcx9WlbkpgUM2QO6WbgMrfSaMupMIJHIpVrT9V4MFEAZ8</font></div><div><font size="2"   >n0uUDoqjQGw6ChWVsS1Sj6b2/I5NtM24lr6h/SFFZTGkYya2NZHQtXJDxZsde5OL</font></div><div><font size="2"   >hVPRiha38f1bpGkwYSt4gclA+CRlL5qiib7tw19yZYiB+DyWgRcaf5ziMv+uoDz8</font></div><div><font size="2"   >9g5EkwQTWEzVbTKpAy89oHAFkPfU1rBF0bJHoT5PRUlA767Otrwu2bBpsIoUjLfw</font></div><div><font size="2"   >f4EB3Pa5hLOUZKjX8mClKCOHeVAkHVp4yPleUqaauh0IUSfTNMraKpmCQyoqCkdH</font></div><div><font size="2"   >sAUDAAMFB/4zmZ+3ota2S79ET9GPvxNETpM6TZjLj/pjb2Ta3/zwndUrz8RWdjDZ</font></div><div><font size="2"   >4QdCTfWtToyQ/KLaqr8TLo8k8ec9Eag/u5lim/6vejaRvnwKWTRremIk3OGvRVfY</font></div><div><font size="2"   >6X/n2Gcn6To/25j6RyFLYXhs8f/liC/YB1g4hUdJz/bl2aA2aLbj6hLB9mnKCBOK</font></div><div><font size="2"   >AeJSwb2o7g7cJwGZWoxzIF2Q/Vv8c3QJUeX63xjVSHb8pcDdkjn0mr5eFTOIRtbh</font></div><div><font size="2"   >XNieLM5orytE3rD9VHCHcZ05U7xYnhKmj9q6Ruln1VTuzeWYll2Drms80UhLX045</font></div><div><font size="2"   >xmUZ8flppFG+Sjb1YUoPBe6Ae1qyjB/9AAFUCNmPaOMHsDg6bZpo7ApZJbJsiW6Z</font></div><div><font size="2"   >BTCojWYF4E2C+5bPQoietziIE5V6LhPdiEkEGBECAAkFAlGgIDkCGwwACgkQ2jIL</font></div><div><font size="2"   >I2NPkS8f0wCgpSCnhRw+soY+Fpg5t7IHjusqNt0An0EeMye7x5uyQc2ikmVtgfZu</font></div><div><font size="2"   >NOxi</font></div><div><font size="2"   >=FwrW</font></div><div><font size="2"   >-----END PGP PRIVATE KEY BLOCK-----</font></div><p></p></pre></div><div># 使用公钥加密数据, 使用私钥解密数据时,</div><div># pgcrypto 需要字节流数据.</div><div># 所以在使用公钥和私钥前请先把他们转换为bytea.</div><div>转换公钥为bytea :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# select dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----</font></div><div><font size="2"   >digoal'# Version: GnuPG v1.4.5 (GNU/Linux)</font></div><div><font size="2"   >digoal'#&nbsp;</font></div><div><font size="2"   >digoal'# mQGiBFGgIDgRBADALXrWA4PyT+Mj6be2Jl0kMeXItZqdqOp5fKOYNpWT2LqKBa9Y</font></div><div><font size="2"   >digoal'# RFMDZHSS1MIfjyDEi07O+TKm98haHBowbHB00qMXW6z6VAxtqdUBt9b0L52OwkA9</font></div><div><font size="2"   >digoal'# awsclpalPvLwDAQGpxlJh7aQJ0hHjQRgvfTqJpOoCF4WoMVVSin5Ox2P4wCgzcr7</font></div><div><font size="2"   >digoal'# FtLhbysH/Axqmx6Oc3wG3FMD/ij4ES38IDNAoacCOuWlA6MeaxWzgVka1Zl/h2kt</font></div><div><font size="2"   >digoal'# UVJOLeM0saF6Z570/RYYFASC5cVazCG9Gbq6a3WvCy6LW9hV5XZIOU1VBXYxaCP1</font></div><div><font size="2"   >digoal'# sMeWgRSbVathdJMqbcz+kzqabiCVHDt5Q8k/TuIEvmkTnUbk1ca1GTxRJMhXYldZ</font></div><div><font size="2"   >digoal'# LDAcA/4hnPbjxUUtkQ9S6gP3Cih/8SOA/E4YIj5PK3S9nRc6OKZ9NiGVXmhqff8P</font></div><div><font size="2"   >digoal'# A4TmX08DiVclDzsaxpmB1yYUc44/rhEZ53XxKfHzjvowNKEevBm+cPEc0U9a5VSF</font></div><div><font size="2"   >digoal'# IBwfwuAAVbbfdmLKM+HcBsPc/3uRnNGRZX6mMvUAG9UCk50zUrQGZGlnb2FsiGAE</font></div><div><font size="2"   >digoal'# ExECACAFAlGgIDgCGwMGCwkIBwMCBBUCCAMEFgIDAQIeAQIXgAAKCRDaMgsjY0+R</font></div><div><font size="2"   >digoal'# L6mpAJ97/he5t1uatNKyO5v00bfuq9hMrQCgyihwLNzCn3immQp1E8fsg0Rfmaq5</font></div><div><font size="2"   >digoal'# Ag0EUaAgORAIAPf4AB8dn2tYQlqOu3cC4g+yD95RV+lxERWLwMNzH1aVuSmBQzZA</font></div><div><font size="2"   >digoal'# 7pZuAyt9Joy6kwgkcilWtP1XgwUQBnyfS5QOiqNAbDoKFZWxLVKPpvb8jk20zbiW</font></div><div><font size="2"   >digoal'# vqH9IUVlMaRjJrY1kdC1ckPFmx17k4uFU9GKFrfx/VukaTBhK3iByUD4JGUvmqKJ</font></div><div><font size="2"   >digoal'# vu3DX3JliIH4PJaBFxp/nOIy/66gPPz2DkSTBBNYTNVtMqkDLz2gcAWQ99TWsEXR</font></div><div><font size="2"   >digoal'# skehPk9FSUDvrs62vC7ZsGmwihSMt/B/gQHc9rmEs5RkqNfyYKUoI4d5UCQdWnjI</font></div><div><font size="2"   >digoal'# +V5Sppq6HQhRJ9M0ytoqmYJDKioKR0ewBQMAAwUH/jOZn7ei1rZLv0RP0Y+/E0RO</font></div><div><font size="2"   >digoal'# kzpNmMuP+mNvZNrf/PCd1SvPxFZ2MNnhB0JN9a1OjJD8otqqvxMujyTx5z0RqD+7</font></div><div><font size="2"   >digoal'# mWKb/q96NpG+fApZNGt6YiTc4a9FV9jpf+fYZyfpOj/bmPpHIUtheGzx/+WIL9gH</font></div><div><font size="2"   >digoal'# WDiFR0nP9uXZoDZotuPqEsH2acoIE4oB4lLBvajuDtwnAZlajHMgXZD9W/xzdAlR</font></div><div><font size="2"   >digoal'# 5frfGNVIdvylwN2SOfSavl4VM4hG1uFc2J4szmivK0TesP1UcIdxnTlTvFieEqaP</font></div><div><font size="2"   >digoal'# 2rpG6WfVVO7N5ZiWXYOuazzRSEtfTjnGZRnx+WmkUb5KNvVhSg8F7oB7WrKMH/2I</font></div><div><font size="2"   >digoal'# SQQYEQIACQUCUaAgOQIbDAAKCRDaMgsjY0+RLx/TAJ4uAleVExWDEVSbNeqm9wBk</font></div><div><font size="2"   >digoal'# gRNGbgCeK648ARQH8pBNHcX/hsefvah7TO4=</font></div><div><font size="2"   >digoal'# =XGEV</font></div><div><font size="2"   >digoal'# -----END PGP PUBLIC KEY BLOCK-----');</font></div></div><div><font size="2"   >得到</font></div><div><div><font size="2"   >\x9901a20451a02038110400c02d7ad60383f24fe323e9b7b6265d2431e5c8b59a9da8ea797ca398369593d8ba8a05af58445303647492d4c21f8f20c48b4ecef93</font></div><div><font size="2"   >2a6f7c85a1c1a306c7074d2a3175bacfa540c6da9d501b7d6f42f9d8ec2403d6b0b1c9696a53ef2f00c0406a7194987b6902748478d0460bdf4ea2693a8085e16a0c</font></div><div><font size="2"   >5554a29f93b1d8fe300a0cdcafb16d2e16f2b07fc0c6a9b1e8e737c06dc5303fe28f8112dfc203340a1a7023ae5a503a31e6b15b381591ad5997f87692d51524e2de</font></div><div><font size="2"   >334b1a17a679ef4fd1618140482e5c55acc21bd19baba6b75af0b2e8b5bd855e57648394d550576316823f5b0c79681149b55ab6174932a6dccfe933a9a6e20951c3</font></div><div><font size="2"   >b7943c93f4ee204be69139d46e4d5c6b5193c5124c8576257592c301c03fe219cf6e3c5452d910f52ea03f70a287ff12380fc4e18223e4f2b74bd9d173a38a67d362</font></div><div><font size="2"   >1955e686a7dff0f0384e65f4f038957250f3b1ac69981d72614738e3fae1119e775f129f1f38efa3034a11ebc19be70f11cd14f5ae55485201c1fc2e00055b6df766</font></div><div><font size="2"   >2ca33e1dc06c3dcff7b919cd191657ea632f5001bd502939d3352b4066469676f616c8860041311020020050251a02038021b03060b0908070302041502080304160</font></div><div><font size="2"   >20301021e01021780000a0910da320b23634f912fa9a9009f7bfe17b9b75b9ab4d2b23b9bf4d1b7eeabd84cad00a0ca28702cdcc29f78a6990a7513c7ec83445f99a</font></div><div><font size="2"   >ab9020d0451a02039100800f7f8001f1d9f6b58425a8ebb7702e20fb20fde5157e97111158bc0c3731f5695b92981433640ee966e032b7d268cba930824722956b4f</font></div><div><font size="2"   >d57830510067c9f4b940e8aa3406c3a0a1595b12d528fa6f6fc8e4db4cdb896bea1fd21456531a46326b63591d0b57243c59b1d7b938b8553d18a16b7f1fd5ba4693</font></div><div><font size="2"   >0612b7881c940f824652f9aa289beedc35f72658881f83c9681171a7f9ce232ffaea03cfcf60e44930413584cd56d32a9032f3da0700590f7d4d6b045d1b247a13e4</font></div><div><font size="2"   >f454940efaeceb6bc2ed9b069b08a148cb7f07f8101dcf6b984b39464a8d7f260a52823877950241d5a78c8f95e52a69aba1d085127d334cada2a9982432a2a0a474</font></div><div><font size="2"   >7b0050300030507fe33999fb7a2d6b64bbf444fd18fbf13444e933a4d98cb8ffa636f64dadffcf09dd52bcfc4567630d9e107424df5ad4e8c90fca2daaabf132e8f2</font></div><div><font size="2"   >4f1e73d11a83fbb99629bfeaf7a3691be7c0a59346b7a6224dce1af4557d8e97fe7d86727e93a3fdb98fa47214b61786cf1ffe5882fd8075838854749cff6e5d9a03</font></div><div><font size="2"   >668b6e3ea12c1f669ca08138a01e252c1bda8ee0edc2701995a8c73205d90fd5bfc73740951e5fadf18d54876fca5c0dd9239f49abe5e15338846d6e15cd89e2cce6</font></div><div><font size="2"   >8af2b44deb0fd547087719d3953bc589e12a68fdaba46e967d554eecde598965d83ae6b3cd1484b5f4e39c66519f1f969a451be4a36f5614a0f05ee807b5ab28c1ff</font></div><div><font size="2"   >d8849041811020009050251a02039021b0c000a0910da320b23634f912f1fd3009e2e02579513158311549b35eaa6f700648113466e009e2bae3c011407f2904d1dc</font></div><div><font size="2"   >5ff86c79fbda87b4cee</font></div></div><p></p></pre></div><div>转换私钥为bytea :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# select dearmor('-----BEGIN PGP PRIVATE KEY BLOCK-----</font></div><div><font size="2"   >digoal'# Version: GnuPG v1.4.5 (GNU/Linux)</font></div><div><font size="2"   >digoal'#&nbsp;</font></div><div><font size="2"   >digoal'# lQG7BFGgIDgRBADALXrWA4PyT+Mj6be2Jl0kMeXItZqdqOp5fKOYNpWT2LqKBa9Y</font></div><div><font size="2"   >digoal'# RFMDZHSS1MIfjyDEi07O+TKm98haHBowbHB00qMXW6z6VAxtqdUBt9b0L52OwkA9</font></div><div><font size="2"   >digoal'# awsclpalPvLwDAQGpxlJh7aQJ0hHjQRgvfTqJpOoCF4WoMVVSin5Ox2P4wCgzcr7</font></div><div><font size="2"   >digoal'# FtLhbysH/Axqmx6Oc3wG3FMD/ij4ES38IDNAoacCOuWlA6MeaxWzgVka1Zl/h2kt</font></div><div><font size="2"   >digoal'# UVJOLeM0saF6Z570/RYYFASC5cVazCG9Gbq6a3WvCy6LW9hV5XZIOU1VBXYxaCP1</font></div><div><font size="2"   >digoal'# sMeWgRSbVathdJMqbcz+kzqabiCVHDt5Q8k/TuIEvmkTnUbk1ca1GTxRJMhXYldZ</font></div><div><font size="2"   >digoal'# LDAcA/4hnPbjxUUtkQ9S6gP3Cih/8SOA/E4YIj5PK3S9nRc6OKZ9NiGVXmhqff8P</font></div><div><font size="2"   >digoal'# A4TmX08DiVclDzsaxpmB1yYUc44/rhEZ53XxKfHzjvowNKEevBm+cPEc0U9a5VSF</font></div><div><font size="2"   >digoal'# IBwfwuAAVbbfdmLKM+HcBsPc/3uRnNGRZX6mMvUAG9UCk50zUgAAn2j3pAZqpbN3</font></div><div><font size="2"   >digoal'# xfFFL2YYhP+ePmrnCzm0BmRpZ29hbIhgBBMRAgAgBQJRoCA4AhsDBgsJCAcDAgQV</font></div><div><font size="2"   >digoal'# AggDBBYCAwECHgECF4AACgkQ2jILI2NPkS+pqQCfe/4XubdbmrTSsjub9NG37qvY</font></div><div><font size="2"   >digoal'# TK0AoMoocCzcwp94ppkKdRPH7INEX5mqnQI9BFGgIDkQCAD3+AAfHZ9rWEJajrt3</font></div><div><font size="2"   >digoal'# AuIPsg/eUVfpcREVi8DDcx9WlbkpgUM2QO6WbgMrfSaMupMIJHIpVrT9V4MFEAZ8</font></div><div><font size="2"   >digoal'# n0uUDoqjQGw6ChWVsS1Sj6b2/I5NtM24lr6h/SFFZTGkYya2NZHQtXJDxZsde5OL</font></div><div><font size="2"   >digoal'# hVPRiha38f1bpGkwYSt4gclA+CRlL5qiib7tw19yZYiB+DyWgRcaf5ziMv+uoDz8</font></div><div><font size="2"   >digoal'# 9g5EkwQTWEzVbTKpAy89oHAFkPfU1rBF0bJHoT5PRUlA767Otrwu2bBpsIoUjLfw</font></div><div><font size="2"   >digoal'# f4EB3Pa5hLOUZKjX8mClKCOHeVAkHVp4yPleUqaauh0IUSfTNMraKpmCQyoqCkdH</font></div><div><font size="2"   >digoal'# sAUDAAMFB/4zmZ+3ota2S79ET9GPvxNETpM6TZjLj/pjb2Ta3/zwndUrz8RWdjDZ</font></div><div><font size="2"   >digoal'# 4QdCTfWtToyQ/KLaqr8TLo8k8ec9Eag/u5lim/6vejaRvnwKWTRremIk3OGvRVfY</font></div><div><font size="2"   >digoal'# 6X/n2Gcn6To/25j6RyFLYXhs8f/liC/YB1g4hUdJz/bl2aA2aLbj6hLB9mnKCBOK</font></div><div><font size="2"   >digoal'# AeJSwb2o7g7cJwGZWoxzIF2Q/Vv8c3QJUeX63xjVSHb8pcDdkjn0mr5eFTOIRtbh</font></div><div><font size="2"   >digoal'# XNieLM5orytE3rD9VHCHcZ05U7xYnhKmj9q6Ruln1VTuzeWYll2Drms80UhLX045</font></div><div><font size="2"   >digoal'# xmUZ8flppFG+Sjb1YUoPBe6Ae1qyjB/9AAFUCNmPaOMHsDg6bZpo7ApZJbJsiW6Z</font></div><div><font size="2"   >digoal'# BTCojWYF4E2C+5bPQoietziIE5V6LhPdiEkEGBECAAkFAlGgIDkCGwwACgkQ2jIL</font></div><div><font size="2"   >digoal'# I2NPkS8f0wCgpSCnhRw+soY+Fpg5t7IHjusqNt0An0EeMye7x5uyQc2ikmVtgfZu</font></div><div><font size="2"   >digoal'# NOxi</font></div><div><font size="2"   >digoal'# =FwrW</font></div><div><font size="2"   >digoal'# -----END PGP PRIVATE KEY BLOCK-----');</font></div></div><div><font size="2"   >得到 :&nbsp;</font></div><div><div><font size="2"   >\x9501bb0451a02038110400c02d7ad60383f24fe323e9b7b6265d2431e5c8b59a9da8ea797ca398369593d8ba8a05af58445303647492d4c21f8f20c48b4ecef93</font></div><div><font size="2"   >2a6f7c85a1c1a306c7074d2a3175bacfa540c6da9d501b7d6f42f9d8ec2403d6b0b1c9696a53ef2f00c0406a7194987b6902748478d0460bdf4ea2693a8085e16a0c</font></div><div><font size="2"   >5554a29f93b1d8fe300a0cdcafb16d2e16f2b07fc0c6a9b1e8e737c06dc5303fe28f8112dfc203340a1a7023ae5a503a31e6b15b381591ad5997f87692d51524e2de</font></div><div><font size="2"   >334b1a17a679ef4fd1618140482e5c55acc21bd19baba6b75af0b2e8b5bd855e57648394d550576316823f5b0c79681149b55ab6174932a6dccfe933a9a6e20951c3</font></div><div><font size="2"   >b7943c93f4ee204be69139d46e4d5c6b5193c5124c8576257592c301c03fe219cf6e3c5452d910f52ea03f70a287ff12380fc4e18223e4f2b74bd9d173a38a67d362</font></div><div><font size="2"   >1955e686a7dff0f0384e65f4f038957250f3b1ac69981d72614738e3fae1119e775f129f1f38efa3034a11ebc19be70f11cd14f5ae55485201c1fc2e00055b6df766</font></div><div><font size="2"   >2ca33e1dc06c3dcff7b919cd191657ea632f5001bd502939d335200009f68f7a4066aa5b377c5f1452f661884ff9e3e6ae70b39b4066469676f616c8860041311020</font></div><div><font size="2"   >020050251a02038021b03060b090807030204150208030416020301021e01021780000a0910da320b23634f912fa9a9009f7bfe17b9b75b9ab4d2b23b9bf4d1b7eea</font></div><div><font size="2"   >bd84cad00a0ca28702cdcc29f78a6990a7513c7ec83445f99aa9d023d0451a02039100800f7f8001f1d9f6b58425a8ebb7702e20fb20fde5157e97111158bc0c3731</font></div><div><font size="2"   >f5695b92981433640ee966e032b7d268cba930824722956b4fd57830510067c9f4b940e8aa3406c3a0a1595b12d528fa6f6fc8e4db4cdb896bea1fd21456531a4632</font></div><div><font size="2"   >6b63591d0b57243c59b1d7b938b8553d18a16b7f1fd5ba46930612b7881c940f824652f9aa289beedc35f72658881f83c9681171a7f9ce232ffaea03cfcf60e44930</font></div><div><font size="2"   >413584cd56d32a9032f3da0700590f7d4d6b045d1b247a13e4f454940efaeceb6bc2ed9b069b08a148cb7f07f8101dcf6b984b39464a8d7f260a52823877950241d5</font></div><div><font size="2"   >a78c8f95e52a69aba1d085127d334cada2a9982432a2a0a4747b0050300030507fe33999fb7a2d6b64bbf444fd18fbf13444e933a4d98cb8ffa636f64dadffcf09dd</font></div><div><font size="2"   >52bcfc4567630d9e107424df5ad4e8c90fca2daaabf132e8f24f1e73d11a83fbb99629bfeaf7a3691be7c0a59346b7a6224dce1af4557d8e97fe7d86727e93a3fdb9</font></div><div><font size="2"   >8fa47214b61786cf1ffe5882fd8075838854749cff6e5d9a03668b6e3ea12c1f669ca08138a01e252c1bda8ee0edc2701995a8c73205d90fd5bfc73740951e5fadf1</font></div><div><font size="2"   >8d54876fca5c0dd9239f49abe5e15338846d6e15cd89e2cce68af2b44deb0fd547087719d3953bc589e12a68fdaba46e967d554eecde598965d83ae6b3cd1484b5f4</font></div><div><font size="2"   >e39c66519f1f969a451be4a36f5614a0f05ee807b5ab28c1ffd00015408d98f68e307b0383a6d9a68ec0a5925b26c896e990530a88d6605e04d82fb96cf42889eb73</font></div><div><font size="2"   >88813957a2e13dd8849041811020009050251a02039021b0c000a0910da320b23634f912f1fd300a0a520a7851c3eb2863e169839b7b2078eeb2a36dd009f411e332</font></div><div><font size="2"   >7bbc79bb241cda292656d81f66e34ec62</font></div></div><p></p></pre></div><div>使用公钥加密字符串'i am digoal' :&nbsp;</div><div><pre class="prettyprint"   ><p><font size="2"   >digoal=# select pgp_pub_encrypt('i am digoal', '\x9901a20451a02038110400c02d7ad60383f24fe323e9b7b6265d2431e5c8b59a9da8ea797ca398369593d8ba8a05af58445303647492d4c21f8f20c48b4ecef932a6f7c85a1c1a306c7074d2a3175bacfa540c6da9d501b7d6f42f9d8ec2403d6b0b1c9696a53ef2f00c0406a7194987b6902748478d0460bdf4ea2693a8085e16a0c5554a29f93b1d8fe300a0cdcafb16d2e16f2b07fc0c6a9b1e8e737c06dc5303fe28f8112dfc203340a1a7023ae5a503a31e6b15b381591ad5997f87692d51524e2de334b1a17a679ef4fd1618140482e5c55acc21bd19baba6b75af0b2e8b5bd855e57648394d550576316823f5b0c79681149b55ab6174932a6dccfe933a9a6e20951c3b7943c93f4ee204be69139d46e4d5c6b5193c5124c8576257592c301c03fe219cf6e3c5452d910f52ea03f70a287ff12380fc4e18223e4f2b74bd9d173a38a67d3621955e686a7dff0f0384e65f4f038957250f3b1ac69981d72614738e3fae1119e775f129f1f38efa3034a11ebc19be70f11cd14f5ae55485201c1fc2e00055b6df7662ca33e1dc06c3dcff7b919cd191657ea632f5001bd502939d3352b4066469676f616c8860041311020020050251a02038021b03060b090807030204150208030416020301021e01021780000a0910da320b23634f912fa9a9009f7bfe17b9b75b9ab4d2b23b9bf4d1b7eeabd84cad00a0ca28702cdcc29f78a6990a7513c7ec83445f99aab9020d0451a02039100800f7f8001f1d9f6b58425a8ebb7702e20fb20fde5157e97111158bc0c3731f5695b92981433640ee966e032b7d268cba930824722956b4fd57830510067c9f4b940e8aa3406c3a0a1595b12d528fa6f6fc8e4db4cdb896bea1fd21456531a46326b63591d0b57243c59b1d7b938b8553d18a16b7f1fd5ba46930612b7881c940f824652f9aa289beedc35f72658881f83c9681171a7f9ce232ffaea03cfcf60e44930413584cd56d32a9032f3da0700590f7d4d6b045d1b247a13e4f454940efaeceb6bc2ed9b069b08a148cb7f07f8101dcf6b984b39464a8d7f260a52823877950241d5a78c8f95e52a69aba1d085127d334cada2a9982432a2a0a4747b0050300030507fe33999fb7a2d6b64bbf444fd18fbf13444e933a4d98cb8ffa636f64dadffcf09dd52bcfc4567630d9e107424df5ad4e8c90fca2daaabf132e8f24f1e73d11a83fbb99629bfeaf7a3691be7c0a59346b7a6224dce1af4557d8e97fe7d86727e93a3fdb98fa47214b61786cf1ffe5882fd8075838854749cff6e5d9a03668b6e3ea12c1f669ca08138a01e252c1bda8ee0edc2701995a8c73205d90fd5bfc73740951e5fadf18d54876fca5c0dd9239f49abe5e15338846d6e15cd89e2cce68af2b44deb0fd547087719d3953bc589e12a68fdaba46e967d554eecde598965d83ae6b3cd1484b5f4e39c66519f1f969a451be4a36f5614a0f05ee807b5ab28c1ffd8849041811020009050251a02039021b0c000a0910da320b23634f912f1fd3009e2e02579513158311549b35eaa6f700648113466e009e2bae3c011407f2904d1dc5ff86c79fbda87b4cee');</font></p></pre></div><div>加密后的数据 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >\xc1c14e031b437bccd670d8451007fe2d921731879c4044946d8f5fc88fb40d4701895534d8d370882ac22b8ea899b014df1a835d3d5520a681c184816acef966e</font></div><div><font size="2"   >9a57201810eee18136dd8a148d81811de3f39ebaa7ada4e022fa3ce0f5d62937cad62ef28dbef8864f78c48f56ae932e8b2361d74dd3792388689e1443a77a06b81a</font></div><div><font size="2"   >a4a0bf0cb1d3158130c097d4f22483609e8c317914f3b99966d9274856884894917a1d0b1389ad62d303600edaed7edba52b9fd3890386fa9579089dbbe60124ba5d</font></div><div><font size="2"   >d211a710fb352e7400e2b13c139b6b9a7fc03308852ac19447afd01e660be6a72b4a2c0985f8abc66fbb874455c6f83cec73b51269538be7cc43229c37ae5658102c</font></div><div><font size="2"   >02c44e73cd60866550800dbbb466956161875455f5554db33b52b6897d78c8613a75d6627cd7cc5be2f5685bc67bcce04f2d9aef40404bd10ac1a5b3510c60c9b522</font></div><div><font size="2"   >0f2e8c87564ca133529282c04766aa902dddd19b2da3ddd8b5d95991276c4bcff6c720fa32522898567bb93bacef655f35c6b92bf72d6f75442b37f3c5fa05b1c903</font></div><div><font size="2"   >f25ff470e69340c946a2d985d2f384c7c1f99f7df8f0189366189af895d1615d6974adafeea2519e27b5b82a5d094a20fb8215bf7ed3f0f58c58b5fbe331da0bcfd4</font></div><div><font size="2"   >9bf94426ba2e5db02b43a54ac9046fb11238e010b10cf4d9fec036ce1abb695b5462934f968682da6861583b58695b312a3d511b5e8091f6668ad116199567b453d7</font></div><div><font size="2"   >f51dfd23c0142070d0559e7e63c8ca3ed9363937184b90e273948e3dc80f121074f0f0b01f980a2d534683fc4b45131380cd70a564f33b72e6c812d858695dbb4</font></div><p></p></pre></div><div>使用私钥解密这串bytea.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select pgp_pub_decrypt('\xc1c14e031b437bccd670d8451007fe2d921731879c4044946d8f5fc88fb40d4701895534d8d370882ac22b8ea899b014df1a835d3d5520a681c184816acef966e9a57201810eee18136dd8a148d81811de3f39ebaa7ada4e022fa3ce0f5d62937cad62ef28dbef8864f78c48f56ae932e8b2361d74dd3792388689e1443a77a06b81aa4a0bf0cb1d3158130c097d4f22483609e8c317914f3b99966d9274856884894917a1d0b1389ad62d303600edaed7edba52b9fd3890386fa9579089dbbe60124ba5dd211a710fb352e7400e2b13c139b6b9a7fc03308852ac19447afd01e660be6a72b4a2c0985f8abc66fbb874455c6f83cec73b51269538be7cc43229c37ae5658102c02c44e73cd60866550800dbbb466956161875455f5554db33b52b6897d78c8613a75d6627cd7cc5be2f5685bc67bcce04f2d9aef40404bd10ac1a5b3510c60c9b5220f2e8c87564ca133529282c04766aa902dddd19b2da3ddd8b5d95991276c4bcff6c720fa32522898567bb93bacef655f35c6b92bf72d6f75442b37f3c5fa05b1c903f25ff470e69340c946a2d985d2f384c7c1f99f7df8f0189366189af895d1615d6974adafeea2519e27b5b82a5d094a20fb8215bf7ed3f0f58c58b5fbe331da0bcfd49bf94426ba2e5db02b43a54ac9046fb11238e010b10cf4d9fec036ce1abb695b5462934f968682da6861583b58695b312a3d511b5e8091f6668ad116199567b453d7f51dfd23c0142070d0559e7e63c8ca3ed9363937184b90e273948e3dc80f121074f0f0b01f980a2d534683fc4b45131380cd70a564f33b72e6c812d858695dbb4','\x9501bb0451a02038110400c02d7ad60383f24fe323e9b7b6265d2431e5c8b59a9da8ea797ca398369593d8ba8a05af58445303647492d4c21f8f20c48b4ecef932a6f7c85a1c1a306c7074d2a3175bacfa540c6da9d501b7d6f42f9d8ec2403d6b0b1c9696a53ef2f00c0406a7194987b6902748478d0460bdf4ea2693a8085e16a0c5554a29f93b1d8fe300a0cdcafb16d2e16f2b07fc0c6a9b1e8e737c06dc5303fe28f8112dfc203340a1a7023ae5a503a31e6b15b381591ad5997f87692d51524e2de334b1a17a679ef4fd1618140482e5c55acc21bd19baba6b75af0b2e8b5bd855e57648394d550576316823f5b0c79681149b55ab6174932a6dccfe933a9a6e20951c3b7943c93f4ee204be69139d46e4d5c6b5193c5124c8576257592c301c03fe219cf6e3c5452d910f52ea03f70a287ff12380fc4e18223e4f2b74bd9d173a38a67d3621955e686a7dff0f0384e65f4f038957250f3b1ac69981d72614738e3fae1119e775f129f1f38efa3034a11ebc19be70f11cd14f5ae55485201c1fc2e00055b6df7662ca33e1dc06c3dcff7b919cd191657ea632f5001bd502939d335200009f68f7a4066aa5b377c5f1452f661884ff9e3e6ae70b39b4066469676f616c8860041311020020050251a02038021b03060b090807030204150208030416020301021e01021780000a0910da320b23634f912fa9a9009f7bfe17b9b75b9ab4d2b23b9bf4d1b7eeabd84cad00a0ca28702cdcc29f78a6990a7513c7ec83445f99aa9d023d0451a02039100800f7f8001f1d9f6b58425a8ebb7702e20fb20fde5157e97111158bc0c3731f5695b92981433640ee966e032b7d268cba930824722956b4fd57830510067c9f4b940e8aa3406c3a0a1595b12d528fa6f6fc8e4db4cdb896bea1fd21456531a46326b63591d0b57243c59b1d7b938b8553d18a16b7f1fd5ba46930612b7881c940f824652f9aa289beedc35f72658881f83c9681171a7f9ce232ffaea03cfcf60e44930413584cd56d32a9032f3da0700590f7d4d6b045d1b247a13e4f454940efaeceb6bc2ed9b069b08a148cb7f07f8101dcf6b984b39464a8d7f260a52823877950241d5a78c8f95e52a69aba1d085127d334cada2a9982432a2a0a4747b0050300030507fe33999fb7a2d6b64bbf444fd18fbf13444e933a4d98cb8ffa636f64dadffcf09dd52bcfc4567630d9e107424df5ad4e8c90fca2daaabf132e8f24f1e73d11a83fbb99629bfeaf7a3691be7c0a59346b7a6224dce1af4557d8e97fe7d86727e93a3fdb98fa47214b61786cf1ffe5882fd8075838854749cff6e5d9a03668b6e3ea12c1f669ca08138a01e252c1bda8ee0edc2701995a8c73205d90fd5bfc73740951e5fadf18d54876fca5c0dd9239f49abe5e15338846d6e15cd89e2cce68af2b44deb0fd547087719d3953bc589e12a68fdaba46e967d554eecde598965d83ae6b3cd1484b5f4e39c66519f1f969a451be4a36f5614a0f05ee807b5ab28c1ffd00015408d98f68e307b0383a6d9a68ec0a5925b26c896e990530a88d6605e04d82fb96cf42889eb7388813957a2e13dd8849041811020009050251a02039021b0c000a0910da320b23634f912f1fd300a0a520a7851c3eb2863e169839b7b2078eeb2a36dd009f411e3327bbc79bb241cda292656d81f66e34ec62');</font></div><div><font size="2"   >&nbsp;pgp_pub_decrypt&nbsp;</font></div><div><font size="2"   >-----------------</font></div><div><font size="2"   >&nbsp;i am digoal</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div><div><span style="line-height: 22px;"   ><br></span></div><div><span style="line-height: 22px;"   >5.3 使用pgp_key_id可以在加密后的数据中取出这分数据是通过对称密钥还是公钥加密的.</span></div><div><pre class="prettyprint"   ><p><font size="2"   >pgp_key_id(bytea) returns text</font></p></pre></div><div>例如 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# select pgp_key_id('\xc30d0404030245811e051118cc136ed23f0198808f069b53264d4a08c2b5dcf3b1c39a34d091263f7f6b64a14808e6ffb32ccc09749105b9cc062d70c628357ab1e2474ff6d109dd083ce892cfa55706');</font></div><div><font size="2"   >&nbsp;pgp_key_id&nbsp;</font></div><div><font size="2"   >------------</font></div><div><font size="2"   >&nbsp;SYMKEY</font></div><div><font size="2"   >(1 row)</font></div></div><div><div><font size="2"   >digoal=# select pgp_key_id('\xc1c14e031b437bccd670d8451007fe2d921731879c4044946d8f5fc88fb40d4701895534d8d370882ac22b8ea899b014df1a835d3d5520a681c184816acef966e9a57201810eee18136dd8a148d81811de3f39ebaa7ada4e022fa3ce0f5d62937cad62ef28dbef8864f78c48f56ae932e8b2361d74dd3792388689e1443a77a06b81aa4a0bf0cb1d3158130c097d4f22483609e8c317914f3b99966d9274856884894917a1d0b1389ad62d303600edaed7edba52b9fd3890386fa9579089dbbe60124ba5dd211a710fb352e7400e2b13c139b6b9a7fc03308852ac19447afd01e660be6a72b4a2c0985f8abc66fbb874455c6f83cec73b51269538be7cc43229c37ae5658102c02c44e73cd60866550800dbbb466956161875455f5554db33b52b6897d78c8613a75d6627cd7cc5be2f5685bc67bcce04f2d9aef40404bd10ac1a5b3510c60c9b5220f2e8c87564ca133529282c04766aa902dddd19b2da3ddd8b5d95991276c4bcff6c720fa32522898567bb93bacef655f35c6b92bf72d6f75442b37f3c5fa05b1c903f25ff470e69340c946a2d985d2f384c7c1f99f7df8f0189366189af895d1615d6974adafeea2519e27b5b82a5d094a20fb8215bf7ed3f0f58c58b5fbe331da0bcfd49bf94426ba2e5db02b43a54ac9046fb11238e010b10cf4d9fec036ce1abb695b5462934f968682da6861583b58695b312a3d511b5e8091f6668ad116199567b453d7f51dfd23c0142070d0559e7e63c8ca3ed9363937184b90e273948e3dc80f121074f0f0b01f980a2d534683fc4b45131380cd70a564f33b72e6c812d858695dbb4');</font></div><div><font size="2"   >&nbsp; &nbsp; pgp_key_id &nbsp; &nbsp;</font></div><div><font size="2"   >------------------</font></div><div><font size="2"   >&nbsp;1B437BCCD670D845</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div><br></div><div>5.4 使用以下函数可以将加密后的数据bytea, 转换成PGP ASCII-armor格式. 或者反向转换.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >armor(data bytea) returns text</font></div><div><font size="2"   >dearmor(data text) returns bytea</font></div><p></p></pre></div><div><br></div><div>5.5 用于产生随机的加密数据bytea的函数 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >gen_random_bytes(count integer) returns bytea</font></div><div></div><p></p></pre></div><div><br></div><div>[小结]</div><div>1. crypt+gen_salt&nbsp;<span style="line-height: 22px;"   >加密速度慢, 被破解的难度高.&nbsp;</span><span style="line-height: 22px;"   >密码字符串通常较短, 并且有非常高的安全要求, 所以</span><span style="line-height: 22px;"   >比较适合用于对密码字段进行加密.</span></div><div>2. 对称加密则比较适合数据量较大, 并且有安全需求的加密. 通常为了使用方便加密的密钥可以存储在本地库中, 为了提高安全, 也可以把加密的密钥存储在客户端或者其他数据库中.</div><div>3. 公钥加密手段与对称加密类似, 只是需要生成钥匙对. 使用公钥加密后的数据解密需要用到对应的私钥. 如果私钥加了passphrase保护, 解密时还需要提供私钥的passphrase.</div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://www.postgresql.org/docs/9.3/static/pgcrypto.html"   >http://www.postgresql.org/docs/9.3/static/pgcrypto.html</a></div>2.&nbsp;<a rel="nofollow" href="http://www.gnupg.org/gph/en/manual.html"   >http://www.gnupg.org/gph/en/manual.html</a><br><div><div style="line-height: 22px;"   >3.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/163877040201342233131835/"   >http://blog.163.com/digoal@126/blog/static/163877040201342233131835/</a></div><div style="line-height: 22px;"   >4.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/163877040201342383123592/"   >http://blog.163.com/digoal@126/blog/static/163877040201342383123592/</a></div><div style="line-height: 22px;"   >5.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/163877040201342335842432/"   >http://blog.163.com/digoal@126/blog/static/163877040201342335842432/</a></div><div style="line-height: 22px;"   >6.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/1638770402013423384517/"   >http://blog.163.com/digoal@126/blog/static/1638770402013423384517/</a></div><div style="line-height: 22px;"   >7.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/163877040201342443944861/"   >http://blog.163.com/digoal@126/blog/static/163877040201342443944861/</a></div></div><div style="line-height: 22px;"   >8. pgcrypto扩展包新建的函数 :&nbsp;</div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >[root@db-172-16-3-33 extension]# cat pgcrypto--1.0.sql&nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >/* contrib/pgcrypto/pgcrypto--1.0.sql */</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >-- complain if script is sourced in psql, rather than via CREATE EXTENSION</font></div><div style="line-height: 22px;"   ><font size="2"   >\echo Use "CREATE EXTENSION pgcrypto" to load this file. \quit</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION digest(text, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_digest'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION digest(bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_digest'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION hmac(text, text, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_hmac'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION hmac(bytea, bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_hmac'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION crypt(text, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS text</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_crypt'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION gen_salt(text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS text</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_gen_salt'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C VOLATILE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION gen_salt(text, int4)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS text</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_gen_salt_rounds'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C VOLATILE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION encrypt(bytea, bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_encrypt'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION decrypt(bytea, bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_decrypt'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION encrypt_iv(bytea, bytea, bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_encrypt_iv'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION decrypt_iv(bytea, bytea, bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_decrypt_iv'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION gen_random_bytes(int4)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_random_bytes'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C VOLATILE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- pgp_sym_encrypt(data, key)</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_sym_encrypt(text, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_sym_encrypt_text'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_sym_encrypt_bytea(bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_sym_encrypt_bytea'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- pgp_sym_encrypt(data, key, args)</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_sym_encrypt(text, text, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_sym_encrypt_text'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_sym_encrypt_bytea(bytea, text, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_sym_encrypt_bytea'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- pgp_sym_decrypt(data, key)</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_sym_decrypt(bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS text</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_sym_decrypt_text'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_sym_decrypt_bytea(bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_sym_decrypt_bytea'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- pgp_sym_decrypt(data, key, args)</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_sym_decrypt(bytea, text, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS text</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_sym_decrypt_text'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_sym_decrypt_bytea(bytea, text, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_sym_decrypt_bytea'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- pgp_pub_encrypt(data, key)</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_pub_encrypt(text, bytea)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_pub_encrypt_text'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_pub_encrypt_bytea(bytea, bytea)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_pub_encrypt_bytea'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- pgp_pub_encrypt(data, key, args)</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_pub_encrypt(text, bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_pub_encrypt_text'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_pub_encrypt_bytea(bytea, bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_pub_encrypt_bytea'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- pgp_pub_decrypt(data, key)</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_pub_decrypt(bytea, bytea)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS text</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_pub_decrypt_text'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_pub_decrypt_bytea(bytea, bytea)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_pub_decrypt_bytea'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- pgp_pub_decrypt(data, key, psw)</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_pub_decrypt(bytea, bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS text</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_pub_decrypt_text'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_pub_decrypt_bytea(bytea, bytea, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_pub_decrypt_bytea'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- pgp_pub_decrypt(data, key, psw, arg)</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_pub_decrypt(bytea, bytea, text, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS text</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_pub_decrypt_text'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_pub_decrypt_bytea(bytea, bytea, text, text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_pub_decrypt_bytea'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- PGP key ID</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION pgp_key_id(bytea)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS text</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pgp_key_id_w'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >-- pgp armor</font></div><div style="line-height: 22px;"   ><font size="2"   >--</font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION armor(bytea)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS text</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_armor'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >CREATE FUNCTION dearmor(text)</font></div><div style="line-height: 22px;"   ><font size="2"   >RETURNS bytea</font></div><div style="line-height: 22px;"   ><font size="2"   >AS 'MODULE_PATHNAME', 'pg_dearmor'</font></div><div style="line-height: 22px;"   ><font size="2"   >LANGUAGE C IMMUTABLE STRICT;</font></div><p></p></pre></div><div style="line-height: 22px;"   ><br></div><div style="line-height: 22px;"   ><br></div></div></div>
	</div>
</div>
</body>
</html>