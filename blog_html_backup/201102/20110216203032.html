<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">WHY prepared Statement running slower in some situation</h2>
	<h5 id="">2011-02-16 20:30:32&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020111168855258/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">在某些情况下，使用PREPARED STATEMENT或函数，可能会比直接执行SQL更慢。为什么呢？<br>这个要从执行计划说起，<br>下面来看一个测试表<br><pre class="prettyprint"  ><p><font size="2"  >digoal=&gt; \d tbl_user<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Table "digoal.tbl_user"<br>&nbsp; Column&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Modifiers <br>-----------+-----------------------+-----------<br>&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | integer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | not null<br>&nbsp;firstname | character varying(32) | <br>&nbsp;lastname&nbsp; | character varying(32) | <br>&nbsp;corp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | character varying(32) | <br>&nbsp;age&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | integer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | <br>Indexes:<br>&nbsp;&nbsp;&nbsp; "tbl_user_pkey" PRIMARY KEY, btree (id)<br>&nbsp;&nbsp;&nbsp; "idx_user_age" btree (age)<br>digoal=&gt; insert into tbl_user select generate_series(1,100000),'zhou','digoal','sky-mobi',27 ;<br>INSERT 0 100000<br>digoal=&gt; insert into tbl_user select generate_series(100001,100100),'zhou','digoal','sky-mobi',generate_series(1,100) ;<br>INSERT 0 100<br>digoal=&gt; analyze tbl_user;<br>ANALYZE<br>digoal=&gt; select age,count(*) from tbl_user group by age order by count(*);<br>&nbsp;age | count&nbsp; <br>-----+--------<br>&nbsp; 68 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp;&nbsp; 8 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 11 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 80 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 16 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 39 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 54 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp;&nbsp; 3 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 47 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 61 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 96 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 67 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 87 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 14 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 46 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 99 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 48 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 17 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 28 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 83 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 36 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 94 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 15 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 84 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 88 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 66 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 77 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 38 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp;&nbsp; 4 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 30 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 89 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 60 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 50 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 74 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 33 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 73 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 95 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp;&nbsp; 6 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 40 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 56 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 53 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 62 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 71 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 19 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 29 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 93 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp;&nbsp; 2 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 21 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 57 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 51 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 72 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 92 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 97 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 23 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 41 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 31 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 35 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 65 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 75 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 52 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 76 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 20 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 69 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp;&nbsp; 5 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 44 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp;&nbsp; 7 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 37 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 85 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 34 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 82 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 81 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 25 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 32 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 12 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 58 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp;&nbsp; 1 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 10 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 79 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 26 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 42 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 90 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 18 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 59 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 78 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 98 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp;100 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 86 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 13 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 49 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 22 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 63 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp;&nbsp; 9 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 24 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 91 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 64 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 70 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 45 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 43 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 55 |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>&nbsp; 27 | 100001<br>(100 rows)</font></p></pre><br># 如果按照AGE为条件查询，可能全表扫描（如age=27），或走索引(如age=1)。<br><pre class="prettyprint"  ><p><font size="2"  >digoal=&gt; explain analyze select * from tbl_user where age=1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QUERY PLAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>------------------------------------------------------------------------------------------------------------------------<br>&nbsp;Index Scan using idx_user_age on tbl_user&nbsp; (cost=0.00..4.32 rows=3 width=29) (actual time=0.018..0.019 rows=1 loops=1)<br>&nbsp;&nbsp; Index Cond: (age = 1)<br>&nbsp;Total runtime: 0.042 ms<br>(3 rows)<br><br>Time: 0.516 ms<br>digoal=&gt; explain analyze select * from tbl_user where age=27;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QUERY PLAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>-----------------------------------------------------------------------------------------------------------------<br>&nbsp;Seq Scan on tbl_user&nbsp; (cost=0.00..1989.25 rows=100000 width=29) (actual time=0.010..21.112 rows=100001 loops=1)<br>&nbsp;&nbsp; Filter: (age = 27)<br>&nbsp;Total runtime: 27.784 ms<br>(3 rows)<br><br>Time: 28.114 ms</font></p></pre><br># 使用prepared statement看看情况如何:<br><pre class="prettyprint"  ><p><font size="2"  >digoal=&gt; prepare p_user (int) as select * from tbl_user where age=$1;<br>PREPARE<br>Time: 12.408 ms<br>digoal=&gt; explain analyze execute p_user(1);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QUERY PLAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>-----------------------------------------------------------------------------------------------------------------------------<br>&nbsp;Index Scan using idx_user_age on tbl_user&nbsp; (cost=0.00..105.55 rows=3229 width=29) (actual time=0.012..0.012 rows=1 loops=1)<br>&nbsp;&nbsp; Index Cond: (age = $1)<br>&nbsp;Total runtime: 0.038 ms<br>(3 rows)<br><br>Time: 0.191 ms<br>digoal=&gt; explain analyze execute p_user(27);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QUERY PLAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>-----------------------------------------------------------------------------------------------------------------------------------<br>&nbsp;Index Scan using idx_user_age on tbl_user&nbsp; (cost=0.00..105.55 rows=3229 width=29) (actual time=0.016..23.100 rows=100001 loops=1)<br>&nbsp;&nbsp; Index Cond: (age = $1)<br>&nbsp;Total runtime: 30.069 ms<br>(3 rows)<br><br>Time: 30.403 ms</font></p></pre>10W左右数据量的情况下用索引比全表扫描相差3ms左右<br>插入1000W左右数据再看看情况,<br><pre class="prettyprint"  ><p><font size="2"  >digoal=&gt; insert into tbl_user select generate_series(100101,9999999),'zhou','digoal','sky-mobi',27 ;<br>INSERT 0 9899899<br>digoal=&gt; explain analyze execute p_user(1);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QUERY PLAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>-----------------------------------------------------------------------------------------------------------------------------------<br>&nbsp;Index Scan using idx_user_age on tbl_user&nbsp; (cost=0.00..159018.74 rows=5000094 width=29) (actual time=0.015..0.015 rows=1 loops=1)<br>&nbsp;&nbsp; Index Cond: (age = $1)<br>&nbsp;Total runtime: 0.036 ms<br>(3 rows)<br><br>Time: 0.535 ms<br>digoal=&gt; explain analyze execute p_user(27);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QUERY PLAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>------------------------------------------------------------------------------------------------------------------------------------<br>--------<br>&nbsp;Index Scan using idx_user_age on tbl_user&nbsp; (cost=0.00..159018.74 rows=5000094 width=29) (actual time=0.014..2352.636 rows=9999900 l<br>oops=1)<br>&nbsp;&nbsp; Index Cond: (age = $1)<br>&nbsp;Total runtime: 3042.357 ms<br>(3 rows)<br><br>Time: 3042.689 ms<br><br>digoal=&gt; explain analyze select * from tbl_user where age=27;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QUERY PLAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>-----------------------------------------------------------------------------------------------------------------------<br>&nbsp;Seq Scan on tbl_user&nbsp; (cost=0.00..198533.34 rows=9999854 width=29) (actual time=0.011..2062.048 rows=9999900 loops=1)<br>&nbsp;&nbsp; Filter: (age = 27)<br>&nbsp;Total runtime: 2737.911 ms<br>(3 rows)<br><br>Time: 2738.430 ms<br>digoal=&gt; explain analyze select * from tbl_user where age=1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QUERY PLAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>---------------------------------------------------------------------------------------------------------------------------<br>&nbsp;Index Scan using idx_user_age on tbl_user&nbsp; (cost=0.00..15.03 rows=333 width=29) (actual time=0.012..0.013 rows=1 loops=1)<br>&nbsp;&nbsp; Index Cond: (age = 1)<br>&nbsp;Total runtime: 0.031 ms<br>(3 rows)<br><br>Time: 0.403 ms</font></p></pre><br>相差约300mS<br><br>并不是说这样就不建议使用prepared statement了，prepared statement的使用对于降低CPU开销和服务端代码重用来说是非常有效的。</div>
	</div>
</div>
</body>
</html>