<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL use pgbench and oracle_fdw test Oracle & PostgreSQL performance</h2>
	<h5 id="">2013-08-08 17:37:29&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020137834025753/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>前段时间写过一篇使用pgbench测试MySQL和PostgreSQL性能的文章</div><div>&lt;PostgreSQL use pgbench and mysql_fdw test MySQL &amp; PostgreSQL performance&gt;</div><div><a href="http://blog.163.com/digoal@126/blog/static/163877040201362355123969/"   >http://blog.163.com/digoal@126/blog/static/163877040201362355123969/</a></div><div>用到的是PostgreSQL的FDW模块, 通过这个模块访问外部数据库以达到测试的目的.</div><div>当前非PostgreSQL外部表模块都不还不支持写的功能, 所以现在的测试仅仅局限于查询操作.</div><div>本文将要使用oracle_fdw来对比测试一下Oracle和PostgreSQL的查询性能.</div><div>[环境概述]</div><div>被测试的 PostgreSQL | Oracle Server</div><div>DELL R610, 8核心&nbsp;Intel(R) Xeon(R) CPU &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; E5504 &nbsp;@ 2.00GHz, 8GB内存, 10K SAS硬盘</div><div><br></div><div>测试机 PostgreSQL | pgbench Server (测试Oracle时, 使用这台机器的PostgreSQL数据库)</div><div><span style="line-height: 22px;"   >DELL R610, 8核心&nbsp;</span>Intel(R) Xeon(R) CPU &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; E5506 &nbsp;@ 2.13GHz<span style="line-height: 22px;"   >, 8GB内存</span></div><div><span style="line-height: 22px;"   ><br></span></div><div><span style="line-height: 22px;"   >网络 1GB 交换网络.</span></div><div><span style="line-height: 22px;"   ><br></span></div><div>软件 :&nbsp;</div><div>Oracle 10.2.0.4</div><div>PostgreSQL 9.3beta2</div><div><a target="_blank" rel="nofollow" href="http://git.postgresql.org/gitweb/?p=postgresql.git;a=snapshot;h=92d003fcbfb73eebf0c1782dbd53c6e2f14d5cc4;sf=tgz"   >http://git.postgresql.org/gitweb/?p=postgresql.git;a=snapshot;h=92d003fcbfb73eebf0c1782dbd53c6e2f14d5cc4;sf=tgz</a></div><div><span style="line-height: 22px;"   ><br></span></div><div><span style="line-height: 22px;"   >Oracle 配置 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >kefu.__db_cache_size=3724541952</font></div><div><font size="2"   >kefu.__java_pool_size=33554432</font></div><div><font size="2"   >kefu.__large_pool_size=16777216</font></div><div><font size="2"   >kefu.__shared_pool_size=939524096</font></div><div><font size="2"   >kefu.__streams_pool_size=0</font></div><div><font size="2"   >*.audit_file_dest='/opt/oracle/admin/kefu/adump'</font></div><div><font size="2"   >*.background_dump_dest='/opt/oracle/admin/kefu/bdump'</font></div><div><font size="2"   >*.compatible='10.2.0.3.0'</font></div><div><font size="2"   >*.control_files='/database/oradata/kefu/control01.ctl','/database/oradata/kefu/control02.ctl','/database/oradata/kefu/control03.ctl'</font></div><div><font size="2"   >*.core_dump_dest='/opt/oracle/admin/kefu/cdump'</font></div><div><font size="2"   >*.db_block_size=8192</font></div><div><font size="2"   >*.db_domain=''</font></div><div><font size="2"   >*.db_file_multiblock_read_count=16</font></div><div><font size="2"   >*.db_name='kefu'</font></div><div><font size="2"   >*.dispatchers='(PROTOCOL=TCP) (SERVICE=kefuXDB)'</font></div><div><font size="2"   >*.job_queue_processes=10</font></div><div><font size="2"   >*.local_listener='(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=0.0.0.0)(PORT=1621)))'</font></div><div><font size="2"   >*.open_cursors=300</font></div><div><font size="2"   >*.pga_aggregate_target=1073741824</font></div><div><font size="2"   >*.processes=1500</font></div><div><font size="2"   >*.remote_login_passwordfile='EXCLUSIVE'</font></div><div><font size="2"   >*.sessions=1655</font></div><div><font size="2"   >*.sga_target=4718592000</font></div><div><font size="2"   >*.undo_management='AUTO'</font></div><div><font size="2"   >*.undo_tablespace='UNDOTBS1'</font></div><div><font size="2"   >*.user_dump_dest='/opt/oracle/admin/kefu/udump'</font></div><p></p></pre></div><div><span style="line-height: 22px;"   ><br></span></div><div>PostgreSQL 配置 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >listen_addresses = '0.0.0.0' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# what IP address(es) to listen on;</font></div><div><font size="2"   >port = 1921 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >max_connections = 100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >superuser_reserved_connections = 13 &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >unix_socket_directories = '.' &nbsp; # comma-separated list of directories</font></div><div><font size="2"   >unix_socket_permissions = 0700 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# begin with 0 to use octal notation</font></div><div><font size="2"   >tcp_keepalives_idle = 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPIDLE, in seconds;</font></div><div><font size="2"   >tcp_keepalives_interval = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPINTVL, in seconds;</font></div><div><font size="2"   >tcp_keepalives_count = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # TCP_KEEPCNT;</font></div><div><font size="2"   >shared_buffers = 2048MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 128kB</font></div><div><font size="2"   >maintenance_work_mem = 512MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# min 1MB</font></div><div><font size="2"   >shared_preload_libraries = 'pg_stat_statements' &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >vacuum_cost_delay = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 0-100 milliseconds</font></div><div><font size="2"   >vacuum_cost_limit = 10000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 credits</font></div><div><font size="2"   >bgwriter_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 10-10000ms between rounds</font></div><div><font size="2"   >synchronous_commit = off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# synchronization level;</font></div><div><font size="2"   >wal_buffers = 16384kB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 32kB, -1 sets based on shared_buffers</font></div><div><font size="2"   >wal_writer_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 milliseconds</font></div><div><font size="2"   >checkpoint_segments = 64 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# in logfile segments, min 1, 16MB each</font></div><div><font size="2"   >random_page_cost = 1.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# same scale as above</font></div><div><font size="2"   >effective_cache_size = 8192MB</font></div><div><font size="2"   >log_destination = 'csvlog' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Valid values are combinations of</font></div><div><font size="2"   >logging_collector = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Enable capturing of stderr and csvlog</font></div><div><font size="2"   >log_directory = 'pg_log' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# directory where log files are written,</font></div><div><font size="2"   >log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # log file name pattern,</font></div><div><font size="2"   >log_file_mode = 0600 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# creation mode for log files,</font></div><div><font size="2"   >log_truncate_on_rotation = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # If on, an existing log file with the</font></div><div><font size="2"   >log_rotation_age = 1d &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Automatic rotation of logfiles will</font></div><div><font size="2"   >log_rotation_size = 10MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Automatic rotation of logfiles will</font></div><div><font size="2"   >log_checkpoints = on</font></div><div><font size="2"   >log_connections = on</font></div><div><font size="2"   >log_disconnections = on</font></div><div><font size="2"   >log_error_verbosity = verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # terse, default, or verbose messages</font></div><div><font size="2"   >log_timezone = 'PRC'</font></div><div><font size="2"   >autovacuum = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Enable autovacuum subprocess? &nbsp;'on'</font></div><div><font size="2"   >log_autovacuum_min_duration = 0 # -1 disables, 0 logs all actions and</font></div><div><font size="2"   >datestyle = 'iso, mdy'</font></div><div><font size="2"   >timezone = 'PRC'</font></div><div><font size="2"   >lc_messages = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for system error message</font></div><div><font size="2"   >lc_monetary = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for monetary formatting</font></div><div><font size="2"   >lc_numeric = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# locale for number formatting</font></div><div><font size="2"   >lc_time = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for time formatting</font></div><div><font size="2"   >default_text_search_config = 'pg_catalog.english'</font></div><div><font size="2"   >pg_stat_statements.max = 1000</font></div><div><font size="2"   >pg_stat_statements.track = all</font></div><p></p></pre></div><div><br></div><div>[环境部署]</div><div>1. Server A : Oracle</div><div>安装过程略</div><div>环境变量</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >export ORACLE_SID=kefu</font></div><div><font size="2"   >export ORACLE_BASE=/opt/oracle</font></div><div><font size="2"   >export ORACLE_HOME=$ORACLE_BASE/product/10.2.0/db_1</font></div><div><font size="2"   >export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib64:/usr/lib64:/usr/local/lib64:$ORACLE_HOME/lib32:/lib:/usr/lib:/usr/local/lib</font></div><div><font size="2"   >export PATH=$ORACLE_HOME/bin:$PATH:.</font></div><p></p></pre></div><div><br></div><div>2. Server A : PostgreSQL</div><div>PostgreSQL编译选项</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >./configure --prefix=/opt/pgsql9.3beta2 --with-pgport=1921 --with-perl --with-python --with-openssl --with-pam --without-ldap --with-libxml --with-libxslt --enable-thread-safety --with-wal-blocksize=16 &amp;&amp; gmake &amp;&amp; gmake install</font></div><div><font size="2"   >cd contrib</font></div><div><font size="2"   >gmake &amp;&amp; gmake install</font></div><p></p></pre></div><div>插件如下</div><div>pgfincore, 将数据加载至fs cache.</div><div><pre class="prettyprint"   ><p></p><div><a rel="nofollow" href="https://github.com/klando/pgfincore"   ><font size="2"   >https://github.com/klando/pgfincore</font></a></div><div><font size="2"   >cp pgfincore $PGSRC/contrib/</font></div><div><font size="2"   >cd&nbsp;<span style="line-height: 22px;"   >$PGSRC/contrib/pgfincore</span></font></div><div><font size="2"   >export PATH=<span style="line-height: 22px;"   >/opt/pgsql9.3beta2/bin:$PATH</span></font></div><div><span style="line-height: 22px;"   ><font size="2"   >gmake clean; gmake; gmake install</font></span></div><p></p></pre></div><div>oracle_fdw 0.9.9, 用于PostgreSQL创建Oracle外部表, PostgreSQL到Oracle使用长连接. 所以不存在mysql_fdw那样的连接问题.</div><div><pre class="prettyprint"   ><p></p><div><a rel="nofollow" href="http://pgxn.org/dist/oracle_fdw/"   ><font size="2"   >http://pgxn.org/dist/oracle_fdw/</font></a></div><div><div style="line-height: 22px;"   ><font size="2"   >cp oracle_fdw $PGSRC/contrib/</font></div><div style="line-height: 22px;"   ><font size="2"   >cd&nbsp;<span style="line-height: 22px;"   >$PGSRC/contrib/oracle_fdw</span></font></div></div><div><div style="line-height: 22px;"   ><font size="2"   >export PATH=<span style="line-height: 22px;"   >/opt/pgsql9.3beta2/bin:$PATH</span></font></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   ><font size="2"   >gmake clean; gmake; gmake install</font></span></div></div><p></p></pre></div><div><br></div><div>环境变量</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >export PGPORT=1921</font></div><div><font size="2"   >export PGDATA=/database/pgdata/pg_root</font></div><div><font size="2"   >export LANG=en_US.utf8</font></div><div><font size="2"   >export PGHOME=/opt/pgsql9.3beta2</font></div><div><font size="2"   >export DATE=`date +"%Y%m%d%H%M"`</font></div><div><font size="2"   >export ORACLE_BASE=/opt/oracle</font></div><div><font size="2"   >export ORACLE_HOME=$ORACLE_BASE/product/10.2.0/db_1</font></div><div><font size="2"   >export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$ORACLE_HOME/lib32:$PGHOME/lib:/lib64:/usr/lib64:/usr/local/lib64:/lib:/usr/lib:/usr/local/lib:.</font></div><div><font size="2"   >export PATH=$ORACLE_HOME/bin:$PGHOME/bin:$PATH:.</font></div><div><font size="2"   >export MANPATH=$PGHOME/share/man:$MANPATH</font></div><div><font size="2"   >export PGDATABASE=digoal</font></div><div><font size="2"   >export PGUSER=postgres</font></div><div><font size="2"   >export PGHOST=$PGDATA</font></div><p></p></pre></div><div><br></div><div><span style="line-height: 22px;"   >3. Server B : PostgreSQL</span></div><div><span style="line-height: 22px;"   >同Server A, Oracle客户端使用10.2.0.4版本</span></div><div><span style="line-height: 22px;"   >PostgreSQL 编译选项同ServerA .</span></div><div><span style="line-height: 22px;"   >插件编译同ServerA.</span></div><div><span style="line-height: 22px;"   ><br></span></div><div>[测试]</div><div>1. PostgreSQL&nbsp;<span style="line-height: 22px;"   >Server A :&nbsp;</span></div><div>测试表</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres@kefu-&gt; psql</font></div><div><font size="2"   >psql (9.3beta2)</font></div><div><font size="2"   >Type "help" for help.</font></div></div><div><div><font size="2"   >create table part_test(id int primary key, info text, crt_time timestamp(0));</font></div></div><p></p></pre></div><div><div><br></div></div><div>测试数据</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 22px;"   ><font size="2"   >insert into part_test select generate_series(1,1999999),'Hello, I_am_digoal.zhou.','2012-09-13 21:08:46';</font></span></div><div></div><p></p></pre></div><div>加载至内存</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >select pgfadvise_willneed('part_test');</font></div><div><font size="2"   >select pgfadvise_willneed('part_test_pkey');</font></div><p></p></pre></div><div><br></div><div>测试脚本</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@kefu-&gt; cat test.sql</font></div><div><font size="2"   >\setrandom id 1 1999999</font></div><div><font size="2"   >select * from part_test where id=:id;</font></div><p></p></pre></div><div><br></div><div>本地测试结果(pgbench与数据库在同一主机)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@kefu-&gt; pgbench -M prepared -n -r -f ./test.sql -T 10 -c 16 -j 4 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 16</font></div><div><font size="2"   >number of threads: 4</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 911350</font></div><div><font size="2"   >tps = 91041.745940 (including connections establishing)</font></div><div><font size="2"   >tps = 91192.563026 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.001780 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.171814 &nbsp; &nbsp; &nbsp; &nbsp;select * from part_test where id=:id;</font></div><p></p></pre></div><div><br></div><div>网络测试结果(<span style="line-height: 22px;"   >pgbench在Server B</span><span style="line-height: 22px;"   >)</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@sims-&gt; pgbench -M prepared -n -r -f ./test.sql -T 10 -c 32 -j 16 -h 172.16.3.67 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 32</font></div><div><font size="2"   >number of threads: 16</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 908273</font></div><div><font size="2"   >tps = 90808.193956 (including connections establishing)</font></div><div><font size="2"   >tps = 90999.625422 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.002475 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.346643 &nbsp; &nbsp; &nbsp; &nbsp;select * from part_test where id=:id;</font></div><p></p></pre></div><div><br></div><div><div style="line-height: 22px;"   >2. Oracle&nbsp;<span style="line-height: 22px;"   >Server A :&nbsp;</span></div><div style="line-height: 22px;"   >测试表</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >SQL&gt; conn test/test</font></div><div><font size="2"   >Connected.</font></div></div><div><div><font size="2"   >SQL&gt; create table part_test (id int primary key, info varchar2(64) default 'Hello, I_am_digoal.zhou.', crt_time date default sysdate) tablespace kefu;</font></div><div><font size="2"   >Table created.</font></div></div><p></p></pre></div><div><div><br></div></div><div style="line-height: 22px;"   >测试数据</div></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >SQL&gt; insert into part_test nologging (id) &nbsp;select rownum from dual connect by level &lt; 2000000;</font></div><div style="line-height: 22px;"   ><font size="2"   >1999999 rows created.</font></div></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><font size="2"   >SQL&gt; commit;</font></div><div style="line-height: 22px;"   ><font size="2"   >Commit complete.</font></div></div><p></p></pre></div></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><br></div></div></div><div style="line-height: 22px;"   >3. Oracle测试1, PostgreSQL 代理节点, Server A :&nbsp;</div><div style="line-height: 22px;"   >外部表</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >pg93@sims-&gt; psql</font></div><div><font size="2"   >psql (9.3beta2)</font></div><div><font size="2"   >Type "help" for help</font></div></div><div><div><font size="2"   >digoal=# CREATE EXTENSION oracle_fdw;</font></div><div><font size="2"   >CREATE EXTENSION</font></div><div><font size="2"   >digoal=# CREATE SERVER oradb FOREIGN DATA WRAPPER oracle_fdw</font></div><div><font size="2"   >digoal-# &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OPTIONS (dbserver '//127.0.0.1:1621/kefu');</font></div><div><font size="2"   >CREATE SERVER</font></div><div><font size="2"   >digoal=# GRANT USAGE ON FOREIGN SERVER oradb TO postgres;</font></div><div><font size="2"   >GRANT</font></div></div><div><div><font size="2"   >digoal=# CREATE USER MAPPING FOR postgres SERVER oradb</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OPTIONS (user 'test', password 'test');</font></div><div><font size="2"   >CREATE USER MAPPING</font></div><div><font size="2"   >digoal=# CREATE FOREIGN TABLE ora_part_test (id int, info text, crt_time timestamp(0)) SERVER oradb OPTIONS (schema 'TEST', table 'PART_TEST');</font></div><div><font size="2"   >CREATE FOREIGN TABLE</font></div><div><font size="2"   >digoal=# select * from ora_part_test limit 1;</font></div><div><font size="2"   >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; info &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp;&nbsp;</font></div><div><font size="2"   >----+--------------------------+---------------------</font></div><div><font size="2"   >&nbsp; 1 | Hello, I_am_digoal.zhou. | 2012-09-13 21:08:46</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >-- 外部表执行计划, 执行计划正常.</font></div><div><font size="2"   >digoal=# explain (analyze,verbose,buffers,costs,timing) select * from ora_part_test where id=1;<br>                                                          QUERY PLAN                                                           <br>-------------------------------------------------------------------------------------------------------------------------------<br> Foreign Scan on public.ora_part_test  (cost=10000.00..10000.00 rows=1000 width=44) (actual time=0.362..0.376 rows=1 loops=1)<br>   Output: id, info, crt_time<br>   Oracle query: SELECT /*ce851d846643561874d235522a63c865*/ "ID", "INFO", "CRT_TIME" FROM "TEST"."PART_TEST" WHERE ("ID" = 1)<br>   Oracle plan: SELECT STATEMENT<br>   Oracle plan:   TABLE ACCESS BY INDEX ROWID PART_TEST<br>   Oracle plan:     INDEX UNIQUE SCAN SYS_C0038184 (condition "ID"=1)<br> Total runtime: 0.722 ms<br>(7 rows)</font></div><div><font size="2"   >-- 与直接在Oracle中查询一致</font></div><div><font size="2"   >SQL&gt; set autotrace on<br>SQL&gt; select * from test.part_test where id=1;<br><br>        ID INFO<br>---------- ----------------------------------------------------------------<br>CRT_TIME<br>-------------------<br>         1 Hello, I_am_digoal.zhou.<br>2013-08-08 17:12:50<br>Execution Plan<br>----------------------------------------------------------<br>Plan hash value: 444085054<br><br>--------------------------------------------------------------------------------<br>------------<br><br>| Id  | Operation                   | Name         | Rows  | Bytes | Cost (%CPU)<br>| Time     |<br><br>--------------------------------------------------------------------------------<br>------------<br><br>|   0 | SELECT STATEMENT            |              |     1 |    38 |     3   (0)<br>| 00:00:01 |<br><br>|   1 |  TABLE ACCESS BY INDEX ROWID| PART_TEST    |     1 |    38 |     3   (0)<br>| 00:00:01 |<br><br>|*  2 |   INDEX UNIQUE SCAN         | SYS_C0038184 |     1 |       |     2   (0)<br>| 00:00:01 |<br><br>--------------------------------------------------------------------------------<br>------------<br>Predicate Information (identified by operation id):<br>---------------------------------------------------<br><br>   2 - access("ID"=1)<br>Statistics<br>----------------------------------------------------------<br>          1  recursive calls<br>          0  db block gets<br>          4  consistent gets<br>          0  physical reads<br>          0  redo size<br>        670  bytes sent via SQL*Net to client<br>        487  bytes received via SQL*Net from client<br>          2  SQL*Net roundtrips to/from client<br>          0  sorts (memory)<br>          0  sorts (disk)<br>          1  rows processed</font></div><p></p></pre></div><div><br></div><div><div style="line-height: 22px;"   >测试脚本</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@kefu-&gt; cat test.sql&nbsp;</font></div><div><font size="2"   >\setrandom id 1 1999999</font></div><div><font size="2"   >select * from ora_part_test where id=:id;</font></div><p></p></pre></div><div style="line-height: 22px;"   ><br></div><div style="line-height: 22px;"   >测试结果(类似PostgreSQL的本地测试结果, 但是多了PostgreSQL这层本地开销)</div></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@kefu-&gt; pgbench -M prepared -n -r -f ./test.sql -T 10 -c 16 -j 4 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 16</font></div><div><font size="2"   >number of threads: 4</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 2229</font></div><div><font size="2"   >tps = 220.236047 (including connections establishing)</font></div><div><font size="2"   >tps = 220.867106 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003914 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 71.978837 &nbsp; &nbsp; &nbsp; select * from ora_part_test where id=:id;</font></div><p></p></pre></div><div><br></div><div style="line-height: 22px;"   ><br></div><div>以上结果由于数据未放入缓存, 查询速度非常慢, 难以忍受.</div><div>使用buffer_pool keep, 将Oracle下的part_test表放到内存中.</div><div><div><br></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >SQL&gt; alter table test.part_test storage(buffer_pool keep);</font></div><div><font size="2"   >Table altered.</font></div><div><font size="2"   >SQL&gt; alter index test.SYS_C0038184 storage(buffer_pool keep);</font></div><div><font size="2"   >Index altered.</font></div></div><div><font size="2"   >SQL&gt; conn test/test</font></div><div><font size="2"   >SQL&gt; set autotrace on</font></div><p></p></pre></div></div><div>将索引读入keep pool.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >SQL&gt; select count(*) from part_test;</font></div><div><font size="2"   >&nbsp; COUNT(*)</font></div><div><font size="2"   >----------</font></div><div><font size="2"   >&nbsp; &nbsp;1999999</font></div><div><font size="2"   >Execution Plan</font></div><div><font size="2"   >----------------------------------------------------------</font></div><div><font size="2"   >Plan hash value: 3023841178</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >------------------------------------------------------------------------------</font></div><div><font size="2"   >| Id &nbsp;| Operation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Name &nbsp; &nbsp; &nbsp; &nbsp; | Rows &nbsp;| Cost (%CPU)| Time &nbsp; &nbsp; |</font></div><div><font size="2"   >------------------------------------------------------------------------------</font></div><div><font size="2"   >| &nbsp; 0 | SELECT STATEMENT &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 1 | &nbsp; 867 &nbsp; (3)| 00:00:11 |</font></div><div><font size="2"   >| &nbsp; 1 | &nbsp;SORT AGGREGATE &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div><div><font size="2"   >| &nbsp; 2 | &nbsp; INDEX FAST FULL SCAN| SYS_C0038184 | &nbsp;2041K| &nbsp; 867 &nbsp; (3)| 00:00:11 |</font></div><div><font size="2"   >------------------------------------------------------------------------------</font></div><div><font size="2"   >Statistics</font></div><div><font size="2"   >----------------------------------------------------------</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;recursive calls</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;db block gets</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp;3910 &nbsp;consistent gets</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;physical reads</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;redo size</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 518 &nbsp;bytes sent via SQL*Net to client</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 487 &nbsp;bytes received via SQL*Net from client</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 &nbsp;SQL*Net roundtrips to/from client</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;sorts (memory)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;sorts (disk)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp;rows processed</font></div><p></p></pre></div><div><span style="line-height: 22px;"   >将表读入keep pool.</span></div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >SQL&gt; select /*+ FULL(t) */ count(*) from test.part_test t;</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; COUNT(*)</font></div><div style="line-height: 22px;"   ><font size="2"   >----------</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp;1999999</font></div><div style="line-height: 22px;"   ><font size="2"   >Execution Plan</font></div><div style="line-height: 22px;"   ><font size="2"   >----------------------------------------------------------</font></div><div style="line-height: 22px;"   ><font size="2"   >Plan hash value: 1787511310</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >------------------------------------------------------------------------</font></div><div style="line-height: 22px;"   ><font size="2"   >| Id &nbsp;| Operation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Name &nbsp; &nbsp; &nbsp;| Rows &nbsp;| Cost (%CPU)| Time &nbsp; &nbsp; |</font></div><div style="line-height: 22px;"   ><font size="2"   >------------------------------------------------------------------------</font></div><div style="line-height: 22px;"   ><font size="2"   >| &nbsp; 0 | SELECT STATEMENT &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 1 | &nbsp;2682 &nbsp; (1)| 00:00:33 |</font></div><div style="line-height: 22px;"   ><font size="2"   >| &nbsp; 1 | &nbsp;SORT AGGREGATE &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; 1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div><div style="line-height: 22px;"   ><font size="2"   >| &nbsp; 2 | &nbsp; TABLE ACCESS FULL| PART_TEST | &nbsp;2041K| &nbsp;2682 &nbsp; (1)| 00:00:33 |</font></div><div style="line-height: 22px;"   ><font size="2"   >------------------------------------------------------------------------</font></div><div style="line-height: 22px;"   ><font size="2"   >Statistics</font></div><div style="line-height: 22px;"   ><font size="2"   >----------------------------------------------------------</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;recursive calls</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;db block gets</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; 12070 &nbsp;consistent gets</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;physical reads</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;redo size</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 518 &nbsp;bytes sent via SQL*Net to client</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 487 &nbsp;bytes received via SQL*Net from client</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 &nbsp;SQL*Net roundtrips to/from client</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;sorts (memory)</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp;sorts (disk)</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 &nbsp;rows processed</font></div><p></p></pre></div></div><div><br></div><div>再次测试结果</div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >postgres@kefu-&gt; pgbench -M prepared -n -r -f ./test.sql -T 10 -c 16 -j 4 digoal</font></div><div style="line-height: 22px;"   ><font size="2"   >transaction type: Custom query</font></div><div style="line-height: 22px;"   ><font size="2"   >scaling factor: 1</font></div><div style="line-height: 22px;"   ><font size="2"   >query mode: prepared</font></div><div style="line-height: 22px;"   ><font size="2"   >number of clients: 16</font></div><div style="line-height: 22px;"   ><font size="2"   >number of threads: 4</font></div><div style="line-height: 22px;"   ><font size="2"   >duration: 10 s</font></div><div style="line-height: 22px;"   ><font size="2"   >number of transactions actually processed: 143258</font></div><div style="line-height: 22px;"   ><font size="2"   >tps = 14302.145681 (including connections establishing)</font></div><div style="line-height: 22px;"   ><font size="2"   >tps = 14333.252933 (excluding connections establishing)</font></div><div style="line-height: 22px;"   ><font size="2"   >statement latencies in milliseconds:</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.002230 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 1.109931 &nbsp; &nbsp; &nbsp; &nbsp;select * from ora_part_test where id=:id;</font></div><p></p></pre></div></div><div><br></div><div><span style="line-height: 22px;"   >4. Oracle测试2, PostgreSQL 代理节点, Server B :&nbsp;</span></div><div><div style="line-height: 22px;"   >外部表配置 , 同Server A , 除了以下.&nbsp;</div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >digoal=# CREATE SERVER oradb FOREIGN DATA WRAPPER oracle_fdw</font></div><div style="line-height: 22px;"   ><font size="2"   >digoal-# &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OPTIONS (dbserver '//172.16.3.67:1621/kefu');</font></div><p></p></pre></div></div><div><div style="line-height: 22px;"   ><br></div><div style="line-height: 22px;"   >测试脚本</div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >pg93@sims-&gt; cat test.sql&nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >\setrandom id 1 1999999</font></div><div style="line-height: 22px;"   ><font size="2"   >select * from ora_part_test where id=:id;</font></div><p></p></pre></div><div style="line-height: 22px;"   ><br></div></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   >测试结果(类似</span><span style="line-height: 22px;"   >PostgreSQL的</span><span style="line-height: 22px;"   >网络测试结果, 依旧多了PostgreSQL这层开销)</span></div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >pg93@sims-&gt; pgbench -M prepared -n -r -f ./test.sql -T 10 -c 16 -j 4 digoal</font></div><div style="line-height: 22px;"   ><font size="2"   >transaction type: Custom query</font></div><div style="line-height: 22px;"   ><font size="2"   >scaling factor: 1</font></div><div style="line-height: 22px;"   ><font size="2"   >query mode: prepared</font></div><div style="line-height: 22px;"   ><font size="2"   >number of clients: 16</font></div><div style="line-height: 22px;"   ><font size="2"   >number of threads: 4</font></div><div style="line-height: 22px;"   ><font size="2"   >duration: 10 s</font></div><div style="line-height: 22px;"   ><font size="2"   >number of transactions actually processed: 130146</font></div><div style="line-height: 22px;"   ><font size="2"   >tps = 13008.306581 (including connections establishing)</font></div><div style="line-height: 22px;"   ><font size="2"   >tps = 13035.169497 (excluding connections establishing)</font></div><div style="line-height: 22px;"   ><font size="2"   >statement latencies in milliseconds:</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003567 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 1.219330 &nbsp; &nbsp; &nbsp; &nbsp;select * from ora_part_test where id=:id;</font></div><p></p></pre></div></div><div style="line-height: 22px;"   >TOP :&nbsp;</div><div style="line-height: 22px;"   ><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >top - 16:30:56 up 98 days, &nbsp;6:28, &nbsp;2 users, &nbsp;load average: 1.06, 0.29, 0.10</font></div><div style="line-height: 22px;"   ><font size="2"   >Tasks: 193 total, &nbsp; 7 running, 186 sleeping, &nbsp; 0 stopped, &nbsp; 0 zombie</font></div><div style="line-height: 22px;"   ><font size="2"   >Cpu(s): 23.4%us, 10.3%sy, &nbsp;0.0%ni, 55.0%id, &nbsp;0.0%wa, &nbsp;0.6%hi, 10.7%si, &nbsp;0.0%st</font></div><div style="line-height: 22px;"   ><font size="2"   >Mem: &nbsp; 8168272k total, &nbsp;3214016k used, &nbsp;4954256k free, &nbsp; 323888k buffers</font></div><div style="line-height: 22px;"   ><font size="2"   >Swap: &nbsp;8385920k total, &nbsp; 394256k used, &nbsp;7991664k free, &nbsp;2532604k cached</font></div><div style="line-height: 22px;"   ><font size="2"   ><br style="line-height: 22px;"   ></font></div><div style="line-height: 22px;"   ><font size="2"   >&nbsp; PID USER &nbsp; &nbsp; &nbsp;PR &nbsp;NI &nbsp;VIRT &nbsp;RES &nbsp;SHR S %CPU %MEM &nbsp; &nbsp;TIME+ &nbsp;COMMAND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17663 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 104m 101m S 22.9 &nbsp;1.3 &nbsp; 0:01.36 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17671 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 105m 102m R 21.6 &nbsp;1.3 &nbsp; 0:01.33 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17681 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 103m &nbsp;99m R 21.6 &nbsp;1.3 &nbsp; 0:01.27 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17667 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 100m &nbsp;96m R 21.2 &nbsp;1.3 &nbsp; 0:01.21 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17659 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 103m &nbsp;99m S 20.9 &nbsp;1.3 &nbsp; 0:01.24 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17651 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 101m &nbsp;97m R 20.6 &nbsp;1.3 &nbsp; 0:01.21 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17657 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 101m &nbsp;97m S 20.2 &nbsp;1.3 &nbsp; 0:01.19 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17665 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 101m &nbsp;97m R 19.9 &nbsp;1.3 &nbsp; 0:01.18 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17677 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 102m &nbsp;98m R 19.9 &nbsp;1.3 &nbsp; 0:01.16 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17679 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;99m &nbsp;95m S 19.3 &nbsp;1.2 &nbsp; 0:01.12 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17655 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 100m &nbsp;97m S 18.6 &nbsp;1.3 &nbsp; 0:01.18 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17661 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 101m &nbsp;97m S 18.6 &nbsp;1.3 &nbsp; 0:01.19 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17669 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 101m &nbsp;97m S 18.6 &nbsp;1.3 &nbsp; 0:01.14 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17675 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 100m &nbsp;97m S 18.6 &nbsp;1.3 &nbsp; 0:01.14 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17653 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 100m &nbsp;97m S 17.9 &nbsp;1.3 &nbsp; 0:01.12 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div style="line-height: 22px;"   ><font size="2"   >17673 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m 100m &nbsp;97m S 17.3 &nbsp;1.3 &nbsp; 0:01.00 oraclekefu (LOCAL=NO)</font></div><p></p></pre></div><div style="line-height: 22px;"   ><br></div></div></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   >加大连接数测试 :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@sims-&gt; pgbench -M prepared -n -r -f ./test.sql -T 10 -c 64 -j 4 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 64</font></div><div><font size="2"   >number of threads: 4</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 217883</font></div><div><font size="2"   >tps = 21701.509154 (including connections establishing)</font></div><div><font size="2"   >tps = 21909.369533 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.004231 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 2.883401 &nbsp; &nbsp; &nbsp; &nbsp;select * from ora_part_test where id=:id;</font></div><p></p></pre></div><div><br></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   >TOP :&nbsp;</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >top - 16:35:56 up 98 days, &nbsp;6:33, &nbsp;2 users, &nbsp;load average: 4.67, 3.63, 1.65</font></div><div><font size="2"   >Tasks: 242 total, &nbsp;11 running, 231 sleeping, &nbsp; 0 stopped, &nbsp; 0 zombie</font></div><div><font size="2"   >Cpu(s): 43.2%us, 17.6%sy, &nbsp;0.0%ni, 27.5%id, &nbsp;0.0%wa, &nbsp;0.6%hi, 11.1%si, &nbsp;0.0%st</font></div><div><font size="2"   >Mem: &nbsp; 8168272k total, &nbsp;3531768k used, &nbsp;4636504k free, &nbsp; 323888k buffers</font></div><div><font size="2"   >Swap: &nbsp;8385920k total, &nbsp; 392944k used, &nbsp;7992976k free, &nbsp;2572976k cached</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; PID USER &nbsp; &nbsp; &nbsp;PR &nbsp;NI &nbsp;VIRT &nbsp;RES &nbsp;SHR S %CPU %MEM &nbsp; &nbsp;TIME+ &nbsp;COMMAND &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18570 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;62m &nbsp;58m S 10.6 &nbsp;0.8 &nbsp; 0:00.41 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18482 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;68m &nbsp;65m S 10.3 &nbsp;0.9 &nbsp; 0:00.49 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18476 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;69m &nbsp;65m S &nbsp;9.9 &nbsp;0.9 &nbsp; 0:00.47 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18480 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;69m &nbsp;66m S &nbsp;9.9 &nbsp;0.9 &nbsp; 0:00.47 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18522 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;66m &nbsp;62m S &nbsp;9.9 &nbsp;0.8 &nbsp; 0:00.46 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18534 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;64m &nbsp;60m S &nbsp;9.9 &nbsp;0.8 &nbsp; 0:00.44 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18538 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;67m &nbsp;63m R &nbsp;9.9 &nbsp;0.8 &nbsp; 0:00.44 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18488 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;73m &nbsp;70m S &nbsp;9.6 &nbsp;0.9 &nbsp; 0:00.46 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18536 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;65m &nbsp;61m S &nbsp;9.6 &nbsp;0.8 &nbsp; 0:00.44 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18556 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;62m &nbsp;59m S &nbsp;9.6 &nbsp;0.8 &nbsp; 0:00.41 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18592 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;60m &nbsp;56m S &nbsp;9.6 &nbsp;0.8 &nbsp; 0:00.35 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18594 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;57m &nbsp;53m S &nbsp;9.6 &nbsp;0.7 &nbsp; 0:00.35 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18486 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;67m &nbsp;64m S &nbsp;9.3 &nbsp;0.9 &nbsp; 0:00.46 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18494 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;68m &nbsp;64m S &nbsp;9.3 &nbsp;0.9 &nbsp; 0:00.45 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18508 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;67m &nbsp;63m S &nbsp;9.3 &nbsp;0.8 &nbsp; 0:00.43 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18516 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;66m &nbsp;63m S &nbsp;9.3 &nbsp;0.8 &nbsp; 0:00.42 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18518 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;65m &nbsp;62m S &nbsp;9.3 &nbsp;0.8 &nbsp; 0:00.45 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18520 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;65m &nbsp;62m S &nbsp;9.3 &nbsp;0.8 &nbsp; 0:00.45 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18552 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;65m &nbsp;61m R &nbsp;9.3 &nbsp;0.8 &nbsp; 0:00.40 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18576 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;62m &nbsp;58m S &nbsp;9.3 &nbsp;0.8 &nbsp; 0:00.38 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18584 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;61m &nbsp;57m S &nbsp;9.3 &nbsp;0.8 &nbsp; 0:00.37 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18602 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;58m &nbsp;54m S &nbsp;9.3 &nbsp;0.7 &nbsp; 0:00.33 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18484 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;67m &nbsp;64m S &nbsp;9.0 &nbsp;0.9 &nbsp; 0:00.43 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18498 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;66m &nbsp;63m R &nbsp;9.0 &nbsp;0.8 &nbsp; 0:00.41 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18504 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;65m &nbsp;61m R &nbsp;9.0 &nbsp;0.8 &nbsp; 0:00.41 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18530 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;63m &nbsp;60m S &nbsp;9.0 &nbsp;0.8 &nbsp; 0:00.40 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18546 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;61m &nbsp;57m S &nbsp;9.0 &nbsp;0.8 &nbsp; 0:00.39 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18554 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;64m &nbsp;60m S &nbsp;9.0 &nbsp;0.8 &nbsp; 0:00.37 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18578 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;59m &nbsp;55m R &nbsp;9.0 &nbsp;0.7 &nbsp; 0:00.33 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18478 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;67m &nbsp;64m S &nbsp;8.6 &nbsp;0.8 &nbsp; 0:00.44 oraclekefu (LOCAL=NO) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >18490 oracle &nbsp; &nbsp;15 &nbsp; 0 4657m &nbsp;67m &nbsp;64m S &nbsp;8.6 &nbsp;0.8 &nbsp; 0:00.43 oraclekefu (LOCAL=NO) &nbsp;</font></div><p></p></pre></div><div style="line-height: 22px;"   ><br></div></div></div><div style="line-height: 22px;"   ><span style="line-height: 22px;"   >[小结]</span></div><div>1. 本文测试非常简单, 就是使用主键检索的查询, 从测试结果来看&nbsp;</div><div>Oracle最高的tps达到了<span style="line-height: 22px;"   >21909.</span></div><div><span style="line-height: 22px;"   >PostgreSQL</span><span style="line-height: 22px;"   >最高的tps达到了</span><span style="line-height: 22px;"   >91192</span><span style="line-height: 22px;"   >.</span></div><div><span style="line-height: 22px;"   >但是由于Oracle测试时经过了一道PostgreSQL外部表, 所以这里的测试数据可比性不高, 不过从PG自身的测试来看, pg本身不应该存在瓶颈, 可能开销大在fdw这块 , 或者Oracle本身.</span></div><div><span style="line-height: 22px;"   >从第二点的测试可以看出, oracle的极限tps大概在3.1W, 性能是PostgreSQL 的1/3.</span></div><div><span style="line-height: 22px;"   >2. 为了得到Oracle的极限结果, 可以多开几个PostgreSQL代理节点. 例如加入Server C, Server D...同时使用pgbench做压力. 单服务器增加, tps不再增加时基本上就达到了Oracle的瓶颈.</span></div><div>2台pgbench+PostgreSQL fdw服务端同时测试结果如下 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >pg93@db-172-16-3-39-&gt; pgbench -M prepared -r -n -f ./test.sql -T 10 -c 32 -j 32 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 32</font></div><div><font size="2"   >number of threads: 32</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 150476</font></div><div><font size="2"   >tps = 15030.276104 (including connections establishing)</font></div><div><font size="2"   >tps = 15097.041916 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003546 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 2.109751 &nbsp; &nbsp; &nbsp; &nbsp;select * from ora_part_test where id=:id;</font></div></div><div><div><font size="2"   >pg93@sims-&gt; pgbench -M prepared -r -n -f ./test.sql -T 10 -c 32 -j 32 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 32</font></div><div><font size="2"   >number of threads: 32</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 163040</font></div><div><font size="2"   >tps = 16270.382136 (including connections establishing)</font></div><div><font size="2"   >tps = 16345.610920 (excluding connections establishing)</font></div></div><p></p></pre></div><div>两台主机相加得出31442的tps.</div><div><br></div><div><span style="line-height: 22px;"   >3台pgbench+PostgreSQL fdw服务端同时测试结果与2台结果差不多, 所以基本上已经达到了oracle的瓶颈.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg93@db-172-16-3-40-&gt; pgbench -M prepared -r -n -f ./test.sql -T 10 -c 32 -j 32 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 32</font></div><div><font size="2"   >number of threads: 32</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 118793</font></div><div><font size="2"   >tps = 11678.396544 (including connections establishing)</font></div><div><font size="2"   >tps = 11738.799302 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003613 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 2.674441 &nbsp; &nbsp; &nbsp; &nbsp;select * from ora_part_test where id=:id;</font></div><div><font size="2"   >pg93@db-172-16-3-40-&gt; pgbench -M prepared -r -n -f ./test.sql -T 10 -c 16 -j 8 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 16</font></div><div><font size="2"   >number of threads: 8</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 95734</font></div><div><font size="2"   >tps = 9566.060918 (including connections establishing)</font></div><div><font size="2"   >tps = 9587.172573 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003193 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 1.660793 &nbsp; &nbsp; &nbsp; &nbsp;select * from ora_part_test where id=:id;</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >pg93@db-172-16-3-39-&gt; pgbench -M prepared -r -n -f ./test.sql -T 10 -c 32 -j 32 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 32</font></div><div><font size="2"   >number of threads: 32</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 107971</font></div><div><font size="2"   >tps = 10777.601164 (including connections establishing)</font></div><div><font size="2"   >tps = 10819.936118 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003592 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 2.944798 &nbsp; &nbsp; &nbsp; &nbsp;select * from ora_part_test where id=:id;</font></div><div><font size="2"   >pg93@db-172-16-3-39-&gt; pgbench -M prepared -r -n -f ./test.sql -T 10 -c 16 -j 8 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 16</font></div><div><font size="2"   >number of threads: 8</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 104481</font></div><div><font size="2"   >tps = 10442.999639 (including connections establishing)</font></div><div><font size="2"   >tps = 10469.137077 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003401 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 1.520452 &nbsp; &nbsp; &nbsp; &nbsp;select * from ora_part_test where id=:id;</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >pg93@sims-&gt; pgbench -M prepared -r -n -f ./test.sql -T 10 -c 32 -j 32 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 32</font></div><div><font size="2"   >number of threads: 32</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 92645</font></div><div><font size="2"   >tps = 9246.452773 (including connections establishing)</font></div><div><font size="2"   >tps = 9285.967241 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003388 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 3.434297 &nbsp; &nbsp; &nbsp; &nbsp;select * from ora_part_test where id=:id;</font></div><div><font size="2"   >pg93@sims-&gt; pgbench -M prepared -r -n -f ./test.sql -T 10 -c 16 -j 8 digoal</font></div><div><font size="2"   >transaction type: Custom query</font></div><div><font size="2"   >scaling factor: 1</font></div><div><font size="2"   >query mode: prepared</font></div><div><font size="2"   >number of clients: 16</font></div><div><font size="2"   >number of threads: 8</font></div><div><font size="2"   >duration: 10 s</font></div><div><font size="2"   >number of transactions actually processed: 111006</font></div><div><font size="2"   >tps = 11095.514926 (including connections establishing)</font></div><div><font size="2"   >tps = 11121.780736 (excluding connections establishing)</font></div><div><font size="2"   >statement latencies in milliseconds:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 0.003529 &nbsp; &nbsp; &nbsp; &nbsp;\setrandom id 1 1999999</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 1.431322 &nbsp; &nbsp; &nbsp; &nbsp;select * from ora_part_test where id=:id;</font></div></div><p></p></pre></div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 22px;" href="http://blog.163.com/digoal@126/blog/static/163877040201362355123969/"   >http://blog.163.com/digoal@126/blog/static/163877040201362355123969/</a></div><div>2.&nbsp;<a style="line-height: 22px;" rel="nofollow" href="http://pgxn.org/dist/oracle_fdw/"   >http://pgxn.org/dist/oracle_fdw/</a></div></div>
	</div>
</div>
</body>
</html>