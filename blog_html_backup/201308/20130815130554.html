<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL attention : max_standby_archive_delay and max_standby_streaming_delay</h2>
	<h5 id="">2013-08-15 13:05:54&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201371501830526/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>今天群里的兄弟提到的一个疑问,&nbsp;</div><div>max_standby_archive_delay = -1</div><div>max_standby_streaming_delay = -1</div><div>不知道有什么影响?</div><div>这两个参数控制了recovery时是否要kill掉hot_standby上与recovery冲突的sql.</div><div>如果配置为-1, 那么在hot_standby上可以无限时常的执行sql. 后果是standby只接收但是不recovery xlog. 造成standby xlog文件越来越多, 甚至撑爆磁盘分区. 还有就是造成了standby的延迟.&nbsp;</div><div>所以在设置是需要小心.</div><div><br></div><div>为了便于理解, 下面将测试过程展示一下 :&nbsp;</div><div>(primary and standby)安装PostgreSQL :&nbsp;</div><pre class="prettyprint"   ><p><font size="2"   >tar -zxvf postgresql-1b1d3d9.tar.gz<wbr></font></p><div><font size="2"   >cd postgresql-1b1d3d9</font></div><div><font size="2"   >./configure --prefix=/home/pg94/pgsql9.4devel --with-pgport=2999 --with-perl --with-tcl --with-python --with-openssl --with-pam --without-ldap --with-libxml --with-libxslt --enable-thread-safety --with-wal-blocksize=16 --enable-dtrace &amp;&amp; gmake &amp;&amp; gmake install</font></div><div><font size="2"   >cd contrib/</font></div><div><font size="2"   >gmake &amp;&amp; gmake install</font></div><p></p></pre><div>(primary)初始化数据库</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >su - pg94</font></div><div><font size="2"   >initdb -D $PGDATA -E UTF8 --locale=C -W -U postgres</font></div><p></p></pre></div><div><br></div><div>(primary)配置</div><div><div>pg94@db-172-16-3-33-&gt; grep "^[a-z]" postgresql.conf&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >listen_addresses = '0.0.0.0' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# what IP address(es) to listen on;</font></div><div><font size="2"   >port = 2999 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >max_connections = 100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >superuser_reserved_connections = 13 &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >unix_socket_directories = '.' &nbsp; # comma-separated list of directories</font></div><div><font size="2"   >unix_socket_permissions = 0700 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# begin with 0 to use octal notation</font></div><div><font size="2"   >shared_buffers = 1024MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 128kB</font></div><div><font size="2"   >maintenance_work_mem = 512MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# min 1MB</font></div><div><font size="2"   >shared_preload_libraries = 'pg_stat_statements' &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >wal_level = hot_standby &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # minimal, archive, or hot_standby</font></div><div><font size="2"   >synchronous_commit = off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# synchronization level;</font></div><div><font size="2"   >wal_sync_method = fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # the default is the first option</font></div><div><font size="2"   >wal_buffers = 16384kB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 32kB, -1 sets based on shared_buffers</font></div><div><font size="2"   >wal_writer_delay = 20ms &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 milliseconds</font></div><div><font size="2"   >checkpoint_segments = 32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# in logfile segments, min 1, 16MB each</font></div><div><font size="2"   >max_wal_senders = 32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# max number of walsender processes</font></div><div><font size="2"   >wal_keep_segments = 128 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# in logfile segments, 16MB each; 0 disables</font></div><div><font size="2"   >hot_standby = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# "on" allows queries during recovery</font></div><div><font size="2"   >max_standby_archive_delay = -1 &nbsp;# max delay before canceling queries</font></div><div><font size="2"   >max_standby_streaming_delay = -1 &nbsp; &nbsp; &nbsp; &nbsp;# max delay before canceling queries</font></div><div><font size="2"   >wal_receiver_status_interval = 1s &nbsp; &nbsp; &nbsp; # send replies at least this often</font></div><div><font size="2"   >hot_standby_feedback = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # send info from standby to prevent</font></div><div><font size="2"   >random_page_cost = 1.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# same scale as above</font></div><div><font size="2"   >effective_cache_size = 10240MB</font></div><div><font size="2"   >log_destination = 'csvlog' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Valid values are combinations of</font></div><div><font size="2"   >logging_collector = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Enable capturing of stderr and csvlog</font></div><div><font size="2"   >log_directory = 'pg_log' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# directory where log files are written,</font></div><div><font size="2"   >log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # log file name pattern,</font></div><div><font size="2"   >log_file_mode = 0600 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# creation mode for log files,</font></div><div><font size="2"   >log_truncate_on_rotation = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # If on, an existing log file with the</font></div><div><font size="2"   >log_rotation_age = 1d &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Automatic rotation of logfiles will</font></div><div><font size="2"   >log_rotation_size = 10MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Automatic rotation of logfiles will</font></div><div><font size="2"   >log_checkpoints = on</font></div><div><font size="2"   >log_connections = on</font></div><div><font size="2"   >log_disconnections = on</font></div><div><font size="2"   >log_error_verbosity = verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # terse, default, or verbose messages</font></div><div><font size="2"   >log_lock_waits = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # log lock waits &gt;= deadlock_timeout</font></div><div><font size="2"   >log_statement = 'ddl' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # none, ddl, mod, all</font></div><div><font size="2"   >log_timezone = 'PRC'</font></div><div><font size="2"   >track_activity_query_size = 2048 &nbsp; &nbsp; &nbsp; &nbsp;# (change requires restart)</font></div><div><font size="2"   >autovacuum = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Enable autovacuum subprocess? &nbsp;'on'</font></div><div><font size="2"   >log_autovacuum_min_duration = 0 # -1 disables, 0 logs all actions and</font></div><div><font size="2"   >datestyle = 'iso, mdy'</font></div><div><font size="2"   >timezone = 'PRC'</font></div><div><font size="2"   >lc_messages = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for system error message</font></div><div><font size="2"   >lc_monetary = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for monetary formatting</font></div><div><font size="2"   >lc_numeric = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# locale for number formatting</font></div><div><font size="2"   >lc_time = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for time formatting</font></div><div><font size="2"   >default_text_search_config = 'pg_catalog.english'</font></div><div><font size="2"   >pg_stat_statements.max = 1000</font></div><div><font size="2"   >pg_stat_statements.track = all</font></div><p></p></pre></div></div><div><br></div><div><div>pg94@db-172-16-3-33-&gt; grep "^[a-z]" pg_hba.conf&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >local &nbsp; all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trust</font></div><div><font size="2"   >host &nbsp; &nbsp;all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 127.0.0.1/32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;trust</font></div><div><font size="2"   >host &nbsp; &nbsp;all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; all &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ::1/128 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trust</font></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div><div><font size="2"   >host replication postgres 172.16.3.0/24 md5</font></div><p></p></pre></div><div><br></div><div>pg94@db-172-16-3-33-&gt; grep "^[a-z]" recovery.done&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >recovery_target_timeline = 'latest'</font></div><div><font size="2"   >standby_mode = on</font></div><div><font size="2"   >primary_conninfo = 'host=172.16.3.39 port=2999 user=postgres keepalives_idle=60' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# e.g. 'host=localhost port=5432'</font></div><p></p></pre></div></div><div><br></div><div>standby配置 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >pg94@db-172-16-3-39-&gt; vi ~/.pgpass&nbsp;</font></div><div><font size="2"   >172.16.3.33:2999:replication:postgres:postgres</font></div></div><div><font size="2"   >pg94@db-172-16-3-39-&gt; chmod 400 ~/.pgpass</font></div><div><font size="2"   >-- 复制节点</font></div><div><font size="2"   >pg94@db-172-16-3-39-&gt; pg_basebackup -D $PGDATA -F p -P -v -U postgres -h 172.16.3.33</font></div><div><div><font size="2"   >pg94@db-172-16-3-39-&gt; cd $PGDATA</font></div><div><font size="2"   >pg94@db-172-16-3-39-&gt; mv recovery.done recovery.conf</font></div></div><div><font size="2"   >pg94@db-172-16-3-39-&gt; vi recovery.conf</font></div><div><font size="2"   >primary_conninfo = 'host=172.16.3.33 port=2999 user=postgres keepalives_idle=60'</font></div><p></p></pre></div><div><br></div><div>启动standby :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg94@db-172-16-3-39-&gt; pg_ctl start</font></div><div></div><p></p></pre></div><div><br></div><div>(primary)创建测试表 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >pg94@db-172-16-3-33-&gt; psql postgres postgres</font></div><div><font size="2"   >psql (9.4devel)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >postgres=# create database digoal;</font></div><div><font size="2"   >CREATE DATABASE</font></div></div><div><font size="2"   >\c digoal&nbsp;</font></div><div><div><font size="2"   >digoal=# create table t1 (id int);</font></div><div><font size="2"   >CREATE TABLE</font></div><div><font size="2"   >digoal=# insert into t1 values (1);</font></div><div><font size="2"   >INSERT 0 1</font></div></div><p></p></pre></div><div><br></div><div>(standby)开启repeatable read查询</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# begin transaction isolation level repeatable read;</font></div><div><font size="2"   >BEGIN</font></div><div><font size="2"   >digoal=# select * from t1;</font></div><div><font size="2"   >&nbsp;id&nbsp;</font></div><div><font size="2"   >----</font></div><div><font size="2"   >&nbsp; 1</font></div><div><font size="2"   >(1 row)</font></div></div><div><font size="2"   >-- 不要退出事务.</font></div><p></p></pre></div><div><br></div><div>(primary)删除t1表.</div><div>删除t1表后, 这部分xlog信息在standby上面做恢复时将和standby上面的事务冲突.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# drop table t1;</font></div><div><font size="2"   >DROP TABLE</font></div><p></p></pre></div><div>查看standby的replay_location, 这个指的是恢复点.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select * from pg_stat_replication ;</font></div><div><font size="2"   >-[ RECORD 1 ]----+------------------------------</font></div><div><font size="2"   >pid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 5436</font></div><div><font size="2"   >usesysid &nbsp; &nbsp; &nbsp; &nbsp; | 10</font></div><div><font size="2"   >usename &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| postgres</font></div><div><font size="2"   >application_name | walreceiver</font></div><div><font size="2"   >client_addr &nbsp; &nbsp; &nbsp;| 172.16.3.39</font></div><div><font size="2"   >client_hostname &nbsp;|&nbsp;</font></div><div><font size="2"   >client_port &nbsp; &nbsp; &nbsp;| 22422</font></div><div><font size="2"   >backend_start &nbsp; &nbsp;| 2013-08-15 12:36:18.844357+08</font></div><div><font size="2"   >state &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| streaming</font></div><div><font size="2"   >sent_location &nbsp; &nbsp;| 0/3012680</font></div><div><font size="2"   >write_location &nbsp; | 0/3012680</font></div><div><font size="2"   >flush_location &nbsp; | 0/3012680</font></div><div><font size="2"   >replay_location &nbsp;| 0/3012140</font></div><div><font size="2"   >sync_priority &nbsp; &nbsp;| 0</font></div><div><font size="2"   >sync_state &nbsp; &nbsp; &nbsp; | async</font></div><p></p></pre></div><div><br></div><div>(primary)执行大量的写操作, 意为产生大量的pg_xlog.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# create table test(id int, info text, crt_time timestamp);</font></div><div><font size="2"   >CREATE TABLE</font></div></div><div><div><font size="2"   >digoal=# insert into test select generate_series(1,1000000),'test',now();</font></div><div><font size="2"   >INSERT 0 1000000</font></div><div><font size="2"   >digoal=# checkpoint;</font></div><div><font size="2"   >CHECKPOINT</font></div></div><p></p></pre></div><div>查询<span style="line-height: 22px;"   >standby的replay_location, 这个指的是恢复点.&nbsp;</span></div><div><span style="line-height: 22px;"   >从write_location看出, 数据在发给standby, 但是standby的replay_location不变. 也就是说现在standby只接收xlog, 但是没有将接收到的xlog做recovery处理.</span></div><div><span style="line-height: 22px;"   >因为在standby上设置了如下参数 :&nbsp;</span></div><div><div style="line-height: 22px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 22px;"   ><font size="2"   >max_standby_archive_delay = -1 &nbsp;# max delay before canceling queries</font></div><div style="line-height: 22px;"   ><font size="2"   >max_standby_streaming_delay = -1 &nbsp; &nbsp; &nbsp; &nbsp;# max delay before canceling queries</font></div><p></p></pre></div></div><div style="line-height: 22px;"   >这个查询和recovery冲突时, 不会被kill掉, recovery将持续等待.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# select * from pg_stat_replication ;</font></div><div><font size="2"   >-[ RECORD 1 ]----+------------------------------</font></div><div><font size="2"   >pid &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 5436</font></div><div><font size="2"   >usesysid &nbsp; &nbsp; &nbsp; &nbsp; | 10</font></div><div><font size="2"   >usename &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| postgres</font></div><div><font size="2"   >application_name | walreceiver</font></div><div><font size="2"   >client_addr &nbsp; &nbsp; &nbsp;| 172.16.3.39</font></div><div><font size="2"   >client_hostname &nbsp;|&nbsp;</font></div><div><font size="2"   >client_port &nbsp; &nbsp; &nbsp;| 22422</font></div><div><font size="2"   >backend_start &nbsp; &nbsp;| 2013-08-15 12:36:18.844357+08</font></div><div><font size="2"   >state &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| streaming</font></div><div><font size="2"   >sent_location &nbsp; &nbsp;| 0/8CA2BA0</font></div><div><font size="2"   >write_location &nbsp; | 0/8CA2BA0</font></div><div><font size="2"   >flush_location &nbsp; | 0/8CA2BA0</font></div><div><font size="2"   >replay_location &nbsp;| 0/3012140</font></div><div><font size="2"   >sync_priority &nbsp; &nbsp;| 0</font></div><div><font size="2"   >sync_state &nbsp; &nbsp; &nbsp; | async</font></div><p></p></pre></div><div><br></div><div>(standby)开启另外一个会话, 查询是否存在test表.</div><div>显然不可能存在, 因为pg_xlog只接收, 却为recovery. 所以standby和primary延迟也随着时间越来越大.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg94@db-172-16-3-39-&gt; psql</font></div><div><font size="2"   >psql (9.4devel)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# \dt</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; List of relations</font></div><div><font size="2"   >&nbsp;Schema | Name | Type &nbsp;| &nbsp;Owner &nbsp;&nbsp;</font></div><div><font size="2"   >--------+------+-------+----------</font></div><div><font size="2"   >&nbsp;public | t1 &nbsp; | table | postgres</font></div><div><font size="2"   >(1 row)</font></div><p></p></pre></div>代码如下 :&nbsp;<div>1. src/backend/storage/ipc/standby.c<br><div><pre class="prettyprint"   ><p></p><div><font size="2"   >/*</font></div><div><font size="2"   >&nbsp;* Determine the cutoff time at which we want to start canceling conflicting</font></div><div><font size="2"   >&nbsp;* transactions. &nbsp;Returns zero (a time safely in the past) if we are willing</font></div><div><font size="2"   >&nbsp;* to wait forever.</font></div><div><font size="2"   >&nbsp;*/</font></div><div><font size="2"   >static TimestampTz</font></div><div><font size="2"   >GetStandbyLimitTime(void)</font></div><div><font size="2"   >{</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; TimestampTz rtime;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; bool &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fromStream;</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /*</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* The cutoff time is the last WAL data receipt time plus the appropriate</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* delay variable. &nbsp;Delay of -1 means wait forever.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; GetXLogReceiptTime(&amp;rtime, &amp;fromStream);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if (fromStream)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (max_standby_streaming_delay &lt; 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* wait forever */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return TimestampTzPlusMilliseconds(rtime, max_standby_streaming_delay);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; else</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (max_standby_archive_delay &lt; 0)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* wait forever */ &nbsp;// 小于0永久等待.</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return TimestampTzPlusMilliseconds(rtime, max_standby_archive_delay);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; }</font></div><div><font size="2"   >}</font></div><p></p></pre></div><div><br></div></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL attention : max_standby_archive_delay and max_standby_streaming_delay - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
</div>
</body>
</html>