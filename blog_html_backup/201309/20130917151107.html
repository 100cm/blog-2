<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL pending patch : before or after statement-level Triggers on foreign tables</h2>
	<h5 id="">2013-09-17 15:11:07&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201381712537649/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Hello.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >I wanted to know what it would take to implement triggers on foreign tables.&nbsp;</font></div><div><font size="2"   >It seems that statement-level triggers can work provided they are allowed in&nbsp;</font></div><div><font size="2"   >the code.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Please find attached a simple POC patch that implement just that.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >For row-level triggers, it seems more complicated. From what I understand,&nbsp;</font></div><div><font size="2"   >OLD/NEW tuples are fetched from the heap using their ctid (except for BEFORE&nbsp;</font></div><div><font size="2"   >INSERT triggers). How could this be adapted for foreign tables ?</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >--</font></div><div><font size="2"   >Ronan Dunklau</font></div><p></p></pre></div><div>PostgreSQL 的一个外部表触发器补丁, 目前仅支持语句级别的触发器, 无法做到行级触发.</div><div>补丁安装 :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >[root@db-172-16-3-39 postgresql-1b1d3d9]# wget http://www.postgresql.org/message-id/attachment/30159/foreign_triggers_v2.patch</font></div><div><div><font size="2"   >[root@db-172-16-3-39 postgresql-1b1d3d9]# patch -p1 &lt; foreign_triggers_v2.patch&nbsp;</font></div><div><font size="2"   >patching file doc/src/sgml/ref/create_trigger.sgml</font></div><div><font size="2"   >patching file doc/src/sgml/trigger.sgml</font></div><div><font size="2"   >patching file src/backend/commands/tablecmds.c</font></div><div><font size="2"   >patching file src/backend/commands/trigger.c</font></div><div><font size="2"   >patching file src/test/regress/expected/foreign_data.out</font></div><div><font size="2"   >patching file src/test/regress/sql/foreign_data.sql</font></div><div><font size="2"   >[root@db-172-16-3-39 postgresql-1b1d3d9]# gmake</font></div></div><div><span style="line-height: 23px;"   ><font size="2"   >[root@db-172-16-3-39 postgresql-1b1d3d9]# gmake install</font></span></div><p></p></pre></div><div><span style="line-height: 23px;"   ><br></span></div><div><span style="line-height: 23px;"   >测试, 创建postgres_fdw模块 :&nbsp;</span></div><div><div style="line-height: 23px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 23px;"   ><font size="2"   >[root@db-172-16-3-39 postgresql-1b1d3d9]# su - pg94</font></div><div style="line-height: 23px;"   ><font size="2"   >pg94@db-172-16-3-39-&gt; pg_ctl restart -m fast</font></div><div><div><font size="2"   >pg94@db-172-16-3-39-&gt; psql</font></div><div><font size="2"   >psql (9.4devel)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >digoal=# create extension postgres_fdw;</font></div><div><font size="2"   >CREATE EXTENSION</font></div></div><p></p></pre></div></div><div>测试用到postgres_fdw这个可写外部表模块.</div><div>有兴趣的同学可参考</div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402013214103144414/"   >http://blog.163.com/digoal@126/blog/static/1638770402013214103144414/</a></div><div>创建server</div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# CREATE SERVER myserver FOREIGN DATA WRAPPER postgres_fdw OPTIONS (host '127.0.0.1', dbname 'digoal', port '2999', updatable 'true');</font></div><div></div><p></p></pre><div><span style="line-height: 23px;"   >创建user mapping</span></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# create role digoal superuser login encrypted password 'digoal';</font></div><div><font size="2"   >CREATE ROLE</font></div><div><font size="2"   >digoal=# CREATE USER MAPPING FOR digoal SERVER myserver OPTIONS (user 'digoal', password 'digoal');</font></div><div><font size="2"   >CREATE USER MAPPING</font></div></div><div><font size="2"   >digoal=# \c digoal digoal</font></div><p></p></pre></div><div>创建测试表</div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create table t1(id int primary key, info text, crt_time timestamp);</font></div><div></div><p></p></pre><div><span style="line-height: 23px;"   >创建可写外部表</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# CREATE FOREIGN TABLE f_t1(id int, info text, crt_time timestamp) server myserver options (schema_name 'public', table_name 't1');</font></div><div><div><font size="2"   >digoal=# insert into f_t1 values (1,'test',now());</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# select * from t1;</font></div><div><font size="2"   >&nbsp;id | info | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----+------+----------------------------</font></div><div><font size="2"   >&nbsp; 1 | test | 2013-09-17 14:44:04.445224</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select * from f_t1;</font></div><div><font size="2"   >&nbsp;id | info | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----+------+----------------------------</font></div><div><font size="2"   >&nbsp; 1 | test | 2013-09-17 14:44:04.445224</font></div><div><font size="2"   >(1 row)</font></div></div><p></p></pre></div><div>创建记录表(触发器中使用)</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create table tg_log(id serial8 primary key, crt_time timestamp default clock_timestamp(), tg_name name, tg_when text, tg_level text, tg_op text, tg_relid oid, tg_relname name, tg_table_name name, tg_table_schema name, tg_nargs int, tg_argv text);</font></div><div><font size="2"   >CREATE TABLE</font></div><p></p></pre></div><div><br></div><div>创建触发器函数</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create or replace function f_tg() returns trigger as $$</font></div><div><font size="2"   >declare</font></div><div><font size="2"   >begin&nbsp;</font></div><div><font size="2"   >&nbsp; insert into tg_log (tg_name, tg_when, tg_level, tg_op, tg_relid, tg_relname, tg_table_name, tg_table_schema, tg_nargs, tg_argv)&nbsp;</font></div><div><font size="2"   >&nbsp; values (tg_name, tg_when, tg_level, tg_op, tg_relid, tg_relname, tg_table_name, tg_table_schema, tg_nargs, tg_argv);</font></div><div><font size="2"   >&nbsp; return null;</font></div><div><font size="2"   >-- statement-level触发器函数直接返回null</font></div><div><font size="2"   >end;</font></div><div><font size="2"   >$$ language plpgsql strict;</font></div><p></p></pre></div><div>对触发器有兴趣的同学可以参考</div><div><a href="http://blog.163.com/digoal@126/blog/static/1638770402013283547959/"   >http://blog.163.com/digoal@126/blog/static/1638770402013283547959/</a></div><div><br></div><div>创建触发器</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# create trigger tg1 before insert or update or delete on f_t1 execute procedure f_tg();</font></div><div><font size="2"   >CREATE TRIGGER</font></div><div><font size="2"   >digoal=# create trigger tg2 after insert or update or delete on f_t1 execute procedure f_tg();</font></div><div><font size="2"   >CREATE TRIGGER</font></div><p></p></pre></div><div><br></div><div>测试</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >digoal=# insert into f_t1 values (2,'text',now());</font></div><div><font size="2"   >INSERT 0 1</font></div><div><font size="2"   >digoal=# select * from f_t1;</font></div><div><font size="2"   >&nbsp;id | info | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----+------+----------------------------</font></div><div><font size="2"   >&nbsp; 2 | text | 2013-09-17 15:06:15.373727</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select * from t1;</font></div><div><font size="2"   >&nbsp;id | info | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----+------+----------------------------</font></div><div><font size="2"   >&nbsp; 2 | text | 2013-09-17 15:06:15.373727</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select * from tg_log;</font></div><div><font size="2"   >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| tg_name | tg_when | tg_level &nbsp;| tg_op &nbsp;| tg_relid | tg_relname | tg_table_name | tg_table_schema&nbsp;</font></div><div><font size="2"   >| tg_nargs | tg_argv&nbsp;</font></div><div><font size="2"   >----+----------------------------+---------+---------+-----------+--------+----------+------------+---------------+-----------------</font></div><div><font size="2"   >+----------+---------</font></div><div><font size="2"   >&nbsp;10 | 2013-09-17 15:06:15.374379 | tg1 &nbsp; &nbsp; | BEFORE &nbsp;| STATEMENT | INSERT | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >&nbsp;11 | 2013-09-17 15:06:15.375116 | tg2 &nbsp; &nbsp; | AFTER &nbsp; | STATEMENT | INSERT | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >(2 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# update f_t1 set info='new';</font></div><div><font size="2"   >UPDATE 1</font></div><div><font size="2"   >digoal=# select * from t1;</font></div><div><font size="2"   >&nbsp;id | info | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----+------+----------------------------</font></div><div><font size="2"   >&nbsp; 2 | new &nbsp;| 2013-09-17 15:06:15.373727</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select * from f_t1;</font></div><div><font size="2"   >&nbsp;id | info | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >----+------+----------------------------</font></div><div><font size="2"   >&nbsp; 2 | new &nbsp;| 2013-09-17 15:06:15.373727</font></div><div><font size="2"   >(1 row)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select * from tg_log;</font></div><div><font size="2"   >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| tg_name | tg_when | tg_level &nbsp;| tg_op &nbsp;| tg_relid | tg_relname | tg_table_name | tg_table_schema&nbsp;</font></div><div><font size="2"   >| tg_nargs | tg_argv&nbsp;</font></div><div><font size="2"   >----+----------------------------+---------+---------+-----------+--------+----------+------------+---------------+-----------------</font></div><div><font size="2"   >+----------+---------</font></div><div><font size="2"   >&nbsp;10 | 2013-09-17 15:06:15.374379 | tg1 &nbsp; &nbsp; | BEFORE &nbsp;| STATEMENT | INSERT | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >&nbsp;11 | 2013-09-17 15:06:15.375116 | tg2 &nbsp; &nbsp; | AFTER &nbsp; | STATEMENT | INSERT | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >&nbsp;12 | 2013-09-17 15:06:52.176488 | tg1 &nbsp; &nbsp; | BEFORE &nbsp;| STATEMENT | UPDATE | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >&nbsp;13 | 2013-09-17 15:06:52.178111 | tg2 &nbsp; &nbsp; | AFTER &nbsp; | STATEMENT | UPDATE | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >(4 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# delete from f_t1;</font></div><div><font size="2"   >DELETE 1</font></div><div><font size="2"   >digoal=# select * from f_t1;</font></div><div><font size="2"   >&nbsp;id | info | crt_time&nbsp;</font></div><div><font size="2"   >----+------+----------</font></div><div><font size="2"   >(0 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select * from t1;</font></div><div><font size="2"   >&nbsp;id | info | crt_time&nbsp;</font></div><div><font size="2"   >----+------+----------</font></div><div><font size="2"   >(0 rows)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >digoal=# select * from tg_log;</font></div><div><font size="2"   >&nbsp;id | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;crt_time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| tg_name | tg_when | tg_level &nbsp;| tg_op &nbsp;| tg_relid | tg_relname | tg_table_name | tg_table_schema&nbsp;</font></div><div><font size="2"   >| tg_nargs | tg_argv&nbsp;</font></div><div><font size="2"   >----+----------------------------+---------+---------+-----------+--------+----------+------------+---------------+-----------------</font></div><div><font size="2"   >+----------+---------</font></div><div><font size="2"   >&nbsp;10 | 2013-09-17 15:06:15.374379 | tg1 &nbsp; &nbsp; | BEFORE &nbsp;| STATEMENT | INSERT | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >&nbsp;11 | 2013-09-17 15:06:15.375116 | tg2 &nbsp; &nbsp; | AFTER &nbsp; | STATEMENT | INSERT | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >&nbsp;12 | 2013-09-17 15:06:52.176488 | tg1 &nbsp; &nbsp; | BEFORE &nbsp;| STATEMENT | UPDATE | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >&nbsp;13 | 2013-09-17 15:06:52.178111 | tg2 &nbsp; &nbsp; | AFTER &nbsp; | STATEMENT | UPDATE | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >&nbsp;14 | 2013-09-17 15:07:13.009584 | tg1 &nbsp; &nbsp; | BEFORE &nbsp;| STATEMENT | DELETE | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >&nbsp;15 | 2013-09-17 15:07:13.010709 | tg2 &nbsp; &nbsp; | AFTER &nbsp; | STATEMENT | DELETE | &nbsp; &nbsp;24990 | f_t1 &nbsp; &nbsp; &nbsp; | f_t1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| public &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div><div><font size="2"   >| &nbsp; &nbsp; &nbsp; &nbsp;0 |&nbsp;</font></div><div><font size="2"   >(6 rows)</font></div><p></p></pre></div><div>[注意]</div><div>1. 创建外部表时, 如果在本地创建的话, 请务必指定schema_name和table_name, 否则插入外部表的时候会造成死循环.</div><div>foreign table -&gt; foreign table ... ...</div><div>例如</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >digoal=# create extension postgres_fdw;</font></div><div><font size="2"   >CREATE EXTENSION</font></div><div><font size="2"   >digoal=# CREATE SERVER myserver FOREIGN DATA WRAPPER postgres_fdw OPTIONS (host '127.0.0.1', dbname 'digoal', port '2999', updatable 'on');</font></div><div><font size="2"   >CREATE SERVER</font></div><div><font size="2"   >digoal=# CREATE USER MAPPING FOR digoal SERVER myserver OPTIONS (user 'digoal', password 'digoal');</font></div><div><font size="2"   >CREATE USER MAPPING</font></div><div><font size="2"   >digoal=# create table t1 (id int primary key, info text, crt_time timestamp);</font></div><div><font size="2"   >CREATE TABLE</font></div></div><div><div><font size="2"   >digoal=# CREATE FOREIGN TABLE f_t1(id int, info text, crt_time timestamp) server myserver;</font></div><div><font size="2"   >CREATE FOREIGN TABLE</font></div><div><font size="2"   >digoal=# insert into f_t1 values (1,'test',now());</font></div><div><font size="2"   >ERROR: &nbsp;could not connect to server "myserver"</font></div><div><font size="2"   >DETAIL: &nbsp;FATAL: &nbsp;sorry, too many clients already</font></div><div><font size="2"   >CONTEXT: &nbsp;Remote SQL command: INSERT INTO public.f_t1(id, info, crt_time) VALUES ($1, $2, $3)</font></div><div><font size="2"   >Remote SQL command: INSERT INTO public.f_t1(id, info, crt_time) VALUES ($1, $2, $3)</font></div><div><font size="2"   >Remote SQL command: INSERT INTO public.f_t1(id, info, crt_time) VALUES ($1, $2, $3)</font></div></div><div><font size="2"   >....</font></div><p></p></pre></div><div>.... 直到连接耗尽.</div><div>原因是外部表支持更新, 并且创建外部表时未指定table_name和schema_name, 同时连接的又是当前数据库.</div><div>那么会进入一个死循环.</div><div><br></div>[参考]<wbr><div>1.&nbsp;<a style="line-height: 23px;" rel="nofollow" href="http://www.postgresql.org/message-id/flat/1553612.aNJakFASte@ronan_laptop#1553612.aNJakFASte@ronan_laptop"   >http://www.postgresql.org/message-id/flat/1553612.aNJakFASte@ronan_laptop#1553612.aNJakFASte@ronan_laptop</a></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >+ &nbsp; &nbsp;On foreign tables, trigger can be defined to execute either before or after any</font></div><div><font size="2"   >+ &nbsp; &nbsp;&lt;command&gt;INSERT&lt;/command&gt;,</font></div><div><font size="2"   >+ &nbsp; &nbsp;&lt;command&gt;UPDATE&lt;/command&gt; or</font></div><div><font size="2"   >+ &nbsp; &nbsp;&lt;command&gt;DELETE&lt;/command&gt; operation, only once per &lt;acronym&gt;SQL&lt;/acronym&gt; statement.</font></div><div><font size="2"   >+ &nbsp; &nbsp;This means that row-level triggers are not supported for foreign tables.</font></div><div><font size="2"   >+ &nbsp; &lt;/para&gt;</font></div><p></p></pre></div><div><font size="2"   >2.&nbsp;</font><a style="line-height: 23px;" href="http://blog.163.com/digoal@126/blog/static/1638770402013214103144414/"   >http://blog.163.com/digoal@126/blog/static/1638770402013214103144414/</a></div><div>3.&nbsp;<a style="line-height: 23px;" href="http://blog.163.com/digoal@126/blog/static/163877040201312544919858/"   >http://blog.163.com/digoal@126/blog/static/163877040201312544919858/</a></div><div>4.&nbsp;<a style="line-height: 23px;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/libpq-connect.html"   >http://www.postgresql.org/docs/devel/static/libpq-connect.html</a></div><div>5.&nbsp;<a style="line-height: 23px;" rel="nofollow" href="http://www.postgresql.org/docs/devel/static/postgres-fdw.html"   >http://www.postgresql.org/docs/devel/static/postgres-fdw.html</a></div><div>6.&nbsp;<a style="line-height: 23px;" href="http://blog.163.com/digoal@126/blog/static/1638770402013283547959/"   >http://blog.163.com/digoal@126/blog/static/1638770402013283547959/</a></div><div>7.&nbsp;<a style="line-height: 23px;" href="http://blog.163.com/digoal@126/blog/static/1638770402013211102130526/"   >http://blog.163.com/digoal@126/blog/static/1638770402013211102130526/</a></div><div>8. 可用的postgres_fdw OPTIONS</div><div><pre class="prettyprint"   ><p><font size="2"   >HINT: &nbsp;Valid options in this context are: service, connect_timeout, dbname, host, hostaddr, port, application_name, keepalives, keepalives_idle, keepalives_interval, keepalives_count, sslmode, sslcompression, sslcert, sslkey, sslrootcert, sslcrl, requirepeer, use_remote_estimate, fdw_startup_cost, fdw_tuple_cost, updatable</font></p></pre></div><div>非libpq部分options :&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; /* non-libpq FDW-specific FDW options */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; static const PgFdwOption non_libpq_options[] = {</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {"schema_name", ForeignTableRelationId, false},</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {"table_name", ForeignTableRelationId, false},</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {"column_name", AttributeRelationId, false},</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* use_remote_estimate is available on both server and table */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {"use_remote_estimate", ForeignServerRelationId, false},</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {"use_remote_estimate", ForeignTableRelationId, false},</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* cost factors */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {"fdw_startup_cost", ForeignServerRelationId, false},</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {"fdw_tuple_cost", ForeignServerRelationId, false},</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* updatable is available on both server and table */</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {"updatable", ForeignServerRelationId, false},</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {"updatable", ForeignTableRelationId, false},</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {NULL, InvalidOid, false}</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; };</font></div><p></p></pre></div></div>
	</div>
</div>
</body>
</html>