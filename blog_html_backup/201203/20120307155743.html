<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Ruby Study 9 : Passing Arguments and Returning Values</h2>
	<h5 id="">2012-03-07 15:57:43&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201227111831752/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >1. Summarizing Instance, Class and Singleton methods</span></font></font></div><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >Instance methods指的是可以被它所在的类的实例调用的方法.</span></font></font></div><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >Class 方法和Singleton 方法指属于某个单独的对象的方法,不能被其他对象调用.(注意我把类方法也这么解释, 是因为类(包括BasicObject,Object,Module,Class以及自定义的类等)其实都是Class的对象.)</span></font></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><br></span></font></div><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >2. Returning Values</span></font></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >在很多编程语言中一般分有返回和不返回值的用法, 例如函数有返回值, 过程没有返回值.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >在Ruby的方法中没有强制要求返回或不返回.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >当没有写return时, 返回的是最后一个表达式的值.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >当没有任何表达式时返回的是nil.</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >def method1</font></div><div><font size="2"  >&nbsp; &nbsp; a = 1</font></div><div><font size="2"  >&nbsp; &nbsp; b = 2</font></div><div><font size="2"  >&nbsp; &nbsp; c = a + b &nbsp; # returns 3</font></div><div><font size="2"  >end</font></div><div><div><font size="2"  >def method2</font></div><div><font size="2"  >&nbsp; &nbsp; a = 1</font></div><div><font size="2"  >&nbsp; &nbsp; b = 2</font></div><div><font size="2"  >&nbsp; &nbsp; c = a + b</font></div><div><font size="2"  >&nbsp; &nbsp; return b &nbsp; # returns 2</font></div><div><font size="2"  >end</font></div></div><div><div><font size="2"  >def method3</font></div><div><font size="2"  >&nbsp; &nbsp;"hello" &nbsp; # returns "hello"</font></div><div><font size="2"  >end</font></div><div><font size="2"  >def method4</font></div><div><font size="2"  >&nbsp; &nbsp;a = 1 + 2</font></div><div><font size="2"  >&nbsp; &nbsp;"goodbye" &nbsp; # returns "goodbye"</font></div><div><font size="2"  >end</font></div><div><font size="2"  >def method5</font></div><div><font size="2"  >end &nbsp; # returns nil</font></div></div><p></p></pre></div><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >注意如果最后不是表达式, 是定义方法返回什么呢 ?&nbsp;</span></font></font></div><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  ><div><pre class="prettyprint"  ><p></p><div>class Myclass</div><div>end</div><div>ob = Myclass.new</div><div>class &lt;&lt; ob</div><div>&nbsp; def method1</div><div>&nbsp; &nbsp; def method2</div><div>&nbsp; &nbsp; &nbsp; return 1</div><div>&nbsp; &nbsp; end</div><div>&nbsp; end</div><div>&nbsp; def method3</div><div>&nbsp; &nbsp; lambda{|x| puts(x)}</div><div>&nbsp; end</div><div>end</div><div>p ob.method1</div><div>p ob.method2</div><div>p ob.method3</div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>nil</div><div>1</div><div>#&lt;Proc:0x1eb0bc8@C:/Users/digoal/Desktop/new.rb:11 (lambda)&gt;</div><p></p></pre></div><div><br></div></span></font></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >3. Returning Multiple Values</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >返回多个值, 在很多编程语言中, 一般是通过返回指针(或reference)来达到这个目的. 而不是返回这些值的拷贝.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >Ruby在reference和value没有严格的界定. 所以不能这么做来返回多值(特殊情况例外).</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >Ruby 返回多值比较简单, 返回的值用逗号隔开就是了. 这样写的返回类型是Array.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >当然你也可把需要返回的值存入Array再返回, 或者存入Hash, Set等类型再返回.</span></font></div><div><font color="#333333"  size="2"  ><div><pre class="prettyprint"  ><p style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ></p><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >def ret_things</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; greeting = "Hello world"</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; a = 1</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; b = 2.0</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; return a, b, 3, "four", greeting, 6 * 10</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >     # 也可以这么写</div><div>    # z = a, b, 3, "four", greeting, 6 * 10<br>    # return z</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >end</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><br></div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >p ret_things</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >p ret_things.class</div><p style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ></p></pre></div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >执行结果 :&nbsp;</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><pre class="prettyprint"  ><p></p><div>[1, 2.0, 3, "four", "Hello world", 60]</div><div>Array</div><p></p></pre></div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >下面的则是以Hash返回多值的举例 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >def ret_hash</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; return {'a'=&gt;'hello', 'b'=&gt;'goodbye', 'c'=&gt;'fare thee well'}</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >p ret_hash</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >p ret_hash.class</font></div><p></p></pre></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >返回 :&nbsp;</font></div><div><pre class="prettyprint"  ><p></p><div>{"a"=&gt;"hello", "b"=&gt;"goodbye", "c"=&gt;"fare thee well"}</div><div>Hash</div><p></p></pre></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >4. Default and Unpredictable Arguments</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >4.1 书写规则 :&nbsp;</span></font></div><div><span style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small;"  >Darg表示有默认值的参数, Arg表示没有默认值的参数, Uarg表示可选参数.</span></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >它们的书写规则 &nbsp;:&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Darg,...)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Arg,...)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Uarg)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Darg,...,Arg,...)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Arg,...,Darg,...)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Darg,...,Uarg)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Arg,...,Uarg,Arg,...)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Uarg,Arg,...)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Arg,...,Uarg)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Darg,...,Uarg,Arg,...)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >(Arg,...,Darg,...,Uarg)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >传入的参数个数必须满足 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >&gt;=Arg , &lt;=(Arg+Darg+Uarg),&nbsp;</span></font><span style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small;"  >Uarg&gt;=0</span></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >只有当传入的参数个数达到</span></font><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small; line-height: 23px;"  >Arg+Darg之后的值才会填充给Uarg.</span></div><div><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small; line-height: 23px;"  >当</span><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  style="line-height: 20px;"  ><span style="line-height: 23px;"  >传入的参数个数达到</span></font><span style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small;"  >Arg+Darg之后, 填充的值按方法定义中参数的顺序传递给对应的参数.</span></div><div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px; font-size: small;"  ><pre class="prettyprint"  ><p></p><div><div>def method1(a=1,b=2,*c,d,e)</div><div>&nbsp; return a,b,c,d,e</div><div>end</div><div>p method1(3,4)</div><div>p method1(3,4,5)</div><div>p method1(3,4,5,6)</div><div>p method1(3,4,5,6,7)</div><div>p method1(3,4,5,6,7,8)</div></div><div>执行结果 :&nbsp;</div><div><div>[1, 2, [], 3, 4]</div><div>[3, 2, [], 4, 5]</div><div>[3, 4, [], 5, 6]</div><div>[3, 4, [5], 6, 7]</div><div>[3, 4, [5, 6], 7, 8]</div></div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px; font-size: small;"  >默认值可以是个常量也可以是个变量甚至表达式, 例如 :&nbsp;</div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div style="line-height: 20px;"  ><pre class="prettyprint"  ><p></p><div><div>def fib(n, t = n &lt; 2 ? n : fib(n-1) + fib(n-2))&nbsp;</div><div>&nbsp; p t</div><div>end</div><div>p fib(4)</div></div><div>返回 :&nbsp;</div><div><div>1</div><div>0</div><div>1</div><div>1</div><div>2</div><div>1</div><div>0</div><div>1</div><div>3</div><div>3</div></div><p></p></pre></div><div style="line-height: 20px;"  ><span style="line-height: 23px;"  ><br></span></div><div style="line-height: 20px;"  ><span style="line-height: 23px;"  >5. Assignment and Parameter Passing</span></div><div><span style="line-height: 23px;"  >方法有两个访问点, 一个是入口即参数传递.</span></div><div><span style="line-height: 23px;"  >另一个是出口即返回值.</span></div><div><span style="line-height: 23px;"  >那么参数传递进去后, 在方法内部参数会不会被修改呢?</span></div><div><span style="line-height: 23px;"  >除非是使用了!结尾的方法或者字符串类型的&lt;&lt;方法, 否则是不会影响到传入的参数的源值的.</span></div></font></div></div><div><pre class="prettyprint"  ><div><font size="2"  >def change( x )</font></div><div><font size="2"  >&nbsp; &nbsp; x += 1</font></div><div><font size="2"  >&nbsp; &nbsp; return x</font></div><div><font size="2"  >end</font></div><div><font size="2"  >num = 10</font></div><div><font size="2"  >puts( "num.object_id=#{num.object_id}" )</font></div><div><font size="2"  >change( num )</font></div><div><font size="2"  >p num</font></div><div><font size="2"  >puts( "num.object_id=#{num.object_id}" )</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >执行结果 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><div><pre class="prettyprint"  ><p></p><div>num.object_id=21</div><div>10</div><div>num.object_id=21</div><p></p></pre></div><div>来看看一个会修改源的例子 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>def change(x)</div><div>&nbsp; x &lt;&lt; " def"</div><div>&nbsp; x = x + " abc"</div><div>end</div><div>s1 = "hello"</div><div>p change(s1)</div><div>p s1</div><p></p></pre></div><div>输出结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>"hello def abc"</div><div>"hello def"  # x 变成这个了, 为什么不是hello def abc呢, 原因是方法中的第二个表达式是赋值, 左边的x实际上是在这个方法内新产生的一个对象. 而不是右边的x了.</div><p></p></pre></div><div>如果把上面的方法两句话颠倒会怎么样呢?答案是外面的x不会被修改, 修改的是新产生的对象.</div><div><pre class="prettyprint"  ><p></p><div>def change(x)</div><div>&nbsp; x = x + " abc"  # 产生一个对象</div><div>&nbsp; x &lt;&lt; " def"  # 修改的是新产生的对象</div><div>end</div><div>s1 = "hello"</div><div>p change(s1)</div><div>p s1</div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>"hello abc def"</div><div>"hello"</div><p></p></pre></div><div>接下来再看一个不改变传入值, 直接输出的例子,</div><div><pre class="prettyprint"  ><p></p><div>def nochange(x)</div><div>&nbsp; # x = x  # 这行有没有都不影响结果</div><div>&nbsp; return x</div><div>end</div><div>s1 = 'hello world'</div><div>s2 = s1</div><div>s3 = nochange(s1)</div><div>p s1.object_id</div><div>p s2.object_id</div><div>p s3.object_id</div><div>p nochange(s1).object_id</div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>16025784</div><div>16025784</div><div>16025784</div><div>16025784</div><p></p></pre></div><div><br></div></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >6. object_id, Integers Are Special</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >上面的最后一个例子说明了一个问题, 在前面的章节也多次提到, &nbsp;两个变量的object_id相同的话可以理解为这两个变量指向同一个"内存区域".</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >变量赋予给变量的时候, 其实是赋予给它这个指向的地址, 而不是重新拷贝一份数值到新的内存区域, 所以变量赋予给变量, 结果是两个变量的的object_id相等.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >但是如果是直接赋值的话情况就不一样了, (Fixnum是一个特例, 值相同的变量object_id就相同).</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div><pre class="prettyprint"  ><p></p><div>s1 = 'hello'</div><div>s2 = 'hello'</div><div>s3 = s1</div><div><br></div><div>p 'hello'.object_id</div><div>p s1.object_id</div><div>p s2.object_id</div><div>p s3.object_id</div><div><br></div><div>i1 = 10</div><div>i2 = 10</div><div>i3 = i1</div><div><br></div><div>p 10.object_id</div><div>p i1.object_id</div><div>p i2.object_id</div><div>p i3.object_id</div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>15892308</div><div>15892332</div><div>15892320</div><div>15892332</div><div>21</div><div>21</div><div>21</div><div>21</div><p></p></pre></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >7. One-Way-In One-Way-Out Principle</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >首先引用封装的解释 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><div>encapsulation and information hiding are fundamental principles:&nbsp;</div><div>If you send a variable x to a method y and the value of x is changed inside y,&nbsp;</div><div>you cannot obtain the changed value of x from outside the method―unless&nbsp;</div><div>the method explicitly returns that value.</div><div>Ruby语言严格遵循了这个原理.</div></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >8. Modifying Receivers and Yielding New Objects</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >来看个例子先 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div><pre class="prettyprint"  ><p></p><div>def change(x)</div><div>&nbsp; x = x</div><div>&nbsp; x &lt;&lt; x</div><div>end</div><div><br></div><div>s1 = 'hello'</div><div>change(s1)</div><div>p s1</div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p>"hellohello"</p></pre></div><div>如果把change(x)方法里面的两行改成以下任意一种, 结果和上面是一样的 &nbsp;:&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>&nbsp; y = x</div><div>&nbsp; y &lt;&lt; x</div><p></p></pre></div></font></div><div><pre class="prettyprint"  ><p><font size="2"  >&nbsp; x &lt;&lt; x</font></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >来分析一下就知道为什么外部的x会被修改了,&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >首先, x = x 左边的x还是和右边的x一样指向同一个"内存区域". &lt;&lt; 方法的后果是左边的x的original值会比修改.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >y = x也和上面的解释一样.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >注意 : 尽量不要在方法中改变传入对象的original值, 这样会打破第七点提到的封装原理.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >那么怎样才能不导致original值被修改呢, 还记得clone方法吗, 以前多次提到的.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div><pre class="prettyprint"  ><p></p><div>def change(x)</div><div>&nbsp; x.clone &lt;&lt; x   # x.clone新建了一个String object. 所以&lt;&lt;改变的是新建的object</div><div>end</div><div><br></div><div>s1 = 'hello'</div><div>change(s1)</div><div>p s1</div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p>"hello"</p></pre></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >再加一个书上的例子 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><div><pre class="prettyprint"  ><p></p><div>str1 = "hello" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#object_id = 23033940</div><div>str2 = "world" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#object_id = 23033928</div><div>str3 = "goodbye" &nbsp; &nbsp; &nbsp; &nbsp;#object_id = 23033916</div><div><div>str3 = str2 &lt;&lt; str1</div><div>puts( str1.object_id ) &nbsp;#=&gt; 23033940 # unchanged</div><div>puts( str2.object_id ) &nbsp;#=&gt; 23033928 # unchanged</div><div>puts( str3.object_id ) &nbsp;#=&gt; 23033928 # now the same as str2!</div></div><p></p></pre></div><div><br></div></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >9. Potential Side Effects of Reliance On Argument Values</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >在第8点里举过例子, 调用方法的时候可能修改传给这个方法的参数的original值.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >这种方法是不可取的, 可能导致你的程序在调用这些方法后发生意想不到的事情.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >注意这里说的是改变传入参数的original值, 而不是这个方法的对象的值.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >会改变方法所属对象的值的方法如&lt;&lt;, downcase!, reverse!, capitalize! 等. 它们改变的是这个方法的所属对象, 而不是传入这个方法的参数. 这个是值得注意的.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >以下方法是不可取的, 因为它们修改了传入参数的original值.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  ><div><pre class="prettyprint"  ><p></p><div>def stringProcess( aStr, anotherStr )</div><div>&nbsp; &nbsp; myStr = aStr.capitalize!</div><div>&nbsp; &nbsp; anotherStr.reverse!.capitalize! &nbsp; &nbsp;</div><div>&nbsp; &nbsp; myStr = myStr + " " + anotherStr.reverse</div><div>&nbsp; &nbsp; return myStr</div><div>end</div><div>str1 = "hello"</div><div>str2 = "world"</div><div>str3 = stringProcess( str1, str2 )</div><div>puts( "#{str3}" ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #=&gt; Hello worlD</div><div>puts( "#{str1} #{str2}" ) &nbsp; &nbsp; #=&gt; Hello Dlrow</div><p></p></pre></div><div>如果真的有可能需要直接操作传入的参数, 可以考虑使用clone方法拷贝并新增一个对象. 在新增的对象上操作.</div><div><br></div></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >10. Parallel Assignment</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >前面讲了方法可以return multiple values. 那么怎么将这些返回值赋予给多个变量呢?</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >其实用逗号隔开就可以了 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >s1,s2,s3,s4 = 1,"digoal",[1,2,3]</font></div><div><font size="2"  >p s1</font></div><div><font size="2"  >p s2</font></div><div><font size="2"  >p s3</font></div><div><font size="2"  >p s4  # 不足的以nil填充</font></div><div><font size="2"  >s1,s2 = s2,s1  # 值交换, 不需要中间变量.</font></div><div><font size="2"  >p s1</font></div><div><font size="2"  >p s2</font></div><div><font size="2"  >def method1(a=10,b=9,*c)</font></div><div><font size="2"  >&nbsp; return a,b,c</font></div><div><font size="2"  >end</font></div><div><font size="2"  >n1,n2,n3,n4 = method1(1,2,3,4,5,6)</font></div><div><font size="2"  >p n1</font></div><div><font size="2"  >p n2</font></div><div><font size="2"  >p n3  # c是一个subArray</font></div><div><font size="2"  >p n4  # 所以n4只能以nil填充</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >执行结果 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >1</font></div><div><font size="2"  >"digoal"</font></div><div><font size="2"  >[1, 2, 3]</font></div><div><font size="2"  >nil</font></div><div><font size="2"  >"digoal"</font></div><div><font size="2"  >1</font></div><div><font size="2"  >1</font></div><div><font size="2"  >2</font></div><div><font size="2"  >[3, 4, 5, 6]</font></div><div><font size="2"  >nil</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >11. By reference or By value?</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >在Ruby程序中调用方法传入的参数到底是以reference形式还是value形式传递的呢? 看个例子就明白了.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div style="line-height: 23px;"  ><pre class="prettyprint"  ><p></p><div style="line-height: 23px;"  >def aMethod( anArg )</div><div style="line-height: 23px;"  >&nbsp; &nbsp; puts( "#{anArg.object_id}\n\n" )</div><div style="line-height: 23px;"  >end</div><div style="line-height: 23px;"  >class MyClass</div><div style="line-height: 23px;"  >end</div><div style="line-height: 23px;"  >i = 10</div><div style="line-height: 23px;"  >f = 10.5</div><div style="line-height: 23px;"  >s = "hello world"</div><div style="line-height: 23px;"  >ob = MyClass.new</div><div style="line-height: 23px;"  >puts( "#{i}.object_id = #{i.object_id}" )</div><div style="line-height: 23px;"  >aMethod( i )</div><div style="line-height: 23px;"  >puts( "#{f}.object_id = #{f.object_id}" )</div><div style="line-height: 23px;"  >aMethod( f )</div><div style="line-height: 23px;"  >puts( "#{s}.object_id = #{s.object_id}" )</div><div style="line-height: 23px;"  >aMethod( s )</div><div style="line-height: 23px;"  >puts( "#{ob}.object_id = #{ob.object_id}" )</div><div style="line-height: 23px;"  >aMethod( ob )</div><p></p></pre></div><div style="line-height: 23px;"  >执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div><div>10.object_id = 21</div><div>21</div><div><br></div><div>10.5.object_id = 16058796</div><div>16058796</div><div><br></div><div>hello world.object_id = 16057152</div><div>16057152</div><div><br></div><div>#&lt;MyClass:0x1ea0668&gt;.object_id = 16057140</div><div>16057140</div></div></font></div><p></p></pre></div></font></div><font size="2"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >说明Ruby是以reference的形式传递参数的.&nbsp;</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >因为参数的object_id在方法内部和外部是一样的.</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >那么如果要以value的形式传递应该怎么做呢? 这个应该交给Ruby的解释器去做, 要么我们可以使用参数对象的clone方法, 传递进去. 例如 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>def method1(x)</div><div>end</div><div><br></div><div>s1 = "hello i'm digoal"</div><div>method1(s1.clone)</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><br></div><div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 19px;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  style="line-height: 20px;"  ><span style="line-height: 23px;"  >12. Are Assignments Copies or References?</span></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 19px;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  style="line-height: 20px;"  ><span style="line-height: 23px;"  >赋值这个操作什么时候会生成新对象, 什么时候只是指向老的"内存区域"呢?</span></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 19px;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  style="line-height: 20px;"  ><span style="line-height: 23px;"  >当等号右边是一个表达式或者一个值(不是变量)的时候, 会新生成对象. (Fixnum除外)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div><pre class="prettyprint"  ><p></p><div>s1 = 'hello'</div><div>s2 = 'hello'</div><div>p s1.object_id</div><div>p s2.object_id</div><div><br></div><div>i1 = 10</div><div>i2 = (i1-10+10)</div><div>p i1.object_id</div><div>p i2.object_id</div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>15436092</div><div>15436080</div><div>21</div><div>21</div><p></p></pre></div></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 19px;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  style="line-height: 20px;"  ><span style="line-height: 23px;"  >当等号右边是一个变量的时候, 左边的对象指向右边的对象指向的"内存区域".</span></font></div><div><pre class="prettyprint"  ><p></p><div>s1 = 'hello'</div><div>s2 = s1</div><div>p s1.object_id</div><div>p s2.object_id</div><div><br></div><div>i1 = 10</div><div>i2 = i1</div><div>p i1.object_id</div><div>p i2.object_id</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 19px;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  style="line-height: 20px;"  ><span style="line-height: 23px;"  >执行结果 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div><pre class="prettyprint"  ><p></p><div>15600024</div><div>15600024</div><div>21</div><div>21</div><p></p></pre></div><div><br></div></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 19px;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  style="line-height: 20px;"  ><span style="line-height: 23px;"  >13. Tests for Equality : == or equal? method</span></font></div></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >先来看看==和equal?的区别 :&nbsp;</span></font></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><div><img title="Ruby Study 9 : Passing Arguments and Returning Values - 德哥@Digoal - The Heart,The World."  alt="Ruby Study 9 : Passing Arguments and Returning Values - 德哥@Digoal - The Heart,The World."  style="margin:0 10px 0 0;"  src="http://img7.ph.126.net/EMY4QvgHWJZ-eqopL4X5fQ==/620652323664301317.jpg"  ></div>&nbsp;BasicObject的 ==方法原本和equal?方法一样, 都用于比较两个对象是否相等. 它们是比较两个对象的object_id是否相等来判断它们是否相等的.</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >但是==方法往往被subclass修改（复写） , 不是比较object_id而是比较对象存储的内容. 例如String的==方法比较的是对象的内容, 而不是object_id.</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >equal?方法不会被任何subclass修改, 所以它可以用来比较两个对象的object_id. 判断它们是否指向同一个内存区域.</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >来看个例子 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>p 'abc'.equal?('abc')</div><div>p 'abc' == 'abc'</div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>false</div><div>true</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >所有类中, Fixnum属于特例 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>p 10.equal?(10)</div><div>p 10 == 10</div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>true</div><div>true</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><br></div><span style="line-height: 23px;"  >【参考】</span></font></font><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >The Book Of Ruby</font></div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >Ruby 1.9.3 API</font></div><wbr></div>
	</div>
</div>
</body>
</html>