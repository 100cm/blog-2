<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Ruby Study 6 : Loops and Iterators</h2>
	<h5 id="">2012-03-03 16:15:51&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201223104847851/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >前面多次介绍到了Array, Hash, Set, Range, Matrix, Vector 等collection class的Iterator特性, 如each方法.</font></span></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >这次专门讲一讲Loops和Iterators.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >1. for loops</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >for循环和其他编程语言类似, 看个例子 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >下面的例子中包含了,String, Array, Hash, Set, Range, Vector, Matrix的Iterator 操作以及each方法和for语法的转换.</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >require "Matrix"</font></div><div><font size="2"  >require "Set"</font></div><div><font size="2"  >s1 = "abcd"</font></div><div><font size="2"  >a1 = [1,2,3,4]</font></div><div><font size="2"  >h1 = {:a=&gt;1, :b=&gt;2, :c=&gt;3, :d=&gt;4}</font></div><div><font size="2"  >set1 = Set.new([1,2,3,4,1,2,3,4])  # 因为, Set class不保护重复数据, 所以就是1,2,3,4 .这里再提醒一下大家.</font></div><div><font size="2"  >r1 = (1..4)</font></div><div><font size="2"  >v1 = Vector[1,2,3,4]</font></div><div><font size="2"  >v2 = Vector[5,6,7,8]</font></div><div><font size="2"  >m1 = Matrix.columns([v1,v2])</font></div><div><font size="2"  >m2 = Matrix.rows([v1,v2])</font></div><div><font size="2"  ># each example</font></div><div><font size="2"  >puts("each example\ns1:")</font></div><div><font size="2"  >(0..s1.length-1).each {</font></div><div><font size="2"  >&nbsp; |x|</font></div><div><font size="2"  >&nbsp; print(s1["#{x}".to_i])</font></div><div><font size="2"  >}</font></div><div><font size="2"  >puts("\na1:")</font></div><div><font size="2"  >a1.each {</font></div><div><font size="2"  >&nbsp; |x|</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >}</font></div><div><font size="2"  >puts("\nh1:")</font></div><div><font size="2"  >h1.each {</font></div><div><font size="2"  >&nbsp; |x|</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >}</font></div><div><font size="2"  >puts("\nset1:")</font></div><div><font size="2"  >set1.each {</font></div><div><font size="2"  >&nbsp; |x|</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >}</font></div><div><font size="2"  >puts("\nr1:")</font></div><div><font size="2"  >r1.each {</font></div><div><font size="2"  >&nbsp; |x|</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >}</font></div><div><font size="2"  >puts("\nv1:")</font></div><div><font size="2"  >v1.each {</font></div><div><font size="2"  >&nbsp; |x|</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >}</font></div><div><font size="2"  >puts("\nv2:")</font></div><div><font size="2"  >v2.each {</font></div><div><font size="2"  >&nbsp; |x|</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >}</font></div><div><font size="2"  >puts("\nm1:")</font></div><div><font size="2"  >m1.each {</font></div><div><font size="2"  >&nbsp; |x|</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >}</font></div><div><font size="2"  >puts("\nm2:")</font></div><div><font size="2"  >m2.each {</font></div><div><font size="2"  >&nbsp; |x|</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >}</font></div><div><font size="2"  ><br></font></div><div><font size="2"  ># for example</font></div><div><font size="2"  >puts("\nfor example\ns1:")</font></div><div><font size="2"  >for x in (0..s1.length-1) do</font></div><div><font size="2"  >&nbsp; print(s1["#{x}".to_i])</font></div><div><font size="2"  >end</font></div><div><font size="2"  >puts("\na1:")</font></div><div><font size="2"  >for x in a1 do</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >end</font></div><div><font size="2"  >puts("\nh1:")</font></div><div><font size="2"  >for x in h1 do</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >end</font></div><div><font size="2"  >puts("\nset1:")</font></div><div><font size="2"  >for x in set1 do</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >end</font></div><div><font size="2"  >puts("\nr1:")</font></div><div><font size="2"  >for x in r1 do</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >end</font></div><div><font size="2"  >puts("\nv1:")</font></div><div><font size="2"  >for x in v1 do</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >end</font></div><div><font size="2"  >puts("\nv2:")</font></div><div><font size="2"  >for x in v2 do</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >end</font></div><div><font size="2"  >puts("\nm1:")</font></div><div><font size="2"  >for x in m1 do</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >end</font></div><div><font size="2"  >puts("\nm2:")</font></div><div><font size="2"  >for x in m2 do</font></div><div><font size="2"  >&nbsp; print(x)</font></div><div><font size="2"  >end</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >执行结果 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >each example</font></div><div><font size="2"  >s1:</font></div><div><font size="2"  >abcd</font></div><div><font size="2"  >a1:</font></div><div><font size="2"  >1234</font></div><div><font size="2"  >h1:</font></div><div><font size="2"  >[:a, 1][:b, 2][:c, 3][:d, 4]</font></div><div><font size="2"  >set1:</font></div><div><font size="2"  >1234</font></div><div><font size="2"  >r1:</font></div><div><font size="2"  >1234</font></div><div><font size="2"  >v1:</font></div><div><font size="2"  >1234</font></div><div><font size="2"  >v2:</font></div><div><font size="2"  >5678</font></div><div><font size="2"  >m1:</font></div><div><font size="2"  >15263748</font></div><div><font size="2"  >m2:</font></div><div><font size="2"  >12345678</font></div><div><font size="2"  >for example</font></div><div><font size="2"  >s1:</font></div><div><font size="2"  >abcd</font></div><div><font size="2"  >a1:</font></div><div><font size="2"  >1234</font></div><div><font size="2"  >h1:</font></div><div><font size="2"  >[:a, 1][:b, 2][:c, 3][:d, 4]</font></div><div><font size="2"  >set1:</font></div><div><font size="2"  >1234</font></div><div><font size="2"  >r1:</font></div><div><font size="2"  >1234</font></div><div><font size="2"  >v1:</font></div><div><font size="2"  >1234</font></div><div><font size="2"  >v2:</font></div><div><font size="2"  >5678</font></div><div><font size="2"  >m1:</font></div><div><font size="2"  >15263748</font></div><div><font size="2"  >m2:</font></div><div><font size="2"  >12345678</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >2. Blocks and Block Parameters</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >在Ruby中Iterator执行的那串代码被称为Block, 例如 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >(1..4).each do |x|</font></div><div><font size="2"  >&nbsp; puts(x)</font></div><div><font size="2"  >end</font></div><p></p></pre></div><div><pre class="prettyprint"  style="line-height: 22px;"  ><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >以下称为一个Block, x为Block parameter</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  > |x|</font></div><div style="line-height: 22px;"  ><font size="2"  style="line-height: 19px;"  >&nbsp; puts(x)</font></div></pre>执行一个Block类似执行一个函数, Block parameters类似函数的形参(s). block parameters可以由collection class在调用iterator类方法时传递给block. &nbsp;例如each方法.</div><div>下面的例子是传递多个参数的例子 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >ms1 = [[1,2,3,4],5,[6,7]]</font></div><div><font size="2"  >ms1.each {</font></div><div><font size="2"  >&nbsp; |a,b,c,d|</font></div><div><font size="2"  >&nbsp; p(a,b,c,d,"\n")</font></div><div><font size="2"  >}</font></div><p></p></pre></div><div>执行结果 :&nbsp;</div><div>第一个元素传递了4个参数，第二个元素传递了一个参数, 所以剩余的3个为nil.最后一个元素传递了2个参数, 其余2个为nil</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >1</font></div><div><font size="2"  >2</font></div><div><font size="2"  >3</font></div><div><font size="2"  >4</font></div><div><font size="2"  >"\n"</font></div><div><font size="2"  >5</font></div><div><font size="2"  >nil</font></div><div><font size="2"  >nil</font></div><div><font size="2"  >nil</font></div><div><font size="2"  >"\n"</font></div><div><font size="2"  >6</font></div><div><font size="2"  >7</font></div><div><font size="2"  >nil</font></div><div><font size="2"  >nil</font></div><div><font size="2"  >"\n"</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >3. Iterating upto and downto</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >除了each方法, 还有upto, downto方法可以与block结合使用.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >Fixnum的upto和downto方法的例子如下 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><div><pre class="prettyprint"  ><p></p><div>0.upto(5) {</div><div>&nbsp; |x|</div><div>&nbsp; print(x)</div><div>}</div><div>print("\n")</div><div>5.downto(0) {</div><div>&nbsp; |x|</div><div>&nbsp; print(x)</div><div>}</div><p></p></pre></div><div>执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div>012345</div><div>543210</div><p></p></pre></div><div><br></div></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >4. Multiple Iterator Arguments</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >多参数的传递上面已经举例说明过了, 如果传递的参数不够BLOCK想要的个数, 那么将有些block parameter 会为nil.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >5. while loops</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >while loop类似其他编程语言, 只是有两种写法, 其中一种先判断条件然后执行, 另一种是先执行任何判断条件. 如下 &nbsp;:</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div><pre class="prettyprint"  ><p></p><div>puts("execute zero or more times")</div><div>i1 = 0</div><div>while i1&lt;0</div><div>&nbsp; puts( i1 )</div><div>&nbsp; i1 += 1</div><div>end</div><div><br></div><div>i3 = 0</div><div>puts( i3 ) while i3&lt;0</div><div><br></div><div>puts("execute one or more times")</div><div>i2 = 0</div><div>begin</div><div>puts( i2 )</div><div>i2 += 1</div><div>end while i2&lt;0</div><p></p></pre></div><div>上两种写法都是先判断条件, 然后执行程序块. 后一种是先执行程序块然后判断条件.</div><div>执行结果 :&nbsp;</div><div><div><pre class="prettyprint"  ><p></p><div><div>execute zero or more times</div><div>execute one or more times</div><div>0</div></div><div></div><p></p></pre></div></div><div><br></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >6. until loops</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >until 相当于while not , 也有两种写法. 如下 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >puts("execute zero or more times")</font></div><div><font size="2"  >i1 = 0</font></div><div><font size="2"  >until i1&gt;=0</font></div><div><font size="2"  >&nbsp; puts( i1 )</font></div><div><font size="2"  >&nbsp; i1 += 1</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >i3 = 0</font></div><div><font size="2"  >puts( i3 ) until i3&gt;=0</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >puts("execute one or more times")</font></div><div><font size="2"  >i2 = 0</font></div><div><font size="2"  >begin</font></div><div><font size="2"  >puts( i2 )</font></div><div><font size="2"  >i2 += 1</font></div><div><font size="2"  >end until i2&gt;=0</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >执行结果 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >execute zero or more times</font></div><div><font size="2"  >execute one or more times</font></div><div><font size="2"  >0</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >7. loop</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >前面讲的for, while, until 都是有限制条件来跳出循环的, 接下来的循环代码(loop)则必须使用break来跳出循环.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >并且loop可以使用大括号来指定执行代码也可以用do end. 而for, while, until只能用do end.</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >arr = %W[d i g o a l]</font></div><div><font size="2"  >i = 0</font></div><div><font size="2"  >loop do</font></div><div><font size="2"  >&nbsp; &nbsp; print(arr[i])</font></div><div><font size="2"  >&nbsp; &nbsp; i += 1</font></div><div><font size="2"  >&nbsp; &nbsp; if (i == arr.length) then&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;break&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; end</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >puts("\nanother example\n")</font></div><div><font size="2"  >i = 0</font></div><div><font size="2"  >loop {</font></div><div><font size="2"  >&nbsp; &nbsp; print(arr[i])</font></div><div><font size="2"  >&nbsp; &nbsp; i += 1</font></div><div><font size="2"  >&nbsp; &nbsp; if (i == arr.length) then&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp;break&nbsp;</font></div><div><font size="2"  >&nbsp; &nbsp; end</font></div><div><font size="2"  >}</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >执行结果 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal</font></div><div><font size="2"  >another example</font></div><div><font size="2"  >digoal</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >8. Enumerable Module</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >前面所举了很多include?, min, max, collect等方法, 这些方法来自Enumerable Module , 很多class包含了这个Module, 例如Set, Hash, Range, Array等.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >include? 方法用于判断某元素是否存在,</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >min, max很好理解.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >collect 用于返回一个结构体.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >同时, 这些方法有些可以传递块参数进去, 来看看.</span></font></div><div><font color="#333333"  size="2"  ><div><pre class="prettyprint"  ><p style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ></p><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >a1 = ["abc", "bc" , "efg", "google", "digoal"]</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >p a1.min</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >p a1.min {</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >&nbsp; |a,b|</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >&nbsp; a.length &lt;=&gt; b.length</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >}</div><div>p a1.collect {<br>  |x|<br>  x + "_new"<br>}<br>p a1.include?("abc")</div><p style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ></p></pre></div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >执行结果 :&nbsp;</div><div><pre class="prettyprint"  ><p style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ></p><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >"abc"</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >"bc"</div><div>["abc_new", "bc_new", "efg_new", "google_new", "digoal_new"]<br>true</div><p style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ></p></pre></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >9. custom Comparisons</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >这个已经多次举例了,</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >这里再举一个更深入的, 使用Array存储一组字符串, 按照Array的index来进行排序.</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >a1 = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"]</font></div><div><font size="2"  >h1 = {</font></div><div><font size="2"  >&nbsp; "monday" =&gt; 1,</font></div><div><font size="2"  >&nbsp; "tuesday" =&gt; 2,</font></div><div><font size="2"  >&nbsp; "wednesday" =&gt; 3,</font></div><div><font size="2"  >&nbsp; "thursday" =&gt; 4,</font></div><div><font size="2"  >&nbsp; "friday" =&gt; 5,</font></div><div><font size="2"  >&nbsp; "saturday" =&gt; 6,</font></div><div><font size="2"  >&nbsp; "sunday" =&gt; 7</font></div><div><font size="2"  >}</font></div><div><font size="2"  >p h1.sort</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >p h1.sort {</font></div><div><font size="2"  >&nbsp; |x,y|</font></div><div><font size="2"  >&nbsp; a1.index(x[0].downcase) &lt;=&gt; a1.index(y[0].downcase)</font></div><div><font size="2"  >}</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >执行结果 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >[["friday", 5], ["monday", 1], ["saturday", 6], ["sunday", 7], ["thursday", 4], ["tuesday", 2], ["wednesday", 3]]</font></div><div><font size="2"  >[["monday", 1], ["tuesday", 2], ["wednesday", 3], ["thursday", 4], ["friday", 5], ["saturday", 6], ["sunday", 7]]</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >10. each and yield</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >使用Ruby自带的类如前面所讲的Array, Set, Range, Hash等include了Enumerable Module. 可以使用它定义的方法如min, max, include?等.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >接下来我们看看自定义的方法如何来使用这些Enumerable Module的方法(min, max, include?等)</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >首先看看Enumerable Module 定了些啥方法.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >接下来的例子定义了一个包含Enumerable模块的class, 和一个不包含Enumerable的class, 通过他们的对象的methods方法相减得到的是Enumerable 模块新带来的方法, 我们可以从结果上看到除了min , max , collect还有熟悉的sort等方法.</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >class Myclass1</font></div><div><font size="2"  >&nbsp; include Enumerable</font></div><div><font size="2"  >&nbsp; attr_accessor(:a)</font></div><div><font size="2"  >&nbsp; def initialize (x)</font></div><div><font size="2"  >&nbsp; @a = x</font></div><div><font size="2"  >&nbsp; end</font></div><div><font size="2"  >end</font></div><div><font size="2"  >class Myclass2</font></div><div><font size="2"  >end</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >mobj1 = Myclass1.new([1,2,3,4])</font></div><div><font size="2"  >mobj2 = Myclass2.new()</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >print((mobj1.methods - mobj2.methods).sort)</font></div><p></p></pre></div><font size="2"  ><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >输出结果 :&nbsp;</font></span></div><div><pre class="prettyprint"  ><p>[:a, :a=, :all?, :any?, :chunk, :collect, :collect_concat, :count, :cycle, :detect, :drop, :drop_while, :each_cons, :each_entry, :each_slice, :each_with_index, :each_with_object, :entries, :find, :find_all, :find_index, :first, :flat_map, :grep, :group_by, :include?, :inject, :map, :max, :max_by, :member?, :min, :min_by, :minmax, :minmax_by, :none?, :one?, :partition, :reduce, :reject, :reverse_each, :select, :slice_before, :sort, :sort_by, :take, :take_while, :to_a, :zip]</p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >接下来看看如何利用Enumerable带来的方法, 直接使用是不行的, 必须在自定义的类中新增一个each方法, 并且要在each方法中用yield方法返回值.</font></span></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >这些个yield返回的值将作为BLOCK parameter传递给这些Enumerable的方法.</font></span></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >例如 :&nbsp;</font></span></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><pre class="prettyprint"  ><p></p><div>class Myclass1</div><div>&nbsp; include Enumerable</div><div>&nbsp; attr_accessor(:a)</div><div>&nbsp; def initialize (x)</div><div>&nbsp; @a = x</div><div>&nbsp; end</div><div>end</div><div><br></div><div>mobj1 = Myclass1.new(["digoal","DIGOAL","abc","baidu","google"])</div><div>p mobj1.sort</div><div></div><p></p></pre></div></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >这里由于没有在Myclass1中定义each方法, 所以调用Enumerable带来的sort方法时会报错.</font></span></div><div><pre class="prettyprint"  ><p></p><div>C:/Users/digoal/Desktop/new.rb:10:in `sort': undefined method `each' for #&lt;Myclass1:0x1e9fa98&gt; (NoMethodError)</div><div><span> </span>from C:/Users/digoal/Desktop/new.rb:10:in `&lt;main&gt;'</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >接下来定义each方法后, 再调用min,max,sort就不会报错了.</font></span></div><div><pre class="prettyprint"  ><p></p><div>class Myclass1</div><div>&nbsp; include Enumerable</div><div>&nbsp; attr_accessor(:a)</div><div>&nbsp; def initialize (x)</div><div>&nbsp; &nbsp; @a = x</div><div>&nbsp; end</div><div>&nbsp; def each</div><div>&nbsp; &nbsp; @a.each {</div><div>&nbsp; &nbsp; &nbsp; |x|</div><div>&nbsp; &nbsp; &nbsp; yield(x)</div><div>&nbsp; &nbsp; }</div><div>&nbsp; end</div><div>end</div><div><br></div><div>mobj1 = Myclass1.new(["digoal","DIGOAL","abc","baidu","google"])</div><div>p mobj1.sort</div><div>p mobj1.min</div><div>p mobj1.max</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >结果 :&nbsp;</font></span></div><div><pre class="prettyprint"  ><p></p><div>["DIGOAL", "abc", "baidu", "digoal", "google"]</div><div>"DIGOAL"</div><div>"google"</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >接下来看看yield中的返回值修改一下会怎么样,</div><div><pre class="prettyprint"  ><p></p><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >class Myclass1</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; include Enumerable</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; attr_accessor(:a)</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def initialize (x)</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; @a = x</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def each</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; @a.each {</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; &nbsp; |x|</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; &nbsp; yield(x.downcase)</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; }</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >mobj1 = Myclass1.new(["digoal","DIGOAL","abc","baidu","google"])</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >p mobj1.sort</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >p mobj1.min</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >p mobj1.max</font></div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >返回结果 :&nbsp;</font></span></div><div><pre class="prettyprint"  ><p></p><div>["abc", "baidu", "digoal", "digoal", "google"]</div><div>"abc"</div><div>"google"</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >没错, Enumerable模块的这些方法,min,max,sort调用了each, 使用了yield返回的值. 所以在调用sort后会发现返回的都是小写.</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >接下来我们要举例的是复写Enumerable模块的min , max 方法. 按照字符长度来选择最大最小值.</div><div><pre class="prettyprint"  ><p></p><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >class Myclass1</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; include Enumerable</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; attr_accessor(:a)</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def initialize (x)</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; @a = x</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def each</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; @a.each {</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; &nbsp; |x|</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; &nbsp; yield(x)</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; }</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def min</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; @a.min {</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; &nbsp; |x,y|</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; &nbsp; x.length &lt;=&gt; y.length</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; }</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def max</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; @a.max {</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; &nbsp; |x,y|</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; &nbsp; x.length &lt;=&gt; y.length</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; }</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >  def sort</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >    @a.sort {</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >      |x,y|</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >      x.length &lt;=&gt; y.length</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >    }</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >  end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >end</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >mobj1 = Myclass1.new(["digoal","DIGOAL","abc","baidu","google"])</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >p mobj1.sort</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >p mobj1.min</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >p mobj1.max</font></div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >执行结果 :&nbsp;</div><div><div><pre class="prettyprint"  ><p></p><div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >["abc", "baidu", "digoal", "DIGOAL", "google"]</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >"abc"</font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  >"digoal"</font></div></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ></div><p></p></pre></div></div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><span style="line-height: 23px;"  >这种自定义包含Enumerable模块的类的对象, 同样也可以在这些方法后传入块. 例如 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div>class Myclass1</div><div>&nbsp; include Enumerable</div><div>&nbsp; attr_accessor(:a)</div><div>&nbsp; def initialize (x)</div><div>&nbsp; &nbsp; @a = x</div><div>&nbsp; end</div><div>&nbsp; def each</div><div>&nbsp; &nbsp; @a.each {</div><div>&nbsp; &nbsp; &nbsp; |x|</div><div>&nbsp; &nbsp; &nbsp; yield(x)</div><div>&nbsp; &nbsp; }</div><div>&nbsp; end</div><div>end</div><div><br></div><div>mobj1 = Myclass1.new(["digoal","DIGOAL1","abc","baidu","goooogle"])</div><div>p mobj1.sort {</div><div>&nbsp; |x,y|</div><div>&nbsp; x.to_s.length &lt;=&gt; y.to_s.length</div><div>}</div><p></p></pre></div><div><span style="line-height: 23px;"  >执行结果 :&nbsp;</span></div><div><pre class="prettyprint"  ><p>["abc", "baidu", "digoal", "DIGOAL1", "goooogle"]</p></pre></div><span style="line-height: 23px;"  >【参考】</span></font></font><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >The Book Of Ruby</font></div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >Ruby 1.9.3 API</font></div><wbr></div>
	</div>
</div>
</body>
</html>