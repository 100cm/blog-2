<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">Ruby Study 13 : Modules and Mixins</h2>
	<h5 id="">2012-03-28 10:57:38&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201222712214285/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >在Ruby中class的superclass只能有一个, childclass可以有多个. 所以一个class如果要继承多个class的特性是不可能的.</span></font></font></div><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >如果有这种需求, 可以考虑把这些特性封装在Module中.&nbsp;</span></font></font><span style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small;"  >Module可以很好的解决这类问题, 通过require或者load或者include可以把Module的instance method等带入到当前环境, 也就是可以使用Module中的方法等. 一个class可包含多个Module, 接下来详细的讲解.</span></div><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >1. A Module Is like a Class</span></font></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >为什么说Module和Class很相像呢?&nbsp;</span></font></div><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >首先是Module是Class的superclass. 如下 :&nbsp;</span></font></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >p Class.superclass</font></div><div><font size="2"  >p Module.superclass&nbsp;</font></div><div><font size="2"  >结果</font></div><div><div><font size="2"  >Module</font></div><div><font size="2"  >Object</font></div></div><p></p></pre></div><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >其次, 定义Module时, Module也可以包含常量, Module singleton method, instance method等.</span></font></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >module MyMod1</font></div><div><font size="2"  >&nbsp; NAME = "digoal.zhou"</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; class Myclass1</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; end</font></div><div><font size="2"  >&nbsp; def method1</font></div><div><font size="2"  >&nbsp; &nbsp; puts("this is MyMod1's instance method.")</font></div><div><font size="2"  >&nbsp; end</font></div><div><font size="2"  >end</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  ><br></span></font></div><div><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >2. Module methods (Like Class singleton method)</span></font></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >Module 里面可以定义instance method也可以像Class那样定义singleton method. 例如 :&nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div><pre class="prettyprint"  ><p></p><div>module MyMod1</div><div>&nbsp; def method1 &nbsp;# 定义instance method</div><div>&nbsp; &nbsp; puts("this is MyMod1's instance method.")</div><div>&nbsp; end</div><div><br></div><div>&nbsp; def self.method2 &nbsp;# 定义singleton method</div><div>&nbsp; &nbsp; puts("this is MyMod1's singleton method.")</div><div>&nbsp; end</div><div><br></div><div>&nbsp; def MyMod1.method3 &nbsp;# 定义singleton method</div><div>&nbsp; &nbsp; puts("this is MyMod1's another singleton method.")</div><div>&nbsp; end</div><div>end</div><p></p></pre></div><div>其中singleton method可以通过如下方法调用 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><div>MyMod1.method2</div><div>MyMod1.method3</div></font></div><div><font size="2"  style="line-height: 23px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >输出</span></font></font></div><div><font size="2"  style="line-height: 23px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  ><div>this is MyMod1's singleton method.</div><div>this is MyMod1's another singleton method.</div></span></font></font></div><p></p></pre></div></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >但是, 需要注意Module与Class的不同之处, Module不能创建它的object, 但是Class可以创建它的object. 因此Module的instance method不能通过创建对象来调用. 自建的Class有superclass和subclass. 而自建的Module没有superclass和subclass(Module本身是Object的subclass). 如下 :&nbsp;</span></font></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >p MyMod1.class</font></div><div><font size="2"  >p Module.superclass</font></div><div><font size="2"  >p MyMod1.superclass</font></div><div><font size="2"  >输出</font></div><div><div><font size="2"  >Object</font></div><div><font size="2"  >Module</font></div><div><font size="2"  >C:/Users/digoal/Desktop/new.rb:16:in `&lt;main&gt;': undefined method `superclass' for MyMod1:Module (NoMethodError)</font></div></div><p></p></pre></div><div><span style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small;"  ><br></span></div><div><span style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small;"  >3. Modules as Namespaces</span></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >Module 是一系列methods, classes, constants的封装, 在Module内部它们在一个namespace内, 相互可以访问, 但是对Module外部是隔离的.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >Ruby的类库里定义了一些Module如, Math, Kernel.</span></font></div><div>The <tt>Math</tt> module contains module functions for basic trigonometric and  transcendental functions. (例如sqrt方法, PI常量)</div><div>Kernel则包含了一些我们已经常用的chomp,chop,lambda,puts,print等方法.</div><div>详见API.</div><div><span style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; font-size: small;"  >例如 :&nbsp;</span></div><div><pre class="prettyprint"  ><p></p><div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >module MyModule</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >&nbsp; &nbsp; GOODMOOD = "happy"</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >&nbsp; &nbsp; BADMOOD = "grumpy"</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >&nbsp; &nbsp;</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >&nbsp; &nbsp; def greet</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >&nbsp; &nbsp; &nbsp; &nbsp; return "I'm #{GOODMOOD}. How are you?"</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >&nbsp; &nbsp; end</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >&nbsp; &nbsp; def MyModule.greet</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >&nbsp; &nbsp; &nbsp; &nbsp; return "I'm #{BADMOOD}. How are you?"</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >&nbsp; &nbsp; end</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >end</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  ><br></span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >p MyModule.greet</span></font></div></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  >输出</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  >"I'm grumpy. How are you?"</font></div><p></p></pre></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 23px;"  >变量的访问范围则和以前讲解的一样.</span></font></div><div><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  size="2"  ><span style="line-height: 20px;"  ><br></span></font></div><font size="2"  ><font color="#333333"  ><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >4. Included Modules, or Mixins</span></font></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 23px;"  >那到底要怎么调用Module 的instance method呢?</span> </div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 23px;"  >mixin, 例如使用include.</span></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 23px;"  >例如 :&nbsp;</span></div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><pre class="prettyprint"  ><p></p><div><div>module MyModule</div><div>&nbsp; &nbsp; x = 1</div><div>&nbsp; &nbsp; GOODMOOD = "happy"</div><div>&nbsp; &nbsp; BADMOOD = "grumpy"</div><div>&nbsp; &nbsp;</div><div>&nbsp; &nbsp; def greet</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return "I'm #{GOODMOOD}. How are you?"</div><div>&nbsp; &nbsp; end</div><div>&nbsp; &nbsp; def MyModule.greet</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return "I'm #{BADMOOD}. How are you?"</div><div>&nbsp; &nbsp; end</div><div>end</div><div><br></div><div>include MyModule</div><div><br></div><div>p greet</div><div>p GOODMOOD</div><div>p MyModule.greet</div><div>p x &nbsp;# 报错, 因为x 是MyModule这个object的local variable. 不能在外部直接访问, 后面还有个例子可以说明Module的local variable带入到了当前环境, 但是不可被访问. 但是我个人认为Module的local variable不应该带入到当前环境, 即不可见为啥还要带进来.</div></div><div>结果</div><div><div>"I'm happy. How are you?"</div><div>"happy"</div><div>"I'm grumpy. How are you?"</div><div>C:/Users/digoal/Desktop/new.rb:19:in `&lt;main&gt;': undefined local variable or method `x' for main:Object (NameError)</div></div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >如果在class的定义中include Module, 则可以把它的constants, instance method, class, instance variable, 带入到class中, 就好像这些是写在你定义的class里面一样.</span></font></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >例如</span></font></font></div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><pre class="prettyprint"  ><p></p><div>class Myclass1</div><div>include MyModule</div><div>def m1</div><div>&nbsp; return BADMOOD</div><div>end</div><div>end</div><div>ob1 = Myclass1.new</div><div><br></div><div>p ob1.greet</div><div>p ob1.m1</div><div>结果</div><div><div>"I'm happy. How are you?"</div><div>"grumpy"</div></div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >下面是一个include多个模块的例子 :&nbsp;</span></font></font></div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><pre class="prettyprint"  ><p></p><div>module MagicThing</div><div>&nbsp; &nbsp; attr_accessor :power</div><div>end</div><div>module Treasure</div><div>&nbsp; &nbsp; attr_accessor :value</div><div>&nbsp; &nbsp; attr_accessor :owner&nbsp;</div><div>end</div><div>class Weapon</div><div>&nbsp; &nbsp; attr_accessor :deadliness</div><div>end</div><div>class Sword &lt; Weapon &nbsp; &nbsp; &nbsp; &nbsp;# descend from Weapon</div><div>&nbsp; &nbsp; include Treasure &nbsp; &nbsp; &nbsp; &nbsp;# mix in Treasure</div><div>&nbsp; &nbsp; include MagicThing &nbsp; &nbsp; &nbsp;# mix in MagicThing</div><div>&nbsp; &nbsp; attr_accessor :name</div><div>end</div><div>s = Sword.new</div><div>s.name = "Excalibur"</div><div>s.deadliness = "fatal"</div><div>s.value = 1000</div><div>s.owner = "Gribbit The Dragon"</div><div>s.power = "Glows when Orcs appear"</div><div>puts(s.name) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#=&gt; Excalibur</div><div>puts(s.deadliness) &nbsp; &nbsp; &nbsp;#=&gt; fatal</div><div>puts(s.value) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #=&gt; 1000</div><div>puts(s.owner) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #=&gt; Gribbit The Dragon</div><div>puts(s.power) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #=&gt; Glows when Orcs appear</div><p></p></pre></div><div>下面的例子说明Module的local variable在include是被带入到当前环境, 因为如果没有带进来, no_bar应该返回的是1.</div><div><pre class="prettyprint"  ><p></p><div>x = 1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # local to this program</div><div>module Foo</div><div>&nbsp; &nbsp; x = 50 # local to module Foo</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# this can be mixed in but the variable x won't be visible&nbsp;</div><div>&nbsp; &nbsp; def no_bar</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return x&nbsp;</div><div>&nbsp; &nbsp; end</div><div>&nbsp; &nbsp; def bar</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@x = 1000 &nbsp; &nbsp; &nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return &nbsp;@x</div><div>&nbsp; &nbsp; end</div><div>&nbsp; &nbsp; puts( "In Foo: x = #{x}" ) &nbsp; # this can access the module-local x</div><div>end</div><div>include Foo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # mix in the Foo module</div><div>puts(x) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #=&gt; 1</div><div>puts( no_bar ) &nbsp; &nbsp;# Error: undefined local variable or method 'x'</div><div>puts(bar) &nbsp; &nbsp; &nbsp; &nbsp; #=&gt; 1000</div><p></p></pre></div></font></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >下面的例子说明Module object的instane variables不会被带入到当前环境, 而class variables可以带入, 并修改, 如下 :&nbsp;</span></font></font></div><div><font size="2"  ><font color="#333333"  ><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><pre class="prettyprint"  ><p></p><div>module X</div><div>&nbsp; &nbsp; @instvar = "X's @instvar"</div><div>&nbsp; &nbsp; @@modvar = "X's @@modvar"</div><div>&nbsp; &nbsp;</div><div>&nbsp; &nbsp; def self.aaa</div><div>&nbsp; &nbsp; &nbsp; &nbsp; puts(@instvar)&nbsp;</div><div>&nbsp; &nbsp; end</div><div><br></div><div>&nbsp; &nbsp; def self.bbb</div><div>&nbsp; &nbsp; &nbsp; &nbsp; puts(@@modvar)</div><div>&nbsp; &nbsp; end</div><div>end</div><div>X.aaa &nbsp; #=&gt; X's @instvar</div><div>X.bbb &nbsp; #=&gt; X's @@modvar</div><div>include X</div><div>p @instvar &nbsp; #&gt;= nil</div><div>p @@modvar  #=&gt; <span style="line-height: 19px; font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >X's @@modvar</span></div><div>class Myclass1</div><div>&nbsp; include X</div><div>&nbsp; def m1</div><div>&nbsp; &nbsp; p @instvar</div><div>&nbsp; end</div><div>&nbsp; def m2</div><div>&nbsp; &nbsp; p @@modvar</div><div>&nbsp; end</div><div>&nbsp; def m3(newvar)</div><div>&nbsp; &nbsp; @@modvar = newvar</div><div>&nbsp; end</div><div>end</div><div><br></div><div>ob1 = Myclass1.new</div><div>ob1.m1 &nbsp;#=&gt; nil</div><div>ob1.m2 &nbsp;#=&gt; "X's @@modvar"</div><div>ob1.m3("ob1 modify @@modvar") &nbsp;# 因为Module object的class可以被include到当前环境, 是可以被修改的.</div><div>X.bbb #=&gt; ob1 modify @@modvar</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >下面的例子可以看出, Module中定义的方法在include到当前环境后, 它就像在当前环境定义的一样, 所以我们看到amethod里面的@insvar实际上是给当前环境的instance variable赋值, 而和Module object的instance variable没有一点关系.</div><div><pre class="prettyprint"  ><p style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ></p><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >module X</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; @instvar = "X's @instvar"&nbsp;</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; @anotherinstvar = "X's 2nd @instvar"</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; &nbsp;</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; &nbsp; &nbsp; def amethod</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@instvar = 10 &nbsp; &nbsp; &nbsp; # creates @instvar in current scope</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;puts(@instvar)</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >&nbsp; &nbsp; &nbsp; &nbsp; end &nbsp; &nbsp; &nbsp;</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >end</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >include X</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >p( @instvar ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#=&gt; nil</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >amethod &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#=&gt; 10</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >puts( @instvar ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #=&gt; 10</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >@instvar = "hello world"</div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >puts( @instvar ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #=&gt; "hello world"</div><div>p( X.instance_variables )      #=&gt; [:@instvar, @anotherinstvar]<br>p( self.instance_variables )   #=&gt; [:@instvar]  # 这也是在执行 <span style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 20px;"  >amethod 后给self环境创建的一个instance variable.</span></div><p style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ></p></pre></div><div style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><br></div></font></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >5. Name Conflicts</span></font></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >如果两个module同时定义了一个同名的方法, 那么如果这两个module都被include了, 则后面的覆盖前面的同名方法, 例如 :&nbsp;</span></font></font></div><div><pre class="prettyprint"  ><p></p><div>module M1</div><div>&nbsp; def method1</div><div>&nbsp; &nbsp; return "xxx"</div><div>&nbsp; end</div><div>end</div><div><br></div><div>module M2</div><div>&nbsp; def method1</div><div>&nbsp; &nbsp; return "yyy"</div><div>&nbsp; end</div><div>end</div><div><br></div><div>class Myclass1</div><div>&nbsp; include M1</div><div>&nbsp; include M2</div><div>end</div><div><br></div><div>ob1 = Myclass1.new</div><div>p ob1.method1</div><div>输出</div><div>yyy</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >如果把include的顺序调换一下结果则是xxx</span></font></font></div><div><pre class="prettyprint"  ><p></p><div>class Myclass1</div><div>&nbsp; include M2</div><div>&nbsp; include M1</div><div>end</div><div><br></div><div>ob1 = Myclass1.new</div><div>p ob1.method1</div><div>输出</div><div>xxx</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >换成class variable,&nbsp;</span></font></font><span style="line-height: 23px;"  >constants</span><span style="line-height: 23px;"  >与上面的测试结果一样 .</span></div><div><pre class="prettyprint"  ><p></p><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >module M1</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; A = "xxx"</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def method1</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; return A</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >module M2</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; A = "yyy"</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def method1</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; return A</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >class Myclass1</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; include M2</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; include M1</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def m1</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; p A</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >ob1 = Myclass1.new</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >ob1.m1 &nbsp;#=&gt; &nbsp;"xxx"</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >include M2</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >p A &nbsp; #=&gt; &nbsp;"yyy"</font></div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><br></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >6. Alias Methods</span></font></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >怎么处理重名的instance method? 可以在module的定义中使用alias. 例如</span></font></font></div><div><pre class="prettyprint"  ><p></p><div>module Happy</div><div>&nbsp; &nbsp; def Happy.mood</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return "happy"</div><div>&nbsp; &nbsp; end</div><div>&nbsp; &nbsp;</div><div>&nbsp; &nbsp; def expression</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return "smiling"</div><div>&nbsp; &nbsp; end</div><div>&nbsp; &nbsp; alias happyexpression expression</div><div>end</div><div>module Sad</div><div>&nbsp; &nbsp; def Sad.mood</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return "sad"</div><div>&nbsp; &nbsp; end</div><div>&nbsp; &nbsp;</div><div>&nbsp; &nbsp; def expression</div><div>&nbsp; &nbsp; &nbsp; &nbsp; return "frowning"</div><div>&nbsp; &nbsp; end</div><div>&nbsp; &nbsp; alias sadexpression expression</div><div>end</div><div>class Person</div><div>&nbsp; &nbsp; include Happy</div><div>&nbsp; &nbsp; include Sad</div><div>&nbsp; &nbsp; attr_accessor :mood</div><div>&nbsp; &nbsp; def initialize</div><div>&nbsp; &nbsp; &nbsp; &nbsp; @mood = Happy.mood</div><div>&nbsp; &nbsp; end</div><div>end</div><div>p2 = Person.new</div><div>puts(p2.mood) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #=&gt; happy</div><div>puts(p2.expression) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #=&gt; frowning</div><div>puts(p2.happyexpression) &nbsp; &nbsp; &nbsp;#=&gt; smiling</div><div>puts(p2.sadexpression) &nbsp; &nbsp; &nbsp; &nbsp;#=&gt; frowning</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><br></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >7. Mix in with Care!</span></font></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >Module中可以include &nbsp;其他Module, class中也可以include Module, class又可以继承其他superclass, 所以Module的出现使程序的继承关系变得很复杂, 不能滥用, 否则就连DEBUG都会成个头痛的问题. 来看一个例子, 你可能会觉得有点晕.</span></font></font></div><div><font size="2"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><pre class="prettyprint"  ><p></p><div># This is an example of how NOT to use modules!</div><div>module MagicThing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # module&nbsp;</div><div>&nbsp; &nbsp; class MagicClass &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# class inside module</div><div>&nbsp; &nbsp; end</div><div>end</div><div>module Treasure &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # module&nbsp;</div><div>end</div><div>module MetalThing</div><div>&nbsp; &nbsp; include MagicThing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# mixin</div><div>&nbsp; &nbsp; class Attributes &lt; MagicClass &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # subclasses class from mixin</div><div>&nbsp; &nbsp; end</div><div>end</div><div>include MetalThing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# mixin</div><div>class Weapon &lt; MagicClass &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # subclass class from mixin</div><div>&nbsp; &nbsp; class WeaponAttributes &lt; Attributes &nbsp; &nbsp; # subclass</div><div>&nbsp; &nbsp; end &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</div><div>end</div><div>class Sword &lt; Weapon &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# subclass &nbsp; &nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp; include Treasure &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# mixin</div><div>&nbsp; &nbsp; include MagicThing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# mixin</div><div>end</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 23px;"  ><br></span></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 23px;"  >8. Including Modules from Files</span></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 23px;"  >前面我们都是用include来加载一个Module的, 这种用法需要定义Module在同一个源码文件里面.&nbsp;</span></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 23px;"  >因为Module一般都是重复利用的, 所以放在其他文件里面会复用性更强, 放在文件中的话我们可以使用require , require_relative , load等来加载.</span></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 23px;"  >使用文件来加载就涉及到文件放在什么地方, 如何找到我们要加载的文件的问题了.</span></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 23px;"  >例如 :&nbsp;</span></div><div>require( "./testmod.rb" )</div><div>或省略.rb后缀</div><div>require( "./testmod" ) &nbsp;# this works too</div><div>如果不写绝对路径的话, 那么被加载的文件需要在搜索路径或者$:定义的路径中. $:是一个Array对象, 可以追加</div><div><pre class="prettyprint"  ><p></p><div><div>p $:.class</div><div>p $:</div><div>$: &lt;&lt; "."  # 追加当前目录</div><div>p $:</div></div><div>输出</div><div><div>Array</div><div>["C:/Ruby193/lib/ruby/site_ruby/1.9.1", "C:/Ruby193/lib/ruby/site_ruby/1.9.1/i386-msvcrt", "C:/Ruby193/lib/ruby/site_ruby", "C:/Ruby193/lib/ruby/vendor_ruby/1.9.1", "C:/Ruby193/lib/ruby/vendor_ruby/1.9.1/i386-msvcrt", "C:/Ruby193/lib/ruby/vendor_ruby", "C:/Ruby193/lib/ruby/1.9.1", "C:/Ruby193/lib/ruby/1.9.1/i386-mingw32"]</div><div>["C:/Ruby193/lib/ruby/site_ruby/1.9.1", "C:/Ruby193/lib/ruby/site_ruby/1.9.1/i386-msvcrt", "C:/Ruby193/lib/ruby/site_ruby", "C:/Ruby193/lib/ruby/vendor_ruby/1.9.1", "C:/Ruby193/lib/ruby/vendor_ruby/1.9.1/i386-msvcrt", "C:/Ruby193/lib/ruby/vendor_ruby", "C:/Ruby193/lib/ruby/1.9.1", "C:/Ruby193/lib/ruby/1.9.1/i386-mingw32", "."]</div></div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><span style="line-height: 23px;"  >1.8和1.9使用require加载文件的区别, 1.8不转换相对路径为绝对路径因此</span></div><div><pre class="prettyprint"  ><p></p><div>require "a"</div><div>require "./a"</div><div>将加载两次.</div><p></p></pre></div><div>而1.9 会把相对路径转换成绝对路径, 因此</div><div><div style="line-height: 20px;"  ><pre class="prettyprint"  ><p></p><div style="line-height: 20px;"  >require "a"</div><div style="line-height: 20px;"  >require "./a"</div><div style="line-height: 20px;"  >只会加载1次.</div><p></p></pre></div></div><div>require_relative是1.9新增的方法, 用来加载相对路径的文件.</div><div><pre class="prettyprint"  ><p></p><div>require_relative( "testmod.rb" ) &nbsp; &nbsp;# Ruby 1.9 only</div><div>相当于</div><div>require("./testmod.rb")</div><p></p></pre></div></font></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >require详解 :&nbsp;</span></font></font></div><div><pre class="prettyprint"  ><p></p><div>require(name) → true or false click to toggle source&nbsp;</div><div>Loads the given name, returning true if successful and false if the feature is already loaded.&nbsp;</div><div><br></div><div>If the filename does not resolve to an absolute path, it will be searched for in the directories listed in $LOAD_PATH ($:).&nbsp;</div><div><br></div><div>If the filename has the extension “.rb”, it is loaded as a source file; if the extension is “.so”, “.o”, or “.dll”, or the default shared library extension on the current platform, Ruby loads the shared library as a Ruby extension. Otherwise, Ruby tries adding “.rb”, “.so”, and so on to the name until found. If the file named cannot be found, a LoadError will be raised.&nbsp;</div><div><br></div><div>For Ruby extensions the filename given may use any shared library extension. For example, on Linux the socket extension is “socket.so“ and require 'socket.dll' will load the socket extension.&nbsp;</div><div><br></div><div>The absolute path of the loaded file is added to $LOADED_FEATURES ($"). A file will not be loaded again if its path already appears in $". For example, require 'a'; require './a' will not load a.rb again.&nbsp;</div><div><br></div><div>&nbsp; require "my-library.rb"</div><div>&nbsp; require "db-driver"</div><p></p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><font size="2"  style="line-height: 23px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font color="#333333"  face="Arial, Helvetica, simsun, u5b8bu4f53"  style="line-height: 23px;"  ><span style="line-height: 23px;"  >值得注意的是如果文件中定义了Module, 则这些module在使用前需要先执行<i>include. 例如 :&nbsp;</i></span></font></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >我有一个./rb.rb文件如下 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >module M1</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def method1</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; puts("this is a M1's instance method")</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >def method2</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; puts("this is a file's method")</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >end</font></div><p></p></pre></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >另外有一个程序如下 :&nbsp;</font></div><div><pre class="prettyprint"  ><p></p><div>$: &lt;&lt; "."</div><div>require("./rb.rb")</div><div>include M1</div><div>method1  # 使用method1前必须先include M1</div><div>method2  # 使用method2则在require这个文件后就可以直接使用了. 原因很容易理解.</div><p></p></pre></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >另外一个要注意的是, 使用require加载文件时, 文件中的代码被逐一执行, 如果有输出的则会输出. 例如前面的rb.rb文件后面添加一行</font><span style="font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 20px;"  >puts("rb.rb file loaded now.")</span><span style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >,</span></div><div><pre class="prettyprint"  ><p></p><div><span style="font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  >module M1</span></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div>&nbsp; def method1</div><div>&nbsp; &nbsp; puts("this is a M1's instance method")</div><div>&nbsp; end</div><div>end</div><div><br></div><div>def method2</div><div>&nbsp; puts("this is a file's method")</div><div>end</div><div>puts("rb.rb file loaded now.")</div></font></div><p></p></pre></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >那么在加载这个文件的时候会有输出</font></div><div><pre class="prettyprint"  ><p>rb.rb file loaded now.</p></pre></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >接下来介绍另一种加载文件的方法, load.</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >load是Kernel模块的方法, 它与require的不同之处, 使用load如果多次加载同一个文件, 它会多次执行. 而使用require多次加载同一个文件它只会加载一次.</div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >例如rb.rb如下</div><div><pre class="prettyprint"  ><p></p><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >C2 = 100</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >module M1</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; C1 = 10</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; def method1</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; &nbsp; puts("this is a M1's instance method")</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  ><br></font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >def method2</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >&nbsp; puts("this is a file's method")</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >end</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >puts("C2 is #{C2}.")</font></div><p></p></pre></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  >使用load加载2次看看发生了什么 :&nbsp;</font></div><div><font face="Arial, Helvetica, simsun, u5b8bu4f53"  ><div><pre class="prettyprint"  ><p></p><div>$: &lt;&lt; "."</div><div>load("rb.rb")</div><div>load("rb.rb")</div><div>输出</div><div><div>C:/Users/digoal/Desktop/rb.rb:1: warning: already initialized constant C2</div><div>C:/Users/digoal/Desktop/rb.rb:3: warning: already initialized constant C1</div><div>C2 is 100.</div><div>C2 is 100.</div></div><p></p></pre></div><div>使用require则只执行了一次 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div>$: &lt;&lt; "."</div><div>require("rb.rb")</div><div>require("rb.rb")</div></div><div>输出</div><div>C2 is 100.</div><p></p></pre></div><div>另外load 还有一个wrap参数, true或false, 默认是false.</div><div>true的情况下, load的这个文件被当成一个匿名module执行, 执行完后不会把文件中的代码带入当前环境.&nbsp;</div><div>false则和require类似, 会把方法, 常量, 类等带入当前环境.&nbsp;</div><div><pre class="prettyprint"  ><div>load(filename, wrap=false) → true click to toggle source&nbsp;</div><div>Loads and executes the Ruby program in the file filename. If the filename does not resolve to an absolute path, the file is searched for in the library directories listed in $:. If the optional wrap parameter is true, the loaded script will be executed under an anonymous module, protecting the calling program’s global namespace. In no circumstance will any local variables in the loaded file be propagated to the loading environment.&nbsp;</div><p></p></pre></div><div>例如 :&nbsp;</div><div>rb.rb还是如下,</div><div><pre class="prettyprint"  ><p></p><div>C2 = 100</div><div>module M1</div><div>&nbsp; C1 = 10</div><div>&nbsp; def method1</div><div>&nbsp; &nbsp; puts("this is a M1's instance method")</div><div>&nbsp; end</div><div>end</div><div><br></div><div>def method2</div><div>&nbsp; puts("this is a file's method")</div><div>end</div><div>puts("C2 is #{C2}.")</div><p></p></pre></div><div>使用load加载这个文件, 分别选用wrap=true和false.</div><div><pre class="prettyprint"  ><p></p><div><div>$: &lt;&lt; "."</div><div>load("rb.rb",true)</div></div><div><div style="line-height: 20px; font-family: Arial, Helvetica, simsun, u5b8bu4f53; white-space: normal;"  ># p C2 &nbsp;# 报错</div><div style="line-height: 20px; font-family: Arial, Helvetica, simsun, u5b8bu4f53; white-space: normal;"  ># method2 &nbsp;<span style="line-height: 20px;"  ># 报错</span></div><div style="line-height: 20px; font-family: Arial, Helvetica, simsun, u5b8bu4f53; white-space: normal;"  ># p M1::C1 &nbsp;<span style="line-height: 20px;"  ># 报错</span></div></div><div style="line-height: 20px; font-family: Arial, Helvetica, simsun, u5b8bu4f53; white-space: normal;"  ><span style="line-height: 20px;"  ># include M1 &nbsp;# 报错</span></div><div>输出</div><div>C2 is 100.</div><p></p></pre></div><div>如果把三个注释去掉报错如下 :&nbsp;</div><div><pre class="prettyprint"  ><p>C:/Users/digoal/Desktop/new.rb:3:in `&lt;main&gt;': uninitialized constant C2 (NameError)</p></pre></div><div>使用false load</div><div><pre class="prettyprint"  ><p></p><div><div>$: &lt;&lt; "."</div><div>load("rb.rb",false)</div><div>p C2</div><div>method2</div><div>p M1::C1</div></div><div>输出</div><div><div>C2 is 100.</div><div>100</div><div>this is a file's method</div><div>10</div></div><p></p></pre></div><div>最后一点load和require的区别, load必须使用文件名全称, 包括rb后缀, 否则无法使用.</div><div><pre class="prettyprint"  ><p></p><div><div>$: &lt;&lt; "."</div><div>load("rb")</div></div><div>报错</div><div><div>C:/Users/digoal/Desktop/new.rb:2:in `load': cannot load such file -- rb (LoadError)</div><div><span> </span>from C:/Users/digoal/Desktop/new.rb:2:in `&lt;main&gt;'</div></div><p></p></pre></div><div><pre class="prettyprint"  ><p></p><div><div>$: &lt;&lt; "."</div><div>require("rb")</div></div><div>输出</div><div>C2 is 100.</div><p></p></pre></div></font></div><div style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  ><br></div><span style="color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53; line-height: 23px;"  >【参考】</span></font></font><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >The Book Of Ruby</font></div><div style="line-height: 25px; color: rgb(51, 51, 51); font-family: Arial, Helvetica, simsun, u5b8bu4f53;"  ><font size="2"  style="line-height: 23px;"  >Ruby 1.9.3 API</font></div><wbr></div>
	</div>
</div>
</body>
</html>