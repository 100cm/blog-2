<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">clockdiff 检测两台linux主机的时间差</h2>
	<h5 id="">2012-06-13 9:04:11&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020125139411745/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>例如 :&nbsp;</div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >[root@db-172-16-3-33 ~]# clockdiff 172.16.3.150</font></div><div><font size="2"  >nice: unknown failure</font></div><div><font size="2"  >..</font></div><div><font size="2"  >host=172.16.3.150 rtt=562(280)ms/0ms delta=-120ms/-120ms Wed Jun 13 09:02:35 2012</font></div><div><font size="2"  >[root@db-172-16-3-33 ~]# date -s "2012-06-13 08:00:00"</font></div><div><font size="2"  >Wed Jun 13 08:00:00 CST 2012</font></div><div><font size="2"  >[root@db-172-16-3-33 ~]# clockdiff 172.16.3.150</font></div><div><font size="2"  >nice: unknown failure</font></div><div><font size="2"  >.</font></div><div><font size="2"  >host=172.16.3.150 rtt=750(187)ms/0ms delta=3760086ms/3760086ms Wed Jun 13 08:00:01 2012</font></div></div><div><font size="2"  ><br></font></div><div><span style="line-height: 22px;"  ><font size="2"  >delta = 目标主机减当前主机时间</font></span></div><div><span style="line-height: 22px;"  ><font size="2"  ><div>digoal=&gt; select 3760086/1000/60;</div><div>&nbsp;?column?&nbsp;</div><div>----------</div><div>&nbsp; &nbsp; &nbsp; &nbsp;62 分钟</div><div>(1 row)</div></font></span></div><p></p></pre></div><div><span style="line-height: 22px;"  ><br></span></div><div><br></div><div>CLOCKDIFF(8) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; System Manager’s Manual: iputils &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CLOCKDIFF(8)</div><div><br></div><div>NAME</div><div>&nbsp; &nbsp; &nbsp; &nbsp;clockdiff - measure clock difference between hosts</div><div><br></div><div>SYNOPSIS</div><div>&nbsp; &nbsp; &nbsp; &nbsp;clockdiff [ -o] &nbsp;[ -o1] &nbsp;destination</div><div><br></div><div>DESCRIPTION</div><div>&nbsp; &nbsp; &nbsp; &nbsp;clockdiff &nbsp;Measures clock difference between us and destination with 1 msec resolution using ICMP TIMESTAMP [2]</div><div>&nbsp; &nbsp; &nbsp; &nbsp;packets or, optionally, IP TIMESTAMP option [3] option added to ICMP ECHO. &nbsp;[1]</div><div><br></div><div>OPTIONS</div><div>&nbsp; &nbsp; &nbsp; &nbsp;-o &nbsp; &nbsp; Use IP TIMESTAMP with ICMP ECHO instead of ICMP TIMESTAMP messages. It is useful with some destinations,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; which do not support ICMP TIMESTAMP (f.e. Solaris &lt;2.4).</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;-o1 &nbsp; &nbsp;Slightly &nbsp;different &nbsp;form &nbsp;of -o, namely it uses three-term IP TIMESTAMP with prespecified hop addresses</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instead of four term one. &nbsp;What flavor works better depends on target host. Particularly, -o &nbsp;is &nbsp;better</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for Linux.</div><div><br></div><div>WARNINGS</div><div>&nbsp; &nbsp; &nbsp; &nbsp;・ Some nodes (Cisco) use non-standard timestamps, which is allowed by RFC, but makes timestamps mostly useless.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;・ Some nodes generate messed timestamps (Solaris&gt;2.4), when run xntpd. Seems, its IP &nbsp;stack &nbsp;uses &nbsp;a &nbsp;corrupted</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clock &nbsp;source, &nbsp;which &nbsp;is synchronized to time-of-day clock periodically and jumps randomly making timestamps</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mostly useless. Good news is that you can use NTP in this case, which is even better.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;・ clockdiff shows difference in time modulo 24 days.</div><div><br></div><div>SEE ALSO</div><div>&nbsp; &nbsp; &nbsp; &nbsp;ping(8), arping(8), tracepath(8).</div><div><br></div><div>REFERENCES</div><div>&nbsp; &nbsp; &nbsp; &nbsp;[1] ICMP ECHO, RFC0792, page 14.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;[2] ICMP TIMESTAMP, RFC0792, page 16.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;[3] IP TIMESTAMP option, RFC0791, 3.1, page 16.</div><div><div>AUTHOR</div><div>&nbsp; &nbsp; &nbsp; &nbsp;clockdiff was compiled by Alexey Kuznetsov &lt;kuznet@ms2.inr.ac.ru&gt;. It was based on code borrowed from BSD timed</div><div>&nbsp; &nbsp; &nbsp; &nbsp;daemon.</div><div><br></div><div>SECURITY</div><div>&nbsp; &nbsp; &nbsp; &nbsp;clockdiff requires CAP_NET_RAWIO capability to be executed. It is safe to be used as set-uid root.</div><div><br></div><div>AVAILABILITY</div><div>&nbsp; &nbsp; &nbsp; &nbsp;clockdiff &nbsp;is &nbsp;part &nbsp;of iputils package and the latest versions are &nbsp;available in source form for anonymous ftp</div><div>&nbsp; &nbsp; &nbsp; &nbsp;ftp://ftp.inr.ac.ru/ip-routing/iputils-current.tar.gz.</div><div><br></div><div>iputils-020927 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 26 September 2009 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CLOCKDIFF(8)</div></div><wbr></div>
	</div>
</div>
</body>
</html>