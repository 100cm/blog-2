<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">【转载】linux date timezone</h2>
	<h5 id="">2012-06-12 13:53:13&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201251215313777/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>(一)</div><div><br></div><div>一、首先要弄清几个概念：</div><div>1. “系统时间”与“硬件时间”</div><div>&nbsp; &nbsp; 系统时间: 一般说来就是我们执行 date 命令看到的时间，linux系统下所有的时间调用（除了直接访问硬件时间的命令）都是使用的这个时间。</div><div>&nbsp; &nbsp; 硬件时间: 主板上BIOS中的时间，由主板电池供电来维持运行，系统开机时要读取这个时间，并根据它来设定系统时间（注意：系统启动时根据硬件时间设定系统时间的过程可能存在时区换算，这要视具体的系统及相关设置而定）。</div><div>2. “UTC时间”与“本地时间”</div><div>&nbsp; &nbsp; UTC时间：Coordinated Universal 8 e2 i( H7 t0 ^/ ^Time 世界协调时间（又称世界标准时间、世界统一时间），在一般精度要求下，它与GMT（Greenwich Mean Time，格林威治标准时间）是一样的，其实也就是说 GMT≈UTC，但 UTC 是以原子钟校准的，更精确。</div><div>&nbsp; &nbsp; 本地时间：由于处在不同的时区，本地时间一般与UTC是不同的，换算方法就是</div><div>本地时间 = UTC + 时区 &nbsp; 或 &nbsp; UTC = 本地时间 - 时区</div><div>&nbsp; &nbsp; 时区东为正，西为负，例如在中国，本地时间都使用北京时间，在linux上显示就是 CST（China Standard Time，中国标准时，注意美国的中部标准时Central Standard Time也缩写为CST，与这里的CST不是一回事！），时区为东八区，也就是 +8 区，所以 CST=UTC+(+8小时) 或 UTC=CST-(+8小时)。</div><div><br></div><div>二、时间命令</div><div>1. 系统时间 date</div><div>&nbsp; &nbsp;直接调用 date，得到的是本地时间。如果想得到UTC时间的话，使用 date -u。</div><div>[12-01 19:07&gt; ~]$ date</div><div>2009年 12月 07日 星期一 14:22:20 CST</div><div>[12-01 19:07&gt; ~]$ date -u</div><div>2009年 12月 07日 星期一 06:22:22 UTC</div><div>2. 硬件时间 /sbin/hwclock</div><div>&nbsp; &nbsp;直接调用 /sbin/hwclock 显示的时间就是 BIOS 中的时间吗？未必！这要看 /etc/sysconfig/clock 中是否启用了UTC，如果启用了UTC（UTC=true），显示的其实是经过时区换算的时间而不是BIOS中真正的时间，如果加上 --localtime 选项，则得到的总是 BIOS 中实际的时间.</div><div>[12-01 19:07&gt; ~]# hwclock</div><div>2009年12月07日 星期一 14时28分43秒 -0.611463 seconds</div><div>[12-01 19:07&gt; ~]# hwclock --utc</div><div>2009年12月07日 星期一 14时28分46秒 -0.594189 seconds</div><div>[12-01 19:07&gt; ~]# hwclock --localtime</div><div>2009年12月07日 星期一 06时28分50秒 -0.063875 seconds</div><div>3. /etc/localtime</div><div>&nbsp; &nbsp;这个文件用来设置系统的时区，将 /usr/share/zoneinfo/ 中相应文件拷贝到/etc下并重命名为 localtime 即可修改时区设置，而且这种修改对 date 命令是及时生效的。不论是 date 还是 hwclock 都会用到这个文件，会根据这个文件的时区设置来进行UTC和本地之间之间的换算。</div><div>4. /etc/sysconfig/clock</div><div>&nbsp; &nbsp;这个文件只对 hwclock 有效，而且似乎是只在系统启动和关闭的时候才有用，比如修改了其中的 UTC=true 到 UTC=false 的前后，执行 hwclock (--utc, 或 --localtime) 都没有变化，要重启系统后才生效。注：如果设置 UTC=false 并重启系统后,执行一些命令结果如下：</div><div>date &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2009年 12月 07日 星期一 19:26:29 CST</div><div>date -u &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2009年 12月 07日 星期一 11:26:29 UTC</div><div>hwclock &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2009年12月07日 星期一 19时26分30秒 -0.442668 seconds</div><div>hwclock --utc &nbsp; &nbsp; &nbsp; &nbsp;2009年12月08日 星期二 03时26分31秒 -0.999091 seconds</div><div>hwclock --localtime 2009年12月07日 星期一 19时26分32秒 -0.999217 seconds</div><div>可见，如果不使用UTC，BIOS时间（红色部分）就是系统本地时间，而且注意这时执行 hwclock --utc 得到的结果没有任何意义，因为这里我们已经禁用了UTC，而且也明显不符合“本地时间=UTC+时区”的关系。</div><div><br></div><div>三、linux与windows双系统间的时间同步</div><div>&nbsp; &nbsp; 系统启动和关闭时，硬件时间与系统时间之间的同步有两种方式(假设在中国，用CST代表本地时间)：</div><div><br></div><div>方式A: 使用UTC（对linux就是 /etc/sysconfig/clock 中 UTC=true）</div><div>&nbsp; &nbsp; &nbsp; &nbsp;开机: BIOS---------&gt;UTC（将BIOS中的时间看成是UTC）------(时区变化)-----&gt;CST</div><div>&nbsp; &nbsp; 关机: CST -------(时区变化)-----&gt;UTC-------存储到------&gt;BIOS</div><div><br></div><div>方式B: 不使用UTC（对linux就是 /etc/sysconfig/clock 中 UTC=false）</div><div>&nbsp; &nbsp; &nbsp; &nbsp;开机: BIOS-----------------------&gt;CST（将BIOS中的时间看成是CST）</div><div>&nbsp; &nbsp; 关机: CST ---------存储到------&gt;BIOS</div><div><br></div><div>通过设定 /etc/sysconfig/clock，linux可以支持这两种方式，然而windows只支持方式B（至少是默认支持B，而我不知道怎么能让它支 持A），那么在双系统情况下，如果linux设成A方式，那么在linux与windows系统切换时一定会造成时间混乱的，解决办法就是将linux中 的UTC禁用，也设成B方式就可以了。</div><div><br></div><div>注：可以通过 hwclock --hctosys 来利用硬件时间来设置系统时间（注意不是简单的复制BIOS中的时间为系统时间，要看是否使用UTC，如果使用的话则要做时区换算），通过 hwclock --systohc 来根据系统时间设置硬件时间（也要看是否启用UTC来决定是否做时区换算）。总之，不论使用 --systohc 还是 --hctosys，同步后直接运行不带参数的 hwclock 得到的时间与直接运行 date 得到的时间应该一致，这个时间是否就是BIOS中的时间（hwclock --localtime)那就不一定了，如果启用了UTC就不是，没启用UTC就是。</div><div>而且好要注意：在系统中手动使用 hwclock hwclock --set --date='yyyy-mm-dd' 来设置BIOS时间只在系统运行时有效，因为当系统关闭时，还会按设定好的方式根据系统时间来重设BIOS时间的，于是手动的设置便被覆盖掉了。</div><div>---------------------------------------------------------------------</div><div>（二）</div><div><br></div><div><br></div><div>Linux时钟分为系统时钟（System Clock）和硬件（Real Time Clock，简称RTC）时钟。系统时钟是指当前Linux Kernel中的时钟，而硬件时钟则是主板上由电池供电的时钟，这个硬件时钟可以在BIOS中进行设置。当Linux启动时，硬件时钟会去读取系统时钟的设置，然后系统时钟就会独立于硬件运作。</div><div><br></div><div>Linux中的所有命令（包括函数）都是采用的系统时钟设置。在Linux中，用于时钟查看和设置的命令主要有date、hwclock和clock。其中，clock和hwclock用法相近，只用一个就行，只不过clock命令除了支持x86硬件体系外，还支持Alpha硬件体系。</div><div><br></div><div>1、date</div><div>查看系统时间</div><div># date</div><div>设置系统时间</div><div># date --set “07/07/06 10:19" （月/日/年 时:分:秒）</div><div><br></div><div>2、hwclock/clock</div><div>查看硬件时间</div><div># hwclock --show</div><div>或者</div><div># clock --show</div><div>设置硬件时间</div><div># hwclock --set --date="07/07/06 10:19" （月/日/年 时:分:秒）</div><div>或者</div><div># clock --set --date="07/07/06 10:19" （月/日/年 时:分:秒）</div><div><br></div><div>3、硬件时间和系统时间的同步</div><div><br></div><div>按照前面的说法，重新启动系统，硬件时间会读取系统时间，实现同步，但是在不重新启动的时候，需要用hwclock或clock命令实现同步。</div><div><br></div><div>硬件时钟与系统时钟同步：</div><div># hwclock --hctosys（hc代表硬件时间，sys代表系统时间）</div><div>或者</div><div># clock --hctosys</div><div>系统时钟和硬件时钟同步：</div><div># hwclock --systohc</div><div>或者</div><div># clock --systohc</div><div><br></div><div>4、时区的设置</div><div># tzselect</div><div>Please identify a location so that time zone rules can be set correctly.</div><div>Please select a continent or ocean.</div><div>1) Africa</div><div>2) Americas</div><div>3) Antarctica</div><div>4) Arctic Ocean</div><div>5) Asia</div><div>6) Atlantic Ocean</div><div>7) Australia</div><div>8) Europe</div><div>9) Indian Ocean</div><div>10) Pacific Ocean</div><div>11) none - I want to specify the time zone using the Posix TZ format.</div><div>#? 输入5，亚洲</div><div>Please select a country.</div><div>1) Afghanistan 18) Israel 35) Palestine</div><div>2) Armenia 19) Japan 36) Philippines</div><div>3) Azerbaijan 20) Jordan 37) Qatar</div><div>4) Bahrain 21) Kazakhstan 38) Russia</div><div>5) Bangladesh 22) Korea (North) 39) Saudi Arabia</div><div>6) Bhutan 23) Korea (South) 40) Singapore</div><div>7) Brunei 24) Kuwait 41) Sri Lanka</div><div>8) Cambodia 25) Kyrgyzstan 42) Syria</div><div>9) China 26) Laos 43) Taiwan</div><div>10) Cyprus 27) Lebanon 44) Tajikistan</div><div>11) East Timor 28) Macau 45) Thailand</div><div>12) Georgia 29) Malaysia 46) Turkmenistan</div><div>13) Hong Kong 30) Mongolia 47) United Arab Emirates</div><div>14) India 31) Myanmar (Burma) 48) Uzbekistan</div><div>15) Indonesia 32) Nepal 49) Vietnam</div><div>16) Iran 33) Oman 50) Yemen</div><div>17) Iraq 34) Pakistan</div><div>#? 输入9，中国</div><div>Please select one of the following time zone regions.</div><div>1) east China - Beijing, Guangdong, Shanghai, etc.</div><div>2) Heilongjiang</div><div>3) central China - Gansu, Guizhou, Sichuan, Yunnan, etc.</div><div>4) Tibet &amp; most of Xinjiang Uyghur</div><div>5) southwest Xinjiang Uyghur</div><div>#? 输入1，北京时间</div><div>The following information has been given:</div><div>China</div><div>east China - Beijing, Guangdong, Shanghai, etc.</div><div>Therefore TZ='Asia/Shanghai' will be used.</div><div>Local time is now: Fri Jul 7 10:32:18 CST 2006.</div><div>Universal Time is now: Fri Jul 7 02:32:18 UTC 2006.</div><div>Is the above information OK?</div><div>1) Yes</div><div>2) No</div><div>#? 输入1，确认</div><div>如果不用tzselect命令，可以修改文件变更时区。</div><div># vi /etc/sysconfig/clock</div><div>ZONE=Asia/Shanghai（查/usr/share/zoneinfo下面的文件）</div><div>UTC=false</div><div>ARC=false</div><div># rm /etc/localtime</div><div># ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</div><div>重新启动即可。</div><wbr></div>
	</div>
</div>
</body>
</html>