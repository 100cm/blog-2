<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL boolout format custom</h2>
	<h5 id="">2012-06-01 11:33:24&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201251112634618/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;">一位兄弟的需求, PostgreSQL的布尔值输出正常情况下是输出't'和'f'.<div>例如 :&nbsp;</div><div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >pgdba2000@db-172-16-3-33-&gt; psql test test</font></div><div><font size="2"  >psql (9.1.3)</font></div><div><font size="2"  >Type "help" for help.</font></div><div><font size="2"  >test=&gt; select '0'::boolean;</font></div><div><font size="2"  >&nbsp;bool&nbsp;</font></div><div><font size="2"  >------</font></div><div><font size="2"  >&nbsp;f</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >test=&gt; select '1'::boolean;</font></div><div><font size="2"  >&nbsp;bool&nbsp;</font></div><div><font size="2"  >------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >test=&gt; select 't'::boolean;</font></div><div><font size="2"  >&nbsp;bool&nbsp;</font></div><div><font size="2"  >------</font></div><div><font size="2"  >&nbsp;t</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >test=&gt; select 'f'::boolean;</font></div><div><font size="2"  >&nbsp;bool&nbsp;</font></div><div><font size="2"  >------</font></div><div><font size="2"  >&nbsp;f</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div><div><br></div><div>这个能不能改呢, 例如真的时候返回'1', 假的时候返回'0'.</div><div>这个在PostgreSQL编译完后是没有办法修改的, 只能在编译前修改一下src/backend/utils/adt/bool.c这个文件里面的</div><div>boolout函数:</div><div>原来是这样的 :&nbsp;</div><div><div><pre class="prettyprint"  ><p></p><div><div><font size="2"  >/*</font></div><div><font size="2"  >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;boolout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - converts 1 or 0 to "t" or "f"</font></div><div><font size="2"  >&nbsp;*/</font></div><div><font size="2"  >Datum</font></div><div><font size="2"  >boolout(PG_FUNCTION_ARGS)</font></div><div><font size="2"  >{</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; bool &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;b = PG_GETARG_BOOL(0);</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; char &nbsp; &nbsp; &nbsp; *result = (char *) palloc(2);</font></div><div><font size="2"  ><br></font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; result[0] = (b) ? 't' : 'f';</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; result[1] = '\0';</font></div><div><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_CSTRING(result);</font></div><div><font size="2"  >}</font></div></div><div></div><p></p></pre></div></div><div>改成</div><div><div><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><font size="2"  >/*</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp;* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;boolout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - converts 1 or 0 to "t" or "f"</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp;*/</font></div><div style="line-height: 22px;"  ><font size="2"  >Datum</font></div><div style="line-height: 22px;"  ><font size="2"  >boolout(PG_FUNCTION_ARGS)</font></div><div style="line-height: 22px;"  ><font size="2"  >{</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; bool &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;b = PG_GETARG_BOOL(0);</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; char &nbsp; &nbsp; &nbsp; *result = (char *) palloc(2);</font></div><div style="line-height: 22px;"  ><font size="2"  ><br style="line-height: 22px;"  ></font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; result[0] = (b) ? '1' : '0';</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; result[1] = '\0';</font></div><div style="line-height: 22px;"  ><font size="2"  >&nbsp; &nbsp; &nbsp; &nbsp; PG_RETURN_CSTRING(result);</font></div><div style="line-height: 22px;"  ><font size="2"  >}</font></div><p></p></pre></div><div style="line-height: 22px;"  ><br></div><div><div style="line-height: 22px;"  >编译</div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >./configure --prefix=/opt/pgsqltest --with-pgport=1988 --with-perl --with-python --with-openssl --with-pam --without-ldap --with-libxml --with-libxslt --enable-thread-safety --with-wal-blocksize=16 &amp;&amp; gmake world</font></div><div><font size="2"  >gmake install-world</font></div><p></p></pre></div><div style="line-height: 22px;"  ><br></div><div style="line-height: 22px;"  >初始化数据库</div><div><pre class="prettyprint"  ><p><font size="2"  >initdb -D $PGDATA -E UTF8 --locale=C -W</font></p></pre></div><div style="line-height: 22px;"  ><br></div><div style="line-height: 22px;"  >启动数据库测试</div><div><pre class="prettyprint"  ><p></p><div style="line-height: 22px;"  ><font size="2"  >pg_ctl start</font></div><div><div><font size="2"  >test@db5-&gt; psql postgres test</font></div><div><font size="2"  >psql (9.1.3)</font></div><div><font size="2"  >Type "help" for help.</font></div><div><font size="2"  >postgres=# select '1'::boolean;</font></div><div><font size="2"  >&nbsp;bool&nbsp;</font></div><div><font size="2"  >------</font></div><div><font size="2"  >&nbsp;1</font></div><div><font size="2"  >(1 row)</font></div></div><div><div><font size="2"  >postgres=# select 't'::boolean;</font></div><div><font size="2"  >&nbsp;bool&nbsp;</font></div><div><font size="2"  >------</font></div><div><font size="2"  >&nbsp;1</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# select true;</font></div><div><font size="2"  >&nbsp;bool&nbsp;</font></div><div><font size="2"  >------</font></div><div><font size="2"  >&nbsp;1</font></div><div><font size="2"  >(1 row)</font></div><div><font size="2"  >postgres=# select false;</font></div><div><font size="2"  >&nbsp;bool&nbsp;</font></div><div><font size="2"  >------</font></div><div><font size="2"  >&nbsp;0</font></div><div><font size="2"  >(1 row)</font></div></div><p></p></pre></div><div style="line-height: 22px;"  ><br></div></div><wbr></div><div>【参考】</div></div><div><pre class="prettyprint"  ><p></p><div><font size="2"  >digoal=&gt; select typname,typinput,typoutput from pg_type where typname='bool';</font></div><div><font size="2"  >&nbsp;typname | typinput | typoutput&nbsp;</font></div><div><font size="2"  >---------+----------+-----------</font></div><div><font size="2"  >&nbsp;bool &nbsp; &nbsp;| boolin &nbsp; | boolout</font></div><div><font size="2"  >(1 row)</font></div><p></p></pre></div></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">越狱迷失 - 2012-06-26 15:02:51</h5>
				<div>谢谢德哥,这个问题我问的.</div>
			</div>
	</div>
</div>
</body>
</html>